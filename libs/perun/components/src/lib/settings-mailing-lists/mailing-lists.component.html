<h1 class="page-title">
  {{'SHARED_LIB.PERUN.COMPONENTS.OPT_OUT_MAILING_LISTS.TITLE' | customTranslate | translate}}
</h1>
<perun-web-apps-debounce-filter
  [placeholder]="'SHARED_LIB.PERUN.COMPONENTS.OPT_OUT_MAILING_LISTS.FILTER' | customTranslate | translate"
  (filter)="applyFilter($event)"></perun-web-apps-debounce-filter>
<mat-accordion>
  @for (vo of filteredVos; track vo) {
    <mat-expansion-panel
      (closed)="deselectVo()"
      (afterExpand)="changeSelectedVo(vo)"
      [expanded]="vo.shortName === selectedVo">
      <mat-expansion-panel-header>
        <mat-panel-title>
          {{vo.name}}
        </mat-panel-title>
      </mat-expansion-panel-header>
      <ng-template matExpansionPanelContent>
        @if (loading) {
          <mat-spinner class="ms-auto me-auto"></mat-spinner>
        }
        @if (resources.length === 0 && !loading) {
          <perun-web-apps-alert
            alert_type="warn"
            >{{'SHARED_LIB.PERUN.COMPONENTS.OPT_OUT_MAILING_LISTS.NO_MAILING_LISTS_ALERT' | customTranslate | translate}}</perun-web-apps-alert
          >
        }
        @if (resources.length && !loading) {
          <mat-accordion>
            @for (resource of resources; track resource) {
              <mat-expansion-panel
                (closed)="deselectResource()"
                (afterExpand)="changeSelectedResource(resource)"
                [expanded]="resource.name === selectedResource">
                <mat-expansion-panel-header>
                  <mat-panel-title>
                    {{resource.name}}
                  </mat-panel-title>
                </mat-expansion-panel-header>
                <div class="row">
                  <mat-checkbox
                    [checked]="optOutAttribute && optOutAttribute.value !== null"
                    (change)="setOptOut()">
                    {{'SHARED_LIB.PERUN.COMPONENTS.OPT_OUT_MAILING_LISTS.OPT_OUT_LABEL' | customTranslate | translate}}
                  </mat-checkbox>
                </div>
              </mat-expansion-panel>
            }
          </mat-accordion>
        }
      </ng-template>
    </mat-expansion-panel>
  }
</mat-accordion>
