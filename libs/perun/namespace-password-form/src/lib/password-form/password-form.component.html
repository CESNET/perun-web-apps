<div [formGroup]="formGroup">
  <mat-form-field
    class="max-width"
    subscriptSizing="dynamic"
    [matTooltip]="getPasswordDisabledTooltip()"
    matTooltipPosition="left"
    [matTooltipDisabled]="formGroup.get('passwordCtrl').enabled || tooltipPwdDisabledForNamespace">
    <mat-label>
      {{'SHARED_LIB.PERUN.COMPONENTS.PASSWORD_FORM_FIELD.PASSWORD' | translate}}
    </mat-label>
    <input
      data-cy="passwd-input"
      [type]="showNewPassword ? 'text' : 'password'"
      matInput
      [required]="passwordRequired"
      formControlName="passwordCtrl"
      [errorStateMatcher]="passwordStateMatcher" />
    @if (this.formGroup.get('passwordCtrl').pending) {
      <mat-spinner matSuffix [diameter]="18" class="input-spinner"></mat-spinner>
    }
    <mat-icon matSuffix (click)="showNewPassword = !showNewPassword">
      {{showNewPassword ? "visibility_off": "visibility"}}
    </mat-icon>
    @if (
      this.formGroup.get('passwordCtrl').dirty && this.formGroup.get('passwordCtrl').errors !== null
    ) {
      <mat-icon
        color="warn"
        matSuffix
        class="error-icon"
        [matTooltip]="getErrorTooltip()"
        [matTooltipDisabled]="!formGroup.get('passwordCtrl').hasError('backendError')">
        error
      </mat-icon>
    }
    @if (formGroup.get('passwordCtrl').hasError('required')) {
      <mat-error
        >{{'SHARED_LIB.PERUN.COMPONENTS.PASSWORD_FORM_FIELD.FIELD_EMPTY' | translate}}</mat-error
      >
    }
    @if (formGroup.get('passwordCtrl').hasError('backendError')) {
      <mat-error
        [matTooltip]="getErrorTooltip()"
        matTooltipPosition="after"
        >{{getErrorTooltip()}}</mat-error
      >
    }
  </mat-form-field>

  <mat-form-field class="max-width" subscriptSizing="dynamic">
    <mat-label>
      {{'SHARED_LIB.PERUN.COMPONENTS.PASSWORD_FORM_FIELD.PASSWORD_AGAIN' | translate}}
    </mat-label>
    <input
      data-cy="confirm-passwd-input"
      [type]="showPasswordConfirm ? 'text' : 'password'"
      matInput
      [required]="passwordRequired"
      formControlName="passwordAgainCtrl" />
    <mat-icon matSuffix (click)="showPasswordConfirm = !showPasswordConfirm">
      {{showPasswordConfirm ? "visibility_off": "visibility"}}
    </mat-icon>
    @if (formGroup.get('passwordAgainCtrl').hasError('required')) {
      <mat-error
        >{{'SHARED_LIB.PERUN.COMPONENTS.PASSWORD_FORM_FIELD.FIELD_EMPTY' | translate}}</mat-error
      >
    }
    @if (formGroup.get('passwordAgainCtrl').hasError('noPasswordMatch')) {
      <mat-error
        >{{'SHARED_LIB.PERUN.COMPONENTS.PASSWORD_FORM_FIELD.PWD_DONT_MATCH' | translate}}</mat-error
      >
    }
  </mat-form-field>

  <perun-web-apps-alert alert_type="info">
    <div [innerHTML]="passwordRequirement"></div>
  </perun-web-apps-alert>
</div>
