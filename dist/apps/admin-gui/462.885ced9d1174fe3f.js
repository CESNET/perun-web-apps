"use strict";(self.webpackChunkadmin_gui=self.webpackChunkadmin_gui||[]).push([[462],{15935:(I,b,a)=>{a.d(b,{D:()=>B});var M=a(20449),v=a(84847),l=a(32075),c=a(9244),E=a(36908),e=a(5e3),t=a(18750),T=a(77446),f=a(69808),D=a(98380),p=a(51062),x=a(37677);function s(r,m){if(1&r){const i=e.EpF();e.TgZ(0,"th",15),e.TgZ(1,"mat-checkbox",16),e.NdJ("change",function(g){e.CHM(i);const o=e.oxw();return g?o.masterToggle():null}),e.qZA(),e.qZA()}if(2&r){const i=e.oxw();e.xp6(1),e.Q6J("aria-label",i.checkboxLabel())("checked",i.selection.hasValue()&&i.isAllSelected())("indeterminate",i.selection.hasValue()&&!i.isAllSelected())}}function u(r,m){if(1&r){const i=e.EpF();e.TgZ(0,"td",17),e.TgZ(1,"mat-checkbox",18),e.NdJ("change",function(g){const d=e.CHM(i).$implicit,n=e.oxw();return g?n.selection.toggle(d):null})("click",function(g){return g.stopPropagation()}),e.qZA(),e.qZA()}if(2&r){const i=m.$implicit,_=e.oxw();e.xp6(1),e.Q6J("aria-label",_.checkboxLabel(i))("checked",_.selection.isSelected(i))}}function O(r,m){1&r&&(e.TgZ(0,"th",19),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&r&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"SHARED.COMPONENTS.EXT_SOURCES_LIST.ID")," "))}function A(r,m){if(1&r&&(e.TgZ(0,"td",20),e._uU(1),e.qZA()),2&r){const i=m.$implicit;e.xp6(1),e.Oqu(i.id)}}function S(r,m){1&r&&(e.TgZ(0,"th",19),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&r&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"SHARED.COMPONENTS.EXT_SOURCES_LIST.NAME")," "))}function P(r,m){if(1&r&&(e.TgZ(0,"td",21),e._uU(1),e.qZA()),2&r){const i=m.$implicit;e.xp6(1),e.Oqu(i.name)}}function L(r,m){1&r&&(e.TgZ(0,"th",19),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&r&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"SHARED.COMPONENTS.EXT_SOURCES_LIST.TYPE")," "))}function Z(r,m){if(1&r&&(e.TgZ(0,"td",21),e._uU(1),e.ALo(2,"extSourceType"),e.qZA()),2&r){const i=m.$implicit;e.xp6(1),e.Oqu(e.lcZ(2,1,i.type))}}function y(r,m){1&r&&e._UZ(0,"tr",22)}function U(r,m){1&r&&e._UZ(0,"tr",23)}function w(r,m){1&r&&(e.TgZ(0,"perun-web-apps-alert",24),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&r&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"SHARED.COMPONENTS.EXT_SOURCES_LIST.NO_EXT_SOURCES"),"\n"))}function N(r,m){1&r&&(e.TgZ(0,"perun-web-apps-alert",24),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&r&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"SHARED.COMPONENTS.EXT_SOURCES_LIST.NO_FILTER_RESULTS"),"\n"))}let B=(()=>{class r{constructor(i,_){this.authResolver=i,this.tableCheckbox=_,this.selection=new M.Ov,this.filterValue="",this.displayedColumns=["select","id","name","type"],this.exporting=!1,this.pageSizeOptions=c.f7}set matSort(i){this.sort=i,this.setDataSource()}static getDataForColumn(i,_){switch(_){case"id":return i.id.toString();case"type":return i.type.substring(40);case"name":return i.name;default:return""}}ngAfterViewInit(){this.setDataSource()}ngOnChanges(){this.authResolver.isPerunAdminOrObserver()||(this.displayedColumns=this.displayedColumns.filter(i=>"id"!==i)),this.dataSource=new l.by(this.extSources),this.setDataSource()}exportData(i){(0,c.O6)((0,c.Xn)(this.dataSource.filteredData,this.displayedColumns,r.getDataForColumn),i)}setDataSource(){this.dataSource&&(this.dataSource.filterPredicate=(i,_)=>(0,c.Sd)(i,_,this.displayedColumns,r.getDataForColumn),this.dataSource.sortData=(i,_)=>(0,c.pR)(i,_,r.getDataForColumn),this.dataSource.sort=this.sort,this.dataSource.paginator=this.child.paginator,this.dataSource.filter=this.filterValue)}isAllSelected(){return this.tableCheckbox.isAllSelected(this.selection.selected.length,this.filterValue,this.child.paginator.pageSize,this.child.paginator.hasNextPage(),this.dataSource)}masterToggle(){this.tableCheckbox.masterToggle(this.isAllSelected(),this.selection,this.filterValue,this.dataSource,this.sort,this.child.paginator.pageSize,this.child.paginator.pageIndex,!1)}checkboxLabel(i){return i?`${this.selection.isSelected(i)?"deselect":"select"} row ${i.id+1}`:(this.isAllSelected()?"select":"deselect")+" all"}}return r.\u0275fac=function(i){return new(i||r)(e.Y36(E.x4),e.Y36(E.UA))},r.\u0275cmp=e.Xpm({type:r,selectors:[["app-ext-sources-list"]],viewQuery:function(i,_){if(1&i&&(e.Gf(c.l9,7),e.Gf(v.YE,7)),2&i){let g;e.iGM(g=e.CRH())&&(_.child=g.first),e.iGM(g=e.CRH())&&(_.matSort=g.first)}},inputs:{extSources:"extSources",selection:"selection",filterValue:"filterValue",displayedColumns:"displayedColumns",tableId:"tableId"},features:[e.TTD],decls:19,vars:9,consts:[[1,"card","mt-2",3,"hidden"],[3,"pageSizeOptions","dataLength","tableId","exportData"],["mat-table","","matSort","","matSortActive","id","matSortDirection","asc","matSortDisableClear","",1,"w-100",3,"dataSource"],["matColumnDef","select"],["class","align-checkbox","mat-header-cell","",4,"matHeaderCellDef"],["class","static-column-size align-checkbox","mat-cell","",4,"matCellDef"],["matColumnDef","id"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["class","static-column-size","mat-cell","",4,"matCellDef"],["matColumnDef","name"],["mat-cell","",4,"matCellDef"],["matColumnDef","type"],["mat-header-row","",4,"matHeaderRowDef"],["class","dark-hover-list-item","mat-row","",4,"matRowDef","matRowDefColumns"],["alert_type","warn",4,"ngIf"],["mat-header-cell","",1,"align-checkbox"],["color","primary",3,"aria-label","checked","indeterminate","change"],["mat-cell","",1,"static-column-size","align-checkbox"],["color","primary",3,"aria-label","checked","change","click"],["mat-header-cell","","mat-sort-header",""],["mat-cell","",1,"static-column-size"],["mat-cell",""],["mat-header-row",""],["mat-row","",1,"dark-hover-list-item"],["alert_type","warn"]],template:function(i,_){1&i&&(e.TgZ(0,"div",0),e.TgZ(1,"perun-web-apps-table-wrapper",1),e.NdJ("exportData",function(o){return _.exportData(o)}),e.TgZ(2,"table",2),e.ynx(3,3),e.YNc(4,s,2,3,"th",4),e.YNc(5,u,2,2,"td",5),e.BQk(),e.ynx(6,6),e.YNc(7,O,3,3,"th",7),e.YNc(8,A,2,1,"td",8),e.BQk(),e.ynx(9,9),e.YNc(10,S,3,3,"th",7),e.YNc(11,P,2,1,"td",10),e.BQk(),e.ynx(12,11),e.YNc(13,L,3,3,"th",7),e.YNc(14,Z,3,3,"td",10),e.BQk(),e.YNc(15,y,1,0,"tr",12),e.YNc(16,U,1,0,"tr",13),e.qZA(),e.qZA(),e.qZA(),e.YNc(17,w,3,3,"perun-web-apps-alert",14),e.YNc(18,N,3,3,"perun-web-apps-alert",14)),2&i&&(e.Q6J("hidden",0===_.extSources.length||0===_.dataSource.filteredData.length),e.xp6(1),e.Q6J("pageSizeOptions",_.pageSizeOptions)("dataLength",_.dataSource.filteredData.length)("tableId",_.tableId),e.xp6(1),e.Q6J("dataSource",_.dataSource),e.xp6(13),e.Q6J("matHeaderRowDef",_.displayedColumns),e.xp6(1),e.Q6J("matRowDefColumns",_.displayedColumns),e.xp6(1),e.Q6J("ngIf",0===_.extSources.length),e.xp6(1),e.Q6J("ngIf",0===_.dataSource.filteredData.length&&0!==_.extSources.length))},directives:[t.l,l.BZ,v.YE,l.w1,l.fO,l.ge,T.oG,l.Dz,l.ev,v.nU,l.as,l.XQ,l.nj,l.Gk,f.O5,D.w],pipes:[p.X$,x.A],styles:[""]}),r})()},60526:(I,b,a)=>{a.d(b,{b:()=>g});var M=a(32105),v=a(9244),l=a(16074),c=a(32075),E=a(36908),e=a(64080),t=a(5e3),T=a(48966),f=a(51062),D=a(9224),p=a(69808),x=a(20773),s=a(47423),u=a(25245),O=a(69773),A=a(21757),S=a(21330),P=a(62383);function L(o,d){1&o&&t._UZ(0,"mat-spinner",4)}function Z(o,d){1&o&&t._UZ(0,"th",12)}function y(o,d){if(1&o&&(t.TgZ(0,"td",13),t._uU(1),t.qZA()),2&o){const n=d.$implicit;t.xp6(1),t.hij("",n,":")}}function U(o,d){1&o&&t._UZ(0,"th",12)}function w(o,d){if(1&o){const n=t.EpF();t.TgZ(0,"button",17),t.NdJ("click",function(){return t.CHM(n),t.oxw(4).changeStatus()}),t.TgZ(1,"mat-icon"),t._uU(2,"edit"),t.qZA(),t.qZA()}}function N(o,d){if(1&o&&(t.TgZ(0,"div"),t.TgZ(1,"i"),t.ALo(2,"memberStatusIconColor"),t._uU(3),t.ALo(4,"memberStatusIcon"),t.qZA(),t.TgZ(5,"b",15),t._uU(6),t.ALo(7,"transformMemberStatus"),t.qZA(),t.YNc(8,w,3,0,"button",16),t.qZA()),2&o){const n=t.oxw(3);t.xp6(1),t.Gre("material-icons vert-center mr-1 ",t.lcZ(2,6,n.member.status),""),t.xp6(2),t.hij(" ",t.lcZ(4,8,n.member.status)," "),t.xp6(3),t.hij(" ",t.lcZ(7,10,n.member.status)," "),t.xp6(2),t.Q6J("ngIf",n.authResolver.isThisVoAdmin(n.vo.id))}}function B(o,d){if(1&o){const n=t.EpF();t.TgZ(0,"button",17),t.NdJ("click",function(){return t.CHM(n),t.oxw(4).changeVoExpiration(!1)}),t.TgZ(1,"mat-icon"),t._uU(2,"edit"),t.qZA(),t.qZA()}}function r(o,d){if(1&o&&(t.TgZ(0,"div"),t.TgZ(1,"i",18),t._uU(2),t.ALo(3,"parseDate"),t.qZA(),t.YNc(4,B,3,0,"button",16),t.qZA()),2&o){const n=t.oxw(3);t.xp6(2),t.hij(" ",t.lcZ(3,2,n.voExpiration)," "),t.xp6(2),t.Q6J("ngIf",n.authResolver.isThisVoAdmin(n.vo.id))}}function m(o,d){if(1&o&&(t.TgZ(0,"td",14),t.YNc(1,N,9,12,"div",3),t.YNc(2,r,5,4,"div",3),t.qZA()),2&o){const n=d.$implicit;t.xp6(1),t.Q6J("ngIf","Status"===n),t.xp6(1),t.Q6J("ngIf","Expiration"===n)}}function i(o,d){1&o&&t._UZ(0,"tr",19)}function _(o,d){if(1&o&&(t.TgZ(0,"div"),t.TgZ(1,"table",5),t.ynx(2,6),t.YNc(3,Z,1,0,"th",7),t.YNc(4,y,2,1,"td",8),t.BQk(),t.ynx(5,9),t.YNc(6,U,1,0,"th",7),t.YNc(7,m,3,2,"td",10),t.BQk(),t.YNc(8,i,1,0,"tr",11),t.qZA(),t.qZA()),2&o){const n=t.oxw();t.xp6(1),t.Q6J("dataSource",n.voMembershipDataSource),t.xp6(7),t.Q6J("matRowDefColumns",n.displayedColumns)}}let g=(()=>{class o{constructor(n,h,R,C,W,K){this.dialog=n,this.authResolver=h,this.apiRequest=R,this.attributesManager=C,this.translate=W,this.notificator=K,this.voMembershipDataSource=new c.by,this.voExpiration="",this.displayedColumns=["attName","attValue"]}ngOnChanges(){this.voMembershipDataSource=new c.by(["Status","Expiration"]),this.refreshVoExpiration()}changeStatus(){const n=(0,v.kZ)();n.width="600px",n.data={member:this.member,voId:this.vo.id};const h=this.member.status;this.dialog.open(l.pf,n).afterClosed().subscribe(C=>{C&&(this.member=C,("VALID"===h&&("EXPIRED"===C.status||"DISABLED"===C.status)||"VALID"===C.status)&&this.changeVoExpiration(!0))})}changeVoExpiration(n){const h=(0,v.kZ)();h.width="400px",h.data={voId:this.vo.id,memberId:this.member.id,expirationAttr:this.voExpirationAtt,status:this.member.status,statusChanged:n},this.dialog.open(l.kZ,h).afterClosed().subscribe(C=>{C.success&&(C.member&&(this.member=C.member),this.refreshVoExpiration())})}refreshVoExpiration(){this.loading=!0,this.apiRequest.dontHandleErrorForNext(),this.attributesManager.getMemberAttributeByName(this.member.id,e.r.MEMBER_DEF_EXPIRATION).subscribe(n=>{this.voExpirationAtt=n,this.voExpiration=n.value?n.value:this.translate.instant("MEMBER_DETAIL.OVERVIEW.NEVER_EXPIRES"),this.loading=!1},n=>{const h=n.error;"PrivilegeException"!==h.name?this.notificator.showError(h.name):this.voMembershipDataSource=new c.by(["Status"]),this.loading=!1})}}return o.\u0275fac=function(n){return new(n||o)(t.Y36(T.uw),t.Y36(E.x4),t.Y36(E.F5),t.Y36(M.H8),t.Y36(f.sK),t.Y36(E.V6))},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-member-overview-membership"]],inputs:{member:"member",vo:"vo"},features:[t.TTD],decls:9,vars:5,consts:[[1,"mat-elevation-z3","membership-card"],[1,"page-subtitle"],["class","mr-auto ml-auto",4,"ngIf"],[4,"ngIf"],[1,"mr-auto","ml-auto"],["mat-table","",1,"ml-auto","mr-auto",3,"dataSource"],["matColumnDef","attName"],["mat-header-cell","",4,"matHeaderCellDef"],["class","font-weight-bold","mat-cell","",4,"matCellDef"],["matColumnDef","attValue"],["class","column-center","mat-cell","",4,"matCellDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["mat-header-cell",""],["mat-cell","",1,"font-weight-bold"],["mat-cell","",1,"column-center"],[1,"vert-top"],["mat-icon-button","",3,"click",4,"ngIf"],["mat-icon-button","",3,"click"],[1,"column-center"],["mat-row",""]],template:function(n,h){1&n&&(t.TgZ(0,"mat-card",0),t.TgZ(1,"mat-card-header"),t.TgZ(2,"mat-card-title"),t.TgZ(3,"h1",1),t._uU(4),t.ALo(5,"translate"),t.qZA(),t.qZA(),t.qZA(),t.TgZ(6,"mat-card-content"),t.YNc(7,L,1,0,"mat-spinner",2),t.YNc(8,_,9,2,"div",3),t.qZA(),t.qZA()),2&n&&(t.xp6(4),t.hij(" ",t.lcZ(5,3,"MEMBER_DETAIL.OVERVIEW.ORGANIZATION_MEMBERSHIP")," "),t.xp6(3),t.Q6J("ngIf",h.loading),t.xp6(1),t.Q6J("ngIf",!h.loading))},directives:[D.a8,D.dk,D.n5,D.dn,p.O5,x.$g,c.BZ,c.w1,c.fO,c.ge,c.Dz,c.ev,s.lW,u.Hw,c.nj,c.Gk],pipes:[f.X$,O.u,A.f,S.r,P.M],styles:[".membership-card[_ngcontent-%COMP%]{max-width:400px}.vert-center[_ngcontent-%COMP%]{vertical-align:middle!important}"]}),o})()},21330:(I,b,a)=>{a.d(b,{r:()=>v});var M=a(5e3);let v=(()=>{class l{transform(E,e){return"valid"!==E.toLowerCase()||e&&"valid"!==E.toLowerCase()?E:"ACTIVE"}}return l.\u0275fac=function(E){return new(E||l)},l.\u0275pipe=M.Yjl({name:"transformMemberStatus",type:l,pure:!0}),l})()},71992:(I,b,a)=>{a.d(b,{a:()=>T});var M=a(36908),v=a(32105),l=a(24850),c=a(27221),E=a(21086),e=a(5e3),t=a(11735);let T=(()=>{class f{constructor(p,x,s,u,O,A,S,P){this.authResolver=p,this.routePolicyService=x,this.router=s,this.notificator=u,this.apiRequest=O,this.memberManager=A,this.groupManager=S,this.resourceManager=P}static getBeanName(p){switch(p){case"organizations":return"Vo";case"groups":return"Group";case"facilities":case"services":return"Facility";case"resources":return"Resource";case"members":return"Member";default:return""}}static parseUrl(p){const x=p.slice(1).split("/").reverse(),s={key:"",entity:{id:-1,beanName:""}};for(const u of x){if(Number(u)){if(-1===s.entity.id){s.entity.id=Number(u);continue}"services-status-"===s.key&&(s.entity.id=Number(u));break}s.key=u.concat("-",s.key)}return s.key=s.key.slice(0,s.key.length-1),s.entity.beanName=f.getBeanName(s.key.split("-")[0]),s}canActivateChild(p,x){if(this.authResolver.isPerunAdminOrObserver())return!0;const s=f.parseUrl(x.url);return s.key.startsWith("members")?(this.apiRequest.dontHandleErrorForNext(),this.memberManager.getMemberById(s.entity.id).pipe((0,l.U)(u=>(s.entity.userId=u.userId,s.entity.voId=u.voId,this.finalizeCanActivateChild(s))),(0,c.K)(u=>this.errorRedirectUrl(u.error)))):s.key.startsWith("groups")?(this.apiRequest.dontHandleErrorForNext(),this.groupManager.getGroupById(s.entity.id).pipe((0,l.U)(u=>(s.entity.voId=u.voId,this.finalizeCanActivateChild(s))),(0,c.K)(u=>this.errorRedirectUrl(u.error)))):s.key.startsWith("resources")?(this.apiRequest.dontHandleErrorForNext(),this.resourceManager.getResourceById(s.entity.id).pipe((0,l.U)(u=>(s.entity.facilityId=u.facilityId,s.entity.voId=u.voId,this.finalizeCanActivateChild(s))),(0,c.K)(u=>this.errorRedirectUrl(u.error)))):this.finalizeCanActivateChild(s)}finalizeCanActivateChild(p){return!!this.routePolicyService.canNavigate(p.key,p.entity)||(this.notificator.showRouteError(),this.router.parseUrl("/notAuthorized"))}errorRedirectUrl(p){if("PrivilegeException"===p.name)return this.notificator.showRouteError(),(0,E.of)(this.router.parseUrl("/notAuthorized"))}}return f.\u0275fac=function(p){return new(p||f)(e.LFG(M.x4),e.LFG(M.Ip),e.LFG(t.F0),e.LFG(M.V6),e.LFG(M.F5),e.LFG(v.uq),e.LFG(v.ff),e.LFG(v.xk))},f.\u0275prov=e.Yz7({token:f,factory:f.\u0275fac,providedIn:"root"}),f})()}}]);