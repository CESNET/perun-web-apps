"use strict";(self.webpackChunkadmin_gui=self.webpackChunkadmin_gui||[]).push([[21],{25021:(Io,Mt,l)=>{l.r(Mt),l.d(Mt,{FacilitiesModule:()=>W});var m=l(36895),y=l(82761),Jt=l(86353),Ot=l(36769),te=l(77968),ee=l(69024),_=l(61744),p=l(9244),d=l(95243),yt=l(67791),ie=l(54037),se=l(15003),ae=l(22158),ne=l(82722),t=l(94650),r=l(7274),K=l(97392),T=l(4859),Rt=l(51572),vt=l(10266),Ht=l(61283),oe=l(4235),M=l(55755),h=l(89383);function le(s,i){1&s&&t._UZ(0,"mat-spinner",3)}function ce(s,i){if(1&s){const e=t.EpF();t.TgZ(0,"button",12),t.NdJ("click",function(){t.CHM(e);const n=t.oxw(2);return t.KtG(n.editFacility())}),t.TgZ(1,"mat-icon"),t._uU(2,"edit"),t.qZA()()}}function re(s,i){if(1&s){const e=t.EpF();t.TgZ(0,"button",12),t.NdJ("click",function(){t.CHM(e);const n=t.oxw(2);return t.KtG(n.deleteFacility())}),t.TgZ(1,"mat-icon"),t._uU(2,"delete_forever"),t.qZA()()}}const pe=function(){return{color:"black"}},Gt=function(s){return["/facilities",s]};function de(s,i){if(1&s&&(t.TgZ(0,"div")(1,"div",4),t._UZ(2,"mat-icon",5),t.ALo(3,"translate"),t.TgZ(4,"div",6)(5,"div",7)(6,"a",8),t.NdJ("auxclick",function(a){return a.preventDefault()}),t._uU(7),t.qZA(),t.TgZ(8,"span",9),t._uU(9),t.qZA(),t.YNc(10,ce,3,0,"button",10),t.YNc(11,re,3,0,"button",10),t.qZA(),t.TgZ(12,"span",11),t._uU(13),t.ALo(14,"translate"),t.ALo(15,"translate"),t.qZA()()(),t._UZ(16,"app-animated-router-outlet"),t.qZA()),2&s){const e=t.oxw();t.xp6(2),t.s9C("matTooltip",t.lcZ(3,11,"FACILITY_DETAIL.ENTITY")),t.Q6J("ngStyle",t.DdM(17,pe)),t.xp6(4),t.Q6J("perunWebAppsMiddleClickRouterLink",t.VKq(18,Gt,e.facility.id.toString()))("routerLink",t.VKq(20,Gt,e.facility.id)),t.xp6(1),t.Oqu(e.facility.name),t.xp6(2),t.hij(" \xa0#",e.facility.id," "),t.xp6(1),t.Q6J("ngIf",e.editFacilityAuth),t.xp6(1),t.Q6J("ngIf",e.deleteAuth),t.xp6(2),t.lnq(" ",t.lcZ(14,13,"FACILITY_DETAIL.ENTITY"),", ",t.lcZ(15,15,"FACILITY_DETAIL.DESCRIPTION"),": ",e.facility.description," ")}}class j extends((0,ae.T)()){constructor(i,e,a,n,o,u,f,b,F){super(),this.dialog=i,this.facilityManager=e,this.route=a,this.sideMenuService=n,this.sideMenuItemService=o,this.guiAuthResolver=u,this.router=f,this.entityStorageService=b,this.reloadEntityDetail=F,this.editFacilityAuth=!1,this.deleteAuth=!1,this.loading=!1}ngOnInit(){this.reloadData(),this.reloadEntityDetail.entityDetailChange.pipe((0,ne.R)(this.destroyed$)).subscribe(()=>{this.reloadData()})}reloadData(){this.loading=!0,this.route.params.subscribe(i=>{const e=Number(i.facilityId);this.facilityManager.getFacilityById(e).subscribe(a=>{this.facility=a,this.entityStorageService.setEntity({id:a.id,beanName:a.beanName}),this.setMenuItems(),this.editFacilityAuth=this.guiAuthResolver.isAuthorized("updateFacility_Facility_policy",[this.facility]),this.deleteAuth=this.guiAuthResolver.isAuthorized("deleteFacility_Facility_Boolean_policy",[this.facility]),(0,p.sF)("facilities",this.facility),(0,p.XI)(this.facility),this.loading=!1},()=>this.loading=!1)})}setMenuItems(){const i=this.sideMenuItemService.parseFacility(this.facility);this.sideMenuService.setFacilityMenuItems([i])}editFacility(){const i=(0,p.kZ)();i.width="450px",i.data={theme:"facility-theme",facility:this.facility,dialogType:yt.Eg.FACILITY},this.dialog.open(yt.rd,i).afterClosed().subscribe(a=>{a&&this.facilityManager.getFacilityById(this.facility.id).subscribe(n=>{this.facility=n,this.setMenuItems()})})}deleteFacility(){const i=(0,p.kZ)();i.width="500px",i.data={theme:"facility-theme",facility:this.facility},this.dialog.open(ie.Y,i).afterClosed().subscribe(a=>{a&&this.router.navigate([""],{queryParamsHandling:"preserve"})})}}j.\u0275fac=function(i){return new(i||j)(t.Y36(r.uw),t.Y36(_.IQ),t.Y36(y.gz),t.Y36(te.D),t.Y36(ee.V),t.Y36(d.x4),t.Y36(y.F0),t.Y36(d.fb),t.Y36(se.G))},j.\u0275cmp=t.Xpm({type:j,selectors:[["app-facility-detail-page"]],features:[t.qOj],decls:4,vars:2,consts:[[1,"container-fluid","ps-xl-5","pe-xl-5","facility-theme"],["class","me-auto ms-auto",4,"ngIf"],[4,"ngIf"],[1,"me-auto","ms-auto"],[1,"d-flex","page-title-headtitle"],["svgIcon","perun-facility-black",1,"perun-icon","perun-icon-detail",3,"matTooltip","ngStyle"],[1,"page-title-block"],[1,"page-title-headline","d-flex","align-items-center"],[1,"facility-link",3,"perunWebAppsMiddleClickRouterLink","routerLink","auxclick"],[1,"text-muted"],["mat-icon-button","",3,"click",4,"ngIf"],[1,"mt-1","entity-info"],["mat-icon-button","",3,"click"]],template:function(i,e){1&i&&(t.TgZ(0,"div",0),t._UZ(1,"perun-web-apps-back-button"),t.YNc(2,le,1,0,"mat-spinner",1),t.YNc(3,de,17,22,"div",2),t.qZA()),2&i&&(t.xp6(2),t.Q6J("ngIf",e.loading),t.xp6(1),t.Q6J("ngIf",!e.loading&&void 0!==e.facility))},dependencies:[m.O5,m.PC,y.rH,K.Hw,T.RK,Rt.Ou,vt.gM,Ht.A,oe.W,M.YH,M.QG,h.X$],data:{animation:[Ot.Ji]}});var Qt=l(71135);function ue(s,i){1&s&&t._UZ(0,"mat-spinner",2)}function _e(s,i){if(1&s&&(t.TgZ(0,"div"),t._UZ(1,"perun-web-apps-menu-buttons-field",3),t.qZA()),2&s){const e=t.oxw();t.xp6(1),t.Q6J("items",e.navItems)("size","small")}}class ${constructor(i,e,a,n){this.facilityManager=i,this.authResolver=e,this.entityStorageService=a,this.routePolicyService=n,this.navItems=[],this.loading=!1}ngOnInit(){this.loading=!0,this.facility=this.entityStorageService.getEntity(),this.initItems(),this.loading=!1}initItems(){this.navItems=[],this.routePolicyService.canNavigate("facilities-resources",this.facility)&&this.navItems.push({cssIcon:"perun-manage-facility",url:`/facilities/${this.facility.id}/resources`,label:"MENU_ITEMS.FACILITY.RESOURCES",style:"facility-btn"}),this.routePolicyService.canNavigate("facilities-allowed-users",this.facility)&&this.navItems.push({cssIcon:"perun-user",url:`/facilities/${this.facility.id}/allowed-users`,label:"MENU_ITEMS.FACILITY.ALLOWED_USERS",style:"facility-btn"}),this.routePolicyService.canNavigate("facilities-allowed-groups",this.facility)&&this.navItems.push({cssIcon:"perun-group",url:`/facilities/${this.facility.id}/allowed-groups`,label:"MENU_ITEMS.FACILITY.ALLOWED_GROUPS",style:"facility-btn"}),this.routePolicyService.canNavigate("facilities-services-status",this.facility)&&this.navItems.push({cssIcon:"perun-service-status",url:`/facilities/${this.facility.id}/services-status`,label:"MENU_ITEMS.FACILITY.SERVICES_STATUS",style:"facility-btn"}),this.routePolicyService.canNavigate("facilities-services-destinations",this.facility)&&this.navItems.push({cssIcon:"perun-service_destination",url:`/facilities/${this.facility.id}/services-destinations`,label:"MENU_ITEMS.FACILITY.SERVICES_DESTINATIONS",style:"facility-btn"}),this.routePolicyService.canNavigate("facilities-hosts",this.facility)&&this.navItems.push({cssIcon:"perun-hosts",url:`/facilities/${this.facility.id}/hosts`,label:"MENU_ITEMS.FACILITY.HOSTS",style:"facility-btn"}),this.routePolicyService.canNavigate("facilities-attributes",this.facility)&&this.navItems.push({cssIcon:"perun-attributes",url:`/facilities/${this.facility.id}/attributes`,label:"MENU_ITEMS.FACILITY.ATTRIBUTES",style:"facility-btn"}),this.routePolicyService.canNavigate("facilities-settings",this.facility)&&this.navItems.push({cssIcon:"perun-settings2",url:`/facilities/${this.facility.id}/settings`,label:"MENU_ITEMS.FACILITY.SETTINGS",style:"facility-btn"})}}$.\u0275fac=function(i){return new(i||$)(t.Y36(_.IQ),t.Y36(d.x4),t.Y36(d.fb),t.Y36(d.Ip))},$.\u0275cmp=t.Xpm({type:$,selectors:[["app-facility-overview"]],hostVars:2,hostBindings:function(i,e){2&i&&t.ekj("router-component",e.true)},decls:2,vars:2,consts:[["class","me-auto ms-auto",4,"ngIf"],[4,"ngIf"],[1,"me-auto","ms-auto"],[3,"items","size"]],template:function(i,e){1&i&&(t.YNc(0,ue,1,0,"mat-spinner",0),t.YNc(1,_e,2,2,"div",1)),2&i&&(t.Q6J("ngIf",e.loading),t.xp6(1),t.Q6J("ngIf",!e.loading))},dependencies:[m.O5,Rt.Ou,Qt.L]});var me=l(34904),he=l(37380),fe=l(98918),ge=l(4675);class z{}function Te(s,i){1&s&&t._UZ(0,"mat-spinner",2)}function Se(s,i){if(1&s&&(t.TgZ(0,"div"),t._UZ(1,"perun-web-apps-menu-buttons-field",3),t.qZA()),2&s){const e=t.oxw();t.xp6(1),t.Q6J("items",e.items)("size","small")}}z.\u0275fac=function(i){return new(i||z)},z.\u0275cmp=t.Xpm({type:z,selectors:[["app-facility-settings"]],hostVars:2,hostBindings:function(i,e){2&i&&t.ekj("router-component",e.true)},decls:1,vars:0,template:function(i,e){1&i&&t._UZ(0,"app-animated-router-outlet")},dependencies:[Ht.A],data:{animation:[Ot.Ji]}});class X{constructor(i,e,a,n){this.facilityManager=i,this.authResolver=e,this.entityStorageService=a,this.routePolicyService=n,this.items=[],this.loading=!1}ngOnInit(){this.loading=!0,this.facility=this.entityStorageService.getEntity(),this.initItems(),this.loading=!1}initItems(){this.items=[],this.routePolicyService.canNavigate("facilities-settings-owners",this.facility)&&this.items.push({cssIcon:"perun-owner-grey",url:`/facilities/${this.facility.id}/settings/owners`,label:"MENU_ITEMS.FACILITY.OWNERS",style:"facility-btn"}),this.routePolicyService.canNavigate("facilities-settings-managers",this.facility)&&this.items.push({cssIcon:"perun-manager",url:`/facilities/${this.facility.id}/settings/managers`,label:"MENU_ITEMS.FACILITY.MANAGERS",style:"facility-btn"}),this.routePolicyService.canNavigate("facilities-settings-security-teams",this.facility)&&this.items.push({cssIcon:"perun-security-teams",url:`/facilities/${this.facility.id}/settings/security-teams`,label:"MENU_ITEMS.FACILITY.SECURITY_TEAMS",style:"facility-btn"}),this.routePolicyService.canNavigate("facilities-settings-blacklist",this.facility)&&this.items.push({cssIcon:"perun-black-list",url:`/facilities/${this.facility.id}/settings/blacklist`,label:"MENU_ITEMS.FACILITY.BLACKLIST",style:"facility-btn"}),this.routePolicyService.canNavigate("facilities-settings-bans",this.facility)&&this.items.push({cssIcon:"perun-ban",url:`/facilities/${this.facility.id}/settings/bans`,label:"MENU_ITEMS.FACILITY.BANS",style:"facility-btn"})}}X.\u0275fac=function(i){return new(i||X)(t.Y36(_.IQ),t.Y36(d.x4),t.Y36(d.fb),t.Y36(d.Ip))},X.\u0275cmp=t.Xpm({type:X,selectors:[["app-facility-settings-overview"]],hostVars:2,hostBindings:function(i,e){2&i&&t.ekj("router-component",e.true)},decls:2,vars:2,consts:[["class","me-auto ms-auto",4,"ngIf"],[4,"ngIf"],[1,"me-auto","ms-auto"],[3,"items","size"]],template:function(i,e){1&i&&(t.YNc(0,Te,1,0,"mat-spinner",0),t.YNc(1,Se,2,2,"div",1)),2&i&&(t.Q6J("ngIf",e.loading),t.xp6(1),t.Q6J("ngIf",!e.loading))},dependencies:[m.O5,Rt.Ou,Qt.L]});var xt=l(3848),Ae=l(48323),Ce=l(12651);function be(s,i){1&s&&(t._uU(0),t.ALo(1,"translate")),2&s&&t.hij(" ",t.lcZ(1,1,"FACILITY_DETAIL.ENTITY")," ")}function Ie(s,i){if(1&s&&t._UZ(0,"app-one-entity-attribute-page",5),2&s){const e=t.oxw();t.Q6J("entityId",e.facility.id)("entity","facility")}}function ye(s,i){1&s&&(t._uU(0),t.ALo(1,"translate"),t.ALo(2,"translate")),2&s&&t.AsE(" ",t.lcZ(1,2,"FACILITY_DETAIL.ENTITY")," - ",t.lcZ(2,4,"ADMIN_USER.ENTITY")," ")}function ve(s,i){if(1&s&&t._UZ(0,"app-two-entity-attribute-page",6),2&s){const e=t.oxw(2);t.Q6J("firstEntity","facility")("firstEntityId",e.facility.id)("secondEntity","user")}}function xe(s,i){1&s&&(t.TgZ(0,"mat-tab"),t.YNc(1,ye,3,6,"ng-template",2),t.YNc(2,ve,1,3,"ng-template",3),t.qZA())}class tt{constructor(i,e){this.authResolver=i,this.entityStorageService=e}ngOnInit(){this.facility=this.entityStorageService.getEntity(),this.facilityUserAttAuth=this.authResolver.isAuthorized("getAssignedUsers_Facility_policy",[this.facility])}}tt.\u0275fac=function(i){return new(i||tt)(t.Y36(d.x4),t.Y36(d.fb))},tt.\u0275cmp=t.Xpm({type:tt,selectors:[["app-facility-attributes"]],hostVars:2,hostBindings:function(i,e){2&i&&t.ekj("router-component",e.true)},decls:9,vars:4,consts:[[1,"page-subtitle"],["mat-stretch-tabs","false"],["matTabLabel",""],["matTabContent",""],[4,"ngIf"],[3,"entityId","entity"],[3,"firstEntity","firstEntityId","secondEntity"]],template:function(i,e){1&i&&(t.TgZ(0,"div")(1,"h1",0),t._uU(2),t.ALo(3,"translate"),t.qZA(),t.TgZ(4,"mat-tab-group",1)(5,"mat-tab"),t.YNc(6,be,2,3,"ng-template",2),t.YNc(7,Ie,1,2,"ng-template",3),t.qZA(),t.YNc(8,xe,3,0,"mat-tab",4),t.qZA()()),2&i&&(t.xp6(2),t.Oqu(t.lcZ(3,2,"FACILITY_DETAIL.SETTINGS.ATTRIBUTES.TITLE")),t.xp6(6),t.Q6J("ngIf",e.facilityUserAttAuth))},dependencies:[m.O5,xt.Vc,xt.uD,xt.uX,xt.SP,Ae.Y,Ce.t,h.X$]});var Le=l(60113),Ee=l(16500),De=l(92090),Ze=l(258),g=l(24006),Lt=l(68675),Et=l(54004),et=l(22395),qt=l(47957),Pt=l(3238),Nt=l(284),w=l(59549),k=l(56709),Vt=l(31359);function Oe(s,i){if(1&s){const e=t.EpF();t.TgZ(0,"mat-option",10),t.NdJ("onSelectionChange",function(){const o=t.CHM(e).$implicit,u=t.oxw(3);return t.KtG(u.onSelectedService(o))}),t._uU(1),t.qZA()}if(2&s){const e=i.$implicit;t.Q6J("value",e),t.xp6(1),t.hij(" ",e.name," ")}}function Re(s,i){if(1&s){const e=t.EpF();t.TgZ(0,"mat-form-field",6)(1,"mat-label"),t._uU(2),t.ALo(3,"translate"),t.qZA(),t.TgZ(4,"input",7),t.NdJ("keyup",function(n){t.CHM(e);const o=t.oxw(2);return t.KtG(o.updatedSerVal(n))}),t.qZA(),t.TgZ(5,"mat-autocomplete",8,9)(7,"mat-option",10),t.NdJ("onSelectionChange",function(){t.CHM(e);const n=t.oxw(2);return t.KtG(n.onSelectedService("NOT_SELECTED"))}),t._uU(8),t.ALo(9,"translate"),t.qZA(),t.TgZ(10,"mat-option",10),t.NdJ("onSelectionChange",function(){t.CHM(e);const n=t.oxw(2);return t.KtG(n.onSelectedService("ALL"))}),t._uU(11),t.ALo(12,"translate"),t.qZA(),t.YNc(13,Oe,2,2,"mat-option",11),t.ALo(14,"async"),t.qZA()()}if(2&s){const e=t.MAs(6),a=t.oxw(2);t.xp6(2),t.Oqu(t.lcZ(3,9,"FACILITY_DETAIL.SERVICE_CONFIG.SERVICE_SELECT")),t.xp6(2),t.Q6J("formControl",a.serviceField)("matAutocomplete",e),t.xp6(1),t.Q6J("displayWith",a.serviceDisplayFn.bind(a)),t.xp6(2),t.Q6J("value","NOT_SELECTED"),t.xp6(1),t.hij(" ",t.lcZ(9,11,"FACILITY_DETAIL.SERVICE_CONFIG.NOT_SELECTED")," "),t.xp6(2),t.Q6J("value","ALL"),t.xp6(1),t.hij(" ",t.lcZ(12,13,"FACILITY_DETAIL.SERVICE_CONFIG.ALL")," "),t.xp6(2),t.Q6J("ngForOf",t.lcZ(14,15,a.filteredServices))}}function Ne(s,i){if(1&s){const e=t.EpF();t.TgZ(0,"mat-option",10),t.NdJ("onSelectionChange",function(){const o=t.CHM(e).$implicit,u=t.oxw(3);return t.KtG(u.onSelectedResource(o))}),t._uU(1),t.qZA()}if(2&s){const e=i.$implicit;t.Q6J("value",e),t.xp6(1),t.hij(" ",e.name," ")}}function Fe(s,i){if(1&s){const e=t.EpF();t.TgZ(0,"mat-form-field",6)(1,"mat-label"),t._uU(2),t.ALo(3,"translate"),t.qZA(),t.TgZ(4,"input",7),t.NdJ("keyup",function(n){t.CHM(e);const o=t.oxw(2);return t.KtG(o.updatedResVal(n))}),t.qZA(),t.TgZ(5,"mat-autocomplete",8,9),t.YNc(7,Ne,2,2,"mat-option",11),t.ALo(8,"async"),t.qZA()()}if(2&s){const e=t.MAs(6),a=t.oxw(2);t.xp6(2),t.Oqu(t.lcZ(3,5,"FACILITY_DETAIL.SERVICE_CONFIG.RES_SELECT")),t.xp6(2),t.Q6J("formControl",a.resourceField)("matAutocomplete",e),t.xp6(1),t.Q6J("displayWith",a.resourceDisplayFn.bind(a)),t.xp6(2),t.Q6J("ngForOf",t.lcZ(8,7,a.filteredResources))}}function we(s,i){if(1&s){const e=t.EpF();t.TgZ(0,"mat-option",10),t.NdJ("onSelectionChange",function(){const o=t.CHM(e).$implicit,u=t.oxw(3);return t.KtG(u.onSelectedGroup(o))}),t._uU(1),t.qZA()}if(2&s){const e=i.$implicit;t.Q6J("value",e),t.xp6(1),t.hij(" ",e.name," ")}}function ke(s,i){if(1&s){const e=t.EpF();t.TgZ(0,"mat-form-field",6)(1,"mat-label"),t._uU(2),t.ALo(3,"translate"),t.qZA(),t.TgZ(4,"input",7),t.NdJ("keyup",function(n){t.CHM(e);const o=t.oxw(2);return t.KtG(o.updatedGroupVal(n))}),t.qZA(),t.TgZ(5,"mat-autocomplete",12,9),t.YNc(7,we,2,2,"mat-option",11),t.ALo(8,"async"),t.qZA()()}if(2&s){const e=t.MAs(6),a=t.oxw(2);t.xp6(2),t.Oqu(t.lcZ(3,5,"FACILITY_DETAIL.SERVICE_CONFIG.GROUP_SELECT")),t.xp6(2),t.Q6J("formControl",a.groupField)("matAutocomplete",e),t.xp6(1),t.Q6J("displayWith",a.groupDisplayFn.bind(a)),t.xp6(2),t.Q6J("ngForOf",t.lcZ(8,7,a.filteredGroups))}}function Ye(s,i){if(1&s){const e=t.EpF();t.TgZ(0,"mat-option",10),t.NdJ("onSelectionChange",function(){const o=t.CHM(e).$implicit,u=t.oxw(3);return t.KtG(u.onSelectedMember(o))}),t._uU(1),t.ALo(2,"userFullName"),t.qZA()}if(2&s){const e=i.$implicit;t.Q6J("value",e),t.xp6(1),t.hij(" ",t.lcZ(2,2,e.user)," ")}}function Ue(s,i){if(1&s&&(t.TgZ(0,"mat-form-field",6)(1,"mat-label"),t._uU(2),t.ALo(3,"translate"),t.qZA(),t._UZ(4,"input",13),t.TgZ(5,"mat-autocomplete",8,9),t.YNc(7,Ye,3,4,"mat-option",11),t.ALo(8,"async"),t.qZA()()),2&s){const e=t.MAs(6),a=t.oxw(2);t.xp6(2),t.Oqu(t.lcZ(3,5,"FACILITY_DETAIL.SERVICE_CONFIG.MEMBER_SELECT")),t.xp6(2),t.Q6J("matAutocomplete",e)("formControl",a.memberField),t.xp6(1),t.Q6J("displayWith",a.memberDisplayFn.bind(a)),t.xp6(2),t.Q6J("ngForOf",t.lcZ(8,7,a.filteredMembers))}}function Me(s,i){if(1&s){const e=t.EpF();t.TgZ(0,"div",3),t.YNc(1,Re,15,17,"mat-form-field",4),t.TgZ(2,"mat-checkbox",5),t.NdJ("change",function(n){t.CHM(e);const o=t.oxw();return t.KtG(o.onOfferAllServices(n))}),t._uU(3),t.ALo(4,"translate"),t.qZA(),t.YNc(5,Fe,9,9,"mat-form-field",4),t.YNc(6,ke,9,9,"mat-form-field",4),t.YNc(7,Ue,9,9,"mat-form-field",4),t.qZA()}if(2&s){const e=t.oxw();t.xp6(1),t.Q6J("ngIf",void 0!==e.services),t.xp6(2),t.hij(" ",t.lcZ(4,5,"FACILITY_DETAIL.SERVICE_CONFIG.ALL_SERVICES")," "),t.xp6(2),t.Q6J("ngIf",void 0!==e.resources&&0!==e.resources.length),t.xp6(1),t.Q6J("ngIf",void 0!==e.selectedResource&&void 0!==e.groups&&0!==e.groups.length),t.xp6(1),t.Q6J("ngIf",void 0!==e.selectedGroup&&void 0!==e.members&&0!==e.members.length)}}function Je(s,i){if(1&s&&t._UZ(0,"perun-web-apps-service-configurator",14),2&s){const e=t.oxw();t.Q6J("facility",e.facility)("resource",e.selectedResource)("group",e.selectedGroup)("member",e.selectedMember)("service",e.selectedService)}}class it{constructor(i,e,a,n,o,u,f){this.facilityManager=i,this.resourceManager=e,this.serviceManager=a,this.membersManager=n,this.namePipe=o,this.translate=u,this.entityStorageService=f,this.serviceField=new g.p4,this.resourceField=new g.p4,this.groupField=new g.p4,this.memberField=new g.p4,this.allowedStatuses=["INVALID","VALID"],this.selectedService="NOT_SELECTED",this.attrNames=[],this.translate.get("FACILITY_DETAIL.SERVICE_CONFIG.ALL").subscribe(b=>this.serviceAllTranslation=b),this.translate.get("FACILITY_DETAIL.SERVICE_CONFIG.NOT_SELECTED").subscribe(b=>this.serviceNotSelectedTranslation=b)}ngOnInit(){this.facility=this.entityStorageService.getEntity(),this.facilityManager.getFacilityById(this.facility.id).subscribe(i=>{this.facility=i,this.facilityManager.getAssignedResourcesForFacility(i.id).subscribe(e=>this.resources=e),this.serviceManager.getAssignedServices(i.id).subscribe(e=>this.services=e)}),this.filteredServices=this.serviceField.valueChanges.pipe((0,Lt.O)(""),(0,Et.U)(i=>this._filterServices(i))),this.filteredResources=this.resourceField.valueChanges.pipe((0,Lt.O)(""),(0,Et.U)(i=>this._filterResources(i))),this.filteredGroups=this.groupField.valueChanges.pipe((0,Lt.O)(""),(0,Et.U)(i=>this._filterGroups(i))),this.filteredMembers=this.memberField.valueChanges.pipe((0,Lt.O)(""),(0,Et.U)(i=>this._filterMembers(i)))}onSelectedService(i){this.selectedService=i}onSelectedResource(i){this.selectedResource=i,void 0!==this.selectedResource?(this.resourceManager.getAssignedGroups(this.selectedResource.id).subscribe(e=>this.groups=e),this.selectedGroup=void 0,this.selectedMember=void 0):this.groups=void 0}onOfferAllServices(i){i.checked||this.serviceManager.getAssignedServices(this.facility.id).subscribe(e=>this.services=e)}onSelectedGroup(i){this.selectedGroup=i,void 0!==this.selectedGroup?(this.membersManager.getCompleteRichMembersForGroup(this.selectedGroup.id,!1,this.allowedStatuses,[],this.attrNames).subscribe(e=>this.members=e),this.selectedMember=void 0):this.members=void 0}onSelectedMember(i){this.selectedMember=i}serviceDisplayFn(i){if(null!==i)return"ALL"===i?this.serviceAllTranslation:"NOT_SELECTED"===i?this.serviceNotSelectedTranslation:"string"!=typeof i?i.name:i}resourceDisplayFn(i){if(null!==i)return i.name}groupDisplayFn(i){if(null!==i)return i.name}memberDisplayFn(i){if(null!==i)return this.namePipe.transform(i.user)}updatedSerVal(i){""===i.target.value&&(this.selectedService="NOT_SELECTED")}updatedResVal(i){""===i.target.value&&(this.groups=void 0,this.members=void 0)}updatedGroupVal(i){""===i.target.value&&(this.members=void 0)}_filterServices(i){const e=i.toString().toLowerCase();return this.services.filter(a=>a.name.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").includes(e))}_filterResources(i){const e=i.toString().toLowerCase();return this.resources.filter(a=>a.name.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").includes(e))}_filterGroups(i){const e=i.toString().toLowerCase();return this.groups.filter(a=>a.name.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").includes(e))}_filterMembers(i){const e=i.toString().toLowerCase();return this.members.filter(a=>this.namePipe.transform(a.user).toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").includes(e))}}it.\u0275fac=function(i){return new(i||it)(t.Y36(_.IQ),t.Y36(_.xk),t.Y36(_.KK),t.Y36(_.uq),t.Y36(et.dp),t.Y36(h.sK),t.Y36(d.fb))},it.\u0275cmp=t.Xpm({type:it,selectors:[["app-facility-service-config"]],decls:6,vars:5,consts:[[1,"page-subtitle"],["class","col-12 col-lg-6 mb-2",4,"ngIf"],[3,"facility","resource","group","member","service",4,"ngIf"],[1,"col-12","col-lg-6","mb-2"],["class","w-100",4,"ngIf"],[3,"change"],[1,"w-100"],["matInput","","type","text",3,"formControl","matAutocomplete","keyup"],["autoActiveFirstOption","",3,"displayWith"],["auto","matAutocomplete"],[3,"value","onSelectionChange"],[3,"value","onSelectionChange",4,"ngFor","ngForOf"],["autoActiveFirstOption","",3,"displayWith","ngClass"],["matInput","","type","text",3,"matAutocomplete","formControl"],[3,"facility","resource","group","member","service"]],template:function(i,e){1&i&&(t.TgZ(0,"div")(1,"h1",0),t._uU(2),t.ALo(3,"translate"),t.qZA(),t.YNc(4,Me,8,7,"div",1),t.YNc(5,Je,1,5,"perun-web-apps-service-configurator",2),t.qZA()),2&i&&(t.xp6(2),t.Oqu(t.lcZ(3,3,"FACILITY_DETAIL.SERVICE_CONFIG.TITLE")),t.xp6(2),t.Q6J("ngIf",!!e.facility),t.xp6(1),t.Q6J("ngIf",!!e.facility))},dependencies:[m.mk,m.sg,m.O5,qt.XC,Pt.ey,qt.ZL,Nt.Nt,w.KE,w.hX,g.Fj,g.JJ,g.oH,k.oG,m.Ov,h.X$,Vt.d]});var Bt=l(28361);class Q{constructor(i,e,a){this.facilityService=i,this.guiAuthResolver=e,this.entityStorageService=a,this.disableRouting=!1,this.disableSelf=!1,this.availableRoles=[],this.selected="user",this.type="Facility",this.theme="facility-theme"}ngOnInit(){this.facility=this.entityStorageService.getEntity(),this.guiAuthResolver.assignAvailableRoles(this.availableRoles,"Facility")}}Q.\u0275fac=function(i){return new(i||Q)(t.Y36(_.IQ),t.Y36(d.x4),t.Y36(d.fb))},Q.\u0275cmp=t.Xpm({type:Q,selectors:[["app-perun-web-apps-facility-settings-managers"]],hostVars:2,hostBindings:function(i,e){2&i&&t.ekj("router-component",e.true)},inputs:{disableRouting:"disableRouting",disableSelf:"disableSelf"},decls:1,vars:6,consts:[[3,"complementaryObject","availableRoles","complementaryObjectType","disableSelf","disableRouting","theme"]],template:function(i,e){1&i&&t._UZ(0,"app-managers-page",0),2&i&&t.Q6J("complementaryObject",e.facility)("availableRoles",e.availableRoles)("complementaryObjectType",e.type)("disableSelf",e.disableSelf)("disableRouting",e.disableRouting)("theme",e.theme)},dependencies:[Bt.s]});var v=l(15466),S=l(95017),He=l(89466),Ge=l(84385),Y=l(97403),A=l(73358);function Qe(s,i){1&s&&t._UZ(0,"perun-web-apps-loading-dialog")}function qe(s,i){1&s&&(t.TgZ(0,"mat-option",18),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&s&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"DIALOGS.ADD_SERVICE_DESTINATION.SELECTION_ALL")))}function Pe(s,i){1&s&&(t.TgZ(0,"mat-option",19),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&s&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"DIALOGS.ADD_SERVICE_DESTINATION.NO_SERVICE")))}function Ve(s,i){if(1&s&&(t.TgZ(0,"mat-option",20),t._uU(1),t.qZA()),2&s){const e=i.$implicit;t.Q6J("value",e),t.xp6(1),t.hij(" ",e.name," ")}}function Be(s,i){1&s&&(t.TgZ(0,"mat-error"),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&s&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"DIALOGS.ADD_SERVICE_DESTINATION.CHOOSE_SERVICE")," "))}function We(s,i){if(1&s&&(t.TgZ(0,"mat-option",20),t._uU(1),t.qZA()),2&s){const e=i.$implicit,a=t.oxw(2);t.Q6J("value",e),t.xp6(1),t.hij(" ",a.getTypeForView(e)," ")}}function Ke(s,i){1&s&&(t.TgZ(0,"mat-error"),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&s&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"DIALOGS.ADD_SERVICE_DESTINATION.REQUIRED_FIELD")," "))}function je(s,i){1&s&&(t.TgZ(0,"mat-error"),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&s&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"DIALOGS.ADD_SERVICE_DESTINATION.INVALID_DESTINATION")," "))}function $e(s,i){if(1&s&&(t.TgZ(0,"mat-form-field",21)(1,"mat-label"),t._uU(2),t.qZA(),t._UZ(3,"input",22),t.YNc(4,Ke,3,3,"mat-error",9),t.YNc(5,je,3,3,"mat-error",9),t.qZA()),2&s){const e=t.oxw(2);t.xp6(2),t.Oqu(e.getTypeForView(e.selectedType)),t.xp6(1),t.Q6J("formControl",e.destinationControl),t.xp6(1),t.Q6J("ngIf","host"===e.selectedType&&!e.useFacilityHost&&e.destinationControl.hasError("required")),t.xp6(1),t.Q6J("ngIf",e.destinationControl.hasError("invalidDestination"))}}function ze(s,i){if(1&s){const e=t.EpF();t.TgZ(0,"mat-checkbox",14),t.NdJ("ngModelChange",function(n){t.CHM(e);const o=t.oxw(2);return t.KtG(o.useFacilityHost=n)}),t._uU(1),t.ALo(2,"translate"),t.qZA()}if(2&s){const e=t.oxw(2);t.Q6J("ngModel",e.useFacilityHost),t.xp6(1),t.hij(" ",t.lcZ(2,2,"DIALOGS.ADD_SERVICE_DESTINATION.USE_FACILITY_HOST")," ")}}function Xe(s,i){if(1&s&&(t.TgZ(0,"mat-option",20),t._uU(1),t.qZA()),2&s){const e=i.$implicit;t.Q6J("value",e),t.xp6(1),t.hij(" ",e," ")}}function ti(s,i){if(1&s){const e=t.EpF();t.TgZ(0,"div")(1,"h1",2),t._uU(2),t.ALo(3,"translate"),t.qZA(),t.TgZ(4,"div",3)(5,"div",4),t._uU(6),t.ALo(7,"translate"),t.qZA(),t.TgZ(8,"mat-form-field")(9,"mat-label"),t._uU(10),t.ALo(11,"translate"),t.qZA(),t.TgZ(12,"mat-select",5),t.YNc(13,qe,3,3,"mat-option",6),t.YNc(14,Pe,3,3,"mat-option",7),t.YNc(15,Ve,2,2,"mat-option",8),t.qZA(),t.YNc(16,Be,3,3,"mat-error",9),t.qZA(),t.TgZ(17,"mat-checkbox",10),t.NdJ("change",function(){t.CHM(e);const n=t.oxw();return t.KtG(n.getServices())})("ngModelChange",function(n){t.CHM(e);const o=t.oxw();return t.KtG(o.servicesOnFacility=n)}),t._uU(18),t.ALo(19,"translate"),t.qZA(),t.TgZ(20,"mat-form-field")(21,"mat-label"),t._uU(22),t.ALo(23,"translate"),t.qZA(),t.TgZ(24,"mat-select",11),t.NdJ("ngModelChange",function(n){t.CHM(e);const o=t.oxw();return t.KtG(o.selectedType=n)})("selectionChange",function(){t.CHM(e);const n=t.oxw();return t.KtG(n.destinationControl.updateValueAndValidity())}),t.YNc(25,We,2,2,"mat-option",8),t.qZA()(),t.YNc(26,$e,6,4,"mat-form-field",12),t.YNc(27,ze,3,4,"mat-checkbox",13),t.TgZ(28,"mat-form-field")(29,"mat-label"),t._uU(30),t.ALo(31,"translate"),t.qZA(),t.TgZ(32,"mat-select",14),t.NdJ("ngModelChange",function(n){t.CHM(e);const o=t.oxw();return t.KtG(o.selectedPropagation=n)}),t.YNc(33,Xe,2,2,"mat-option",8),t.qZA()(),t.TgZ(34,"div",4),t._uU(35),t.ALo(36,"translate"),t.qZA()(),t.TgZ(37,"div",15)(38,"button",16),t.NdJ("click",function(){t.CHM(e);const n=t.oxw();return t.KtG(n.onCancel())}),t._uU(39),t.ALo(40,"translate"),t.qZA(),t.TgZ(41,"button",17),t.NdJ("click",function(){t.CHM(e);const n=t.oxw();return t.KtG(n.onSubmit())}),t._uU(42),t.ALo(43,"translate"),t.qZA()()()}if(2&s){const e=t.oxw();t.xp6(2),t.Oqu(t.lcZ(3,22,"DIALOGS.ADD_SERVICE_DESTINATION.TITLE")),t.xp6(4),t.Oqu(t.lcZ(7,24,"DIALOGS.ADD_SERVICE_DESTINATION.DESCRIPTION")),t.xp6(4),t.Oqu(t.lcZ(11,26,"DIALOGS.ADD_SERVICE_DESTINATION.SERVICE")),t.xp6(2),t.Q6J("formControl",e.serviceControl),t.xp6(1),t.Q6J("ngIf",0!==e.services.length),t.xp6(1),t.Q6J("ngIf",0===e.services.length),t.xp6(1),t.Q6J("ngForOf",e.services),t.xp6(1),t.Q6J("ngIf",void 0===e.serviceControl.value),t.xp6(1),t.Q6J("ngModel",e.servicesOnFacility),t.xp6(1),t.hij(" ",t.lcZ(19,28,"DIALOGS.ADD_SERVICE_DESTINATION.IS_SERVICES_ONLY_ON_FACILITY")," "),t.xp6(4),t.Oqu(t.lcZ(23,30,"DIALOGS.ADD_SERVICE_DESTINATION.TYPE")),t.xp6(2),t.Q6J("ngModel",e.selectedType),t.xp6(1),t.Q6J("ngForOf",e.types),t.xp6(1),t.Q6J("ngIf",!("host"===e.selectedType&&e.useFacilityHost)),t.xp6(1),t.Q6J("ngIf","host"===e.selectedType),t.xp6(3),t.Oqu(t.lcZ(31,32,"DIALOGS.ADD_SERVICE_DESTINATION.PROPAGATION")),t.xp6(2),t.Q6J("ngModel",e.selectedPropagation),t.xp6(1),t.Q6J("ngForOf",e.propagations),t.xp6(2),t.hij(" ",t.lcZ(36,34,"DIALOGS.ADD_SERVICE_DESTINATION.PROPAGATION_TYPE_"+e.selectedPropagation)," "),t.xp6(4),t.hij(" ",t.lcZ(40,36,"DIALOGS.ADD_SERVICE_DESTINATION.CANCEL")," "),t.xp6(2),t.Q6J("disabled",e.loading||e.invalidDestination()||e.serviceControl.invalid||"noService"===e.serviceControl.value),t.xp6(1),t.hij(" ",t.lcZ(43,38,"DIALOGS.ADD_SERVICE_DESTINATION.ADD")," ")}}class st{constructor(i,e,a,n){this.dialogRef=i,this.data=e,this.facilitiesManager=a,this.servicesManager=n,this.services=[],this.types=["host","user@host","user@host:port","user@host-windows","host-windows-proxy","url","email","semail","service-specific"],this.selectedType="host",this.propagations=["PARALLEL","DUMMY"],this.selectedPropagation="PARALLEL",this.useFacilityHost=!1,this.loading=!1,this.emailRegex=new RegExp(p.B2),this.hostPattern=new RegExp("^(?!:\\/\\/)(?=.{1,255}$)((.{1,63}\\.){1,127}(?![0-9]*$)[a-z0-9-]+\\.?)$|^(25[0-5]|2[0-4]\\d|[0-1]?\\d?\\d)(\\.(25[0-5]|2[0-4]\\d|[0-1]?\\d?\\d)){3}$"),this.urlPattern=new RegExp("^(https?|ftp|file)://[-a-zA-Z0-9+&@#/%?=~_|!:,.;()*$']*[-a-zA-Z0-9+&@#/%=~_|()*$']$"),this.userAtHostPattern=new RegExp("^[a-z_]([a-z0-9_-]{0,31}|[a-z0-9_-]{0,30}\\$)@(?:(?!:\\/\\/)(?=.{1,255}$)((.{1,63}\\.){1,127}(?![0-9]*$)[a-z0-9-]+\\.?)$|(25[0-5]|2[0-4]\\d|[0-1]?\\d?\\d)(\\.(25[0-5]|2[0-4]\\d|[0-1]?\\d?\\d)){3}$)"),this.userAtHostPortPattern=new RegExp("^[a-z_]([a-z0-9_-]{0,31}|[a-z0-9_-]{0,30}\\$)@(?:(?!:\\/\\/)(?=.{1,255}$)((.{1,63}\\.){1,127}(?![0-9]*$)[a-z0-9-]+\\.?)|(25[0-5]|2[0-4]\\d|[0-1]?\\d?\\d)(\\.(25[0-5]|2[0-4]\\d|[0-1]?\\d?\\d)){3}):[0-9]+"),this.serviceSpecificPattern=new RegExp("^(?!-)[a-zA-Z0-9-_.:/]*$")}ngOnInit(){this.serviceControl=new g.p4(void 0,g.kI.required),this.destinationControl=new g.p4("",this.getDestinationValidator()),this.emailControl=new g.p4("",[g.kI.required,g.kI.pattern(this.emailRegex)]),this.servicesOnFacility=!0,this.getServices()}onCancel(){this.dialogRef.close()}onSubmit(){this.loading=!0,"all"===this.serviceControl.value?this.useFacilityHost?this.servicesManager.addDestinationsDefinedByHostsOnFacilityWithListOfServiceAndFacility({services:this.services,facility:this.data.facility.id}).subscribe(()=>{this.dialogRef.close(!0)},()=>this.loading=!1):this.servicesManager.addDestinationToMultipleServices({services:this.services,facility:this.data.facility.id,destination:this.destinationControl.value,type:this.selectedType,propagationType:this.selectedPropagation}).subscribe(()=>{this.dialogRef.close(!0)},()=>this.loading=!1):this.useFacilityHost?this.servicesManager.addDestinationsDefinedByHostsOnFacilityWithServiceAndFacility(this.serviceControl.value.id,this.data.facility.id).subscribe(()=>{this.dialogRef.close(!0)},()=>this.loading=!1):this.servicesManager.addDestination(this.serviceControl.value.id,this.data.facility.id,this.destinationControl.value,this.selectedType,this.selectedPropagation).subscribe(()=>{this.dialogRef.close(!0)},()=>this.loading=!1)}getServices(){this.loading=!0,this.servicesOnFacility?0!==this.data.configServices.length?this.services=this.data.configServices:this.servicesManager.getAssignedServices(this.data.facility.id).subscribe(i=>{this.services=i},()=>this.loading=!1):this.servicesManager.getServices().subscribe(i=>{this.services=i},()=>this.loading=!1),this.loading=!1,this.serviceControl.setValue(void 0)}getTypeForView(i){return"semail"===i?"Send Mail":"service-specific"===i?"Service Specific":i}invalidDestination(){return("host"!==this.selectedType||!this.useFacilityHost)&&this.destinationControl.invalid}getDestinationValidator(){return i=>{if(!i.value)return null;let e;switch(this.selectedType){case"host":case"host-windows-proxy":e=this.hostPattern;break;case"email":case"semail":e=this.emailRegex;break;case"url":e=this.urlPattern;break;case"user@host":case"user@host-windows":e=this.userAtHostPattern;break;case"user@host:port":e=this.userAtHostPortPattern;break;case"service-specific":e=this.serviceSpecificPattern;break;default:return null}return e.test(i.value)?null:{invalidDestination:{value:i.value}}}}}st.\u0275fac=function(i){return new(i||st)(t.Y36(r.so),t.Y36(r.WI),t.Y36(_.IQ),t.Y36(_.KK))},st.\u0275cmp=t.Xpm({type:st,selectors:[["app-perun-web-apps-add-services-destination-dialog"]],decls:4,vars:5,consts:[["spinner",""],[4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],["mat-dialog-title",""],["mat-dialog-content","",1,"dialog-container"],[1,"font-italic"],["required","",3,"formControl"],["value","all",4,"ngIf"],["value","noService",4,"ngIf"],[3,"value",4,"ngFor","ngForOf"],[4,"ngIf"],[3,"ngModel","change","ngModelChange"],[3,"ngModel","ngModelChange","selectionChange"],["class","w-100",4,"ngIf"],[3,"ngModel","ngModelChange",4,"ngIf"],[3,"ngModel","ngModelChange"],["mat-dialog-actions",""],["mat-flat-button","",1,"ms-auto",3,"click"],["color","accent","mat-flat-button","",1,"ms-2",3,"disabled","click"],["value","all"],["value","noService"],[3,"value"],[1,"w-100"],["matInput","","required","",3,"formControl"]],template:function(i,e){if(1&i&&(t.YNc(0,Qe,1,0,"ng-template",null,0,t.W1O),t.TgZ(2,"div"),t.YNc(3,ti,44,40,"div",1),t.qZA()),2&i){const a=t.MAs(1);t.xp6(2),t.Gre("",e.data.theme," position-relative"),t.xp6(1),t.Q6J("perunWebAppsLoader",e.loading)("perunWebAppsLoaderIndicator",a)}},dependencies:[m.sg,m.O5,Pt.ey,Nt.Nt,w.KE,w.hX,w.TO,g.Fj,g.JJ,g.Q7,g.oH,g.On,T.lW,k.oG,r.uh,r.xY,r.H8,Ge.gD,Y.b,A.e,h.X$],data:{animation:[Ot.BQ]}});var Wt=l(70242),U=l(98380),x=l(68530),R=l(96214),N=l(7434);function ei(s,i){1&s&&(t.TgZ(0,"perun-web-apps-alert",10),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&s&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"FACILITY_DETAIL.SERVICES_DESTINATIONS.DESTINATIONS_INFO")," "))}function ii(s,i){if(1&s){const e=t.EpF();t.TgZ(0,"button",11),t.NdJ("click",function(){t.CHM(e);const n=t.oxw();return t.KtG(n.addDestination())}),t._uU(1),t.ALo(2,"translate"),t.qZA()}2&s&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"FACILITY_DETAIL.SERVICES_DESTINATIONS.ADD")," "))}function si(s,i){if(1&s){const e=t.EpF();t.TgZ(0,"button",12),t.NdJ("click",function(){t.CHM(e);const n=t.oxw();return t.KtG(n.removeDestination())}),t._uU(1),t.ALo(2,"translate"),t.qZA()}if(2&s){const e=t.oxw();t.Q6J("disabled",0===e.selected.selected.length),t.xp6(1),t.hij(" ",t.lcZ(2,2,"FACILITY_DETAIL.SERVICES_DESTINATIONS.REMOVE")," ")}}function ai(s,i){if(1&s){const e=t.EpF();t.TgZ(0,"button",13),t.NdJ("click",function(){t.CHM(e);const n=t.oxw();return t.KtG(n.onAllow())}),t.TgZ(1,"mat-icon"),t._uU(2," check_circle_outline "),t.qZA(),t._uU(3),t.ALo(4,"translate"),t.qZA()}if(2&s){const e=t.oxw();t.Q6J("disabled",0===e.selected.selected.length||e.allSelectedAllowed()),t.xp6(3),t.hij(" ",t.lcZ(4,2,"FACILITY_DETAIL.SERVICES_DESTINATIONS.ALLOW")," ")}}function ni(s,i){if(1&s){const e=t.EpF();t.TgZ(0,"button",13),t.NdJ("click",function(){t.CHM(e);const n=t.oxw();return t.KtG(n.onBlock())}),t.TgZ(1,"mat-icon"),t._uU(2," block "),t.qZA(),t._uU(3),t.ALo(4,"translate"),t.qZA()}if(2&s){const e=t.oxw();t.Q6J("disabled",0===e.selected.selected.length||e.allSelectedBlocked()),t.xp6(3),t.hij(" ",t.lcZ(4,2,"FACILITY_DETAIL.SERVICES_DESTINATIONS.BLOCK")," ")}}function oi(s,i){1&s&&t._UZ(0,"perun-web-apps-loading-table")}function li(s,i){if(1&s&&t._UZ(0,"app-perun-web-apps-destination-list",14),2&s){const e=t.oxw();t.Q6J("filterValue",e.filterValue)("selection",e.selected)("destinations",e.destinations)("services",e.configServicesIds)("displayedColumns",e.displayedColumns)("tableId",e.tableId)}}class J{constructor(i,e,a,n,o,u,f,b){this.dialog=i,this.facilitiesManager=e,this.servicesManager=a,this.translate=n,this.notificator=o,this.authResolver=u,this.serviceManager=f,this.entityStorageService=b,this.displayedColumns=["select","destinationId","service","destination","type","status","propagationType"],this.configServices=[],this.configServicesIds=new Set,this.title="FACILITY_DETAIL.SERVICES_DESTINATIONS.TITLE",this.destinationEmitter=new t.vpe,this.destinations=[],this.selected=new S.Ov(!0,[]),this.filterValue="",this.tableId=v.Cf}ngOnInit(){this.loading=!0,this.facility=this.entityStorageService.getEntity(),this.setAuthRights(),this.refreshTable()}refreshTable(){this.loading=!0,this.servicesManager.getAllRichDestinationsForFacility(this.facility.id).subscribe(i=>{this.destinations=i,this.destinationEmitter.emit(this.destinations),this.selected.clear(),this.setAuthRights(),this.loading=!1})}setAuthRights(){this.addAuth=this.authResolver.isAuthorized("addDestination_Service_Facility_Destination_policy",[this.facility]),this.removeAuth=this.authResolver.isAuthorized("removeDestination_Service_Facility_Destination_policy",[this.facility]),this.allowAuth=this.authResolver.isAuthorized("unblockServiceOnDestination_Service_int_policy",[this.facility]),this.blockAuth=this.authResolver.isAuthorized("blockServiceOnDestination_Service_int_policy",[this.facility]),this.displayedColumns=this.removeAuth?this.displayedColumns:this.displayedColumns.filter(i=>"select"!==i)}addDestination(){const i=(0,p.kZ)();i.width="600px",i.data={facility:this.facility,theme:"facility-theme",configServices:this.configServices},this.dialog.open(st,i).afterClosed().subscribe(a=>{a&&(this.refreshTable(),this.notificator.showSuccess(this.translate.instant("FACILITY_DETAIL.SERVICES_DESTINATIONS.ADD_SUCCESS")))})}removeDestination(){const i=(0,p.kZ)();i.width="600px",i.data={destinations:this.selected.selected,theme:"facility-theme"},this.dialog.open(He.u,i).afterClosed().subscribe(a=>{a&&this.refreshTable()})}blockServicesOnDestinations(i){this.serviceManager.blockServicesOnDestinations({richDestinations:i}).subscribe({next:()=>{this.notificator.showSuccess(this.translate.instant("FACILITY_DETAIL.SERVICES_DESTINATIONS.BLOCK_SUCCESS")),this.refreshTable()},error:()=>this.loading=!1})}onBlock(){this.loading=!0,this.blockServicesOnDestinations(this.selected.selected)}allowServicesOnDestinations(i){this.serviceManager.unblockServicesOnDestinations({richDestinations:i}).subscribe({next:()=>{this.notificator.showSuccess(this.translate.instant("FACILITY_DETAIL.SERVICES_DESTINATIONS.ALLOW_SUCCESS")),this.refreshTable()},error:()=>this.loading=!1})}onAllow(){this.loading=!0,this.allowServicesOnDestinations(this.selected.selected)}applyFilter(i){this.filterValue=i}allSelectedAllowed(){return this.selected.selected.reduce((i,e)=>i&&!e.blocked,!0)}allSelectedBlocked(){return this.selected.selected.reduce((i,e)=>i&&e.blocked,!0)}}J.id="FacilityServicesDestinationsComponent",J.\u0275fac=function(i){return new(i||J)(t.Y36(r.uw),t.Y36(_.IQ),t.Y36(_.KK),t.Y36(d.Te),t.Y36(d.V6),t.Y36(d.x4),t.Y36(_.KK),t.Y36(d.fb))},J.\u0275cmp=t.Xpm({type:J,selectors:[["app-perun-web-apps-facility-services-destinations"]],hostVars:2,hostBindings:function(i,e){2&i&&t.ekj("router-component",e.true)},inputs:{displayedColumns:"displayedColumns",configServices:"configServices",configServicesIds:"configServicesIds",title:"title",loading:"loading"},outputs:{destinationEmitter:"destinationEmitter"},decls:15,vars:11,consts:[[1,"page-subtitle"],["alert_type","info",4,"ngIf"],[3,"refresh"],["color","accent","class","me-2 action-button","mat-flat-button","",3,"click",4,"ngIf"],["class","me-2","color","warn","mat-flat-button","",3,"disabled","click",4,"ngIf"],["class","me-2","mat-stroked-button","",3,"disabled","click",4,"ngIf"],[3,"placeholder","filter"],["spinner",""],[1,"position-relative"],[3,"filterValue","selection","destinations","services","displayedColumns","tableId",4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],["alert_type","info"],["color","accent","mat-flat-button","",1,"me-2","action-button",3,"click"],["color","warn","mat-flat-button","",1,"me-2",3,"disabled","click"],["mat-stroked-button","",1,"me-2",3,"disabled","click"],[3,"filterValue","selection","destinations","services","displayedColumns","tableId"]],template:function(i,e){if(1&i&&(t.TgZ(0,"div")(1,"h1",0),t._uU(2),t.ALo(3,"translate"),t.qZA(),t.YNc(4,ei,3,3,"perun-web-apps-alert",1),t.TgZ(5,"perun-web-apps-refresh-button",2),t.NdJ("refresh",function(){return e.refreshTable()}),t.qZA(),t.YNc(6,ii,3,3,"button",3),t.YNc(7,si,3,4,"button",4),t.YNc(8,ai,5,4,"button",5),t.YNc(9,ni,5,4,"button",5),t.TgZ(10,"perun-web-apps-immediate-filter",6),t.NdJ("filter",function(n){return e.applyFilter(n)}),t.qZA(),t.YNc(11,oi,1,0,"ng-template",null,7,t.W1O),t.TgZ(13,"div",8),t.YNc(14,li,1,6,"app-perun-web-apps-destination-list",9),t.qZA()()),2&i){const a=t.MAs(12);t.xp6(2),t.Oqu(t.lcZ(3,9,e.title)),t.xp6(2),t.Q6J("ngIf",e.title.includes("CONFIG")),t.xp6(2),t.Q6J("ngIf",e.addAuth),t.xp6(1),t.Q6J("ngIf",e.removeAuth),t.xp6(1),t.Q6J("ngIf",e.allowAuth),t.xp6(1),t.Q6J("ngIf",e.blockAuth),t.xp6(1),t.Q6J("placeholder","FACILITY_DETAIL.SERVICES_DESTINATIONS.FILTER"),t.xp6(4),t.Q6J("perunWebAppsLoader",e.loading)("perunWebAppsLoaderIndicator",a)}},dependencies:[m.O5,K.Hw,T.lW,Wt.q,U.w,x.K,R.t,N.L,A.e,h.X$]});var Ft=l(23256);function ci(s,i){1&s&&t._UZ(0,"perun-web-apps-loading-dialog")}function ri(s,i){if(1&s){const e=t.EpF();t.TgZ(0,"div")(1,"h1",2),t._uU(2),t.ALo(3,"translate"),t.qZA(),t.TgZ(4,"div")(5,"perun-web-apps-immediate-filter",3),t.NdJ("filter",function(n){t.CHM(e);const o=t.oxw();return t.KtG(o.applyFilter(n))}),t.qZA(),t.TgZ(6,"div",4),t._UZ(7,"perun-web-apps-owners-list",5),t.qZA(),t.TgZ(8,"div",6)(9,"button",7),t.NdJ("click",function(){t.CHM(e);const n=t.oxw();return t.KtG(n.onCancel())}),t._uU(10),t.ALo(11,"translate"),t.qZA(),t.TgZ(12,"button",8),t.NdJ("click",function(){t.CHM(e);const n=t.oxw();return t.KtG(n.onAdd())}),t._uU(13),t.ALo(14,"translate"),t.qZA()()()()}if(2&s){const e=t.oxw();t.xp6(2),t.Oqu(t.lcZ(3,9,"DIALOGS.ADD_OWNERS.TITLE")),t.xp6(3),t.Q6J("placeholder","DIALOGS.ADD_OWNERS.FILTER"),t.xp6(2),t.Q6J("filterValue",e.filterValue)("selection",e.selection)("owners",e.owners)("tableId",e.tableId),t.xp6(3),t.hij(" ",t.lcZ(11,11,"DIALOGS.ADD_OWNERS.CANCEL")," "),t.xp6(2),t.Q6J("disabled",0===e.selection.selected.length||e.loading),t.xp6(1),t.hij(" ",t.lcZ(14,13,"DIALOGS.ADD_OWNERS.ADD")," ")}}class at{constructor(i,e,a,n,o,u){this.dialogRef=i,this.data=e,this.notificator=a,this.translate=n,this.ownersManagerService=o,this.facilitiesManagerService=u,this.extSources=[],this.selection=new S.Ov(!0,[]),this.filterValue="",this.tableId=v.BV,this.owners=[]}ngOnInit(){this.theme=this.data.theme,this.loading=!0,this.ownersManagerService.getAllOwners().subscribe(i=>{this.owners=i.filter(e=>!this.data.forbiddenOwners.includes(e.id)),this.loading=!1},()=>this.loading=!1)}applyFilter(i){this.filterValue=i}onAdd(){this.loading=!0;const i=this.selection.selected.map(e=>e.id);this.facilitiesManagerService.addFacilityOwners(this.data.facilityId,i).subscribe({next:()=>{this.loading=!1,this.notificator.showSuccess(this.translate.instant("DIALOGS.ADD_OWNERS.SUCCESS")),this.dialogRef.close(!0)},error:()=>this.loading=!1})}onCancel(){this.dialogRef.close(!1)}}at.\u0275fac=function(i){return new(i||at)(t.Y36(r.so),t.Y36(r.WI),t.Y36(d.V6),t.Y36(d.Te),t.Y36(_.aC),t.Y36(_.IQ))},at.\u0275cmp=t.Xpm({type:at,selectors:[["app-add-facility-owner-dialog"]],decls:4,vars:5,consts:[["spinner",""],[4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],["mat-dialog-title",""],[1,"font-size-1rem",3,"placeholder","filter"],["mat-dialog-content",""],[3,"filterValue","selection","owners","tableId"],["mat-dialog-actions",""],["mat-flat-button","",1,"ms-auto",3,"click"],["color","accent","mat-flat-button","",1,"ms-2",3,"disabled","click"]],template:function(i,e){if(1&i&&(t.YNc(0,ci,1,0,"ng-template",null,0,t.W1O),t.TgZ(2,"div"),t.YNc(3,ri,15,15,"div",1),t.qZA()),2&i){const a=t.MAs(1);t.xp6(2),t.Gre("",e.theme," position-relative"),t.xp6(1),t.Q6J("perunWebAppsLoader",e.loading)("perunWebAppsLoaderIndicator",a)}},dependencies:[T.lW,r.uh,r.xY,r.H8,Y.b,N.L,Ft.Q,A.e,h.X$]});var c=l(30671);function pi(s,i){1&s&&t._UZ(0,"perun-web-apps-loading-dialog")}function di(s,i){1&s&&t._UZ(0,"th",14)}function ui(s,i){if(1&s&&(t.TgZ(0,"td",15),t._uU(1),t.qZA()),2&s){const e=i.$implicit;t.xp6(1),t.Oqu(e.name)}}function _i(s,i){1&s&&t._UZ(0,"tr",16)}function mi(s,i){1&s&&t._UZ(0,"tr",17)}function hi(s,i){if(1&s){const e=t.EpF();t.TgZ(0,"div")(1,"h1",2),t._uU(2),t.ALo(3,"translate"),t.qZA(),t.TgZ(4,"div",3)(5,"p"),t._uU(6),t.ALo(7,"translate"),t.qZA(),t.TgZ(8,"div",4),t._uU(9),t.ALo(10,"translate"),t.qZA(),t.TgZ(11,"table",5),t.ynx(12,6),t.YNc(13,di,1,0,"th",7),t.YNc(14,ui,2,1,"td",8),t.BQk(),t.YNc(15,_i,1,0,"tr",9),t.YNc(16,mi,1,0,"tr",10),t.qZA()(),t.TgZ(17,"div",11)(18,"button",12),t.NdJ("click",function(){t.CHM(e);const n=t.oxw();return t.KtG(n.onCancel())}),t._uU(19),t.ALo(20,"translate"),t.qZA(),t.TgZ(21,"button",13),t.NdJ("click",function(){t.CHM(e);const n=t.oxw();return t.KtG(n.onSubmit())}),t._uU(22),t.ALo(23,"translate"),t.qZA()()()}if(2&s){const e=t.oxw();t.xp6(2),t.Oqu(t.lcZ(3,9,"DIALOGS.REMOVE_OWNERS.TITLE")),t.xp6(4),t.hij(" ",t.lcZ(7,11,"DIALOGS.REMOVE_OWNERS.DESCRIPTION")," "),t.xp6(3),t.hij(" ",t.lcZ(10,13,"DIALOGS.REMOVE_OWNERS.ASK")," "),t.xp6(2),t.Q6J("dataSource",e.dataSource),t.xp6(4),t.Q6J("matHeaderRowDef",e.displayedColumns),t.xp6(1),t.Q6J("matRowDefColumns",e.displayedColumns),t.xp6(3),t.hij(" ",t.lcZ(20,15,"DIALOGS.REMOVE_OWNERS.CANCEL")," "),t.xp6(2),t.Q6J("disabled",e.loading),t.xp6(1),t.hij(" ",t.lcZ(23,17,"DIALOGS.REMOVE_OWNERS.DELETE")," ")}}class nt{constructor(i,e,a,n,o){this.dialogRef=i,this.data=e,this.notificator=a,this.translate=n,this.facilitiesManagerService=o,this.displayedColumns=["name"]}ngOnInit(){this.dataSource=new c.by(this.data.owners),this.theme=this.data.theme}onCancel(){this.dialogRef.close(!1)}onSubmit(){this.loading=!0;const i=this.data.owners.map(e=>e.id);this.facilitiesManagerService.removeFacilityOwners(this.data.facilityId,i).subscribe({next:()=>{this.loading=!1,this.notificator.showSuccess(this.translate.instant("DIALOGS.REMOVE_OWNERS.SUCCESS")),this.dialogRef.close(!0)},error:()=>this.loading=!1})}}function fi(s,i){if(1&s){const e=t.EpF();t.TgZ(0,"button",8),t.NdJ("click",function(){t.CHM(e);const n=t.oxw();return t.KtG(n.onCreate())}),t._uU(1),t.ALo(2,"translate"),t.qZA()}2&s&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"FACILITY_DETAIL.SETTINGS.OWNERS.ADD"),"\n"))}function gi(s,i){if(1&s){const e=t.EpF();t.TgZ(0,"button",9),t.NdJ("click",function(){t.CHM(e);const n=t.oxw();return t.KtG(n.onRemove())}),t._uU(1),t.ALo(2,"translate"),t.qZA()}if(2&s){const e=t.oxw();t.Q6J("disabled",0===e.selection.selected.length),t.xp6(1),t.hij(" ",t.lcZ(2,2,"FACILITY_DETAIL.SETTINGS.OWNERS.DELETE"),"\n")}}function Ti(s,i){1&s&&t._UZ(0,"perun-web-apps-loading-table")}function Si(s,i){if(1&s&&t._UZ(0,"perun-web-apps-owners-list",10),2&s){const e=t.oxw();t.Q6J("displayedColumns",e.displayedColumns)("filterValue",e.filterValue)("owners",e.owners)("selection",e.selection)("tableId",e.tableId)}}nt.\u0275fac=function(i){return new(i||nt)(t.Y36(r.so),t.Y36(r.WI),t.Y36(d.V6),t.Y36(d.Te),t.Y36(_.IQ))},nt.\u0275cmp=t.Xpm({type:nt,selectors:[["app-remove-facility-owner-dialog"]],decls:4,vars:5,consts:[["spinner",""],[4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],["mat-dialog-title",""],["mat-dialog-content",""],[1,"fw-bold"],["mat-table","",1,"w-100",3,"dataSource"],["matColumnDef","name"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["class","font-weight-bolder","mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["mat-dialog-actions",""],["mat-flat-button","",1,"ms-auto",3,"click"],["color","warn","mat-flat-button","",1,"ms-2",3,"disabled","click"],["mat-header-cell",""],["mat-cell",""],["mat-header-row","",1,"font-weight-bolder"],["mat-row",""]],template:function(i,e){if(1&i&&(t.YNc(0,pi,1,0,"ng-template",null,0,t.W1O),t.TgZ(2,"div"),t.YNc(3,hi,24,19,"div",1),t.qZA()),2&i){const a=t.MAs(1);t.xp6(2),t.Gre("",e.theme," position-relative"),t.xp6(1),t.Q6J("perunWebAppsLoader",e.loading)("perunWebAppsLoaderIndicator",a)}},dependencies:[T.lW,c.BZ,c.fO,c.as,c.w1,c.Dz,c.nj,c.ge,c.ev,c.XQ,c.Gk,r.uh,r.xY,r.H8,Y.b,A.e,h.X$]});class q{constructor(i,e,a,n){this.facilitiesManagerService=i,this.dialog=e,this.authResolver=a,this.entityStorageService=n,this.ownerEmitter=new t.vpe,this.owners=[],this.selection=new S.Ov(!0,[]),this.displayedColumns=["id","name","contact","type"],this.tableId=v.zp}ngOnInit(){this.filterValue="",this.facility=this.entityStorageService.getEntity(),this.setAuthRights(),this.refreshTable()}refreshTable(){this.loading=!0,this.selection.clear(),this.facilitiesManagerService.getFacilityOwners(this.facility.id).subscribe(i=>{this.owners=i,this.ownerEmitter.emit(this.owners),this.loading=!1})}setAuthRights(){this.addAuth=this.authResolver.isAuthorized("addOwner_Facility_Owner_policy",[this.facility]),this.removeAuth=this.authResolver.isAuthorized("removeOwner_Facility_Owner_policy",[this.facility]),this.displayedColumns=this.removeAuth?["select","id","name","contact","type"]:["id","name","contact","type"]}applyFilter(i){this.filterValue=i}onCreate(){const i=(0,p.kZ)();i.width="800px",i.data={theme:"facility-theme",facilityId:this.facility.id,forbiddenOwners:this.owners.map(a=>a.id)},this.dialog.open(at,i).afterClosed().subscribe(a=>{a&&this.refreshTable()})}onRemove(){const i=(0,p.kZ)();i.width="600px",i.data={theme:"facility-theme",owners:this.selection.selected,facilityId:this.facility.id},this.dialog.open(nt,i).afterClosed().subscribe(a=>{a&&this.refreshTable()})}}function Ai(s,i){1&s&&t._UZ(0,"perun-web-apps-loading-dialog")}function Ci(s,i){1&s&&(t.TgZ(0,"mat-error"),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&s&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"DIALOGS.ADD_HOST.EMPTY_MESSAGE")," "))}function bi(s,i){if(1&s&&(t.TgZ(0,"mat-error"),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&s){const e=t.oxw(2);t.xp6(1),t.AsE(" ",t.lcZ(2,2,"DIALOGS.ADD_HOST.INVALID_HOST")," ",e.hostsCtrl.getError("invalidHost").value," ")}}function Ii(s,i){if(1&s){const e=t.EpF();t.TgZ(0,"div")(1,"h1",2),t._uU(2),t.ALo(3,"translate"),t.qZA(),t.TgZ(4,"div",3)(5,"mat-form-field",4)(6,"mat-label"),t._uU(7),t.ALo(8,"translate"),t.qZA(),t.TgZ(9,"textarea",5),t._uU(10,"        "),t.qZA(),t.YNc(11,Ci,3,3,"mat-error",6),t.YNc(12,bi,3,4,"mat-error",6),t.qZA(),t.TgZ(13,"perun-web-apps-alert",7),t._uU(14),t.ALo(15,"translate"),t.qZA()(),t.TgZ(16,"div",8)(17,"button",9),t.NdJ("click",function(){t.CHM(e);const n=t.oxw();return t.KtG(n.onCancel())}),t._uU(18),t.ALo(19,"translate"),t.qZA(),t.TgZ(20,"button",10),t.NdJ("click",function(){t.CHM(e);const n=t.oxw();return t.KtG(n.onAdd())}),t._uU(21),t.ALo(22,"translate"),t.qZA()()()}if(2&s){const e=t.oxw();t.xp6(2),t.Oqu(t.lcZ(3,9,"DIALOGS.ADD_HOST.TITLE")),t.xp6(5),t.Oqu(t.lcZ(8,11,"DIALOGS.ADD_HOST.SUBTITLE")),t.xp6(2),t.Q6J("formControl",e.hostsCtrl),t.xp6(2),t.Q6J("ngIf",e.hostsCtrl.hasError("required")),t.xp6(1),t.Q6J("ngIf",e.hostsCtrl.hasError("invalidHost")),t.xp6(2),t.Oqu(t.lcZ(15,13,"DIALOGS.ADD_HOST.HINT")),t.xp6(4),t.hij(" ",t.lcZ(19,15,"DIALOGS.ADD_HOST.CANCEL")," "),t.xp6(2),t.Q6J("disabled",e.hostsCtrl.invalid||e.loading),t.xp6(1),t.hij(" ",t.lcZ(22,17,"DIALOGS.ADD_HOST.ADD")," ")}}q.\u0275fac=function(i){return new(i||q)(t.Y36(_.IQ),t.Y36(r.uw),t.Y36(d.x4),t.Y36(d.fb))},q.\u0275cmp=t.Xpm({type:q,selectors:[["app-facility-settings-owners"]],outputs:{ownerEmitter:"ownerEmitter"},decls:11,vars:8,consts:[[1,"page-subtitle"],[3,"refresh"],["class","me-2 action-button","color","accent","mat-flat-button","",3,"click",4,"ngIf"],["class","me-2","color","warn","mat-flat-button","",3,"disabled","click",4,"ngIf"],[3,"placeholder","filter"],["spinner",""],[1,"position-relative"],[3,"displayedColumns","filterValue","owners","selection","tableId",4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],["color","accent","mat-flat-button","",1,"me-2","action-button",3,"click"],["color","warn","mat-flat-button","",1,"me-2",3,"disabled","click"],[3,"displayedColumns","filterValue","owners","selection","tableId"]],template:function(i,e){if(1&i&&(t.TgZ(0,"h1",0),t._uU(1),t.ALo(2,"translate"),t.qZA(),t.TgZ(3,"perun-web-apps-refresh-button",1),t.NdJ("refresh",function(){return e.refreshTable()}),t.qZA(),t.YNc(4,fi,3,3,"button",2),t.YNc(5,gi,3,4,"button",3),t.TgZ(6,"perun-web-apps-immediate-filter",4),t.NdJ("filter",function(n){return e.applyFilter(n)}),t.qZA(),t.YNc(7,Ti,1,0,"ng-template",null,5,t.W1O),t.TgZ(9,"div",6),t.YNc(10,Si,1,5,"perun-web-apps-owners-list",7),t.qZA()),2&i){const a=t.MAs(8);t.xp6(1),t.Oqu(t.lcZ(2,6,"FACILITY_DETAIL.SETTINGS.OWNERS.TITLE")),t.xp6(3),t.Q6J("ngIf",e.addAuth),t.xp6(1),t.Q6J("ngIf",e.removeAuth),t.xp6(1),t.Q6J("placeholder","VO_MANAGEMENT.FILTER_PLACEHOLDER"),t.xp6(4),t.Q6J("perunWebAppsLoader",e.loading)("perunWebAppsLoaderIndicator",a)}},dependencies:[m.O5,T.lW,x.K,R.t,N.L,Ft.Q,A.e,h.X$]});class H{constructor(i,e,a,n,o){this.dialogRef=i,this.data=e,this.facilitiesManager=a,this.notificator=n,this.translate=o,this.loading=!1,this.hostPattern=new RegExp("^(?!:\\/\\/)(?=.{1,255}$)((.{1,63}\\.){1,127}(?![0-9]*$)[a-z0-9-]+\\.?)$|^(25[0-5]|2[0-4]\\d|[0-1]?\\d?\\d)(\\.(25[0-5]|2[0-4]\\d|[0-1]?\\d?\\d)){3}$")}static parseRange(i){const[e,a]=i.split("-");return[parseInt(e.substring(1,e.length),10),parseInt(a.substring(0,a.length),10)]}ngOnInit(){this.theme=this.data.theme,this.hostsCtrl=new g.p4("",[g.kI.required,this.hostsNameValidator()]),this.hostsCtrl.markAllAsTouched()}onAdd(){this.loading=!0;const i=this.hostsCtrl.value.split("\n");let e=[];for(const a of i)e=e.concat(this.parseHostName(a));this.facilitiesManager.addHosts(this.data.facilityId,e).subscribe(()=>{this.notificator.showSuccess(this.translate.instant("DIALOGS.ADD_HOST.SUCCESS")),this.dialogRef.close(!0)},()=>this.loading=!1)}onCancel(){this.dialogRef.close(!1)}hostsNameValidator(){return i=>{let e=[];const a=i.value.split("\n");for(const n of a)e=e.concat(this.parseHostName(n));for(const n of e)if(!this.hostPattern.test(n))return{invalidHost:{value:n}};return null}}parseHostName(i){const e=new RegExp("[[0-9]+-[0-9]+]","g"),a=i.split(e),n=i.match(e);if(null==n)return""===i?[]:[i];let o=[];for(let u=0;u<a.length-1;u++){const[f,b]=H.parseRange(n[u]);let F=[];for(let I=f;I<=b;I++)F=F.concat(a[u].concat(I.toString()));o=o.concat([F])}return o=o.concat([a[a.length-1]]),this.joinHostNames(o,0)}joinHostNames(i,e){if(e===i.length-1)return i[e];const a=this.joinHostNames(i,e+1),n=[];for(const o of i[e])for(const u of a)n.push(o.concat(u));return n}}function yi(s,i){1&s&&t._UZ(0,"perun-web-apps-loading-dialog")}function vi(s,i){1&s&&t._UZ(0,"th",14)}function xi(s,i){if(1&s&&(t.TgZ(0,"td",15),t._uU(1),t.qZA()),2&s){const e=i.$implicit;t.xp6(1),t.Oqu(e.hostname)}}function Li(s,i){1&s&&t._UZ(0,"tr",16)}function Ei(s,i){1&s&&t._UZ(0,"tr",17)}function Di(s,i){if(1&s){const e=t.EpF();t.TgZ(0,"div")(1,"h1",2),t._uU(2),t.ALo(3,"translate"),t.qZA(),t.TgZ(4,"div",3)(5,"p"),t._uU(6),t.ALo(7,"translate"),t.qZA(),t.TgZ(8,"div",4),t._uU(9),t.ALo(10,"translate"),t.qZA(),t.TgZ(11,"table",5),t.ynx(12,6),t.YNc(13,vi,1,0,"th",7),t.YNc(14,xi,2,1,"td",8),t.BQk(),t.YNc(15,Li,1,0,"tr",9),t.YNc(16,Ei,1,0,"tr",10),t.qZA()(),t.TgZ(17,"div",11)(18,"button",12),t.NdJ("click",function(){t.CHM(e);const n=t.oxw();return t.KtG(n.onCancel())}),t._uU(19),t.ALo(20,"translate"),t.qZA(),t.TgZ(21,"button",13),t.NdJ("click",function(){t.CHM(e);const n=t.oxw();return t.KtG(n.onConfirm())}),t._uU(22),t.ALo(23,"translate"),t.qZA()()()}if(2&s){const e=t.oxw();t.xp6(2),t.Oqu(t.lcZ(3,9,"DIALOGS.REMOVE_HOST.TITLE")),t.xp6(4),t.Oqu(t.lcZ(7,11,"DIALOGS.REMOVE_HOST.DESCRIPTION")),t.xp6(3),t.hij(" ",t.lcZ(10,13,"DIALOGS.REMOVE_HOST.ASK")," "),t.xp6(2),t.Q6J("dataSource",e.dataSource),t.xp6(4),t.Q6J("matHeaderRowDef",e.displayedColumns),t.xp6(1),t.Q6J("matRowDefColumns",e.displayedColumns),t.xp6(3),t.hij(" ",t.lcZ(20,15,"DIALOGS.REMOVE_HOST.CANCEL")," "),t.xp6(2),t.Q6J("disabled",e.loading),t.xp6(1),t.hij(" ",t.lcZ(23,17,"DIALOGS.REMOVE_HOST.CONFIRM")," ")}}H.\u0275fac=function(i){return new(i||H)(t.Y36(r.so),t.Y36(r.WI),t.Y36(_.IQ),t.Y36(d.V6),t.Y36(h.sK))},H.\u0275cmp=t.Xpm({type:H,selectors:[["app-add-host-dialog"]],decls:4,vars:5,consts:[["spinner",""],[4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],["mat-dialog-title",""],["mat-dialog-content","",1,"dialog-container"],["subscriptSizing","dynamic"],["id","facilityAddHost","name","facilityAddHost","required","","matInput","","perunWebAppsAutoFocus","","rows","8",3,"formControl"],[4,"ngIf"],["alert_type","info"],["mat-dialog-actions",""],["mat-flat-button","",1,"ms-auto",3,"click"],["color","accent","mat-flat-button","",1,"ms-2",3,"disabled","click"]],template:function(i,e){if(1&i&&(t.YNc(0,Ai,1,0,"ng-template",null,0,t.W1O),t.TgZ(2,"div"),t.YNc(3,Ii,23,19,"div",1),t.qZA()),2&i){const a=t.MAs(1);t.xp6(2),t.Gre("",e.theme," position-relative"),t.xp6(1),t.Q6J("perunWebAppsLoader",e.loading)("perunWebAppsLoaderIndicator",a)}},dependencies:[m.O5,Nt.Nt,w.KE,w.hX,w.TO,g.Fj,g.JJ,g.Q7,g.oH,T.lW,r.uh,r.xY,r.H8,U.w,Y.b,M.hT,A.e,h.X$]});class ot{constructor(i,e,a,n,o){this.dialogRef=i,this.data=e,this.facilitiesManager=a,this.notificator=n,this.translate=o,this.displayedColumns=["name"],this.loading=!1}ngOnInit(){this.theme=this.data.theme,this.hosts=this.data.hosts,this.dataSource=new c.by(this.data.hosts)}onConfirm(){this.loading=!0,this.facilitiesManager.removeHosts(this.data.facilityId,this.hosts.map(i=>i.id)).subscribe(()=>{this.notificator.showSuccess(this.translate.instant("DIALOGS.REMOVE_HOST.SUCCESS")),this.dialogRef.close(!0)},()=>this.loading=!1)}onCancel(){this.dialogRef.close(!1)}}ot.\u0275fac=function(i){return new(i||ot)(t.Y36(r.so),t.Y36(r.WI),t.Y36(_.IQ),t.Y36(d.V6),t.Y36(h.sK))},ot.\u0275cmp=t.Xpm({type:ot,selectors:[["app-remove-host-dialog"]],decls:4,vars:5,consts:[["spinner",""],[4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],["mat-dialog-title",""],["mat-dialog-content",""],[1,"fw-bold"],["mat-table","",1,"w-100",3,"dataSource"],["matColumnDef","name"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["class","font-weight-bolder","mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["mat-dialog-actions",""],["mat-flat-button","",1,"ms-auto",3,"click"],["color","warn","mat-flat-button","",1,"ms-2",3,"disabled","click"],["mat-header-cell",""],["mat-cell",""],["mat-header-row","",1,"font-weight-bolder"],["mat-row",""]],template:function(i,e){if(1&i&&(t.YNc(0,yi,1,0,"ng-template",null,0,t.W1O),t.TgZ(2,"div"),t.YNc(3,Di,24,19,"div",1),t.qZA()),2&i){const a=t.MAs(1);t.xp6(2),t.Gre("",e.theme," position-relative"),t.xp6(1),t.Q6J("perunWebAppsLoader",e.loading)("perunWebAppsLoaderIndicator",a)}},dependencies:[T.lW,c.BZ,c.fO,c.as,c.w1,c.Dz,c.nj,c.ge,c.ev,c.XQ,c.Gk,r.uh,r.xY,r.H8,Y.b,A.e,h.X$]});var C=l(96308),lt=l(18750),Kt=l(64597),ct=l(9185),rt=l(8231),pt=l(14849);function Zi(s,i){if(1&s){const e=t.EpF();t.TgZ(0,"th",15)(1,"mat-checkbox",16),t.NdJ("change",function(n){t.CHM(e);const o=t.oxw(2);return t.KtG(n?o.masterToggle():null)}),t.ALo(2,"translate"),t.ALo(3,"masterCheckboxLabel"),t.qZA()()}if(2&s){const e=t.oxw().ngIf,a=t.oxw();t.xp6(1),t.Q6J("aria-label",t.lcZ(2,3,t.lcZ(3,5,e.all)))("checked",a.selection.hasValue()&&e.all)("indeterminate",a.selection.hasValue()&&!e.all)}}const Oi=function(s){return{name:s}};function Ri(s,i){if(1&s){const e=t.EpF();t.TgZ(0,"td",17)(1,"mat-checkbox",18),t.NdJ("change",function(n){const u=t.CHM(e).$implicit,f=t.oxw(2);return t.KtG(n?f.selection.toggle(u):null)})("click",function(n){return n.stopPropagation()}),t.ALo(2,"translate"),t.ALo(3,"checkboxLabel"),t.qZA()()}if(2&s){const e=i.$implicit,a=t.oxw(2);t.xp6(1),t.Q6J("aria-label",t.xi3(2,2,t.lcZ(3,5,a.selection.isSelected(e)),t.VKq(7,Oi,e.hostname)))("checked",a.selection.isSelected(e))}}function Ni(s,i){1&s&&(t.ynx(0,12),t.YNc(1,Zi,4,7,"th",13),t.YNc(2,Ri,4,9,"td",14),t.BQk())}function Fi(s,i){1&s&&(t.TgZ(0,"th",19),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&s&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"SHARED.COMPONENTS.HOSTS_LIST.TABLE_HOST_ID")," "))}function wi(s,i){if(1&s&&(t.TgZ(0,"td",20),t._uU(1),t.qZA()),2&s){const e=i.$implicit;t.xp6(1),t.Oqu(e.id)}}function ki(s,i){1&s&&(t.TgZ(0,"th",19),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&s&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"SHARED.COMPONENTS.HOSTS_LIST.TABLE_HOST_NAME")," "))}function Yi(s,i){if(1&s&&(t.TgZ(0,"td",21),t.ALo(1,"multiWordDataCy"),t._uU(2),t.qZA()),2&s){const e=i.$implicit;t.uIk("data-cy",t.lcZ(1,2,e.hostname)),t.xp6(2),t.hij(" ",e.hostname," ")}}function Ui(s,i){1&s&&t._UZ(0,"tr",22)}const jt=function(s,i){return["/facilities",s,"hosts",i]};function Mi(s,i){if(1&s&&t._UZ(0,"tr",23),2&s){const e=i.$implicit,a=t.oxw();t.Q6J("perunWebAppsMiddleClickRouterLink",a.disableRouting?null:t.WLB(2,jt,a.facilityId.toString(),e.id.toString()))("routerLink",a.disableRouting?null:t.WLB(5,jt,a.facilityId,e.id))}}function Ji(s,i){1&s&&(t.TgZ(0,"perun-web-apps-alert",24),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&s&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"SHARED_LIB.UI.ALERTS.NO_FILTER_RESULTS_ALERT"),"\n"))}function Hi(s,i){1&s&&(t.TgZ(0,"perun-web-apps-alert",24),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&s&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"SHARED.COMPONENTS.HOSTS_LIST.NO_HOST_WARNING"),"\n"))}const Gi=function(s){return{all:s}};class L{constructor(i,e){this.authResolver=i,this.tableCheckbox=e,this.hosts=[],this.selection=new S.Ov(!0,[]),this.disableRouting=!1,this.displayedColumns=["select","id","name"],this.pageSizeOptions=p.f7}set matSort(i){this.sort=i,this.setDataSource()}static getDataForColumn(i,e){switch(e){case"id":return i.id.toString();case"name":return i.hostname;default:return""}}ngOnChanges(){this.authResolver.isPerunAdminOrObserver()||(this.displayedColumns=this.displayedColumns.filter(i=>"id"!==i)),this.dataSource=new c.by(this.hosts),this.setDataSource(),this.dataSource.filter=this.filterValue}exportAllData(i){(0,p.O6)((0,p.Xn)(this.dataSource.filteredData,this.displayedColumns,L.getDataForColumn),i)}exportDisplayedData(i){const e=this.dataSource.paginator.pageIndex*this.dataSource.paginator.pageSize,a=e+this.dataSource.paginator.pageSize;(0,p.O6)((0,p.Xn)(this.dataSource.sortData(this.dataSource.filteredData,this.dataSource.sort).slice(e,a),this.displayedColumns,L.getDataForColumn),i)}setDataSource(){this.dataSource&&(this.dataSource.sort=this.sort,this.dataSource.filterPredicate=(i,e)=>(0,p.Sd)(i,e,this.displayedColumns,L.getDataForColumn),this.dataSource.sortData=(i,e)=>(0,p.pR)(i,e,L.getDataForColumn),this.dataSource.paginator=this.child.paginator)}isAllSelected(){return this.tableCheckbox.isAllSelected(this.selection.selected.length,this.dataSource)}masterToggle(){this.tableCheckbox.masterToggle(this.isAllSelected(),this.selection,this.filterValue,this.dataSource,this.sort,this.child.paginator.pageSize,this.child.paginator.pageIndex,!1)}ngAfterViewInit(){this.dataSource.paginator=this.child.paginator}}function Qi(s,i){if(1&s){const e=t.EpF();t.TgZ(0,"button",8),t.NdJ("click",function(){t.CHM(e);const n=t.oxw();return t.KtG(n.addHost())}),t._uU(1),t.ALo(2,"translate"),t.qZA()}2&s&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"FACILITY_DETAIL.HOSTS.ADD")," "))}function qi(s,i){if(1&s){const e=t.EpF();t.TgZ(0,"button",9),t.NdJ("click",function(){t.CHM(e);const n=t.oxw();return t.KtG(n.removeHost())}),t._uU(1),t.ALo(2,"translate"),t.qZA()}if(2&s){const e=t.oxw();t.Q6J("disabled",0===e.selected.selected.length),t.xp6(1),t.hij(" ",t.lcZ(2,2,"FACILITY_DETAIL.HOSTS.REMOVE")," ")}}function Pi(s,i){1&s&&t._UZ(0,"perun-web-apps-loading-table")}function Vi(s,i){if(1&s&&t._UZ(0,"app-hosts-list",10),2&s){const e=t.oxw();t.Q6J("disableRouting",!e.routeAuth||e.disableRouting)("filterValue",e.filterValue)("hosts",e.hosts)("selection",e.selected)("displayedColumns",e.displayedColumns)("facilityId",e.facility.id)("tableId",e.tableId)}}L.\u0275fac=function(i){return new(i||L)(t.Y36(d.x4),t.Y36(d.UA))},L.\u0275cmp=t.Xpm({type:L,selectors:[["app-hosts-list"]],viewQuery:function(i,e){if(1&i&&(t.Gf(p.l9,7),t.Gf(C.YE,7)),2&i){let a;t.iGM(a=t.CRH())&&(e.child=a.first),t.iGM(a=t.CRH())&&(e.matSort=a.first)}},inputs:{hosts:"hosts",selection:"selection",filterValue:"filterValue",tableId:"tableId",facilityId:"facilityId",disableRouting:"disableRouting",displayedColumns:"displayedColumns"},features:[t.TTD],decls:15,vars:15,consts:[[1,"card","mt-3",3,"hidden"],[3,"pageSizeOptions","dataLength","tableId","exportDisplayedData","exportAllData"],["mat-table","","matSort","","matSortActive","id","matSortDirection","asc","matSortDisableClear","",1,"w-100",3,"dataSource"],["matColumnDef","select",4,"ngIf"],["matColumnDef","id"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["class","static-column-size","mat-cell","",4,"matCellDef"],["matColumnDef","name"],["mat-cell","",4,"matCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["class","dark-hover-list-item","mat-row","",3,"perunWebAppsMiddleClickRouterLink","routerLink",4,"matRowDef","matRowDefColumns"],["alert_type","warn",4,"ngIf"],["matColumnDef","select"],["class","align-checkbox","mat-header-cell","",4,"matHeaderCellDef"],["class","static-column-size align-checkbox","mat-cell","",4,"matCellDef"],["mat-header-cell","",1,"align-checkbox"],["color","primary",3,"aria-label","checked","indeterminate","change"],["mat-cell","",1,"static-column-size","align-checkbox"],["color","primary",3,"aria-label","checked","change","click"],["mat-header-cell","","mat-sort-header",""],["mat-cell","",1,"static-column-size"],["mat-cell",""],["mat-header-row",""],["mat-row","",1,"dark-hover-list-item",3,"perunWebAppsMiddleClickRouterLink","routerLink"],["alert_type","warn"]],template:function(i,e){1&i&&(t.TgZ(0,"div",0)(1,"perun-web-apps-table-wrapper",1),t.NdJ("exportDisplayedData",function(n){return e.exportDisplayedData(n)})("exportAllData",function(n){return e.exportAllData(n)}),t.TgZ(2,"table",2),t.YNc(3,Ni,3,0,"ng-container",3),t.ALo(4,"isAllSelected"),t.ynx(5,4),t.YNc(6,Fi,3,3,"th",5),t.YNc(7,wi,2,1,"td",6),t.BQk(),t.ynx(8,7),t.YNc(9,ki,3,3,"th",5),t.YNc(10,Yi,3,4,"td",8),t.BQk(),t.YNc(11,Ui,1,0,"tr",9),t.YNc(12,Mi,1,8,"tr",10),t.qZA()()(),t.YNc(13,Ji,3,3,"perun-web-apps-alert",11),t.YNc(14,Hi,3,3,"perun-web-apps-alert",11)),2&i&&(t.Q6J("hidden",0===e.dataSource.filteredData.length||0===e.hosts.length),t.xp6(1),t.Q6J("pageSizeOptions",e.pageSizeOptions)("dataLength",e.dataSource.filteredData.length)("tableId",e.tableId),t.xp6(1),t.Q6J("dataSource",e.dataSource),t.xp6(1),t.Q6J("ngIf",t.VKq(13,Gi,t.xi3(4,10,e.dataSource,e.selection.selected.length))),t.xp6(8),t.Q6J("matHeaderRowDef",e.displayedColumns),t.xp6(1),t.Q6J("matRowDefColumns",e.displayedColumns),t.xp6(1),t.Q6J("ngIf",0===e.dataSource.filteredData.length&&0!==e.hosts.length),t.xp6(1),t.Q6J("ngIf",0===e.hosts.length))},dependencies:[m.O5,y.rH,C.YE,C.nU,c.BZ,c.fO,c.as,c.w1,c.Dz,c.nj,c.ge,c.ev,c.XQ,c.Gk,k.oG,U.w,M.YH,M.QG,lt.l,h.X$,Kt.R,ct.I,rt.G,pt.r],styles:[".disable-outline[_ngcontent-%COMP%]{outline:none!important}.cursor-pointer[_ngcontent-%COMP%]{cursor:pointer}"]});class P{constructor(i,e,a,n){this.dialog=i,this.facilitiesManager=e,this.authResolver=a,this.entityStorageService=n,this.disableRouting=!1,this.hostEmitter=new t.vpe,this.hosts=[],this.selected=new S.Ov(!0,[]),this.filterValue="",this.tableId=v.eq,this.displayedColumns=["id","name"]}ngOnInit(){this.loading=!0,this.facility=this.entityStorageService.getEntity(),this.setAuthRights(),this.facilitiesManager.getFacilityById(this.facility.id).subscribe(i=>{this.facility=i,this.refreshTable()})}refreshTable(){this.loading=!0,this.facilitiesManager.getHosts(this.facility.id).subscribe(i=>{this.hosts=i,this.hostEmitter.emit(this.hosts),this.selected.clear(),this.setAuthRights(),this.loading=!1})}setAuthRights(){this.addAuth=this.authResolver.isAuthorized("addHosts_Facility_List<String>_policy",[this.facility]),this.removeAuth=this.authResolver.isAuthorized("removeHosts_List<Host>_Facility_policy",[this.facility]),this.displayedColumns=this.removeAuth?["select","id","name"]:["id","name"],0!==this.hosts.length&&(this.routeAuth=this.authResolver.isAuthorized("getHostById_int_policy",[this.facility,this.hosts[0]]))}addHost(){const i=(0,p.kZ)();i.width="600px",i.data={facilityId:this.facility.id,theme:"facility-theme"},this.dialog.open(H,i).afterClosed().subscribe(a=>{a&&this.refreshTable()})}removeHost(){const i=(0,p.kZ)();i.width="600px",i.data={facilityId:this.facility.id,theme:"facility-theme",hosts:this.selected.selected},this.dialog.open(ot,i).afterClosed().subscribe(a=>{a&&this.refreshTable()})}applyFilter(i){this.filterValue=i}}function Bi(s,i){if(1&s){const e=t.EpF();t.TgZ(0,"th",16)(1,"mat-checkbox",17),t.NdJ("change",function(n){t.CHM(e);const o=t.oxw(2);return t.KtG(n?o.masterToggle():null)}),t.ALo(2,"translate"),t.ALo(3,"masterCheckboxLabel"),t.qZA()()}if(2&s){const e=t.oxw().ngIf,a=t.oxw();t.xp6(1),t.Q6J("aria-label",t.lcZ(2,3,t.lcZ(3,5,e.all)))("checked",a.selection.hasValue()&&e.all)("indeterminate",a.selection.hasValue()&&!e.all)}}P.\u0275fac=function(i){return new(i||P)(t.Y36(r.uw),t.Y36(_.IQ),t.Y36(d.x4),t.Y36(d.fb))},P.\u0275cmp=t.Xpm({type:P,selectors:[["app-facility-hosts"]],inputs:{disableRouting:"disableRouting"},outputs:{hostEmitter:"hostEmitter"},decls:12,vars:8,consts:[[1,"page-subtitle"],[3,"refresh"],["color","accent","class","me-2 action-button","mat-flat-button","",3,"click",4,"ngIf"],["class","me-2","color","warn","mat-flat-button","",3,"disabled","click",4,"ngIf"],[3,"placeholder","filter"],["spinner",""],[1,"position-relative"],[3,"disableRouting","filterValue","hosts","selection","displayedColumns","facilityId","tableId",4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],["color","accent","mat-flat-button","",1,"me-2","action-button",3,"click"],["color","warn","mat-flat-button","",1,"me-2",3,"disabled","click"],[3,"disableRouting","filterValue","hosts","selection","displayedColumns","facilityId","tableId"]],template:function(i,e){if(1&i&&(t.TgZ(0,"div")(1,"h1",0),t._uU(2),t.ALo(3,"translate"),t.qZA(),t.TgZ(4,"perun-web-apps-refresh-button",1),t.NdJ("refresh",function(){return e.refreshTable()}),t.qZA(),t.YNc(5,Qi,3,3,"button",2),t.YNc(6,qi,3,4,"button",3),t.TgZ(7,"perun-web-apps-immediate-filter",4),t.NdJ("filter",function(n){return e.applyFilter(n)}),t.qZA(),t.YNc(8,Pi,1,0,"ng-template",null,5,t.W1O),t.TgZ(10,"div",6),t.YNc(11,Vi,1,7,"app-hosts-list",7),t.qZA()()),2&i){const a=t.MAs(9);t.xp6(2),t.Oqu(t.lcZ(3,6,"FACILITY_DETAIL.HOSTS.TITLE")),t.xp6(3),t.Q6J("ngIf",e.addAuth),t.xp6(1),t.Q6J("ngIf",e.removeAuth),t.xp6(1),t.Q6J("placeholder","FACILITY_DETAIL.HOSTS.FILTER"),t.xp6(4),t.Q6J("perunWebAppsLoader",e.loading)("perunWebAppsLoaderIndicator",a)}},dependencies:[m.O5,T.lW,L,x.K,R.t,N.L,A.e,h.X$]});const Wi=function(s){return{name:s}};function Ki(s,i){if(1&s){const e=t.EpF();t.TgZ(0,"td",18)(1,"mat-checkbox",19),t.NdJ("change",function(n){const u=t.CHM(e).$implicit,f=t.oxw(2);return t.KtG(n?f.selection.toggle(u):null)})("click",function(n){return n.stopPropagation()}),t.ALo(2,"translate"),t.ALo(3,"checkboxLabel"),t.ALo(4,"userFullName"),t.qZA()()}if(2&s){const e=i.$implicit,a=t.oxw(2);t.xp6(1),t.Q6J("aria-label",t.xi3(2,2,t.lcZ(3,5,a.selection.isSelected(e)),t.VKq(9,Wi,t.lcZ(4,7,e[1]))))("checked",a.selection.isSelected(e))}}function ji(s,i){1&s&&(t.ynx(0,13),t.YNc(1,Bi,4,7,"th",14),t.YNc(2,Ki,5,11,"td",15),t.BQk())}function $i(s,i){1&s&&(t.TgZ(0,"th",20),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&s&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"SHARED.COMPONENTS.BLACKLIST_LIST.USER_ID")," "))}function zi(s,i){if(1&s&&(t.TgZ(0,"td",21),t._uU(1),t.qZA()),2&s){const e=i.$implicit;t.xp6(1),t.hij(" ",e[1].id," ")}}function Xi(s,i){1&s&&(t.TgZ(0,"th",20),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&s&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"SHARED.COMPONENTS.BLACKLIST_LIST.NAME")," "))}function ts(s,i){if(1&s&&(t.TgZ(0,"td",22),t._uU(1),t.ALo(2,"userFullName"),t.qZA()),2&s){const e=i.$implicit;t.xp6(1),t.hij(" ",t.lcZ(2,1,e[1])," ")}}function es(s,i){1&s&&(t.TgZ(0,"th",20),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&s&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"SHARED.COMPONENTS.BLACKLIST_LIST.REASON")," "))}function is(s,i){if(1&s&&(t.TgZ(0,"td",22),t._uU(1),t.qZA()),2&s){const e=i.$implicit;t.xp6(1),t.hij(" ",e[0].description," ")}}function ss(s,i){1&s&&t._UZ(0,"tr",23)}function as(s,i){1&s&&t._UZ(0,"tr",24)}function ns(s,i){1&s&&(t.TgZ(0,"perun-web-apps-alert",25),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&s&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"SHARED_LIB.UI.ALERTS.NO_FILTER_RESULTS_ALERT"),"\n"))}function os(s,i){1&s&&(t.TgZ(0,"perun-web-apps-alert",25),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&s&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"SHARED.COMPONENTS.BLACKLIST_LIST.NO_BANS_WARNING"),"\n"))}const ls=function(s){return{all:s}};class E{constructor(i,e){this.authResolver=i,this.tableCheckbox=e,this.bansOnFacilitiesWithUsers=[],this.selection=new S.Ov(!0,[]),this.pageSizeOptions=p.f7,this.displayedColumns=["select","userId","name","reason"]}set matSort(i){this.sort=i,this.setDataSource()}static getDataForColumn(i,e){switch(e){case"userId":return i[1].id.toString();case"reason":return i[0].description;case"name":return(0,p.hu)(i[1]);default:return""}}ngOnChanges(){this.authResolver.isPerunAdminOrObserver()||(this.displayedColumns=this.displayedColumns.filter(i=>"userId"!==i)),this.dataSource=new c.by(this.bansOnFacilitiesWithUsers),this.setDataSource(),this.dataSource.filter=this.filterValue}exportAllData(i){(0,p.O6)((0,p.Xn)(this.dataSource.filteredData,this.displayedColumns,E.getDataForColumn),i)}exportDisplayedData(i){const e=this.dataSource.paginator.pageIndex*this.dataSource.paginator.pageSize,a=e+this.dataSource.paginator.pageSize;(0,p.O6)((0,p.Xn)(this.dataSource.sortData(this.dataSource.filteredData,this.dataSource.sort).slice(e,a),this.displayedColumns,E.getDataForColumn),i)}setDataSource(){this.dataSource&&(this.dataSource.filterPredicate=(i,e)=>(0,p.Sd)(i,e,this.displayedColumns,E.getDataForColumn),this.dataSource.sortData=(i,e)=>(0,p.pR)(i,e,E.getDataForColumn),this.dataSource.sort=this.sort,this.dataSource.paginator=this.child.paginator)}isAllSelected(){return this.tableCheckbox.isAllSelected(this.selection.selected.length,this.dataSource)}masterToggle(){this.tableCheckbox.masterToggle(this.isAllSelected(),this.selection,this.filterValue,this.dataSource,this.sort,this.child.paginator.pageSize,this.child.paginator.pageIndex,!1)}ngAfterViewInit(){this.dataSource.paginator=this.child.paginator}}function cs(s,i){1&s&&t._UZ(0,"perun-web-apps-loading-table")}function rs(s,i){if(1&s&&t._UZ(0,"app-perun-web-apps-blacklist-list",6),2&s){const e=t.oxw();t.Q6J("bansOnFacilitiesWithUsers",e.bansOnFacilitiesWithUsers)("filterValue",e.filterValue)("selection",e.selected)("tableId",e.tableId)}}E.\u0275fac=function(i){return new(i||E)(t.Y36(d.x4),t.Y36(d.UA))},E.\u0275cmp=t.Xpm({type:E,selectors:[["app-perun-web-apps-blacklist-list"]],viewQuery:function(i,e){if(1&i&&(t.Gf(p.l9,7),t.Gf(C.YE,7)),2&i){let a;t.iGM(a=t.CRH())&&(e.child=a.first),t.iGM(a=t.CRH())&&(e.matSort=a.first)}},inputs:{bansOnFacilitiesWithUsers:"bansOnFacilitiesWithUsers",selection:"selection",filterValue:"filterValue",tableId:"tableId"},features:[t.TTD],decls:18,vars:15,consts:[[1,"card","mt-3",3,"hidden"],[3,"pageSizeOptions","dataLength","tableId","exportDisplayedData","exportAllData"],["mat-table","","matSort","","matSortActive","id","matSortDirection","asc","matSortDisableClear","",1,"w-100",3,"dataSource"],["matColumnDef","select",4,"ngIf"],["matColumnDef","userId"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["class","static-column-size","mat-cell","",4,"matCellDef"],["matColumnDef","name"],["mat-cell","",4,"matCellDef"],["matColumnDef","reason"],["mat-header-row","",4,"matHeaderRowDef"],["class","dark-hover-list-item","mat-row","",4,"matRowDef","matRowDefColumns"],["alert_type","warn",4,"ngIf"],["matColumnDef","select"],["class","align-checkbox","mat-header-cell","",4,"matHeaderCellDef"],["class","static-column-size align-checkbox","mat-cell","",4,"matCellDef"],["mat-header-cell","",1,"align-checkbox"],["color","primary",3,"aria-label","checked","indeterminate","change"],["mat-cell","",1,"static-column-size","align-checkbox"],["color","primary",3,"aria-label","checked","change","click"],["mat-header-cell","","mat-sort-header",""],["mat-cell","",1,"static-column-size"],["mat-cell",""],["mat-header-row",""],["mat-row","",1,"dark-hover-list-item"],["alert_type","warn"]],template:function(i,e){1&i&&(t.TgZ(0,"div",0)(1,"perun-web-apps-table-wrapper",1),t.NdJ("exportDisplayedData",function(n){return e.exportDisplayedData(n)})("exportAllData",function(n){return e.exportAllData(n)}),t.TgZ(2,"table",2),t.YNc(3,ji,3,0,"ng-container",3),t.ALo(4,"isAllSelected"),t.ynx(5,4),t.YNc(6,$i,3,3,"th",5),t.YNc(7,zi,2,1,"td",6),t.BQk(),t.ynx(8,7),t.YNc(9,Xi,3,3,"th",5),t.YNc(10,ts,3,3,"td",8),t.BQk(),t.ynx(11,9),t.YNc(12,es,3,3,"th",5),t.YNc(13,is,2,1,"td",8),t.BQk(),t.YNc(14,ss,1,0,"tr",10),t.YNc(15,as,1,0,"tr",11),t.qZA()()(),t.YNc(16,ns,3,3,"perun-web-apps-alert",12),t.YNc(17,os,3,3,"perun-web-apps-alert",12)),2&i&&(t.Q6J("hidden",0===e.dataSource.filteredData.length||0===e.bansOnFacilitiesWithUsers.length),t.xp6(1),t.Q6J("pageSizeOptions",e.pageSizeOptions)("dataLength",e.dataSource.filteredData.length)("tableId",e.tableId),t.xp6(1),t.Q6J("dataSource",e.dataSource),t.xp6(1),t.Q6J("ngIf",t.VKq(13,ls,t.xi3(4,10,e.dataSource,e.selection.selected.length))),t.xp6(11),t.Q6J("matHeaderRowDef",e.displayedColumns),t.xp6(1),t.Q6J("matRowDefColumns",e.displayedColumns),t.xp6(1),t.Q6J("ngIf",0===e.dataSource.filteredData.length&&0!==e.bansOnFacilitiesWithUsers.length),t.xp6(1),t.Q6J("ngIf",0===e.bansOnFacilitiesWithUsers.length))},dependencies:[m.O5,C.YE,C.nU,c.BZ,c.fO,c.as,c.w1,c.Dz,c.nj,c.ge,c.ev,c.XQ,c.Gk,k.oG,U.w,lt.l,h.X$,Vt.d,ct.I,rt.G,pt.r]});class dt{constructor(i,e,a){this.facilitiesManager=i,this.usersManager=e,this.entityStorageService=a,this.bansOnFacilitiesWithUsers=[],this.selected=new S.Ov(!0,[]),this.filterValue="",this.tableId=v.NG}ngOnInit(){this.loading=!0,this.facility=this.entityStorageService.getEntity(),this.refreshTable()}refreshTable(){this.loading=!0,this.facilitiesManager.getBansForFacility(this.facility.id).subscribe(i=>{const e=i;for(const a of e){let n;this.usersManager.getUserById(a.userId).subscribe(o=>{n=o}),this.bansOnFacilitiesWithUsers.push([a,n])}this.selected.clear(),this.loading=!1})}applyFilter(i){this.filterValue=i}}dt.\u0275fac=function(i){return new(i||dt)(t.Y36(_.IQ),t.Y36(_.Fv),t.Y36(d.fb))},dt.\u0275cmp=t.Xpm({type:dt,selectors:[["app-perun-web-apps-facility-settings-blacklist"]],decls:11,vars:8,consts:[[1,"page-subtitle"],[3,"refresh"],[3,"placeholder","filter"],["spinner",""],[1,"position-relative"],[3,"bansOnFacilitiesWithUsers","filterValue","selection","tableId",4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],[3,"bansOnFacilitiesWithUsers","filterValue","selection","tableId"]],template:function(i,e){if(1&i&&(t.TgZ(0,"div")(1,"h1",0),t._uU(2),t.ALo(3,"translate"),t.qZA(),t.TgZ(4,"perun-web-apps-refresh-button",1),t.NdJ("refresh",function(){return e.refreshTable()}),t.qZA(),t.TgZ(5,"perun-web-apps-immediate-filter",2),t.NdJ("filter",function(n){return e.applyFilter(n)}),t.ALo(6,"translate"),t.qZA(),t.YNc(7,cs,1,0,"ng-template",null,3,t.W1O),t.TgZ(9,"div",4),t.YNc(10,rs,1,4,"app-perun-web-apps-blacklist-list",5),t.qZA()()),2&i){const a=t.MAs(8);t.xp6(2),t.Oqu(t.lcZ(3,4,"FACILITY_DETAIL.SETTINGS.BLACKLIST.TITLE")),t.xp6(3),t.Q6J("placeholder",t.lcZ(6,6,"FACILITY_DETAIL.SETTINGS.BLACKLIST.FILTER")),t.xp6(5),t.Q6J("perunWebAppsLoader",e.loading)("perunWebAppsLoaderIndicator",a)}},dependencies:[E,x.K,R.t,N.L,A.e,h.X$]});var ps=l(37433),ds=l(61365),us=l(71103),$t=l(6881);const _s=["list"];function ms(s,i){1&s&&t._UZ(0,"perun-web-apps-loading-table")}function hs(s,i){if(1&s&&t._UZ(0,"perun-web-apps-attributes-list",8,9),2&s){const e=t.oxw();t.Q6J("selection",e.selected)("attributes",e.attributes)("tableId",e.tableId)}}class ut{constructor(i,e,a,n){this.dialog=i,this.attributesManager=e,this.facilityManager=a,this.route=n,this.attributes=[],this.selected=new S.Ov(!0,[]),this.host={beanName:"",id:0},this.tableId=v.rF}ngOnInit(){this.route.params.subscribe(i=>{this.hostId=Number(i.hostId),this.facilityManager.getHostById(this.hostId).subscribe(e=>{this.host=e}),this.refreshTable()})}refreshTable(){this.loading=!0,this.attributesManager.getHostAttributes(this.hostId).subscribe(i=>{this.attributes=(0,p.MX)(i),this.selected.clear(),this.loading=!1})}onSave(){this.list.updateMapAttributes();const i=(0,p.kZ)();i.width="450px",i.data={entityId:this.hostId,entity:"host",attributes:this.selected.selected},this.dialog.open(yt.wA,i).afterClosed().subscribe(a=>{a&&this.refreshTable()})}addAttribute(){const i=(0,p.kZ)();i.width="1050px",i.data={entityId:this.hostId,entity:"host",notEmptyAttributes:this.attributes,style:"facility-theme"},this.dialog.open(us.n,i).afterClosed().subscribe(a=>{"saved"===a&&this.refreshTable()})}removeAttribute(){const i=(0,p.kZ)();i.width="450px",i.data={entityId:this.hostId,entity:"host",attributes:this.selected.selected,theme:"facility-theme"},this.dialog.open(ds.k,i).afterClosed().subscribe(a=>{a&&this.refreshTable()})}}function fs(s,i){if(1&s){const e=t.EpF();t.TgZ(0,"th",16)(1,"mat-checkbox",17),t.NdJ("change",function(n){t.CHM(e);const o=t.oxw(2);return t.KtG(n?o.masterToggle():null)}),t.ALo(2,"translate"),t.ALo(3,"masterCheckboxLabel"),t.qZA()()}if(2&s){const e=t.oxw().ngIf,a=t.oxw();t.xp6(1),t.Q6J("aria-label",t.lcZ(2,3,t.lcZ(3,5,e.all)))("checked",a.selection.hasValue()&&e.all)("indeterminate",a.selection.hasValue()&&!e.all)}}ut.\u0275fac=function(i){return new(i||ut)(t.Y36(r.uw),t.Y36(_.H8),t.Y36(_.IQ),t.Y36(y.gz))},ut.\u0275cmp=t.Xpm({type:ut,selectors:[["app-facility-hosts-detail"]],viewQuery:function(i,e){if(1&i&&t.Gf(_s,5),2&i){let a;t.iGM(a=t.CRH())&&(e.list=a.first)}},decls:18,vars:17,consts:[[1,"page-subtitle"],[3,"refresh"],["color","accent","mat-flat-button","",1,"me-2",3,"click"],["color","accent","mat-flat-button","",1,"me-2",3,"disabled","click"],["color","warn","mat-flat-button","",3,"disabled","click"],["spinner",""],[1,"position-relative"],[3,"selection","attributes","tableId",4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],[3,"selection","attributes","tableId"],["list",""]],template:function(i,e){if(1&i&&(t.TgZ(0,"div")(1,"h1",0),t._uU(2),t.ALo(3,"translate"),t.qZA(),t.TgZ(4,"perun-web-apps-refresh-button",1),t.NdJ("refresh",function(){return e.refreshTable()}),t.qZA(),t.TgZ(5,"button",2),t.NdJ("click",function(){return e.addAttribute()}),t._uU(6),t.ALo(7,"translate"),t.qZA(),t.TgZ(8,"button",3),t.NdJ("click",function(){return e.onSave()}),t._uU(9),t.ALo(10,"translate"),t.qZA(),t.TgZ(11,"button",4),t.NdJ("click",function(){return e.removeAttribute()}),t._uU(12),t.ALo(13,"translate"),t.qZA(),t.YNc(14,ms,1,0,"ng-template",null,5,t.W1O),t.TgZ(16,"div",6),t.YNc(17,hs,2,3,"perun-web-apps-attributes-list",7),t.qZA()()),2&i){const a=t.MAs(15);t.xp6(2),t.AsE(" ",t.lcZ(3,9,"FACILITY_DETAIL.HOSTS.HOSTS_DETAIL.TITLE")," ",e.host.hostname," "),t.xp6(4),t.hij(" ",t.lcZ(7,11,"FACILITY_DETAIL.HOSTS.HOSTS_DETAIL.ADD")," "),t.xp6(2),t.Q6J("disabled",0===e.selected.selected.length),t.xp6(1),t.hij(" ",t.lcZ(10,13,"FACILITY_DETAIL.HOSTS.HOSTS_DETAIL.SAVE")," "),t.xp6(2),t.Q6J("disabled",0===e.selected.selected.length),t.xp6(1),t.hij(" ",t.lcZ(13,15,"FACILITY_DETAIL.HOSTS.HOSTS_DETAIL.REMOVE")," "),t.xp6(5),t.Q6J("perunWebAppsLoader",e.loading)("perunWebAppsLoaderIndicator",a)}},dependencies:[T.lW,x.K,R.t,$t.p,A.e,h.X$]});const gs=function(s){return{name:s}};function Ts(s,i){if(1&s){const e=t.EpF();t.TgZ(0,"td",18)(1,"mat-checkbox",19),t.NdJ("change",function(n){const u=t.CHM(e).$implicit,f=t.oxw(2);return t.KtG(n?f.selection.toggle(u):null)})("click",function(n){return n.stopPropagation()}),t.ALo(2,"translate"),t.ALo(3,"checkboxLabel"),t.qZA()()}if(2&s){const e=i.$implicit,a=t.oxw(2);t.xp6(1),t.Q6J("aria-label",t.xi3(2,2,t.lcZ(3,5,a.selection.isSelected(e)),t.VKq(7,gs,e.name)))("checked",a.selection.isSelected(e))}}function Ss(s,i){1&s&&(t.ynx(0,13),t.YNc(1,fs,4,7,"th",14),t.YNc(2,Ts,4,9,"td",15),t.BQk())}function As(s,i){1&s&&(t.TgZ(0,"th",20),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&s&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"SHARED.COMPONENTS.SECURITY_TEAMS_LIST.ID")," "))}function Cs(s,i){if(1&s&&(t.TgZ(0,"td",21),t._uU(1),t.qZA()),2&s){const e=i.$implicit;t.xp6(1),t.hij(" ",e.id," ")}}function bs(s,i){1&s&&(t.TgZ(0,"th",20),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&s&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"SHARED.COMPONENTS.SECURITY_TEAMS_LIST.NAME")," "))}function Is(s,i){if(1&s&&(t.TgZ(0,"td",22),t._uU(1),t.qZA()),2&s){const e=i.$implicit;t.xp6(1),t.Oqu(e.name)}}function ys(s,i){1&s&&(t.TgZ(0,"th",20),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&s&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"SHARED.COMPONENTS.SECURITY_TEAMS_LIST.DESCRIPTION")," "))}function vs(s,i){if(1&s&&(t.TgZ(0,"td",22),t._uU(1),t.qZA()),2&s){const e=i.$implicit;t.xp6(1),t.Oqu(e.description)}}function xs(s,i){1&s&&t._UZ(0,"tr",23)}function Ls(s,i){1&s&&t._UZ(0,"tr",24)}function Es(s,i){1&s&&(t.TgZ(0,"perun-web-apps-alert",25),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&s&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"SHARED_LIB.UI.ALERTS.NO_FILTER_RESULTS_ALERT"),"\n"))}function Ds(s,i){1&s&&(t.TgZ(0,"perun-web-apps-alert",25),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&s&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"SHARED.COMPONENTS.SECURITY_TEAMS_LIST.NO_SECURITY_TEAMS_WARNING"),"\n"))}const Zs=function(s){return{all:s}};class D{constructor(i,e){this.authResolver=i,this.tableCheckbox=e,this.securityTeams=[],this.selection=new S.Ov(!0,[]),this.displayedColumns=["select","id","name","description"],this.pageSizeOptions=p.f7}set matSort(i){this.sort=i,this.setDataSource()}static getDataForColumn(i,e){switch(e){case"id":return i.id.toString();case"name":return i.name;case"description":return i.description;default:return""}}ngOnChanges(){this.authResolver.isPerunAdminOrObserver()||(this.displayedColumns=this.displayedColumns.filter(i=>"id"!==i)),this.dataSource=new c.by(this.securityTeams),this.setDataSource(),this.dataSource.filter=this.filterValue}exportAllData(i){(0,p.O6)((0,p.Xn)(this.dataSource.filteredData,this.displayedColumns,D.getDataForColumn),i)}exportDisplayedData(i){const e=this.dataSource.paginator.pageIndex*this.dataSource.paginator.pageSize,a=e+this.dataSource.paginator.pageSize;(0,p.O6)((0,p.Xn)(this.dataSource.sortData(this.dataSource.filteredData,this.dataSource.sort).slice(e,a),this.displayedColumns,D.getDataForColumn),i)}setDataSource(){this.dataSource&&(this.dataSource.filterPredicate=(i,e)=>(0,p.Sd)(i,e,this.displayedColumns,D.getDataForColumn),this.dataSource.sortData=(i,e)=>(0,p.pR)(i,e,D.getDataForColumn),this.dataSource.sort=this.sort,this.dataSource.paginator=this.child.paginator)}isAllSelected(){return this.tableCheckbox.isAllSelected(this.selection.selected.length,this.dataSource)}masterToggle(){this.tableCheckbox.masterToggle(this.isAllSelected(),this.selection,this.filterValue,this.dataSource,this.sort,this.child.paginator.pageSize,this.child.paginator.pageIndex,!1)}ngAfterViewInit(){this.dataSource.paginator=this.child.paginator}}function Os(s,i){1&s&&t._UZ(0,"perun-web-apps-loading-table")}function Rs(s,i){if(1&s&&t._UZ(0,"app-security-teams-list",6),2&s){const e=t.oxw();t.Q6J("displayedColumns",e.displayedColumns)("filterValue",e.filterValue)("securityTeams",e.securityTeams)("selection",e.selected)("tableId",e.tableId)}}D.\u0275fac=function(i){return new(i||D)(t.Y36(d.x4),t.Y36(d.UA))},D.\u0275cmp=t.Xpm({type:D,selectors:[["app-security-teams-list"]],viewQuery:function(i,e){if(1&i&&(t.Gf(p.l9,7),t.Gf(C.YE,7)),2&i){let a;t.iGM(a=t.CRH())&&(e.child=a.first),t.iGM(a=t.CRH())&&(e.matSort=a.first)}},inputs:{securityTeams:"securityTeams",selection:"selection",filterValue:"filterValue",tableId:"tableId",displayedColumns:"displayedColumns"},features:[t.TTD],decls:18,vars:15,consts:[[1,"card","mt-3",3,"hidden"],[3,"pageSizeOptions","dataLength","tableId","exportDisplayedData","exportAllData"],["mat-table","","matSort","","matSortActive","id","matSortDirection","asc","matSortDisableClear","",1,"w-100",3,"dataSource"],["matColumnDef","select",4,"ngIf"],["matColumnDef","id"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["class","static-column-size","mat-cell","",4,"matCellDef"],["matColumnDef","name"],["mat-cell","",4,"matCellDef"],["matColumnDef","description"],["mat-header-row","",4,"matHeaderRowDef"],["class","dark-hover-list-item","mat-row","",4,"matRowDef","matRowDefColumns"],["alert_type","warn",4,"ngIf"],["matColumnDef","select"],["class","align-checkbox","mat-header-cell","",4,"matHeaderCellDef"],["class","static-column-size align-checkbox","mat-cell","",4,"matCellDef"],["mat-header-cell","",1,"align-checkbox"],["color","primary",3,"aria-label","checked","indeterminate","change"],["mat-cell","",1,"static-column-size","align-checkbox"],["color","primary",3,"aria-label","checked","change","click"],["mat-header-cell","","mat-sort-header",""],["mat-cell","",1,"static-column-size"],["mat-cell",""],["mat-header-row",""],["mat-row","",1,"dark-hover-list-item"],["alert_type","warn"]],template:function(i,e){1&i&&(t.TgZ(0,"div",0)(1,"perun-web-apps-table-wrapper",1),t.NdJ("exportDisplayedData",function(n){return e.exportDisplayedData(n)})("exportAllData",function(n){return e.exportAllData(n)}),t.TgZ(2,"table",2),t.YNc(3,Ss,3,0,"ng-container",3),t.ALo(4,"isAllSelected"),t.ynx(5,4),t.YNc(6,As,3,3,"th",5),t.YNc(7,Cs,2,1,"td",6),t.BQk(),t.ynx(8,7),t.YNc(9,bs,3,3,"th",5),t.YNc(10,Is,2,1,"td",8),t.BQk(),t.ynx(11,9),t.YNc(12,ys,3,3,"th",5),t.YNc(13,vs,2,1,"td",8),t.BQk(),t.YNc(14,xs,1,0,"tr",10),t.YNc(15,Ls,1,0,"tr",11),t.qZA()()(),t.YNc(16,Es,3,3,"perun-web-apps-alert",12),t.YNc(17,Ds,3,3,"perun-web-apps-alert",12)),2&i&&(t.Q6J("hidden",0===e.dataSource.filteredData.length||0===e.securityTeams.length),t.xp6(1),t.Q6J("pageSizeOptions",e.pageSizeOptions)("dataLength",e.dataSource.filteredData.length)("tableId",e.tableId),t.xp6(1),t.Q6J("dataSource",e.dataSource),t.xp6(1),t.Q6J("ngIf",t.VKq(13,Zs,t.xi3(4,10,e.dataSource,e.selection.selected.length))),t.xp6(11),t.Q6J("matHeaderRowDef",e.displayedColumns),t.xp6(1),t.Q6J("matRowDefColumns",e.displayedColumns),t.xp6(1),t.Q6J("ngIf",0===e.dataSource.filteredData.length&&0!==e.securityTeams.length),t.xp6(1),t.Q6J("ngIf",0===e.securityTeams.length))},dependencies:[m.O5,C.YE,C.nU,c.BZ,c.fO,c.as,c.w1,c.Dz,c.nj,c.ge,c.ev,c.XQ,c.Gk,k.oG,U.w,lt.l,h.X$,ct.I,rt.G,pt.r]});class _t{constructor(i,e,a,n){this.dialog=i,this.facilitiesManager=e,this.authResolver=a,this.entityStorageService=n,this.securityTeams=[],this.selected=new S.Ov(!0,[]),this.filterValue="",this.tableId=v.O9,this.displayedColumns=[]}ngOnInit(){this.facility=this.entityStorageService.getEntity(),this.refreshTable()}refreshTable(){this.loading=!0,this.facilitiesManager.getAssignedSecurityTeams(this.facility.id).subscribe(i=>{this.securityTeams=i,this.selected.clear(),this.setAuthRights(),this.loading=!1})}setAuthRights(){this.addAuth=this.authResolver.isAuthorized("assignSecurityTeam_Facility_SecurityTeam_policy",[this.facility]),this.removeAuth=this.authResolver.isAuthorized("removeSecurityTeam_Facility_SecurityTeam_policy",[this.facility]),this.displayedColumns=this.removeAuth?["select","id","name","description"]:["id","name","description"]}applyFilter(i){this.filterValue=i}}_t.\u0275fac=function(i){return new(i||_t)(t.Y36(r.uw),t.Y36(_.IQ),t.Y36(d.x4),t.Y36(d.fb))},_t.\u0275cmp=t.Xpm({type:_t,selectors:[["app-facility-security-teams"]],decls:10,vars:6,consts:[[1,"page-subtitle"],[3,"refresh"],[3,"placeholder","filter"],["spinner",""],[1,"position-relative"],[3,"displayedColumns","filterValue","securityTeams","selection","tableId",4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],[3,"displayedColumns","filterValue","securityTeams","selection","tableId"]],template:function(i,e){if(1&i&&(t.TgZ(0,"div")(1,"h1",0),t._uU(2),t.ALo(3,"translate"),t.qZA(),t.TgZ(4,"perun-web-apps-refresh-button",1),t.NdJ("refresh",function(){return e.refreshTable()}),t.qZA(),t.TgZ(5,"perun-web-apps-immediate-filter",2),t.NdJ("filter",function(n){return e.applyFilter(n)}),t.qZA(),t.YNc(6,Os,1,0,"ng-template",null,3,t.W1O),t.TgZ(8,"div",4),t.YNc(9,Rs,1,5,"app-security-teams-list",5),t.qZA()()),2&i){const a=t.MAs(7);t.xp6(2),t.Oqu(t.lcZ(3,4,"FACILITY_DETAIL.SECURITY_TEAMS.TITLE")),t.xp6(3),t.Q6J("placeholder","FACILITY_DETAIL.SECURITY_TEAMS.FILTER"),t.xp6(4),t.Q6J("perunWebAppsLoader",e.loading)("perunWebAppsLoaderIndicator",a)}},dependencies:[D,x.K,R.t,N.L,A.e,h.X$]});var Ns=l(20057),Fs=l(49546);function ws(s,i){1&s&&t._UZ(0,"perun-web-apps-loading-dialog")}function ks(s,i){1&s&&(t.TgZ(0,"th",16),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&s&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"DIALOGS.DELETE_TASK_RESULT.RESULT_ID")," "))}function Ys(s,i){if(1&s&&(t.TgZ(0,"td",17),t._uU(1),t.qZA()),2&s){const e=i.$implicit;t.xp6(1),t.Oqu(e.id)}}function Us(s,i){1&s&&(t.TgZ(0,"th",16),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&s&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"DIALOGS.DELETE_TASK_RESULT.DESTINATION")," "))}function Ms(s,i){if(1&s&&(t.TgZ(0,"td",17),t._uU(1),t.qZA()),2&s){const e=i.$implicit;t.xp6(1),t.Oqu(e.destination.destination)}}function Js(s,i){1&s&&(t.TgZ(0,"th",16),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&s&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"DIALOGS.DELETE_TASK_RESULT.TIME")," "))}function Hs(s,i){if(1&s&&(t.TgZ(0,"td",17),t._uU(1),t.ALo(2,"date"),t.qZA()),2&s){const e=i.$implicit;t.xp6(1),t.hij(" ",t.xi3(2,1,e.timestamp,"d.M.y H:mm:ss")," ")}}function Gs(s,i){1&s&&t._UZ(0,"tr",18)}function Qs(s,i){1&s&&t._UZ(0,"tr",19)}function qs(s,i){if(1&s){const e=t.EpF();t.TgZ(0,"div")(1,"h1",2),t._uU(2),t.ALo(3,"translate"),t.qZA(),t.TgZ(4,"div",3)(5,"p"),t._uU(6),t.ALo(7,"translate"),t.qZA(),t.TgZ(8,"div",4),t._uU(9),t.ALo(10,"translate"),t.qZA(),t.TgZ(11,"table",5),t.ynx(12,6),t.YNc(13,ks,3,3,"th",7),t.YNc(14,Ys,2,1,"td",8),t.BQk(),t.ynx(15,9),t.YNc(16,Us,3,3,"th",7),t.YNc(17,Ms,2,1,"td",8),t.BQk(),t.ynx(18,10),t.YNc(19,Js,3,3,"th",7),t.YNc(20,Hs,3,4,"td",8),t.BQk(),t.YNc(21,Gs,1,0,"tr",11),t.YNc(22,Qs,1,0,"tr",12),t.qZA()(),t.TgZ(23,"div",13)(24,"button",14),t.NdJ("click",function(){t.CHM(e);const n=t.oxw();return t.KtG(n.onCancel())}),t._uU(25),t.ALo(26,"translate"),t.qZA(),t.TgZ(27,"button",15),t.NdJ("click",function(){t.CHM(e);const n=t.oxw();return t.KtG(n.onDelete())}),t._uU(28),t.ALo(29,"translate"),t.qZA()()()}if(2&s){const e=t.oxw();t.xp6(2),t.Oqu(t.lcZ(3,9,"DIALOGS.DELETE_TASK_RESULT.TITLE")),t.xp6(4),t.Oqu(t.lcZ(7,11,"DIALOGS.DELETE_TASK_RESULT.DESCRIPTION")),t.xp6(3),t.hij(" ",t.lcZ(10,13,"DIALOGS.DELETE_TASK_RESULT.ASK")," "),t.xp6(2),t.Q6J("dataSource",e.dataSource),t.xp6(10),t.Q6J("matHeaderRowDef",e.displayedColumns),t.xp6(1),t.Q6J("matRowDefColumns",e.displayedColumns),t.xp6(3),t.hij(" ",t.lcZ(26,15,"DIALOGS.DELETE_TASK_RESULT.CANCEL")," "),t.xp6(2),t.Q6J("disabled",e.loading),t.xp6(1),t.hij(" ",t.lcZ(29,17,"DIALOGS.DELETE_TASK_RESULT.REMOVE")," ")}}class V{constructor(i,e,a,n,o){this.dialogRef=i,this.data=e,this.taskManager=a,this.notificator=n,this.translate=o,this.loading=!1,this.dataSource=new c.by(this.data.taskResults),this.displayedColumns=["id","destination","time"]}ngOnInit(){this.theme=this.data.theme,this.taskResults=this.data.taskResults}onDelete(){this.loading=!0;const i=this.taskResults.map(e=>e.id);this.taskManager.deleteTaskResultsByIds(i).subscribe({next:()=>{this.dialogRef.close(!0),this.loading=!1,this.notificator.showSuccess(this.translate.instant("DIALOGS.DELETE_TASK_RESULT.SUCCESS"))},error:()=>this.loading=!1})}onCancel(){this.dialogRef.close(!1)}}V.\u0275fac=function(i){return new(i||V)(t.Y36(r.so),t.Y36(r.WI),t.Y36(_.Ob),t.Y36(d.V6),t.Y36(d.Te))},V.\u0275cmp=t.Xpm({type:V,selectors:[["app-delete-task-result-dialog"]],decls:4,vars:5,consts:[["spinner",""],[4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],["mat-dialog-title",""],["mat-dialog-content",""],[1,"fw-bold"],["mat-table","",1,"w-100",3,"dataSource"],["matColumnDef","id"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","destination"],["matColumnDef","time"],["class","font-weight-bolder","mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["mat-dialog-actions",""],["mat-flat-button","",1,"ms-auto",3,"click"],["color","warn","mat-flat-button","",1,"ms-2",3,"disabled","click"],["mat-header-cell",""],["mat-cell",""],["mat-header-row","",1,"font-weight-bolder"],["mat-row",""]],template:function(i,e){if(1&i&&(t.YNc(0,ws,1,0,"ng-template",null,0,t.W1O),t.TgZ(2,"div"),t.YNc(3,qs,30,19,"div",1),t.qZA()),2&i){const a=t.MAs(1);t.xp6(2),t.Gre("",e.theme," position-relative"),t.xp6(1),t.Q6J("perunWebAppsLoader",e.loading)("perunWebAppsLoaderIndicator",a)}},dependencies:[T.lW,c.BZ,c.fO,c.as,c.w1,c.Dz,c.nj,c.ge,c.ev,c.XQ,c.Gk,r.uh,r.xY,r.H8,Y.b,A.e,m.uU,h.X$]});var Ps=l(62109);function Vs(s,i){1&s&&t._UZ(0,"perun-web-apps-loading-dialog")}function Bs(s,i){if(1&s){const e=t.EpF();t.TgZ(0,"mat-checkbox",12),t.NdJ("change",function(n){t.CHM(e);const o=t.oxw(2);return t.KtG(o.change(n))}),t.ALo(1,"translate"),t._uU(2),t.ALo(3,"translate"),t.qZA()}if(2&s){const e=t.oxw(2);t.s9C("matTooltip",t.lcZ(1,5,"DIALOGS.REMOVE_SERVICE_FROM_FACILITY.CHECKBOXES_DISABLED")),t.Q6J("checked",e.taskChecked)("disabled",e.checkboxesDisabled)("matTooltipDisabled",!e.checkboxesDisabled),t.xp6(2),t.hij(" ",t.lcZ(3,7,"DIALOGS.REMOVE_SERVICE_FROM_FACILITY.CHECKBOX_TASK_AND_TASK_RESULTS")," ")}}function Ws(s,i){if(1&s){const e=t.EpF();t.TgZ(0,"mat-checkbox",13),t.NdJ("change",function(n){t.CHM(e);const o=t.oxw(2);return t.KtG(o.change(n))}),t.ALo(1,"translate"),t._uU(2),t.ALo(3,"translate"),t.qZA()}if(2&s){const e=t.oxw(2);t.s9C("matTooltip",t.lcZ(1,5,"DIALOGS.REMOVE_SERVICE_FROM_FACILITY.CHECKBOXES_DISABLED")),t.Q6J("checked",e.taskResultsChecked)("disabled",e.checkboxesDisabled)("matTooltipDisabled",!e.checkboxesDisabled),t.xp6(2),t.hij(" ",t.lcZ(3,7,"DIALOGS.REMOVE_SERVICE_FROM_FACILITY.CHECKBOX_TASK_RESULTS")," ")}}function Ks(s,i){if(1&s){const e=t.EpF();t.TgZ(0,"div")(1,"h1",2),t._uU(2),t.ALo(3,"translate"),t.qZA(),t.TgZ(4,"div",3)(5,"p"),t._uU(6),t.ALo(7,"translate"),t.qZA(),t.TgZ(8,"div"),t.YNc(9,Bs,4,9,"mat-checkbox",4),t.YNc(10,Ws,4,9,"mat-checkbox",5),t.TgZ(11,"mat-checkbox",6),t.NdJ("change",function(n){t.CHM(e);const o=t.oxw();return t.KtG(o.change(n))}),t.ALo(12,"translate"),t._uU(13),t.ALo(14,"translate"),t.qZA()(),t.TgZ(15,"p"),t._uU(16),t.ALo(17,"translate"),t.qZA(),t.TgZ(18,"div",7),t._uU(19),t.ALo(20,"translate"),t.qZA(),t.TgZ(21,"perun-web-apps-resources-list",8),t.NdJ("allSelected",function(n){t.CHM(e);const o=t.oxw();return t.KtG(o.disableCheckboxes(n))}),t.qZA()(),t.TgZ(22,"div",9)(23,"button",10),t.NdJ("click",function(){t.CHM(e);const n=t.oxw();return t.KtG(n.cancel())}),t._uU(24),t.ALo(25,"translate"),t.qZA(),t.TgZ(26,"button",11),t.NdJ("click",function(){t.CHM(e);const n=t.oxw();return t.KtG(n.remove())}),t._uU(27),t.ALo(28,"translate"),t.qZA()()()}if(2&s){const e=t.oxw();t.xp6(2),t.Oqu(t.lcZ(3,19,"DIALOGS.REMOVE_SERVICE_FROM_FACILITY.TITLE")),t.xp6(4),t.Oqu(t.lcZ(7,21,"DIALOGS.REMOVE_SERVICE_FROM_FACILITY.CHECKBOXES_DESCRIPTION")),t.xp6(3),t.Q6J("ngIf",null!==e.taskId),t.xp6(1),t.Q6J("ngIf",null!==e.taskId),t.xp6(1),t.s9C("matTooltip",t.lcZ(12,23,"DIALOGS.REMOVE_SERVICE_FROM_FACILITY.CHECKBOXES_DISABLED")),t.Q6J("disabled",e.checkboxesDisabled)("matTooltipDisabled",!e.checkboxesDisabled)("checked",e.destinationChecked),t.xp6(2),t.hij(" ",t.lcZ(14,25,"DIALOGS.REMOVE_SERVICE_FROM_FACILITY.CHECKBOX_DESTINATION")," "),t.xp6(3),t.Oqu(t.lcZ(17,27,"DIALOGS.REMOVE_SERVICE_FROM_FACILITY.DESCRIPTION")),t.xp6(3),t.hij(" ",t.lcZ(20,29,"DIALOGS.REMOVE_SERVICE_FROM_FACILITY.ASK")," "),t.xp6(2),t.Q6J("displayedColumns",e.displayedColumns)("disableRouting",!0)("resources",e.resources)("selection",e.selected)("tableId",e.tableId),t.xp6(3),t.hij(" ",t.lcZ(25,31,"DIALOGS.REMOVE_SERVICE_FROM_FACILITY.CANCEL")," "),t.xp6(2),t.Q6J("disabled",e.loading||0===e.selected.selected.length),t.xp6(1),t.hij(" ",t.lcZ(28,33,"DIALOGS.REMOVE_SERVICE_FROM_FACILITY.REMOVE")," ")}}class mt{constructor(i,e,a,n,o,u,f,b){this.dialogRef=i,this.data=e,this.resourcesManager=a,this.tasksManager=n,this.serviceManager=o,this.translate=u,this.notificator=f,this.cd=b,this.loading=!1,this.resources=[],this.displayedColumns=["select","id","vo","name"],this.checkboxesDisabled=!1,this.taskChecked=!0,this.taskResultsChecked=!0,this.destinationChecked=!0,this.tableId=v.$V,this.dataSource=new c.by(this.data.resource),this.selected=new S.Ov(!0,[...this.dataSource.data])}ngOnInit(){this.theme=this.data.theme,this.taskId=this.data.taskId,this.serviceId=this.data.serviceId,this.facilityId=this.data.facilityId,this.resources=this.data.resource}remove(){this.loading=!0,this.taskResultsChecked&&!this.taskChecked&&null!==this.taskId&&this.tasksManager.getTaskResultsForGUIByTask(this.taskId).subscribe(i=>{this.tasksManager.deleteTaskResultsByIds(i.map(e=>e.id)).subscribe()}),this.taskChecked&&null!==this.taskId&&this.tasksManager.deleteTask({task:this.taskId}).subscribe(),this.destinationChecked&&this.serviceManager.getRichDestinations(this.serviceId,this.facilityId).subscribe(i=>{this.serviceManager.removeDestinationsByRichDestinations({richDestinations:i}).subscribe()}),this.resourcesManager.removeServiceForResources(this.selected.selected.map(i=>i.id),this.serviceId).subscribe({next:()=>{this.notificator.showSuccess(this.translate.instant("DIALOGS.REMOVE_SERVICE_FROM_FACILITY.SUCCESS")),this.dialogRef.close(!0)},error:()=>this.loading=!1})}cancel(){this.dialogRef.close(!1)}disableCheckboxes(i){i&&this.checkboxesDisabled&&this.changeCheckboxes(!0),!i&&!this.checkboxesDisabled&&this.changeCheckboxes(!1)}changeCheckboxes(i){this.checkboxesDisabled=!i,this.taskChecked=i,this.taskResultsChecked=i,this.destinationChecked=i,this.cd.detectChanges()}change(i){switch(i.source.id){case"task":this.taskChecked=i.checked;break;case"taskResults":this.taskResultsChecked=i.checked;break;case"destination":this.destinationChecked=i.checked}}}function js(s,i){1&s&&t._UZ(0,"perun-web-apps-loading-dialog")}function $s(s,i){if(1&s){const e=t.EpF();t.TgZ(0,"div")(1,"h1",2),t._uU(2),t.ALo(3,"translate"),t.qZA(),t.TgZ(4,"div",3)(5,"div",4),t._uU(6),t.ALo(7,"translate"),t.qZA()(),t.TgZ(8,"div",5)(9,"button",6),t.NdJ("click",function(){t.CHM(e);const n=t.oxw();return t.KtG(n.cancel())}),t._uU(10),t.ALo(11,"translate"),t.qZA(),t.TgZ(12,"button",7),t.NdJ("click",function(){t.CHM(e);const n=t.oxw();return t.KtG(n.remove())}),t._uU(13),t.ALo(14,"translate"),t.qZA()()()}if(2&s){const e=t.oxw();t.xp6(2),t.Oqu(t.lcZ(3,5,"DIALOGS.DELETE_TASK.TITLE")),t.xp6(4),t.hij(" ",t.lcZ(7,7,"DIALOGS.DELETE_TASK.DESCRIPTION")," "),t.xp6(4),t.hij(" ",t.lcZ(11,9,"DIALOGS.DELETE_TASK.CANCEL")," "),t.xp6(2),t.Q6J("disabled",e.loading),t.xp6(1),t.hij(" ",t.lcZ(14,11,"DIALOGS.DELETE_TASK.DELETE")," ")}}mt.\u0275fac=function(i){return new(i||mt)(t.Y36(r.so),t.Y36(r.WI),t.Y36(_.xk),t.Y36(_.Ob),t.Y36(_.KK),t.Y36(d.Te),t.Y36(d.V6),t.Y36(t.sBO))},mt.\u0275cmp=t.Xpm({type:mt,selectors:[["app-delete-service-from-facility"]],decls:4,vars:5,consts:[["spinner",""],[4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],["mat-dialog-title",""],["mat-dialog-content",""],["class","right-space","color","warn","id","task",3,"checked","disabled","matTooltipDisabled","matTooltip","change",4,"ngIf"],["class","right-space","color","warn","id","taskResults",3,"checked","disabled","matTooltipDisabled","matTooltip","change",4,"ngIf"],["color","warn","id","destination",3,"disabled","matTooltipDisabled","checked","matTooltip","change"],[1,"fw-bold"],[3,"displayedColumns","disableRouting","resources","selection","tableId","allSelected"],["mat-dialog-actions",""],["mat-flat-button","",1,"ms-auto",3,"click"],["color","warn","mat-flat-button","",1,"ms-2",3,"disabled","click"],["color","warn","id","task",1,"right-space",3,"checked","disabled","matTooltipDisabled","matTooltip","change"],["color","warn","id","taskResults",1,"right-space",3,"checked","disabled","matTooltipDisabled","matTooltip","change"]],template:function(i,e){if(1&i&&(t.YNc(0,Vs,1,0,"ng-template",null,0,t.W1O),t.TgZ(2,"div"),t.YNc(3,Ks,29,35,"div",1),t.qZA()),2&i){const a=t.MAs(1);t.xp6(2),t.Gre("",e.theme," position-relative"),t.xp6(1),t.Q6J("perunWebAppsLoader",e.loading)("perunWebAppsLoaderIndicator",a)}},dependencies:[m.O5,T.lW,k.oG,r.uh,r.xY,r.H8,vt.gM,Y.b,Ps.C,A.e,h.X$],styles:[".right-space[_ngcontent-%COMP%]{margin-right:40px}"]});class ht{constructor(i,e,a,n,o){this.dialogRef=i,this.data=e,this.tasksManager=a,this.translate=n,this.notificator=o,this.loading=!1}ngOnInit(){this.theme=this.data.theme,this.taskId=this.data.taskId}remove(){this.loading=!0,this.tasksManager.deleteTask({task:this.taskId}).subscribe(()=>{this.translate.get("DIALOGS.DELETE_TASK.SUCCESS").subscribe(i=>{this.notificator.showSuccess(i),this.dialogRef.close(!0)})},()=>this.loading=!1)}cancel(){this.dialogRef.close(!1)}}ht.\u0275fac=function(i){return new(i||ht)(t.Y36(r.so),t.Y36(r.WI),t.Y36(_.Ob),t.Y36(h.sK),t.Y36(d.V6))},ht.\u0275cmp=t.Xpm({type:ht,selectors:[["app-delete-task-dialog"]],decls:4,vars:5,consts:[["spinner",""],[4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],["mat-dialog-title",""],["mat-dialog-content",""],[1,"fw-bold"],["mat-dialog-actions",""],["mat-flat-button","",1,"ms-auto",3,"click"],["color","warn","mat-flat-button","",1,"ms-2",3,"disabled","click"]],template:function(i,e){if(1&i&&(t.YNc(0,js,1,0,"ng-template",null,0,t.W1O),t.TgZ(2,"div"),t.YNc(3,$s,15,13,"div",1),t.qZA()),2&i){const a=t.MAs(1);t.xp6(2),t.Gre("",e.theme," position-relative"),t.xp6(1),t.Q6J("perunWebAppsLoader",e.loading)("perunWebAppsLoaderIndicator",a)}},dependencies:[T.lW,r.uh,r.xY,r.H8,Y.b,A.e,h.X$]});var wt=l(28255),zs=l(28045);function Xs(s,i){if(1&s){const e=t.EpF();t.TgZ(0,"th",19)(1,"mat-checkbox",20),t.NdJ("change",function(n){t.CHM(e);const o=t.oxw(2);return n&&o.masterToggle(),t.KtG(o.selectionChange.emit())}),t.ALo(2,"translate"),t.ALo(3,"masterCheckboxLabel"),t.qZA()()}if(2&s){const e=t.oxw().ngIf,a=t.oxw();t.xp6(1),t.Q6J("checked",a.selection.hasValue()&&e.all)("indeterminate",a.selection.hasValue()&&!e.all)("aria-label",t.lcZ(2,3,t.lcZ(3,5,e.all)))}}const ta=function(s){return{name:s}};function ea(s,i){if(1&s){const e=t.EpF();t.TgZ(0,"td",21)(1,"mat-checkbox",22),t.NdJ("click",function(n){return n.stopPropagation()})("change",function(n){const u=t.CHM(e).$implicit,f=t.oxw(2);return n&&f.selection.toggle(u),t.KtG(f.selectionChange.emit())}),t.ALo(2,"translate"),t.ALo(3,"checkboxLabel"),t.qZA()()}if(2&s){const e=i.$implicit,a=t.oxw(2);t.xp6(1),t.Q6J("checked",a.selection.isSelected(e))("aria-label",t.xi3(2,2,t.lcZ(3,5,a.selection.isSelected(e)),t.VKq(7,ta,e.service.name)))}}function ia(s,i){1&s&&(t.ynx(0,16),t.YNc(1,Xs,4,7,"th",17),t.YNc(2,ea,4,9,"td",18),t.BQk())}function sa(s,i){1&s&&(t.TgZ(0,"th",23),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&s&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"SHARED_LIB.PERUN.COMPONENTS.SERVICES_STATUS_LIST.TASK_ID")," "))}function aa(s,i){if(1&s&&(t.TgZ(0,"div"),t._uU(1),t.qZA()),2&s){const e=t.oxw().$implicit;t.xp6(1),t.Oqu(e.task.id)}}function na(s,i){1&s&&(t.TgZ(0,"div"),t._uU(1,"0"),t.qZA())}function oa(s,i){if(1&s&&(t.TgZ(0,"td",24),t.YNc(1,aa,2,1,"div",25),t.YNc(2,na,2,0,"div",25),t.qZA()),2&s){const e=i.$implicit;t.xp6(1),t.Q6J("ngIf",e.task),t.xp6(1),t.Q6J("ngIf",!e.task)}}function la(s,i){1&s&&(t.TgZ(0,"th",23),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&s&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"SHARED_LIB.PERUN.COMPONENTS.SERVICES_STATUS_LIST.SERVICE_NAME")," "))}function ca(s,i){if(1&s&&(t.TgZ(0,"td",26),t._uU(1),t.qZA()),2&s){const e=i.$implicit;t.uIk("data-cy",e.service.name),t.xp6(1),t.hij(" ",e.service.name," ")}}function ra(s,i){1&s&&(t.TgZ(0,"th",23),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&s&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"SHARED_LIB.PERUN.COMPONENTS.SERVICES_STATUS_LIST.STATUS")," "))}function pa(s,i){1&s&&(t.TgZ(0,"mat-icon",28),t.ALo(1,"translate"),t._uU(2," warning "),t.qZA()),2&s&&t.Q6J("matTooltip",t.lcZ(1,1,"SHARED_LIB.PERUN.COMPONENTS.SERVICES_STATUS_LIST.NO_DESTINATIONS_TOOLTIP"))}function da(s,i){if(1&s&&(t.TgZ(0,"td",26),t._uU(1),t.YNc(2,pa,3,3,"mat-icon",27),t.qZA()),2&s){const e=i.$implicit;t.xp6(1),t.hij(" ",e.status," "),t.xp6(1),t.Q6J("ngIf",!e.hasDestinations)}}function ua(s,i){1&s&&(t.TgZ(0,"th",23),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&s&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"SHARED_LIB.PERUN.COMPONENTS.SERVICES_STATUS_LIST.BLOCKED")," "))}function _a(s,i){if(1&s&&(t.TgZ(0,"td",26),t._uU(1),t.ALo(2,"serviceStateBlockedToString"),t.qZA()),2&s){const e=i.$implicit;t.xp6(1),t.hij(" ",t.lcZ(2,1,e)," ")}}function ma(s,i){1&s&&(t.TgZ(0,"th",23),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&s&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"SHARED_LIB.PERUN.COMPONENTS.SERVICES_STATUS_LIST.STARTED")," "))}function ha(s,i){if(1&s&&(t.TgZ(0,"div"),t._uU(1),t.ALo(2,"date"),t.qZA()),2&s){const e=t.oxw().$implicit;t.xp6(1),t.hij(" ",t.xi3(2,1,e.task.startTime,"d.M.y H:mm:ss")," ")}}function fa(s,i){1&s&&(t.TgZ(0,"div"),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&s&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"SHARED_LIB.PERUN.COMPONENTS.SERVICES_STATUS_LIST.NOT_YET")," "))}function ga(s,i){if(1&s&&(t.TgZ(0,"td",26),t.YNc(1,ha,3,4,"div",25),t.YNc(2,fa,3,3,"div",25),t.qZA()),2&s){const e=i.$implicit;t.xp6(1),t.Q6J("ngIf",e.task&&e.task.startTime),t.xp6(1),t.Q6J("ngIf",!e.task||!e.task.startTime)}}function Ta(s,i){1&s&&(t.TgZ(0,"th",23),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&s&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"SHARED_LIB.PERUN.COMPONENTS.SERVICES_STATUS_LIST.ENDED")," "))}function Sa(s,i){if(1&s&&(t.TgZ(0,"div"),t._uU(1),t.ALo(2,"date"),t.qZA()),2&s){const e=t.oxw().$implicit;t.xp6(1),t.hij(" ",t.xi3(2,1,e.task.endTime,"d.M.y H:mm:ss")," ")}}function Aa(s,i){1&s&&(t.TgZ(0,"div"),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&s&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"SHARED_LIB.PERUN.COMPONENTS.SERVICES_STATUS_LIST.NOT_YET")," "))}function Ca(s,i){if(1&s&&(t.TgZ(0,"td",26),t.YNc(1,Sa,3,4,"div",25),t.YNc(2,Aa,3,3,"div",25),t.qZA()),2&s){const e=i.$implicit;t.xp6(1),t.Q6J("ngIf",e.task&&e.task.endTime),t.xp6(1),t.Q6J("ngIf",!e.task||!e.task.endTime)}}function ba(s,i){1&s&&t._UZ(0,"tr",29)}const zt=function(s,i){return["/facilities",s,"services-status",i]};function Ia(s,i){if(1&s&&t._UZ(0,"tr",30),2&s){const e=i.$implicit,a=t.oxw();t.ekj("disable-outline",a.disableRouting||!e.task)("make-yellow","WARNING"===e.status)("make-green","DONE"===e.status)("make-red","GENERROR"===e.status||"SENDERROR"===e.status||"ERROR"===e.status)("cursor-pointer",!a.disableRouting&&null!==e.task),t.Q6J("routerLink",a.disableRouting||null===e.task?null:t.WLB(12,zt,e.facility.id,e.taskId))("perunWebAppsMiddleClickRouterLink",a.disableRouting||null===e.task?null:t.WLB(15,zt,e.facility.id,e.taskId))}}function ya(s,i){1&s&&(t.TgZ(0,"perun-web-apps-alert",31),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&s&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"SHARED_LIB.UI.ALERTS.NO_FILTER_RESULTS_ALERT"),"\n"))}function va(s,i){1&s&&(t.TgZ(0,"perun-web-apps-alert",31),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&s&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"SHARED_LIB.PERUN.COMPONENTS.SERVICES_STATUS_LIST.NO_SERVICES_STATUS_WARNING"),"\n"))}const xa=function(s){return{all:s}};class Z{constructor(i,e){this.authResolver=i,this.tableCheckbox=e,this.servicesStatus=[],this.displayedColumns=["select","task.id","service.name","status","blocked","task.startTime","task.endTime"],this.selection=new S.Ov(!0,[]),this.disableRouting=!0,this.selectionChange=new t.vpe,this.pageSizeOptions=p.f7}set matSort(i){this.sort=i,this.setDataSource()}static getSortDataForColumn(i,e){var a,n;switch(e){case"task.id":return i.task?i.task.id.toString():i[e];case"service.name":return i.service.name;case"status":return i.status;case"blocked":return i.blockedOnFacility?"BLOCKED":i.blockedGlobally?"BLOCKED GLOBALLY":"ALLOWED";case"task.startTime":return null!==(a=i.task)&&void 0!==a&&a.startTime?(0,m.p6)(i.task.startTime,"yyyy.MM.dd HH:mm:ss","en"):i[e];case"task.endTime":return null!==(n=i.task)&&void 0!==n&&n.endTime?(0,m.p6)(i.task.endTime,"yyyy.MM.dd HH:mm:ss","en"):i[e];default:return i[e]}}static getDataForColumn(i,e){var a,n;switch(e){case"task.id":return i.task?i.task.id.toString():i[e];case"service.name":return i.service.name;case"status":return i.status;case"blocked":return i.blockedOnFacility?"BLOCKED":i.blockedGlobally?"BLOCKED GLOBALLY":"ALLOWED";case"task.startTime":return null!==(a=i.task)&&void 0!==a&&a.startTime?(0,m.p6)(i.task.startTime,"d.M.y H:mm:ss","en"):i[e];case"task.endTime":return null!==(n=i.task)&&void 0!==n&&n.endTime?(0,m.p6)(i.task.endTime,"d.M.y H:mm:ss","en"):i[e];default:return i[e]}}ngOnChanges(){this.authResolver.isPerunAdminOrObserver()||(this.displayedColumns=this.displayedColumns.filter(i=>"task.id"!==i)),this.dataSource=new c.by(this.servicesStatus),this.setDataSource(),this.dataSource.filterPredicate=(i,e)=>{const a=e.trim().toLowerCase(),n=o=>{let u="";return Object.values(o).forEach(f=>{"object"!=typeof f?u=u+" "+String(f):null!==f&&(u=u+" "+n(f))}),u.trim().toLowerCase()};return n(i).includes(a)},this.dataSource.filter=this.filterValue}exportAllData(i){(0,p.O6)((0,p.Xn)(this.dataSource.filteredData,this.displayedColumns,Z.getDataForColumn),i)}exportDisplayedData(i){const e=this.dataSource.paginator.pageIndex*this.dataSource.paginator.pageSize,a=e+this.dataSource.paginator.pageSize;(0,p.O6)((0,p.Xn)(this.dataSource.sortData(this.dataSource.filteredData,this.dataSource.sort).slice(e,a),this.displayedColumns,Z.getDataForColumn),i)}setDataSource(){this.dataSource&&(this.dataSource.filterPredicate=(i,e)=>(0,p.Sd)(i,e,this.displayedColumns,Z.getDataForColumn),this.dataSource.sortData=(i,e)=>(0,p.pR)(i,e,Z.getSortDataForColumn),this.dataSource.sort=this.sort,this.dataSource.paginator=this.child.paginator)}isAllSelected(){return this.tableCheckbox.isAllSelected(this.selection.selected.length,this.dataSource)}masterToggle(){this.tableCheckbox.masterToggle(this.isAllSelected(),this.selection,this.filterValue,this.dataSource,this.sort,this.child.paginator.pageSize,this.child.paginator.pageIndex,!1)}ngAfterViewInit(){this.dataSource.paginator=this.child.paginator}}function La(s,i){if(1&s){const e=t.EpF();t.TgZ(0,"button",12),t.NdJ("click",function(){t.CHM(e);const n=t.oxw();return t.KtG(n.forcePropagation())}),t._uU(1),t.ALo(2,"translate"),t.qZA()}if(2&s){const e=t.oxw();t.Q6J("disabled",0===e.selected.selected.length||e.loading),t.xp6(1),t.hij(" ",t.lcZ(2,2,"FACILITY_DETAIL.SERVICES_STATUS.FORCE_PROPAGATION")," ")}}function Ea(s,i){if(1&s){const e=t.EpF();t.TgZ(0,"button",12),t.NdJ("click",function(){t.CHM(e);const n=t.oxw();return t.KtG(n.allow())}),t._uU(1),t.ALo(2,"translate"),t.qZA()}if(2&s){const e=t.oxw();t.Q6J("disabled",0===e.selected.selected.length||e.disableAllowButton||e.loading),t.xp6(1),t.hij(" ",t.lcZ(2,2,"FACILITY_DETAIL.SERVICES_STATUS.ALLOW")," ")}}function Da(s,i){if(1&s){const e=t.EpF();t.TgZ(0,"button",13),t.NdJ("click",function(){t.CHM(e);const n=t.oxw();return t.KtG(n.block())}),t._uU(1),t.ALo(2,"translate"),t.qZA()}if(2&s){const e=t.oxw();t.Q6J("disabled",0===e.selected.selected.length||e.disableBlockButton||e.loading),t.xp6(1),t.hij(" ",t.lcZ(2,2,"FACILITY_DETAIL.SERVICES_STATUS.BLOCK")," ")}}function Za(s,i){if(1&s&&(t.TgZ(0,"button",14),t.ALo(1,"translate"),t._uU(2),t.ALo(3,"translate"),t.qZA()),2&s){const e=t.oxw(),a=t.MAs(10);t.s9C("matTooltip",t.lcZ(1,5,"DIALOGS.REMOVE_SERVICE_FROM_FACILITY.CHECKBOXES_DISABLED")),t.Q6J("disabled",e.disableRemoveButton||e.loading)("matMenuTriggerFor",a)("matTooltipDisabled",!e.disableRemoveButton),t.xp6(2),t.hij(" ",t.lcZ(3,7,"FACILITY_DETAIL.SERVICES_STATUS.REMOVE")," ")}}function Oa(s,i){if(1&s){const e=t.EpF();t.TgZ(0,"button",7),t.NdJ("click",function(){t.CHM(e);const n=t.oxw();return t.KtG(n.removeTaskResults())}),t._uU(1),t.ALo(2,"translate"),t.qZA()}2&s&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"FACILITY_DETAIL.SERVICES_STATUS.REMOVE_TASK_RESULTS")," "))}function Ra(s,i){1&s&&t._UZ(0,"perun-web-apps-loading-table")}function Na(s,i){if(1&s){const e=t.EpF();t.TgZ(0,"perun-web-apps-services-status-list",15),t.NdJ("selectionChange",function(){t.CHM(e);const n=t.oxw();return t.KtG(n.selectionChanged())}),t.qZA()}if(2&s){const e=t.oxw();t.Q6J("disableRouting",!e.routeAuth)("filterValue",e.filterValue)("servicesStatus",e.servicesStates)("selection",e.selected)("tableId",e.tableId)}}Z.\u0275fac=function(i){return new(i||Z)(t.Y36(d.x4),t.Y36(d.UA))},Z.\u0275cmp=t.Xpm({type:Z,selectors:[["perun-web-apps-services-status-list"]],viewQuery:function(i,e){if(1&i&&(t.Gf(p.l9,7),t.Gf(C.YE,7)),2&i){let a;t.iGM(a=t.CRH())&&(e.child=a.first),t.iGM(a=t.CRH())&&(e.matSort=a.first)}},inputs:{servicesStatus:"servicesStatus",displayedColumns:"displayedColumns",selection:"selection",filterValue:"filterValue",tableId:"tableId",disableRouting:"disableRouting"},outputs:{selectionChange:"selectionChange"},features:[t.TTD],decls:27,vars:15,consts:[[1,"card","mt-3",3,"hidden"],[3,"tableId","dataLength","pageSizeOptions","exportDisplayedData","exportAllData"],["mat-table","","matSort","","matSortActive","service.name","matSortDirection","asc","matSortDisableClear","",1,"w-100",3,"dataSource"],["matColumnDef","select",4,"ngIf"],["matColumnDef","task.id"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["mat-cell","","class","static-column-size",4,"matCellDef"],["matColumnDef","service.name"],["mat-cell","",4,"matCellDef"],["matColumnDef","status"],["matColumnDef","blocked"],["matColumnDef","task.startTime"],["matColumnDef","task.endTime"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","","class","dark-hover-list-item",3,"disable-outline","make-yellow","make-green","make-red","cursor-pointer","routerLink","perunWebAppsMiddleClickRouterLink",4,"matRowDef","matRowDefColumns"],["alert_type","warn",4,"ngIf"],["matColumnDef","select"],["mat-header-cell","","class","align-checkbox",4,"matHeaderCellDef"],["mat-cell","","class","static-column-size align-checkbox",4,"matCellDef"],["mat-header-cell","",1,"align-checkbox"],["color","primary",3,"checked","indeterminate","aria-label","change"],["mat-cell","",1,"static-column-size","align-checkbox"],["color","primary",3,"checked","aria-label","click","change"],["mat-header-cell","","mat-sort-header",""],["mat-cell","",1,"static-column-size"],[4,"ngIf"],["mat-cell",""],["class","align-text-bottom ms-1",3,"matTooltip",4,"ngIf"],[1,"align-text-bottom","ms-1",3,"matTooltip"],["mat-header-row",""],["mat-row","",1,"dark-hover-list-item",3,"routerLink","perunWebAppsMiddleClickRouterLink"],["alert_type","warn"]],template:function(i,e){1&i&&(t.TgZ(0,"div",0)(1,"perun-web-apps-table-wrapper",1),t.NdJ("exportDisplayedData",function(n){return e.exportDisplayedData(n)})("exportAllData",function(n){return e.exportAllData(n)}),t.TgZ(2,"table",2),t.YNc(3,ia,3,0,"ng-container",3),t.ALo(4,"isAllSelected"),t.ynx(5,4),t.YNc(6,sa,3,3,"th",5),t.YNc(7,oa,3,2,"td",6),t.BQk(),t.ynx(8,7),t.YNc(9,la,3,3,"th",5),t.YNc(10,ca,2,2,"td",8),t.BQk(),t.ynx(11,9),t.YNc(12,ra,3,3,"th",5),t.YNc(13,da,3,2,"td",8),t.BQk(),t.ynx(14,10),t.YNc(15,ua,3,3,"th",5),t.YNc(16,_a,3,3,"td",8),t.BQk(),t.ynx(17,11),t.YNc(18,ma,3,3,"th",5),t.YNc(19,ga,3,2,"td",8),t.BQk(),t.ynx(20,12),t.YNc(21,Ta,3,3,"th",5),t.YNc(22,Ca,3,2,"td",8),t.BQk(),t.YNc(23,ba,1,0,"tr",13),t.YNc(24,Ia,1,18,"tr",14),t.qZA()()(),t.YNc(25,ya,3,3,"perun-web-apps-alert",15),t.YNc(26,va,3,3,"perun-web-apps-alert",15)),2&i&&(t.Q6J("hidden",0===e.dataSource.filteredData.length||0===e.servicesStatus.length),t.xp6(1),t.Q6J("tableId",e.tableId)("dataLength",e.dataSource.filteredData.length)("pageSizeOptions",e.pageSizeOptions),t.xp6(1),t.Q6J("dataSource",e.dataSource),t.xp6(1),t.Q6J("ngIf",t.VKq(13,xa,t.xi3(4,10,e.dataSource,e.selection.selected.length))),t.xp6(20),t.Q6J("matHeaderRowDef",e.displayedColumns),t.xp6(1),t.Q6J("matRowDefColumns",e.displayedColumns),t.xp6(1),t.Q6J("ngIf",0===e.dataSource.filteredData.length&&0!==e.servicesStatus.length),t.xp6(1),t.Q6J("ngIf",0===e.servicesStatus.length))},dependencies:[m.O5,k.oG,c.BZ,c.fO,c.as,c.w1,c.Dz,c.nj,c.ge,c.ev,c.XQ,c.Gk,y.rH,C.YE,C.nU,U.w,K.Hw,vt.gM,lt.l,M.YH,M.QG,m.uU,h.X$,zs.e,ct.I,rt.G,pt.r],styles:[".disable-outline[_ngcontent-%COMP%]{outline:none!important}.make-green[_ngcontent-%COMP%]{background-color:#c4ffcb}.make-yellow[_ngcontent-%COMP%]{background-color:#fffde7}.make-red[_ngcontent-%COMP%]{background-color:#ffcdd2}.cursor-pointer[_ngcontent-%COMP%]{cursor:pointer}"]});class ft{constructor(i,e,a,n,o,u,f,b,F){this.tasksManager=i,this.servicesManager=e,this.notificator=a,this.translate=n,this.authResolver=o,this.facilityManager=u,this.resourcesManager=f,this.dialog=b,this.entityStorageService=F,this.servicesStates=[],this.selected=new S.Ov(!0,[]),this.filterValue="",this.tableId=v.oK,this.disableAllowButton=!0,this.disableBlockButton=!0,this.disableRemoveButton=!0,n.get("FACILITY_DETAIL.SERVICES_STATUS.SUCCESS_FORCE_PROPAGATION").subscribe(I=>this.successFPMessage=I),n.get("FACILITY_DETAIL.SERVICES_STATUS.SUCCESS_ALLOW").subscribe(I=>this.successAllowMessage=I),n.get("FACILITY_DETAIL.SERVICES_STATUS.SUCCESS_BLOCK").subscribe(I=>this.successBlockMessage=I),n.get("FACILITY_DETAIL.SERVICES_STATUS.SUCCESS_DELETE").subscribe(I=>this.successDeleteMessage=I),n.get("FACILITY_DETAIL.SERVICES_STATUS.ALREADY_DELETED").subscribe(I=>this.allreadyDeletedMessage=I)}ngOnInit(){this.loading=!0,this.facility=this.entityStorageService.getEntity(),this.setAuthRights(),this.refreshTable()}forcePropagation(){for(const i of this.selected.selected)this.servicesManager.forceServicePropagation(i.service.id,i.facility.id).subscribe(()=>{this.refreshTable(),this.notificator.showSuccess(this.successFPMessage)})}allow(){for(const i of this.selected.selected)this.servicesManager.unblockServiceOnFacility(i.service.id,i.facility.id).subscribe(()=>{this.refreshTable(),this.notificator.showSuccess(this.successAllowMessage)})}block(){for(const i of this.selected.selected)this.servicesManager.blockServiceOnFacility(i.service.id,i.facility.id).subscribe(()=>{this.refreshTable(),this.notificator.showSuccess(this.successBlockMessage)})}removeTaskResults(){this.loading=!0,this.tasksManager.getTaskResultsForGUIByTask(this.selected.selected[0].task.id).subscribe(i=>{const e=(0,p.kZ)();e.width="600px",e.data={theme:"facility-theme",taskResults:i},this.loading=!1,this.dialog.open(V,e)})}removeServiceFromFacility(){this.loading=!0,this.facilityManager.getAssignedResourcesByAssignedServiceForFacility(this.selected.selected[0].facility.id,this.selected.selected[0].service.id).subscribe({next:i=>{const e=(0,p.kZ)();e.width="600px",this.taskId=this.taskIsNull?null:this.selected.selected[0].task.id,0===i.length?(e.data={theme:"facility-theme",taskId:this.taskId},this.loading=!1,this.dialog.open(ht,e).afterClosed().subscribe(n=>{n&&(this.disableRemoveButton=!0,this.refreshTable())})):this.resourcesManager.getRichResourcesByIds(i.map(a=>a.id)).subscribe(a=>{e.data={theme:"facility-theme",taskId:this.taskId,serviceId:this.selected.selected[0].service.id,facilityId:this.selected.selected[0].facility.id,resource:a},this.loading=!1,this.dialog.open(mt,e).afterClosed().subscribe(o=>{o&&(this.disableRemoveButton=!0,this.refreshTable())})})},error:()=>this.loading=!1})}refreshTable(){this.loading=!0,this.tasksManager.getFacilityServicesState(this.facility.id).subscribe(i=>{this.servicesStates=i,this.selected.clear(),this.setAuthRights(),this.loading=!1})}setAuthRights(){this.propagationAuth=this.authResolver.isAuthorized("forceServicePropagation_Facility_Service_policy",[this.facility]),this.blockAuth=this.authResolver.isAuthorized("blockServiceOnFacility_Service_Facility_policy",[this.facility]),this.allowAuth=this.authResolver.isAuthorized("unblockServiceOnFacility_Service_Facility_policy",[this.facility]),this.deleteAuth=this.authResolver.isAuthorized("deleteTask_Task_policy",[this.facility]),this.routeAuth=this.authResolver.isAuthorized("getTaskResultsByTask_int_policy",[this.facility])}applyFilter(i){this.filterValue=i}selectionChanged(){this.disableBlockButton=!0,this.disableAllowButton=!0,this.disableRemoveButton=1!==this.selected.selected.length,this.disableRemoveButton||(this.taskIsNull=null===this.selected.selected[0].task);for(const i of this.selected.selected)i.blockedOnFacility?this.disableAllowButton=!1:this.disableBlockButton=!1}}ft.\u0275fac=function(i){return new(i||ft)(t.Y36(_.Ob),t.Y36(_.KK),t.Y36(d.V6),t.Y36(h.sK),t.Y36(d.x4),t.Y36(_.IQ),t.Y36(_.xk),t.Y36(r.uw),t.Y36(d.fb))},ft.\u0275cmp=t.Xpm({type:ft,selectors:[["app-facility-service-status"]],decls:20,vars:14,consts:[[1,"page-subtitle"],[3,"refresh"],["class","me-2","color","accent","mat-flat-button","",3,"disabled","click",4,"ngIf"],["class","me-2","color","warn","mat-flat-button","",3,"disabled","click",4,"ngIf"],["mat-flat-button","","class","me-2 dropdown-toggle","color","warn",3,"disabled","matMenuTriggerFor","matTooltipDisabled","matTooltip",4,"ngIf"],["menu","matMenu"],["mat-menu-item","",3,"click",4,"ngIf"],["mat-menu-item","",3,"click"],[3,"placeholder","filter"],["spinner",""],[1,"position-relative"],[3,"disableRouting","filterValue","servicesStatus","selection","tableId","selectionChange",4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],["color","accent","mat-flat-button","",1,"me-2",3,"disabled","click"],["color","warn","mat-flat-button","",1,"me-2",3,"disabled","click"],["mat-flat-button","","color","warn",1,"me-2","dropdown-toggle",3,"disabled","matMenuTriggerFor","matTooltipDisabled","matTooltip"],[3,"disableRouting","filterValue","servicesStatus","selection","tableId","selectionChange"]],template:function(i,e){if(1&i&&(t.TgZ(0,"div")(1,"h1",0),t._uU(2),t.ALo(3,"translate"),t.qZA(),t.TgZ(4,"perun-web-apps-refresh-button",1),t.NdJ("refresh",function(){return e.refreshTable()}),t.qZA(),t.YNc(5,La,3,4,"button",2),t.YNc(6,Ea,3,4,"button",2),t.YNc(7,Da,3,4,"button",3),t.YNc(8,Za,4,9,"button",4),t.TgZ(9,"mat-menu",null,5),t.YNc(11,Oa,3,3,"button",6),t.TgZ(12,"button",7),t.NdJ("click",function(){return e.removeServiceFromFacility()}),t._uU(13),t.ALo(14,"translate"),t.qZA()(),t.TgZ(15,"perun-web-apps-immediate-filter",8),t.NdJ("filter",function(n){return e.applyFilter(n)}),t.qZA(),t.YNc(16,Ra,1,0,"ng-template",null,9,t.W1O),t.TgZ(18,"div",10),t.YNc(19,Na,1,5,"perun-web-apps-services-status-list",11),t.qZA()()),2&i){const a=t.MAs(17);t.xp6(2),t.Oqu(t.lcZ(3,10,"FACILITY_DETAIL.SERVICES_STATUS.TITLE")),t.xp6(3),t.Q6J("ngIf",e.propagationAuth),t.xp6(1),t.Q6J("ngIf",e.allowAuth),t.xp6(1),t.Q6J("ngIf",e.blockAuth),t.xp6(1),t.Q6J("ngIf",e.deleteAuth),t.xp6(3),t.Q6J("ngIf",!e.taskIsNull),t.xp6(2),t.hij(" ",t.lcZ(14,12,"FACILITY_DETAIL.SERVICES_STATUS.REMOVE_SERVICE_FROM_FACILITY")," "),t.xp6(2),t.Q6J("placeholder","SHARED_LIB.PERUN.COMPONENTS.SERVICES_STATUS_LIST.TABLE_SEARCH"),t.xp6(4),t.Q6J("perunWebAppsLoader",e.loading)("perunWebAppsLoaderIndicator",a)}},dependencies:[m.O5,T.lW,vt.gM,wt.VK,wt.OP,wt.p6,x.K,R.t,N.L,Z,A.e,h.X$]});var Fa=l(25610),wa=l(76023);function ka(s,i){if(1&s){const e=t.EpF();t.TgZ(0,"th",21)(1,"mat-checkbox",22),t.NdJ("change",function(n){t.CHM(e);const o=t.oxw(2);return t.KtG(n?o.masterToggle():null)}),t.ALo(2,"translate"),t.ALo(3,"masterCheckboxLabel"),t.qZA()()}if(2&s){const e=t.oxw().ngIf,a=t.oxw();t.xp6(1),t.Q6J("aria-label",t.lcZ(2,3,t.lcZ(3,5,e.all)))("checked",a.selection.hasValue()&&e.all)("indeterminate",a.selection.hasValue()&&!e.all)}}const Ya=function(s){return{name:s}};function Ua(s,i){if(1&s){const e=t.EpF();t.TgZ(0,"td",23)(1,"mat-checkbox",24),t.NdJ("change",function(n){const u=t.CHM(e).$implicit,f=t.oxw(2);return t.KtG(n?f.selection.toggle(u):null)})("click",function(n){return n.stopPropagation()}),t.ALo(2,"translate"),t.ALo(3,"checkboxLabel"),t.qZA()()}if(2&s){const e=i.$implicit,a=t.oxw(2);t.xp6(1),t.Q6J("aria-label",t.xi3(2,2,t.lcZ(3,5,a.selection.isSelected(e)),t.VKq(7,Ya,e.destination.destination)))("checked",a.selection.isSelected(e))}}function Ma(s,i){1&s&&(t.ynx(0,18),t.YNc(1,ka,4,7,"th",19),t.YNc(2,Ua,4,9,"td",20),t.BQk())}function Ja(s,i){1&s&&(t.TgZ(0,"th",25),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&s&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"SHARED_LIB.PERUN.COMPONENTS.TASK_RESULTS_LIST.RESULT_ID")," "))}function Ha(s,i){if(1&s&&(t.TgZ(0,"td",26),t._uU(1),t.qZA()),2&s){const e=i.$implicit;t.xp6(1),t.Oqu(e.id)}}function Ga(s,i){1&s&&(t.TgZ(0,"th",25),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&s&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"SHARED_LIB.PERUN.COMPONENTS.TASK_RESULTS_LIST.DESTINATION")," "))}function Qa(s,i){if(1&s&&(t.TgZ(0,"td",26),t.ALo(1,"multiWordDataCy"),t._uU(2),t.qZA()),2&s){const e=i.$implicit;t.uIk("data-cy",t.lcZ(1,2,e.destination.destination)),t.xp6(2),t.hij(" ",e.destination.destination," ")}}function qa(s,i){1&s&&(t.TgZ(0,"th",25),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&s&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"SHARED_LIB.PERUN.COMPONENTS.TASK_RESULTS_LIST.TYPE")," "))}function Pa(s,i){if(1&s&&(t.TgZ(0,"td",26),t._uU(1),t.qZA()),2&s){const e=i.$implicit;t.xp6(1),t.hij(" ",e.destination.type.toUpperCase()," ")}}function Va(s,i){1&s&&(t.TgZ(0,"th",25),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&s&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"SHARED_LIB.PERUN.COMPONENTS.TASK_RESULTS_LIST.SERVICE")," "))}function Ba(s,i){if(1&s&&(t.TgZ(0,"td",26),t._uU(1),t.qZA()),2&s){const e=i.$implicit;t.xp6(1),t.hij(" ",e.service.name," ")}}function Wa(s,i){1&s&&(t.TgZ(0,"th",25),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&s&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"SHARED_LIB.PERUN.COMPONENTS.TASK_RESULTS_LIST.STATUS")," "))}function Ka(s,i){if(1&s&&(t.TgZ(0,"td",26),t._uU(1),t.qZA()),2&s){const e=i.$implicit;t.xp6(1),t.hij(" ",e.status," ")}}function ja(s,i){1&s&&(t.TgZ(0,"th",25),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&s&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"SHARED_LIB.PERUN.COMPONENTS.TASK_RESULTS_LIST.TIME")," "))}function $a(s,i){if(1&s&&(t.TgZ(0,"td",26),t._uU(1),t.ALo(2,"date"),t.qZA()),2&s){const e=i.$implicit;t.xp6(1),t.hij(" ",t.xi3(2,1,e.timestamp,"d.M.y H:mm:ss")," ")}}function za(s,i){1&s&&(t.TgZ(0,"th",25),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&s&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"SHARED_LIB.PERUN.COMPONENTS.TASK_RESULTS_LIST.RETURN_CODE")," "))}function Xa(s,i){if(1&s&&(t.TgZ(0,"td",26),t._uU(1),t.qZA()),2&s){const e=i.$implicit;t.xp6(1),t.hij(" ",e.returnCode," ")}}function tn(s,i){1&s&&(t.TgZ(0,"th",25),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&s&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"SHARED_LIB.PERUN.COMPONENTS.TASK_RESULTS_LIST.STANDARD_MESSAGE")," "))}function en(s,i){if(1&s&&(t.TgZ(0,"span"),t._uU(1),t._UZ(2,"br"),t.qZA()),2&s){const e=i.$implicit;t.xp6(1),t.Oqu(e)}}function sn(s,i){if(1&s&&(t.TgZ(0,"td",26),t.YNc(1,en,3,1,"span",27),t.qZA()),2&s){const e=i.$implicit;t.xp6(1),t.Q6J("ngForOf",e.standardMessage.split("\n"))}}function an(s,i){1&s&&(t.TgZ(0,"th",25),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&s&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"SHARED_LIB.PERUN.COMPONENTS.TASK_RESULTS_LIST.ERROR_MESSAGE")," "))}function nn(s,i){if(1&s&&(t.TgZ(0,"td",26),t._uU(1),t.qZA()),2&s){const e=i.$implicit;t.xp6(1),t.hij(" ",e.errorMessage," ")}}function on(s,i){1&s&&t._UZ(0,"tr",28)}function ln(s,i){if(1&s&&t._UZ(0,"tr",29),2&s){const e=i.$implicit;t.ekj("greenTableItem","DONE"===e.status)("redTableItem","ERROR"===e.status||"DENIED"===e.status)("yellowTableItem","WARNING"===e.status)}}function cn(s,i){1&s&&(t.TgZ(0,"perun-web-apps-alert",30),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&s&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"SHARED_LIB.UI.ALERTS.NO_FILTER_RESULTS_ALERT"),"\n"))}function rn(s,i){1&s&&(t.TgZ(0,"perun-web-apps-alert",30),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&s&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"SHARED_LIB.PERUN.COMPONENTS.TASK_RESULTS_LIST.NO_RESULTS_WARNING"),"\n"))}const pn=function(s){return{all:s}};class O{constructor(i,e){this.authResolver=i,this.tableCheckbox=e,this.taskResults=[],this.selection=new S.Ov(!0,[]),this.displayedColumns=["select","id","destination","type","service","status","time","returnCode","standardMessage","errorMessage"],this.pageSizeOptions=p.f7}set matSort(i){this.sort=i,this.setDataSource()}static getSortDataForColumn(i,e){switch(e){case"id":return i.id.toString();case"destination":return i.destination.destination;case"type":return i.destination.type;case"service":return i.service.name;case"status":return i.status;case"time":return(0,m.p6)(i.timestamp.toString(),"yyyy.MM.dd HH:mm:ss","en");case"returnCode":return i.returnCode.toString();case"standardMessage":return i.standardMessage;case"errorMessage":return i.errorMessage;default:return""}}static getDataForColumn(i,e){switch(e){case"id":return i.id.toString();case"destination":return i.destination.destination;case"type":return i.destination.type;case"service":return i.service.name;case"status":return i.status;case"time":return(0,m.p6)(i.timestamp.toString(),"d.M.y H:mm:ss","en");case"returnCode":return i.returnCode.toString();case"standardMessage":return i.standardMessage;case"errorMessage":return i.errorMessage;default:return""}}ngOnChanges(){this.authResolver.isPerunAdminOrObserver()||(this.displayedColumns=this.displayedColumns.filter(i=>"id"!==i)),this.dataSource=new c.by(this.taskResults),this.setDataSource(),this.dataSource.filter=this.filterValue}exportAllData(i){(0,p.O6)((0,p.Xn)(this.dataSource.filteredData,this.displayedColumns,O.getDataForColumn),i)}exportDisplayedData(i){const e=this.dataSource.paginator.pageIndex*this.dataSource.paginator.pageSize,a=e+this.dataSource.paginator.pageSize;(0,p.O6)((0,p.Xn)(this.dataSource.sortData(this.dataSource.filteredData,this.dataSource.sort).slice(e,a),this.displayedColumns,O.getDataForColumn),i)}setDataSource(){this.dataSource&&(this.dataSource.sort=this.sort,this.dataSource.paginator=this.child.paginator,this.dataSource.filter=this.filterValue,this.dataSource.filterPredicate=(i,e)=>(0,p.Sd)(i,e,this.displayedColumns,O.getDataForColumn),this.dataSource.sortData=(i,e)=>(0,p.pR)(i,e,O.getSortDataForColumn))}isAllSelected(){return this.tableCheckbox.isAllSelected(this.selection.selected.length,this.dataSource)}masterToggle(){this.tableCheckbox.masterToggle(this.isAllSelected(),this.selection,this.filterValue,this.dataSource,this.sort,this.child.paginator.pageSize,this.child.paginator.pageIndex,!1)}ngAfterViewInit(){this.dataSource.paginator=this.child.paginator}}function dn(s,i){if(1&s){const e=t.EpF();t.TgZ(0,"button",8),t.NdJ("click",function(){t.CHM(e);const n=t.oxw();return t.KtG(n.removeTaskResult())}),t._uU(1),t.ALo(2,"translate"),t.qZA()}if(2&s){const e=t.oxw();t.Q6J("disabled",0===e.selection.selected.length),t.xp6(1),t.hij(" ",t.lcZ(2,2,"FACILITY_DETAIL.TASK_RESULTS.REMOVE"),"\n")}}function un(s,i){1&s&&t._UZ(0,"perun-web-apps-loading-table")}function _n(s,i){if(1&s&&t._UZ(0,"perun-web-apps-task-results-list",9),2&s){const e=t.oxw();t.Q6J("tableId",e.tableId)("displayedColumns",e.displayedColumns)("filterValue",e.filterValue)("selection",e.selection)("taskResults",e.taskResults)}}O.\u0275fac=function(i){return new(i||O)(t.Y36(d.x4),t.Y36(d.UA))},O.\u0275cmp=t.Xpm({type:O,selectors:[["perun-web-apps-task-results-list"]],viewQuery:function(i,e){if(1&i&&(t.Gf(p.l9,7),t.Gf(C.YE,7)),2&i){let a;t.iGM(a=t.CRH())&&(e.child=a.first),t.iGM(a=t.CRH())&&(e.matSort=a.first)}},inputs:{taskResults:"taskResults",selection:"selection",filterValue:"filterValue",tableId:"tableId",displayedColumns:"displayedColumns"},features:[t.TTD],decls:36,vars:15,consts:[[1,"card","mt-3",3,"hidden"],[3,"tableId","dataLength","pageSizeOptions","exportDisplayedData","exportAllData"],["mat-table","","matSort","","matSortActive","time","matSortDirection","desc","matSortDisableClear","",1,"w-100",3,"dataSource"],["matColumnDef","select",4,"ngIf"],["matColumnDef","id"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["class","static-column-size","mat-cell","",4,"matCellDef"],["matColumnDef","destination"],["matColumnDef","type"],["matColumnDef","service"],["matColumnDef","status"],["matColumnDef","time"],["matColumnDef","returnCode"],["matColumnDef","standardMessage"],["matColumnDef","errorMessage"],["mat-header-row","",4,"matHeaderRowDef"],["class","dark-hover-list-item","mat-row","",3,"greenTableItem","redTableItem","yellowTableItem",4,"matRowDef","matRowDefColumns"],["alert_type","warn",4,"ngIf"],["matColumnDef","select"],["mat-header-cell","","class","align-checkbox",4,"matHeaderCellDef"],["class","static-column-size align-checkbox","mat-cell","",4,"matCellDef"],["mat-header-cell","",1,"align-checkbox"],["color","primary",3,"aria-label","checked","indeterminate","change"],["mat-cell","",1,"static-column-size","align-checkbox"],["color","primary",3,"aria-label","checked","change","click"],["mat-header-cell","","mat-sort-header",""],["mat-cell","",1,"static-column-size"],[4,"ngFor","ngForOf"],["mat-header-row",""],["mat-row","",1,"dark-hover-list-item"],["alert_type","warn"]],template:function(i,e){1&i&&(t.TgZ(0,"div",0)(1,"perun-web-apps-table-wrapper",1),t.NdJ("exportDisplayedData",function(n){return e.exportDisplayedData(n)})("exportAllData",function(n){return e.exportAllData(n)}),t.TgZ(2,"table",2),t.YNc(3,Ma,3,0,"ng-container",3),t.ALo(4,"isAllSelected"),t.ynx(5,4),t.YNc(6,Ja,3,3,"th",5),t.YNc(7,Ha,2,1,"td",6),t.BQk(),t.ynx(8,7),t.YNc(9,Ga,3,3,"th",5),t.YNc(10,Qa,3,4,"td",6),t.BQk(),t.ynx(11,8),t.YNc(12,qa,3,3,"th",5),t.YNc(13,Pa,2,1,"td",6),t.BQk(),t.ynx(14,9),t.YNc(15,Va,3,3,"th",5),t.YNc(16,Ba,2,1,"td",6),t.BQk(),t.ynx(17,10),t.YNc(18,Wa,3,3,"th",5),t.YNc(19,Ka,2,1,"td",6),t.BQk(),t.ynx(20,11),t.YNc(21,ja,3,3,"th",5),t.YNc(22,$a,3,4,"td",6),t.BQk(),t.ynx(23,12),t.YNc(24,za,3,3,"th",5),t.YNc(25,Xa,2,1,"td",6),t.BQk(),t.ynx(26,13),t.YNc(27,tn,3,3,"th",5),t.YNc(28,sn,2,1,"td",6),t.BQk(),t.ynx(29,14),t.YNc(30,an,3,3,"th",5),t.YNc(31,nn,2,1,"td",6),t.BQk(),t.YNc(32,on,1,0,"tr",15),t.YNc(33,ln,1,6,"tr",16),t.qZA()()(),t.YNc(34,cn,3,3,"perun-web-apps-alert",17),t.YNc(35,rn,3,3,"perun-web-apps-alert",17)),2&i&&(t.Q6J("hidden",0===e.dataSource.filteredData.length||0===e.taskResults.length),t.xp6(1),t.Q6J("tableId",e.tableId)("dataLength",e.dataSource.filteredData.length)("pageSizeOptions",e.pageSizeOptions),t.xp6(1),t.Q6J("dataSource",e.dataSource),t.xp6(1),t.Q6J("ngIf",t.VKq(13,pn,t.xi3(4,10,e.dataSource,e.selection.selected.length))),t.xp6(29),t.Q6J("matHeaderRowDef",e.displayedColumns),t.xp6(1),t.Q6J("matRowDefColumns",e.displayedColumns),t.xp6(1),t.Q6J("ngIf",0===e.dataSource.filteredData.length&&0!==e.taskResults.length),t.xp6(1),t.Q6J("ngIf",0===e.taskResults.length))},dependencies:[m.sg,m.O5,k.oG,c.BZ,c.fO,c.as,c.w1,c.Dz,c.nj,c.ge,c.ev,c.XQ,c.Gk,C.YE,C.nU,U.w,lt.l,m.uU,h.X$,Kt.R,ct.I,rt.G,pt.r],styles:[".greenTableItem[_ngcontent-%COMP%]{background-color:#c4ffcb}.yellowTableItem[_ngcontent-%COMP%]{background-color:#fffde7}.redTableItem[_ngcontent-%COMP%]{background-color:#ffcdd2}"]});class gt{constructor(i,e,a,n,o){this.route=i,this.taskManager=e,this.authResolver=a,this.dialog=n,this.entityStorageService=o,this.loading=!1,this.filterValue="",this.selection=new S.Ov(!0,[]),this.task={id:0},this.taskResults=[],this.tableId=v.e5,this.displayedColumns=["select","id","destination","type","service","status","time","returnCode","standardMessage","errorMessage"],this.removeAuth=!1}ngOnInit(){this.loading=!0,this.facility=this.entityStorageService.getEntity(),this.removeAuth=this.authResolver.isAuthorized("deleteTask_Task_policy",[this.facility]),this.removeAuth||(this.displayedColumns=["id","destination","type","service","status","time","returnCode","standardMessage","errorMessage"]),this.route.params.subscribe(i=>{this.taskId=Number(i.taskId),this.taskManager.getTaskById(this.taskId).subscribe(e=>{this.task=e,this.refreshTable()})})}refreshTable(){this.loading=!0,this.taskManager.getTaskResultsForGUIByTask(this.taskId).subscribe(i=>{this.selection.clear(),this.taskResults=i,this.loading=!1})}removeTaskResult(){const i=(0,p.kZ)();i.width="600px",i.data={theme:"facility-theme",taskResults:this.selection.selected},this.dialog.open(V,i).afterClosed().subscribe(a=>{a&&this.refreshTable()})}applyFilter(i){this.filterValue=i}}gt.\u0275fac=function(i){return new(i||gt)(t.Y36(y.gz),t.Y36(_.Ob),t.Y36(d.x4),t.Y36(r.uw),t.Y36(d.fb))},gt.\u0275cmp=t.Xpm({type:gt,selectors:[["app-facility-task-results"]],decls:12,vars:9,consts:[[1,"page-subtitle"],[1,"text-muted"],[3,"refresh"],["class","me-2","color","warn","mat-flat-button","",3,"disabled","click",4,"ngIf"],[3,"placeholder","filter"],["spinner",""],[1,"position-relative"],[3,"tableId","displayedColumns","filterValue","selection","taskResults",4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],["color","warn","mat-flat-button","",1,"me-2",3,"disabled","click"],[3,"tableId","displayedColumns","filterValue","selection","taskResults"]],template:function(i,e){if(1&i&&(t.TgZ(0,"h1",0),t._uU(1),t.ALo(2,"translate"),t.TgZ(3,"span",1),t._uU(4),t.qZA()(),t.TgZ(5,"perun-web-apps-refresh-button",2),t.NdJ("refresh",function(){return e.refreshTable()}),t.qZA(),t.YNc(6,dn,3,4,"button",3),t.TgZ(7,"perun-web-apps-immediate-filter",4),t.NdJ("filter",function(n){return e.applyFilter(n)}),t.qZA(),t.YNc(8,un,1,0,"ng-template",null,5,t.W1O),t.TgZ(10,"div",6),t.YNc(11,_n,1,5,"perun-web-apps-task-results-list",7),t.qZA()),2&i){const a=t.MAs(9);t.xp6(1),t.AsE(" ",t.lcZ(2,7,"FACILITY_DETAIL.TASK_RESULTS.TITLE")," - ",e.task.service?e.task.service.name:""," "),t.xp6(3),t.hij(" \xa0#",e.task.id," "),t.xp6(2),t.Q6J("ngIf",e.removeAuth),t.xp6(1),t.Q6J("placeholder","FACILITY_DETAIL.TASK_RESULTS.FILTER"),t.xp6(4),t.Q6J("perunWebAppsLoader",e.loading)("perunWebAppsLoaderIndicator",a)}},dependencies:[m.O5,T.lW,x.K,R.t,N.L,O,A.e,h.X$]});var mn=l(20872);class Tt{constructor(i,e){this.dialogRef=i,this.data=e,this.theme=""}ngOnInit(){this.theme=this.data.theme}onCancel(){this.dialogRef.close(!1)}onSkip(){this.dialogRef.close(!0)}}Tt.\u0275fac=function(i){return new(i||Tt)(t.Y36(r.so),t.Y36(r.WI))},Tt.\u0275cmp=t.Xpm({type:Tt,selectors:[["app-no-service-dialog"]],decls:14,vars:15,consts:[["mat-dialog-title",""],["mat-dialog-content",""],["matDialogActions",""],["mat-flat-button","",1,"ms-auto","me-2",3,"click"],["color","accent","mat-flat-button","",3,"click"]],template:function(i,e){1&i&&(t.TgZ(0,"div")(1,"h1",0),t._uU(2),t.ALo(3,"translate"),t.qZA(),t.TgZ(4,"div",1),t._uU(5),t.ALo(6,"translate"),t.qZA(),t.TgZ(7,"div",2)(8,"button",3),t.NdJ("click",function(){return e.onCancel()}),t._uU(9),t.ALo(10,"translate"),t.qZA(),t.TgZ(11,"button",4),t.NdJ("click",function(){return e.onSkip()}),t._uU(12),t.ALo(13,"translate"),t.qZA()()()),2&i&&(t.Tol(e.theme),t.xp6(2),t.Oqu(t.lcZ(3,7,"DIALOGS.NO_SERVICE.TITLE")),t.xp6(3),t.hij(" ",t.lcZ(6,9,"DIALOGS.NO_SERVICE.INFO")," "),t.xp6(4),t.hij(" ",t.lcZ(10,11,"DIALOGS.NO_SERVICE.CANCEL")," "),t.xp6(3),t.hij(" ",t.lcZ(13,13,"DIALOGS.NO_SERVICE.SKIP")," "))},dependencies:[T.lW,r.uh,r.xY,r.H8,h.X$]});class St{constructor(i,e){this.dialogRef=i,this.data=e,this.theme=""}ngOnInit(){this.theme=this.data.theme}onCancel(){this.dialogRef.close(!1)}onSkip(){this.dialogRef.close(!0)}}function hn(s,i){if(1&s&&(t.TgZ(0,"div",3),t._UZ(1,"i",4),t.ALo(2,"translate"),t.qZA()),2&s){const e=t.oxw();t.xp6(1),t.Q6J("innerHTML",t.lcZ(2,1,e.info),t.oJD)}}function fn(s,i){if(1&s){const e=t.EpF();t.TgZ(0,"button",10),t.NdJ("click",function(){t.CHM(e);const n=t.oxw(2);return t.KtG(n.onKeep())}),t._uU(1),t.ALo(2,"translate"),t.qZA()}2&s&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"DIALOGS.CANCEL_CONFIG.KEEP")," "))}function gn(s,i){if(1&s){const e=t.EpF();t.TgZ(0,"div",5)(1,"button",6),t.NdJ("click",function(){t.CHM(e);const n=t.oxw();return t.KtG(n.onCancel())}),t._uU(2),t.ALo(3,"translate"),t.qZA(),t.TgZ(4,"button",7),t.NdJ("click",function(){t.CHM(e);const n=t.oxw();return t.KtG(n.onDelete())}),t.TgZ(5,"mat-icon",8),t._uU(6," warning "),t.qZA(),t._uU(7),t.ALo(8,"translate"),t.qZA(),t.YNc(9,fn,3,3,"button",9),t.qZA()}if(2&s){const e=t.oxw();t.xp6(2),t.hij(" ",t.lcZ(3,3,"DIALOGS.CANCEL_CONFIG.CANCEL")," "),t.xp6(5),t.hij(" ",t.lcZ(8,5,"DIALOGS.CANCEL_CONFIG.DELETE")," "),t.xp6(2),t.Q6J("ngIf",!e.lastStep)}}St.\u0275fac=function(i){return new(i||St)(t.Y36(r.so),t.Y36(r.WI))},St.\u0275cmp=t.Xpm({type:St,selectors:[["app-config-unsaved-dialog"]],decls:14,vars:15,consts:[["mat-dialog-title",""],["mat-dialog-content",""],["matDialogActions",""],["mat-flat-button","",1,"ms-auto","me-2",3,"click"],["color","accent","mat-flat-button","",3,"click"]],template:function(i,e){1&i&&(t.TgZ(0,"div")(1,"h1",0),t._uU(2),t.ALo(3,"translate"),t.qZA(),t.TgZ(4,"div",1),t._uU(5),t.ALo(6,"translate"),t.qZA(),t.TgZ(7,"div",2)(8,"button",3),t.NdJ("click",function(){return e.onCancel()}),t._uU(9),t.ALo(10,"translate"),t.qZA(),t.TgZ(11,"button",4),t.NdJ("click",function(){return e.onSkip()}),t._uU(12),t.ALo(13,"translate"),t.qZA()()()),2&i&&(t.Tol(e.theme),t.xp6(2),t.Oqu(t.lcZ(3,7,"DIALOGS.CONFIG_UNSAVED.TITLE")),t.xp6(3),t.hij(" ",t.lcZ(6,9,"DIALOGS.CONFIG_UNSAVED.INFO")," "),t.xp6(4),t.hij(" ",t.lcZ(10,11,"DIALOGS.CONFIG_UNSAVED.CANCEL")," "),t.xp6(3),t.hij(" ",t.lcZ(13,13,"DIALOGS.CONFIG_UNSAVED.SKIP")," "))},dependencies:[T.lW,r.uh,r.xY,r.H8,h.X$]});class At{constructor(i,e,a,n,o){this.dialogRef=i,this.data=e,this.facilityService=a,this.notificator=n,this.translate=o,this.theme="",this.title="",this.info="",this.loading=!1}ngOnInit(){this.theme=this.data.theme,this.lastStep=this.data.lastStep,this.lastStep?(this.title="DIALOGS.CANCEL_CONFIG.TITLE_COMPLETE",this.info="DIALOGS.CANCEL_CONFIG.INFO_COMPLETE"):(this.title="DIALOGS.CANCEL_CONFIG.TITLE_INCOMPLETE",this.info="DIALOGS.CANCEL_CONFIG.INFO_INCOMPLETE")}onCancel(){this.dialogRef.close(!1)}onDelete(){this.loading=!0,this.facilityService.deleteFacility(this.data.facilityId,!0).subscribe(()=>{this.notificator.showSuccess(this.translate.instant("DIALOGS.CANCEL_CONFIG.SUCCESS")),this.dialogRef.close(!0),this.loading=!1},()=>this.loading=!1)}onKeep(){this.dialogRef.close(!0)}}At.\u0275fac=function(i){return new(i||At)(t.Y36(r.so),t.Y36(r.WI),t.Y36(_.IQ),t.Y36(d.V6),t.Y36(h.sK))},At.\u0275cmp=t.Xpm({type:At,selectors:[["app-cancel-configuration-dialog"]],decls:6,vars:8,consts:[["mat-dialog-title",""],["mat-dialog-content","",4,"ngIf"],["matDialogActions","",4,"ngIf"],["mat-dialog-content",""],[3,"innerHTML"],["matDialogActions",""],["mat-flat-button","",1,"me-2",3,"click"],["color","warn","mat-flat-button","",1,"ms-auto","me-2",3,"click"],["iconPositionEnd",""],["color","accent","mat-flat-button","",3,"click",4,"ngIf"],["color","accent","mat-flat-button","",3,"click"]],template:function(i,e){1&i&&(t.TgZ(0,"div")(1,"h1",0),t._uU(2),t.ALo(3,"translate"),t.qZA(),t.YNc(4,hn,3,3,"div",1),t.YNc(5,gn,10,7,"div",2),t.qZA()),2&i&&(t.Tol(e.theme),t.xp6(2),t.Oqu(t.lcZ(3,6,e.title)),t.xp6(2),t.Q6J("ngIf",!e.loading),t.xp6(1),t.Q6J("ngIf",!e.loading))},dependencies:[m.O5,K.Hw,T.lW,r.uh,r.xY,r.H8,h.X$]});var Dt=l(86257),Zt=l(37084),Tn=l(60205),Sn=l(90439),An=l(30540);const Cn=["stepper"];function bn(s,i){1&s&&(t._uU(0),t.ALo(1,"translate")),2&s&&t.Oqu(t.lcZ(1,1,"FACILITY_CONFIGURATION.OWNERS"))}function In(s,i){if(1&s){const e=t.EpF();t.TgZ(0,"app-facility-settings-owners",14),t.NdJ("ownerEmitter",function(n){t.CHM(e);const o=t.oxw();return t.KtG(o.owners=n)}),t.qZA()}}function yn(s,i){1&s&&(t._uU(0),t.ALo(1,"translate")),2&s&&t.Oqu(t.lcZ(1,1,"FACILITY_CONFIGURATION.HOSTS"))}function vn(s,i){if(1&s){const e=t.EpF();t.TgZ(0,"app-facility-hosts",15),t.NdJ("hostEmitter",function(n){t.CHM(e);const o=t.oxw();return t.KtG(o.hosts=n)}),t.qZA()}2&s&&t.Q6J("disableRouting",!0)}function xn(s,i){1&s&&(t._uU(0),t.ALo(1,"translate")),2&s&&t.Oqu(t.lcZ(1,1,"FACILITY_CONFIGURATION.SERVICES"))}const Ln=function(){return["select","id","name","enabled","description"]};function En(s,i){if(1&s){const e=t.EpF();t.TgZ(0,"h1",16),t._uU(1),t.ALo(2,"translate"),t.qZA(),t.TgZ(3,"perun-web-apps-alert",17),t._uU(4),t.ALo(5,"translate"),t.qZA(),t.TgZ(6,"div",18)(7,"perun-web-apps-immediate-filter",19),t.NdJ("filter",function(n){t.CHM(e);const o=t.oxw();return t.KtG(o.applyFilter(n))}),t.qZA(),t.TgZ(8,"perun-web-apps-service-package-search-select",20),t.NdJ("packageSelected",function(n){t.CHM(e);const o=t.oxw();return t.KtG(o.packagesSelected(n))}),t.qZA()(),t.TgZ(9,"app-services-list",21),t.NdJ("selectionChanged",function(){t.CHM(e);const n=t.oxw();return t.KtG(n.singleServiceSelected())}),t.qZA()}if(2&s){const e=t.oxw();t.xp6(1),t.Oqu(t.lcZ(2,13,"FACILITY_CONFIGURATION.SERVICES")),t.xp6(3),t.hij(" ",t.lcZ(5,15,"FACILITY_CONFIGURATION.SERVICES_INFO")," "),t.xp6(3),t.Q6J("placeholder","FACILITY_CONFIGURATION.SERVICES_FILTER"),t.xp6(1),t.Q6J("disableAutoSelect",!0)("selectedPackage",e.selectedPackages)("multiple",!0)("servicePackages",e.servicePackages)("theme","facility-theme"),t.xp6(1),t.Q6J("disableRouting",!0)("displayedColumns",t.DdM(17,Ln))("selection",e.selection)("filterValue",e.filterValue)("services",e.services)}}function Dn(s,i){1&s&&(t._uU(0),t.ALo(1,"translate")),2&s&&t.Oqu(t.lcZ(1,1,"FACILITY_CONFIGURATION.SERVICE_CONFIG"))}function Zn(s,i){if(1&s){const e=t.EpF();t.TgZ(0,"perun-web-apps-service-search-select",28),t.NdJ("serviceSelected",function(n){t.CHM(e);const o=t.oxw(2);return t.KtG(o.filterAttributes(n))}),t.qZA()}if(2&s){const e=t.oxw(2);t.Q6J("disableAutoSelect",!0)("services",e.selection.selected)("multiple",!0)("theme","facility-theme")}}function On(s,i){1&s&&t._UZ(0,"perun-web-apps-loading-table")}function Rn(s,i){if(1&s&&t._UZ(0,"perun-web-apps-attributes-list",29),2&s){const e=t.oxw(2);t.Q6J("emptyListText","FACILITY_CONFIGURATION.EMPTY_REQ_ATT")("attributes",e.filteredAttributes)("selection",e.attSelection)}}function Nn(s,i){if(1&s){const e=t.EpF();t.TgZ(0,"h1",16),t._uU(1),t.ALo(2,"translate"),t.qZA(),t.TgZ(3,"perun-web-apps-alert",17),t._uU(4),t.ALo(5,"translate"),t.qZA(),t.TgZ(6,"div",18)(7,"button",22),t.NdJ("click",function(){t.CHM(e);const n=t.oxw();return t.KtG(n.onRemoveAttributes())}),t._uU(8),t.ALo(9,"translate"),t.qZA(),t.TgZ(10,"button",23),t.NdJ("click",function(){t.CHM(e);const n=t.oxw();return t.KtG(n.onSaveAttributes())}),t._uU(11),t.ALo(12,"translate"),t.qZA(),t.YNc(13,Zn,1,4,"perun-web-apps-service-search-select",24),t.qZA(),t.YNc(14,On,1,0,"ng-template",null,25,t.W1O),t.TgZ(16,"div",26),t.YNc(17,Rn,1,3,"perun-web-apps-attributes-list",27),t.qZA()}if(2&s){const e=t.MAs(15),a=t.oxw(),n=t.MAs(5);t.xp6(1),t.Oqu(t.lcZ(2,9,"FACILITY_CONFIGURATION.SERVICE_CONFIG")),t.xp6(3),t.hij(" ",t.lcZ(5,11,"FACILITY_CONFIGURATION.ATT_INFO")," "),t.xp6(3),t.Q6J("disabled",0===a.attSelection.selected.length),t.xp6(1),t.hij(" ",t.lcZ(9,13,"FACILITY_CONFIGURATION.REMOVE")," "),t.xp6(2),t.Q6J("disabled",0===a.attSelection.selected.length),t.xp6(1),t.hij(" ",t.lcZ(12,15,"FACILITY_CONFIGURATION.SAVE")," "),t.xp6(2),t.Q6J("ngIf",n.selectedIndex===a.ATTRIBUTES_IDX),t.xp6(4),t.Q6J("perunWebAppsLoader",a.processing)("perunWebAppsLoaderIndicator",e)}}function Fn(s,i){1&s&&(t._uU(0),t.ALo(1,"translate")),2&s&&t.Oqu(t.lcZ(1,1,"FACILITY_CONFIGURATION.DESTINATION_CONFIG"))}const wn=function(){return["select","destinationId","service","warn","destination","type","propagationType"]};function kn(s,i){if(1&s){const e=t.EpF();t.TgZ(0,"app-perun-web-apps-facility-services-destinations",30),t.NdJ("destinationEmitter",function(n){t.CHM(e);const o=t.oxw();return t.KtG(o.destinations=n)}),t.qZA()}if(2&s){const e=t.oxw();t.Q6J("configServicesIds",e.serviceIds)("displayedColumns",t.DdM(5,wn))("configServices",e.selection.selected)("loading",e.processing)("title","FACILITY_CONFIGURATION.DESTINATION_CONFIG")}}function Yn(s,i){1&s&&(t._uU(0),t.ALo(1,"translate")),2&s&&t.Oqu(t.lcZ(1,1,"FACILITY_CONFIGURATION.MANAGERS"))}function Un(s,i){1&s&&t._UZ(0,"app-perun-web-apps-facility-settings-managers",31),2&s&&t.Q6J("disableRouting",!0)("disableSelf",!0)}function Mn(s,i){1&s&&(t._uU(0),t.ALo(1,"translate")),2&s&&t.Oqu(t.lcZ(1,1,"FACILITY_CONFIGURATION.SUMMARY"))}function Jn(s,i){1&s&&t._UZ(0,"perun-web-apps-loading-table")}const Hn=function(){return["id","name","contact","type"]};function Gn(s,i){if(1&s&&t._UZ(0,"perun-web-apps-owners-list",48),2&s){const e=t.oxw(3);t.Q6J("displayedColumns",t.DdM(2,Hn))("owners",e.owners)}}function Qn(s,i){1&s&&t._UZ(0,"perun-web-apps-loading-table")}const qn=function(){return["id","name"]};function Pn(s,i){if(1&s&&t._UZ(0,"app-hosts-list",49),2&s){const e=t.oxw(3);t.Q6J("disableRouting",!0)("displayedColumns",t.DdM(3,qn))("hosts",e.hosts)}}function Vn(s,i){1&s&&t._UZ(0,"perun-web-apps-loading-table")}const Bn=function(){return["destinationId","service","warn","destination","type","propagationType"]};function Wn(s,i){if(1&s&&t._UZ(0,"app-perun-web-apps-destination-list",50),2&s){const e=t.oxw(3);t.Q6J("destinations",e.destinations)("displayedColumns",t.DdM(3,Bn))("services",e.serviceIds)}}const Kn=function(){return["id","name","enabled","script","description"]},jn=function(){return["id","displayName","value","description"]},$n=function(){return["id","vo","name","description"]},zn=function(){return["id","name","email","logins","organization"]};function Xn(s,i){if(1&s){const e=t.EpF();t.TgZ(0,"mat-accordion")(1,"mat-expansion-panel",34)(2,"mat-expansion-panel-header")(3,"mat-panel-title"),t._UZ(4,"mat-icon",35),t._uU(5),t.ALo(6,"translate"),t.qZA()(),t.TgZ(7,"h1",16),t._uU(8),t.ALo(9,"translate"),t.qZA(),t.YNc(10,Jn,1,0,"ng-template",null,25,t.W1O),t.TgZ(12,"div",26),t.YNc(13,Gn,1,3,"perun-web-apps-owners-list",36),t.qZA()(),t.TgZ(14,"mat-expansion-panel",34)(15,"mat-expansion-panel-header")(16,"mat-panel-title"),t._UZ(17,"mat-icon",37),t._uU(18),t.ALo(19,"translate"),t.qZA()(),t.TgZ(20,"h1",16),t._uU(21),t.ALo(22,"translate"),t.qZA(),t.YNc(23,Qn,1,0,"ng-template",null,25,t.W1O),t.TgZ(25,"div",26),t.YNc(26,Pn,1,4,"app-hosts-list",38),t.qZA()(),t.TgZ(27,"mat-expansion-panel",34)(28,"mat-expansion-panel-header")(29,"mat-panel-title"),t._UZ(30,"mat-icon",39),t._uU(31),t.ALo(32,"translate"),t.qZA()(),t.TgZ(33,"h1",16),t._uU(34),t.ALo(35,"translate"),t.qZA(),t._UZ(36,"app-services-list",40),t.qZA(),t.TgZ(37,"mat-expansion-panel",41),t.NdJ("opened",function(){t.CHM(e);const n=t.oxw(2);return t.KtG(n.getNonEmptyAttributes())}),t.TgZ(38,"mat-expansion-panel-header")(39,"mat-panel-title"),t._UZ(40,"mat-icon",37),t._uU(41),t.ALo(42,"translate"),t.qZA()(),t.TgZ(43,"h1",16),t._uU(44),t.ALo(45,"translate"),t.qZA(),t._UZ(46,"perun-web-apps-attributes-list",42),t.qZA(),t.TgZ(47,"mat-expansion-panel",43),t.NdJ("expandedChange",function(n){t.CHM(e);const o=t.oxw(2);return t.KtG(o.destinationServiceMissing=n)}),t.TgZ(48,"mat-expansion-panel-header")(49,"mat-panel-title"),t._UZ(50,"mat-icon",44),t._uU(51),t.ALo(52,"translate"),t.qZA()(),t.TgZ(53,"h1",16),t._uU(54),t.ALo(55,"translate"),t.qZA(),t.YNc(56,Vn,1,0,"ng-template",null,25,t.W1O),t.TgZ(58,"div",26),t.YNc(59,Wn,1,4,"app-perun-web-apps-destination-list",45),t.qZA()(),t.TgZ(60,"mat-expansion-panel")(61,"mat-expansion-panel-header")(62,"mat-panel-title"),t._UZ(63,"mat-icon",46),t._uU(64),t.ALo(65,"translate"),t.qZA()(),t._UZ(66,"app-managers-page",47),t.qZA()()}if(2&s){const e=t.MAs(11),a=t.oxw(2);t.Q6J("@.disabled",!0),t.xp6(1),t.Q6J("disabled",0===a.owners.length),t.xp6(1),t.ekj("cursor-default",0===a.owners.length),t.xp6(3),t.hij(" ",t.lcZ(6,47,"FACILITY_CONFIGURATION.OWNERS")," "),t.xp6(3),t.Oqu(t.lcZ(9,49,"FACILITY_CONFIGURATION.OWNERS")),t.xp6(5),t.Q6J("perunWebAppsLoader",a.processing)("perunWebAppsLoaderIndicator",e),t.xp6(1),t.Q6J("disabled",0===a.hosts.length),t.xp6(1),t.ekj("cursor-default",0===a.hosts.length),t.xp6(3),t.hij(" ",t.lcZ(19,51,"FACILITY_CONFIGURATION.HOSTS")," "),t.xp6(3),t.Oqu(t.lcZ(22,53,"FACILITY_CONFIGURATION.HOSTS")),t.xp6(5),t.Q6J("perunWebAppsLoader",a.processing)("perunWebAppsLoaderIndicator",e),t.xp6(1),t.Q6J("disabled",0===a.selection.selected.length),t.xp6(1),t.ekj("cursor-default",0===a.selection.selected.length),t.xp6(3),t.hij(" ",t.lcZ(32,55,"FACILITY_CONFIGURATION.SERVICES")," "),t.xp6(3),t.Oqu(t.lcZ(35,57,"FACILITY_CONFIGURATION.SERVICES")),t.xp6(2),t.Q6J("disableRouting",!0)("displayedColumns",t.DdM(69,Kn))("services",a.selection.selected),t.xp6(1),t.Q6J("disabled",0===a.selection.selected.length),t.xp6(1),t.ekj("cursor-default",0===a.selection.selected.length),t.xp6(3),t.hij(" ",t.lcZ(42,59,"FACILITY_CONFIGURATION.SERVICE_CONFIG")," "),t.xp6(3),t.Oqu(t.lcZ(45,61,"FACILITY_CONFIGURATION.ATTS")),t.xp6(2),t.Q6J("displayedColumns",t.DdM(70,jn))("attributes",a.filteredAttributes)("emptyListText","FACILITY_CONFIGURATION.EMPTY_REQ_ATT"),t.xp6(1),t.Q6J("expanded",a.destinationServiceMissing)("disabled",0===a.selection.selected.length&&0===a.destinations.length),t.xp6(1),t.ekj("cursor-default",0===a.selection.selected.length&&0===a.destinations.length),t.xp6(3),t.hij(" ",t.lcZ(52,63,"FACILITY_CONFIGURATION.DESTINATION_CONFIG")," "),t.xp6(3),t.Oqu(t.lcZ(55,65,"FACILITY_CONFIGURATION.DESTINATION")),t.xp6(5),t.Q6J("perunWebAppsLoader",a.processing)("perunWebAppsLoaderIndicator",e),t.xp6(5),t.hij(" ",t.lcZ(65,67,"FACILITY_CONFIGURATION.MANAGERS")," "),t.xp6(2),t.Q6J("complementaryObject",a.facility)("configMode",!0)("disableRouting",!0)("availableRoles",a.availableRoles)("complementaryObjectType","Facility")("displayedGroupColumns",t.DdM(71,$n))("displayedUserColumns",t.DdM(72,zn))}}function to(s,i){if(1&s&&(t.TgZ(0,"perun-web-apps-alert",17),t._UZ(1,"i",32),t.ALo(2,"translate"),t.qZA(),t.YNc(3,Xn,67,73,"mat-accordion",33)),2&s){t.oxw();const e=t.MAs(5);t.xp6(1),t.Q6J("innerHTML",t.lcZ(2,2,"FACILITY_CONFIGURATION.SUMMARY_INFO"),t.oJD),t.xp6(2),t.Q6J("ngIf",e.selectedIndex===e.steps.length-1)}}function eo(s,i){if(1&s){const e=t.EpF();t.TgZ(0,"button",51),t.NdJ("click",function(){t.CHM(e);const n=t.oxw();return t.KtG(n.back())}),t._uU(1),t.ALo(2,"translate"),t.qZA()}2&s&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"FACILITY_CONFIGURATION.BACK")," "))}function io(s,i){if(1&s){const e=t.EpF();t.TgZ(0,"button",52),t.NdJ("click",function(){t.CHM(e);const n=t.oxw();return t.KtG(n.next())}),t._uU(1),t.ALo(2,"translate"),t.qZA()}if(2&s){t.oxw();const e=t.MAs(5);t.ekj("me-2",void 0!==e&&0!==e.selectedIndex)("ms-auto",!(void 0!==e&&0!==e.selectedIndex)),t.xp6(1),t.hij(" ",t.lcZ(2,5,"FACILITY_CONFIGURATION.NEXT")," ")}}function so(s,i){if(1&s){const e=t.EpF();t.TgZ(0,"button",53),t.NdJ("click",function(){t.CHM(e);const n=t.oxw();return t.KtG(n.onFinish())}),t._uU(1),t.ALo(2,"translate"),t.qZA()}2&s&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"FACILITY_CONFIGURATION.FINISH")," "))}class Ct{constructor(i,e,a,n,o,u,f,b,F,I){this.attributesManager=i,this.serviceManager=e,this.facilityService=a,this.cd=n,this.dialog=o,this.notificator=u,this.translate=f,this.router=b,this.guiAuthResolver=F,this.entityStorageService=I,this.processing=!1,this.filteredAttributes=[],this.attSelection=new S.Ov(!0,[]),this.services=[],this.serviceIds=new Set,this.servicePackages=[],this.selectedPackages=[],this.selection=new S.Ov(!0,[]),this.owners=[],this.hosts=[],this.destinations=[],this.destinationServiceMissing=!1,this.availableRoles=[],this.filterValue="",this.ATTRIBUTES_IDX=3,this.serviceControl=new g.p4(!1,g.kI.requiredTrue),this.attributesControl=new g.p4(!0,g.kI.requiredTrue),this.allowNavigate=!1,this.attributes=[],this.attributeIds=new Set,this.attributesPerService=new Map,this.servicesPerPackage=new Map,this.saveMsg="",this.removeMsg="",this.BEFORE_OPTIONAL_IDX=2,this.DESTINATIONS_IDX=4,this.AFTER_OPTIONAL_IDX=5,this.translate.get("FACILITY_CONFIGURATION.ATT_SAVED").subscribe(Ut=>this.saveMsg=Ut),this.translate.get("FACILITY_CONFIGURATION.ATT_REMOVED").subscribe(Ut=>this.removeMsg=Ut)}ngOnInit(){this.facility=this.entityStorageService.getEntity(),this.guiAuthResolver.assignAvailableRoles(this.availableRoles,"Facility"),this.serviceManager.getServicesPackages().subscribe(i=>{this.servicePackages=i,this.getServicePackageServices(i,0)})}ngAfterViewInit(){this.cd.detectChanges(),this.attSelection.changed.subscribe(()=>{this.attributesControl.setValue(0===this.attSelection.selected.length)})}onCancel(){const i=(0,p.kZ)();i.width="550px",i.data={facilityId:this.facility.id,lastStep:this.stepper.selectedIndex===this.stepper.steps.length-1,theme:"facility-theme"},this.dialog.open(At,i).afterClosed().subscribe(a=>{a&&(this.allowNavigate=!0,sessionStorage.removeItem("newFacilityId"),this.router.navigate(["facilities"],{queryParamsHandling:"merge"}))})}packagesSelected(i){if(this.packageSelectionEqual(i))return;this.processing=!0;let e=new Set;if(i&&0!==i.length?e=this.setSymDif(this.selectedPackages,i):this.selectedPackages.forEach(o=>{this.servicesPerPackage.get(o.id).forEach(u=>e.add(u))}),0===e.size)return;const a=this.filterService(e,i.filter(o=>this.selectedPackages.findIndex(u=>u.id===o.id)<0)),n=this.filterService(e,this.selectedPackages.filter(o=>i.findIndex(u=>u.id===o.id)<0));for(const o of this.services)a.has(o.id)?this.selection.select(o):n.has(o.id)&&this.selection.deselect(o);this.selectedPackages=i,this.setServiceControl(),this.processing=!1}singleServiceSelected(){this.setServiceControl(),!this.processing&&this.checkPackageComplete()}back(){this.stepper.selectedIndex<=this.BEFORE_OPTIONAL_IDX&&this.setServiceControl(),this.stepper.selectedIndex===this.AFTER_OPTIONAL_IDX&&0===this.selection.selected.length?this.stepper.selectedIndex=this.BEFORE_OPTIONAL_IDX:this.stepper.previous()}onSaveAttributes(){return new Promise((i,e)=>{this.processing=!0,this.attributesManager.setFacilityAttributes({facility:this.facility.id,attributes:this.attSelection.selected}).subscribe({next:()=>{this.notificator.showSuccess(this.saveMsg),this.attSelection.clear(),this.processing=!1,i()},error:()=>{this.processing=!1,e()}})})}next(){this.checkDestinationDependency(this.stepper.selectedIndex),this.stepper.selectedIndex===this.BEFORE_OPTIONAL_IDX?0===this.selection.selected.length?this.openSkipDialog():(this.getRequiredAttributes(),this.stepper.next()):this.stepper.selectedIndex===this.ATTRIBUTES_IDX&&0!==this.attSelection.selected.length?this.openUnsavedAttsDialog():this.stepper.next()}onFinish(){this.allowNavigate=!0,sessionStorage.removeItem("newFacilityId"),this.router.navigate(["facilities",this.facility.id],{queryParamsHandling:"merge"})}onRemoveAttributes(){this.processing=!0;const i=this.attSelection.selected.map(e=>e.id);this.attributesManager.removeFacilityAttributes(this.facility.id,i).subscribe({next:()=>{this.notificator.showSuccess(this.removeMsg),this.getRequiredAttributes(),this.processing=!1},error:()=>this.processing=!1})}filterAttributes(i){if(void 0===i||0===i.length)return void(this.filteredAttributes=this.attributes);const e=new Set;for(const a of i)this.attributesPerService.get(a.id).forEach(n=>e.add(n));this.filteredAttributes=[];for(const a of this.attributes)e.has(a.id)&&this.filteredAttributes.push(a)}getNonEmptyAttributes(){this.filteredAttributes=this.attributes.filter(i=>{if(i.value&&(!Array.isArray(i.value)||0!==i.value.length))return i})}navigationStep(i){this.checkDestinationDependency(i.previouslySelectedIndex),i.selectedIndex===this.ATTRIBUTES_IDX?this.getRequiredAttributes():i.selectedIndex===this.DESTINATIONS_IDX?this.processing=!1:i.selectedIndex<=this.BEFORE_OPTIONAL_IDX&&this.setServiceControl()}applyFilter(i){this.filterValue=i}canDeactivate(){return this.allowNavigate||this.onCancel(),this.allowNavigate}getServicePackageServices(i,e){e===i.length?this.serviceManager.getServices().subscribe(a=>{this.services=a}):this.serviceManager.getServicesFromServicesPackage(i[e].id).subscribe(a=>{this.servicesPerPackage.set(i[e].id,new Set([...a.map(n=>n.id)])),this.getServicePackageServices(i,e+1)})}getServiceRequiredAttributes(i,e){e!==i.length&&this.attributesManager.getRequiredAttributesDefinition(i[e].id).subscribe(a=>{a=a.filter(n=>this.attributeIds.has(n.id)),this.attributesPerService.set(i[e].id,a.map(n=>n.id)),this.getServiceRequiredAttributes(i,e+1)})}setServiceControl(){this.serviceControl.setValue(0!==this.selection.selected.length)}buildServiceSet(i){const e=new Set;return i.forEach(a=>{this.servicesPerPackage.get(a.id).forEach(n=>e.add(n))}),e}setDiff(i,e){return new Set([...i].filter(a=>!e.has(a)))}setIntersect(i,e){return new Set([...i].filter(a=>e.has(a)))}setSymDif(i,e){const a=this.buildServiceSet(i),n=this.buildServiceSet(e),o=this.setDiff(a,n),u=this.setDiff(n,a);return new Set([...o,...u])}filterService(i,e){const a=new Set;for(const n of e){const o=this.setIntersect(i,this.servicesPerPackage.get(n.id));0!==o.size&&o.forEach(u=>a.add(u))}return a}packageSelectionEqual(i){return i.length===this.selectedPackages.length&&(i.forEach(e=>{if(-1===this.selectedPackages.findIndex(a=>a.id===e.id))return!1}),!0)}checkPackageComplete(){const i=[];for(const e of this.selectedPackages){let a=!0;for(const n of this.servicesPerPackage.get(e.id))if(-1===this.selection.selected.findIndex(o=>o.id===n)){a=!1;break}a&&i.push(e)}this.selectedPackages=i}openSkipDialog(){const i=(0,p.kZ)();i.width="400px",i.data={theme:"facility-theme"},this.dialog.open(Tt,i).afterClosed().subscribe(a=>{a&&(this.serviceControl.setValue(!0),this.stepper.selectedIndex=this.AFTER_OPTIONAL_IDX)})}getRequiredAttributes(){this.processing=!0,this.attributesManager.getRequiredAttributesFacilityServices(this.selection.selected.map(i=>i.id),this.facility.id).subscribe(i=>{this.attSelection.clear(),this.attributes=i.filter(e=>!(0,p.Hm)(e)),this.filteredAttributes=this.attributes,this.attributes.forEach(e=>this.attributeIds.add(e.id)),this.getServiceRequiredAttributes(this.selection.selected,0),this.processing=!1})}openUnsavedAttsDialog(){const i=(0,p.kZ)();i.width="400px",i.data={theme:"facility-theme"},this.dialog.open(St,i).afterClosed().subscribe(a=>{a&&this.onSaveAttributes().then(()=>{this.stepper.next()},()=>this.getRequiredAttributes())})}checkDestinationDependency(i){(i===this.BEFORE_OPTIONAL_IDX||i===this.DESTINATIONS_IDX)&&(this.serviceIds=new Set([...this.selection.selected.map(e=>e.id)]),this.destinationServicePresent())}destinationServicePresent(){for(const i of this.destinations)if(!this.serviceIds.has(i.service.id))return void(this.destinationServiceMissing=!0);this.destinationServiceMissing=!1}}Ct.\u0275fac=function(i){return new(i||Ct)(t.Y36(_.H8),t.Y36(_.KK),t.Y36(_.IQ),t.Y36(t.sBO),t.Y36(r.uw),t.Y36(d.V6),t.Y36(h.sK),t.Y36(y.F0),t.Y36(d.x4),t.Y36(d.fb))},Ct.\u0275cmp=t.Xpm({type:Ct,selectors:[["app-facility-configuration-page"]],viewQuery:function(i,e){if(1&i&&t.Gf(Cn,5),2&i){let a;t.iGM(a=t.CRH())&&(e.stepper=a.first)}},decls:34,vars:15,consts:[[1,"facility-theme"],[1,"page-title"],[3,"linear","selectionChange"],["stepper",""],["matStepLabel",""],["matStepContent",""],[3,"stepControl"],["optional","true",3,"editable","stepControl"],[3,"editable","optional"],[1,"actions"],["mat-flat-button","",3,"click"],["class","ms-auto me-2","mat-flat-button","",3,"click",4,"ngIf"],["color","accent","mat-flat-button","",3,"me-2","ms-auto","click",4,"ngIf"],["class","me-2","color","accent","mat-flat-button","",3,"click",4,"ngIf"],[3,"ownerEmitter"],[3,"disableRouting","hostEmitter"],[1,"page-subtitle"],["alert_type","info"],[1,"filters"],[1,"filter",3,"placeholder","filter"],[1,"package-search-select",3,"disableAutoSelect","selectedPackage","multiple","servicePackages","theme","packageSelected"],[3,"disableRouting","displayedColumns","selection","filterValue","services","selectionChanged"],["color","warn","mat-flat-button","",1,"me-2",3,"disabled","click"],["color","accent","mat-flat-button","",1,"me-2",3,"disabled","click"],["class","service-search-select",3,"disableAutoSelect","services","multiple","theme","serviceSelected",4,"ngIf"],["spinner",""],[1,"position-relative"],[3,"emptyListText","attributes","selection",4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],[1,"service-search-select",3,"disableAutoSelect","services","multiple","theme","serviceSelected"],[3,"emptyListText","attributes","selection"],[3,"configServicesIds","displayedColumns","configServices","loading","title","destinationEmitter"],[3,"disableRouting","disableSelf"],[3,"innerHTML"],[4,"ngIf"],[3,"disabled"],["svgIcon","perun-owner-grey",1,"me-2"],[3,"displayedColumns","owners",4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],["svgIcon","perun-hosts",1,"me-2"],[3,"disableRouting","displayedColumns","hosts",4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],["svgIcon","perun-service",1,"me-2"],[3,"disableRouting","displayedColumns","services"],[3,"disabled","opened"],[3,"displayedColumns","attributes","emptyListText"],[3,"expanded","disabled","expandedChange"],["svgIcon","perun-service_destination",1,"me-2"],[3,"destinations","displayedColumns","services",4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],["svgIcon","perun-manager",1,"me-2"],[3,"complementaryObject","configMode","disableRouting","availableRoles","complementaryObjectType","displayedGroupColumns","displayedUserColumns"],[3,"displayedColumns","owners"],[3,"disableRouting","displayedColumns","hosts"],[3,"destinations","displayedColumns","services"],["mat-flat-button","",1,"ms-auto","me-2",3,"click"],["color","accent","mat-flat-button","",3,"click"],["color","accent","mat-flat-button","",1,"me-2",3,"click"]],template:function(i,e){if(1&i&&(t.TgZ(0,"div",0)(1,"div",1),t._uU(2),t.ALo(3,"translate"),t.qZA(),t.TgZ(4,"mat-stepper",2,3),t.NdJ("selectionChange",function(n){return e.navigationStep(n)}),t.TgZ(6,"mat-step"),t.YNc(7,bn,2,3,"ng-template",4),t.YNc(8,In,1,0,"ng-template",5),t.qZA(),t.TgZ(9,"mat-step"),t.YNc(10,yn,2,3,"ng-template",4),t.YNc(11,vn,1,1,"ng-template",5),t.qZA(),t.TgZ(12,"mat-step",6),t.YNc(13,xn,2,3,"ng-template",4),t.YNc(14,En,10,18,"ng-template",5),t.qZA(),t.TgZ(15,"mat-step",7),t.YNc(16,Dn,2,3,"ng-template",4),t.YNc(17,Nn,18,17,"ng-template",5),t.qZA(),t.TgZ(18,"mat-step",8),t.YNc(19,Fn,2,3,"ng-template",4),t.YNc(20,kn,1,6,"ng-template",5),t.qZA(),t.TgZ(21,"mat-step"),t.YNc(22,Yn,2,3,"ng-template",4),t.YNc(23,Un,1,2,"ng-template",5),t.qZA(),t.TgZ(24,"mat-step"),t.YNc(25,Mn,2,3,"ng-template",4),t.YNc(26,to,4,4,"ng-template",5),t.qZA()(),t.TgZ(27,"div",9)(28,"button",10),t.NdJ("click",function(){return e.onCancel()}),t._uU(29),t.ALo(30,"translate"),t.qZA(),t.YNc(31,eo,3,3,"button",11),t.YNc(32,io,3,7,"button",12),t.YNc(33,so,3,3,"button",13),t.qZA()()),2&i){const a=t.MAs(5);t.xp6(2),t.hij(" ",t.lcZ(3,11,"FACILITY_CONFIGURATION.TITLE")," "),t.xp6(2),t.Q6J("linear",!0),t.xp6(8),t.Q6J("stepControl",e.serviceControl),t.xp6(3),t.Q6J("editable",0!==e.selection.selected.length)("stepControl",e.attributesControl),t.xp6(3),t.Q6J("editable",0!==e.selection.selected.length||0!==e.destinations.length)("optional",0===e.destinations.length),t.xp6(11),t.hij(" ",t.lcZ(30,13,"FACILITY_CONFIGURATION.CANCEL")," "),t.xp6(2),t.Q6J("ngIf",void 0!==a&&0!==a.selectedIndex),t.xp6(1),t.Q6J("ngIf",void 0!==a&&a.selectedIndex!==a.steps.length-1),t.xp6(1),t.Q6J("ngIf",void 0!==a&&a.selectedIndex===a.steps.length-1)}},dependencies:[m.O5,K.Hw,T.lW,Dt.C0,Dt.VY,Dt.Vq,Dt.BY,Zt.pp,Zt.ib,Zt.yz,Zt.yK,Bt.s,Wt.q,L,Tn.Q,U.w,x.K,N.L,$t.p,Ft.Q,Sn.F,An.J,A.e,Q,J,q,P,h.X$],styles:[".icon-scale[_ngcontent-%COMP%]{transform:scale(1.7);margin-left:.5rem;margin-top:-.6rem;margin-right:.9rem}.filters[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;align-items:baseline}.package-search-select[_ngcontent-%COMP%]{width:650px}.service-search-select[_ngcontent-%COMP%]{width:400px}.filter[_ngcontent-%COMP%]{width:350px;margin-right:20px}.actions[_ngcontent-%COMP%]{background-color:#fff;display:flex;padding:20px}.cursor-default[_ngcontent-%COMP%]{cursor:default}"]});class G{constructor(i){this.router=i}canActivate(i){return i.parent.params.facilityId===sessionStorage.getItem("newFacilityId")||(this.router.navigate(["/home"],{queryParamsHandling:"merge"}),!1)}canDeactivate(i){return i.canDeactivate()}}G.\u0275fac=function(i){return new(i||G)(t.LFG(y.F0))},G.\u0275prov=t.Yz7({token:G,factory:G.\u0275fac,providedIn:"root"});var kt=l(71992),Yt=l(6134),ao=l(39646),Xt=l(64901),no=l(18962),oo=l(83370);function lo(s,i){1&s&&t._UZ(0,"perun-web-apps-loading-table")}function co(s,i){if(1&s){const e=t.EpF();t.TgZ(0,"perun-web-apps-users-dynamic-list",5),t.NdJ("loading$",function(n){t.CHM(e);const o=t.oxw();return t.KtG(o.loading$=n)}),t.qZA()}if(2&s){const e=t.oxw();t.Q6J("attrNames",e.attrNames)("selection",e.selection)("tableId",e.tableId)("disableRouting",!0)("displayedColumns",e.displayedColumns)("searchString",e.filter)("facilityId",e.data.entityId)}}class bt{constructor(i,e,a,n,o,u){this.data=i,this.dialogRef=e,this.store=a,this.facilityService=n,this.notificator=o,this.cd=u,this.selection=new S.Ov(!1,[]),this.loading=!1,this.attrNames=[Yt.r.USER_DEF_PREFERRED_MAIL].concat(this.store.getLoginAttributeNames()),this.displayedColumns=["select","id","name","email","logins"],this.tableId=v.bj,this.filter=""}ngOnInit(){this.loading$=(0,ao.of)(!0),this.selection.changed.subscribe(i=>{this.ban=this.data.bans.find(e=>{var a;return e.userId===(null===(a=i.source.selected[0])||void 0===a?void 0:a.id)})})}cancel(){this.dialogRef.close(!1)}submitBan(i){this.ban?this.updateBan(i):this.banUser(i)}setFilter(i){this.filter=i,this.selection.clear(),this.cd.detectChanges()}banUser(i){this.loading=!0,this.facilityService.setFacilityBan({banOnFacility:{userId:this.selection.selected[0].id,facilityId:this.data.entityId,description:i.description,validityTo:i.validity,id:0,beanName:"BanOnVo"}}).subscribe({next:()=>{this.notificator.showSuccess("DIALOGS.ADD_BAN.SUCCESS_USER"),this.dialogRef.close(!0)},error:()=>this.loading=!1})}updateBan(i){this.loading=!0,this.facilityService.updateFacilityBan({banOnFacility:{id:this.ban.id,beanName:"BanOnFacility",facilityId:this.ban.facilityId,userId:this.ban.userId,description:i.description,validityTo:i.validity}}).subscribe({next:()=>{this.notificator.showSuccess("DIALOGS.UPDATE_BAN.SUCCESS"),this.dialogRef.close(!0)},error:()=>{this.loading=!1}})}}bt.\u0275fac=function(i){return new(i||bt)(t.Y36(r.WI),t.Y36(r.so),t.Y36(d.d6),t.Y36(_.IQ),t.Y36(d.V6),t.Y36(t.sBO))},bt.\u0275cmp=t.Xpm({type:bt,selectors:[["app-add-facility-ban-dialog"]],decls:7,vars:9,consts:[[3,"loading","disabled","theme","ban","add","cancel"],[3,"placeholder","filter"],["spinner",""],[1,"position-relative"],[3,"attrNames","selection","tableId","disableRouting","displayedColumns","searchString","facilityId","loading$",4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],[3,"attrNames","selection","tableId","disableRouting","displayedColumns","searchString","facilityId","loading$"]],template:function(i,e){if(1&i&&(t.TgZ(0,"app-add-ban-dialog",0),t.NdJ("add",function(n){return e.submitBan(n)})("cancel",function(){return e.cancel()}),t.TgZ(1,"perun-web-apps-debounce-filter",1),t.NdJ("filter",function(n){return e.setFilter(n)}),t.qZA(),t.YNc(2,lo,1,0,"ng-template",null,2,t.W1O),t.TgZ(4,"div",3),t.YNc(5,co,1,7,"perun-web-apps-users-dynamic-list",4),t.ALo(6,"async"),t.qZA()()),2&i){const a=t.MAs(3);t.Q6J("loading",e.loading)("disabled",0===e.selection.selected.length)("theme",e.data.theme)("ban",e.ban),t.xp6(1),t.Q6J("placeholder","DIALOGS.ADD_BAN.FILTER"),t.xp6(4),t.Q6J("perunWebAppsLoader",t.lcZ(6,7,e.loading$))("perunWebAppsLoaderIndicator",a)}},dependencies:[x.K,Xt.P,no.M,A.e,oo.u,m.Ov]});var ro=l(90979),po=l(91880);function uo(s,i){if(1&s){const e=t.EpF();t.TgZ(0,"button",8),t.NdJ("click",function(){t.CHM(e);const n=t.oxw();return t.KtG(n.add())}),t._uU(1),t.ALo(2,"translate"),t.qZA()}2&s&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"FACILITY_DETAIL.SETTINGS.BANS.ADD"),"\n"))}function _o(s,i){if(1&s){const e=t.EpF();t.TgZ(0,"button",9),t.NdJ("click",function(){t.CHM(e);const n=t.oxw();return t.KtG(n.remove())}),t._uU(1),t.ALo(2,"translate"),t.qZA()}if(2&s){const e=t.oxw();t.Q6J("disabled",0===e.selection.selected.length),t.xp6(1),t.hij(" ",t.lcZ(2,2,"FACILITY_DETAIL.SETTINGS.BANS.REMOVE"),"\n")}}function mo(s,i){if(1&s){const e=t.EpF();t.TgZ(0,"perun-web-apps-ban-on-entity-list",10),t.NdJ("updateBan",function(n){t.CHM(e);const o=t.oxw();return t.KtG(o.update(n))}),t.qZA()}if(2&s){const e=t.oxw();t.Q6J("bans",e.bans)("selection",e.selection)("displayedColumns",e.displayedColumns)("filter",e.filter)("updatePolicy","updateBan_BanOnFacility_policy")}}function ho(s,i){1&s&&t._UZ(0,"perun-web-apps-loading-table")}class It{constructor(i,e,a,n,o,u,f){this.facilityService=i,this.entityService=e,this.authResolver=a,this.dialog=n,this.notificator=o,this.store=u,this.userName=f,this.loading=!1,this.bans=[],this.removeAuth=!1,this.filter="",this.selection=new S.Ov(!1,[]),this.attrNames=[Yt.r.MEMBER_DEF_MAIL,Yt.r.USER_DEF_PREFERRED_MAIL].concat(this.store.getLoginAttributeNames()),this.displayedColumns=["select","banId","subjectId","subjectName","description","expiration","edit"]}ngOnInit(){this.loading=!0,this.facility=this.entityService.getEntity(),this.addAuth=this.authResolver.isAuthorized("setBan_BanOnFacility_policy",[this.facility]),this.removeAuth=this.authResolver.isAuthorized("removeBan_int_policy",[this.facility]),this.refresh()}refresh(){this.loading=!0,this.facilityService.getEnrichedBansForFacility(this.facility.id,this.attrNames).subscribe({next:i=>{this.bans=i,this.selection.clear(),this.loading=!1},error:()=>this.loading=!1})}add(){const i=(0,p.kZ)();i.width="850px",i.data={entityId:this.facility.id,theme:"facility-theme",bans:this.bans.map(a=>a.ban)},this.dialog.open(bt,i).afterClosed().subscribe(a=>{a&&this.refresh()})}remove(){const i=(0,p.kZ)();i.width="550px",i.data={theme:"facility-theme",title:"DIALOGS.REMOVE_BAN.TITLE",description:"DIALOGS.REMOVE_BAN.DESCRIPTION",items:[this.userName.transform(this.selection.selected[0].user)],type:"remove",showAsk:!0},this.dialog.open(yt.Ts,i).afterClosed().subscribe(a=>{a&&(this.loading=!0,this.facilityService.removeFacilityBanById(this.selection.selected[0].ban.id).subscribe(()=>{this.notificator.showSuccess("DIALOGS.REMOVE_BAN.SUCCESS"),this.refresh()}))})}update(i){const e=(0,p.kZ)();e.width="600px",e.data={ban:i.ban,theme:"facility-theme"},this.dialog.open(ro.G,e).afterClosed().subscribe(n=>{n&&this.refresh()})}}It.\u0275fac=function(i){return new(i||It)(t.Y36(_.IQ),t.Y36(d.fb),t.Y36(d.x4),t.Y36(r.uw),t.Y36(d.V6),t.Y36(d.d6),t.Y36(et.dp))},It.\u0275cmp=t.Xpm({type:It,selectors:[["app-facility-settings-bans"]],features:[t._Bn([et.dp])],decls:11,vars:8,consts:[[1,"page-subtitle"],[3,"click"],["class","me-2 action-button","color","accent","mat-flat-button","",3,"click",4,"ngIf"],["color","warn","class","me-2","mat-flat-button","",3,"disabled","click",4,"ngIf"],[1,"mt-2","search-field",3,"placeholder","filter"],[1,"position-relative"],[3,"bans","selection","displayedColumns","filter","updatePolicy","updateBan",4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],["spinner",""],["color","accent","mat-flat-button","",1,"me-2","action-button",3,"click"],["color","warn","mat-flat-button","",1,"me-2",3,"disabled","click"],[3,"bans","selection","displayedColumns","filter","updatePolicy","updateBan"]],template:function(i,e){if(1&i&&(t.TgZ(0,"h1",0),t._uU(1),t.ALo(2,"translate"),t.qZA(),t.TgZ(3,"perun-web-apps-refresh-button",1),t.NdJ("click",function(){return e.refresh()}),t.qZA(),t.YNc(4,uo,3,3,"button",2),t.YNc(5,_o,3,4,"button",3),t.TgZ(6,"perun-web-apps-debounce-filter",4),t.NdJ("filter",function(n){return e.filter=n}),t.qZA(),t.TgZ(7,"div",5),t.YNc(8,mo,1,5,"perun-web-apps-ban-on-entity-list",6),t.qZA(),t.YNc(9,ho,1,0,"ng-template",null,7,t.W1O)),2&i){const a=t.MAs(10);t.xp6(1),t.hij(" ",t.lcZ(2,6,"FACILITY_DETAIL.SETTINGS.BANS.TITLE"),"\n"),t.xp6(3),t.Q6J("ngIf",e.addAuth),t.xp6(1),t.Q6J("ngIf",e.removeAuth),t.xp6(1),t.Q6J("placeholder","FACILITY_DETAIL.SETTINGS.BANS.FILTER"),t.xp6(2),t.Q6J("perunWebAppsLoader",e.loading)("perunWebAppsLoaderIndicator",a)}},dependencies:[m.O5,T.lW,x.K,R.t,Xt.P,po.s,A.e,h.X$]});var fo=l(35265);const go=[{path:"",component:Jt.P,canActivateChild:[kt.a],children:[{path:"",component:Jt.P,data:{animation:"FacilitySelectPage"}}]},{path:":facilityId",component:j,canActivateChild:[kt.a],children:[{path:"",component:$,data:{animation:"FacilityOverviewPage"}},{path:"attributes",component:tt,data:{animation:"FacilityAttributesPage"}},{path:"resources",component:me.f,data:{animation:"FacilityResourcesPage"}},{path:"allowed-users",component:Fa._,data:{animation:"FacilityAllowedUsersPage"}},{path:"allowed-groups",component:he.o,data:{animation:"FacilityAllowedGroupsPage"}},{path:"services-status",component:ft,data:{animation:"FacilityServiceStatusPage"}},{path:"services-status/:taskId",component:gt,data:{animation:"FacilityTaskResultsPage"}},{path:"service-config",component:it,data:{animation:"FacilityServiceConfigPage"}},{path:"services-destinations",component:J,data:{animation:"FacilityServicesDestinationsPage"}},{path:"hosts",component:P,data:{animation:"FacilityHostsPage"}},{path:"hosts/:hostId",component:ut,data:{animation:"FacilityHostsDetailPage"}},{path:"settings",component:z,children:[{path:"",component:X,data:{animation:"FacilitySettingsOverviewPage"}},{path:"owners",component:q,data:{animation:"FacilitySettingOwnersPage"}},{path:"managers",component:Q,data:{animation:"FacilitySettingsManagersPage"}},{path:"security-teams",component:_t,data:{animation:"FacilitySecurityTeamsPage"}},{path:"blacklist",component:dt,data:{animation:"FacilitySettingsBlackListPage"}},{path:"bans",component:It,data:{animation:"FacilitySettingsBansPage"}}]},{path:"configuration",component:Ct,canActivate:[G],canDeactivate:[G]}]},{path:":facilityId/resources/:resourceId",component:fe.b,canActivateChild:[kt.a],children:[{path:"",component:ge.H,data:{animation:"ResourceOverviewPage"}},{path:"attributes",component:De.X,data:{animation:"ResourceAttributesPage"}},{path:"groups",component:Ze.K,data:{animation:"ResourceGroupsComponent"}},{path:"services",component:Fs.D,data:{animation:"ResourceAssignedServicesComponent"}},{path:"members",component:wa.y,data:{animation:"ResourceAssignedMembersComponent"}},{path:"tags",component:mn.v,data:{animation:"ResourceTagsComponent"}},{path:"settings",component:Le.t,children:[{path:"",component:Ee.h,data:{animation:"ResourceSettingsOverviewPage"}},{path:"managers",component:Ns.O,data:{animation:"ResourceSettingsManagersPage"}},{path:"bans",component:fo.I,data:{animation:"ResourceSettingsBansPage"}}]}]}];class B{}B.\u0275fac=function(i){return new(i||B)},B.\u0275mod=t.oAB({type:B}),B.\u0275inj=t.cJS({imports:[y.Bz.forChild(go),y.Bz]});var To=l(14264),So=l(88561),Ao=l(91926),Co=l(38338),bo=l(52275);class W{}W.\u0275fac=function(i){return new(i||W)},W.\u0275mod=t.oAB({type:W}),W.\u0275inj=t.cJS({providers:[et.dp],imports:[m.ez,B,To.m,So.r,Ao.A,ps.ez,et.d4,Co.UsersModule,bo.AdminModule]})}}]);