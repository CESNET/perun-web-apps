(self.webpackChunkperun_web_apps=self.webpackChunkperun_web_apps||[]).push([[749],{89749:function(t,e,i){"use strict";i.r(e),i.d(e,{FacilitiesModule:function(){return Dn}});var s=i(61511),a=i(57629),n=i(73916),l=i(17),o=i(75585),c=i(65249),r=i(84140),d=i(68416),u=i(6527),h=i(30570),p=i(31572),g=i(84608),f=i(48958),m=i(66297),A=i(67806),I=i(43691),S=i(36922),T=i(21575),b=i(15980),E=i(48160);function Z(t,e){1&t&&p._UZ(0,"mat-spinner",3)}function C(t,e){if(1&t){const t=p.EpF();p.TgZ(0,"button",12),p.NdJ("click",function(){return p.CHM(t),p.oxw(2).editFacility()}),p.TgZ(1,"mat-icon"),p._uU(2,"edit"),p.qZA(),p.qZA()}}function v(t,e){if(1&t){const t=p.EpF();p.TgZ(0,"button",12),p.NdJ("click",function(){return p.CHM(t),p.oxw(2).deleteFacility()}),p.TgZ(1,"mat-icon"),p._uU(2,"delete_forever"),p.qZA(),p.qZA()}}const _=function(){return{color:"black"}},y=function(t){return["/facilities",t]};function O(t,e){if(1&t&&(p.TgZ(0,"div"),p.TgZ(1,"div",4),p._UZ(2,"mat-icon",5),p.ALo(3,"translate"),p.TgZ(4,"div",6),p.TgZ(5,"div",7),p.TgZ(6,"a",8),p._uU(7),p.qZA(),p.TgZ(8,"span",9),p._uU(9),p.qZA(),p.YNc(10,C,3,0,"button",10),p.YNc(11,v,3,0,"button",10),p.qZA(),p.TgZ(12,"span",11),p._uU(13),p.ALo(14,"translate"),p.ALo(15,"translate"),p.qZA(),p.qZA(),p.qZA(),p._UZ(16,"app-animated-router-outlet"),p.qZA()),2&t){const t=p.oxw();p.xp6(2),p.s9C("matTooltip",p.lcZ(3,10,"FACILITY_DETAIL.ENTITY")),p.Q6J("ngStyle",p.DdM(16,_)),p.xp6(4),p.Q6J("routerLink",p.VKq(17,y,t.facility.id)),p.xp6(1),p.Oqu(t.facility.name),p.xp6(2),p.hij(" \xa0#",t.facility.id," "),p.xp6(1),p.Q6J("ngIf",t.editFacilityAuth),p.xp6(1),p.Q6J("ngIf",t.deleteAuth),p.xp6(2),p.lnq(" ",p.lcZ(14,12,"FACILITY_DETAIL.ENTITY"),", ",p.lcZ(15,14,"FACILITY_DETAIL.DESCRIPTION"),": ",t.facility.description," ")}}let L=(()=>{class t{constructor(t,e,i,s,a,n,l,o){this.dialog=t,this.facilityManager=e,this.route=i,this.sideMenuService=s,this.sideMenuItemService=a,this.guiAuthResolver=n,this.router=l,this.entityStorageService=o,this.editFacilityAuth=!1,this.deleteAuth=!1,this.loading=!1}ngOnInit(){this.loading=!0,this.route.params.subscribe(t=>{this.facilityManager.getFacilityById(t.facilityId).subscribe(t=>{this.facility=t,this.entityStorageService.setEntity({id:t.id,beanName:t.beanName});const e=this.sideMenuItemService.parseFacility(t);this.sideMenuService.setFacilityMenuItems([e]),this.editFacilityAuth=this.guiAuthResolver.isAuthorized("updateFacility_Facility_policy",[this.facility]),this.deleteAuth=this.guiAuthResolver.isAuthorized("deleteFacility_Facility_Boolean_policy",[this.facility]),(0,r.sF)("facilities",this.facility),(0,r.XI)(this.facility),this.loading=!1},()=>this.loading=!1)})}editFacility(){const t=(0,r.kZ)();t.width="450px",t.data={theme:"facility-theme",facility:this.facility,dialogType:u.Eg.FACILITY},this.dialog.open(u.rd,t).afterClosed().subscribe(t=>{t&&this.facilityManager.getFacilityById(this.facility.id).subscribe(t=>{this.facility=t})})}deleteFacility(){const t=(0,r.kZ)();t.width="500px",t.data={theme:"facility-theme",facility:this.facility},this.dialog.open(h.Y,t).afterClosed().subscribe(t=>{t&&this.router.navigate([""])})}}return t.\u0275fac=function(e){return new(e||t)(p.Y36(g.uw),p.Y36(c.IQ),p.Y36(a.gz),p.Y36(f.D),p.Y36(o.V),p.Y36(d.x4),p.Y36(a.F0),p.Y36(d.fb))},t.\u0275cmp=p.Xpm({type:t,selectors:[["app-facility-detail-page"]],decls:4,vars:2,consts:[[1,"container-fluid","pl-xl-5","pr-xl-5","facility-theme"],["class","mr-auto ml-auto",4,"ngIf"],[4,"ngIf"],[1,"mr-auto","ml-auto"],[1,"d-flex","page-title-headtitle"],["svgIcon","perun-facility-black",1,"perun-icon","perun-icon-detail",3,"matTooltip","ngStyle"],[1,"page-title-block"],[1,"page-title-headline","d-flex","align-items-center"],["queryParamsHandling","merge",1,"facility-link",3,"routerLink"],[1,"text-muted"],["mat-icon-button","",3,"click",4,"ngIf"],[1,"mt-1","entity-info"],["mat-icon-button","",3,"click"]],template:function(t,e){1&t&&(p.TgZ(0,"div",0),p._UZ(1,"perun-web-apps-back-button"),p.YNc(2,Z,1,0,"mat-spinner",1),p.YNc(3,O,17,19,"div",2),p.qZA()),2&t&&(p.xp6(2),p.Q6J("ngIf",e.loading),p.xp6(1),p.Q6J("ngIf",!e.loading&&void 0!==e.facility))},directives:[m.W,s.O5,A.$g,I.Hw,S.gM,s.PC,a.yS,T.A,b.lW],pipes:[E.X$],styles:[""],data:{animation:[l.Ji]}}),t})();var x=i(8557);function N(t,e){1&t&&p._UZ(0,"mat-spinner",2)}function R(t,e){if(1&t&&(p.TgZ(0,"div"),p._UZ(1,"perun-web-apps-menu-buttons-field",3),p.qZA()),2&t){const t=p.oxw();p.xp6(1),p.Q6J("items",t.navItems)("size","small")}}let D=(()=>{class t{constructor(t,e,i){this.facilityManager=t,this.authResolver=e,this.entityStorageService=i,this.navItems=[],this.loading=!1}ngOnInit(){this.loading=!0,this.facility=this.entityStorageService.getEntity(),this.initItems(),this.loading=!1}initItems(){this.navItems=[],this.authResolver.isAuthorized("getAssignedRichResources_Facility_policy",[this.facility])&&this.navItems.push({cssIcon:"perun-manage-facility",url:`/facilities/${this.facility.id}/resources`,label:"MENU_ITEMS.FACILITY.RESOURCES",style:"facility-btn"}),this.authResolver.isAuthorized("getAssignedUsers_Facility_Service_policy",[this.facility])&&this.navItems.push({cssIcon:"perun-user",url:`/facilities/${this.facility.id}/allowed-users`,label:"MENU_ITEMS.FACILITY.ALLOWED_USERS",style:"facility-btn"}),this.authResolver.isAuthorized("getAllowedGroups_Facility_Vo_Service_policy",[this.facility])&&this.navItems.push({cssIcon:"perun-group",url:`/facilities/${this.facility.id}/allowed-groups`,label:"MENU_ITEMS.FACILITY.ALLOWED_GROUPS",style:"facility-btn"}),this.authResolver.isAuthorized("getFacilityServicesState_Facility_policy",[this.facility])&&this.navItems.push({cssIcon:"perun-service-status",url:`/facilities/${this.facility.id}/services-status`,label:"MENU_ITEMS.FACILITY.SERVICES_STATUS",style:"facility-btn"}),this.authResolver.isAuthorized("getAllRichDestinations_Facility_policy",[this.facility])&&this.navItems.push({cssIcon:"perun-service_destination",url:`/facilities/${this.facility.id}/services-destinations`,label:"MENU_ITEMS.FACILITY.SERVICES_DESTINATIONS",style:"facility-btn"}),this.authResolver.isFacilityAdmin()&&this.navItems.push({cssIcon:"perun-hosts",url:`/facilities/${this.facility.id}/hosts`,label:"MENU_ITEMS.FACILITY.HOSTS",style:"facility-btn"}),this.navItems.push({cssIcon:"perun-attributes",url:`/facilities/${this.facility.id}/attributes`,label:"MENU_ITEMS.FACILITY.ATTRIBUTES",style:"facility-btn"}),(this.authResolver.isAuthorized("getBansForFacility_int_policy",[this.facility])||this.authResolver.isManagerPagePrivileged(this.facility)||this.authResolver.isAuthorized("getOwners_Facility_policy",[this.facility])||this.authResolver.isAuthorized("getAssignedSecurityTeams_Facility_policy",[this.facility]))&&this.navItems.push({cssIcon:"perun-settings2",url:`/facilities/${this.facility.id}/settings`,label:"MENU_ITEMS.FACILITY.SETTINGS",style:"facility-btn"})}}return t.\u0275fac=function(e){return new(e||t)(p.Y36(c.IQ),p.Y36(d.x4),p.Y36(d.fb))},t.\u0275cmp=p.Xpm({type:t,selectors:[["app-facility-overview"]],hostVars:2,hostBindings:function(t,e){2&t&&p.ekj("router-component",e.true)},decls:2,vars:2,consts:[["class","mr-auto ml-auto",4,"ngIf"],[4,"ngIf"],[1,"mr-auto","ml-auto"],[3,"items","size"]],template:function(t,e){1&t&&(p.YNc(0,N,1,0,"mat-spinner",0),p.YNc(1,R,2,2,"div",1)),2&t&&(p.Q6J("ngIf",e.loading),p.xp6(1),p.Q6J("ngIf",!e.loading))},directives:[s.O5,A.$g,x.L],styles:[""]}),t})();var w=i(64467),k=i(39124),F=i(72920),Y=i(76527);let U=(()=>{class t{constructor(){}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=p.Xpm({type:t,selectors:[["app-facility-settings"]],hostVars:2,hostBindings:function(t,e){2&t&&p.ekj("router-component",e.true)},decls:1,vars:0,template:function(t,e){1&t&&p._UZ(0,"app-animated-router-outlet")},directives:[T.A],styles:[""],data:{animation:[l.Ji]}}),t})();function q(t,e){1&t&&p._UZ(0,"mat-spinner",2)}function M(t,e){if(1&t&&(p.TgZ(0,"div"),p._UZ(1,"perun-web-apps-menu-buttons-field",3),p.qZA()),2&t){const t=p.oxw();p.xp6(1),p.Q6J("items",t.items)("size","small")}}let J=(()=>{class t{constructor(t,e,i){this.facilityManager=t,this.authResolver=e,this.entityStorageService=i,this.items=[],this.loading=!1}ngOnInit(){this.loading=!0,this.facility=this.entityStorageService.getEntity(),this.initItems(),this.loading=!1}initItems(){this.items=[],this.authResolver.isAuthorized("getOwners_Facility_policy",[this.facility])&&this.items.push({cssIcon:"perun-owner-grey",url:`/facilities/${this.facility.id}/settings/owners`,label:"MENU_ITEMS.FACILITY.OWNERS",style:"facility-btn"}),this.authResolver.isManagerPagePrivileged(this.facility)&&this.items.push({cssIcon:"perun-manager",url:`/facilities/${this.facility.id}/settings/managers`,label:"MENU_ITEMS.FACILITY.MANAGERS",style:"facility-btn"}),this.authResolver.isAuthorized("getAssignedSecurityTeams_Facility_policy",[this.facility])&&this.items.push({cssIcon:"perun-security-teams",url:`/facilities/${this.facility.id}/settings/security-teams`,label:"MENU_ITEMS.FACILITY.SECURITY_TEAMS",style:"facility-btn"}),this.authResolver.isAuthorized("getBansForFacility_int_policy",[this.facility])&&this.items.push({cssIcon:"perun-black-list",url:`/facilities/${this.facility.id}/settings/blacklist`,label:"MENU_ITEMS.FACILITY.BLACKLIST",style:"facility-btn"})}}return t.\u0275fac=function(e){return new(e||t)(p.Y36(c.IQ),p.Y36(d.x4),p.Y36(d.fb))},t.\u0275cmp=p.Xpm({type:t,selectors:[["app-facility-settings-overview"]],hostVars:2,hostBindings:function(t,e){2&t&&p.ekj("router-component",e.true)},decls:2,vars:2,consts:[["class","mr-auto ml-auto",4,"ngIf"],[4,"ngIf"],[1,"mr-auto","ml-auto"],[3,"items","size"]],template:function(t,e){1&t&&(p.YNc(0,q,1,0,"mat-spinner",0),p.YNc(1,M,2,2,"div",1)),2&t&&(p.Q6J("ngIf",e.loading),p.xp6(1),p.Q6J("ngIf",!e.loading))},directives:[s.O5,A.$g,x.L],styles:[""]}),t})();var Q=i(55109),V=i(541),H=i(3417);function P(t,e){1&t&&(p._uU(0),p.ALo(1,"translate")),2&t&&p.hij(" ",p.lcZ(1,1,"FACILITY_DETAIL.ENTITY")," ")}function G(t,e){if(1&t&&p._UZ(0,"app-one-entity-attribute-page",4),2&t){const t=p.oxw();p.Q6J("entity","facility")("entityId",t.facility.id)}}function B(t,e){1&t&&(p._uU(0),p.ALo(1,"translate"),p.ALo(2,"translate")),2&t&&p.AsE(" ",p.lcZ(1,2,"FACILITY_DETAIL.ENTITY")," - ",p.lcZ(2,4,"ADMIN_USER.ENTITY")," ")}function $(t,e){if(1&t&&p._UZ(0,"app-two-entity-attribute-page",5),2&t){const t=p.oxw(2);p.Q6J("firstEntity","facility")("firstEntityId",t.facility.id)("secondEntity","user")}}function j(t,e){1&t&&(p.TgZ(0,"mat-tab"),p.YNc(1,B,3,6,"ng-template",1),p.YNc(2,$,1,3,"ng-template",2),p.qZA())}let z=(()=>{class t{constructor(t,e){this.authResolver=t,this.entityStorageService=e}ngOnInit(){this.facility=this.entityStorageService.getEntity(),this.facilityUserAttAuth=this.authResolver.isAuthorized("getAssignedUsers_Facility_policy",[this.facility])}}return t.\u0275fac=function(e){return new(e||t)(p.Y36(d.x4),p.Y36(d.fb))},t.\u0275cmp=p.Xpm({type:t,selectors:[["app-facility-attributes"]],hostVars:2,hostBindings:function(t,e){2&t&&p.ekj("router-component",e.true)},decls:9,vars:4,consts:[[1,"page-subtitle"],["matTabLabel",""],["matTabContent",""],[4,"ngIf"],[3,"entity","entityId"],[3,"firstEntity","firstEntityId","secondEntity"]],template:function(t,e){1&t&&(p.TgZ(0,"div"),p.TgZ(1,"h1",0),p._uU(2),p.ALo(3,"translate"),p.qZA(),p.TgZ(4,"mat-tab-group"),p.TgZ(5,"mat-tab"),p.YNc(6,P,2,3,"ng-template",1),p.YNc(7,G,1,2,"ng-template",2),p.qZA(),p.YNc(8,j,3,0,"mat-tab",3),p.qZA(),p.qZA()),2&t&&(p.xp6(2),p.Oqu(p.lcZ(3,2,"FACILITY_DETAIL.SETTINGS.ATTRIBUTES.TITLE")),p.xp6(6),p.Q6J("ngIf",e.facilityUserAttAuth))},directives:[Q.SP,Q.uX,Q.uD,Q.Vc,s.O5,V.t,H.Y],pipes:[E.X$],styles:[""]}),t})();var X=i(77968),W=i(22927),K=i(79472),tt=i(42473),et=i(16073),it=i(56238),st=i(79996),at=i(22280),nt=i(29236),lt=i(66283),ot=i(80340),ct=i(40084),rt=i(71522),dt=i(22196);function ut(t,e){if(1&t){const t=p.EpF();p.TgZ(0,"mat-option",10),p.NdJ("onSelectionChange",function(){const e=p.CHM(t).$implicit;return p.oxw(3).onSelectedService(e)}),p._uU(1),p.qZA()}if(2&t){const t=e.$implicit;p.Q6J("value",t),p.xp6(1),p.hij(" ",t.name," ")}}function ht(t,e){if(1&t){const t=p.EpF();p.TgZ(0,"mat-form-field",6),p.TgZ(1,"input",7),p.NdJ("keyup",function(e){return p.CHM(t),p.oxw(2).updatedSerVal(e)}),p.ALo(2,"translate"),p.qZA(),p.TgZ(3,"mat-autocomplete",8,9),p.TgZ(5,"mat-option",10),p.NdJ("onSelectionChange",function(){return p.CHM(t),p.oxw(2).onSelectedService("NOT_SELECTED")}),p._uU(6),p.ALo(7,"translate"),p.qZA(),p.TgZ(8,"mat-option",10),p.NdJ("onSelectionChange",function(){return p.CHM(t),p.oxw(2).onSelectedService("ALL")}),p._uU(9),p.ALo(10,"translate"),p.qZA(),p.YNc(11,ut,2,2,"mat-option",11),p.ALo(12,"async"),p.qZA(),p.qZA()}if(2&t){const t=p.MAs(4),e=p.oxw(2);p.xp6(1),p.s9C("placeholder",p.lcZ(2,9,"FACILITY_DETAIL.SERVICE_CONFIG.SERVICE_SELECT")),p.Q6J("formControl",e.serviceField)("matAutocomplete",t),p.xp6(2),p.Q6J("displayWith",e.serviceDisplayFn.bind(e)),p.xp6(2),p.Q6J("value","NOT_SELECTED"),p.xp6(1),p.hij(" ",p.lcZ(7,11,"FACILITY_DETAIL.SERVICE_CONFIG.NOT_SELECTED")," "),p.xp6(2),p.Q6J("value","ALL"),p.xp6(1),p.hij(" ",p.lcZ(10,13,"FACILITY_DETAIL.SERVICE_CONFIG.ALL")," "),p.xp6(2),p.Q6J("ngForOf",p.lcZ(12,15,e.filteredServices))}}function pt(t,e){if(1&t){const t=p.EpF();p.TgZ(0,"mat-option",10),p.NdJ("onSelectionChange",function(){const e=p.CHM(t).$implicit;return p.oxw(3).onSelectedResource(e)}),p._uU(1),p.qZA()}if(2&t){const t=e.$implicit;p.Q6J("value",t),p.xp6(1),p.hij(" ",t.name," ")}}function gt(t,e){if(1&t){const t=p.EpF();p.TgZ(0,"mat-form-field",6),p.TgZ(1,"input",12),p.NdJ("keyup",function(e){return p.CHM(t),p.oxw(2).updatedResVal(e)}),p.ALo(2,"translate"),p.qZA(),p.TgZ(3,"mat-autocomplete",8,9),p.YNc(5,pt,2,2,"mat-option",11),p.ALo(6,"async"),p.qZA(),p.qZA()}if(2&t){const t=p.MAs(4),e=p.oxw(2);p.xp6(1),p.s9C("placeholder",p.lcZ(2,5,"FACILITY_DETAIL.SERVICE_CONFIG.RES_SELECT")),p.Q6J("matAutocomplete",t)("formControl",e.resourceField),p.xp6(2),p.Q6J("displayWith",e.resourceDisplayFn.bind(e)),p.xp6(2),p.Q6J("ngForOf",p.lcZ(6,7,e.filteredResources))}}function ft(t,e){if(1&t){const t=p.EpF();p.TgZ(0,"mat-option",10),p.NdJ("onSelectionChange",function(){const e=p.CHM(t).$implicit;return p.oxw(3).onSelectedGroup(e)}),p._uU(1),p.qZA()}if(2&t){const t=e.$implicit;p.Q6J("value",t),p.xp6(1),p.hij(" ",t.name," ")}}function mt(t,e){if(1&t){const t=p.EpF();p.TgZ(0,"mat-form-field",6),p.TgZ(1,"input",12),p.NdJ("keyup",function(e){return p.CHM(t),p.oxw(2).updatedGroupVal(e)}),p.ALo(2,"translate"),p.qZA(),p.TgZ(3,"mat-autocomplete",13,9),p.YNc(5,ft,2,2,"mat-option",11),p.ALo(6,"async"),p.qZA(),p.qZA()}if(2&t){const t=p.MAs(4),e=p.oxw(2);p.xp6(1),p.s9C("placeholder",p.lcZ(2,5,"FACILITY_DETAIL.SERVICE_CONFIG.GROUP_SELECT")),p.Q6J("matAutocomplete",t)("formControl",e.groupField),p.xp6(2),p.Q6J("displayWith",e.groupDisplayFn.bind(e)),p.xp6(2),p.Q6J("ngForOf",p.lcZ(6,7,e.filteredGroups))}}function At(t,e){if(1&t){const t=p.EpF();p.TgZ(0,"mat-option",10),p.NdJ("onSelectionChange",function(){const e=p.CHM(t).$implicit;return p.oxw(3).onSelectedMember(e)}),p._uU(1),p.ALo(2,"userFullName"),p.qZA()}if(2&t){const t=e.$implicit;p.Q6J("value",t),p.xp6(1),p.hij(" ",p.lcZ(2,2,t.user)," ")}}function It(t,e){if(1&t&&(p.TgZ(0,"mat-form-field",6),p._UZ(1,"input",14),p.ALo(2,"translate"),p.TgZ(3,"mat-autocomplete",8,9),p.YNc(5,At,3,4,"mat-option",11),p.ALo(6,"async"),p.qZA(),p.qZA()),2&t){const t=p.MAs(4),e=p.oxw(2);p.xp6(1),p.s9C("placeholder",p.lcZ(2,5,"FACILITY_DETAIL.SERVICE_CONFIG.MEMBER_SELECT")),p.Q6J("formControl",e.memberField)("matAutocomplete",t),p.xp6(2),p.Q6J("displayWith",e.memberDisplayFn.bind(e)),p.xp6(2),p.Q6J("ngForOf",p.lcZ(6,7,e.filteredMembers))}}function St(t,e){if(1&t){const t=p.EpF();p.TgZ(0,"div",3),p.YNc(1,ht,13,17,"mat-form-field",4),p.TgZ(2,"mat-checkbox",5),p.NdJ("change",function(e){return p.CHM(t),p.oxw().onOfferAllServices(e)}),p._uU(3),p.ALo(4,"translate"),p.qZA(),p.YNc(5,gt,7,9,"mat-form-field",4),p.YNc(6,mt,7,9,"mat-form-field",4),p.YNc(7,It,7,9,"mat-form-field",4),p.qZA()}if(2&t){const t=p.oxw();p.xp6(1),p.Q6J("ngIf",void 0!==t.services),p.xp6(2),p.hij(" ",p.lcZ(4,5,"FACILITY_DETAIL.SERVICE_CONFIG.ALL_SERVICES")," "),p.xp6(2),p.Q6J("ngIf",void 0!==t.resources&&0!==t.resources.length),p.xp6(1),p.Q6J("ngIf",void 0!==t.selectedResource&&void 0!==t.groups&&0!==t.groups.length),p.xp6(1),p.Q6J("ngIf",void 0!==t.selectedGroup&&void 0!==t.members&&0!==t.members.length)}}function Tt(t,e){if(1&t&&p._UZ(0,"perun-web-apps-service-configurator",15),2&t){const t=p.oxw();p.Q6J("facility",t.facility)("resource",t.selectedResource)("group",t.selectedGroup)("service",t.selectedService)("member",t.selectedMember)}}let bt=(()=>{class t{constructor(t,e,i,s,a,n,l){this.facilityManager=t,this.resourceManager=e,this.serviceManager=i,this.membersManager=s,this.namePipe=a,this.translate=n,this.entityStorageService=l,this.selectedService="NOT_SELECTED",this.attrNames=[],this.serviceField=new et.NI,this.resourceField=new et.NI,this.groupField=new et.NI,this.memberField=new et.NI,this.allowedStatuses=["INVALID","VALID"],this.translate.get("FACILITY_DETAIL.SERVICE_CONFIG.ALL").subscribe(t=>this.serviceAllTranslation=t),this.translate.get("FACILITY_DETAIL.SERVICE_CONFIG.NOT_SELECTED").subscribe(t=>this.serviceNotSelectedTranslation=t)}ngOnInit(){this.facility=this.entityStorageService.getEntity(),this.facilityManager.getFacilityById(this.facility.id).subscribe(t=>{this.facility=t,this.facilityManager.getAssignedResourcesForFacility(t.id).subscribe(t=>this.resources=t),this.serviceManager.getAssignedServices(t.id).subscribe(t=>this.services=t)}),this.filteredServices=this.serviceField.valueChanges.pipe((0,it.O)(""),(0,st.U)(t=>this._filterServices(t))),this.filteredResources=this.resourceField.valueChanges.pipe((0,it.O)(""),(0,st.U)(t=>this._filterResources(t))),this.filteredGroups=this.groupField.valueChanges.pipe((0,it.O)(""),(0,st.U)(t=>this._filterGroups(t))),this.filteredMembers=this.memberField.valueChanges.pipe((0,it.O)(""),(0,st.U)(t=>this._filterMembers(t)))}onSelectedService(t){this.selectedService=t}onSelectedResource(t){this.selectedResource=t,void 0!==this.selectedResource?(this.resourceManager.getAssignedGroups(this.selectedResource.id).subscribe(t=>this.groups=t),this.selectedGroup=void 0,this.selectedMember=void 0):this.groups=void 0}onOfferAllServices(t){t.checked||this.serviceManager.getAssignedServices(this.facility.id).subscribe(t=>this.services=t)}onSelectedGroup(t){this.selectedGroup=t,void 0!==this.selectedGroup?(this.membersManager.getCompleteRichMembersForGroup(this.selectedGroup.id,!1,this.allowedStatuses,this.attrNames).subscribe(t=>this.members=t),this.selectedMember=void 0):this.members=void 0}onSelectedMember(t){this.selectedMember=t}_filterServices(t){const e=t.toString().toLowerCase();return this.services.filter(t=>t.name.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").includes(e))}_filterResources(t){const e=t.toString().toLowerCase();return this.resources.filter(t=>t.name.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").includes(e))}_filterGroups(t){const e=t.toString().toLowerCase();return this.groups.filter(t=>t.name.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").includes(e))}_filterMembers(t){const e=t.toString().toLowerCase();return this.members.filter(t=>this.namePipe.transform(t.user).toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").includes(e))}serviceDisplayFn(t){if(null!==t)return"ALL"===t?this.serviceAllTranslation:"NOT_SELECTED"===t?this.serviceNotSelectedTranslation:t.name}resourceDisplayFn(t){if(null!==t)return t.name}groupDisplayFn(t){if(null!==t)return t.name}memberDisplayFn(t){if(null!==t)return this.namePipe.transform(t.user)}updatedSerVal(t){""===t.target.value&&(this.selectedService="NOT_SELECTED")}updatedResVal(t){""===t.target.value&&(this.groups=void 0,this.members=void 0)}updatedGroupVal(t){""===t.target.value&&(this.members=void 0)}updatedMemVal(t){}}return t.\u0275fac=function(e){return new(e||t)(p.Y36(c.IQ),p.Y36(c.xk),p.Y36(c.KK),p.Y36(c.uq),p.Y36(at.dp),p.Y36(E.sK),p.Y36(d.fb))},t.\u0275cmp=p.Xpm({type:t,selectors:[["app-facility-service-config"]],decls:6,vars:5,consts:[[1,"page-subtitle"],["class","col-12 col-lg-6 mb-2",4,"ngIf"],[3,"facility","resource","group","service","member",4,"ngIf"],[1,"col-12","col-lg-6","mb-2"],["class","w-100",4,"ngIf"],[3,"change"],[1,"w-100"],["type","text","matInput","",3,"placeholder","formControl","matAutocomplete","keyup"],["autoActiveFirstOption","",3,"displayWith"],["auto","matAutocomplete"],[3,"value","onSelectionChange"],[3,"value","onSelectionChange",4,"ngFor","ngForOf"],["type","text","matInput","",3,"placeholder","matAutocomplete","formControl","keyup"],["autoActiveFirstOption","",3,"ngClass","displayWith"],["type","text","matInput","",3,"placeholder","formControl","matAutocomplete"],[3,"facility","resource","group","service","member"]],template:function(t,e){1&t&&(p.TgZ(0,"div"),p.TgZ(1,"h1",0),p._uU(2),p.ALo(3,"translate"),p.qZA(),p.YNc(4,St,8,7,"div",1),p.YNc(5,Tt,1,5,"perun-web-apps-service-configurator",2),p.qZA()),2&t&&(p.xp6(2),p.Oqu(p.lcZ(3,3,"FACILITY_DETAIL.SERVICE_CONFIG.TITLE")),p.xp6(2),p.Q6J("ngIf",!!e.facility),p.xp6(1),p.Q6J("ngIf",!!e.facility))},directives:[s.O5,nt.oG,lt.KE,ot.Nt,et.Fj,ct.ZL,et.JJ,et.oH,ct.XC,rt.ey,s.sg,s.mk],pipes:[E.X$,s.Ov,dt.d],styles:[""]}),t})();var Et=i(489);let Zt=(()=>{class t{constructor(t,e,i){this.facilityService=t,this.guiAuthResolver=e,this.entityStorageService=i,this.availableRoles=[],this.selected="user",this.type="Facility",this.theme="facility-theme",this.disableRouting=!1,this.disableSelf=!1}ngOnInit(){this.facility=this.entityStorageService.getEntity(),this.guiAuthResolver.assignAvailableRoles(this.availableRoles,"Facility")}}return t.\u0275fac=function(e){return new(e||t)(p.Y36(c.IQ),p.Y36(d.x4),p.Y36(d.fb))},t.\u0275cmp=p.Xpm({type:t,selectors:[["app-perun-web-apps-facility-settings-managers"]],hostVars:2,hostBindings:function(t,e){2&t&&p.ekj("router-component",e.true)},inputs:{disableRouting:"disableRouting",disableSelf:"disableSelf"},decls:1,vars:6,consts:[[3,"complementaryObject","complementaryObjectType","theme","availableRoles","disableRouting","disableSelf"]],template:function(t,e){1&t&&p._UZ(0,"app-managers-page",0),2&t&&p.Q6J("complementaryObject",e.facility)("complementaryObjectType",e.type)("theme",e.theme)("availableRoles",e.availableRoles)("disableRouting",e.disableRouting)("disableSelf",e.disableSelf)},directives:[Et.s],styles:[""]}),t})();var Ct=i(60611),vt=i(4230),_t=i(60547),yt=i(4786);function Ot(t,e){1&t&&p._UZ(0,"mat-spinner",6)}function Lt(t,e){1&t&&(p.TgZ(0,"mat-option",19),p._uU(1),p.ALo(2,"translate"),p.qZA()),2&t&&(p.xp6(1),p.Oqu(p.lcZ(2,1,"DIALOGS.ADD_SERVICE_DESTINATION.SELECTION_ALL")))}function xt(t,e){1&t&&(p.TgZ(0,"mat-option",20),p._uU(1),p.ALo(2,"translate"),p.qZA()),2&t&&(p.xp6(1),p.Oqu(p.lcZ(2,1,"DIALOGS.ADD_SERVICE_DESTINATION.NO_SERVICE")))}function Nt(t,e){if(1&t&&(p.TgZ(0,"mat-option",21),p._uU(1),p.qZA()),2&t){const t=e.$implicit;p.Q6J("value",t),p.xp6(1),p.hij(" ",t.name," ")}}function Rt(t,e){1&t&&(p.TgZ(0,"mat-error"),p._uU(1),p.ALo(2,"translate"),p.qZA()),2&t&&(p.xp6(1),p.hij(" ",p.lcZ(2,1,"DIALOGS.ADD_SERVICE_DESTINATION.CHOOSE_SERVICE")," "))}function Dt(t,e){if(1&t&&(p.TgZ(0,"mat-option",21),p._uU(1),p.qZA()),2&t){const t=e.$implicit,i=p.oxw(2);p.Q6J("value",t),p.xp6(1),p.hij(" ",i.getTypeForView(t)," ")}}function wt(t,e){1&t&&(p.TgZ(0,"mat-error"),p._uU(1),p.ALo(2,"translate"),p.qZA()),2&t&&(p.xp6(1),p.hij(" ",p.lcZ(2,1,"DIALOGS.ADD_SERVICE_DESTINATION.REQUIRED_FIELD")," "))}function kt(t,e){1&t&&(p.TgZ(0,"mat-error"),p._uU(1),p.ALo(2,"translate"),p.qZA()),2&t&&(p.xp6(1),p.hij(" ",p.lcZ(2,1,"DIALOGS.ADD_SERVICE_DESTINATION.INVALID_DESTINATION")," "))}function Ft(t,e){if(1&t&&(p.TgZ(0,"mat-form-field",22),p._UZ(1,"input",23),p.YNc(2,wt,3,3,"mat-error",13),p.YNc(3,kt,3,3,"mat-error",13),p.qZA()),2&t){const t=p.oxw(2);p.xp6(1),p.s9C("placeholder",t.getTypeForView(t.selectedType)),p.Q6J("formControl",t.destinationControl),p.xp6(1),p.Q6J("ngIf","host"===t.selectedType&&!t.useFacilityHost&&t.destinationControl.hasError("required")),p.xp6(1),p.Q6J("ngIf",t.destinationControl.hasError("invalidDestination"))}}function Yt(t,e){if(1&t){const t=p.EpF();p.TgZ(0,"mat-checkbox",24),p.NdJ("ngModelChange",function(e){return p.CHM(t),p.oxw(2).useFacilityHost=e}),p._uU(1),p.ALo(2,"translate"),p.qZA()}if(2&t){const t=p.oxw(2);p.Q6J("ngModel",t.useFacilityHost),p.xp6(1),p.hij(" ",p.lcZ(2,2,"DIALOGS.ADD_SERVICE_DESTINATION.USE_FACILITY_HOST")," ")}}function Ut(t,e){if(1&t&&(p.TgZ(0,"mat-option",21),p._uU(1),p.qZA()),2&t){const t=e.$implicit;p.Q6J("value",t),p.xp6(1),p.hij(" ",t," ")}}function qt(t,e){if(1&t){const t=p.EpF();p.TgZ(0,"div",7),p.TgZ(1,"div",8),p._uU(2),p.ALo(3,"translate"),p.qZA(),p.TgZ(4,"mat-form-field"),p.TgZ(5,"mat-select",9),p.ALo(6,"translate"),p.YNc(7,Lt,3,3,"mat-option",10),p.YNc(8,xt,3,3,"mat-option",11),p.YNc(9,Nt,2,2,"mat-option",12),p.qZA(),p.YNc(10,Rt,3,3,"mat-error",13),p.qZA(),p.TgZ(11,"mat-checkbox",14),p.NdJ("change",function(){return p.CHM(t),p.oxw().getServices()})("ngModelChange",function(e){return p.CHM(t),p.oxw().servicesOnFacility=e}),p._uU(12),p.ALo(13,"translate"),p.qZA(),p.TgZ(14,"mat-form-field"),p.TgZ(15,"mat-select",15),p.NdJ("ngModelChange",function(e){return p.CHM(t),p.oxw().selectedType=e})("selectionChange",function(){return p.CHM(t),p.oxw().destinationControl.updateValueAndValidity()}),p.ALo(16,"translate"),p.YNc(17,Dt,2,2,"mat-option",12),p.qZA(),p.qZA(),p.YNc(18,Ft,4,4,"mat-form-field",16),p.YNc(19,Yt,3,4,"mat-checkbox",17),p.TgZ(20,"mat-form-field"),p.TgZ(21,"mat-select",18),p.NdJ("ngModelChange",function(e){return p.CHM(t),p.oxw().selectedPropagation=e}),p.ALo(22,"translate"),p.YNc(23,Ut,2,2,"mat-option",12),p.qZA(),p.qZA(),p.TgZ(24,"div",8),p._uU(25),p.ALo(26,"translate"),p.qZA(),p.qZA()}if(2&t){const t=p.oxw();p.xp6(2),p.Oqu(p.lcZ(3,18,"DIALOGS.ADD_SERVICE_DESTINATION.DESCRIPTION")),p.xp6(3),p.s9C("placeholder",p.lcZ(6,20,"DIALOGS.ADD_SERVICE_DESTINATION.SERVICE")),p.Q6J("formControl",t.serviceControl),p.xp6(2),p.Q6J("ngIf",0!==t.services.length),p.xp6(1),p.Q6J("ngIf",0===t.services.length),p.xp6(1),p.Q6J("ngForOf",t.services),p.xp6(1),p.Q6J("ngIf",void 0===t.serviceControl.value),p.xp6(1),p.Q6J("ngModel",t.servicesOnFacility),p.xp6(1),p.Oqu(p.lcZ(13,22,"DIALOGS.ADD_SERVICE_DESTINATION.IS_SERVICES_ONLY_ON_FACILITY")),p.xp6(3),p.s9C("placeholder",p.lcZ(16,24,"DIALOGS.ADD_SERVICE_DESTINATION.TYPE")),p.Q6J("ngModel",t.selectedType),p.xp6(2),p.Q6J("ngForOf",t.types),p.xp6(1),p.Q6J("ngIf",!("host"===t.selectedType&&t.useFacilityHost)),p.xp6(1),p.Q6J("ngIf","host"===t.selectedType),p.xp6(2),p.s9C("placeholder",p.lcZ(22,26,"DIALOGS.ADD_SERVICE_DESTINATION.PROPAGATION")),p.Q6J("ngModel",t.selectedPropagation),p.xp6(2),p.Q6J("ngForOf",t.propagations),p.xp6(2),p.hij(" ",p.lcZ(26,28,"DIALOGS.ADD_SERVICE_DESTINATION.PROPAGATION_TYPE_"+t.selectedPropagation)," ")}}let Mt=(()=>{class t{constructor(t,e,i,s){this.dialogRef=t,this.data=e,this.facilitiesManager=i,this.servicesManager=s,this.services=[],this.types=["host","user@host","user@host:port","user@host-windows","host-windows-proxy","url","email","semail","service-specific"],this.selectedType="host",this.propagations=["PARALLEL","DUMMY"],this.selectedPropagation="PARALLEL",this.useFacilityHost=!1,this.loading=!1,this.emailRegex=new RegExp(r.B2),this.hostPattern=new RegExp("^(?!:\\/\\/)(?=.{1,255}$)((.{1,63}\\.){1,127}(?![0-9]*$)[a-z0-9-]+\\.?)$|^(25[0-5]|2[0-4]\\d|[0-1]?\\d?\\d)(\\.(25[0-5]|2[0-4]\\d|[0-1]?\\d?\\d)){3}$"),this.urlPattern=new RegExp("^(https?|ftp|file)://[-a-zA-Z0-9+&@#/%?=~_|!:,.;()*$']*[-a-zA-Z0-9+&@#/%=~_|()*$']$"),this.userAtHostPattern=new RegExp("^[a-z_]([a-z0-9_-]{0,31}|[a-z0-9_-]{0,30}\\$)@(?:(?!:\\/\\/)(?=.{1,255}$)((.{1,63}\\.){1,127}(?![0-9]*$)[a-z0-9-]+\\.?)$|(25[0-5]|2[0-4]\\d|[0-1]?\\d?\\d)(\\.(25[0-5]|2[0-4]\\d|[0-1]?\\d?\\d)){3}$)"),this.userAtHostPortPattern=new RegExp("^[a-z_]([a-z0-9_-]{0,31}|[a-z0-9_-]{0,30}\\$)@(?:(?!:\\/\\/)(?=.{1,255}$)((.{1,63}\\.){1,127}(?![0-9]*$)[a-z0-9-]+\\.?)|(25[0-5]|2[0-4]\\d|[0-1]?\\d?\\d)(\\.(25[0-5]|2[0-4]\\d|[0-1]?\\d?\\d)){3}):[0-9]+"),this.serviceSpecificPattern=new RegExp("^(?!-)[a-zA-Z0-9-_.:/]*$")}ngOnInit(){this.loading=!0,this.serviceControl=new et.NI(void 0,et.kI.required),this.destinationControl=new et.NI("",this.getDestinationValidator()),this.emailControl=new et.NI("",[et.kI.required,et.kI.pattern(this.emailRegex)]),this.facilitiesManager.getHosts(this.data.facility.id).subscribe(t=>{this.hosts=t,this.servicesOnFacility=!0,this.getServices(),this.loading=!1},()=>this.loading=!1)}getDestinationValidator(){return t=>{if(!t.value)return null;let e;switch(this.selectedType){case"host":case"host-windows-proxy":e=this.hostPattern;break;case"email":case"semail":e=this.emailRegex;break;case"url":e=this.urlPattern;break;case"user@host":case"user@host-windows":e=this.userAtHostPattern;break;case"user@host:port":e=this.userAtHostPortPattern;break;case"service-specific":e=this.serviceSpecificPattern;break;default:return null}return e.test(t.value)?null:{invalidDestination:{value:t.value}}}}onCancel(){this.dialogRef.close()}onSubmit(){this.loading=!0,"all"===this.serviceControl.value?this.useFacilityHost?this.servicesManager.addDestinationsDefinedByHostsOnFacilityWithListOfServiceAndFacility({services:this.services,facility:this.data.facility.id}).subscribe(()=>{this.dialogRef.close(!0)},()=>this.loading=!1):this.servicesManager.addDestinationToMultipleServices({services:this.services,facility:this.data.facility.id,destination:this.destinationControl.value,type:this.selectedType,propagationType:this.selectedPropagation}).subscribe(()=>{this.dialogRef.close(!0)},()=>this.loading=!1):this.useFacilityHost?this.servicesManager.addDestinationsDefinedByHostsOnFacilityWithServiceAndFacility(this.serviceControl.value.id,this.data.facility.id).subscribe(()=>{this.dialogRef.close(!0)},()=>this.loading=!1):this.servicesManager.addDestination(this.serviceControl.value.id,this.data.facility.id,this.destinationControl.value,this.selectedType,this.selectedPropagation).subscribe(()=>{this.dialogRef.close(!0)},()=>this.loading=!1)}getServices(){this.loading=!0,this.servicesOnFacility?0!==this.data.configServices.length?this.services=this.data.configServices:this.servicesManager.getAssignedServices(this.data.facility.id).subscribe(t=>{this.services=t},()=>this.loading=!1):this.servicesManager.getServices().subscribe(t=>{this.services=t},()=>this.loading=!1),this.loading=!1,this.serviceControl.setValue(void 0)}getTypeForView(t){return"semail"===t?"Send Mail":"service-specific"===t?"Service Specific":t}invalidDestination(){return("host"!==this.selectedType||!this.useFacilityHost)&&this.destinationControl.invalid}}return t.\u0275fac=function(e){return new(e||t)(p.Y36(g.so),p.Y36(g.WI),p.Y36(c.IQ),p.Y36(c.KK))},t.\u0275cmp=p.Xpm({type:t,selectors:[["app-perun-web-apps-add-services-destination-dialog"]],decls:13,vars:15,consts:[["mat-dialog-title",""],["class","mr-auto ml-auto",4,"ngIf"],["mat-dialog-content","","class","dialog-container",4,"ngIf"],["mat-dialog-actions",""],["mat-flat-button","",1,"ml-auto",3,"click"],["color","accent","mat-flat-button","",1,"ml-2",3,"disabled","click"],[1,"mr-auto","ml-auto"],["mat-dialog-content","",1,"dialog-container"],[1,"font-italic"],["required","",3,"formControl","placeholder"],["value","all",4,"ngIf"],["value","noService",4,"ngIf"],[3,"value",4,"ngFor","ngForOf"],[4,"ngIf"],[3,"ngModel","change","ngModelChange"],[3,"ngModel","placeholder","ngModelChange","selectionChange"],["class","w-100",4,"ngIf"],[3,"ngModel","ngModelChange",4,"ngIf"],[3,"ngModel","placeholder","ngModelChange"],["value","all"],["value","noService"],[3,"value"],[1,"w-100"],["matInput","","required","",3,"formControl","placeholder"],[3,"ngModel","ngModelChange"]],template:function(t,e){1&t&&(p.TgZ(0,"div"),p.TgZ(1,"h1",0),p._uU(2),p.ALo(3,"translate"),p.qZA(),p.YNc(4,Ot,1,0,"mat-spinner",1),p.YNc(5,qt,27,30,"div",2),p.TgZ(6,"div",3),p.TgZ(7,"button",4),p.NdJ("click",function(){return e.onCancel()}),p._uU(8),p.ALo(9,"translate"),p.qZA(),p.TgZ(10,"button",5),p.NdJ("click",function(){return e.onSubmit()}),p._uU(11),p.ALo(12,"translate"),p.qZA(),p.qZA(),p.qZA()),2&t&&(p.Tol(e.data.theme),p.xp6(2),p.Oqu(p.lcZ(3,9,"DIALOGS.ADD_SERVICE_DESTINATION.TITLE")),p.xp6(2),p.Q6J("ngIf",e.loading),p.xp6(1),p.Q6J("ngIf",!e.loading),p.xp6(3),p.hij(" ",p.lcZ(9,11,"DIALOGS.ADD_SERVICE_DESTINATION.CANCEL")," "),p.xp6(2),p.Q6J("disabled",e.loading||e.invalidDestination()||e.serviceControl.invalid||"noService"===e.serviceControl.value),p.xp6(1),p.hij(" ",p.lcZ(12,13,"DIALOGS.ADD_SERVICE_DESTINATION.ADD")," "))},directives:[g.uh,s.O5,g.H8,b.lW,A.$g,g.xY,lt.KE,yt.gD,et.Q7,et.JJ,et.oH,s.sg,nt.oG,et.On,rt.ey,lt.TO,ot.Nt,et.Fj],pipes:[E.X$],styles:[""],data:{animation:[l.BQ]}}),t})();var Jt=i(59403),Qt=i(19139),Vt=i(39571),Ht=i(94357);function Pt(t,e){1&t&&(p.TgZ(0,"app-alert",9),p._uU(1),p.ALo(2,"translate"),p.qZA()),2&t&&(p.xp6(1),p.hij(" ",p.lcZ(2,1,"FACILITY_DETAIL.SERVICES_DESTINATIONS.DESTINATIONS_INFO")," "))}function Gt(t,e){if(1&t){const t=p.EpF();p.TgZ(0,"button",10),p.NdJ("click",function(){return p.CHM(t),p.oxw().addDestination()}),p._uU(1),p.ALo(2,"translate"),p.qZA()}2&t&&(p.xp6(1),p.hij(" ",p.lcZ(2,1,"FACILITY_DETAIL.SERVICES_DESTINATIONS.ADD")," "))}function Bt(t,e){if(1&t){const t=p.EpF();p.TgZ(0,"button",11),p.NdJ("click",function(){return p.CHM(t),p.oxw().removeDestination()}),p._uU(1),p.ALo(2,"translate"),p.qZA()}if(2&t){const t=p.oxw();p.Q6J("disabled",0===t.selected.selected.length),p.xp6(1),p.hij(" ",p.lcZ(2,2,"FACILITY_DETAIL.SERVICES_DESTINATIONS.REMOVE")," ")}}function $t(t,e){if(1&t){const t=p.EpF();p.TgZ(0,"button",12),p.NdJ("click",function(){return p.CHM(t),p.oxw().onAllow()}),p.TgZ(1,"mat-icon"),p._uU(2," check_circle_outline "),p.qZA(),p._uU(3),p.ALo(4,"translate"),p.qZA()}if(2&t){const t=p.oxw();p.Q6J("disabled",0===t.selected.selected.length||t.allSelectedAllowed()),p.xp6(3),p.hij(" ",p.lcZ(4,2,"FACILITY_DETAIL.SERVICES_DESTINATIONS.ALLOW")," ")}}function jt(t,e){if(1&t){const t=p.EpF();p.TgZ(0,"button",12),p.NdJ("click",function(){return p.CHM(t),p.oxw().onBlock()}),p.TgZ(1,"mat-icon"),p._uU(2," block "),p.qZA(),p._uU(3),p.ALo(4,"translate"),p.qZA()}if(2&t){const t=p.oxw();p.Q6J("disabled",0===t.selected.selected.length||t.allSelectedBlocked()),p.xp6(3),p.hij(" ",p.lcZ(4,2,"FACILITY_DETAIL.SERVICES_DESTINATIONS.BLOCK")," ")}}function zt(t,e){1&t&&p._UZ(0,"mat-spinner",13)}function Xt(t,e){if(1&t&&p._UZ(0,"app-perun-web-apps-destination-list",14),2&t){const t=p.oxw();p.Q6J("tableId",t.tableId)("filterValue",t.filterValue)("destinations",t.destinations)("selection",t.selected)("displayedColumns",t.displayedColumns)("services",t.configServicesIds)}}let Wt=(()=>{class t{constructor(t,e,i,s,a,n,l,o){this.dialog=t,this.facilitiesManager=e,this.servicesManager=i,this.translate=s,this.notificator=a,this.authResolver=n,this.serviceManager=l,this.entityStorageService=o,this.selected=new vt.Ov(!0,[]),this.displayedColumns=["select","destinationId","service","destination","type","propagationType"],this.configServices=[],this.configServicesIds=new Set,this.title="FACILITY_DETAIL.SERVICES_DESTINATIONS.TITLE",this.destinationEmitter=new p.vpe,this.filterValue="",this.tableId=Ct.Cf}ngOnInit(){this.loading=!0,this.facility=this.entityStorageService.getEntity(),this.setAuthRights(),this.refreshTable()}refreshTable(){this.loading=!0,this.servicesManager.getAllRichDestinationsForFacility(this.facility.id).subscribe(t=>{this.destinations=t,this.destinationEmitter.emit(this.destinations),this.selected.clear(),this.setAuthRights(),this.loading=!1})}setAuthRights(){this.addAuth=this.authResolver.isAuthorized("addDestination_Service_Facility_Destination_policy",[this.facility]),this.removeAuth=this.authResolver.isAuthorized("removeDestination_Service_Facility_Destination_policy",[this.facility]),this.allowAuth=this.authResolver.isAuthorized("unblockServiceOnDestination_Service_int_policy",[this.facility]),this.blockAuth=this.authResolver.isAuthorized("blockServiceOnDestination_Service_int_policy",[this.facility]),this.displayedColumns=this.removeAuth?this.displayedColumns:this.displayedColumns.filter(t=>"select"!==t)}addDestination(){const t=(0,r.kZ)();t.width="600px",t.data={facility:this.facility,theme:"facility-theme",configServices:this.configServices},this.dialog.open(Mt,t).afterClosed().subscribe(t=>{t&&this.translate.get("FACILITY_DETAIL.SERVICES_DESTINATIONS.ADD_SUCCESS").subscribe(t=>{this.refreshTable(),this.notificator.showSuccess(t)})})}removeDestination(){const t=(0,r.kZ)();t.width="600px",t.data={destinations:this.selected.selected,theme:"facility-theme"},this.dialog.open(_t.u,t).afterClosed().subscribe(t=>{t&&this.refreshTable()})}blockServiceOnDestinations(t){if(0===t.length)return this.notificator.showSuccess(this.translate.instant("FACILITY_DETAIL.SERVICES_DESTINATIONS.BLOCK_SUCCESS")),void this.refreshTable();const e=t.pop();this.serviceManager.blockServiceOnDestination(e.service.id,e.id).subscribe(()=>{this.blockServiceOnDestinations(t)},()=>this.loading=!1)}onBlock(){this.loading=!0,this.blockServiceOnDestinations(this.selected.selected)}allowServiceOnDestinations(t){if(0===t.length)return this.notificator.showSuccess(this.translate.instant("FACILITY_DETAIL.SERVICES_DESTINATIONS.ALLOW_SUCCESS")),void this.refreshTable();const e=t.pop();this.serviceManager.unblockServiceOnDestinationById(e.service.id,e.id).subscribe(()=>{this.allowServiceOnDestinations(t)},()=>this.loading=!1)}onAllow(){this.loading=!0,this.allowServiceOnDestinations(this.selected.selected)}applyFilter(t){this.filterValue=t}allSelectedAllowed(){return this.selected.selected.reduce((t,e)=>t&&!e.blocked,!0)}allSelectedBlocked(){return this.selected.selected.reduce((t,e)=>t&&e.blocked,!0)}}return t.id="FacilityServicesDestinationsComponent",t.\u0275fac=function(e){return new(e||t)(p.Y36(g.uw),p.Y36(c.IQ),p.Y36(c.KK),p.Y36(E.sK),p.Y36(d.V6),p.Y36(d.x4),p.Y36(c.KK),p.Y36(d.fb))},t.\u0275cmp=p.Xpm({type:t,selectors:[["app-perun-web-apps-facility-services-destinations"]],hostVars:2,hostBindings:function(t,e){2&t&&p.ekj("router-component",e.true)},inputs:{displayedColumns:"displayedColumns",configServices:"configServices",configServicesIds:"configServicesIds",title:"title",loading:"loading"},outputs:{destinationEmitter:"destinationEmitter"},decls:13,vars:11,consts:[[1,"page-subtitle"],["alert_type","info",4,"ngIf"],[3,"refresh"],["mat-flat-button","","color","accent","class","mr-2 action-button",3,"click",4,"ngIf"],["mat-flat-button","","color","warn","class","mr-2",3,"disabled","click",4,"ngIf"],["mat-stroked-button","","class","mr-2",3,"disabled","click",4,"ngIf"],[3,"placeholder","filter"],["class","ml-auto mr-auto",4,"ngIf"],[3,"tableId","filterValue","destinations","selection","displayedColumns","services",4,"ngIf"],["alert_type","info"],["mat-flat-button","","color","accent",1,"mr-2","action-button",3,"click"],["mat-flat-button","","color","warn",1,"mr-2",3,"disabled","click"],["mat-stroked-button","",1,"mr-2",3,"disabled","click"],[1,"ml-auto","mr-auto"],[3,"tableId","filterValue","destinations","selection","displayedColumns","services"]],template:function(t,e){1&t&&(p.TgZ(0,"div"),p.TgZ(1,"h1",0),p._uU(2),p.ALo(3,"translate"),p.qZA(),p.YNc(4,Pt,3,3,"app-alert",1),p.TgZ(5,"perun-web-apps-refresh-button",2),p.NdJ("refresh",function(){return e.refreshTable()}),p.qZA(),p.YNc(6,Gt,3,3,"button",3),p.YNc(7,Bt,3,4,"button",4),p.YNc(8,$t,5,4,"button",5),p.YNc(9,jt,5,4,"button",5),p.TgZ(10,"perun-web-apps-immediate-filter",6),p.NdJ("filter",function(t){return e.applyFilter(t)}),p.qZA(),p.YNc(11,zt,1,0,"mat-spinner",7),p.YNc(12,Xt,1,6,"app-perun-web-apps-destination-list",8),p.qZA()),2&t&&(p.xp6(2),p.Oqu(p.lcZ(3,9,e.title)),p.xp6(2),p.Q6J("ngIf",e.title.includes("CONFIG")),p.xp6(2),p.Q6J("ngIf",e.addAuth),p.xp6(1),p.Q6J("ngIf",e.removeAuth),p.xp6(1),p.Q6J("ngIf",e.allowAuth),p.xp6(1),p.Q6J("ngIf",e.blockAuth),p.xp6(1),p.Q6J("placeholder","FACILITY_DETAIL.SERVICES_DESTINATIONS.FILTER"),p.xp6(1),p.Q6J("ngIf",e.loading),p.xp6(1),p.Q6J("ngIf",!e.loading))},directives:[s.O5,Jt.t,Qt.L,Vt.w,b.lW,I.Hw,A.$g,Ht.q],pipes:[E.X$],styles:[""]}),t})();var Kt=i(17767);function te(t,e){1&t&&p._UZ(0,"mat-spinner",3)}function ee(t,e){if(1&t){const t=p.EpF();p.TgZ(0,"div"),p.TgZ(1,"perun-web-apps-immediate-filter",4),p.NdJ("filter",function(e){return p.CHM(t),p.oxw().applyFilter(e)}),p.qZA(),p.TgZ(2,"div",5),p._UZ(3,"perun-web-apps-owners-list",6),p.qZA(),p.TgZ(4,"div",7),p.TgZ(5,"button",8),p.NdJ("click",function(){return p.CHM(t),p.oxw().onCancel()}),p._uU(6),p.ALo(7,"translate"),p.qZA(),p.TgZ(8,"button",9),p.NdJ("click",function(){return p.CHM(t),p.oxw().onAdd()}),p._uU(9),p.ALo(10,"translate"),p.qZA(),p.qZA(),p.qZA()}if(2&t){const t=p.oxw();p.xp6(1),p.Q6J("placeholder","DIALOGS.ADD_OWNERS.FILTER"),p.xp6(2),p.Q6J("filterValue",t.filterValue)("tableId",t.tableId)("owners",t.owners)("selection",t.selection),p.xp6(3),p.hij(" ",p.lcZ(7,8,"DIALOGS.ADD_OWNERS.CANCEL")," "),p.xp6(2),p.Q6J("disabled",0===t.selection.selected.length||t.loading),p.xp6(1),p.hij(" ",p.lcZ(10,10,"DIALOGS.ADD_OWNERS.ADD")," ")}}let ie=(()=>{class t{constructor(t,e,i,s,a,n){this.dialogRef=t,this.data=e,this.notificator=i,this.translate=s,this.ownersManagerService=a,this.facilitiesManagerService=n,this.extSources=[],this.selection=new vt.Ov(!0,[]),this.filterValue="",this.tableId=Ct.BV,this.owners=[],this.translate.get("DIALOGS.ADD_OWNERS.SUCCESS").subscribe(t=>this.successMessage=t)}ngOnInit(){this.theme=this.data.theme,this.loading=!0,this.ownersManagerService.getAllOwners().subscribe(t=>{this.owners=t.filter(t=>!this.data.forbiddenOwners.includes(t.id)),this.loading=!1},()=>this.loading=!1)}applyFilter(t){this.filterValue=t}onAdd(){this.loading=!0,0!==this.selection.selected.length?this.facilitiesManagerService.addFacilityOwner(this.data.facilityId,this.selection.selected.pop().id).subscribe(()=>this.onAdd(),()=>this.loading=!1):(this.loading=!1,this.notificator.showSuccess(this.successMessage),this.dialogRef.close(!0))}onCancel(){this.dialogRef.close(!1)}}return t.\u0275fac=function(e){return new(e||t)(p.Y36(g.so),p.Y36(g.WI),p.Y36(d.V6),p.Y36(E.sK),p.Y36(c.aC),p.Y36(c.IQ))},t.\u0275cmp=p.Xpm({type:t,selectors:[["app-add-facility-owner-dialog"]],decls:6,vars:8,consts:[["mat-dialog-title",""],["class","mr-auto ml-auto",4,"ngIf"],[4,"ngIf"],[1,"mr-auto","ml-auto"],[1,"font-size-1rem",3,"placeholder","filter"],["mat-dialog-content",""],[3,"filterValue","tableId","owners","selection"],["mat-dialog-actions",""],["mat-flat-button","",1,"ml-auto",3,"click"],["color","accent","mat-flat-button","",1,"ml-2",3,"disabled","click"]],template:function(t,e){1&t&&(p.TgZ(0,"h1",0),p._uU(1),p.ALo(2,"translate"),p.qZA(),p.TgZ(3,"div"),p.YNc(4,te,1,0,"mat-spinner",1),p.YNc(5,ee,11,12,"div",2),p.qZA()),2&t&&(p.xp6(1),p.Oqu(p.lcZ(2,6,"DIALOGS.ADD_OWNERS.TITLE")),p.xp6(2),p.Tol(e.theme),p.xp6(1),p.Q6J("ngIf",e.loading),p.xp6(1),p.Q6J("ngIf",!e.loading))},directives:[g.uh,s.O5,A.$g,Qt.L,g.xY,Kt.Q,g.H8,b.lW],pipes:[E.X$],styles:[""]}),t})();var se=i(67033);function ae(t,e){1&t&&p._UZ(0,"mat-spinner",6)}function ne(t,e){1&t&&p._UZ(0,"th",15)}function le(t,e){if(1&t&&(p.TgZ(0,"td",16),p._uU(1),p.qZA()),2&t){const t=e.$implicit;p.xp6(1),p.hij(" ",t.name," ")}}function oe(t,e){1&t&&p._UZ(0,"tr",17)}function ce(t,e){1&t&&p._UZ(0,"tr",18)}function re(t,e){if(1&t&&(p.TgZ(0,"div",7),p.TgZ(1,"p"),p._uU(2),p.ALo(3,"translate"),p.qZA(),p.TgZ(4,"div",8),p._uU(5),p.ALo(6,"translate"),p.qZA(),p.TgZ(7,"table",9),p.ynx(8,10),p.YNc(9,ne,1,0,"th",11),p.YNc(10,le,2,1,"td",12),p.BQk(),p.YNc(11,oe,1,0,"tr",13),p.YNc(12,ce,1,0,"tr",14),p.qZA(),p.qZA()),2&t){const t=p.oxw();p.xp6(2),p.hij(" ",p.lcZ(3,5,"DIALOGS.REMOVE_OWNERS.DESCRIPTION")," "),p.xp6(3),p.hij(" ",p.lcZ(6,7,"DIALOGS.REMOVE_OWNERS.ASK")," "),p.xp6(2),p.Q6J("dataSource",t.dataSource),p.xp6(4),p.Q6J("matHeaderRowDef",t.displayedColumns),p.xp6(1),p.Q6J("matRowDefColumns",t.displayedColumns)}}let de=(()=>{class t{constructor(t,e,i,s,a){this.dialogRef=t,this.data=e,this.notificator=i,this.translate=s,this.facilitiesManagerService=a,this.displayedColumns=["name"],s.get("DIALOGS.REMOVE_OWNERS.SUCCESS").subscribe(t=>this.successMessage=t)}ngOnInit(){this.dataSource=new se.by(this.data.owners),this.theme=this.data.theme}onCancel(){this.dialogRef.close(!1)}onSubmit(){this.loading=!0,0!==this.data.owners.length?this.facilitiesManagerService.removeFacilityOwner(this.data.facilityId,this.data.owners.pop().id).subscribe(()=>this.onSubmit(),()=>this.loading=!1):(this.loading=!1,this.notificator.showSuccess(this.successMessage),this.dialogRef.close(!0))}}return t.\u0275fac=function(e){return new(e||t)(p.Y36(g.so),p.Y36(g.WI),p.Y36(d.V6),p.Y36(E.sK),p.Y36(c.IQ))},t.\u0275cmp=p.Xpm({type:t,selectors:[["app-remove-facility-owner-dialog"]],decls:13,vars:15,consts:[["mat-dialog-title",""],["class","mr-auto ml-auto",4,"ngIf"],["mat-dialog-content","",4,"ngIf"],["mat-dialog-actions",""],["mat-flat-button","",1,"ml-auto",3,"click"],["color","warn","mat-flat-button","",1,"ml-2",3,"disabled","click"],[1,"mr-auto","ml-auto"],["mat-dialog-content",""],[1,"font-weight-bold"],["mat-table","",1,"w-100",3,"dataSource"],["matColumnDef","name"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["class","font-weight-bolder","mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["mat-header-cell",""],["mat-cell",""],["mat-header-row","",1,"font-weight-bolder"],["mat-row",""]],template:function(t,e){1&t&&(p.TgZ(0,"h1",0),p._uU(1),p.ALo(2,"translate"),p.qZA(),p.TgZ(3,"div"),p.YNc(4,ae,1,0,"mat-spinner",1),p.YNc(5,re,13,9,"div",2),p.TgZ(6,"div",3),p.TgZ(7,"button",4),p.NdJ("click",function(){return e.onCancel()}),p._uU(8),p.ALo(9,"translate"),p.qZA(),p.TgZ(10,"button",5),p.NdJ("click",function(){return e.onSubmit()}),p._uU(11),p.ALo(12,"translate"),p.qZA(),p.qZA(),p.qZA()),2&t&&(p.xp6(1),p.Oqu(p.lcZ(2,9,"DIALOGS.REMOVE_OWNERS.TITLE")),p.xp6(2),p.Tol(e.theme),p.xp6(1),p.Q6J("ngIf",e.loading),p.xp6(1),p.Q6J("ngIf",!e.loading),p.xp6(3),p.hij(" ",p.lcZ(9,11,"DIALOGS.REMOVE_OWNERS.CANCEL")," "),p.xp6(2),p.Q6J("disabled",e.loading),p.xp6(1),p.hij(" ",p.lcZ(12,13,"DIALOGS.REMOVE_OWNERS.DELETE")," "))},directives:[g.uh,s.O5,g.H8,b.lW,A.$g,g.xY,se.BZ,se.w1,se.fO,se.Dz,se.as,se.nj,se.ge,se.ev,se.XQ,se.Gk],pipes:[E.X$],styles:[""]}),t})();function ue(t,e){if(1&t){const t=p.EpF();p.TgZ(0,"button",7),p.NdJ("click",function(){return p.CHM(t),p.oxw().onCreate()}),p._uU(1),p.ALo(2,"translate"),p.qZA()}2&t&&(p.xp6(1),p.hij(" ",p.lcZ(2,1,"FACILITY_DETAIL.SETTINGS.OWNERS.ADD"),"\n"))}function he(t,e){if(1&t){const t=p.EpF();p.TgZ(0,"button",8),p.NdJ("click",function(){return p.CHM(t),p.oxw().onRemove()}),p._uU(1),p.ALo(2,"translate"),p.qZA()}if(2&t){const t=p.oxw();p.Q6J("disabled",0===t.selection.selected.length),p.xp6(1),p.hij(" ",p.lcZ(2,2,"FACILITY_DETAIL.SETTINGS.OWNERS.DELETE"),"\n")}}function pe(t,e){1&t&&p._UZ(0,"mat-spinner",9)}function ge(t,e){if(1&t&&p._UZ(0,"perun-web-apps-owners-list",10),2&t){const t=p.oxw();p.Q6J("tableId",t.tableId)("filterValue",t.filterValue)("owners",t.owners)("displayedColumns",t.displayedColumns)("selection",t.selection)}}let fe=(()=>{class t{constructor(t,e,i,s){this.facilitiesManagerService=t,this.dialog=e,this.authResolver=i,this.entityStorageService=s,this.owners=[],this.selection=new vt.Ov(!0,[]),this.displayedColumns=["id","name","contact","type"],this.tableId=Ct.zp,this.ownerEmitter=new p.vpe}ngOnInit(){this.filterValue="",this.facility=this.entityStorageService.getEntity(),this.setAuthRights(),this.refreshTable()}refreshTable(){this.loading=!0,this.selection.clear(),this.facilitiesManagerService.getFacilityOwners(this.facility.id).subscribe(t=>{this.owners=t,this.ownerEmitter.emit(this.owners),this.loading=!1})}setAuthRights(){this.addAuth=this.authResolver.isAuthorized("addOwner_Facility_Owner_policy",[this.facility]),this.removeAuth=this.authResolver.isAuthorized("removeOwner_Facility_Owner_policy",[this.facility]),this.displayedColumns=this.removeAuth?["select","id","name","contact","type"]:["id","name","contact","type"]}applyFilter(t){this.filterValue=t}onCreate(){const t=(0,r.kZ)();t.width="800px",t.data={theme:"facility-theme",facilityId:this.facility.id,forbiddenOwners:this.owners.map(t=>t.id)},this.dialog.open(ie,t).afterClosed().subscribe(t=>{t&&this.refreshTable()})}onRemove(){const t=(0,r.kZ)();t.width="600px",t.data={theme:"facility-theme",owners:this.selection.selected,facilityId:this.facility.id},this.dialog.open(de,t).afterClosed().subscribe(t=>{t&&this.refreshTable()})}}return t.\u0275fac=function(e){return new(e||t)(p.Y36(c.IQ),p.Y36(g.uw),p.Y36(d.x4),p.Y36(d.fb))},t.\u0275cmp=p.Xpm({type:t,selectors:[["app-facility-settings-owners"]],outputs:{ownerEmitter:"ownerEmitter"},decls:9,vars:8,consts:[[1,"page-subtitle"],[3,"refresh"],["class","mr-2 action-button","color","accent","mat-flat-button","",3,"click",4,"ngIf"],["class","mr-2","color","warn","mat-flat-button","",3,"disabled","click",4,"ngIf"],[3,"placeholder","filter"],["class","ml-auto mr-auto",4,"ngIf"],[3,"tableId","filterValue","owners","displayedColumns","selection",4,"ngIf"],["color","accent","mat-flat-button","",1,"mr-2","action-button",3,"click"],["color","warn","mat-flat-button","",1,"mr-2",3,"disabled","click"],[1,"ml-auto","mr-auto"],[3,"tableId","filterValue","owners","displayedColumns","selection"]],template:function(t,e){1&t&&(p.TgZ(0,"h1",0),p._uU(1),p.ALo(2,"translate"),p.qZA(),p.TgZ(3,"perun-web-apps-refresh-button",1),p.NdJ("refresh",function(){return e.refreshTable()}),p.qZA(),p.YNc(4,ue,3,3,"button",2),p.YNc(5,he,3,4,"button",3),p.TgZ(6,"perun-web-apps-immediate-filter",4),p.NdJ("filter",function(t){return e.applyFilter(t)}),p.qZA(),p.YNc(7,pe,1,0,"mat-spinner",5),p.YNc(8,ge,1,5,"perun-web-apps-owners-list",6)),2&t&&(p.xp6(1),p.Oqu(p.lcZ(2,6,"FACILITY_DETAIL.SETTINGS.OWNERS.TITLE")),p.xp6(3),p.Q6J("ngIf",e.addAuth),p.xp6(1),p.Q6J("ngIf",e.removeAuth),p.xp6(1),p.Q6J("placeholder","VO_MANAGEMENT.FILTER_PLACEHOLDER"),p.xp6(1),p.Q6J("ngIf",e.loading),p.xp6(1),p.Q6J("ngIf",!e.loading))},directives:[Jt.t,s.O5,Qt.L,b.lW,A.$g,Kt.Q],pipes:[E.X$],styles:[""]}),t})();var me=i(84534);function Ae(t,e){1&t&&p._UZ(0,"mat-spinner",6)}function Ie(t,e){1&t&&(p.TgZ(0,"mat-error"),p._uU(1),p.ALo(2,"translate"),p.qZA()),2&t&&(p.xp6(1),p.hij(" ",p.lcZ(2,1,"DIALOGS.ADD_HOST.EMPTY_MESSAGE")," "))}function Se(t,e){if(1&t&&(p.TgZ(0,"mat-error"),p._uU(1),p.ALo(2,"translate"),p.qZA()),2&t){const t=p.oxw(2);p.xp6(1),p.AsE(" ",p.lcZ(2,2,"DIALOGS.ADD_HOST.INVALID_HOST"),"",t.hostsCtrl.getError("invalidHost").value," ")}}function Te(t,e){if(1&t&&(p.TgZ(0,"div",7),p.TgZ(1,"mat-form-field"),p.TgZ(2,"textarea",8),p.ALo(3,"translate"),p._uU(4,"      "),p.qZA(),p.YNc(5,Ie,3,3,"mat-error",9),p.YNc(6,Se,3,4,"mat-error",9),p.qZA(),p.TgZ(7,"app-alert",10),p._uU(8),p.ALo(9,"translate"),p.qZA(),p.qZA()),2&t){const t=p.oxw();p.xp6(2),p.Q6J("placeholder",p.lcZ(3,5,"DIALOGS.ADD_HOST.SUBTITLE"))("formControl",t.hostsCtrl),p.xp6(3),p.Q6J("ngIf",t.hostsCtrl.hasError("required")),p.xp6(1),p.Q6J("ngIf",t.hostsCtrl.hasError("invalidHost")),p.xp6(2),p.Oqu(p.lcZ(9,7,"DIALOGS.ADD_HOST.HINT"))}}let be=(()=>{class t{constructor(t,e,i,s,a){this.dialogRef=t,this.data=e,this.facilitiesManager=i,this.notificator=s,this.translate=a,this.loading=!1,this.hostPattern=new RegExp("^(?!:\\/\\/)(?=.{1,255}$)((.{1,63}\\.){1,127}(?![0-9]*$)[a-z0-9-]+\\.?)$|^(25[0-5]|2[0-4]\\d|[0-1]?\\d?\\d)(\\.(25[0-5]|2[0-4]\\d|[0-1]?\\d?\\d)){3}$")}ngOnInit(){this.theme=this.data.theme,this.facilityName=this.data.facilityName,this.hostsCtrl=new et.NI("",[et.kI.required,this.hostsNameValidator()]),this.hostsCtrl.markAllAsTouched()}onAdd(){this.loading=!0;const t=this.hostsCtrl.value.split("\n");let e=[];for(const i of t)e=e.concat(this.parseHostName(i));this.facilitiesManager.addHosts(this.data.facilityId,e).subscribe(()=>{this.notificator.showSuccess(this.translate.instant("DIALOGS.ADD_HOST.SUCCESS")),this.dialogRef.close(!0)},()=>this.loading=!1)}onCancel(){this.dialogRef.close(!1)}hostsNameValidator(){return t=>{let e=[];const i=t.value.split("\n");for(const s of i)e=e.concat(this.parseHostName(s));for(const s of e)if(!this.hostPattern.test(s))return{invalidHost:{value:s}};return null}}parseHostName(t){const e=new RegExp("[[0-9]+-[0-9]+]","g"),i=t.split(e),s=t.match(e);if(null==s)return""===t?[]:[t];let a=[];for(let n=0;n<i.length-1;n++){const[t,e]=this.parseRange(s[n]);let l=[];for(let s=t;s<=e;s++)l=l.concat(i[n].concat(s.toString()));a=a.concat([l])}return a=a.concat([i[i.length-1]]),this.joinHostNames(a,0)}parseRange(t){const[e,i]=t.split("-");return[parseInt(e.substring(1,e.length),10),parseInt(i.substring(0,i.length),10)]}joinHostNames(t,e){if(e===t.length-1)return[t[e]];const i=this.joinHostNames(t,e+1),s=[];for(const a of t[e])for(const t of i)s.push(a.concat(t));return s}}return t.\u0275fac=function(e){return new(e||t)(p.Y36(g.so),p.Y36(g.WI),p.Y36(c.IQ),p.Y36(d.V6),p.Y36(E.sK))},t.\u0275cmp=p.Xpm({type:t,selectors:[["app-add-host-dialog"]],decls:13,vars:16,consts:[["mat-dialog-title",""],["class","ml-auto mr-auto",4,"ngIf"],["mat-dialog-content","","class","dialog-container",4,"ngIf"],["mat-dialog-actions",""],["mat-flat-button","",1,"ml-auto",3,"click"],["mat-flat-button","","color","accent",1,"ml-2",3,"disabled","click"],[1,"ml-auto","mr-auto"],["mat-dialog-content","",1,"dialog-container"],["id","facilityAddHost","name","facilityAddHost","rows","8","cols","50","matInput","","required","","perunWebAppsAutoFocus","",1,"md-textarea","form-control",3,"placeholder","formControl"],[4,"ngIf"],["alert_type","info"]],template:function(t,e){1&t&&(p.TgZ(0,"div"),p.TgZ(1,"h1",0),p._uU(2),p.ALo(3,"translate"),p.qZA(),p.YNc(4,Ae,1,0,"mat-spinner",1),p.YNc(5,Te,10,9,"div",2),p.TgZ(6,"div",3),p.TgZ(7,"button",4),p.NdJ("click",function(){return e.onCancel()}),p._uU(8),p.ALo(9,"translate"),p.qZA(),p.TgZ(10,"button",5),p.NdJ("click",function(){return e.onAdd()}),p._uU(11),p.ALo(12,"translate"),p.qZA(),p.qZA(),p.qZA()),2&t&&(p.Tol(e.theme),p.xp6(2),p.AsE("",e.facilityName,": ",p.lcZ(3,10,"DIALOGS.ADD_HOST.TITLE"),""),p.xp6(2),p.Q6J("ngIf",e.loading),p.xp6(1),p.Q6J("ngIf",!e.loading),p.xp6(3),p.hij(" ",p.lcZ(9,12,"DIALOGS.ADD_HOST.CANCEL"),""),p.xp6(2),p.Q6J("disabled",e.hostsCtrl.invalid||e.loading),p.xp6(1),p.hij(" ",p.lcZ(12,14,"DIALOGS.ADD_HOST.ADD"),""))},directives:[g.uh,s.O5,g.H8,b.lW,A.$g,g.xY,lt.KE,ot.Nt,et.Fj,et.Q7,me.hT,et.JJ,et.oH,Vt.w,lt.TO],pipes:[E.X$],styles:[""]}),t})();function Ee(t,e){1&t&&p._UZ(0,"mat-spinner",6)}function Ze(t,e){1&t&&p._UZ(0,"th",15)}function Ce(t,e){if(1&t&&(p.TgZ(0,"td",16),p._uU(1),p.qZA()),2&t){const t=e.$implicit;p.xp6(1),p.hij(" ",t.hostname," ")}}function ve(t,e){1&t&&p._UZ(0,"tr",17)}function _e(t,e){1&t&&p._UZ(0,"tr",18)}function ye(t,e){if(1&t&&(p.TgZ(0,"div",7),p.TgZ(1,"p"),p._uU(2),p.ALo(3,"translate"),p.qZA(),p.TgZ(4,"div",8),p._uU(5),p.ALo(6,"translate"),p.qZA(),p.TgZ(7,"table",9),p.ynx(8,10),p.YNc(9,Ze,1,0,"th",11),p.YNc(10,Ce,2,1,"td",12),p.BQk(),p.YNc(11,ve,1,0,"tr",13),p.YNc(12,_e,1,0,"tr",14),p.qZA(),p.qZA()),2&t){const t=p.oxw();p.xp6(2),p.Oqu(p.lcZ(3,5,"DIALOGS.REMOVE_HOST.DESCRIPTION")),p.xp6(3),p.hij(" ",p.lcZ(6,7,"DIALOGS.REMOVE_HOST.ASK")," "),p.xp6(2),p.Q6J("dataSource",t.dataSource),p.xp6(4),p.Q6J("matHeaderRowDef",t.displayedColumns),p.xp6(1),p.Q6J("matRowDefColumns",t.displayedColumns)}}let Oe=(()=>{class t{constructor(t,e,i,s,a){this.dialogRef=t,this.data=e,this.facilitiesManager=i,this.notificator=s,this.translate=a,this.displayedColumns=["name"],this.loading=!1}ngOnInit(){this.theme=this.data.theme,this.hosts=this.data.hosts,this.dataSource=new se.by(this.data.hosts)}onConfirm(){this.loading=!0,this.facilitiesManager.removeHosts(this.data.facilityId,this.hosts.map(t=>t.id)).subscribe(()=>{this.notificator.showSuccess(this.translate.instant("DIALOGS.REMOVE_HOST.SUCCESS")),this.dialogRef.close(!0)},()=>this.loading=!1)}onCancel(){this.dialogRef.close(!1)}}return t.\u0275fac=function(e){return new(e||t)(p.Y36(g.so),p.Y36(g.WI),p.Y36(c.IQ),p.Y36(d.V6),p.Y36(E.sK))},t.\u0275cmp=p.Xpm({type:t,selectors:[["app-remove-host-dialog"]],decls:13,vars:15,consts:[["mat-dialog-title",""],["class","mr-auto ml-auto",4,"ngIf"],["mat-dialog-content","",4,"ngIf"],["mat-dialog-actions",""],["mat-flat-button","",1,"ml-auto",3,"click"],["mat-flat-button","","color","warn",1,"ml-2",3,"disabled","click"],[1,"mr-auto","ml-auto"],["mat-dialog-content",""],[1,"font-weight-bold"],["mat-table","",1,"w-100",3,"dataSource"],["matColumnDef","name"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["mat-header-row","","class","font-weight-bolder",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["mat-header-cell",""],["mat-cell",""],["mat-header-row","",1,"font-weight-bolder"],["mat-row",""]],template:function(t,e){1&t&&(p.TgZ(0,"h1",0),p._uU(1),p.ALo(2,"translate"),p.qZA(),p.TgZ(3,"div"),p.YNc(4,Ee,1,0,"mat-spinner",1),p.YNc(5,ye,13,9,"div",2),p.TgZ(6,"div",3),p.TgZ(7,"button",4),p.NdJ("click",function(){return e.onCancel()}),p._uU(8),p.ALo(9,"translate"),p.qZA(),p.TgZ(10,"button",5),p.NdJ("click",function(){return e.onConfirm()}),p._uU(11),p.ALo(12,"translate"),p.qZA(),p.qZA(),p.qZA()),2&t&&(p.xp6(1),p.Oqu(p.lcZ(2,9,"DIALOGS.REMOVE_HOST.TITLE")),p.xp6(2),p.Tol(e.theme),p.xp6(1),p.Q6J("ngIf",e.loading),p.xp6(1),p.Q6J("ngIf",!e.loading),p.xp6(3),p.hij(" ",p.lcZ(9,11,"DIALOGS.REMOVE_HOST.CANCEL"),""),p.xp6(2),p.Q6J("disabled",e.loading),p.xp6(1),p.hij(" ",p.lcZ(12,13,"DIALOGS.REMOVE_HOST.CONFIRM"),""))},directives:[g.uh,s.O5,g.H8,b.lW,A.$g,g.xY,se.BZ,se.w1,se.fO,se.Dz,se.as,se.nj,se.ge,se.ev,se.XQ,se.Gk],pipes:[E.X$],styles:[""]}),t})();var Le=i(58623),xe=i(82819);function Ne(t,e){if(1&t){const t=p.EpF();p.TgZ(0,"th",14),p.TgZ(1,"mat-checkbox",15),p.NdJ("change",function(e){p.CHM(t);const i=p.oxw();return e?i.masterToggle():null}),p.qZA(),p.qZA()}if(2&t){const t=p.oxw();p.xp6(1),p.Q6J("aria-label",t.checkboxLabel())("checked",t.selection.hasValue()&&t.isAllSelected())("indeterminate",t.selection.hasValue()&&!t.isAllSelected())}}function Re(t,e){if(1&t){const t=p.EpF();p.TgZ(0,"td",16),p.TgZ(1,"mat-checkbox",17),p.NdJ("change",function(e){const i=p.CHM(t).$implicit,s=p.oxw();return e?s.selection.toggle(i):null})("click",function(t){return t.stopPropagation()}),p.qZA(),p.qZA()}if(2&t){const t=e.$implicit,i=p.oxw();p.xp6(1),p.Q6J("aria-label",i.checkboxLabel(t))("checked",i.selection.isSelected(t))}}function De(t,e){1&t&&(p.TgZ(0,"th",18),p._uU(1),p.ALo(2,"translate"),p.qZA()),2&t&&(p.xp6(1),p.Oqu(p.lcZ(2,1,"SHARED.COMPONENTS.HOSTS_LIST.TABLE_HOST_ID")))}function we(t,e){if(1&t&&(p.TgZ(0,"td",19),p._uU(1),p.qZA()),2&t){const t=e.$implicit;p.xp6(1),p.Oqu(t.id)}}function ke(t,e){1&t&&(p.TgZ(0,"th",18),p._uU(1),p.ALo(2,"translate"),p.qZA()),2&t&&(p.xp6(1),p.Oqu(p.lcZ(2,1,"SHARED.COMPONENTS.HOSTS_LIST.TABLE_HOST_NAME")))}function Fe(t,e){if(1&t&&(p.TgZ(0,"td",20),p._uU(1),p.qZA()),2&t){const t=e.$implicit;p.xp6(1),p.Oqu(t.hostname)}}function Ye(t,e){1&t&&p._UZ(0,"tr",21)}const Ue=function(t,e){return["/facilities",t,"hosts",e]};function qe(t,e){if(1&t&&p._UZ(0,"tr",22),2&t){const t=e.$implicit,i=p.oxw();p.Q6J("perunWebAppsMiddleClickRouterLink",i.disableRouting?null:p.WLB(2,Ue,i.facilityId,t.id))("routerLink",i.disableRouting?null:p.WLB(5,Ue,i.facilityId,t.id))}}function Me(t,e){1&t&&(p.TgZ(0,"app-alert",23),p._uU(1),p.ALo(2,"translate"),p.qZA()),2&t&&(p.xp6(1),p.hij(" ",p.lcZ(2,1,"SHARED_LIB.UI.ALERTS.NO_FILTER_RESULTS_ALERT"),"\n"))}function Je(t,e){1&t&&(p.TgZ(0,"app-alert",23),p._uU(1),p.ALo(2,"translate"),p.qZA()),2&t&&(p.xp6(1),p.hij(" ",p.lcZ(2,1,"SHARED.COMPONENTS.HOSTS_LIST.NO_HOST_WARNING"),"\n"))}let Qe=(()=>{class t{constructor(t,e){this.authResolver=t,this.tableCheckbox=e,this.hosts=[],this.selection=new vt.Ov(!0,[]),this.disableRouting=!1,this.displayedColumns=["select","id","name"],this.pageSizeOptions=r.f7}set matSort(t){this.sort=t,this.setDataSource()}ngOnChanges(){this.authResolver.isPerunAdminOrObserver()||(this.displayedColumns=this.displayedColumns.filter(t=>"id"!==t)),this.dataSource=new se.by(this.hosts),this.setDataSource(),this.dataSource.filter=this.filterValue}getDataForColumn(t,e){switch(e){case"id":return t.id.toString();case"name":return t.hostname;default:return""}}exportData(t){(0,r.O6)((0,r.Xn)(this.dataSource.filteredData,this.displayedColumns,this.getDataForColumn,this),t)}setDataSource(){this.dataSource&&(this.dataSource.sort=this.sort,this.dataSource.filterPredicate=(t,e)=>(0,r.Sd)(t,e,this.displayedColumns,this.getDataForColumn,this),this.dataSource.sortData=(t,e)=>(0,r.pR)(t,e,this.getDataForColumn,this),this.dataSource.paginator=this.child.paginator)}isAllSelected(){return this.tableCheckbox.isAllSelected(this.selection.selected.length,this.filterValue,this.child.paginator.pageSize,this.child.paginator.hasNextPage(),this.dataSource)}masterToggle(){this.tableCheckbox.masterToggle(this.isAllSelected(),this.selection,this.filterValue,this.dataSource,this.sort,this.child.paginator.pageSize,this.child.paginator.pageIndex,!1)}checkboxLabel(t){return t?`${this.selection.isSelected(t)?"deselect":"select"} row ${t.id+1}`:(this.isAllSelected()?"select":"deselect")+" all"}ngAfterViewInit(){this.dataSource.paginator=this.child.paginator}}return t.\u0275fac=function(e){return new(e||t)(p.Y36(d.x4),p.Y36(d.UA))},t.\u0275cmp=p.Xpm({type:t,selectors:[["app-hosts-list"]],viewQuery:function(t,e){if(1&t&&(p.Gf(Le.YE,7),p.Gf(r.l9,7)),2&t){let t;p.iGM(t=p.CRH())&&(e.matSort=t.first),p.iGM(t=p.CRH())&&(e.child=t.first)}},inputs:{hosts:"hosts",selection:"selection",filterValue:"filterValue",tableId:"tableId",facilityId:"facilityId",disableRouting:"disableRouting",displayedColumns:"displayedColumns"},features:[p.TTD],decls:16,vars:9,consts:[[1,"card","mt-3",3,"hidden"],[3,"tableId","dataLength","pageSizeOptions","exportData"],["mat-table","","matSort","","matSortActive","id","matSortDirection","asc","matSortDisableClear","",1,"w-100",3,"dataSource"],["matColumnDef","select"],["mat-header-cell","","class","align-checkbox",4,"matHeaderCellDef"],["class","static-column-size align-checkbox","mat-cell","",4,"matCellDef"],["matColumnDef","id"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["class","static-column-size","mat-cell","",4,"matCellDef"],["matColumnDef","name"],["mat-cell","",4,"matCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["class","dark-hover-list-item","mat-row","",3,"perunWebAppsMiddleClickRouterLink","routerLink",4,"matRowDef","matRowDefColumns"],["alert_type","warn",4,"ngIf"],["mat-header-cell","",1,"align-checkbox"],["color","primary",3,"aria-label","checked","indeterminate","change"],["mat-cell","",1,"static-column-size","align-checkbox"],["color","primary",3,"aria-label","checked","change","click"],["mat-header-cell","","mat-sort-header",""],["mat-cell","",1,"static-column-size"],["mat-cell",""],["mat-header-row",""],["mat-row","",1,"dark-hover-list-item",3,"perunWebAppsMiddleClickRouterLink","routerLink"],["alert_type","warn"]],template:function(t,e){1&t&&(p.TgZ(0,"div",0),p.TgZ(1,"perun-web-apps-table-wrapper",1),p.NdJ("exportData",function(t){return e.exportData(t)}),p.TgZ(2,"table",2),p.ynx(3,3),p.YNc(4,Ne,2,3,"th",4),p.YNc(5,Re,2,2,"td",5),p.BQk(),p.ynx(6,6),p.YNc(7,De,3,3,"th",7),p.YNc(8,we,2,1,"td",8),p.BQk(),p.ynx(9,9),p.YNc(10,ke,3,3,"th",7),p.YNc(11,Fe,2,1,"td",10),p.BQk(),p.YNc(12,Ye,1,0,"tr",11),p.YNc(13,qe,1,8,"tr",12),p.qZA(),p.qZA(),p.qZA(),p.YNc(14,Me,3,3,"app-alert",13),p.YNc(15,Je,3,3,"app-alert",13)),2&t&&(p.Q6J("hidden",0===e.dataSource.filteredData.length||0===e.hosts.length),p.xp6(1),p.Q6J("tableId",e.tableId)("dataLength",e.dataSource.filteredData.length)("pageSizeOptions",e.pageSizeOptions),p.xp6(1),p.Q6J("dataSource",e.dataSource),p.xp6(10),p.Q6J("matHeaderRowDef",e.displayedColumns),p.xp6(1),p.Q6J("matRowDefColumns",e.displayedColumns),p.xp6(1),p.Q6J("ngIf",0===e.dataSource.filteredData.length&&0!==e.hosts.length),p.xp6(1),p.Q6J("ngIf",0===e.hosts.length))},directives:[xe.l,se.BZ,Le.YE,se.w1,se.fO,se.Dz,se.as,se.nj,s.O5,se.ge,nt.oG,se.ev,Le.nU,se.XQ,se.Gk,me.YH,a.rH,Vt.w],pipes:[E.X$],styles:[".disable-outline[_ngcontent-%COMP%]{outline:none!important}.cursor-pointer[_ngcontent-%COMP%]{cursor:pointer}"]}),t})();function Ve(t,e){if(1&t){const t=p.EpF();p.TgZ(0,"button",7),p.NdJ("click",function(){return p.CHM(t),p.oxw().addHost()}),p._uU(1),p.ALo(2,"translate"),p.qZA()}2&t&&(p.xp6(1),p.hij(" ",p.lcZ(2,1,"FACILITY_DETAIL.HOSTS.ADD")," "))}function He(t,e){if(1&t){const t=p.EpF();p.TgZ(0,"button",8),p.NdJ("click",function(){return p.CHM(t),p.oxw().removeHost()}),p._uU(1),p.ALo(2,"translate"),p.qZA()}if(2&t){const t=p.oxw();p.Q6J("disabled",0===t.selected.selected.length),p.xp6(1),p.hij(" ",p.lcZ(2,2,"FACILITY_DETAIL.HOSTS.REMOVE")," ")}}function Pe(t,e){1&t&&p._UZ(0,"mat-spinner",9)}function Ge(t,e){if(1&t&&p._UZ(0,"app-hosts-list",10),2&t){const t=p.oxw();p.Q6J("tableId",t.tableId)("filterValue",t.filterValue)("hosts",t.hosts)("selection",t.selected)("displayedColumns",t.displayedColumns)("disableRouting",!t.routeAuth||t.disableRouting)("facilityId",t.facility.id)}}let Be=(()=>{class t{constructor(t,e,i,s){this.dialog=t,this.facilitiesManager=e,this.authResolver=i,this.entityStorageService=s,this.disableRouting=!1,this.hosts=[],this.selected=new vt.Ov(!0,[]),this.filterValue="",this.tableId=Ct.eq,this.displayedColumns=["id","name"],this.hostEmitter=new p.vpe}ngOnInit(){this.loading=!0,this.facility=this.entityStorageService.getEntity(),this.setAuthRights(),this.facilitiesManager.getFacilityById(this.facility.id).subscribe(t=>{this.facility=t,this.refreshTable()})}refreshTable(){this.loading=!0,this.facilitiesManager.getHosts(this.facility.id).subscribe(t=>{this.hosts=t,this.hostEmitter.emit(this.hosts),this.selected.clear(),this.setAuthRights(),this.loading=!1})}setAuthRights(){this.addAuth=this.authResolver.isAuthorized("addHosts_Facility_List<String>_policy",[this.facility]),this.removeAuth=this.authResolver.isAuthorized("removeHosts_List<Host>_Facility_policy",[this.facility]),this.displayedColumns=this.removeAuth?["select","id","name"]:["id","name"],0!==this.hosts.length&&(this.routeAuth=this.authResolver.isAuthorized("getHostById_int_policy",[this.facility,this.hosts[0]]))}addHost(){const t=(0,r.kZ)();t.width="600px",t.data={facilityId:this.facility.id,facilityName:this.facility.name,theme:"facility-theme"},this.dialog.open(be,t).afterClosed().subscribe(t=>{t&&this.refreshTable()})}removeHost(){const t=(0,r.kZ)();t.width="600px",t.data={facilityId:this.facility.id,theme:"facility-theme",hosts:this.selected.selected},this.dialog.open(Oe,t).afterClosed().subscribe(t=>{t&&this.refreshTable()})}applyFilter(t){this.filterValue=t}}return t.\u0275fac=function(e){return new(e||t)(p.Y36(g.uw),p.Y36(c.IQ),p.Y36(d.x4),p.Y36(d.fb))},t.\u0275cmp=p.Xpm({type:t,selectors:[["app-facility-hosts"]],inputs:{disableRouting:"disableRouting"},outputs:{hostEmitter:"hostEmitter"},decls:10,vars:8,consts:[[1,"page-subtitle"],[3,"refresh"],["mat-flat-button","","color","accent","class","mr-2 action-button",3,"click",4,"ngIf"],["mat-flat-button","","color","warn","class","mr-2",3,"disabled","click",4,"ngIf"],[3,"placeholder","filter"],["class","ml-auto mr-auto",4,"ngIf"],[3,"tableId","filterValue","hosts","selection","displayedColumns","disableRouting","facilityId",4,"ngIf"],["mat-flat-button","","color","accent",1,"mr-2","action-button",3,"click"],["mat-flat-button","","color","warn",1,"mr-2",3,"disabled","click"],[1,"ml-auto","mr-auto"],[3,"tableId","filterValue","hosts","selection","displayedColumns","disableRouting","facilityId"]],template:function(t,e){1&t&&(p.TgZ(0,"div"),p.TgZ(1,"h1",0),p._uU(2),p.ALo(3,"translate"),p.qZA(),p.TgZ(4,"perun-web-apps-refresh-button",1),p.NdJ("refresh",function(){return e.refreshTable()}),p.qZA(),p.YNc(5,Ve,3,3,"button",2),p.YNc(6,He,3,4,"button",3),p.TgZ(7,"perun-web-apps-immediate-filter",4),p.NdJ("filter",function(t){return e.applyFilter(t)}),p.qZA(),p.YNc(8,Pe,1,0,"mat-spinner",5),p.YNc(9,Ge,1,7,"app-hosts-list",6),p.qZA()),2&t&&(p.xp6(2),p.Oqu(p.lcZ(3,6,"FACILITY_DETAIL.HOSTS.TITLE")),p.xp6(3),p.Q6J("ngIf",e.addAuth),p.xp6(1),p.Q6J("ngIf",e.removeAuth),p.xp6(1),p.Q6J("placeholder","FACILITY_DETAIL.HOSTS.FILTER"),p.xp6(1),p.Q6J("ngIf",e.loading),p.xp6(1),p.Q6J("ngIf",!e.loading))},directives:[Jt.t,s.O5,Qt.L,b.lW,A.$g,Qe],pipes:[E.X$],styles:[""]}),t})();function $e(t,e){if(1&t){const t=p.EpF();p.TgZ(0,"th",15),p.TgZ(1,"mat-checkbox",16),p.NdJ("change",function(e){p.CHM(t);const i=p.oxw();return e?i.masterToggle():null}),p.qZA(),p.qZA()}if(2&t){const t=p.oxw();p.xp6(1),p.Q6J("aria-label",t.checkboxLabel())("checked",t.selection.hasValue()&&t.isAllSelected())("indeterminate",t.selection.hasValue()&&!t.isAllSelected())}}function je(t,e){if(1&t){const t=p.EpF();p.TgZ(0,"td",17),p.TgZ(1,"mat-checkbox",18),p.NdJ("change",function(e){const i=p.CHM(t).$implicit,s=p.oxw();return e?s.selection.toggle(i):null})("click",function(t){return t.stopPropagation()}),p.qZA(),p.qZA()}if(2&t){const t=e.$implicit,i=p.oxw();p.xp6(1),p.Q6J("aria-label",i.checkboxLabel(t))("checked",i.selection.isSelected(t))}}function ze(t,e){1&t&&(p.TgZ(0,"th",19),p._uU(1),p.ALo(2,"translate"),p.qZA()),2&t&&(p.xp6(1),p.Oqu(p.lcZ(2,1,"SHARED.COMPONENTS.BLACKLIST_LIST.USER_ID")))}function Xe(t,e){if(1&t&&(p.TgZ(0,"td",20),p._uU(1),p.qZA()),2&t){const t=e.$implicit;p.xp6(1),p.Oqu(t[1].id)}}function We(t,e){1&t&&(p.TgZ(0,"th",19),p._uU(1),p.ALo(2,"translate"),p.qZA()),2&t&&(p.xp6(1),p.Oqu(p.lcZ(2,1,"SHARED.COMPONENTS.BLACKLIST_LIST.NAME")))}function Ke(t,e){if(1&t&&(p.TgZ(0,"td",21),p._uU(1),p.ALo(2,"userFullName"),p.qZA()),2&t){const t=e.$implicit;p.xp6(1),p.Oqu(p.lcZ(2,1,t[1]))}}function ti(t,e){1&t&&(p.TgZ(0,"th",19),p._uU(1),p.ALo(2,"translate"),p.qZA()),2&t&&(p.xp6(1),p.Oqu(p.lcZ(2,1,"SHARED.COMPONENTS.BLACKLIST_LIST.REASON")))}function ei(t,e){if(1&t&&(p.TgZ(0,"td",21),p._uU(1),p.qZA()),2&t){const t=e.$implicit;p.xp6(1),p.Oqu(t[0].description)}}function ii(t,e){1&t&&p._UZ(0,"tr",22)}function si(t,e){1&t&&p._UZ(0,"tr",23)}function ai(t,e){1&t&&(p.TgZ(0,"app-alert",24),p._uU(1),p.ALo(2,"translate"),p.qZA()),2&t&&(p.xp6(1),p.hij(" ",p.lcZ(2,1,"SHARED_LIB.UI.ALERTS.NO_FILTER_RESULTS_ALERT"),"\n"))}function ni(t,e){1&t&&(p.TgZ(0,"app-alert",24),p._uU(1),p.ALo(2,"translate"),p.qZA()),2&t&&(p.xp6(1),p.hij(" ",p.lcZ(2,1,"SHARED.COMPONENTS.BLACKLIST_LIST.NO_BANS_WARNING"),"\n"))}let li=(()=>{class t{constructor(t,e){this.authResolver=t,this.tableCheckbox=e,this.bansOnFacilitiesWithUsers=[],this.selection=new vt.Ov(!0,[]),this.displayedColumns=["select","userId","name","reason"],this.pageSizeOptions=r.f7}set matSort(t){this.sort=t,this.setDataSource()}ngOnChanges(){this.authResolver.isPerunAdminOrObserver()||(this.displayedColumns=this.displayedColumns.filter(t=>"userId"!==t)),this.dataSource=new se.by(this.bansOnFacilitiesWithUsers),this.setDataSource(),this.dataSource.filter=this.filterValue}getDataForColumn(t,e){switch(e){case"userId":return t[1].id.toString();case"reason":return t[0].description;case"name":return(0,r.hu)(t[1]);default:return""}}exportData(t){(0,r.O6)((0,r.Xn)(this.dataSource.filteredData,this.displayedColumns,this.getDataForColumn,this),t)}setDataSource(){this.dataSource&&(this.dataSource.filterPredicate=(t,e)=>(0,r.Sd)(t,e,this.displayedColumns,this.getDataForColumn,this),this.dataSource.sortData=(t,e)=>(0,r.pR)(t,e,this.getDataForColumn,this),this.dataSource.sort=this.sort,this.dataSource.paginator=this.child.paginator)}isAllSelected(){return this.tableCheckbox.isAllSelected(this.selection.selected.length,this.filterValue,this.child.paginator.pageSize,this.child.paginator.hasNextPage(),this.dataSource)}masterToggle(){this.tableCheckbox.masterToggle(this.isAllSelected(),this.selection,this.filterValue,this.dataSource,this.sort,this.child.paginator.pageSize,this.child.paginator.pageIndex,!1)}checkboxLabel(t){return t?`${this.selection.isSelected(t)?"deselect":"select"} row ${t[0].userId+1}`:(this.isAllSelected()?"select":"deselect")+" all"}ngAfterViewInit(){this.dataSource.paginator=this.child.paginator}}return t.\u0275fac=function(e){return new(e||t)(p.Y36(d.x4),p.Y36(d.UA))},t.\u0275cmp=p.Xpm({type:t,selectors:[["app-perun-web-apps-blacklist-list"]],viewQuery:function(t,e){if(1&t&&(p.Gf(Le.YE,7),p.Gf(r.l9,7)),2&t){let t;p.iGM(t=p.CRH())&&(e.matSort=t.first),p.iGM(t=p.CRH())&&(e.child=t.first)}},inputs:{bansOnFacilitiesWithUsers:"bansOnFacilitiesWithUsers",selection:"selection",filterValue:"filterValue",tableId:"tableId"},features:[p.TTD],decls:19,vars:9,consts:[[1,"card","mt-3",3,"hidden"],[3,"tableId","dataLength","pageSizeOptions","exportData"],["mat-table","","matSort","","matSortActive","id","matSortDirection","asc","matSortDisableClear","",1,"w-100",3,"dataSource"],["matColumnDef","select"],["mat-header-cell","","class","align-checkbox",4,"matHeaderCellDef"],["class","static-column-size align-checkbox","mat-cell","",4,"matCellDef"],["matColumnDef","userId"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["class","static-column-size","mat-cell","",4,"matCellDef"],["matColumnDef","name"],["mat-cell","",4,"matCellDef"],["matColumnDef","reason"],["mat-header-row","",4,"matHeaderRowDef"],["class","dark-hover-list-item","mat-row","",4,"matRowDef","matRowDefColumns"],["alert_type","warn",4,"ngIf"],["mat-header-cell","",1,"align-checkbox"],["color","primary",3,"aria-label","checked","indeterminate","change"],["mat-cell","",1,"static-column-size","align-checkbox"],["color","primary",3,"aria-label","checked","change","click"],["mat-header-cell","","mat-sort-header",""],["mat-cell","",1,"static-column-size"],["mat-cell",""],["mat-header-row",""],["mat-row","",1,"dark-hover-list-item"],["alert_type","warn"]],template:function(t,e){1&t&&(p.TgZ(0,"div",0),p.TgZ(1,"perun-web-apps-table-wrapper",1),p.NdJ("exportData",function(t){return e.exportData(t)}),p.TgZ(2,"table",2),p.ynx(3,3),p.YNc(4,$e,2,3,"th",4),p.YNc(5,je,2,2,"td",5),p.BQk(),p.ynx(6,6),p.YNc(7,ze,3,3,"th",7),p.YNc(8,Xe,2,1,"td",8),p.BQk(),p.ynx(9,9),p.YNc(10,We,3,3,"th",7),p.YNc(11,Ke,3,3,"td",10),p.BQk(),p.ynx(12,11),p.YNc(13,ti,3,3,"th",7),p.YNc(14,ei,2,1,"td",10),p.BQk(),p.YNc(15,ii,1,0,"tr",12),p.YNc(16,si,1,0,"tr",13),p.qZA(),p.qZA(),p.qZA(),p.YNc(17,ai,3,3,"app-alert",14),p.YNc(18,ni,3,3,"app-alert",14)),2&t&&(p.Q6J("hidden",0===e.dataSource.filteredData.length||0===e.bansOnFacilitiesWithUsers.length),p.xp6(1),p.Q6J("tableId",e.tableId)("dataLength",e.dataSource.filteredData.length)("pageSizeOptions",e.pageSizeOptions),p.xp6(1),p.Q6J("dataSource",e.dataSource),p.xp6(13),p.Q6J("matHeaderRowDef",e.displayedColumns),p.xp6(1),p.Q6J("matRowDefColumns",e.displayedColumns),p.xp6(1),p.Q6J("ngIf",0===e.dataSource.filteredData.length&&0!==e.bansOnFacilitiesWithUsers.length),p.xp6(1),p.Q6J("ngIf",0===e.bansOnFacilitiesWithUsers.length))},directives:[xe.l,se.BZ,Le.YE,se.w1,se.fO,se.Dz,se.as,se.nj,s.O5,se.ge,nt.oG,se.ev,Le.nU,se.XQ,se.Gk,Vt.w],pipes:[E.X$,dt.d],styles:[""]}),t})();function oi(t,e){1&t&&p._UZ(0,"mat-spinner",5)}function ci(t,e){if(1&t&&p._UZ(0,"app-perun-web-apps-blacklist-list",6),2&t){const t=p.oxw();p.Q6J("tableId",t.tableId)("filterValue",t.filterValue)("bansOnFacilitiesWithUsers",t.bansOnFacilitiesWithUsers)("selection",t.selected)}}let ri=(()=>{class t{constructor(t,e,i){this.facilitiesManager=t,this.usersManager=e,this.entityStorageService=i,this.bansOnFacilitiesWithUsers=[],this.selected=new vt.Ov(!0,[]),this.filterValue="",this.tableId=Ct.NG}ngOnInit(){this.loading=!0,this.facility=this.entityStorageService.getEntity(),this.refreshTable()}refreshTable(){this.loading=!0,this.facilitiesManager.getBansForFacility(this.facility.id).subscribe(t=>{const e=t;for(const i of e){let t;this.usersManager.getUserById(i.userId).subscribe(e=>{t=e}),this.bansOnFacilitiesWithUsers.push([i,t])}this.selected.clear(),this.loading=!1})}applyFilter(t){this.filterValue=t}}return t.\u0275fac=function(e){return new(e||t)(p.Y36(c.IQ),p.Y36(c.Fv),p.Y36(d.fb))},t.\u0275cmp=p.Xpm({type:t,selectors:[["app-perun-web-apps-facility-settings-blacklist"]],decls:9,vars:8,consts:[[1,"page-subtitle"],[3,"refresh"],[3,"placeholder","filter"],["class","ml-auto mr-auto",4,"ngIf"],[3,"tableId","filterValue","bansOnFacilitiesWithUsers","selection",4,"ngIf"],[1,"ml-auto","mr-auto"],[3,"tableId","filterValue","bansOnFacilitiesWithUsers","selection"]],template:function(t,e){1&t&&(p.TgZ(0,"div"),p.TgZ(1,"h1",0),p._uU(2),p.ALo(3,"translate"),p.qZA(),p.TgZ(4,"perun-web-apps-refresh-button",1),p.NdJ("refresh",function(){return e.refreshTable()}),p.qZA(),p.TgZ(5,"perun-web-apps-immediate-filter",2),p.NdJ("filter",function(t){return e.applyFilter(t)}),p.ALo(6,"translate"),p.qZA(),p.YNc(7,oi,1,0,"mat-spinner",3),p.YNc(8,ci,1,4,"app-perun-web-apps-blacklist-list",4),p.qZA()),2&t&&(p.xp6(2),p.Oqu(p.lcZ(3,4,"FACILITY_DETAIL.SETTINGS.BLACKLIST.TITLE")),p.xp6(3),p.Q6J("placeholder",p.lcZ(6,6,"FACILITY_DETAIL.SETTINGS.BLACKLIST.FILTER")),p.xp6(2),p.Q6J("ngIf",e.loading),p.xp6(1),p.Q6J("ngIf",!e.loading))},directives:[Jt.t,Qt.L,s.O5,A.$g,li],pipes:[E.X$],styles:[""]}),t})();var di=i(41939),ui=i(13572),hi=i(40695),pi=i(41186);const gi=["list"];function fi(t,e){1&t&&p._UZ(0,"mat-spinner",7)}function mi(t,e){if(1&t&&p._UZ(0,"perun-web-apps-attributes-list",8,9),2&t){const t=p.oxw();p.Q6J("tableId",t.tableId)("attributes",t.attributes)("selection",t.selected)}}let Ai=(()=>{class t{constructor(t,e,i,s){this.dialog=t,this.attributesManager=e,this.facilityManager=i,this.route=s,this.attributes=[],this.selected=new vt.Ov(!0,[]),this.host={beanName:"",id:0},this.tableId=Ct.rF}ngOnInit(){this.route.params.subscribe(t=>{this.hostId=t.hostId,this.facilityManager.getHostById(this.hostId).subscribe(t=>{this.host=t}),this.refreshTable()})}refreshTable(){this.loading=!0,this.attributesManager.getHostAttributes(this.hostId).subscribe(t=>{this.attributes=(0,r.MX)(t),this.selected.clear(),this.loading=!1})}onSave(){this.list.updateMapAttributes();const t=(0,r.kZ)();t.width="450px",t.data={entityId:this.hostId,entity:"host",attributes:this.selected.selected},this.dialog.open(u.wA,t).afterClosed().subscribe(t=>{t&&this.refreshTable()})}addAttribute(){const t=(0,r.kZ)();t.width="1050px",t.data={entityId:this.hostId,entity:"host",notEmptyAttributes:this.attributes,style:"facility-theme"},this.dialog.open(hi.n,t).afterClosed().subscribe(t=>{"saved"===t&&this.refreshTable()})}removeAttribute(){const t=(0,r.kZ)();t.width="450px",t.data={entityId:this.hostId,entity:"host",attributes:this.selected.selected,theme:"facility-theme"},this.dialog.open(ui.k,t).afterClosed().subscribe(t=>{t&&this.refreshTable()})}}return t.\u0275fac=function(e){return new(e||t)(p.Y36(g.uw),p.Y36(c.H8),p.Y36(c.IQ),p.Y36(a.gz))},t.\u0275cmp=p.Xpm({type:t,selectors:[["app-facility-hosts-detail"]],viewQuery:function(t,e){if(1&t&&p.Gf(gi,5),2&t){let t;p.iGM(t=p.CRH())&&(e.list=t.first)}},decls:16,vars:17,consts:[[1,"page-subtitle"],[3,"refresh"],["mat-flat-button","","color","accent",1,"mr-2",3,"click"],["mat-flat-button","","color","accent",1,"mr-2",3,"disabled","click"],["mat-flat-button","","color","warn",3,"disabled","click"],["class","ml-auto mr-auto",4,"ngIf"],[3,"tableId","attributes","selection",4,"ngIf"],[1,"ml-auto","mr-auto"],[3,"tableId","attributes","selection"],["list",""]],template:function(t,e){1&t&&(p.TgZ(0,"div"),p.TgZ(1,"h1",0),p._uU(2),p.ALo(3,"translate"),p.qZA(),p.TgZ(4,"perun-web-apps-refresh-button",1),p.NdJ("refresh",function(){return e.refreshTable()}),p.qZA(),p.TgZ(5,"button",2),p.NdJ("click",function(){return e.addAttribute()}),p._uU(6),p.ALo(7,"translate"),p.qZA(),p.TgZ(8,"button",3),p.NdJ("click",function(){return e.onSave()}),p._uU(9),p.ALo(10,"translate"),p.qZA(),p.TgZ(11,"button",4),p.NdJ("click",function(){return e.removeAttribute()}),p._uU(12),p.ALo(13,"translate"),p.qZA(),p.YNc(14,fi,1,0,"mat-spinner",5),p.YNc(15,mi,2,3,"perun-web-apps-attributes-list",6),p.qZA()),2&t&&(p.xp6(2),p.AsE(" ",p.lcZ(3,9,"FACILITY_DETAIL.HOSTS.HOSTS_DETAIL.TITLE")," ",e.host.hostname,""),p.xp6(4),p.hij(" ",p.lcZ(7,11,"FACILITY_DETAIL.HOSTS.HOSTS_DETAIL.ADD")," "),p.xp6(2),p.Q6J("disabled",0===e.selected.selected.length),p.xp6(1),p.hij(" ",p.lcZ(10,13,"FACILITY_DETAIL.HOSTS.HOSTS_DETAIL.SAVE")," "),p.xp6(2),p.Q6J("disabled",0===e.selected.selected.length),p.xp6(1),p.hij(" ",p.lcZ(13,15,"FACILITY_DETAIL.HOSTS.HOSTS_DETAIL.REMOVE")," "),p.xp6(2),p.Q6J("ngIf",e.loading),p.xp6(1),p.Q6J("ngIf",!e.loading))},directives:[Jt.t,b.lW,s.O5,A.$g,pi.p],pipes:[E.X$],styles:[""]}),t})();function Ii(t,e){if(1&t){const t=p.EpF();p.TgZ(0,"th",15),p.TgZ(1,"mat-checkbox",16),p.NdJ("change",function(e){p.CHM(t);const i=p.oxw();return e?i.masterToggle():null}),p.qZA(),p.qZA()}if(2&t){const t=p.oxw();p.xp6(1),p.Q6J("aria-label",t.checkboxLabel())("checked",t.selection.hasValue()&&t.isAllSelected())("indeterminate",t.selection.hasValue()&&!t.isAllSelected())}}function Si(t,e){if(1&t){const t=p.EpF();p.TgZ(0,"td",17),p.TgZ(1,"mat-checkbox",18),p.NdJ("change",function(e){const i=p.CHM(t).$implicit,s=p.oxw();return e?s.selection.toggle(i):null})("click",function(t){return t.stopPropagation()}),p.qZA(),p.qZA()}if(2&t){const t=e.$implicit,i=p.oxw();p.xp6(1),p.Q6J("aria-label",i.checkboxLabel(t))("checked",i.selection.isSelected(t))}}function Ti(t,e){1&t&&(p.TgZ(0,"th",19),p._uU(1),p.ALo(2,"translate"),p.qZA()),2&t&&(p.xp6(1),p.Oqu(p.lcZ(2,1,"SHARED.COMPONENTS.SECURITY_TEAMS_LIST.ID")))}function bi(t,e){if(1&t&&(p.TgZ(0,"td",20),p._uU(1),p.qZA()),2&t){const t=e.$implicit;p.xp6(1),p.Oqu(t.id)}}function Ei(t,e){1&t&&(p.TgZ(0,"th",19),p._uU(1),p.ALo(2,"translate"),p.qZA()),2&t&&(p.xp6(1),p.Oqu(p.lcZ(2,1,"SHARED.COMPONENTS.SECURITY_TEAMS_LIST.NAME")))}function Zi(t,e){if(1&t&&(p.TgZ(0,"td",21),p._uU(1),p.qZA()),2&t){const t=e.$implicit;p.xp6(1),p.Oqu(t.name)}}function Ci(t,e){1&t&&(p.TgZ(0,"th",19),p._uU(1),p.ALo(2,"translate"),p.qZA()),2&t&&(p.xp6(1),p.Oqu(p.lcZ(2,1,"SHARED.COMPONENTS.SECURITY_TEAMS_LIST.DESCRIPTION")))}function vi(t,e){if(1&t&&(p.TgZ(0,"td",21),p._uU(1),p.qZA()),2&t){const t=e.$implicit;p.xp6(1),p.Oqu(t.description)}}function _i(t,e){1&t&&p._UZ(0,"tr",22)}function yi(t,e){1&t&&p._UZ(0,"tr",23)}function Oi(t,e){1&t&&(p.TgZ(0,"app-alert",24),p._uU(1),p.ALo(2,"translate"),p.qZA()),2&t&&(p.xp6(1),p.hij(" ",p.lcZ(2,1,"SHARED_LIB.UI.ALERTS.NO_FILTER_RESULTS_ALERT"),"\n"))}function Li(t,e){1&t&&(p.TgZ(0,"app-alert",24),p._uU(1),p.ALo(2,"translate"),p.qZA()),2&t&&(p.xp6(1),p.hij(" ",p.lcZ(2,1,"SHARED.COMPONENTS.SECURITY_TEAMS_LIST.NO_SECURITY_TEAMS_WARNING"),"\n"))}let xi=(()=>{class t{constructor(t,e){this.authResolver=t,this.tableCheckbox=e,this.securityTeams=[],this.selection=new vt.Ov(!0,[]),this.displayedColumns=["select","id","name","description"],this.pageSizeOptions=r.f7}set matSort(t){this.sort=t,this.setDataSource()}ngOnChanges(){this.authResolver.isPerunAdminOrObserver()||(this.displayedColumns=this.displayedColumns.filter(t=>"id"!==t)),this.dataSource=new se.by(this.securityTeams),this.setDataSource(),this.dataSource.filter=this.filterValue}getDataForColumn(t,e){switch(e){case"id":return t.id.toString();case"name":return t.name;case"description":return t.description;default:return""}}exportData(t){(0,r.O6)((0,r.Xn)(this.dataSource.filteredData,this.displayedColumns,this.getDataForColumn,this),t)}setDataSource(){this.dataSource&&(this.dataSource.filterPredicate=(t,e)=>(0,r.Sd)(t,e,this.displayedColumns,this.getDataForColumn,this),this.dataSource.sortData=(t,e)=>(0,r.pR)(t,e,this.getDataForColumn,this),this.dataSource.sort=this.sort,this.dataSource.paginator=this.child.paginator)}isAllSelected(){return this.tableCheckbox.isAllSelected(this.selection.selected.length,this.filterValue,this.child.paginator.pageSize,this.child.paginator.hasNextPage(),this.dataSource)}masterToggle(){this.tableCheckbox.masterToggle(this.isAllSelected(),this.selection,this.filterValue,this.dataSource,this.sort,this.child.paginator.pageSize,this.child.paginator.pageIndex,!1)}checkboxLabel(t){return t?`${this.selection.isSelected(t)?"deselect":"select"} row ${t.id+1}`:(this.isAllSelected()?"select":"deselect")+" all"}ngAfterViewInit(){this.dataSource.paginator=this.child.paginator}}return t.\u0275fac=function(e){return new(e||t)(p.Y36(d.x4),p.Y36(d.UA))},t.\u0275cmp=p.Xpm({type:t,selectors:[["app-security-teams-list"]],viewQuery:function(t,e){if(1&t&&(p.Gf(Le.YE,7),p.Gf(r.l9,7)),2&t){let t;p.iGM(t=p.CRH())&&(e.matSort=t.first),p.iGM(t=p.CRH())&&(e.child=t.first)}},inputs:{securityTeams:"securityTeams",selection:"selection",filterValue:"filterValue",tableId:"tableId",displayedColumns:"displayedColumns"},features:[p.TTD],decls:19,vars:9,consts:[[1,"card","mt-3",3,"hidden"],[3,"tableId","dataLength","pageSizeOptions","exportData"],["mat-table","","matSort","","matSortActive","id","matSortDirection","asc","matSortDisableClear","",1,"w-100",3,"dataSource"],["matColumnDef","select"],["mat-header-cell","","class","align-checkbox",4,"matHeaderCellDef"],["class","static-column-size align-checkbox","mat-cell","",4,"matCellDef"],["matColumnDef","id"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["class","static-column-size","mat-cell","",4,"matCellDef"],["matColumnDef","name"],["mat-cell","",4,"matCellDef"],["matColumnDef","description"],["mat-header-row","",4,"matHeaderRowDef"],["class","dark-hover-list-item","mat-row","",4,"matRowDef","matRowDefColumns"],["alert_type","warn",4,"ngIf"],["mat-header-cell","",1,"align-checkbox"],["color","primary",3,"aria-label","checked","indeterminate","change"],["mat-cell","",1,"static-column-size","align-checkbox"],["color","primary",3,"aria-label","checked","change","click"],["mat-header-cell","","mat-sort-header",""],["mat-cell","",1,"static-column-size"],["mat-cell",""],["mat-header-row",""],["mat-row","",1,"dark-hover-list-item"],["alert_type","warn"]],template:function(t,e){1&t&&(p.TgZ(0,"div",0),p.TgZ(1,"perun-web-apps-table-wrapper",1),p.NdJ("exportData",function(t){return e.exportData(t)}),p.TgZ(2,"table",2),p.ynx(3,3),p.YNc(4,Ii,2,3,"th",4),p.YNc(5,Si,2,2,"td",5),p.BQk(),p.ynx(6,6),p.YNc(7,Ti,3,3,"th",7),p.YNc(8,bi,2,1,"td",8),p.BQk(),p.ynx(9,9),p.YNc(10,Ei,3,3,"th",7),p.YNc(11,Zi,2,1,"td",10),p.BQk(),p.ynx(12,11),p.YNc(13,Ci,3,3,"th",7),p.YNc(14,vi,2,1,"td",10),p.BQk(),p.YNc(15,_i,1,0,"tr",12),p.YNc(16,yi,1,0,"tr",13),p.qZA(),p.qZA(),p.qZA(),p.YNc(17,Oi,3,3,"app-alert",14),p.YNc(18,Li,3,3,"app-alert",14)),2&t&&(p.Q6J("hidden",0===e.dataSource.filteredData.length||0===e.securityTeams.length),p.xp6(1),p.Q6J("tableId",e.tableId)("dataLength",e.dataSource.filteredData.length)("pageSizeOptions",e.pageSizeOptions),p.xp6(1),p.Q6J("dataSource",e.dataSource),p.xp6(13),p.Q6J("matHeaderRowDef",e.displayedColumns),p.xp6(1),p.Q6J("matRowDefColumns",e.displayedColumns),p.xp6(1),p.Q6J("ngIf",0===e.dataSource.filteredData.length&&0!==e.securityTeams.length),p.xp6(1),p.Q6J("ngIf",0===e.securityTeams.length))},directives:[xe.l,se.BZ,Le.YE,se.w1,se.fO,se.Dz,se.as,se.nj,s.O5,se.ge,nt.oG,se.ev,Le.nU,se.XQ,se.Gk,Vt.w],pipes:[E.X$],styles:[""]}),t})();function Ni(t,e){1&t&&p._UZ(0,"mat-spinner",5)}function Ri(t,e){if(1&t&&p._UZ(0,"app-security-teams-list",6),2&t){const t=p.oxw();p.Q6J("tableId",t.tableId)("filterValue",t.filterValue)("securityTeams",t.securityTeams)("displayedColumns",t.displayedColumns)("selection",t.selected)}}let Di=(()=>{class t{constructor(t,e,i,s){this.dialog=t,this.facilitiesManager=e,this.authResolver=i,this.entityStorageService=s,this.securityTeams=[],this.selected=new vt.Ov(!0,[]),this.filterValue="",this.tableId=Ct.O9,this.displayedColumns=[]}ngOnInit(){this.facility=this.entityStorageService.getEntity(),this.refreshTable()}refreshTable(){this.loading=!0,this.facilitiesManager.getAssignedSecurityTeams(this.facility.id).subscribe(t=>{this.securityTeams=t,this.selected.clear(),this.setAuthRights(),this.loading=!1})}setAuthRights(){this.addAuth=this.authResolver.isAuthorized("assignSecurityTeam_Facility_SecurityTeam_policy",[this.facility]),this.removeAuth=this.authResolver.isAuthorized("removeSecurityTeam_Facility_SecurityTeam_policy",[this.facility]),this.displayedColumns=this.removeAuth?["select","id","name","description"]:["id","name","description"]}applyFilter(t){this.filterValue=t}addSecurityTeam(){}removeSecurityTeam(){}}return t.\u0275fac=function(e){return new(e||t)(p.Y36(g.uw),p.Y36(c.IQ),p.Y36(d.x4),p.Y36(d.fb))},t.\u0275cmp=p.Xpm({type:t,selectors:[["app-facility-security-teams"]],decls:8,vars:6,consts:[[1,"page-subtitle"],[3,"refresh"],[3,"placeholder","filter"],["class","ml-auto mr-auto",4,"ngIf"],[3,"tableId","filterValue","securityTeams","displayedColumns","selection",4,"ngIf"],[1,"ml-auto","mr-auto"],[3,"tableId","filterValue","securityTeams","displayedColumns","selection"]],template:function(t,e){1&t&&(p.TgZ(0,"div"),p.TgZ(1,"h1",0),p._uU(2),p.ALo(3,"translate"),p.qZA(),p.TgZ(4,"perun-web-apps-refresh-button",1),p.NdJ("refresh",function(){return e.refreshTable()}),p.qZA(),p.TgZ(5,"perun-web-apps-immediate-filter",2),p.NdJ("filter",function(t){return e.applyFilter(t)}),p.qZA(),p.YNc(6,Ni,1,0,"mat-spinner",3),p.YNc(7,Ri,1,5,"app-security-teams-list",4),p.qZA()),2&t&&(p.xp6(2),p.Oqu(p.lcZ(3,4,"FACILITY_DETAIL.SECURITY_TEAMS.TITLE")),p.xp6(3),p.Q6J("placeholder","FACILITY_DETAIL.SECURITY_TEAMS.FILTER"),p.xp6(1),p.Q6J("ngIf",e.loading),p.xp6(1),p.Q6J("ngIf",!e.loading))},directives:[Jt.t,Qt.L,s.O5,A.$g,xi],pipes:[E.X$],styles:[""]}),t})();var wi=i(64359),ki=i(75374);function Fi(t,e){1&t&&p._UZ(0,"mat-spinner",6)}function Yi(t,e){1&t&&(p.TgZ(0,"th",17),p._uU(1),p.ALo(2,"translate"),p.qZA()),2&t&&(p.xp6(1),p.Oqu(p.lcZ(2,1,"DIALOGS.DELETE_TASK_RESULT.RESULT_ID")))}function Ui(t,e){if(1&t&&(p.TgZ(0,"td",18),p._uU(1),p.qZA()),2&t){const t=e.$implicit;p.xp6(1),p.hij(" ",t.id," ")}}function qi(t,e){1&t&&(p.TgZ(0,"th",17),p._uU(1),p.ALo(2,"translate"),p.qZA()),2&t&&(p.xp6(1),p.Oqu(p.lcZ(2,1,"DIALOGS.DELETE_TASK_RESULT.DESTINATION")))}function Mi(t,e){if(1&t&&(p.TgZ(0,"td",18),p._uU(1),p.qZA()),2&t){const t=e.$implicit;p.xp6(1),p.hij(" ",t.destination.destination," ")}}function Ji(t,e){1&t&&(p.TgZ(0,"th",17),p._uU(1),p.ALo(2,"translate"),p.qZA()),2&t&&(p.xp6(1),p.Oqu(p.lcZ(2,1,"DIALOGS.DELETE_TASK_RESULT.TIME")))}function Qi(t,e){if(1&t&&(p.TgZ(0,"td",18),p._uU(1),p.ALo(2,"date"),p.qZA()),2&t){const t=e.$implicit;p.xp6(1),p.hij(" ",p.xi3(2,1,t.timestamp,"d.M.y H:mm:ss")," ")}}function Vi(t,e){1&t&&p._UZ(0,"tr",19)}function Hi(t,e){1&t&&p._UZ(0,"tr",20)}function Pi(t,e){if(1&t&&(p.TgZ(0,"div",7),p.TgZ(1,"p"),p._uU(2),p.ALo(3,"translate"),p.qZA(),p.TgZ(4,"div",8),p._uU(5),p.ALo(6,"translate"),p.qZA(),p.TgZ(7,"table",9),p.ynx(8,10),p.YNc(9,Yi,3,3,"th",11),p.YNc(10,Ui,2,1,"td",12),p.BQk(),p.ynx(11,13),p.YNc(12,qi,3,3,"th",11),p.YNc(13,Mi,2,1,"td",12),p.BQk(),p.ynx(14,14),p.YNc(15,Ji,3,3,"th",11),p.YNc(16,Qi,3,4,"td",12),p.BQk(),p.YNc(17,Vi,1,0,"tr",15),p.YNc(18,Hi,1,0,"tr",16),p.qZA(),p.qZA()),2&t){const t=p.oxw();p.xp6(2),p.Oqu(p.lcZ(3,5,"DIALOGS.DELETE_TASK_RESULT.DESCRIPTION")),p.xp6(3),p.hij(" ",p.lcZ(6,7,"DIALOGS.DELETE_TASK_RESULT.ASK")," "),p.xp6(2),p.Q6J("dataSource",t.dataSource),p.xp6(10),p.Q6J("matHeaderRowDef",t.displayedColumns),p.xp6(1),p.Q6J("matRowDefColumns",t.displayedColumns)}}let Gi=(()=>{class t{constructor(t,e,i,s,a){this.dialogRef=t,this.data=e,this.taskManager=i,this.notificator=s,this.translate=a,this.loading=!1,this.dataSource=new se.by(this.data.taskResults),this.displayedColumns=["id","destination","time"]}ngOnInit(){this.theme=this.data.theme,this.taskResults=this.data.taskResults}deleteResults(){if(this.loading=!0,0===this.taskResults.length)return this.dialogRef.close(!0),this.loading=!1,void this.notificator.showSuccess(this.translate.instant("DIALOGS.DELETE_TASK_RESULT.SUCCESS"));this.taskManager.deleteTaskResultById({taskResultId:this.taskResults.pop().id}).subscribe(()=>{this.deleteResults()},()=>this.loading=!1)}onDelete(){this.deleteResults()}onCancel(){this.dialogRef.close(!1)}}return t.\u0275fac=function(e){return new(e||t)(p.Y36(g.so),p.Y36(g.WI),p.Y36(c.Ob),p.Y36(d.V6),p.Y36(E.sK))},t.\u0275cmp=p.Xpm({type:t,selectors:[["app-delete-task-result-dialog"]],decls:13,vars:15,consts:[["mat-dialog-title",""],["class","ml-auto mr-auto",4,"ngIf"],["mat-dialog-content","",4,"ngIf"],["mat-dialog-actions",""],["mat-flat-button","",1,"ml-auto",3,"click"],["mat-flat-button","","color","warn",1,"ml-2",3,"disabled","click"],[1,"ml-auto","mr-auto"],["mat-dialog-content",""],[1,"font-weight-bold"],["mat-table","",1,"w-100",3,"dataSource"],["matColumnDef","id"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","destination"],["matColumnDef","time"],["mat-header-row","","class","font-weight-bolder",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["mat-header-cell",""],["mat-cell",""],["mat-header-row","",1,"font-weight-bolder"],["mat-row",""]],template:function(t,e){1&t&&(p.TgZ(0,"h1",0),p._uU(1),p.ALo(2,"translate"),p.qZA(),p.TgZ(3,"div"),p.YNc(4,Fi,1,0,"mat-spinner",1),p.YNc(5,Pi,19,9,"div",2),p.TgZ(6,"div",3),p.TgZ(7,"button",4),p.NdJ("click",function(){return e.onCancel()}),p._uU(8),p.ALo(9,"translate"),p.qZA(),p.TgZ(10,"button",5),p.NdJ("click",function(){return e.onDelete()}),p._uU(11),p.ALo(12,"translate"),p.qZA(),p.qZA(),p.qZA()),2&t&&(p.xp6(1),p.Oqu(p.lcZ(2,9,"DIALOGS.DELETE_TASK_RESULT.TITLE")),p.xp6(2),p.Tol(e.theme),p.xp6(1),p.Q6J("ngIf",e.loading),p.xp6(1),p.Q6J("ngIf",!e.loading),p.xp6(3),p.hij(" ",p.lcZ(9,11,"DIALOGS.DELETE_TASK_RESULT.CANCEL")," "),p.xp6(2),p.Q6J("disabled",e.loading),p.xp6(1),p.hij(" ",p.lcZ(12,13,"DIALOGS.DELETE_TASK_RESULT.REMOVE")," "))},directives:[g.uh,s.O5,g.H8,b.lW,A.$g,g.xY,se.BZ,se.w1,se.fO,se.Dz,se.as,se.nj,se.ge,se.ev,se.XQ,se.Gk],pipes:[E.X$,s.uU],styles:[""]}),t})();var Bi=i(88884);function $i(t,e){1&t&&p._UZ(0,"mat-spinner",6)}function ji(t,e){if(1&t){const t=p.EpF();p.TgZ(0,"mat-checkbox",13),p.NdJ("change",function(e){return p.CHM(t),p.oxw(2).change(e)}),p.ALo(1,"translate"),p._uU(2),p.ALo(3,"translate"),p.qZA()}if(2&t){const t=p.oxw(2);p.s9C("matTooltip",p.lcZ(1,5,"DIALOGS.REMOVE_SERVICE_FROM_FACILITY.CHECKBOXES_DISABLED")),p.Q6J("matTooltipDisabled",!t.checkboxesDisabled)("disabled",t.checkboxesDisabled)("checked",t.taskChecked),p.xp6(2),p.hij(" ",p.lcZ(3,7,"DIALOGS.REMOVE_SERVICE_FROM_FACILITY.CHECKBOX_TASK_AND_TASK_RESULTS")," ")}}function zi(t,e){if(1&t){const t=p.EpF();p.TgZ(0,"mat-checkbox",14),p.NdJ("change",function(e){return p.CHM(t),p.oxw(2).change(e)}),p.ALo(1,"translate"),p._uU(2),p.ALo(3,"translate"),p.qZA()}if(2&t){const t=p.oxw(2);p.s9C("matTooltip",p.lcZ(1,5,"DIALOGS.REMOVE_SERVICE_FROM_FACILITY.CHECKBOXES_DISABLED")),p.Q6J("matTooltipDisabled",!t.checkboxesDisabled)("disabled",t.checkboxesDisabled)("checked",t.taskResultsChecked),p.xp6(2),p.hij(" ",p.lcZ(3,7,"DIALOGS.REMOVE_SERVICE_FROM_FACILITY.CHECKBOX_TASK_RESULTS")," ")}}function Xi(t,e){if(1&t){const t=p.EpF();p.TgZ(0,"perun-web-apps-resources-list",15),p.NdJ("allSelected",function(e){return p.CHM(t),p.oxw(2).disableCheckboxes(e)}),p.qZA()}if(2&t){const t=p.oxw(2);p.Q6J("tableId",t.tableId)("disableRouting",!0)("resources",t.resources)("selection",t.selected)("displayedColumns",t.displayedColumns)}}function Wi(t,e){if(1&t){const t=p.EpF();p.TgZ(0,"div",7),p.TgZ(1,"p"),p._uU(2),p.ALo(3,"translate"),p.qZA(),p.TgZ(4,"div"),p.YNc(5,ji,4,9,"mat-checkbox",8),p.YNc(6,zi,4,9,"mat-checkbox",9),p.TgZ(7,"mat-checkbox",10),p.NdJ("change",function(e){return p.CHM(t),p.oxw().change(e)}),p.ALo(8,"translate"),p._uU(9),p.ALo(10,"translate"),p.qZA(),p.qZA(),p.TgZ(11,"p"),p._uU(12),p.ALo(13,"translate"),p.qZA(),p.TgZ(14,"div",11),p._uU(15),p.ALo(16,"translate"),p.qZA(),p.YNc(17,Xi,1,5,"perun-web-apps-resources-list",12),p.qZA()}if(2&t){const t=p.oxw();p.xp6(2),p.Oqu(p.lcZ(3,11,"DIALOGS.REMOVE_SERVICE_FROM_FACILITY.CHECKBOXES_DESCRIPTION")),p.xp6(3),p.Q6J("ngIf",null!==t.taskId),p.xp6(1),p.Q6J("ngIf",null!==t.taskId),p.xp6(1),p.s9C("matTooltip",p.lcZ(8,13,"DIALOGS.REMOVE_SERVICE_FROM_FACILITY.CHECKBOXES_DISABLED")),p.Q6J("matTooltipDisabled",!t.checkboxesDisabled)("disabled",t.checkboxesDisabled)("checked",t.destinationChecked),p.xp6(2),p.hij(" ",p.lcZ(10,15,"DIALOGS.REMOVE_SERVICE_FROM_FACILITY.CHECKBOX_DESTINATION")," "),p.xp6(3),p.Oqu(p.lcZ(13,17,"DIALOGS.REMOVE_SERVICE_FROM_FACILITY.DESCRIPTION")),p.xp6(3),p.hij(" ",p.lcZ(16,19,"DIALOGS.REMOVE_SERVICE_FROM_FACILITY.ASK")," "),p.xp6(2),p.Q6J("ngIf",!t.loading)}}let Ki=(()=>{class t{constructor(t,e,i,s,a,n,l,o){this.dialogRef=t,this.data=e,this.resourcesManager=i,this.tasksManager=s,this.serviceManager=a,this.translate=n,this.notificator=l,this.cd=o,this.loading=!1,this.dataSource=new se.by(this.data.resource),this.selected=new vt.Ov(!0,[...this.dataSource.data]),this.resources=[],this.displayedColumns=["select","id","vo","name"],this.checkboxesDisabled=!1,this.taskChecked=!0,this.taskResultsChecked=!0,this.destinationChecked=!0,this.tableId=Ct.$V}ngOnInit(){this.theme=this.data.theme,this.taskId=this.data.taskId,this.serviceId=this.data.serviceId,this.facilityId=this.data.facilityId,this.resources=this.data.resource}remove(){this.loading=!0,this.taskResultsChecked&&!this.taskChecked&&null!==this.taskId&&this.tasksManager.getTaskResultsForGUIByTask(this.taskId).subscribe(t=>{t.forEach(t=>{this.tasksManager.deleteTaskResultById({taskResultId:t.id}).subscribe()})}),this.taskChecked&&null!==this.taskId&&this.tasksManager.deleteTask({task:this.taskId}).subscribe(),this.destinationChecked&&this.serviceManager.getDestinations(this.serviceId,this.facilityId).subscribe(t=>{t.forEach(t=>{this.serviceManager.removeDestination(this.serviceId,this.facilityId,t.destination,t.type).subscribe()})}),this.selected.selected.forEach(t=>{this.resourcesManager.removeService(t.id,this.serviceId).subscribe(()=>{this.translate.get("DIALOGS.REMOVE_SERVICE_FROM_FACILITY.SUCCESS").subscribe(t=>{this.notificator.showSuccess(t),this.dialogRef.close(!0)})},()=>this.loading=!1)})}cancel(){this.dialogRef.close(!1)}disableCheckboxes(t){t&&this.checkboxesDisabled&&this.changeCheckboxes(!0),t||this.checkboxesDisabled||this.changeCheckboxes(!1)}changeCheckboxes(t){this.checkboxesDisabled=!t,this.taskChecked=t,this.taskResultsChecked=t,this.destinationChecked=t,this.cd.detectChanges()}change(t){switch(t.source.id){case"task":this.taskChecked=t.checked;break;case"taskResults":this.taskResultsChecked=t.checked;break;case"destination":this.destinationChecked=t.checked}}}return t.\u0275fac=function(e){return new(e||t)(p.Y36(g.so),p.Y36(g.WI),p.Y36(c.xk),p.Y36(c.Ob),p.Y36(c.KK),p.Y36(E.sK),p.Y36(d.V6),p.Y36(p.sBO))},t.\u0275cmp=p.Xpm({type:t,selectors:[["app-delete-service-from-facility"]],decls:13,vars:15,consts:[["mat-dialog-title",""],["class","ml-auto mr-auto",4,"ngIf"],["mat-dialog-content","",4,"ngIf"],["mat-dialog-actions",""],["mat-flat-button","",1,"ml-auto",3,"click"],["mat-flat-button","","color","warn",1,"ml-2",3,"disabled","click"],[1,"ml-auto","mr-auto"],["mat-dialog-content",""],["id","task","class","right-space","color","warn",3,"matTooltip","matTooltipDisabled","disabled","checked","change",4,"ngIf"],["id","taskResults","class","right-space","color","warn",3,"matTooltip","matTooltipDisabled","disabled","checked","change",4,"ngIf"],["id","destination","color","warn",3,"matTooltip","matTooltipDisabled","disabled","checked","change"],[1,"font-weight-bold"],[3,"tableId","disableRouting","resources","selection","displayedColumns","allSelected",4,"ngIf"],["id","task","color","warn",1,"right-space",3,"matTooltip","matTooltipDisabled","disabled","checked","change"],["id","taskResults","color","warn",1,"right-space",3,"matTooltip","matTooltipDisabled","disabled","checked","change"],[3,"tableId","disableRouting","resources","selection","displayedColumns","allSelected"]],template:function(t,e){1&t&&(p.TgZ(0,"h1",0),p._uU(1),p.ALo(2,"translate"),p.qZA(),p.TgZ(3,"div"),p.YNc(4,$i,1,0,"mat-spinner",1),p.YNc(5,Wi,18,21,"div",2),p.TgZ(6,"div",3),p.TgZ(7,"button",4),p.NdJ("click",function(){return e.cancel()}),p._uU(8),p.ALo(9,"translate"),p.qZA(),p.TgZ(10,"button",5),p.NdJ("click",function(){return e.remove()}),p._uU(11),p.ALo(12,"translate"),p.qZA(),p.qZA(),p.qZA()),2&t&&(p.xp6(1),p.Oqu(p.lcZ(2,9,"DIALOGS.REMOVE_SERVICE_FROM_FACILITY.TITLE")),p.xp6(2),p.Tol(e.theme),p.xp6(1),p.Q6J("ngIf",e.loading),p.xp6(1),p.Q6J("ngIf",!e.loading),p.xp6(3),p.hij(" ",p.lcZ(9,11,"DIALOGS.REMOVE_SERVICE_FROM_FACILITY.CANCEL")," "),p.xp6(2),p.Q6J("disabled",e.loading||0===e.selected.selected.length),p.xp6(1),p.hij(" ",p.lcZ(12,13,"DIALOGS.REMOVE_SERVICE_FROM_FACILITY.REMOVE")," "))},directives:[g.uh,s.O5,g.H8,b.lW,A.$g,g.xY,nt.oG,S.gM,Bi.C],pipes:[E.X$],styles:[".right-space[_ngcontent-%COMP%]{margin-right:40px}"]}),t})();function ts(t,e){1&t&&p._UZ(0,"mat-spinner",6)}function es(t,e){1&t&&(p.TgZ(0,"div",7),p.TgZ(1,"div",8),p._uU(2),p.ALo(3,"translate"),p.qZA(),p.qZA()),2&t&&(p.xp6(2),p.hij(" ",p.lcZ(3,1,"DIALOGS.DELETE_TASK.DESCRIPTION")," "))}let is=(()=>{class t{constructor(t,e,i,s,a){this.dialogRef=t,this.data=e,this.tasksManager=i,this.translate=s,this.notificator=a,this.loading=!1}ngOnInit(){this.theme=this.data.theme,this.taskId=this.data.taskId}remove(){this.loading=!0,this.tasksManager.deleteTask({task:this.taskId}).subscribe(()=>{this.translate.get("DIALOGS.DELETE_TASK.SUCCESS").subscribe(t=>{this.notificator.showSuccess(t),this.dialogRef.close(!0)})},()=>this.loading=!1)}cancel(){this.dialogRef.close(!1)}}return t.\u0275fac=function(e){return new(e||t)(p.Y36(g.so),p.Y36(g.WI),p.Y36(c.Ob),p.Y36(E.sK),p.Y36(d.V6))},t.\u0275cmp=p.Xpm({type:t,selectors:[["app-delete-task-dialog"]],decls:13,vars:15,consts:[["mat-dialog-title",""],["class","ml-auto mr-auto",4,"ngIf"],["mat-dialog-content","",4,"ngIf"],["mat-dialog-actions",""],["mat-flat-button","",1,"ml-auto",3,"click"],["mat-flat-button","","color","warn",1,"ml-2",3,"disabled","click"],[1,"ml-auto","mr-auto"],["mat-dialog-content",""],[1,"font-weight-bold"]],template:function(t,e){1&t&&(p.TgZ(0,"h1",0),p._uU(1),p.ALo(2,"translate"),p.qZA(),p.TgZ(3,"div"),p.YNc(4,ts,1,0,"mat-spinner",1),p.YNc(5,es,4,3,"div",2),p.TgZ(6,"div",3),p.TgZ(7,"button",4),p.NdJ("click",function(){return e.cancel()}),p._uU(8),p.ALo(9,"translate"),p.qZA(),p.TgZ(10,"button",5),p.NdJ("click",function(){return e.remove()}),p._uU(11),p.ALo(12,"translate"),p.qZA(),p.qZA(),p.qZA()),2&t&&(p.xp6(1),p.Oqu(p.lcZ(2,9,"DIALOGS.DELETE_TASK.TITLE")),p.xp6(2),p.Tol(e.theme),p.xp6(1),p.Q6J("ngIf",e.loading),p.xp6(1),p.Q6J("ngIf",!e.loading),p.xp6(3),p.hij(" ",p.lcZ(9,11,"DIALOGS.DELETE_TASK.CANCEL")," "),p.xp6(2),p.Q6J("disabled",e.loading),p.xp6(1),p.hij(" ",p.lcZ(12,13,"DIALOGS.DELETE_TASK.DELETE")," "))},directives:[g.uh,s.O5,g.H8,b.lW,A.$g,g.xY],pipes:[E.X$],styles:[""]}),t})();var ss=i(8055);let as=(()=>{class t{transform(t){return t.blockedOnFacility?"BLOCKED":t.blockedGlobally?"BLOCKED GLOBALLY":"ALLOWED"}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275pipe=p.Yjl({name:"serviceStateBlockedToString",type:t,pure:!0}),t})();function ns(t,e){if(1&t){const t=p.EpF();p.TgZ(0,"th",18),p.TgZ(1,"mat-checkbox",19),p.NdJ("change",function(e){p.CHM(t);const i=p.oxw();return e&&i.masterToggle(),i.selectionChange.emit()}),p.qZA(),p.qZA()}if(2&t){const t=p.oxw();p.xp6(1),p.Q6J("checked",t.selection.hasValue()&&t.isAllSelected())("indeterminate",t.selection.hasValue()&&!t.isAllSelected())("aria-label",t.checkboxLabel())}}function ls(t,e){if(1&t){const t=p.EpF();p.TgZ(0,"td",20),p.TgZ(1,"mat-checkbox",21),p.NdJ("click",function(t){return t.stopPropagation()})("change",function(e){const i=p.CHM(t).$implicit,s=p.oxw();return e&&s.selection.toggle(i),s.selectionChange.emit()}),p.qZA(),p.qZA()}if(2&t){const t=e.$implicit,i=p.oxw();p.xp6(1),p.Q6J("checked",i.selection.isSelected(t))("aria-label",i.checkboxLabel(t))}}function os(t,e){1&t&&(p.TgZ(0,"th",22),p._uU(1),p.ALo(2,"translate"),p.qZA()),2&t&&(p.xp6(1),p.Oqu(p.lcZ(2,1,"SHARED_LIB.PERUN.COMPONENTS.SERVICES_STATUS_LIST.TASK_ID")))}function cs(t,e){if(1&t&&(p.TgZ(0,"div"),p._uU(1),p.qZA()),2&t){const t=p.oxw().$implicit;p.xp6(1),p.Oqu(t.task.id)}}function rs(t,e){1&t&&(p.TgZ(0,"div"),p._uU(1,"0"),p.qZA())}function ds(t,e){if(1&t&&(p.TgZ(0,"td",23),p.YNc(1,cs,2,1,"div",24),p.YNc(2,rs,2,0,"div",24),p.qZA()),2&t){const t=e.$implicit;p.xp6(1),p.Q6J("ngIf",t.task),p.xp6(1),p.Q6J("ngIf",!t.task)}}function us(t,e){1&t&&(p.TgZ(0,"th",22),p._uU(1),p.ALo(2,"translate"),p.qZA()),2&t&&(p.xp6(1),p.Oqu(p.lcZ(2,1,"SHARED_LIB.PERUN.COMPONENTS.SERVICES_STATUS_LIST.SERVICE_NAME")))}function hs(t,e){if(1&t&&(p.TgZ(0,"td",25),p._uU(1),p.qZA()),2&t){const t=e.$implicit;p.xp6(1),p.Oqu(t.service.name)}}function ps(t,e){1&t&&(p.TgZ(0,"th",22),p._uU(1),p.ALo(2,"translate"),p.qZA()),2&t&&(p.xp6(1),p.Oqu(p.lcZ(2,1,"SHARED_LIB.PERUN.COMPONENTS.SERVICES_STATUS_LIST.STATUS")))}function gs(t,e){if(1&t&&(p.TgZ(0,"td",25),p._uU(1),p.qZA()),2&t){const t=e.$implicit;p.xp6(1),p.Oqu(t.status)}}function fs(t,e){1&t&&(p.TgZ(0,"th",22),p._uU(1),p.ALo(2,"translate"),p.qZA()),2&t&&(p.xp6(1),p.Oqu(p.lcZ(2,1,"SHARED_LIB.PERUN.COMPONENTS.SERVICES_STATUS_LIST.BLOCKED")))}function ms(t,e){if(1&t&&(p.TgZ(0,"td",25),p._uU(1),p.ALo(2,"serviceStateBlockedToString"),p.qZA()),2&t){const t=e.$implicit;p.xp6(1),p.Oqu(p.lcZ(2,1,t))}}function As(t,e){1&t&&(p.TgZ(0,"th",22),p._uU(1),p.ALo(2,"translate"),p.qZA()),2&t&&(p.xp6(1),p.Oqu(p.lcZ(2,1,"SHARED_LIB.PERUN.COMPONENTS.SERVICES_STATUS_LIST.STARTED")))}function Is(t,e){if(1&t&&(p.TgZ(0,"div"),p._uU(1),p.ALo(2,"date"),p.qZA()),2&t){const t=p.oxw().$implicit;p.xp6(1),p.Oqu(p.xi3(2,1,t.task.startTime,"d.M.y H:mm:ss"))}}function Ss(t,e){1&t&&(p.TgZ(0,"div"),p._uU(1),p.ALo(2,"translate"),p.qZA()),2&t&&(p.xp6(1),p.hij(" ",p.lcZ(2,1,"SHARED_LIB.PERUN.COMPONENTS.SERVICES_STATUS_LIST.NOT_YET"),""))}function Ts(t,e){if(1&t&&(p.TgZ(0,"td",25),p.YNc(1,Is,3,4,"div",24),p.YNc(2,Ss,3,3,"div",24),p.qZA()),2&t){const t=e.$implicit;p.xp6(1),p.Q6J("ngIf",t.task&&t.task.startTime),p.xp6(1),p.Q6J("ngIf",!t.task||!t.task.startTime)}}function bs(t,e){1&t&&(p.TgZ(0,"th",22),p._uU(1),p.ALo(2,"translate"),p.qZA()),2&t&&(p.xp6(1),p.Oqu(p.lcZ(2,1,"SHARED_LIB.PERUN.COMPONENTS.SERVICES_STATUS_LIST.ENDED")))}function Es(t,e){if(1&t&&(p.TgZ(0,"div"),p._uU(1),p.ALo(2,"date"),p.qZA()),2&t){const t=p.oxw().$implicit;p.xp6(1),p.Oqu(p.xi3(2,1,t.task.endTime,"d.M.y H:mm:ss"))}}function Zs(t,e){1&t&&(p.TgZ(0,"div"),p._uU(1),p.ALo(2,"translate"),p.qZA()),2&t&&(p.xp6(1),p.hij(" ",p.lcZ(2,1,"SHARED_LIB.PERUN.COMPONENTS.SERVICES_STATUS_LIST.NOT_YET")," "))}function Cs(t,e){if(1&t&&(p.TgZ(0,"td",25),p.YNc(1,Es,3,4,"div",24),p.YNc(2,Zs,3,3,"div",24),p.qZA()),2&t){const t=e.$implicit;p.xp6(1),p.Q6J("ngIf",t.task&&t.task.endTime),p.xp6(1),p.Q6J("ngIf",!t.task||!t.task.endTime)}}function vs(t,e){1&t&&p._UZ(0,"tr",26)}const _s=function(t,e){return["/facilities",t,"services-status",e]};function ys(t,e){if(1&t&&p._UZ(0,"tr",27),2&t){const t=e.$implicit,i=p.oxw();p.ekj("disable-outline",i.disableRouting||!t.task)("make-yellow","WARNING"===t.status)("make-green","DONE"===t.status)("make-red","GENERROR"===t.status||"SENDERROR"===t.status||"ERROR"===t.status)("cursor-pointer",!i.disableRouting&&null!==t.task),p.Q6J("routerLink",i.disableRouting||null===t.task?null:p.WLB(12,_s,t.facility.id,t.taskId))("perunWebAppsMiddleClickRouterLink",i.disableRouting||null===t.task?null:p.WLB(15,_s,t.facility.id,t.taskId))}}function Os(t,e){1&t&&(p.TgZ(0,"app-alert",28),p._uU(1),p.ALo(2,"translate"),p.qZA()),2&t&&(p.xp6(1),p.hij(" ",p.lcZ(2,1,"SHARED_LIB.UI.ALERTS.NO_FILTER_RESULTS_ALERT"),"\n"))}function Ls(t,e){1&t&&(p.TgZ(0,"app-alert",28),p._uU(1),p.ALo(2,"translate"),p.qZA()),2&t&&(p.xp6(1),p.hij(" ",p.lcZ(2,1,"SHARED_LIB.PERUN.COMPONENTS.SERVICES_STATUS_LIST.NO_SERVICES_STATUS_WARNING"),"\n"))}let xs=(()=>{class t{constructor(t,e){this.authResolver=t,this.tableCheckbox=e,this.servicesStatus=[],this.displayedColumns=["select","task.id","service.name","status","blocked","task.startTime","task.endTime"],this.selection=new vt.Ov(!0,[]),this.disableRouting=!0,this.selectionChange=new p.vpe,this.pageSizeOptions=r.f7}set matSort(t){this.sort=t,this.setDataSource()}ngOnChanges(){this.authResolver.isPerunAdminOrObserver()||(this.displayedColumns=this.displayedColumns.filter(t=>"task.id"!==t)),this.dataSource=new se.by(this.servicesStatus),this.setDataSource(),this.dataSource.filterPredicate=(t,e)=>{const i=e.trim().toLowerCase(),s=t=>{let e="";return Object.values(t).forEach(t=>{"object"!=typeof t?e=e+" "+t:null!==t&&(e=e+" "+s(t))}),e.trim().toLowerCase()};return s(t).includes(i)},this.dataSource.filter=this.filterValue}getDataForColumn(t,e){switch(e){case"task.id":return t.task?t.task.id.toString():t[e];case"service.name":return t.service.name;case"status":return t.status;case"blocked":return t.blockedOnFacility?"BLOCKED":t.blockedGlobally?"BLOCKED GLOBALLY":"ALLOWED";case"task.startTime":return t.task&&t.task.startTime?(0,s.p6)(t.task.startTime,"d.M.y H:mm:ss","en"):t[e];case"task.endTime":return t.task&&t.task.endTime?(0,s.p6)(t.task.endTime,"d.M.y H:mm:ss","en"):t[e];default:return t[e]}}getSortDataForColumn(t,e){switch(e){case"task.id":return t.task?t.task.id.toString():t[e];case"service.name":return t.service.name;case"status":return t.status;case"blocked":return t.blockedOnFacility?"BLOCKED":t.blockedGlobally?"BLOCKED GLOBALLY":"ALLOWED";case"task.startTime":return t.task&&t.task.startTime?(0,s.p6)(t.task.startTime,"yyyy.MM.dd HH:mm:ss","en"):t[e];case"task.endTime":return t.task&&t.task.endTime?(0,s.p6)(t.task.endTime,"yyyy.MM.dd HH:mm:ss","en"):t[e];default:return t[e]}}exportData(t){(0,r.O6)((0,r.Xn)(this.dataSource.filteredData,this.displayedColumns,this.getDataForColumn,this),t)}setDataSource(){this.dataSource&&(this.dataSource.filterPredicate=(t,e)=>(0,r.Sd)(t,e,this.displayedColumns,this.getDataForColumn,this),this.dataSource.sortData=(t,e)=>(0,r.pR)(t,e,this.getSortDataForColumn,this),this.dataSource.sort=this.sort,this.dataSource.paginator=this.child.paginator)}isAllSelected(){return this.tableCheckbox.isAllSelected(this.selection.selected.length,this.filterValue,this.child.paginator.pageSize,this.child.paginator.hasNextPage(),this.dataSource)}masterToggle(){this.tableCheckbox.masterToggle(this.isAllSelected(),this.selection,this.filterValue,this.dataSource,this.sort,this.child.paginator.pageSize,this.child.paginator.pageIndex,!1)}checkboxLabel(t){return t?`${this.selection.isSelected(t)?"deselect":"select"} row ${t.service.id+1}`:(this.isAllSelected()?"select":"deselect")+" all"}ngAfterViewInit(){this.dataSource.paginator=this.child.paginator}}return t.\u0275fac=function(e){return new(e||t)(p.Y36(d.x4),p.Y36(d.UA))},t.\u0275cmp=p.Xpm({type:t,selectors:[["perun-web-apps-services-status-list"]],viewQuery:function(t,e){if(1&t&&(p.Gf(Le.YE,7),p.Gf(r.l9,7)),2&t){let t;p.iGM(t=p.CRH())&&(e.matSort=t.first),p.iGM(t=p.CRH())&&(e.child=t.first)}},inputs:{servicesStatus:"servicesStatus",displayedColumns:"displayedColumns",selection:"selection",filterValue:"filterValue",tableId:"tableId",disableRouting:"disableRouting"},outputs:{selectionChange:"selectionChange"},features:[p.TTD],decls:28,vars:9,consts:[[1,"card","mt-3",3,"hidden"],[3,"tableId","dataLength","pageSizeOptions","exportData"],["mat-table","","matSort","","matSortActive","service.name","matSortDirection","asc","matSortDisableClear","",1,"w-100",3,"dataSource"],["matColumnDef","select"],["mat-header-cell","","class","align-checkbox",4,"matHeaderCellDef"],["mat-cell","","class","static-column-size align-checkbox",4,"matCellDef"],["matColumnDef","task.id"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["mat-cell","","class","static-column-size",4,"matCellDef"],["matColumnDef","service.name"],["mat-cell","",4,"matCellDef"],["matColumnDef","status"],["matColumnDef","blocked"],["matColumnDef","task.startTime"],["matColumnDef","task.endTime"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","","class","dark-hover-list-item",3,"disable-outline","make-yellow","make-green","make-red","cursor-pointer","routerLink","perunWebAppsMiddleClickRouterLink",4,"matRowDef","matRowDefColumns"],["alert_type","warn",4,"ngIf"],["mat-header-cell","",1,"align-checkbox"],["color","primary",3,"checked","indeterminate","aria-label","change"],["mat-cell","",1,"static-column-size","align-checkbox"],["color","primary",3,"checked","aria-label","click","change"],["mat-header-cell","","mat-sort-header",""],["mat-cell","",1,"static-column-size"],[4,"ngIf"],["mat-cell",""],["mat-header-row",""],["mat-row","",1,"dark-hover-list-item",3,"routerLink","perunWebAppsMiddleClickRouterLink"],["alert_type","warn"]],template:function(t,e){1&t&&(p.TgZ(0,"div",0),p.TgZ(1,"perun-web-apps-table-wrapper",1),p.NdJ("exportData",function(t){return e.exportData(t)}),p.TgZ(2,"table",2),p.ynx(3,3),p.YNc(4,ns,2,3,"th",4),p.YNc(5,ls,2,2,"td",5),p.BQk(),p.ynx(6,6),p.YNc(7,os,3,3,"th",7),p.YNc(8,ds,3,2,"td",8),p.BQk(),p.ynx(9,9),p.YNc(10,us,3,3,"th",7),p.YNc(11,hs,2,1,"td",10),p.BQk(),p.ynx(12,11),p.YNc(13,ps,3,3,"th",7),p.YNc(14,gs,2,1,"td",10),p.BQk(),p.ynx(15,12),p.YNc(16,fs,3,3,"th",7),p.YNc(17,ms,3,3,"td",10),p.BQk(),p.ynx(18,13),p.YNc(19,As,3,3,"th",7),p.YNc(20,Ts,3,2,"td",10),p.BQk(),p.ynx(21,14),p.YNc(22,bs,3,3,"th",7),p.YNc(23,Cs,3,2,"td",10),p.BQk(),p.YNc(24,vs,1,0,"tr",15),p.YNc(25,ys,1,18,"tr",16),p.qZA(),p.qZA(),p.qZA(),p.YNc(26,Os,3,3,"app-alert",17),p.YNc(27,Ls,3,3,"app-alert",17)),2&t&&(p.Q6J("hidden",0===e.dataSource.filteredData.length||0===e.servicesStatus.length),p.xp6(1),p.Q6J("tableId",e.tableId)("dataLength",e.dataSource.filteredData.length)("pageSizeOptions",e.pageSizeOptions),p.xp6(1),p.Q6J("dataSource",e.dataSource),p.xp6(22),p.Q6J("matHeaderRowDef",e.displayedColumns),p.xp6(1),p.Q6J("matRowDefColumns",e.displayedColumns),p.xp6(1),p.Q6J("ngIf",0===e.dataSource.filteredData.length&&0!==e.servicesStatus.length),p.xp6(1),p.Q6J("ngIf",0===e.servicesStatus.length))},directives:[xe.l,se.BZ,Le.YE,se.w1,se.fO,se.Dz,se.as,se.nj,s.O5,se.ge,nt.oG,se.ev,Le.nU,se.XQ,se.Gk,a.rH,me.YH,Vt.w],pipes:[E.X$,as,s.uU],styles:[".disable-outline[_ngcontent-%COMP%]{outline:none!important}.make-green[_ngcontent-%COMP%]{background-color:#c4ffcb}.make-yellow[_ngcontent-%COMP%]{background-color:#fffde7}.make-red[_ngcontent-%COMP%]{background-color:#ffcdd2}.cursor-pointer[_ngcontent-%COMP%]{cursor:pointer}"]}),t})();function Ns(t,e){if(1&t){const t=p.EpF();p.TgZ(0,"button",11),p.NdJ("click",function(){return p.CHM(t),p.oxw().forcePropagation()}),p._uU(1),p.ALo(2,"translate"),p.qZA()}if(2&t){const t=p.oxw();p.Q6J("disabled",0===t.selected.selected.length),p.xp6(1),p.hij(" ",p.lcZ(2,2,"FACILITY_DETAIL.SERVICES_STATUS.FORCE_PROPAGATION")," ")}}function Rs(t,e){if(1&t){const t=p.EpF();p.TgZ(0,"button",11),p.NdJ("click",function(){return p.CHM(t),p.oxw().allow()}),p._uU(1),p.ALo(2,"translate"),p.qZA()}if(2&t){const t=p.oxw();p.Q6J("disabled",0===t.selected.selected.length||t.disableAllowButton),p.xp6(1),p.hij(" ",p.lcZ(2,2,"FACILITY_DETAIL.SERVICES_STATUS.ALLOW")," ")}}function Ds(t,e){if(1&t){const t=p.EpF();p.TgZ(0,"button",12),p.NdJ("click",function(){return p.CHM(t),p.oxw().block()}),p._uU(1),p.ALo(2,"translate"),p.qZA()}if(2&t){const t=p.oxw();p.Q6J("disabled",0===t.selected.selected.length||t.disableBlockButton),p.xp6(1),p.hij(" ",p.lcZ(2,2,"FACILITY_DETAIL.SERVICES_STATUS.BLOCK")," ")}}function ws(t,e){if(1&t&&(p.TgZ(0,"button",13),p.ALo(1,"translate"),p._uU(2),p.ALo(3,"translate"),p.qZA()),2&t){const t=p.oxw(),e=p.MAs(10);p.s9C("matTooltip",p.lcZ(1,5,"DIALOGS.REMOVE_SERVICE_FROM_FACILITY.CHECKBOXES_DISABLED")),p.Q6J("matTooltipDisabled",!t.disableRemoveButton)("disabled",t.disableRemoveButton)("matMenuTriggerFor",e),p.xp6(2),p.hij(" ",p.lcZ(3,7,"FACILITY_DETAIL.SERVICES_STATUS.REMOVE")," ")}}function ks(t,e){if(1&t){const t=p.EpF();p.TgZ(0,"button",7),p.NdJ("click",function(){return p.CHM(t),p.oxw().removeTaskResults()}),p._uU(1),p.ALo(2,"translate"),p.qZA()}2&t&&(p.xp6(1),p.hij(" ",p.lcZ(2,1,"FACILITY_DETAIL.SERVICES_STATUS.REMOVE_TASK_RESULTS")," "))}function Fs(t,e){1&t&&p._UZ(0,"mat-spinner",14)}function Ys(t,e){if(1&t){const t=p.EpF();p.TgZ(0,"perun-web-apps-services-status-list",15),p.NdJ("selectionChange",function(){return p.CHM(t),p.oxw().selectionChanged()}),p.qZA()}if(2&t){const t=p.oxw();p.Q6J("tableId",t.tableId)("filterValue",t.filterValue)("servicesStatus",t.servicesStates)("selection",t.selected)("disableRouting",!t.routeAuth)}}let Us=(()=>{class t{constructor(t,e,i,s,a,n,l,o,c){this.tasksManager=t,this.servicesManager=e,this.notificator=i,this.translate=s,this.authResolver=a,this.facilityManager=n,this.resourcesManager=l,this.dialog=o,this.entityStorageService=c,this.servicesStates=[],this.selected=new vt.Ov(!0,[]),this.filterValue="",this.tableId=Ct.oK,this.disableAllowButton=!0,this.disableBlockButton=!0,this.disableRemoveButton=!0,s.get("FACILITY_DETAIL.SERVICES_STATUS.SUCCESS_FORCE_PROPAGATION").subscribe(t=>this.successFPMessage=t),s.get("FACILITY_DETAIL.SERVICES_STATUS.SUCCESS_ALLOW").subscribe(t=>this.successAllowMessage=t),s.get("FACILITY_DETAIL.SERVICES_STATUS.SUCCESS_BLOCK").subscribe(t=>this.successBlockMessage=t),s.get("FACILITY_DETAIL.SERVICES_STATUS.SUCCESS_DELETE").subscribe(t=>this.successDeleteMessage=t),s.get("FACILITY_DETAIL.SERVICES_STATUS.ALREADY_DELETED").subscribe(t=>this.allreadyDeletedMessage=t)}ngOnInit(){this.loading=!0,this.facility=this.entityStorageService.getEntity(),this.setAuthRights(),this.refreshTable()}forcePropagation(){for(const t of this.selected.selected)this.servicesManager.forceServicePropagation(t.service.id,t.facility.id).subscribe(()=>{this.refreshTable(),this.notificator.showSuccess(this.successFPMessage)})}allow(){for(const t of this.selected.selected)this.servicesManager.unblockServiceOnFacility(t.service.id,t.facility.id).subscribe(()=>{this.refreshTable(),this.notificator.showSuccess(this.successAllowMessage)})}block(){for(const t of this.selected.selected)this.servicesManager.blockServiceOnFacility(t.service.id,t.facility.id).subscribe(()=>{this.refreshTable(),this.notificator.showSuccess(this.successBlockMessage)})}removeTaskResults(){this.tasksManager.getTaskResultsForGUIByTask(this.selected.selected[0].task.id).subscribe(t=>{const e=(0,r.kZ)();e.width="600px",e.data={theme:"facility-theme",taskResults:t},this.dialog.open(Gi,e)})}removeServiceFromFacility(){this.facilityManager.getAssignedResourcesByAssignedServiceForFacility(this.selected.selected[0].facility.id,this.selected.selected[0].service.id).subscribe(t=>{const e=(0,r.kZ)();e.width="600px",this.taskId=this.taskIsNull?null:this.selected.selected[0].task.id,0===t.length?(e.data={theme:"facility-theme",taskId:this.taskId},this.dialog.open(is,e).afterClosed().subscribe(t=>{t&&(this.disableRemoveButton=!0,this.refreshTable())})):this.resourcesManager.getRichResourcesByIds(t.map(t=>t.id)).subscribe(t=>{e.data={theme:"facility-theme",taskId:this.taskId,serviceId:this.selected.selected[0].service.id,facilityId:this.selected.selected[0].facility.id,resource:t},this.dialog.open(Ki,e).afterClosed().subscribe(t=>{t&&(this.disableRemoveButton=!0,this.refreshTable())})})})}refreshTable(){this.loading=!0,this.tasksManager.getFacilityServicesState(this.facility.id).subscribe(t=>{this.servicesStates=t,this.selected.clear(),this.setAuthRights(),this.loading=!1})}setAuthRights(){this.propagationAuth=this.authResolver.isAuthorized("forceServicePropagation_Facility_Service_policy",[this.facility]),this.blockAuth=this.authResolver.isAuthorized("blockServiceOnFacility_Service_Facility_policy",[this.facility]),this.allowAuth=this.authResolver.isAuthorized("unblockServiceOnFacility_Service_Facility_policy",[this.facility]),this.deleteAuth=this.authResolver.isAuthorized("deleteTask_Task_policy",[this.facility]),this.routeAuth=this.authResolver.isAuthorized("getTaskResultsByTask_int_policy",[this.facility])}applyFilter(t){this.filterValue=t}selectionChanged(){this.disableBlockButton=!0,this.disableAllowButton=!0,this.disableRemoveButton=1!==this.selected.selected.length,this.disableRemoveButton||(this.taskIsNull=null===this.selected.selected[0].task);for(const t of this.selected.selected)t.blockedOnFacility?this.disableAllowButton=!1:this.disableBlockButton=!1}}return t.\u0275fac=function(e){return new(e||t)(p.Y36(c.Ob),p.Y36(c.KK),p.Y36(d.V6),p.Y36(E.sK),p.Y36(d.x4),p.Y36(c.IQ),p.Y36(c.xk),p.Y36(g.uw),p.Y36(d.fb))},t.\u0275cmp=p.Xpm({type:t,selectors:[["app-facility-service-status"]],decls:18,vars:14,consts:[[1,"page-subtitle"],[3,"refresh"],["mat-flat-button","","color","accent","class","mr-2",3,"disabled","click",4,"ngIf"],["mat-flat-button","","color","warn","class","mr-2",3,"disabled","click",4,"ngIf"],["mat-flat-button","","color","warn","class","mr-2 dropdown-toggle",3,"matTooltip","matTooltipDisabled","disabled","matMenuTriggerFor",4,"ngIf"],["menu","matMenu"],["mat-menu-item","",3,"click",4,"ngIf"],["mat-menu-item","",3,"click"],[3,"placeholder","filter"],["class","ml-auto mr-auto",4,"ngIf"],[3,"tableId","filterValue","servicesStatus","selection","disableRouting","selectionChange",4,"ngIf"],["mat-flat-button","","color","accent",1,"mr-2",3,"disabled","click"],["mat-flat-button","","color","warn",1,"mr-2",3,"disabled","click"],["mat-flat-button","","color","warn",1,"mr-2","dropdown-toggle",3,"matTooltip","matTooltipDisabled","disabled","matMenuTriggerFor"],[1,"ml-auto","mr-auto"],[3,"tableId","filterValue","servicesStatus","selection","disableRouting","selectionChange"]],template:function(t,e){1&t&&(p.TgZ(0,"div"),p.TgZ(1,"h1",0),p._uU(2),p.ALo(3,"translate"),p.qZA(),p.TgZ(4,"perun-web-apps-refresh-button",1),p.NdJ("refresh",function(){return e.refreshTable()}),p.qZA(),p.YNc(5,Ns,3,4,"button",2),p.YNc(6,Rs,3,4,"button",2),p.YNc(7,Ds,3,4,"button",3),p.YNc(8,ws,4,9,"button",4),p.TgZ(9,"mat-menu",null,5),p.YNc(11,ks,3,3,"button",6),p.TgZ(12,"button",7),p.NdJ("click",function(){return e.removeServiceFromFacility()}),p._uU(13),p.ALo(14,"translate"),p.qZA(),p.qZA(),p.TgZ(15,"perun-web-apps-immediate-filter",8),p.NdJ("filter",function(t){return e.applyFilter(t)}),p.qZA(),p.YNc(16,Fs,1,0,"mat-spinner",9),p.YNc(17,Ys,1,5,"perun-web-apps-services-status-list",10),p.qZA()),2&t&&(p.xp6(2),p.Oqu(p.lcZ(3,10,"FACILITY_DETAIL.SERVICES_STATUS.TITLE")),p.xp6(3),p.Q6J("ngIf",e.propagationAuth),p.xp6(1),p.Q6J("ngIf",e.allowAuth),p.xp6(1),p.Q6J("ngIf",e.blockAuth),p.xp6(1),p.Q6J("ngIf",e.deleteAuth),p.xp6(3),p.Q6J("ngIf",!e.taskIsNull),p.xp6(2),p.Oqu(p.lcZ(14,12,"FACILITY_DETAIL.SERVICES_STATUS.REMOVE_SERVICE_FROM_FACILITY")),p.xp6(2),p.Q6J("placeholder","SHARED_LIB.PERUN.COMPONENTS.SERVICES_STATUS_LIST.TABLE_SEARCH"),p.xp6(1),p.Q6J("ngIf",e.loading),p.xp6(1),p.Q6J("ngIf",!e.loading))},directives:[Jt.t,s.O5,ss.VK,ss.OP,Qt.L,b.lW,S.gM,ss.p6,A.$g,xs],pipes:[E.X$],styles:[""]}),t})();var qs=i(67004),Ms=i(91058);let Js=(()=>{class t{constructor(){this.changeAdvancedFilter=new p.vpe,this.clearFilters=new p.vpe}ngOnInit(){this.changeAdvancedFilter.emit(this.advancedFilter)}toggleAdvancedFilter(){this.advancedFilter=!this.advancedFilter,this.changeAdvancedFilter.emit(this.advancedFilter)}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=p.Xpm({type:t,selectors:[["perun-web-apps-advanced-filter"]],inputs:{filtersCount:"filtersCount",advancedFilter:"advancedFilter"},outputs:{changeAdvancedFilter:"changeAdvancedFilter",clearFilters:"clearFilters"},decls:12,vars:11,consts:[["mat-stroked-button","",3,"click"]],template:function(t,e){1&t&&(p.TgZ(0,"button",0),p.NdJ("click",function(){return e.toggleAdvancedFilter()}),p.TgZ(1,"mat-icon"),p._uU(2,"filter_list"),p.qZA(),p._uU(3),p.ALo(4,"translate"),p.TgZ(5,"mat-icon"),p._uU(6),p.qZA(),p.qZA(),p.TgZ(7,"button",0),p.NdJ("click",function(){return e.clearFilters.emit()}),p.TgZ(8,"mat-icon"),p._uU(9,"filter_list_off"),p.qZA(),p._uU(10),p.ALo(11,"translate"),p.qZA()),2&t&&(p.Gre("mr-2 ",e.filtersCount?"grey":"no-color",""),p.xp6(3),p.AsE(" ",p.lcZ(4,7,"SHARED_LIB.PERUN.COMPONENTS.ADVANCED_FILTER.FILTERS")," ",e.filtersCount?"("+e.filtersCount+")":null," "),p.xp6(3),p.Oqu(e.advancedFilter?"arrow_drop_up":"arrow_drop_down"),p.xp6(4),p.hij(" ",p.lcZ(11,9,"SHARED_LIB.PERUN.COMPONENTS.ADVANCED_FILTER.CLEAR_FILTERS"),"\n"))},directives:[b.lW,I.Hw],pipes:[E.X$],styles:[".grey[_ngcontent-%COMP%]{color:#fff;background-color:grey}.no-color[_ngcontent-%COMP%]{color:#000;background-color:transparent}"]}),t})();var Qs=i(27521),Vs=i(19386),Hs=i(42847),Ps=i(44973);let Gs=(()=>{class t{constructor(){this.service=null,this.multiple=!1,this.disableAutoSelect=!1,this.theme="",this.serviceSelected=new p.vpe,this.nameFunction=t=>t.name,this.secondaryFunction=()=>"",this.searchFunction=t=>t.name}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=p.Xpm({type:t,selectors:[["perun-web-apps-service-search-select"]],inputs:{service:"service",services:"services",multiple:"multiple",disableAutoSelect:"disableAutoSelect",theme:"theme"},outputs:{serviceSelected:"serviceSelected"},decls:4,vars:17,consts:[[3,"entity","entities","multiple","disableAutoSelect","searchFunction","mainTextFunction","secondaryTextFunction","selectPlaceholder","findPlaceholder","noEntriesText","theme","entitySelected"]],template:function(t,e){1&t&&(p.TgZ(0,"perun-web-apps-entity-search-select",0),p.NdJ("entitySelected",function(t){return e.serviceSelected.emit(t)}),p.ALo(1,"translate"),p.ALo(2,"translate"),p.ALo(3,"translate"),p.qZA()),2&t&&p.Q6J("entity",e.service)("entities",e.services)("multiple",e.multiple)("disableAutoSelect",e.disableAutoSelect)("searchFunction",e.searchFunction)("mainTextFunction",e.nameFunction)("secondaryTextFunction",e.secondaryFunction)("selectPlaceholder",p.lcZ(1,11,"SHARED_LIB.PERUN.COMPONENTS.SERVICE_SEARCH_SELECT.SELECT_SERVICE"))("findPlaceholder",p.lcZ(2,13,"SHARED_LIB.PERUN.COMPONENTS.SERVICE_SEARCH_SELECT.FIND_SERVICE"))("noEntriesText",p.lcZ(3,15,"SHARED_LIB.PERUN.COMPONENTS.SERVICE_SEARCH_SELECT.NO_SERVICE_FOUND"))("theme",e.theme)},directives:[Ps.i],pipes:[E.X$],styles:[""]}),t})();var Bs=i(16247);function $s(t,e){if(1&t){const t=p.EpF();p.TgZ(0,"div",8),p.TgZ(1,"div",9),p.TgZ(2,"mat-slide-toggle",10),p.NdJ("ngModelChange",function(e){return p.CHM(t),p.oxw().allowed=e})("change",function(){return p.CHM(t),p.oxw().changeFilter()}),p._uU(3),p.ALo(4,"translate"),p.qZA(),p.TgZ(5,"span",11),p._uU(6),p.ALo(7,"translate"),p.qZA(),p.qZA(),p.TgZ(8,"div",1),p.TgZ(9,"perun-web-apps-vo-search-select",12),p.NdJ("voSelected",function(e){return p.CHM(t),p.oxw().voSelected(e)}),p.qZA(),p.TgZ(10,"perun-web-apps-resource-search-select",13),p.NdJ("resourceSelected",function(e){return p.CHM(t),p.oxw().resourceSelected(e)}),p.qZA(),p.TgZ(11,"perun-web-apps-service-search-select",14),p.NdJ("serviceSelected",function(e){return p.CHM(t),p.oxw().serviceSelected(e)}),p.qZA(),p.qZA(),p.qZA()}if(2&t){const t=p.oxw();p.xp6(2),p.Q6J("ngModel",t.allowed),p.xp6(1),p.hij(" ",p.lcZ(4,10,"FACILITY_DETAIL.ALLOWED_USERS.FILTER_ALLOWED")," "),p.xp6(3),p.Oqu(p.lcZ(7,12,t.toggle_messages[t.allowed?1:0])),p.xp6(3),p.Q6J("vo",t.selectedVo)("vos",t.vos),p.xp6(1),p.Q6J("displayStatus",!1)("resource",t.selectedResource)("resources",t.filteredResources),p.xp6(1),p.Q6J("service",t.selectedService)("services",t.filteredServices)}}function js(t,e){1&t&&p._UZ(0,"mat-spinner",15)}const zs=function(){return["id","name","email","logins","organization"]};function Xs(t,e){if(1&t&&p._UZ(0,"perun-web-apps-users-dynamic-list",16),2&t){const t=p.oxw();p.Q6J("tableId",t.tableId)("searchString",t.filterValue)("displayedColumns",p.DdM(10,zs))("attrNames",t.attributes)("facilityId",t.facility.id)("voId",-1===t.selectedVo.id?null:t.selectedVo.id)("resourceId",-1===t.selectedResource.id?null:t.selectedResource.id)("serviceId",-1===t.selectedService.id?null:t.selectedService.id)("onlyAllowed",t.allowed)("disableRouting",!t.routeAuth)}}let Ws=(()=>{class t{constructor(t,e,i,s,a,n){this.facilityService=t,this.serviceService=e,this.resourceService=i,this.authResolver=s,this.storeService=a,this.entityStorageService=n,this.loading=!1,this.filterValue="",this.attributes=[],this.allowed=!0,this.emptyResource={id:-1,beanName:"Resource",name:"No filter"},this.resources=[this.emptyResource],this.filteredResources=[this.emptyResource],this.selectedResource=this.emptyResource,this.emptyVo={id:-1,beanName:"Vo",name:"No filter"},this.vos=[this.emptyVo],this.selectedVo=this.emptyVo,this.emptyService={id:-1,beanName:"Service",name:"No filter"},this.services=[this.emptyService],this.filteredServices=[this.emptyService],this.selectedService=this.emptyService,this.resourceAssignedServices=new Map,this.tableId=Ct.z6,this.toggle_messages=["FACILITY_DETAIL.ALLOWED_USERS.FILTER_ASSIGNED_MSG","FACILITY_DETAIL.ALLOWED_USERS.FILTER_ALLOWED_MSG"],this.advancedFilter=!1}ngOnInit(){this.loading=!0,this.attributes=[qs.r.USER_DEF_ORGANIZATION,qs.r.USER_DEF_PREFERRED_MAIL],this.attributes=this.attributes.concat(this.storeService.getLoginAttributeNames()),this.facility=this.entityStorageService.getEntity(),this.routeAuth=this.authResolver.isPerunAdminOrObserver(),this.changeFilter(),this.refreshPage()}changeFilter(){this.filtersCount=this.allowed?1:0,-1!==this.selectedVo.id&&(this.filtersCount+=1),-1!==this.selectedResource.id&&(this.filtersCount+=1),-1!==this.selectedService.id&&(this.filtersCount+=1)}clearFilters(){this.allowed=!1,this.selectedVo=this.emptyVo,this.selectedResource=this.emptyResource,this.selectedService=this.emptyService,this.filtersCount=0}refreshPage(){this.loading=!0,this.facilityService.getAssignedResourcesForFacility(this.facility.id).subscribe(t=>{this.resources=[this.emptyResource].concat(t),this.filteredResources=this.resources,this.selectedResource=this.emptyResource,this.facilityService.getAllowedVos(this.facility.id).subscribe(t=>{this.vos=[this.emptyVo].concat(t),this.selectedVo=this.emptyVo,this.services=[],this.getAssignedServices(this.resources,this.resources.length-1)},()=>this.loading=!1)},()=>this.loading=!1)}getAssignedServices(t,e){if(0===e)return this.services=[this.emptyService].concat(this.services),this.filteredServices=this.services,this.selectedService=this.emptyService,this.changeFilter(),void(this.loading=!1);this.resourceService.getAssignedServicesToResource(t[e].id).subscribe(i=>{this.services=this.services.concat(i),this.resourceAssignedServices[t[e].id]=i.map(t=>t.id),this.getAssignedServices(t,e-1)},()=>this.loading=!1)}getFilteredServices(t){const e=new Set;return t.forEach(t=>{this.resourceAssignedServices[t.id].forEach(t=>e.add(t))}),[this.emptyService].concat(this.services.filter(t=>e.has(t.id)))}applyFilter(t){this.filterValue=t}voSelected(t){this.selectedVo.id!==t.id&&(this.selectedVo=t,this.selectedResource=this.emptyResource,this.selectedService=this.emptyService,-1===t.id?(this.filteredResources=this.resources,this.filteredServices=this.services):(this.filteredResources=this.resources.filter(e=>e.voId===t.id),this.filteredServices=this.getFilteredServices(this.filteredResources),this.filteredResources=[this.emptyResource].concat(this.filteredResources)),this.changeFilter())}resourceSelected(t){this.selectedResource.id!==t.id&&(this.selectedResource=t,this.selectedService=this.emptyService,this.filteredServices=-1===t.id?this.services:this.getFilteredServices([t]),this.changeFilter())}serviceSelected(t){this.selectedService=t,this.changeFilter()}}return t.\u0275fac=function(e){return new(e||t)(p.Y36(c.IQ),p.Y36(c.KK),p.Y36(c.xk),p.Y36(d.x4),p.Y36(d.d6),p.Y36(d.fb))},t.\u0275cmp=p.Xpm({type:t,selectors:[["app-facility-allowed-users"]],decls:11,vars:9,consts:[[1,"page-subtitle"],[1,"filters"],[1,"mr-2",3,"refresh"],[1,"mr-2","filter",3,"placeholder","filter"],[3,"filtersCount","advancedFilter","changeAdvancedFilter","clearFilters"],["class","advanced-filter",4,"ngIf"],["class","ml-auto mr-auto",4,"ngIf"],[3,"tableId","searchString","displayedColumns","attrNames","facilityId","voId","resourceId","serviceId","onlyAllowed","disableRouting",4,"ngIf"],[1,"advanced-filter"],[1,"toggle","filters"],["labelPosition","before",1,"mr-2",3,"ngModel","ngModelChange","change"],[1,"text-muted"],[1,"search-select",3,"vo","vos","voSelected"],[1,"search-select",3,"displayStatus","resource","resources","resourceSelected"],[1,"search-select",3,"service","services","serviceSelected"],[1,"ml-auto","mr-auto"],[3,"tableId","searchString","displayedColumns","attrNames","facilityId","voId","resourceId","serviceId","onlyAllowed","disableRouting"]],template:function(t,e){1&t&&(p.TgZ(0,"div"),p.TgZ(1,"h1",0),p._uU(2),p.ALo(3,"translate"),p.qZA(),p.TgZ(4,"div",1),p.TgZ(5,"perun-web-apps-refresh-button",2),p.NdJ("refresh",function(){return e.refreshPage()}),p.qZA(),p.TgZ(6,"perun-web-apps-debounce-filter",3),p.NdJ("filter",function(t){return e.applyFilter(t)}),p.qZA(),p.TgZ(7,"perun-web-apps-advanced-filter",4),p.NdJ("changeAdvancedFilter",function(t){return e.advancedFilter=t})("clearFilters",function(){return e.clearFilters()}),p.qZA(),p.qZA(),p.YNc(8,$s,12,14,"div",5),p.YNc(9,js,1,0,"mat-spinner",6),p.YNc(10,Xs,1,11,"perun-web-apps-users-dynamic-list",7),p.qZA()),2&t&&(p.xp6(2),p.Oqu(p.lcZ(3,7,"FACILITY_DETAIL.ALLOWED_USERS.TITLE")),p.xp6(4),p.Q6J("placeholder","FACILITY_DETAIL.ALLOWED_USERS.FILTER"),p.xp6(1),p.Q6J("filtersCount",e.filtersCount)("advancedFilter",e.advancedFilter),p.xp6(1),p.Q6J("ngIf",e.advancedFilter),p.xp6(1),p.Q6J("ngIf",e.loading),p.xp6(1),p.Q6J("ngIf",!e.loading))},directives:[Jt.t,Ms.P,Js,s.O5,Qs.Rr,et.JJ,et.On,Vs.M,Hs.L,Gs,A.$g,Bs.M],pipes:[E.X$],styles:[".filters[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;align-items:baseline}.filter[_ngcontent-%COMP%]{min-width:350px}.search-select[_ngcontent-%COMP%]{width:32%;margin-right:20px;margin-top:30px}.toggle[_ngcontent-%COMP%]{display:flex;flex-direction:column}.advanced-filter[_ngcontent-%COMP%]{border:1px solid #d3d3d3;padding:15px}"]}),t})();var Ks=i(95142);function ta(t,e){if(1&t){const t=p.EpF();p.TgZ(0,"th",20),p.TgZ(1,"mat-checkbox",21),p.NdJ("change",function(e){p.CHM(t);const i=p.oxw();return e?i.masterToggle():null}),p.qZA(),p.qZA()}if(2&t){const t=p.oxw();p.xp6(1),p.Q6J("aria-label",t.checkboxLabel())("checked",t.selection.hasValue()&&t.isAllSelected())("indeterminate",t.selection.hasValue()&&!t.isAllSelected())}}function ea(t,e){if(1&t){const t=p.EpF();p.TgZ(0,"td",22),p.TgZ(1,"mat-checkbox",23),p.NdJ("change",function(e){const i=p.CHM(t).$implicit,s=p.oxw();return e?s.selection.toggle(i):null})("click",function(t){return t.stopPropagation()}),p.qZA(),p.qZA()}if(2&t){const t=e.$implicit,i=p.oxw();p.xp6(1),p.Q6J("aria-label",i.checkboxLabel(t))("checked",i.selection.isSelected(t))}}function ia(t,e){1&t&&(p.TgZ(0,"th",24),p._uU(1),p.ALo(2,"translate"),p.qZA()),2&t&&(p.xp6(1),p.Oqu(p.lcZ(2,1,"SHARED_LIB.PERUN.COMPONENTS.TASK_RESULTS_LIST.RESULT_ID")))}function sa(t,e){if(1&t&&(p.TgZ(0,"td",25),p._uU(1),p.qZA()),2&t){const t=e.$implicit;p.xp6(1),p.Oqu(t.id)}}function aa(t,e){1&t&&(p.TgZ(0,"th",24),p._uU(1),p.ALo(2,"translate"),p.qZA()),2&t&&(p.xp6(1),p.Oqu(p.lcZ(2,1,"SHARED_LIB.PERUN.COMPONENTS.TASK_RESULTS_LIST.DESTINATION")))}function na(t,e){if(1&t&&(p.TgZ(0,"td",25),p._uU(1),p.qZA()),2&t){const t=e.$implicit;p.xp6(1),p.Oqu(t.destination.destination)}}function la(t,e){1&t&&(p.TgZ(0,"th",24),p._uU(1),p.ALo(2,"translate"),p.qZA()),2&t&&(p.xp6(1),p.Oqu(p.lcZ(2,1,"SHARED_LIB.PERUN.COMPONENTS.TASK_RESULTS_LIST.TYPE")))}function oa(t,e){if(1&t&&(p.TgZ(0,"td",25),p._uU(1),p.qZA()),2&t){const t=e.$implicit;p.xp6(1),p.Oqu(t.destination.type.toUpperCase())}}function ca(t,e){1&t&&(p.TgZ(0,"th",24),p._uU(1),p.ALo(2,"translate"),p.qZA()),2&t&&(p.xp6(1),p.Oqu(p.lcZ(2,1,"SHARED_LIB.PERUN.COMPONENTS.TASK_RESULTS_LIST.SERVICE")))}function ra(t,e){if(1&t&&(p.TgZ(0,"td",25),p._uU(1),p.qZA()),2&t){const t=e.$implicit;p.xp6(1),p.Oqu(t.service.name)}}function da(t,e){1&t&&(p.TgZ(0,"th",24),p._uU(1),p.ALo(2,"translate"),p.qZA()),2&t&&(p.xp6(1),p.Oqu(p.lcZ(2,1,"SHARED_LIB.PERUN.COMPONENTS.TASK_RESULTS_LIST.STATUS")))}function ua(t,e){if(1&t&&(p.TgZ(0,"td",25),p._uU(1),p.qZA()),2&t){const t=e.$implicit;p.xp6(1),p.Oqu(t.status)}}function ha(t,e){1&t&&(p.TgZ(0,"th",24),p._uU(1),p.ALo(2,"translate"),p.qZA()),2&t&&(p.xp6(1),p.Oqu(p.lcZ(2,1,"SHARED_LIB.PERUN.COMPONENTS.TASK_RESULTS_LIST.TIME")))}function pa(t,e){if(1&t&&(p.TgZ(0,"td",25),p._uU(1),p.ALo(2,"date"),p.qZA()),2&t){const t=e.$implicit;p.xp6(1),p.Oqu(p.xi3(2,1,t.timestamp,"d.M.y H:mm:ss"))}}function ga(t,e){1&t&&(p.TgZ(0,"th",24),p._uU(1),p.ALo(2,"translate"),p.qZA()),2&t&&(p.xp6(1),p.Oqu(p.lcZ(2,1,"SHARED_LIB.PERUN.COMPONENTS.TASK_RESULTS_LIST.RETURN_CODE")))}function fa(t,e){if(1&t&&(p.TgZ(0,"td",25),p._uU(1),p.qZA()),2&t){const t=e.$implicit;p.xp6(1),p.Oqu(t.returnCode)}}function ma(t,e){1&t&&(p.TgZ(0,"th",24),p._uU(1),p.ALo(2,"translate"),p.qZA()),2&t&&(p.xp6(1),p.Oqu(p.lcZ(2,1,"SHARED_LIB.PERUN.COMPONENTS.TASK_RESULTS_LIST.STANDARD_MESSAGE")))}function Aa(t,e){if(1&t&&(p.TgZ(0,"span"),p._uU(1),p._UZ(2,"br"),p.qZA()),2&t){const t=e.$implicit;p.xp6(1),p.Oqu(t)}}function Ia(t,e){if(1&t&&(p.TgZ(0,"td",25),p.YNc(1,Aa,3,1,"span",26),p.qZA()),2&t){const t=e.$implicit;p.xp6(1),p.Q6J("ngForOf",t.standardMessage.split("\n"))}}function Sa(t,e){1&t&&(p.TgZ(0,"th",24),p._uU(1),p.ALo(2,"translate"),p.qZA()),2&t&&(p.xp6(1),p.Oqu(p.lcZ(2,1,"SHARED_LIB.PERUN.COMPONENTS.TASK_RESULTS_LIST.ERROR_MESSAGE")))}function Ta(t,e){if(1&t&&(p.TgZ(0,"td",25),p._uU(1),p.qZA()),2&t){const t=e.$implicit;p.xp6(1),p.Oqu(t.errorMessage)}}function ba(t,e){1&t&&p._UZ(0,"tr",27)}function Ea(t,e){if(1&t&&p._UZ(0,"tr",28),2&t){const t=e.$implicit;p.ekj("greenTableItem","DONE"===t.status)("redTableItem","ERROR"===t.status||"DENIED"===t.status)("yellowTableItem","WARNING"===t.status)}}function Za(t,e){1&t&&(p.TgZ(0,"app-alert",29),p._uU(1),p.ALo(2,"translate"),p.qZA()),2&t&&(p.xp6(1),p.hij(" ",p.lcZ(2,1,"SHARED_LIB.UI.ALERTS.NO_FILTER_RESULTS_ALERT"),"\n"))}function Ca(t,e){1&t&&(p.TgZ(0,"app-alert",29),p._uU(1),p.ALo(2,"translate"),p.qZA()),2&t&&(p.xp6(1),p.hij(" ",p.lcZ(2,1,"SHARED_LIB.PERUN.COMPONENTS.TASK_RESULTS_LIST.NO_RESULTS_WARNING"),"\n"))}let va=(()=>{class t{constructor(t,e){this.authResolver=t,this.tableCheckbox=e,this.pageSizeOptions=r.f7,this.taskResults=[],this.selection=new vt.Ov(!0,[]),this.displayedColumns=["select","id","destination","type","service","status","time","returnCode","standardMessage","errorMessage"]}set matSort(t){this.sort=t,this.setDataSource()}ngOnChanges(){this.authResolver.isPerunAdminOrObserver()||(this.displayedColumns=this.displayedColumns.filter(t=>"id"!==t)),this.dataSource=new se.by(this.taskResults),this.setDataSource(),this.dataSource.filter=this.filterValue}getDataForColumn(t,e){switch(e){case"id":return t.id.toString();case"destination":return t.destination.destination;case"type":return t.destination.type;case"service":return t.service.name;case"status":return t.status;case"time":return(0,s.p6)(t.timestamp.toString(),"d.M.y H:mm:ss","en");case"returnCode":return t.returnCode.toString();case"standardMessage":return t.standardMessage;case"errorMessage":return t.errorMessage;default:return""}}getSortDataForColumn(t,e){switch(e){case"id":return t.id.toString();case"destination":return t.destination.destination;case"type":return t.destination.type;case"service":return t.service.name;case"status":return t.status;case"time":return(0,s.p6)(t.timestamp.toString(),"yyyy.MM.dd HH:mm:ss","en");case"returnCode":return t.returnCode.toString();case"standardMessage":return t.standardMessage;case"errorMessage":return t.errorMessage;default:return""}}exportData(t){(0,r.O6)((0,r.Xn)(this.dataSource.filteredData,this.displayedColumns,this.getDataForColumn,this),t)}setDataSource(){this.dataSource&&(this.dataSource.sort=this.sort,this.dataSource.paginator=this.child.paginator,this.dataSource.filter=this.filterValue,this.dataSource.filterPredicate=(t,e)=>(0,r.Sd)(t,e,this.displayedColumns,this.getDataForColumn,this),this.dataSource.sortData=(t,e)=>(0,r.pR)(t,e,this.getSortDataForColumn,this))}isAllSelected(){return this.tableCheckbox.isAllSelected(this.selection.selected.length,this.filterValue,this.child.paginator.pageSize,this.child.paginator.hasNextPage(),this.dataSource)}masterToggle(){this.tableCheckbox.masterToggle(this.isAllSelected(),this.selection,this.filterValue,this.dataSource,this.sort,this.child.paginator.pageSize,this.child.paginator.pageIndex,!1)}checkboxLabel(t){return t?`${this.selection.isSelected(t)?"deselect":"select"} row ${t.id+1}`:(this.isAllSelected()?"select":"deselect")+" all"}ngAfterViewInit(){this.dataSource.paginator=this.child.paginator}}return t.\u0275fac=function(e){return new(e||t)(p.Y36(d.x4),p.Y36(d.UA))},t.\u0275cmp=p.Xpm({type:t,selectors:[["perun-web-apps-task-results-list"]],viewQuery:function(t,e){if(1&t&&(p.Gf(Le.YE,7),p.Gf(r.l9,7)),2&t){let t;p.iGM(t=p.CRH())&&(e.matSort=t.first),p.iGM(t=p.CRH())&&(e.child=t.first)}},inputs:{taskResults:"taskResults",selection:"selection",filterValue:"filterValue",tableId:"tableId",displayedColumns:"displayedColumns"},features:[p.TTD],decls:37,vars:9,consts:[[1,"card","mt-3",3,"hidden"],[3,"tableId","dataLength","pageSizeOptions","exportData"],["mat-table","","matSort","","matSortActive","time","matSortDirection","desc","matSortDisableClear","",1,"w-100",3,"dataSource"],["matColumnDef","select"],["mat-header-cell","","class","align-checkbox",4,"matHeaderCellDef"],["class","static-column-size align-checkbox","mat-cell","",4,"matCellDef"],["matColumnDef","id"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["class","static-column-size","mat-cell","",4,"matCellDef"],["matColumnDef","destination"],["matColumnDef","type"],["matColumnDef","service"],["matColumnDef","status"],["matColumnDef","time"],["matColumnDef","returnCode"],["matColumnDef","standardMessage"],["matColumnDef","errorMessage"],["mat-header-row","",4,"matHeaderRowDef"],["class","dark-hover-list-item","mat-row","",3,"greenTableItem","redTableItem","yellowTableItem",4,"matRowDef","matRowDefColumns"],["alert_type","warn",4,"ngIf"],["mat-header-cell","",1,"align-checkbox"],["color","primary",3,"aria-label","checked","indeterminate","change"],["mat-cell","",1,"static-column-size","align-checkbox"],["color","primary",3,"aria-label","checked","change","click"],["mat-header-cell","","mat-sort-header",""],["mat-cell","",1,"static-column-size"],[4,"ngFor","ngForOf"],["mat-header-row",""],["mat-row","",1,"dark-hover-list-item"],["alert_type","warn"]],template:function(t,e){1&t&&(p.TgZ(0,"div",0),p.TgZ(1,"perun-web-apps-table-wrapper",1),p.NdJ("exportData",function(t){return e.exportData(t)}),p.TgZ(2,"table",2),p.ynx(3,3),p.YNc(4,ta,2,3,"th",4),p.YNc(5,ea,2,2,"td",5),p.BQk(),p.ynx(6,6),p.YNc(7,ia,3,3,"th",7),p.YNc(8,sa,2,1,"td",8),p.BQk(),p.ynx(9,9),p.YNc(10,aa,3,3,"th",7),p.YNc(11,na,2,1,"td",8),p.BQk(),p.ynx(12,10),p.YNc(13,la,3,3,"th",7),p.YNc(14,oa,2,1,"td",8),p.BQk(),p.ynx(15,11),p.YNc(16,ca,3,3,"th",7),p.YNc(17,ra,2,1,"td",8),p.BQk(),p.ynx(18,12),p.YNc(19,da,3,3,"th",7),p.YNc(20,ua,2,1,"td",8),p.BQk(),p.ynx(21,13),p.YNc(22,ha,3,3,"th",7),p.YNc(23,pa,3,4,"td",8),p.BQk(),p.ynx(24,14),p.YNc(25,ga,3,3,"th",7),p.YNc(26,fa,2,1,"td",8),p.BQk(),p.ynx(27,15),p.YNc(28,ma,3,3,"th",7),p.YNc(29,Ia,2,1,"td",8),p.BQk(),p.ynx(30,16),p.YNc(31,Sa,3,3,"th",7),p.YNc(32,Ta,2,1,"td",8),p.BQk(),p.YNc(33,ba,1,0,"tr",17),p.YNc(34,Ea,1,6,"tr",18),p.qZA(),p.qZA(),p.qZA(),p.YNc(35,Za,3,3,"app-alert",19),p.YNc(36,Ca,3,3,"app-alert",19)),2&t&&(p.Q6J("hidden",0===e.dataSource.filteredData.length||0===e.taskResults.length),p.xp6(1),p.Q6J("tableId",e.tableId)("dataLength",e.dataSource.filteredData.length)("pageSizeOptions",e.pageSizeOptions),p.xp6(1),p.Q6J("dataSource",e.dataSource),p.xp6(31),p.Q6J("matHeaderRowDef",e.displayedColumns),p.xp6(1),p.Q6J("matRowDefColumns",e.displayedColumns),p.xp6(1),p.Q6J("ngIf",0===e.dataSource.filteredData.length&&0!==e.taskResults.length),p.xp6(1),p.Q6J("ngIf",0===e.taskResults.length))},directives:[xe.l,se.BZ,Le.YE,se.w1,se.fO,se.Dz,se.as,se.nj,s.O5,se.ge,nt.oG,se.ev,Le.nU,s.sg,se.XQ,se.Gk,Vt.w],pipes:[E.X$,s.uU],styles:[".greenTableItem[_ngcontent-%COMP%]{background-color:#c4ffcb}.yellowTableItem[_ngcontent-%COMP%]{background-color:#fffde7}.redTableItem[_ngcontent-%COMP%]{background-color:#ffcdd2}"]}),t})();function _a(t,e){if(1&t){const t=p.EpF();p.TgZ(0,"button",7),p.NdJ("click",function(){return p.CHM(t),p.oxw().removeTaskResult()}),p._uU(1),p.ALo(2,"translate"),p.qZA()}if(2&t){const t=p.oxw();p.Q6J("disabled",0===t.selection.selected.length),p.xp6(1),p.hij(" ",p.lcZ(2,2,"FACILITY_DETAIL.TASK_RESULTS.REMOVE"),"\n")}}function ya(t,e){1&t&&p._UZ(0,"mat-spinner",8)}function Oa(t,e){if(1&t&&p._UZ(0,"perun-web-apps-task-results-list",9),2&t){const t=p.oxw();p.Q6J("tableId",t.tableId)("displayedColumns",t.displayedColumns)("filterValue",t.filterValue)("selection",t.selection)("taskResults",t.taskResults)}}let La=(()=>{class t{constructor(t,e,i,s,a){this.route=t,this.taskManager=e,this.authResolver=i,this.dialog=s,this.entityStorageService=a,this.loading=!1,this.filterValue="",this.selection=new vt.Ov(!0,[]),this.task={id:0},this.tableId=Ct.e5,this.displayedColumns=["select","id","destination","type","service","status","time","returnCode","standardMessage","errorMessage"],this.removeAuth=!1}ngOnInit(){this.loading=!0,this.facility=this.entityStorageService.getEntity(),this.removeAuth=this.authResolver.isAuthorized("deleteTask_Task_policy",[this.facility]),this.removeAuth||(this.displayedColumns=["id","destination","type","service","status","time","returnCode","standardMessage","errorMessage"]),this.route.params.subscribe(t=>{this.taskId=t.taskId,this.taskManager.getTaskById(this.taskId).subscribe(t=>{this.task=t,this.refreshTable()})})}refreshTable(){this.loading=!0,this.taskManager.getTaskResultsForGUIByTask(this.taskId).subscribe(t=>{this.selection.clear(),this.taskResults=t,this.loading=!1})}removeTaskResult(){const t=(0,r.kZ)();t.width="600px",t.data={theme:"facility-theme",taskResults:this.selection.selected},this.dialog.open(Gi,t).afterClosed().subscribe(t=>{t&&this.refreshTable()})}applyFilter(t){this.filterValue=t}}return t.\u0275fac=function(e){return new(e||t)(p.Y36(a.gz),p.Y36(c.Ob),p.Y36(d.x4),p.Y36(g.uw),p.Y36(d.fb))},t.\u0275cmp=p.Xpm({type:t,selectors:[["app-facility-task-results"]],decls:10,vars:9,consts:[[1,"page-subtitle"],[1,"text-muted"],[3,"refresh"],["class","mr-2","color","warn","mat-flat-button","",3,"disabled","click",4,"ngIf"],[3,"placeholder","filter"],["class","ml-auto mr-auto",4,"ngIf"],[3,"tableId","displayedColumns","filterValue","selection","taskResults",4,"ngIf"],["color","warn","mat-flat-button","",1,"mr-2",3,"disabled","click"],[1,"ml-auto","mr-auto"],[3,"tableId","displayedColumns","filterValue","selection","taskResults"]],template:function(t,e){1&t&&(p.TgZ(0,"h1",0),p._uU(1),p.ALo(2,"translate"),p.TgZ(3,"span",1),p._uU(4),p.qZA(),p.qZA(),p.TgZ(5,"perun-web-apps-refresh-button",2),p.NdJ("refresh",function(){return e.refreshTable()}),p.qZA(),p.YNc(6,_a,3,4,"button",3),p.TgZ(7,"perun-web-apps-immediate-filter",4),p.NdJ("filter",function(t){return e.applyFilter(t)}),p.qZA(),p.YNc(8,ya,1,0,"mat-spinner",5),p.YNc(9,Oa,1,5,"perun-web-apps-task-results-list",6)),2&t&&(p.xp6(1),p.AsE("",p.lcZ(2,7,"FACILITY_DETAIL.TASK_RESULTS.TITLE")," - ",e.task.service?e.task.service.name:""," "),p.xp6(3),p.hij(" \xa0#",e.task.id," "),p.xp6(2),p.Q6J("ngIf",e.removeAuth),p.xp6(1),p.Q6J("placeholder","FACILITY_DETAIL.TASK_RESULTS.FILTER"),p.xp6(1),p.Q6J("ngIf",e.loading),p.xp6(1),p.Q6J("ngIf",!e.loading))},directives:[Jt.t,s.O5,Qt.L,b.lW,A.$g,va],pipes:[E.X$],styles:[""]}),t})();var xa=i(53134);let Na=(()=>{class t{constructor(t,e){this.dialogRef=t,this.data=e,this.theme=""}ngOnInit(){this.theme=this.data.theme}onCancel(){this.dialogRef.close(!1)}onSkip(){this.dialogRef.close(!0)}}return t.\u0275fac=function(e){return new(e||t)(p.Y36(g.so),p.Y36(g.WI))},t.\u0275cmp=p.Xpm({type:t,selectors:[["app-no-service-dialog"]],decls:14,vars:15,consts:[["mat-dialog-title",""],["mat-dialog-content",""],["matDialogActions",""],["mat-flat-button","",1,"ml-auto","mr-2",3,"click"],["color","accent","mat-flat-button","",3,"click"]],template:function(t,e){1&t&&(p.TgZ(0,"div"),p.TgZ(1,"h1",0),p._uU(2),p.ALo(3,"translate"),p.qZA(),p.TgZ(4,"div",1),p._uU(5),p.ALo(6,"translate"),p.qZA(),p.TgZ(7,"div",2),p.TgZ(8,"button",3),p.NdJ("click",function(){return e.onCancel()}),p._uU(9),p.ALo(10,"translate"),p.qZA(),p.TgZ(11,"button",4),p.NdJ("click",function(){return e.onSkip()}),p._uU(12),p.ALo(13,"translate"),p.qZA(),p.qZA(),p.qZA()),2&t&&(p.Tol(e.theme),p.xp6(2),p.Oqu(p.lcZ(3,7,"DIALOGS.NO_SERVICE.TITLE")),p.xp6(3),p.hij(" ",p.lcZ(6,9,"DIALOGS.NO_SERVICE.INFO")," "),p.xp6(4),p.hij(" ",p.lcZ(10,11,"DIALOGS.NO_SERVICE.CANCEL")," "),p.xp6(3),p.hij(" ",p.lcZ(13,13,"DIALOGS.NO_SERVICE.SKIP")," "))},directives:[g.uh,g.xY,g.H8,b.lW],pipes:[E.X$],styles:[""]}),t})(),Ra=(()=>{class t{constructor(t,e){this.dialogRef=t,this.data=e,this.theme=""}ngOnInit(){this.theme=this.data.theme}onCancel(){this.dialogRef.close(!1)}onSkip(){this.dialogRef.close(!0)}}return t.\u0275fac=function(e){return new(e||t)(p.Y36(g.so),p.Y36(g.WI))},t.\u0275cmp=p.Xpm({type:t,selectors:[["app-config-unsaved-dialog"]],decls:14,vars:15,consts:[["mat-dialog-title",""],["mat-dialog-content",""],["matDialogActions",""],["mat-flat-button","",1,"ml-auto","mr-2",3,"click"],["color","accent","mat-flat-button","",3,"click"]],template:function(t,e){1&t&&(p.TgZ(0,"div"),p.TgZ(1,"h1",0),p._uU(2),p.ALo(3,"translate"),p.qZA(),p.TgZ(4,"div",1),p._uU(5),p.ALo(6,"translate"),p.qZA(),p.TgZ(7,"div",2),p.TgZ(8,"button",3),p.NdJ("click",function(){return e.onCancel()}),p._uU(9),p.ALo(10,"translate"),p.qZA(),p.TgZ(11,"button",4),p.NdJ("click",function(){return e.onSkip()}),p._uU(12),p.ALo(13,"translate"),p.qZA(),p.qZA(),p.qZA()),2&t&&(p.Tol(e.theme),p.xp6(2),p.Oqu(p.lcZ(3,7,"DIALOGS.CONFIG_UNSAVED.TITLE")),p.xp6(3),p.hij(" ",p.lcZ(6,9,"DIALOGS.CONFIG_UNSAVED.INFO")," "),p.xp6(4),p.hij(" ",p.lcZ(10,11,"DIALOGS.CONFIG_UNSAVED.CANCEL")," "),p.xp6(3),p.hij(" ",p.lcZ(13,13,"DIALOGS.CONFIG_UNSAVED.SKIP")," "))},directives:[g.uh,g.xY,g.H8,b.lW],pipes:[E.X$],styles:[""]}),t})();function Da(t,e){if(1&t&&(p.TgZ(0,"div",3),p._UZ(1,"i",4),p.ALo(2,"translate"),p.qZA()),2&t){const t=p.oxw();p.xp6(1),p.Q6J("innerHTML",p.lcZ(2,1,t.info),p.oJD)}}function wa(t,e){if(1&t){const t=p.EpF();p.TgZ(0,"button",9),p.NdJ("click",function(){return p.CHM(t),p.oxw(2).onKeep()}),p._uU(1),p.ALo(2,"translate"),p.qZA()}2&t&&(p.xp6(1),p.hij(" ",p.lcZ(2,1,"DIALOGS.CANCEL_CONFIG.KEEP")," "))}function ka(t,e){if(1&t){const t=p.EpF();p.TgZ(0,"div",5),p.TgZ(1,"button",6),p.NdJ("click",function(){return p.CHM(t),p.oxw().onCancel()}),p._uU(2),p.ALo(3,"translate"),p.qZA(),p.TgZ(4,"button",7),p.NdJ("click",function(){return p.CHM(t),p.oxw().onDelete()}),p.TgZ(5,"mat-icon"),p._uU(6," warning "),p.qZA(),p._uU(7),p.ALo(8,"translate"),p.qZA(),p.YNc(9,wa,3,3,"button",8),p.qZA()}if(2&t){const t=p.oxw();p.xp6(2),p.hij(" ",p.lcZ(3,3,"DIALOGS.CANCEL_CONFIG.CANCEL")," "),p.xp6(5),p.hij(" ",p.lcZ(8,5,"DIALOGS.CANCEL_CONFIG.DELETE")," "),p.xp6(2),p.Q6J("ngIf",!t.lastStep)}}let Fa=(()=>{class t{constructor(t,e,i,s,a){this.dialogRef=t,this.data=e,this.facilityService=i,this.notificator=s,this.translate=a,this.theme="",this.title="",this.info="",this.loading=!1}ngOnInit(){this.theme=this.data.theme,this.lastStep=this.data.lastStep,this.lastStep?(this.title="DIALOGS.CANCEL_CONFIG.TITLE_COMPLETE",this.info="DIALOGS.CANCEL_CONFIG.INFO_COMPLETE"):(this.title="DIALOGS.CANCEL_CONFIG.TITLE_INCOMPLETE",this.info="DIALOGS.CANCEL_CONFIG.INFO_INCOMPLETE")}onCancel(){this.dialogRef.close(!1)}onDelete(){this.loading=!0,this.facilityService.deleteFacility(this.data.facilityId,!0).subscribe(()=>{this.notificator.showSuccess(this.translate.instant("DIALOGS.CANCEL_CONFIG.SUCCESS")),this.dialogRef.close(!0),this.loading=!1},()=>this.loading=!1)}onKeep(){this.dialogRef.close(!0)}}return t.\u0275fac=function(e){return new(e||t)(p.Y36(g.so),p.Y36(g.WI),p.Y36(c.IQ),p.Y36(d.V6),p.Y36(E.sK))},t.\u0275cmp=p.Xpm({type:t,selectors:[["app-cancel-configuration-dialog"]],decls:6,vars:8,consts:[["mat-dialog-title",""],["mat-dialog-content","",4,"ngIf"],["matDialogActions","",4,"ngIf"],["mat-dialog-content",""],[3,"innerHTML"],["matDialogActions",""],["mat-flat-button","",1,"mr-2",3,"click"],["color","warn","mat-flat-button","",1,"ml-auto","mr-2",3,"click"],["color","accent","mat-flat-button","",3,"click",4,"ngIf"],["color","accent","mat-flat-button","",3,"click"]],template:function(t,e){1&t&&(p.TgZ(0,"div"),p.TgZ(1,"h1",0),p._uU(2),p.ALo(3,"translate"),p.qZA(),p.YNc(4,Da,3,3,"div",1),p.YNc(5,ka,10,7,"div",2),p.qZA()),2&t&&(p.Tol(e.theme),p.xp6(2),p.Oqu(p.lcZ(3,6,e.title)),p.xp6(2),p.Q6J("ngIf",!e.loading),p.xp6(1),p.Q6J("ngIf",!e.loading))},directives:[g.uh,s.O5,g.xY,g.H8,b.lW,I.Hw],pipes:[E.X$],styles:[""]}),t})();var Ya=i(98470),Ua=i(70663),qa=i(65267),Ma=i(91721),Ja=i(45001);const Qa=["stepper"];function Va(t,e){1&t&&(p._uU(0),p.ALo(1,"translate")),2&t&&p.Oqu(p.lcZ(1,1,"FACILITY_CONFIGURATION.OWNERS"))}function Ha(t,e){if(1&t){const t=p.EpF();p.TgZ(0,"app-facility-settings-owners",14),p.NdJ("ownerEmitter",function(e){return p.CHM(t),p.oxw().owners=e}),p.qZA()}}function Pa(t,e){1&t&&(p._uU(0),p.ALo(1,"translate")),2&t&&p.Oqu(p.lcZ(1,1,"FACILITY_CONFIGURATION.HOSTS"))}function Ga(t,e){if(1&t){const t=p.EpF();p.TgZ(0,"app-facility-hosts",15),p.NdJ("hostEmitter",function(e){return p.CHM(t),p.oxw().hosts=e}),p.qZA()}2&t&&p.Q6J("disableRouting",!0)}function Ba(t,e){1&t&&(p._uU(0),p.ALo(1,"translate")),2&t&&p.Oqu(p.lcZ(1,1,"FACILITY_CONFIGURATION.SERVICES"))}const $a=function(){return["select","id","name","enabled","description"]};function ja(t,e){if(1&t){const t=p.EpF();p.TgZ(0,"h1",16),p._uU(1),p.ALo(2,"translate"),p.qZA(),p.TgZ(3,"app-alert",17),p._uU(4),p.ALo(5,"translate"),p.qZA(),p.TgZ(6,"div",18),p.TgZ(7,"perun-web-apps-immediate-filter",19),p.NdJ("filter",function(e){return p.CHM(t),p.oxw().applyFilter(e)}),p.qZA(),p.TgZ(8,"perun-web-apps-service-package-search-select",20),p.NdJ("packageSelected",function(e){return p.CHM(t),p.oxw().packagesSelected(e)}),p.qZA(),p.qZA(),p.TgZ(9,"app-services-list",21),p.NdJ("selectionChanged",function(){return p.CHM(t),p.oxw().singleServiceSelected()}),p.qZA()}if(2&t){const t=p.oxw();p.xp6(1),p.Oqu(p.lcZ(2,13,"FACILITY_CONFIGURATION.SERVICES")),p.xp6(3),p.hij(" ",p.lcZ(5,15,"FACILITY_CONFIGURATION.SERVICES_INFO")," "),p.xp6(3),p.Q6J("placeholder","FACILITY_CONFIGURATION.SERVICES_FILTER"),p.xp6(1),p.Q6J("servicePackages",t.servicePackages)("selectedPackage",t.selectedPackages)("multiple",!0)("disableAutoSelect",!0)("theme","facility-theme"),p.xp6(1),p.Q6J("disableRouting",!0)("selection",t.selection)("services",t.services)("filterValue",t.filterValue)("displayedColumns",p.DdM(17,$a))}}function za(t,e){1&t&&(p._uU(0),p.ALo(1,"translate")),2&t&&p.Oqu(p.lcZ(1,1,"FACILITY_CONFIGURATION.SERVICE_CONFIG"))}function Xa(t,e){if(1&t){const t=p.EpF();p.TgZ(0,"perun-web-apps-service-search-select",27),p.NdJ("serviceSelected",function(e){return p.CHM(t),p.oxw(2).filterAttributes(e)}),p.qZA()}if(2&t){const t=p.oxw(2);p.Q6J("disableAutoSelect",!0)("services",t.selection.selected)("multiple",!0)("theme","facility-theme")}}function Wa(t,e){1&t&&p._UZ(0,"mat-spinner",28)}function Ka(t,e){if(1&t&&p._UZ(0,"perun-web-apps-attributes-list",29),2&t){const t=p.oxw(2);p.Q6J("emptyListText","FACILITY_CONFIGURATION.EMPTY_REQ_ATT")("selection",t.attSelection)("attributes",t.filteredAttributes)}}function tn(t,e){if(1&t){const t=p.EpF();p.TgZ(0,"h1",16),p._uU(1),p.ALo(2,"translate"),p.qZA(),p.TgZ(3,"app-alert",17),p._uU(4),p.ALo(5,"translate"),p.qZA(),p.TgZ(6,"div",18),p.TgZ(7,"button",22),p.NdJ("click",function(){return p.CHM(t),p.oxw().onRemoveAttributes()}),p._uU(8),p.ALo(9,"translate"),p.qZA(),p.TgZ(10,"button",23),p.NdJ("click",function(){return p.CHM(t),p.oxw().onSaveAttributes()}),p._uU(11),p.ALo(12,"translate"),p.qZA(),p.YNc(13,Xa,1,4,"perun-web-apps-service-search-select",24),p.qZA(),p.YNc(14,Wa,1,0,"mat-spinner",25),p.YNc(15,Ka,1,3,"perun-web-apps-attributes-list",26)}if(2&t){const t=p.oxw(),e=p.MAs(5);p.xp6(1),p.Oqu(p.lcZ(2,9,"FACILITY_CONFIGURATION.SERVICE_CONFIG")),p.xp6(3),p.hij(" ",p.lcZ(5,11,"FACILITY_CONFIGURATION.ATT_INFO")," "),p.xp6(3),p.Q6J("disabled",0===t.attSelection.selected.length),p.xp6(1),p.hij(" ",p.lcZ(9,13,"FACILITY_CONFIGURATION.REMOVE")," "),p.xp6(2),p.Q6J("disabled",0===t.attSelection.selected.length),p.xp6(1),p.hij(" ",p.lcZ(12,15,"FACILITY_CONFIGURATION.SAVE")," "),p.xp6(2),p.Q6J("ngIf",e.selectedIndex===t.ATTRIBUTES_IDX),p.xp6(1),p.Q6J("ngIf",t.processing),p.xp6(1),p.Q6J("ngIf",!t.processing)}}function en(t,e){1&t&&(p._uU(0),p.ALo(1,"translate")),2&t&&p.Oqu(p.lcZ(1,1,"FACILITY_CONFIGURATION.DESTINATION_CONFIG"))}const sn=function(){return["select","destinationId","service","warn","destination","type","propagationType"]};function an(t,e){if(1&t){const t=p.EpF();p.TgZ(0,"app-perun-web-apps-facility-services-destinations",30),p.NdJ("destinationEmitter",function(e){return p.CHM(t),p.oxw().destinations=e}),p.qZA()}if(2&t){const t=p.oxw();p.Q6J("title","FACILITY_CONFIGURATION.DESTINATION_CONFIG")("loading",t.processing)("displayedColumns",p.DdM(5,sn))("configServices",t.selection.selected)("configServicesIds",t.serviceIds)}}function nn(t,e){1&t&&(p._uU(0),p.ALo(1,"translate")),2&t&&p.Oqu(p.lcZ(1,1,"FACILITY_CONFIGURATION.MANAGERS"))}function ln(t,e){1&t&&p._UZ(0,"app-perun-web-apps-facility-settings-managers",31),2&t&&p.Q6J("disableRouting",!0)("disableSelf",!0)}function on(t,e){1&t&&(p._uU(0),p.ALo(1,"translate")),2&t&&p.Oqu(p.lcZ(1,1,"FACILITY_CONFIGURATION.SUMMARY"))}function cn(t,e){1&t&&p._UZ(0,"mat-spinner",28)}const rn=function(){return["id","name","contact","type"]};function dn(t,e){if(1&t&&p._UZ(0,"perun-web-apps-owners-list",48),2&t){const t=p.oxw(3);p.Q6J("owners",t.owners)("displayedColumns",p.DdM(2,rn))}}function un(t,e){1&t&&p._UZ(0,"mat-spinner",28)}const hn=function(){return["id","name"]};function pn(t,e){if(1&t&&p._UZ(0,"app-hosts-list",49),2&t){const t=p.oxw(3);p.Q6J("disableRouting",!0)("hosts",t.hosts)("displayedColumns",p.DdM(3,hn))}}function gn(t,e){1&t&&p._UZ(0,"mat-spinner",28)}const fn=function(){return["id","name","enabled","script","description"]},mn=function(){return["id","displayName","value","description"]},An=function(){return["destinationId","service","warn","destination","type","propagationType"]},In=function(){return["id","name","email","logins","organization"]},Sn=function(){return["id","vo","name","description"]};function Tn(t,e){if(1&t){const t=p.EpF();p.TgZ(0,"mat-accordion"),p.TgZ(1,"mat-expansion-panel",34),p.TgZ(2,"mat-expansion-panel-header"),p.TgZ(3,"mat-panel-title"),p._UZ(4,"mat-icon",35),p._uU(5),p.ALo(6,"translate"),p.qZA(),p.qZA(),p.TgZ(7,"h1",16),p._uU(8),p.ALo(9,"translate"),p.qZA(),p.YNc(10,cn,1,0,"mat-spinner",25),p.YNc(11,dn,1,3,"perun-web-apps-owners-list",36),p.qZA(),p.TgZ(12,"mat-expansion-panel",34),p.TgZ(13,"mat-expansion-panel-header"),p.TgZ(14,"mat-panel-title"),p._UZ(15,"mat-icon",37),p._uU(16),p.ALo(17,"translate"),p.qZA(),p.qZA(),p.TgZ(18,"h1",16),p._uU(19),p.ALo(20,"translate"),p.qZA(),p.YNc(21,un,1,0,"mat-spinner",25),p.YNc(22,pn,1,4,"app-hosts-list",38),p.qZA(),p.TgZ(23,"mat-expansion-panel",34),p.TgZ(24,"mat-expansion-panel-header"),p.TgZ(25,"mat-panel-title"),p._UZ(26,"mat-icon",39),p._uU(27),p.ALo(28,"translate"),p.qZA(),p.qZA(),p.TgZ(29,"h1",16),p._uU(30),p.ALo(31,"translate"),p.qZA(),p._UZ(32,"app-services-list",40),p.qZA(),p.TgZ(33,"mat-expansion-panel",41),p.NdJ("opened",function(){return p.CHM(t),p.oxw(2).getNonEmptyAttributes()}),p.TgZ(34,"mat-expansion-panel-header"),p.TgZ(35,"mat-panel-title"),p._UZ(36,"mat-icon",37),p._uU(37),p.ALo(38,"translate"),p.qZA(),p.qZA(),p.TgZ(39,"h1",16),p._uU(40),p.ALo(41,"translate"),p.qZA(),p._UZ(42,"perun-web-apps-attributes-list",42),p.qZA(),p.TgZ(43,"mat-expansion-panel",43),p.NdJ("expandedChange",function(e){return p.CHM(t),p.oxw(2).destinationServiceMissing=e}),p.TgZ(44,"mat-expansion-panel-header"),p.TgZ(45,"mat-panel-title"),p._UZ(46,"mat-icon",44),p._uU(47),p.ALo(48,"translate"),p.qZA(),p.qZA(),p.TgZ(49,"h1",16),p._uU(50),p.ALo(51,"translate"),p.qZA(),p.YNc(52,gn,1,0,"mat-spinner",25),p._UZ(53,"app-perun-web-apps-destination-list",45),p.qZA(),p.TgZ(54,"mat-expansion-panel"),p.TgZ(55,"mat-expansion-panel-header"),p.TgZ(56,"mat-panel-title"),p._UZ(57,"mat-icon",46),p._uU(58),p.ALo(59,"translate"),p.qZA(),p.qZA(),p._UZ(60,"app-managers-page",47),p.qZA(),p.qZA()}if(2&t){const t=p.oxw(2);p.Q6J("@.disabled",!0),p.xp6(1),p.Q6J("disabled",0===t.owners.length),p.xp6(1),p.ekj("cursor-default",0===t.owners.length),p.xp6(3),p.hij(" ",p.lcZ(6,49,"FACILITY_CONFIGURATION.OWNERS")," "),p.xp6(3),p.Oqu(p.lcZ(9,51,"FACILITY_CONFIGURATION.OWNERS")),p.xp6(2),p.Q6J("ngIf",t.processing),p.xp6(1),p.Q6J("ngIf",!t.processing),p.xp6(1),p.Q6J("disabled",0===t.hosts.length),p.xp6(1),p.ekj("cursor-default",0===t.hosts.length),p.xp6(3),p.hij(" ",p.lcZ(17,53,"FACILITY_CONFIGURATION.HOSTS")," "),p.xp6(3),p.Oqu(p.lcZ(20,55,"FACILITY_CONFIGURATION.HOSTS")),p.xp6(2),p.Q6J("ngIf",t.processing),p.xp6(1),p.Q6J("ngIf",!t.processing),p.xp6(1),p.Q6J("disabled",0===t.selection.selected.length),p.xp6(1),p.ekj("cursor-default",0===t.selection.selected.length),p.xp6(3),p.hij(" ",p.lcZ(28,57,"FACILITY_CONFIGURATION.SERVICES")," "),p.xp6(3),p.Oqu(p.lcZ(31,59,"FACILITY_CONFIGURATION.SERVICES")),p.xp6(2),p.Q6J("disableRouting",!0)("services",t.selection.selected)("displayedColumns",p.DdM(71,fn)),p.xp6(1),p.Q6J("disabled",0===t.selection.selected.length),p.xp6(1),p.ekj("cursor-default",0===t.selection.selected.length),p.xp6(3),p.hij(" ",p.lcZ(38,61,"FACILITY_CONFIGURATION.SERVICE_CONFIG")," "),p.xp6(3),p.Oqu(p.lcZ(41,63,"FACILITY_CONFIGURATION.ATTS")),p.xp6(2),p.Q6J("displayedColumns",p.DdM(72,mn))("emptyListText","FACILITY_CONFIGURATION.EMPTY_REQ_ATT")("attributes",t.filteredAttributes),p.xp6(1),p.Q6J("expanded",t.destinationServiceMissing)("disabled",0===t.selection.selected.length&&0===t.destinations.length),p.xp6(1),p.ekj("cursor-default",0===t.selection.selected.length&&0===t.destinations.length),p.xp6(3),p.hij(" ",p.lcZ(48,65,"FACILITY_CONFIGURATION.DESTINATION_CONFIG")," "),p.xp6(3),p.Oqu(p.lcZ(51,67,"FACILITY_CONFIGURATION.DESTINATION")),p.xp6(2),p.Q6J("ngIf",t.processing),p.xp6(1),p.Q6J("destinations",t.destinations)("services",t.serviceIds)("displayedColumns",p.DdM(73,An)),p.xp6(5),p.hij(" ",p.lcZ(59,69,"FACILITY_CONFIGURATION.MANAGERS")," "),p.xp6(2),p.Q6J("complementaryObject",t.facility)("configMode",!0)("disableRouting",!0)("complementaryObjectType","Facility")("availableRoles",t.availableRoles)("displayedUserColumns",p.DdM(74,In))("displayedGroupColumns",p.DdM(75,Sn))}}function bn(t,e){if(1&t&&(p.TgZ(0,"app-alert",17),p._UZ(1,"i",32),p.ALo(2,"translate"),p.qZA(),p.YNc(3,Tn,61,76,"mat-accordion",33)),2&t){p.oxw();const t=p.MAs(5);p.xp6(1),p.Q6J("innerHTML",p.lcZ(2,2,"FACILITY_CONFIGURATION.SUMMARY_INFO"),p.oJD),p.xp6(2),p.Q6J("ngIf",t.selectedIndex===t.steps.length-1)}}function En(t,e){if(1&t){const t=p.EpF();p.TgZ(0,"button",50),p.NdJ("click",function(){return p.CHM(t),p.oxw().back()}),p._uU(1),p.ALo(2,"translate"),p.qZA()}2&t&&(p.xp6(1),p.hij(" ",p.lcZ(2,1,"FACILITY_CONFIGURATION.BACK")," "))}function Zn(t,e){if(1&t){const t=p.EpF();p.TgZ(0,"button",51),p.NdJ("click",function(){return p.CHM(t),p.oxw().next()}),p._uU(1),p.ALo(2,"translate"),p.qZA()}if(2&t){p.oxw();const t=p.MAs(5);p.ekj("mr-2",void 0!==t&&0!==t.selectedIndex)("ml-auto",!(void 0!==t&&0!==t.selectedIndex)),p.xp6(1),p.hij(" ",p.lcZ(2,5,"FACILITY_CONFIGURATION.NEXT")," ")}}function Cn(t,e){if(1&t){const t=p.EpF();p.TgZ(0,"button",52),p.NdJ("click",function(){return p.CHM(t),p.oxw().onFinish()}),p._uU(1),p.ALo(2,"translate"),p.qZA()}2&t&&(p.xp6(1),p.hij(" ",p.lcZ(2,1,"FACILITY_CONFIGURATION.FINISH")," "))}let vn=(()=>{class t{constructor(t,e,i,s,a,n,l,o,c,r){this.attributesManager=t,this.serviceManager=e,this.facilityService=i,this.cd=s,this.dialog=a,this.notificator=n,this.translate=l,this.router=o,this.guiAuthResolver=c,this.entityStorageService=r,this.processing=!1,this.allowNavigate=!1,this.attributes=[],this.attributeIds=new Set,this.filteredAttributes=[],this.attributesPerService=new Map,this.attSelection=new vt.Ov(!0,[]),this.services=[],this.serviceIds=new Set,this.servicesPerPackage=new Map,this.servicePackages=[],this.selectedPackages=[],this.selection=new vt.Ov(!0,[]),this.owners=[],this.hosts=[],this.destinations=[],this.destinationServiceMissing=!1,this.availableRoles=[],this.filterValue="",this.saveMsg="",this.removeMsg="",this.BEFORE_OPTIONAL_IDX=2,this.ATTRIBUTES_IDX=3,this.DESTINATIONS_IDX=4,this.AFTER_OPTIONAL_IDX=5,this.serviceControl=new et.NI(!1,et.kI.requiredTrue),this.attributesControl=new et.NI(!0,et.kI.requiredTrue),this.translate.get("FACILITY_CONFIGURATION.ATT_SAVED").subscribe(t=>this.saveMsg=t),this.translate.get("FACILITY_CONFIGURATION.ATT_REMOVED").subscribe(t=>this.removeMsg=t)}ngOnInit(){this.facility=this.entityStorageService.getEntity(),this.guiAuthResolver.assignAvailableRoles(this.availableRoles,"Facility"),this.serviceManager.getServicesPackages().subscribe(t=>{this.servicePackages=t,this.getServicePackageServices(t,0)})}ngAfterViewInit(){this.cd.detectChanges(),this.attSelection.changed.subscribe(()=>{this.attributesControl.setValue(0===this.attSelection.selected.length)})}onCancel(){const t=(0,r.kZ)();t.width="550px",t.data={facilityId:this.facility.id,lastStep:this.stepper.selectedIndex===this.stepper.steps.length-1,theme:"facility-theme"},this.dialog.open(Fa,t).afterClosed().subscribe(t=>{t&&(this.allowNavigate=!0,sessionStorage.removeItem("newFacilityId"),this.router.navigate(["facilities"],{queryParamsHandling:"merge"}))})}getServicePackageServices(t,e){e===t.length?this.serviceManager.getServices().subscribe(t=>{this.services=t}):this.serviceManager.getServicesFromServicesPackage(t[e].id).subscribe(i=>{this.servicesPerPackage.set(t[e].id,new Set([...i.map(t=>t.id)])),this.getServicePackageServices(t,e+1)})}getServiceRequiredAttributes(t,e){e!==t.length&&this.attributesManager.getRequiredAttributesDefinition(t[e].id).subscribe(i=>{i=i.filter(t=>this.attributeIds.has(t.id)),this.attributesPerService.set(t[e].id,i.map(t=>t.id)),this.getServiceRequiredAttributes(t,e+1)})}setServiceControl(){this.serviceControl.setValue(0!==this.selection.selected.length)}buildServiceSet(t){const e=new Set;return t.forEach(t=>{this.servicesPerPackage.get(t.id).forEach(t=>e.add(t))}),e}setDiff(t,e){return new Set([...t].filter(t=>!e.has(t)))}setIntersect(t,e){return new Set([...t].filter(t=>e.has(t)))}setSymDif(t,e){const i=this.buildServiceSet(t),s=this.buildServiceSet(e),a=this.setDiff(i,s),n=this.setDiff(s,i);return new Set([...a,...n])}filterService(t,e){const i=new Set;for(const s of e){const e=this.setIntersect(t,this.servicesPerPackage.get(s.id));0!==e.size&&e.forEach(t=>i.add(t))}return i}packageSelectionEqual(t){return t.length===this.selectedPackages.length&&(t.forEach(t=>{if(-1===this.selectedPackages.findIndex(e=>e.id===t.id))return!1}),!0)}packagesSelected(t){if(this.packageSelectionEqual(t))return;this.processing=!0;let e=new Set;if(t&&0!==t.length?e=this.setSymDif(this.selectedPackages,t):this.selectedPackages.forEach(t=>{this.servicesPerPackage.get(t.id).forEach(t=>e.add(t))}),0===e.size)return;const i=this.filterService(e,t.filter(t=>this.selectedPackages.findIndex(e=>e.id===t.id)<0)),s=this.filterService(e,this.selectedPackages.filter(e=>t.findIndex(t=>t.id===e.id)<0));for(const a of this.services)i.has(a.id)?this.selection.select(a):s.has(a.id)&&this.selection.deselect(a);this.selectedPackages=t,this.setServiceControl(),this.processing=!1}checkPackageComplete(){const t=[];for(const e of this.selectedPackages){let i=!0;for(const t of this.servicesPerPackage.get(e.id))if(-1===this.selection.selected.findIndex(e=>e.id===t)){i=!1;break}i&&t.push(e)}this.selectedPackages=t}singleServiceSelected(){this.setServiceControl(),this.processing||this.checkPackageComplete()}back(){this.stepper.selectedIndex<=this.BEFORE_OPTIONAL_IDX&&this.setServiceControl(),this.stepper.selectedIndex===this.AFTER_OPTIONAL_IDX&&0===this.selection.selected.length?this.stepper.selectedIndex=this.BEFORE_OPTIONAL_IDX:this.stepper.previous()}openSkipDialog(){const t=(0,r.kZ)();t.width="400px",t.data={theme:"facility-theme"},this.dialog.open(Na,t).afterClosed().subscribe(t=>{t&&(this.serviceControl.setValue(!0),this.stepper.selectedIndex=this.AFTER_OPTIONAL_IDX)})}getRequiredAttributes(){this.processing=!0,this.attributesManager.getRequiredAttributesFacilityServices(this.selection.selected.map(t=>t.id),this.facility.id).subscribe(t=>{this.attSelection.clear(),this.attributes=t.filter(t=>!(0,r.Hm)(t)),this.filteredAttributes=this.attributes,this.attributes.forEach(t=>this.attributeIds.add(t.id)),this.getServiceRequiredAttributes(this.selection.selected,0),this.processing=!1})}onSaveAttributes(){return new Promise((t,e)=>{this.processing=!0,this.attributesManager.setFacilityAttributes({facility:this.facility.id,attributes:this.attSelection.selected}).subscribe(()=>{this.notificator.showSuccess(this.saveMsg),this.attSelection.clear(),this.processing=!1,t()},()=>{this.processing=!1,e()})})}openUnsavedAttsDialog(){const t=(0,r.kZ)();t.width="400px",t.data={theme:"facility-theme"},this.dialog.open(Ra,t).afterClosed().subscribe(t=>{t&&this.onSaveAttributes().then(()=>{this.stepper.next()},()=>this.getRequiredAttributes())})}next(){this.checkDestinationDependency(this.stepper.selectedIndex),this.stepper.selectedIndex===this.BEFORE_OPTIONAL_IDX?0===this.selection.selected.length?this.openSkipDialog():(this.getRequiredAttributes(),this.stepper.next()):this.stepper.selectedIndex===this.ATTRIBUTES_IDX&&0!==this.attSelection.selected.length?this.openUnsavedAttsDialog():this.stepper.next()}onFinish(){this.allowNavigate=!0,sessionStorage.removeItem("newFacilityId"),this.router.navigate(["facilities",this.facility.id],{queryParamsHandling:"merge"})}onRemoveAttributes(){this.processing=!0;const t=this.attSelection.selected.map(t=>t.id);this.attributesManager.removeFacilityAttributes(this.facility.id,t).subscribe(()=>{this.notificator.showSuccess(this.removeMsg),this.getRequiredAttributes(),this.processing=!1})}filterAttributes(t){if(void 0===t||0===t.length)return void(this.filteredAttributes=this.attributes);const e=new Set;for(const i of t)this.attributesPerService.get(i.id).forEach(t=>e.add(t));this.filteredAttributes=[];for(const i of this.attributes)e.has(i.id)&&this.filteredAttributes.push(i)}getNonEmptyAttributes(){this.filteredAttributes=this.attributes.filter(t=>{if(t.value&&(!(0,Ya.k)(t.value)||0!==t.value.length))return t})}checkDestinationDependency(t){t!==this.BEFORE_OPTIONAL_IDX&&t!==this.DESTINATIONS_IDX||(this.serviceIds=new Set([...this.selection.selected.map(t=>t.id)]),this.destinationServicePresent())}navigationStep(t){this.checkDestinationDependency(t.previouslySelectedIndex),t.selectedIndex===this.ATTRIBUTES_IDX?this.getRequiredAttributes():t.selectedIndex===this.DESTINATIONS_IDX?this.processing=!1:t.selectedIndex<=this.BEFORE_OPTIONAL_IDX&&this.setServiceControl()}getOwners(){this.processing=!0,this.facilityService.getFacilityOwners(this.facility.id).subscribe(t=>{this.owners=t,this.processing=!1})}getHosts(){this.processing=!0,this.facilityService.getHosts(this.facility.id).subscribe(t=>{this.hosts=t,this.processing=!1})}applyFilter(t){this.filterValue=t}destinationServicePresent(){for(const t of this.destinations)if(!this.serviceIds.has(t.service.id))return void(this.destinationServiceMissing=!0);this.destinationServiceMissing=!1}canDeactivate(){return this.allowNavigate||this.onCancel(),this.allowNavigate}}return t.\u0275fac=function(e){return new(e||t)(p.Y36(c.H8),p.Y36(c.KK),p.Y36(c.IQ),p.Y36(p.sBO),p.Y36(g.uw),p.Y36(d.V6),p.Y36(E.sK),p.Y36(a.F0),p.Y36(d.x4),p.Y36(d.fb))},t.\u0275cmp=p.Xpm({type:t,selectors:[["app-facility-configuration-page"]],viewQuery:function(t,e){if(1&t&&p.Gf(Qa,5),2&t){let t;p.iGM(t=p.CRH())&&(e.stepper=t.first)}},decls:34,vars:15,consts:[[1,"facility-theme"],[1,"page-title"],[3,"linear","selectionChange"],["stepper",""],["matStepLabel",""],["matStepContent",""],[3,"stepControl"],["optional","true",3,"stepControl","editable"],[3,"optional","editable"],[1,"actions"],["mat-flat-button","",3,"click"],["class","ml-auto mr-2","mat-flat-button","",3,"click",4,"ngIf"],["mat-flat-button","","color","accent",3,"mr-2","ml-auto","click",4,"ngIf"],["class","mr-2","mat-flat-button","","color","accent",3,"click",4,"ngIf"],[3,"ownerEmitter"],[3,"disableRouting","hostEmitter"],[1,"page-subtitle"],["alert_type","info"],[1,"filters"],[1,"filter",3,"placeholder","filter"],[1,"package-search-select",3,"servicePackages","selectedPackage","multiple","disableAutoSelect","theme","packageSelected"],[3,"disableRouting","selection","services","filterValue","displayedColumns","selectionChanged"],["mat-flat-button","","color","warn",1,"mr-2",3,"disabled","click"],["mat-flat-button","","color","accent",1,"mr-2",3,"disabled","click"],["class","service-search-select",3,"disableAutoSelect","services","multiple","theme","serviceSelected",4,"ngIf"],["class","ml-auto mr-auto",4,"ngIf"],[3,"emptyListText","selection","attributes",4,"ngIf"],[1,"service-search-select",3,"disableAutoSelect","services","multiple","theme","serviceSelected"],[1,"ml-auto","mr-auto"],[3,"emptyListText","selection","attributes"],[3,"title","loading","displayedColumns","configServices","configServicesIds","destinationEmitter"],[3,"disableRouting","disableSelf"],[3,"innerHTML"],[4,"ngIf"],[3,"disabled"],["svgIcon","perun-owner-grey",1,"mr-2"],[3,"owners","displayedColumns",4,"ngIf"],["svgIcon","perun-hosts",1,"mr-2"],[3,"disableRouting","hosts","displayedColumns",4,"ngIf"],["svgIcon","perun-service",1,"mr-2"],[3,"disableRouting","services","displayedColumns"],[3,"disabled","opened"],[3,"displayedColumns","emptyListText","attributes"],[3,"expanded","disabled","expandedChange"],["svgIcon","perun-service_destination",1,"mr-2"],[3,"destinations","services","displayedColumns"],["svgIcon","perun-manager",1,"mr-2"],[3,"complementaryObject","configMode","disableRouting","complementaryObjectType","availableRoles","displayedUserColumns","displayedGroupColumns"],[3,"owners","displayedColumns"],[3,"disableRouting","hosts","displayedColumns"],["mat-flat-button","",1,"ml-auto","mr-2",3,"click"],["mat-flat-button","","color","accent",3,"click"],["mat-flat-button","","color","accent",1,"mr-2",3,"click"]],template:function(t,e){if(1&t&&(p.TgZ(0,"div",0),p.TgZ(1,"div",1),p._uU(2),p.ALo(3,"translate"),p.qZA(),p.TgZ(4,"mat-stepper",2,3),p.NdJ("selectionChange",function(t){return e.navigationStep(t)}),p.TgZ(6,"mat-step"),p.YNc(7,Va,2,3,"ng-template",4),p.YNc(8,Ha,1,0,"ng-template",5),p.qZA(),p.TgZ(9,"mat-step"),p.YNc(10,Pa,2,3,"ng-template",4),p.YNc(11,Ga,1,1,"ng-template",5),p.qZA(),p.TgZ(12,"mat-step",6),p.YNc(13,Ba,2,3,"ng-template",4),p.YNc(14,ja,10,18,"ng-template",5),p.qZA(),p.TgZ(15,"mat-step",7),p.YNc(16,za,2,3,"ng-template",4),p.YNc(17,tn,16,17,"ng-template",5),p.qZA(),p.TgZ(18,"mat-step",8),p.YNc(19,en,2,3,"ng-template",4),p.YNc(20,an,1,6,"ng-template",5),p.qZA(),p.TgZ(21,"mat-step"),p.YNc(22,nn,2,3,"ng-template",4),p.YNc(23,ln,1,2,"ng-template",5),p.qZA(),p.TgZ(24,"mat-step"),p.YNc(25,on,2,3,"ng-template",4),p.YNc(26,bn,4,4,"ng-template",5),p.qZA(),p.qZA(),p.TgZ(27,"div",9),p.TgZ(28,"button",10),p.NdJ("click",function(){return e.onCancel()}),p._uU(29),p.ALo(30,"translate"),p.qZA(),p.YNc(31,En,3,3,"button",11),p.YNc(32,Zn,3,7,"button",12),p.YNc(33,Cn,3,3,"button",13),p.qZA(),p.qZA()),2&t){const t=p.MAs(5);p.xp6(2),p.hij(" ",p.lcZ(3,11,"FACILITY_CONFIGURATION.TITLE")," "),p.xp6(2),p.Q6J("linear",!0),p.xp6(8),p.Q6J("stepControl",e.serviceControl),p.xp6(3),p.Q6J("stepControl",e.attributesControl)("editable",0!==e.selection.selected.length),p.xp6(3),p.Q6J("optional",0===e.destinations.length)("editable",0!==e.selection.selected.length||0!==e.destinations.length),p.xp6(11),p.hij(" ",p.lcZ(30,13,"FACILITY_CONFIGURATION.CANCEL")," "),p.xp6(2),p.Q6J("ngIf",void 0!==t&&0!==t.selectedIndex),p.xp6(1),p.Q6J("ngIf",void 0!==t&&t.selectedIndex!==t.steps.length-1),p.xp6(1),p.Q6J("ngIf",void 0!==t&&t.selectedIndex===t.steps.length-1)}},directives:[Ua.Vq,Ua.C0,Ua.VY,Ua.BY,b.lW,s.O5,fe,Be,Vt.w,Qt.L,qa.F,Ma.Q,Gs,A.$g,pi.p,Wt,Zt,Ja.pp,Ja.ib,Ja.yz,Ja.yK,I.Hw,Ht.q,Et.s,Kt.Q,Qe],pipes:[E.X$],styles:[".icon-scale[_ngcontent-%COMP%]{transform:scale(1.7);margin-left:.5rem;margin-top:-.6rem;margin-right:.9rem}.filters[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;align-items:baseline}.package-search-select[_ngcontent-%COMP%]{width:650px}.service-search-select[_ngcontent-%COMP%]{width:400px}.filter[_ngcontent-%COMP%]{width:350px;margin-right:20px}.actions[_ngcontent-%COMP%]{background-color:#fff;display:flex;padding:20px}.cursor-default[_ngcontent-%COMP%]{cursor:default}"]}),t})(),_n=(()=>{class t{constructor(t){this.router=t}canActivate(t){return t.parent.params.facilityId===sessionStorage.getItem("newFacilityId")||(this.router.navigate(["/home"],{queryParamsHandling:"merge"}),!1)}canDeactivate(t){return t.canDeactivate()}}return t.\u0275fac=function(e){return new(e||t)(p.LFG(a.F0))},t.\u0275prov=p.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();const yn=[{path:"",component:n.P},{path:":facilityId",component:L,children:[{path:"",component:D,data:{animation:"FacilityOverviewPage"}},{path:"attributes",component:z,data:{animation:"FacilityAttributesPage"}},{path:"resources",component:w.f,data:{animation:"FacilityResourcesPage"}},{path:"allowed-users",component:Ws,data:{animation:"FacilityAllowedUsersPage"}},{path:"allowed-groups",component:k.o,data:{animation:"FacilityAllowedGroupsPage"}},{path:"services-status",component:Us,data:{animation:"FacilityServiceStatusPage"}},{path:"services-status/:taskId",component:La,data:{animation:"FacilityTaskResultsPage"}},{path:"service-config",component:bt,data:{animation:"FacilityServiceConfigPage"}},{path:"services-destinations",component:Wt,data:{animation:"FacilityServicesDestinationsPage"}},{path:"hosts",component:Be,data:{animation:"FacilityHostsPage"}},{path:"hosts/:hostId",component:Ai,data:{animation:"FacilityHostsDetailPage"}},{path:"settings",component:U,children:[{path:"",component:J,data:{animation:"FacilitySettingsOverviewPage"}},{path:"owners",component:fe,data:{animation:"FacilitySettingOwnersPage"}},{path:"managers",component:Zt,data:{animation:"FacilitySettingsManagersPage"}},{path:"security-teams",component:Di,data:{animation:"FacilitySecurityTeamsPage"}},{path:"blacklist",component:ri,data:{animation:"FacilitySettingsBlackListPage"}}]},{path:"configuration",component:vn,canActivate:[_n],canDeactivate:[_n]}]},{path:":facilityId/resources/:resourceId",component:F.b,children:[{path:"",component:Y.H,data:{animation:"ResourceOverviewPage"}},{path:"attributes",component:K.X,data:{animation:"ResourceAttributesPage"}},{path:"groups",component:tt.K,data:{animation:"ResourceGroupsComponent"}},{path:"services",component:ki.D,data:{animation:"ResourceAssignedServicesComponent"}},{path:"members",component:Ks.y,data:{animation:"ResourceAssignedMembersComponent"}},{path:"tags",component:xa.v,data:{animation:"ResourceTagsComponent"}},{path:"settings",component:X.t,children:[{path:"",component:W.h,data:{animation:"ResourceSettingsOverviewPage"}},{path:"managers",component:wi.O,data:{animation:"ResourceSettingsManagersPage"}}]}]}];let On=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=p.oAB({type:t}),t.\u0275inj=p.cJS({imports:[[a.Bz.forChild(yn)],a.Bz]}),t})();var Ln=i(28780),xn=i(22727),Nn=i(65515),Rn=i(21781);let Dn=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=p.oAB({type:t}),t.\u0275inj=p.cJS({providers:[at.dp],imports:[[s.ez,On,Ln.m,xn.r,di.ez,at.d4,Nn.UsersModule,Rn.AdminModule]]}),t})()}}]);