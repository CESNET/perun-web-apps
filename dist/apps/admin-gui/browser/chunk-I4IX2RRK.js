import{Aa as E,Af as fe,B as Y,Ba as x,Bd as me,Bf as be,Cf as ge,Ch as Ae,Dj as we,Ej as ye,Hb as ie,Hg as P,Ia as T,Ib as ne,K as A,Kb as re,Ma as h,Mb as se,Na as f,O as b,P as g,Pe as ue,Qa as L,Rb as w,Rg as Se,Rh as y,Si as Ee,Vb as ae,Vg as Ce,Wa as B,Wb as oe,Wg as ve,Y as c,Ya as ee,Z as d,Zg as W,_ as Q,_d as _e,_e as de,ad as $,bc as U,ca as m,d as O,fa as a,ga as R,hg as k,i as Z,id as D,ja as p,ka as l,kd as le,kh as xe,la as v,ld as ce,m as J,oa as C,pa as _,ph as N,qa as o,qc as F,re as H,se as q,sh as Ie,te as z,ue as G,wb as te,x as K,xc as pe,y as X,ya as M,yh as j,za as S,zf as he}from"./chunk-NLN5OKUI.js";function We(e,s){e&1&&v(0,"perun-web-apps-loading-table")}function Ne(e,s){if(e&1){let t=C();p(0,"perun-web-apps-users-list",7),_("queryChanged",function(n){b(t);let r=o();return g(r.nextPage.next(n))})("downloadAll",function(n){b(t);let r=o();return g(r.downloadAll(n))}),h(1,"async"),h(2,"async"),l()}if(e&2){let t=o();a("loading",f(1,7,t.loading$))("users",f(2,9,t.usersPage$))("routeToAdmin",!0)("displayColumns",t.displayedColumns)("selection",t.selection)("filter",t.searchString)("tableId",t.tableId)}}var Tt=(()=>{let s=class s{constructor(i,n,r,u,I){this.storeService=i,this.cd=n,this.dialog=r,this.cacheHelperService=u,this.userManager=I,this.usersWithoutVo=!1,this.selection=new U(!0,[]),this.tableId=me,this.attributes=[],this.displayedColumns=["user","id","name","email","logins","organization"],this.nextPage=new O({}),this.usersPage$=this.nextPage.pipe(X(V=>this.userManager.getUsersPage({attrNames:this.attributes,query:{order:V.order,pageSize:V.pageSize,offset:V.offset,sortColumn:V.sortColumn,searchString:this.searchString,withoutVo:this.usersWithoutVo}})),Y(()=>{this.selection.clear(),setTimeout(()=>this.loadingSubject$.next(!1),200)}),K({data:[],totalCount:0,offset:0,pageSize:0})),this.loadingSubject$=new O(!1),this.loading$=J(this.loadingSubject$,this.nextPage.pipe(Z(()=>!0)))}ngOnInit(){this.attributes=[$.USER_DEF_ORGANIZATION,$.USER_DEF_PREFERRED_MAIL],this.attributes=this.attributes.concat(this.storeService.getLoginAttributeNames()),this.cacheHelperService.refreshComponentCachedData().subscribe(i=>{i&&this.refresh()})}filterSearchString(i){this.searchString=i,this.cd.detectChanges()}filterUserWithoutVO(){this.usersWithoutVo=!this.usersWithoutVo,this.refresh()}refresh(){this.nextPage.next(this.nextPage.value)}downloadAll(i){let n=this.nextPage.getValue(),r=D();r.width="300px";let u=this.dialog.open(Se,r);this.userManager.getUsersPage({attrNames:this.attributes,query:{order:n.order,pageSize:i.length,offset:0,sortColumn:n.sortColumn,searchString:n.searchString,withoutVo:this.usersWithoutVo}}).subscribe({next:I=>{u.close(),ce(le(I.data,this.displayedColumns,i.getDataForColumnFun),i.format)}})}};s.id="AdminUsersComponent",s.\u0275fac=function(n){return new(n||s)(d(oe),d(Q),d(F),d(y),d(re))},s.\u0275cmp=A({type:s,selectors:[["app-admin-users"]],hostVars:2,hostBindings:function(n,r){n&2&&R("router-component",r.true)},decls:13,vars:13,consts:[[1,"page-subtitle"],[3,"click"],[1,"mt-2","search-field",3,"autoFocus","placeholder","filter"],["color","primary",3,"checked","change"],["spinner",""],[1,"position-relative","table-min-height"],[3,"loading","users","routeToAdmin","displayColumns","selection","filter","tableId","queryChanged","downloadAll",4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],[3,"loading","users","routeToAdmin","displayColumns","selection","filter","tableId","queryChanged","downloadAll"]],template:function(n,r){if(n&1&&(p(0,"h1",0),S(1),h(2,"translate"),l(),p(3,"perun-web-apps-refresh-button",1),_("click",function(){return r.refresh()}),l(),p(4,"perun-web-apps-debounce-filter",2),_("filter",function(I){return r.filterSearchString(I)}),l(),p(5,"mat-checkbox",3),_("change",function(){return r.filterUserWithoutVO()}),S(6),h(7,"translate"),l(),m(8,We,1,0,"ng-template",null,4,L),p(10,"div",5),m(11,Ne,3,11,"perun-web-apps-users-list",6),h(12,"async"),l()),n&2){let u=M(9);c(),E(f(2,7,"ADMIN.USERS.TITLE")),c(3),a("autoFocus",!0)("placeholder","ADMIN.USERS.SEARCH_PLACEHOLDER"),c(),a("checked",r.usersWithoutVo),c(),x(" ",f(7,9,"ADMIN.USERS.USERS_WITHOUT_VO"),`
`),c(5),a("perunWebAppsLoader",f(12,11,r.loading$))("perunWebAppsLoaderIndicator",u)}},dependencies:[ue,P,W,N,j,k,ee,w],styles:[".search-field[_ngcontent-%COMP%]{width:325px}"]});let e=s;return e})();function je(e,s){if(e&1){let t=C();p(0,"button",8),_("click",function(){b(t);let n=o();return g(n.createService())}),S(1),h(2,"translate"),l()}e&2&&(c(),x(" ",f(2,1,"ADMIN.SERVICES.CREATE")," "))}function Oe(e,s){if(e&1){let t=C();p(0,"button",9),_("click",function(){b(t);let n=o();return g(n.deleteService())}),S(1),h(2,"translate"),l()}if(e&2){let t=o();a("disabled",t.selection.selected.length===0),c(),x(" ",f(2,2,"ADMIN.SERVICES.DELETE")," ")}}function $e(e,s){e&1&&v(0,"perun-web-apps-loading-table")}function qe(e,s){if(e&1&&v(0,"app-services-list",10),e&2){let t=o();a("loading",t.loading)("filterValue",t.filterValue)("selection",t.selection)("services",t.services)("tableId",t.tableId)}}var Ot=(()=>{let s=class s{constructor(i,n,r,u){this.serviceManager=i,this.dialog=n,this.authResolver=r,this.cacheHelperService=u,this.selection=new U(!0,[]),this.loading=!1,this.filterValue="",this.tableId=_e}ngOnInit(){this.refreshTable(),this.cacheHelperService.refreshComponentCachedData().subscribe(i=>{i&&this.refreshTable()})}createService(){let i=D();i.width="600px",i.data={theme:"admin-theme"},this.dialog.open(we,i).afterClosed().subscribe(r=>{r&&this.refreshTable()})}deleteService(){let i=D();i.width="600px",i.data={theme:"admin-theme",services:this.selection.selected},this.dialog.open(ye,i).afterClosed().subscribe(r=>{r&&this.refreshTable()})}refreshTable(){this.loading=!0,this.serviceManager.getServices().subscribe(i=>{this.services=i,this.selection.clear(),this.loading=!1})}applyFilter(i){this.filterValue=i}};s.id="AdminServicesComponent",s.\u0275fac=function(n){return new(n||s)(d(ne),d(F),d(ae),d(y))},s.\u0275cmp=A({type:s,selectors:[["app-admin-services"]],decls:12,vars:8,consts:[[1,"page-subtitle"],[3,"refresh"],["color","accent","class","action-button me-2","data-cy","service-create-button","mat-flat-button","",3,"click",4,"ngIf"],["class","me-2","color","warn","data-cy","service-delete-button","mat-flat-button","",3,"disabled","click",4,"ngIf"],[3,"placeholder","filter"],["spinner",""],[1,"position-relative","table-min-height"],[3,"loading","filterValue","selection","services","tableId",4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],["color","accent","data-cy","service-create-button","mat-flat-button","",1,"action-button","me-2",3,"click"],["color","warn","data-cy","service-delete-button","mat-flat-button","",1,"me-2",3,"disabled","click"],[3,"loading","filterValue","selection","services","tableId"]],template:function(n,r){if(n&1&&(p(0,"div")(1,"h1",0),S(2),h(3,"translate"),l(),p(4,"perun-web-apps-refresh-button",1),_("refresh",function(){return r.refreshTable()}),l(),m(5,je,3,3,"button",2)(6,Oe,3,4,"button",3),p(7,"perun-web-apps-debounce-filter",4),_("filter",function(I){return r.applyFilter(I)}),l(),m(8,$e,1,0,"ng-template",null,5,L),p(10,"div",6),m(11,qe,1,5,"app-services-list",7),l()()),n&2){let u=M(9);c(2),E(f(3,6,"ADMIN.SERVICES.TITLE")),c(3),a("ngIf",r.authResolver.isPerunAdmin()),c(),a("ngIf",r.authResolver.isPerunAdmin()),c(),a("placeholder","ADMIN.SERVICES.FILTER"),c(4),a("perunWebAppsLoader",r.loading)("perunWebAppsLoaderIndicator",u)}},dependencies:[B,pe,Ee,P,W,N,k,w]});let e=s;return e})();function ze(e,s){e&1&&(S(0),h(1,"translate")),e&2&&x(" ",f(1,1,"ADMIN.SEARCHER.TAB_USERS")," ")}function Ge(e,s){if(e&1){let t=C();p(0,"perun-web-apps-attribute-search-select",8),_("search",function(n){b(t);let r=o(2);return g(r.getUsers(n))}),l()}if(e&2){let t=o(2);a("attributes",t.allAttrDefinitions)("attributesForEntity","user")}}var Ze=()=>["user","id","name"];function Je(e,s){if(e&1&&v(0,"perun-web-apps-users-list",9),e&2){let t=o(2);a("loading",t.loading)("tableId",t.tableId)("routeToAdmin",!0)("displayColumns",T(5,Ze))("users",t.entities)}}function Ke(e,s){if(e&1&&m(0,Ge,1,2,"perun-web-apps-attribute-search-select",6)(1,Je,1,6,"perun-web-apps-users-list",7),e&2){let t=o();a("ngIf",!t.loading),c(),a("ngIf",!t.loadingEntityData)}}function Xe(e,s){e&1&&(S(0),h(1,"translate")),e&2&&x(" ",f(1,1,"ADMIN.SEARCHER.TAB_MEMBERS")," ")}function Ye(e,s){if(e&1){let t=C();p(0,"perun-web-apps-vo-search-select",13),_("voSelected",function(n){b(t);let r=o(2);return g(r.voSelected(n))}),l()}if(e&2){let t=o(2);a("vos",t.vos)}}function Qe(e,s){if(e&1){let t=C();p(0,"perun-web-apps-attribute-search-select",8),_("search",function(n){b(t);let r=o(2);return g(r.getMembers(n))}),l()}if(e&2){let t=o(2);a("attributes",t.allAttrDefinitions)("attributesForEntity","user")}}var et=()=>["id","voId","userId","status"];function tt(e,s){if(e&1){let t=C();p(0,"perun-web-apps-members-list",14),_("refreshTable",function(){b(t);let n=o(2);return g(n.getMembers(n.searchInput))}),l()}if(e&2){let t=o(2);a("loading",t.loading)("displayedColumns",T(4,et))("members",t.entities)("tableId",t.tableId)}}function it(e,s){if(e&1&&(p(0,"div",10),m(1,Ye,1,1,"perun-web-apps-vo-search-select",11),l(),m(2,Qe,1,2,"perun-web-apps-attribute-search-select",6)(3,tt,1,5,"perun-web-apps-members-list",12)),e&2){let t=o();c(),a("ngIf",t.vos.length>0),c(),a("ngIf",!t.loading),c(),a("ngIf",!t.loadingEntityData)}}function nt(e,s){e&1&&(S(0),h(1,"translate")),e&2&&x(" ",f(1,1,"ADMIN.SEARCHER.TAB_FACILITIES")," ")}function rt(e,s){if(e&1){let t=C();p(0,"perun-web-apps-attribute-search-select",8),_("search",function(n){b(t);let r=o(2);return g(r.getFacilities(n))}),l()}if(e&2){let t=o(2);a("attributes",t.allAttrDefinitions)("attributesForEntity","facility")}}var st=()=>["id","name","description"];function at(e,s){if(e&1&&v(0,"perun-web-apps-facilities-list",16),e&2){let t=o(2);a("loading",t.loading)("tableId",t.tableId)("displayedColumns",T(4,st))("facilities",t.entities)}}function ot(e,s){if(e&1&&m(0,rt,1,2,"perun-web-apps-attribute-search-select",6)(1,at,1,5,"perun-web-apps-facilities-list",15),e&2){let t=o();a("ngIf",!t.loading),c(),a("ngIf",!t.loadingEntityData)}}function pt(e,s){e&1&&(S(0),h(1,"translate")),e&2&&x(" ",f(1,1,"ADMIN.SEARCHER.TAB_RESOURCES")," ")}function lt(e,s){if(e&1){let t=C();p(0,"perun-web-apps-attribute-search-select",8),_("search",function(n){b(t);let r=o(2);return g(r.getResources(n))}),l()}if(e&2){let t=o(2);a("attributes",t.allAttrDefinitions)("attributesForEntity","resource")}}var ct=()=>["id","name","description","voId","facilityId"];function mt(e,s){if(e&1&&v(0,"perun-web-apps-resources-list",18),e&2){let t=o(2);a("loading",t.loading)("tableId",t.tableId)("displayedColumns",T(4,ct))("resources",t.entities)}}function _t(e,s){if(e&1&&m(0,lt,1,2,"perun-web-apps-attribute-search-select",6)(1,mt,1,5,"perun-web-apps-resources-list",17),e&2){let t=o();a("ngIf",!t.loading),c(),a("ngIf",!t.loadingEntityData)}}function ut(e,s){e&1&&v(0,"mat-spinner",19)}var si=(()=>{let s=class s{constructor(i,n,r,u){this.attributesManager=i,this.searcher=n,this.voService=r,this.cacheHelperService=u,this.loadingEntityData=!1,this.allAttrDefinitions=[],this.tableId=H,this.entities=[],this.vos=[]}ngOnInit(){this.loading=!0,this.attributesManager.getAllAttributeDefinitions().subscribe(i=>{this.allAttrDefinitions=i,this.loading=!1}),this.cacheHelperService.refreshComponentCachedData().subscribe(i=>{i&&this.refresh()})}tabChanged(i){switch(this.entities=[],i){case 0:this.tableId=H;break;case 1:this.loadingEntityData=!0,this.loadAllVos(),this.tableId=q;break;case 2:this.tableId=z;break;case 3:this.tableId=G;break;default:break}}loadAllVos(){this.loadingEntityData=!0,this.voService.getAllVos().subscribe(i=>{this.vos=i,this.selectedVo=i[0],this.loadingEntityData=!1})}voSelected(i){i!==void 0&&(this.selectedVo=i)}getUsers(i){this.searchInput=i,this.loadingEntityData=!0,this.searcher.getUsersSearcher({attributesWithSearchingValues:this.searchInput}).subscribe(n=>{this.entities=n,this.loadingEntityData=!1})}getMembers(i){this.searchInput=i,this.loadingEntityData=!0,this.searcher.getMembersByUserAttributes({vo:this.selectedVo.id,userAttributesWithSearchingValues:this.searchInput}).subscribe(n=>{this.entities=n,this.loadingEntityData=!1})}getFacilities(i){this.searchInput=i,this.loadingEntityData=!0,this.searcher.getFacilities({attributesWithSearchingValues:this.searchInput}).subscribe(n=>{this.entities=n.map(r=>({facility:r})),this.loadingEntityData=!1})}getResources(i){this.searchInput=i,this.loadingEntityData=!0,this.searcher.getAttributesResources({attributesWithSearchingValues:this.searchInput}).subscribe(n=>{this.entities=n,this.loadingEntityData=!1})}refresh(){if(this.searchInput)switch(this.tableId){case H:this.getUsers(this.searchInput);break;case q:this.getMembers(this.searchInput);break;case z:this.getFacilities(this.searchInput);break;case G:this.getResources(this.searchInput);break;default:break}}};s.id="AdminSearcherComponent",s.\u0275fac=function(n){return new(n||s)(d(te),d(ie),d(se),d(y))},s.\u0275cmp=A({type:s,selectors:[["app-admin-searcher"]],hostVars:2,hostBindings:function(n,r){n&2&&R("router-component",r.true)},decls:17,vars:4,consts:[[1,"page-subtitle"],["mat-stretch-tabs","false",3,"selectedIndexChange"],[1,"mb-2"],["matTabLabel",""],["matTabContent",""],["class","ms-auto me-auto",4,"ngIf"],[3,"attributes","attributesForEntity","search",4,"ngIf"],[3,"loading","tableId","routeToAdmin","displayColumns","users",4,"ngIf"],[3,"attributes","attributesForEntity","search"],[3,"loading","tableId","routeToAdmin","displayColumns","users"],[1,"mt-3"],[3,"vos","voSelected",4,"ngIf"],[3,"loading","displayedColumns","members","tableId","refreshTable",4,"ngIf"],[3,"vos","voSelected"],[3,"loading","displayedColumns","members","tableId","refreshTable"],[3,"loading","tableId","displayedColumns","facilities",4,"ngIf"],[3,"loading","tableId","displayedColumns","facilities"],[3,"loading","tableId","displayedColumns","resources",4,"ngIf"],[3,"loading","tableId","displayedColumns","resources"],[1,"ms-auto","me-auto"]],template:function(n,r){n&1&&(p(0,"h1",0),S(1),h(2,"translate"),l(),p(3,"mat-tab-group",1),_("selectedIndexChange",function(I){return r.tabChanged(I)}),p(4,"mat-tab",2),m(5,ze,2,3,"ng-template",3)(6,Ke,2,2,"ng-template",4),l(),p(7,"mat-tab"),m(8,Xe,2,3,"ng-template",3)(9,it,4,3,"ng-template",4),l(),p(10,"mat-tab"),m(11,nt,2,3,"ng-template",3)(12,ot,2,2,"ng-template",4),l(),p(13,"mat-tab"),m(14,pt,2,3,"ng-template",3)(15,_t,2,2,"ng-template",4),l()(),m(16,ut,1,0,"mat-spinner",5)),n&2&&(c(),E(f(2,2,"ADMIN.SEARCHER.TITLE")),c(15),a("ngIf",r.loading||r.loadingEntityData))},dependencies:[B,he,fe,be,ge,de,Ce,xe,Ie,ve,j,Ae,w]});let e=s;return e})();export{Tt as a,Ot as b,si as c};
