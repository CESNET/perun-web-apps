import{e as $t}from"./chunk-LOQGZPHC.js";import{$a as Q,$e as kt,$g as Wt,Aa as C,Ac as w,Ba as T,Bd as F,Bg as Ut,Ca as N,Cg as Gt,Da as D,Dc as R,Ea as S,Ec as P,Ia as W,Id as Nt,Ja as $,Ka as z,La as nt,Lg as L,Mb as rt,Na as O,Oa as c,Pa as g,Pd as Ot,Qa as u,Qc as k,Qf as U,Rc as gt,S as E,Sc as It,T as v,Uf as Ft,V as tt,W as et,Xa as M,Ya as at,Za as ot,Zg as X,aa as o,ah as Z,cd as Et,db as p,dd as vt,eb as d,fb as Y,ga as h,ge as Lt,ha as y,hd as xt,he as H,id as bt,ie as j,jb as lt,jd as B,kd as V,ke as Mt,le as wt,ma as _,mc as st,md as yt,me as Rt,nc as pt,ne as Pt,oa as G,oc as q,pa as it,pc as ct,qc as dt,qf as Bt,ra as x,rc as mt,rf as Vt,sa as b,sc as ut,sf as K,sg as Ht,tc as ht,tf as J,ub as A,uc as _t,vc as ft,wa as m,wc as St,xa as l,xc as Ct,ya as r,yc as Tt,yd as At,yg as jt,za as I,zc as Dt}from"./chunk-Q6VFHOR5.js";var Xt=t=>({all:t}),Zt=t=>({name:t});function te(t,a){if(t&1){let e=N();l(0,"th",24)(1,"mat-checkbox",25),p(2,"masterCheckboxLabel"),p(3,"translate"),D("change",function(n){E(e);let s=S(2);return v(n?s.masterToggle():null)}),r()()}if(t&2){let e=S(),i=S();o(),G("aria-label",d(3,5,d(2,3,e.all))),m("checked",i.selection.hasValue()&&e.all)("indeterminate",i.selection.hasValue()&&!e.all)}}function ee(t,a){if(t&1){let e=N();l(0,"td",26)(1,"mat-checkbox",27),p(2,"checkboxLabel"),p(3,"translate"),D("change",function(n){let s=E(e).$implicit,f=S(2);return v(n?f.toggleRow(s):null)})("click",function(n){return E(e),v(n.stopPropagation())}),r()()}if(t&2){let e=a.$implicit,i=S(2);o(),G("aria-label",Y(3,4,d(2,2,i.selection.isSelected(e)),Q(7,Zt,e.destination))),m("checked",i.selection.isSelected(e))}}function ie(t,a){t&1&&(C(0,3),_(1,te,4,7,"th",22)(2,ee,4,9,"td",23),T())}function ne(t,a){t&1&&(l(0,"th",28),c(1),p(2,"translate"),r()),t&2&&(o(),u(" ",d(2,1,"SHARED.COMPONENTS.DESTINATIONS_LIST.DESTINATION_ID")," "))}function ae(t,a){if(t&1&&(l(0,"td",29),c(1),r()),t&2){let e=a.$implicit;o(),u(" ",e.id," ")}}function oe(t,a){t&1&&(l(0,"th",28),c(1),p(2,"translate"),r()),t&2&&(o(),u(" ",d(2,1,"SHARED.COMPONENTS.DESTINATIONS_LIST.SERVICE")," "))}function le(t,a){if(t&1&&(l(0,"td",30),c(1),r()),t&2){let e=a.$implicit;o(),g(e.service.name)}}function re(t,a){t&1&&I(0,"th",31)}function se(t,a){t&1&&(l(0,"mat-icon",32),p(1,"translate"),c(2," warning "),r()),t&2&&m("matTooltip",M(d(1,2,"SHARED.COMPONENTS.DESTINATIONS_LIST.WARN")))}function pe(t,a){if(t&1&&(l(0,"td",30),x(1,se,3,4,"mat-icon",32),r()),t&2){let e=a.$implicit,i=S();o(),b(i.services.has(e.service.id)?-1:1)}}function ce(t,a){t&1&&(l(0,"th",28),c(1),p(2,"translate"),r()),t&2&&(o(),u(" ",d(2,1,"SHARED.COMPONENTS.DESTINATIONS_LIST.FACILITY")," "))}function de(t,a){if(t&1&&(l(0,"td",30),c(1),r()),t&2){let e=a.$implicit;o(),g(e.facility.name)}}function me(t,a){t&1&&(l(0,"th",28),c(1),p(2,"translate"),r()),t&2&&(o(),u(" ",d(2,1,"SHARED.COMPONENTS.DESTINATIONS_LIST.DESTINATION")," "))}function ue(t,a){if(t&1&&(l(0,"td",30),p(1,"multiWordDataCy"),c(2),r()),t&2){let e=a.$implicit;it("data-cy",d(1,2,e.destination)),o(2),u(" ",e.destination," ")}}function he(t,a){t&1&&(l(0,"th",28),c(1),p(2,"translate"),r()),t&2&&(o(),u(" ",d(2,1,"SHARED.COMPONENTS.DESTINATIONS_LIST.TYPE")," "))}function _e(t,a){if(t&1&&(l(0,"td",30),c(1),r()),t&2){let e=a.$implicit;o(),g(e.type.toUpperCase())}}function fe(t,a){t&1&&I(0,"th",31)}function Se(t,a){t&1&&(l(0,"mat-icon",33),p(1,"translate"),c(2," check_circle_outline "),r()),t&2&&m("matTooltip",M(d(1,2,"SHARED.COMPONENTS.DESTINATIONS_LIST.ALLOWED")))}function Ce(t,a){t&1&&(l(0,"mat-icon",33),p(1,"translate"),c(2," block "),r()),t&2&&m("matTooltip",M(d(1,2,"SHARED.COMPONENTS.DESTINATIONS_LIST.BLOCKED")))}function Te(t,a){if(t&1&&(l(0,"td",30),x(1,Se,3,4,"mat-icon",33),x(2,Ce,3,4,"mat-icon",33),r()),t&2){let e=a.$implicit;o(),b(e.blocked?-1:1),o(),b(e.blocked?2:-1)}}function De(t,a){t&1&&(l(0,"th",28),c(1),p(2,"translate"),r()),t&2&&(o(),u(" ",d(2,1,"SHARED.COMPONENTS.DESTINATIONS_LIST.PROPAGATION_TYPE")," "))}function ge(t,a){if(t&1&&(l(0,"td",30),c(1),r()),t&2){let e=a.$implicit;o(),g(e.propagationType)}}function Ie(t,a){t&1&&(l(0,"th",28),c(1),p(2,"translate"),r()),t&2&&(o(),u(" ",d(2,1,"SHARED.COMPONENTS.DESTINATIONS_LIST.LAST_SUCCESS")," "))}function Ee(t,a){if(t&1&&(l(0,"td",34),p(1,"lastPropagation"),c(2),p(3,"lastPropagation"),r()),t&2){let e=a.$implicit,i=S();O(e.lastSuccessfulPropagation?"":"fst-italic"),m("matTooltip",d(1,4,e.lastSuccessfulPropagation)===i.noTimestampText?i.noTimestampTooltip:null),o(2),u(" ",d(3,6,e.lastSuccessfulPropagation)," ")}}function ve(t,a){t&1&&(l(0,"th",28),c(1),p(2,"translate"),r()),t&2&&(o(),u(" ",d(2,1,"SHARED.COMPONENTS.DESTINATIONS_LIST.LAST_ATTEMPT")," "))}function xe(t,a){if(t&1&&(l(0,"td",34),p(1,"lastPropagation"),c(2),p(3,"lastPropagation"),r()),t&2){let e=a.$implicit,i=S();O(e.lastAttemptedPropagation?"":"fst-italic"),m("matTooltip",d(1,4,e.lastAttemptedPropagation)===i.noTimestampText?i.noTimestampTooltip:null),o(2),u(" ",d(3,6,e.lastAttemptedPropagation)," ")}}function be(t,a){t&1&&I(0,"tr",35)}function ye(t,a){t&1&&I(0,"tr",36)}function Ae(t,a){t&1&&(l(0,"perun-web-apps-alert",21),c(1),p(2,"translate"),r()),t&2&&(o(),u(" ",d(2,1,"SHARED_LIB.UI.ALERTS.NO_FILTER_RESULTS_ALERT")," "))}function Ne(t,a){t&1&&(l(0,"perun-web-apps-alert",21),c(1),p(2,"translate"),r()),t&2&&(o(),u(" ",d(2,1,"SHARED.COMPONENTS.DESTINATIONS_LIST.NO_DESTINATIONS")," "))}var Yt=(()=>{class t{constructor(e,i,n,s,f,qt){this.authResolver=e,this.tableCheckbox=i,this.lastPropagationPipe=n,this.destroyRef=s,this.translate=f,this.tableConfigService=qt,this.destinations=[],this.selection=new q(!0,[]),this.filterValue="",this.pageSizeOptions=kt,this.noTimestampText="",this.noTimestampTooltip="",this.displayedColumns=[],this.unfilteredColumns=this.displayedColumns,this.tableId="app-perun-web-apps-destination-list"}set displayColumns(e){this.unfilteredColumns=e,localStorage.getItem("showIds")!=="true"&&(e=e.filter(i=>i!=="destinationId")),this.displayedColumns=e}set matSort(e){this.sort=e,this.setDataSource()}ngOnInit(){this.selection&&(this.cachedSelection=new q(this.selection.isMultipleSelection(),[],!0,this.selection.compareWith),this.cachedSubject?.pipe(X(this.destroyRef)).subscribe(e=>{e&&this.cachedSelection.clear()})),this.noTimestampText=this.translate.instant("SHARED.COMPONENTS.DESTINATIONS_LIST.NO_TIMESTAMP"),this.noTimestampTooltip=this.translate.instant("SHARED.COMPONENTS.DESTINATIONS_LIST.NO_TIMESTAMP_TOOLTIP"),this.watchForIdColumnChanges()}getDataForColumn(e,i){switch(i){case"destinationId":return e.id.toString();case"service":return e.service.name;case"facility":return e.facility.name;case"destination":return e.destination;case"type":return e.type;case"status":return e.blocked?"blocked":"allowed";case"propagationType":return e.propagationType;case"lastPropagation":return this.lastPropagationPipe.transform(e.lastSuccessfulPropagation);case"lastAttemptedPropagation":return this.lastPropagationPipe.transform(e.lastAttemptedPropagation);default:return""}}ngOnChanges(){this.dataSource=new w(this.destinations),this.setDataSource(),this.dataSource.filter=this.filterValue.toLowerCase()}exportAllData(e){J(K(this.dataSource.filteredData,this.displayedColumns,(i,n)=>this.getDataForColumn(i,n)),e)}exportDisplayedData(e){let i=this.dataSource.paginator.pageIndex*this.dataSource.paginator.pageSize,n=i+this.dataSource.paginator.pageSize;J(K(this.dataSource.sortData(this.dataSource.filteredData,this.dataSource.sort).slice(i,n),this.displayedColumns,(s,f)=>this.getDataForColumn(s,f)),e)}setDataSource(){this.dataSource&&(this.dataSource.sort=this.sort,this.dataSource.filterPredicate=(e,i)=>Vt(e,i,this.displayedColumns,(n,s)=>this.getDataForColumn(n,s)),this.dataSource.sortData=(e,i)=>Bt(e,i,(n,s)=>this.getDataForColumn(n,s)),this.dataSource.paginator=this.child.paginator)}isAllSelected(){return this.tableCheckbox.isAllSelected(this.selection.selected.length,this.dataSource)}masterToggle(){this.tableCheckbox.masterToggle(this.isAllSelected(),this.selection,this.cachedSelection,this.filterValue,this.dataSource,this.sort,this.child.paginator.pageSize,this.child.paginator.pageIndex,!1)}ngAfterViewInit(){this.dataSource.paginator=this.child.paginator}toggleRow(e){this.selection.toggle(e),this.cachedSelection.toggle(e)}pageChanged(){this.cachedSelection&&this.tableCheckbox.selectCachedDataOnPage(this.dataSource,this.selection,this.cachedSelection,this.selection.compareWith)}watchForIdColumnChanges(){this.tableConfigService.showIdsChanged.pipe(X(this.destroyRef)).subscribe(e=>{e?this.displayedColumns=this.unfilteredColumns:this.displayedColumns=this.unfilteredColumns.filter(i=>i!=="destinationId")}),localStorage.getItem("showIds")!=="true"&&(this.displayedColumns=this.displayedColumns.filter(e=>e!=="destinationId"))}static{this.\u0275fac=function(i){return new(i||t)(h(Lt),h(Ft),h(L),h(tt),h(F),h(Wt))}}static{this.\u0275cmp=y({type:t,selectors:[["app-perun-web-apps-destination-list"]],viewQuery:function(i,n){if(i&1&&(W(Z,7),W(k,7)),i&2){let s;$(s=z())&&(n.child=s.first),$(s=z())&&(n.matSort=s.first)}},inputs:{destinations:"destinations",selection:"selection",cachedSubject:"cachedSubject",filterValue:"filterValue",services:"services",loading:"loading",displayColumns:"displayColumns"},features:[ot([L]),et],decls:39,vars:15,consts:[[1,"card","mt-3",3,"hidden"],[3,"exportDisplayedData","exportAllData","pageChanged","pageSizeOptions","dataLength","tableId"],["mat-table","","matSort","","matSortActive","id","matSortDirection","asc","matSortDisableClear","",1,"w-100",3,"matSortChange","dataSource"],["matColumnDef","select"],["matColumnDef","destinationId"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["class","static-column-size","mat-cell","",4,"matCellDef"],["matColumnDef","service"],["mat-cell","",4,"matCellDef"],["matColumnDef","warn"],["mat-header-cell","",4,"matHeaderCellDef"],["matColumnDef","facility"],["matColumnDef","destination"],["matColumnDef","type"],["matColumnDef","status"],["matColumnDef","propagationType"],["matColumnDef","lastSuccessfulPropagation"],["mat-cell","",3,"matTooltip","class",4,"matCellDef"],["matColumnDef","lastAttemptedPropagation"],["mat-header-row","",4,"matHeaderRowDef"],["class","dark-hover-list-item","mat-row","",4,"matRowDef","matRowDefColumns"],["alert_type","warn"],["class","align-checkbox","mat-header-cell","",4,"matHeaderCellDef"],["class","static-column-size align-checkbox","mat-cell","",4,"matCellDef"],["mat-header-cell","",1,"align-checkbox"],["color","primary",3,"change","aria-label","checked","indeterminate"],["mat-cell","",1,"static-column-size","align-checkbox"],["color","primary",3,"change","click","aria-label","checked"],["mat-header-cell","","mat-sort-header",""],["mat-cell","",1,"static-column-size"],["mat-cell",""],["mat-header-cell",""],["matTooltipPosition","above",1,"warn",3,"matTooltip"],[1,"align-bottom",3,"matTooltip"],["mat-cell","",3,"matTooltip"],["mat-header-row",""],["mat-row","",1,"dark-hover-list-item"]],template:function(i,n){if(i&1&&(l(0,"div",0)(1,"perun-web-apps-table-wrapper",1),D("exportDisplayedData",function(f){return n.exportDisplayedData(f)})("exportAllData",function(f){return n.exportAllData(f)})("pageChanged",function(){return n.pageChanged()}),l(2,"table",2),D("matSortChange",function(){return n.pageChanged()}),x(3,ie,3,0,"ng-container",3),p(4,"isAllSelected"),C(5,4),_(6,ne,3,3,"th",5)(7,ae,2,1,"td",6),T(),C(8,7),_(9,oe,3,3,"th",5)(10,le,2,1,"td",8),T(),C(11,9),_(12,re,1,0,"th",10)(13,pe,2,1,"td",8),T(),C(14,11),_(15,ce,3,3,"th",5)(16,de,2,1,"td",8),T(),C(17,12),_(18,me,3,3,"th",5)(19,ue,3,4,"td",8),T(),C(20,13),_(21,he,3,3,"th",5)(22,_e,2,1,"td",8),T(),C(23,14),_(24,fe,1,0,"th",10)(25,Te,3,2,"td",8),T(),C(26,15),_(27,De,3,3,"th",5)(28,ge,2,1,"td",8),T(),C(29,16),_(30,Ie,3,3,"th",5)(31,Ee,4,8,"td",17),T(),C(32,18),_(33,ve,3,3,"th",5)(34,xe,4,8,"td",17),T(),_(35,be,1,0,"tr",19)(36,ye,1,0,"tr",20),r()()(),x(37,Ae,3,3,"perun-web-apps-alert",21),x(38,Ne,3,3,"perun-web-apps-alert",21)),i&2){let s;m("hidden",n.dataSource.filteredData.length===0||n.destinations.length===0),o(),m("pageSizeOptions",n.pageSizeOptions)("dataLength",n.dataSource.filteredData.length)("tableId",n.tableId),o(),m("dataSource",n.dataSource),o(),b((s=Q(13,Xt,Y(4,10,n.dataSource,n.selection.selected.length)))?3:-1,s),o(32),m("matHeaderRowDef",n.displayedColumns),o(),m("matRowDefColumns",n.displayedColumns),o(),b(n.dataSource.filteredData.length===0&&n.destinations.length!==0?37:-1),o(),b(!n.loading&&n.destinations.length===0?38:-1)}},dependencies:[A,bt,xt,pt,st,V,B,Z,Dt,ct,mt,ft,ut,dt,St,ht,_t,Ct,Tt,It,k,gt,P,rt,jt,R,L,Ut,Ht,Gt],styles:[".warn[_ngcontent-%COMP%]{color:#ebe134}"]})}}return t})();function Me(t,a){t&1&&I(0,"perun-web-apps-loading-dialog")}function we(t,a){if(t&1){let e=N();l(0,"div")(1,"h1",2),c(2),p(3,"translate"),r(),l(4,"div",3)(5,"perun-web-apps-alert",4),c(6),p(7,"translate"),r(),l(8,"p"),c(9),p(10,"translate"),r(),l(11,"div",5),c(12),p(13,"translate"),r(),I(14,"app-perun-web-apps-destination-list",6),r(),l(15,"div",7)(16,"button",8),D("click",function(){E(e);let n=S();return v(n.onCancel())}),c(17),p(18,"translate"),r(),l(19,"button",9),D("click",function(){E(e);let n=S();return v(n.onConfirm())}),c(20),p(21,"translate"),r()()()}if(t&2){let e=S();o(2),g(d(3,10,"DIALOGS.REMOVE_DESTINATIONS.TITLE")),o(4),g(d(7,12,"DIALOGS.REMOVE_DESTINATIONS.WARNING")),o(3),g(d(10,14,"DIALOGS.REMOVE_DESTINATIONS.DESCRIPTION")),o(3),u(" ",d(13,16,"DIALOGS.REMOVE_DESTINATIONS.ASK")," "),o(2),m("loading",e.loading)("destinations",e.destinations)("displayColumns",e.displayedColumns),o(3),u(" ",d(18,18,"DIALOGS.REMOVE_DESTINATIONS.CANCEL")," "),o(2),m("disabled",e.loading),o(),u(" ",d(21,20,"DIALOGS.REMOVE_DESTINATIONS.CONFIRM")," ")}}var Ii=(()=>{class t{constructor(e,i,n,s,f){this.dialogRef=e,this.data=i,this.notificator=n,this.translate=s,this.serviceManager=f,this.displayedColumns=[],this.loading=!1}ngOnInit(){this.theme=this.data.theme,this.destinations=this.data.destinations,this.displayedColumns=this.theme==="admin-theme"?["destinationId","facility","destination","type","propagationType"]:["destinationId","service","destination","type","propagationType"],this.dataSource=new w(this.data.destinations)}onCancel(){this.dialogRef.close(!1)}deleteDestinations(){this.serviceManager.removeDestinationsByRichDestinations({richDestinations:this.destinations}).subscribe({next:()=>{this.notificator.showSuccess(this.translate.instant("DIALOGS.REMOVE_DESTINATIONS.SUCCESS")),this.dialogRef.close(!0)},error:()=>this.loading=!1})}onConfirm(){this.loading=!0,this.deleteDestinations()}static{this.\u0275fac=function(i){return new(i||t)(h(H),h(j),h(U),h(F),h(Ot))}}static{this.\u0275cmp=y({type:t,selectors:[["app-perun-web-apps-remove-destination-dialog"]],decls:4,vars:5,consts:[["spinner",""],[4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],["mat-dialog-title",""],["mat-dialog-content",""],["alert_type","warn"],[1,"fw-bold"],[3,"loading","destinations","displayColumns"],["mat-dialog-actions",""],["mat-stroked-button","",1,"ms-auto",3,"click"],["color","warn","mat-flat-button","",1,"ms-2",3,"click","disabled"]],template:function(i,n){if(i&1&&(_(0,Me,1,0,"ng-template",null,0,lt),l(2,"div"),_(3,we,22,22,"div",1),r()),i&2){let s=nt(1);o(2),O(at("",n.theme," position-relative")),o(),m("perunWebAppsLoader",n.loading)("perunWebAppsLoaderIndicator",s)}},dependencies:[A,vt,Et,Pt,Mt,Rt,wt,V,B,yt,P,At,Yt,R],encapsulation:2})}}return t})();var Mi=(()=>{class t{constructor(e,i,n,s){this.data=e,this.dialogRef=i,this.facilityService=n,this.notificator=s,this.loading=!1}update(e){this.loading=!0,this.facilityService.updateFacilityBan({banOnFacility:{id:this.data.ban.id,beanName:"BanOnFacility",facilityId:this.data.ban.facilityId,userId:this.data.ban.userId,description:e.description,validityTo:e.validity}}).subscribe({next:()=>{this.notificator.showSuccess("DIALOGS.UPDATE_BAN.SUCCESS"),this.dialogRef.close(!0)},error:()=>{this.loading=!1}})}cancel(){this.dialogRef.close(!1)}static{this.\u0275fac=function(i){return new(i||t)(h(j),h(H),h(Nt),h(U))}}static{this.\u0275cmp=y({type:t,selectors:[["app-update-facility-ban-dialog"]],decls:1,vars:3,consts:[[3,"cancelled","update","ban","theme","loading"]],template:function(i,n){i&1&&(l(0,"app-update-ban-dialog",0),D("cancelled",function(){return n.cancel()})("update",function(f){return n.update(f)}),r()),i&2&&m("ban",n.data.ban)("theme","facility-theme")("loading",n.loading)},dependencies:[A,$t],encapsulation:2})}}return t})();export{Yt as a,Ii as b,Mi as c};
