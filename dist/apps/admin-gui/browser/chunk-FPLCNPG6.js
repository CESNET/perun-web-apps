import{a as Gt,b as $t,c as Qt}from"./chunk-QCWTEJ67.js";import{a as je}from"./chunk-ZWZ2DK5A.js";import{a as Ht,b as Wt,c as qt,d as zt,e as Kt,f as Yt,g as Xt,h as Zt,i as Jt,j as ei}from"./chunk-E6T6JXIR.js";import{$b as M,Aa as g,Ae as et,Ag as dt,B as _e,Ba as D,Bb as xe,Be as tt,Ca as C,Cb as Ye,Da as Ie,Dc as P,Ea as ze,Eb as Xe,Ec as ke,Eh as j,F as be,Hb as Qe,Ih as _t,Ja as W,Jf as ot,Jg as ut,K as E,Ka as de,Kf as B,Kh as bt,Kj as Et,L as ve,Lb as De,Lj as Tt,Mb as Ze,Mf as rt,Na as m,Nb as we,Ne as Pe,Nf as at,Nj as xt,O as v,Oa as d,Oe as it,Of as Oe,Oj as Dt,P as S,Qf as Be,Qj as wt,Ra as k,Rc as Je,Se as Q,Tf as st,Uf as lt,Vb as ye,Wb as T,Xg as ft,Y as a,Ya as y,Yb as Me,Yg as ht,Yh as vt,Z as c,Za as oe,Ze as q,Zh as St,Zj as yt,_ as qe,_a as Ce,_b as Re,_h as It,_j as Mt,ac as Le,be as se,bj as At,bk as Rt,cb as Ke,ch as gt,ci as Ct,ck as Fe,d as R,da as _,df as le,dg as pt,dk as Lt,ek as kt,ff as O,ga as p,gg as ct,gi as Ue,ha as Se,hc as G,hk as Nt,i as ue,je as Ne,ji as ce,ka as s,kh as pe,la as l,lg as mt,lk as Pt,m as fe,ma as b,mh as V,mk as Ot,nk as Bt,ok as Vt,pa as A,pf as nt,qa as f,qb as Ae,ra as h,rd as re,sk as Ut,tb as Ee,tk as jt,ua as F,ub as Te,uh as Ve,uk as Ft,vd as ae,wb as We,wc as N,x as he,y as ge,yb as X,ye as x,za as L,zb as $e}from"./chunk-XMLGBR2F.js";var Ei=()=>({color:"black"}),ri=(()=>{let o=class o{constructor(e){this.sideMenuService=e}ngOnInit(){this.sideMenuService.setAdminItems([])}};o.\u0275fac=function(t){return new(t||o)(c(le))},o.\u0275cmp=E({type:o,selectors:[["app-admin-page"]],decls:7,vars:5,consts:[[1,"container-fluid","ps-xl-5","pe-xl-5","admin-theme"],[1,"page-title","d-flex"],["svgIcon","perun-perun-admin",1,"perun-icon","icon-scale",3,"ngStyle"]],template:function(t,r){t&1&&(s(0,"div",0),b(1,"perun-web-apps-back-button"),s(2,"h1",1),b(3,"mat-icon",2),g(4),m(5,"translate"),l(),b(6,"app-animated-router-outlet"),l()),t&2&&(a(3),p("ngStyle",W(4,Ei)),a(),C(" ",d(5,2,"ADMIN.TITLE")," "))},dependencies:[oe,re,ce,pe,T]});let i=o;return i})();var ai=(()=>{let o=class o{constructor(){this.items=[{cssIcon:"perun-attributes",url:"/admin/attributes",label:"MENU_ITEMS.ADMIN.ATTRIBUTES",style:"admin-btn"},{cssIcon:"perun-user",url:"/admin/users",label:"MENU_ITEMS.ADMIN.USERS",style:"admin-btn"},{cssIcon:"perun-owner-grey",url:"/admin/owners",label:"MENU_ITEMS.ADMIN.OWNERS",style:"admin-btn"},{cssIcon:"perun-service",url:"/admin/services",label:"MENU_ITEMS.ADMIN.SERVICES",style:"admin-btn"},{cssIcon:"perun-external-sources",url:"/admin/ext_sources",label:"MENU_ITEMS.ADMIN.EXT_SOURCES",style:"admin-btn"},{cssIcon:"perun-audit-log",url:"/admin/audit_log",label:"MENU_ITEMS.ADMIN.AUDIT_LOG",style:"admin-btn"},{cssIcon:"perun-consent-hubs",url:"/admin/consent_hubs",label:"MENU_ITEMS.ADMIN.CONSENT_HUBS",style:"admin-btn"},{cssIcon:"perun-searcher",url:"/admin/searcher",label:"MENU_ITEMS.ADMIN.SEARCHER",style:"admin-btn"},{cssIcon:"perun-blocked-logins",url:"/admin/blocked_logins",label:"MENU_ITEMS.ADMIN.BLOCKED_LOGINS",style:"admin-btn"},{cssIcon:"perun-automated-tasks",url:"/admin/tasks",label:"MENU_ITEMS.ADMIN.TASKS",style:"admin-btn"}]}};o.\u0275fac=function(t){return new(t||o)},o.\u0275cmp=E({type:o,selectors:[["app-admin-overview"]],hostVars:2,hostBindings:function(t,r){t&2&&Se("router-component",r.true)},decls:2,vars:1,consts:[[3,"items"]],template:function(t,r){t&1&&(s(0,"div"),b(1,"perun-web-apps-menu-buttons-field",0),l()),t&2&&(a(),p("items",r.items))},dependencies:[Ve]});let i=o;return i})();function Di(i,o){if(i&1){let n=A();s(0,"button",9),f("click",function(){v(n);let t=h();return S(t.onCreate())}),g(1),m(2,"translate"),l()}i&2&&(a(),C(" ",d(2,1,"ADMIN.ATTRIBUTES.CREATE")," "))}function wi(i,o){if(i&1){let n=A();s(0,"button",10),f("click",function(){v(n);let t=h();return S(t.onImport())}),g(1),m(2,"translate"),l()}i&2&&(a(),C(" ",d(2,1,"ADMIN.ATTRIBUTES.IMPORT")," "))}function yi(i,o){if(i&1){let n=A();s(0,"button",11),f("click",function(){v(n);let t=h();return S(t.onDelete())}),g(1),m(2,"translate"),l()}if(i&2){let n=h();p("disabled",n.loading||n.selected.selected.length===0),a(),C(" ",d(2,2,"ADMIN.ATTRIBUTES.DELETE")," ")}}function Mi(i,o){i&1&&b(0,"perun-web-apps-loading-table")}function Ri(i,o){if(i&1){let n=A();s(0,"app-attr-def-list",12),f("refreshEvent",function(){v(n);let t=h();return S(t.refreshTable())}),l()}if(i&2){let n=h();p("loading",n.loading)("definitions",n.attrDefinitions)("disableRouting",!n.authResolver.isPerunAdminOrObserver())("filterValue",n.filterValue)("selection",n.selected)("cachedSubject",n.cachedSubject)("tableId",n.tableId)}}var si=(()=>{let o=class o{constructor(e,t,r){this.dialog=e,this.attributesManager=t,this.authResolver=r,this.attrDefinitions=[],this.selected=new G(!0,[],!0,(u,I)=>u.id===I.id),this.cachedSubject=new R(!0),this.filterValue="",this.tableId=ct}ngOnInit(){this.refreshTable()}onCreate(){let e=x();e.width="650px",this.dialog.open(Tt,e).afterClosed().subscribe(r=>{r&&this.refreshTable()})}onDelete(){let e=x();e.width="450px",e.data={attributes:this.selected.selected,theme:"admin-theme"},this.dialog.open(Et,e).afterClosed().subscribe(r=>{r&&this.refreshTable()})}refreshTable(){this.loading=!0,this.attributesManager.getAllAttributeDefinitions().subscribe(e=>{this.attrDefinitions=e,this.selected.clear(),this.cachedSubject.next(!0),this.loading=!1})}applyFilter(e){this.filterValue=e,this.refreshTable()}onImport(){let e=x();e.width="700px",this.dialog.open(wt,e).afterClosed().subscribe(r=>{r===!0&&this.refreshTable()})}};o.\u0275fac=function(t){return new(t||o)(c(N),c(X),c(M))},o.\u0275cmp=E({type:o,selectors:[["app-admin-attributes"]],hostVars:2,hostBindings:function(t,r){t&2&&Se("router-component",r.true)},decls:13,vars:9,consts:[[1,"page-subtitle"],[3,"refresh"],["class","me-2 action-button","color","accent","data-cy","new-attr-definition-button","mat-flat-button","",3,"click",4,"ngIf"],["class","me-2 action-button","color","accent","mat-flat-button","",3,"click",4,"ngIf"],["color","warn","class","me-2","data-cy","delete-attr-definition-button","mat-flat-button","",3,"disabled","click",4,"ngIf"],[3,"placeholder","filter"],["spinner",""],[1,"position-relative","table-min-height"],[3,"loading","definitions","disableRouting","filterValue","selection","cachedSubject","tableId","refreshEvent",4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],["color","accent","data-cy","new-attr-definition-button","mat-flat-button","",1,"me-2","action-button",3,"click"],["color","accent","mat-flat-button","",1,"me-2","action-button",3,"click"],["color","warn","data-cy","delete-attr-definition-button","mat-flat-button","",1,"me-2",3,"disabled","click"],[3,"loading","definitions","disableRouting","filterValue","selection","cachedSubject","tableId","refreshEvent"]],template:function(t,r){if(t&1&&(s(0,"div")(1,"h1",0),g(2),m(3,"translate"),l(),s(4,"perun-web-apps-refresh-button",1),f("refresh",function(){return r.refreshTable()}),l(),_(5,Di,3,3,"button",2)(6,wi,3,3,"button",3)(7,yi,3,4,"button",4),s(8,"perun-web-apps-debounce-filter",5),f("filter",function(I){return r.applyFilter(I)}),l(),_(9,Mi,1,0,"ng-template",null,6,k),s(11,"div",7),_(12,Ri,1,7,"app-attr-def-list",8),l()()),t&2){let u=L(10);a(2),D(d(3,7,"ADMIN.ATTRIBUTES.TITLE")),a(3),p("ngIf",r.authResolver.isPerunAdmin()),a(),p("ngIf",r.authResolver.isPerunAdmin()),a(),p("ngIf",r.authResolver.isPerunAdmin()),a(),p("placeholder","ADMIN.ATTRIBUTES.SEARCH"),a(4),p("perunWebAppsLoader",r.loading)("perunWebAppsLoaderIndicator",u)}},dependencies:[y,P,Fe,B,V,j,O,T]});let i=o;return i})();function Pi(i,o){i&1&&b(0,"mat-spinner",3)}function Oi(i,o){if(i&1){let n=A();s(0,"button",15),f("click",function(){v(n);let t=h(3);return S(t.editUser())}),m(1,"translate"),s(2,"mat-icon"),g(3,"edit"),l()()}i&2&&F("matTooltip",d(1,1,"ADMIN_USER.EDIT"))}function Bi(i,o){if(i&1){let n=A();s(0,"button",16),f("click",function(){v(n);let t=h(3);return S(t.anonymizeUser())}),m(1,"translate"),s(2,"mat-icon"),g(3,"no_accounts"),l()()}i&2&&F("matTooltip",d(1,1,"ADMIN_USER.ANONYMIZE"))}function Vi(i,o){if(i&1){let n=A();s(0,"button",16),f("click",function(){v(n);let t=h(3);return S(t.deleteUser())}),m(1,"translate"),s(2,"mat-icon"),g(3,"delete_forever"),l()()}i&2&&F("matTooltip",d(1,1,"ADMIN_USER.DELETE"))}function Ui(i,o){i&1&&(s(0,"mat-icon",17),m(1,"translate"),g(2," blur_off "),l()),i&2&&F("matTooltip",d(1,1,"USER_DETAIL.DASHBOARD.ANONYMIZED"))}function ji(i,o){if(i&1&&(s(0,"span"),_(1,Oi,4,3,"button",12)(2,Bi,4,3,"button",13)(3,Vi,4,3,"button",13)(4,Ui,3,3,"mat-icon",14),l()),i&2){let n=h(2);a(),p("ngIf",!n.anonymized),a(),p("ngIf",!n.anonymized&&!n.userDeletionForced),a(),p("ngIf",n.userDeletionForced),a(),p("ngIf",n.anonymized)}}var Fi=()=>({color:"black"}),Gi=i=>["/admin/users",i];function Hi(i,o){if(i&1&&(s(0,"div",4),b(1,"mat-icon",5),m(2,"translate"),s(3,"div",6)(4,"div",7)(5,"a",8),g(6),m(7,"userFullName"),l(),s(8,"span",9),g(9),l(),_(10,ji,5,4,"span",10),l(),s(11,"div"),g(12),m(13,"translate"),l(),s(14,"span",11),g(15),m(16,"translate"),m(17,"translate"),l()()()),i&2){let n=h();a(),F("matTooltip",d(2,12,"ADMIN_USER.ENTITY")),p("ngStyle",W(22,Fi))("svgIcon",n.svgIcon),a(4),p("routerLink",de(23,Gi,n.user.id)),a(),C(" ",d(7,14,n.user)," "),a(3),C(" \xA0#",n.user.id," "),a(),p("ngIf",n.authResolver.isPerunAdmin()),a(2),Ie("",d(13,16,"ADMIN_USER.UUID"),": ",n.user.uuid,""),a(3),ze(" ",d(16,18,"ADMIN_USER.ENTITY"),", ",d(17,20,"ADMIN_USER.USER_TYPE"),": ",n.getUserType()," ")}}var ci=(()=>{let o=class o{constructor(e,t,r,u,I,w,Y,J,Ge,He){this.route=e,this.attributesService=t,this.usersService=r,this.sideMenuService=u,this.sideMenuItemService=I,this.dialog=w,this.authResolver=Y,this.entityStorageService=J,this.router=Ge,this.store=He,this.loading=!1,this.svgIcon="perun-user-dark"}ngOnInit(){this.loading=!0,this.userDeletionForced=this.store.getProperty("user_deletion_forced"),this.route.params.subscribe(e=>{let t=Number(e.userId);this.entityStorageService.setEntityAndPathParam({id:Number(t),beanName:"User"},Re.User),this.path=`/admin/users/${t}`,this.regex="/admin/users/\\d+",this.usersService.getUserById(t).subscribe({next:u=>{this.user=u,this.svgIcon=this.user.serviceUser?"perun-service-identity":"perun-user-dark";let I=this.sideMenuItemService.parseUser(u,this.path,this.regex);this.sideMenuService.setAdminItems([I]),this.loading=!1},error:()=>this.loading=!1}),this.attributesService.getAttribute("urn:perun:user:attribute-def:virt:anonymized",void 0,void 0,t).subscribe(u=>{this.anonymized=!!u.value})})}editUser(){let e=x();e.width="450px",e.data={theme:"admin-theme",user:this.user},this.dialog.open(Nt,e).afterClosed().subscribe(r=>{r&&this.usersService.getUserById(this.user.id).subscribe(u=>{this.user=u})})}getUserType(){return this.user.serviceUser?"Service":"Person"}anonymizeUser(){this.openDialog(st)}deleteUser(){this.openDialog(lt)}openDialog(e){let t=x();t.width="550px",t.data={theme:"admin-theme",user:this.user},this.dialog.open(e,t).afterClosed().subscribe(u=>{u&&this.router.navigate(["/admin","users"],{queryParamsHandling:"merge"})})}};o.\u0275fac=function(t){return new(t||o)(c(Ae),c(X),c(we),c(le),c(Ue),c(N),c(M),c(q),c(Ee),c(Le))},o.\u0275cmp=E({type:o,selectors:[["app-admin-user-detail-page"]],decls:5,vars:2,consts:[[1,"container-fluid","ps-xl-5","pe-xl-5","user-theme"],["class","me-auto ms-auto",4,"ngIf"],["class","d-flex page-title-headtitle",4,"ngIf"],[1,"me-auto","ms-auto"],[1,"d-flex","page-title-headtitle"],[1,"perun-icon","perun-icon-detail",3,"ngStyle","svgIcon","matTooltip"],[1,"page-title-block"],[1,"page-title-headline","d-flex","align-items-center"],["data-cy","user-name-link",1,"user-link",3,"routerLink"],[1,"text-muted"],[4,"ngIf"],[1,"mt-1","entity-info"],["mat-icon-button","","data-cy","edit-user-button",3,"matTooltip","click",4,"ngIf"],["mat-icon-button","",3,"matTooltip","click",4,"ngIf"],["class","mat-icon-war ms-2",3,"matTooltip",4,"ngIf"],["mat-icon-button","","data-cy","edit-user-button",3,"matTooltip","click"],["mat-icon-button","",3,"matTooltip","click"],[1,"mat-icon-war","ms-2",3,"matTooltip"]],template:function(t,r){t&1&&(s(0,"div",0),b(1,"perun-web-apps-back-button"),_(2,Pi,1,0,"mat-spinner",1)(3,Hi,18,25,"div",2),b(4,"app-animated-router-outlet"),l()),t&2&&(a(2),p("ngIf",r.loading),a(),p("ngIf",!r.loading&&r.user!==void 0))},dependencies:[y,oe,Te,re,ke,ae,se,ce,pe,Oe,T,nt]});let i=o;return i})();function Wi(i,o){i&1&&b(0,"perun-web-apps-loading-table")}var qi=()=>["id","name","type"];function zi(i,o){if(i&1&&b(0,"app-ext-sources-list",7),i&2){let n=h();p("loading",n.loading)("extSources",n.extSources)("filterValue",n.filterValue)("displayedColumns",W(5,qi))("tableId",n.tableId)}}var mi=(()=>{let o=class o{constructor(e,t){this.extSourceService=e,this.authResolver=t,this.extSources=[],this.filterValue="",this.loading=!1,this.tableId=mt}ngOnInit(){this.refreshTable()}applyFilter(e){this.filterValue=e}loadConfigExtSources(){this.loading=!0,this.extSourceService.loadExtSourcesDefinitions().subscribe(()=>{this.refreshTable()})}refreshTable(){this.loading=!0,this.extSourceService.getExtSources().subscribe(e=>{this.extSources=e,this.loading=!1})}};o.\u0275fac=function(t){return new(t||o)(c(Ye),c(M))},o.\u0275cmp=E({type:o,selectors:[["app-admin-ext-sources"]],decls:13,vars:9,consts:[[1,"page-subtitle"],[3,"click"],["mat-stroked-button","",1,"me-2",3,"click"],[3,"placeholder","filter"],["spinner",""],[1,"position-relative","table-min-height"],[3,"loading","extSources","filterValue","displayedColumns","tableId",4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],[3,"loading","extSources","filterValue","displayedColumns","tableId"]],template:function(t,r){if(t&1&&(s(0,"div")(1,"h1",0),g(2),m(3,"translate"),l(),s(4,"perun-web-apps-refresh-button",1),f("click",function(){return r.refreshTable()}),l(),s(5,"button",2),f("click",function(){return r.loadConfigExtSources()}),g(6),m(7,"translate"),l(),s(8,"perun-web-apps-debounce-filter",3),f("filter",function(I){return r.applyFilter(I)}),l(),_(9,Wi,1,0,"ng-template",null,4,k),s(11,"div",5),_(12,zi,1,6,"app-ext-sources-list",6),l()()),t&2){let u=L(10);a(2),D(d(3,5,"ADMIN.EXT_SOURCES.TITLE")),a(4),C(" ",d(7,7,"ADMIN.EXT_SOURCES.LOAD")," "),a(2),p("placeholder","ADMIN.EXT_SOURCES.SEARCH"),a(4),p("perunWebAppsLoader",r.loading)("perunWebAppsLoaderIndicator",u)}},dependencies:[P,At,B,V,j,O,T]});let i=o;return i})();function $i(i,o){i&1&&b(0,"mat-spinner",3)}function Yi(i,o){if(i&1){let n=A();s(0,"button",18),f("click",function(){v(n);let t=h(2);return S(t.editService())}),m(1,"translate"),s(2,"mat-icon"),g(3,"edit"),l()()}i&2&&F("matTooltip",d(1,1,"SERVICE_DETAIL.EDIT"))}function Xi(i,o){if(i&1){let n=A();s(0,"button",19),f("click",function(){v(n);let t=h(2);return S(t.removeService())}),m(1,"translate"),s(2,"mat-icon"),g(3,"delete_forever"),l()()}i&2&&F("matTooltip",d(1,1,"SERVICE_DETAIL.DELETE"))}function Qi(i,o){if(i&1){let n=A();s(0,"button",20),f("click",function(){v(n);let t=h(2);return S(t.evaluateConsents())}),g(1),m(2,"translate"),l()}i&2&&(a(),C(" ",d(2,1,"SERVICE_DETAIL.EVALUATE_CONSENTS")," "))}var Zi=()=>({color:"black"}),di=i=>["/admin/services",i];function Ji(i,o){if(i&1){let n=A();s(0,"div",4),b(1,"mat-icon",5),m(2,"translate"),s(3,"div",6)(4,"div",7)(5,"div",8)(6,"div",9)(7,"a",10),f("auxclick",function(t){return t.preventDefault()}),g(8),l(),s(9,"span",11),g(10),l(),_(11,Yi,4,3,"button",12)(12,Xi,4,3,"button",13),l(),s(13,"span",14),g(14),m(15,"translate"),l()()(),s(16,"div",15)(17,"mat-slide-toggle",16),f("toggleChange",function(){v(n);let t=h();return S(t.changeServiceStatus())}),g(18),m(19,"translate"),l(),s(20,"mat-slide-toggle",16),f("toggleChange",function(){v(n);let t=h();return S(t.groupPropagationChange())}),g(21),m(22,"translate"),l(),s(23,"mat-slide-toggle",16),f("toggleChange",function(){v(n);let t=h();return S(t.voPropagationChange())}),g(24),m(25,"translate"),l(),_(26,Qi,3,3,"button",17),l()()()}if(i&2){let n=h();a(),F("matTooltip",d(2,17,"SERVICE_DETAIL.ENTITY")),p("ngStyle",W(27,Zi)),a(6),p("perunWebAppsMiddleClickRouterLink",de(28,di,n.service.id.toString()))("routerLink",de(30,di,n.service.id)),a(),C(" ",n.service.name," "),a(2),C(" \xA0 #",n.service.id," "),a(),p("ngIf",n.authResolver.isPerunAdmin()),a(),p("ngIf",n.authResolver.isPerunAdmin()),a(2),Ie(" ",d(15,19,"SERVICE_DETAIL.DESCRIPTION"),": ",n.service.description," "),a(3),p("checked",n.service.enabled),a(),C(" ",d(19,21,"SERVICE_DETAIL.ENABLE")," "),a(2),p("checked",n.service.useExpiredMembers),a(),C(" ",d(22,23,"SERVICE_DETAIL.PROPAGATE_GROUP")," "),a(2),p("checked",n.service.useExpiredVoMembers),a(),C(" ",d(25,25,"SERVICE_DETAIL.PROPAGATE_VO")," "),a(2),p("ngIf",n.authResolver.isPerunAdmin())}}var ui=(()=>{let o=class o{constructor(e,t,r,u,I,w,Y,J,Ge,He,Ai){this.route=e,this.router=t,this.consentsManager=r,this.serviceManager=u,this.sideMenuService=I,this.sideMenuItemService=w,this.dialog=Y,this.authResolver=J,this.translate=Ge,this.notificator=He,this.entityStorageService=Ai,this.loading=!1}ngOnInit(){this.loading=!0,this.route.params.subscribe(e=>{this.serviceId=Number(e.serviceId),this.entityStorageService.setEntityAndPathParam({id:this.serviceId,beanName:"Service"},Re.Service),this.refresh()})}editService(){let e=x();e.width="600px",e.data={theme:"service-theme",service:this.service},this.dialog.open(yt,e).afterClosed().subscribe(r=>{r&&this.refresh()})}removeService(){let e=x();e.width="600px",e.data={theme:"service-theme",services:[this.service]},this.dialog.open(Mt,e).afterClosed().subscribe(r=>{r&&this.router.navigate(["/admin/services"],{queryParamsHandling:"preserve"})})}changeServiceStatus(){this.service.enabled=!this.service.enabled,this.serviceManager.updateService({service:this.service}).subscribe(()=>{this.notificator.showSuccess(this.translate.instant("SERVICE_DETAIL.STATUS_CHANGE_SUCCESS"))},()=>this.service.enabled=!this.service.enabled)}groupPropagationChange(){this.service.useExpiredMembers=!this.service.useExpiredMembers,this.serviceManager.updateService({service:this.service}).subscribe({next:()=>{this.notificator.showSuccess(this.translate.instant("SERVICE_DETAIL.PROPAGATION_CHANGE_SUCCESS"))},error:()=>this.service.useExpiredMembers=!this.service.useExpiredMembers})}voPropagationChange(){this.service.useExpiredVoMembers=!this.service.useExpiredVoMembers,this.serviceManager.updateService({service:this.service}).subscribe({next:()=>{this.notificator.showSuccess(this.translate.instant("SERVICE_DETAIL.PROPAGATION_CHANGE_SUCCESS"))},error:()=>this.service.useExpiredVoMembers=!this.service.useExpiredVoMembers})}evaluateConsents(){let e=x();e.width="500px",e.data={title:this.translate.instant("SERVICE_DETAIL.CONFIRM_DIALOG_TITLE"),theme:"service-theme",description:this.translate.instant("SERVICE_DETAIL.CONFIRM_DIALOG_DESCRIPTION"),items:[this.service.name],type:"confirmation",showAsk:!1},this.dialog.open(Be,e).afterClosed().subscribe(r=>{r&&this.consentsManager.evaluateConsentsForService(this.service.id).subscribe(()=>this.notificator.showSuccess(this.translate.instant("SERVICE_DETAIL.EVALUATION_FINISH")))})}refresh(){this.serviceManager.getServiceById(this.serviceId).subscribe(e=>{this.service=e;let t=this.sideMenuItemService.parseService(this.service);this.sideMenuService.setAdminItems([t]),this.loading=!1},()=>this.loading=!1)}};o.\u0275fac=function(t){return new(t||o)(c(Ae),c(Ee),c(xe),c(De),c(le),c(Ue),c(N),c(M),c(ye),c(Q),c(q))},o.\u0275cmp=E({type:o,selectors:[["app-service-detail-page"]],decls:5,vars:2,consts:[[1,"container-fluid","ps-xl-5","pe-xl-5","service-theme"],["class","ms-auto me-auto",4,"ngIf"],["class","page-title-headtitle detail-layout",4,"ngIf"],[1,"ms-auto","me-auto"],[1,"page-title-headtitle","detail-layout"],["svgIcon","perun-service",1,"perun-icon","perun-icon-detail",3,"matTooltip","ngStyle"],[1,"wrap-container"],[1,"detail-info"],[1,"flex-column"],[1,"page-title-headline","d-flex","align-items-center"],["data-cy","service-name-link",1,"service-link",3,"perunWebAppsMiddleClickRouterLink","routerLink","auxclick"],[1,"text-muted"],["aria-label","Edit service","data-cy","service-edit-button","mat-icon-button","",3,"matTooltip","click",4,"ngIf"],["aria-label","Remove service","mat-icon-button","",3,"matTooltip","click",4,"ngIf"],[1,"mt-1","entity-info"],[1,"detail-actions"],["labelPosition","before",1,"mb-25",3,"checked","toggleChange"],["class","action-button evaluate-button","mat-stroked-button","",3,"click",4,"ngIf"],["aria-label","Edit service","data-cy","service-edit-button","mat-icon-button","",3,"matTooltip","click"],["aria-label","Remove service","mat-icon-button","",3,"matTooltip","click"],["mat-stroked-button","",1,"action-button","evaluate-button",3,"click"]],template:function(t,r){t&1&&(s(0,"div",0),b(1,"perun-web-apps-back-button"),_(2,$i,1,0,"mat-spinner",1)(3,Ji,27,32,"div",2),b(4,"app-animated-router-outlet"),l()),t&2&&(a(2),p("ngIf",r.loading),a(),p("ngIf",!r.loading))},dependencies:[y,oe,Te,re,P,ke,ae,se,Ne,ce,pe,at,Oe,T],styles:[".detail-layout[_ngcontent-%COMP%]{display:flex;flex-direction:row;gap:1.2em}.detail-info[_ngcontent-%COMP%]{display:flex;flex-direction:row;margin-right:1.2em}.wrap-container[_ngcontent-%COMP%]{display:flex;flex-direction:row;flex-wrap:wrap;gap:.3em}.detail-actions[_ngcontent-%COMP%]{display:flex;flex-direction:column;border-left:1px solid rgba(0,0,0,.2);padding-left:.5em}.evaluate-button[_ngcontent-%COMP%]{width:fit-content}"],data:{animation:[bt]}});let i=o;return i})();var fi=(()=>{let o=class o{constructor(e){this.entityStorageService=e,this.navItems=[]}ngOnInit(){this.service=this.entityStorageService.getEntity(),this.initNavItems()}initNavItems(){this.navItems=[{cssIcon:"perun-attributes",url:`/admin/services/${this.service.id}/required-attributes`,label:"MENU_ITEMS.SERVICE.REQUIRED_ATTRIBUTES",style:"service-btn"},{cssIcon:"perun-service_destination",url:`/admin/services/${this.service.id}/destinations`,label:"MENU_ITEMS.SERVICE.DESTINATIONS",style:"service-btn"}]}};o.\u0275fac=function(t){return new(t||o)(c(q))},o.\u0275cmp=E({type:o,selectors:[["app-service-overview"]],decls:1,vars:1,consts:[[3,"items"]],template:function(t,r){t&1&&b(0,"perun-web-apps-menu-buttons-field",0),t&2&&p("items",r.navItems)},dependencies:[Ve]});let i=o;return i})();function en(i,o){if(i&1){let n=A();s(0,"button",8),f("click",function(){v(n);let t=h();return S(t.onAdd())}),g(1),m(2,"translate"),l()}i&2&&(a(),C(" ",d(2,1,"SERVICE_DETAIL.REQUIRED_ATTRIBUTES.ADD")," "))}function tn(i,o){if(i&1){let n=A();s(0,"button",9),f("click",function(){v(n);let t=h();return S(t.onRemove())}),g(1),m(2,"translate"),l()}if(i&2){let n=h();p("disabled",n.loading||n.selection.selected.length===0),a(),C(" ",d(2,2,"SERVICE_DETAIL.REQUIRED_ATTRIBUTES.REMOVE")," ")}}function nn(i,o){i&1&&b(0,"perun-web-apps-loading-table")}function on(i,o){if(i&1){let n=A();s(0,"app-attr-def-list",10),f("refreshEvent",function(){v(n);let t=h();return S(t.refreshTable())}),l()}if(i&2){let n=h();p("loading",n.loading)("definitions",n.attrDefinitions)("filterValue",n.filterValue)("selection",n.selection)("cachedSubject",n.cachedSubject)("disableRouting",!n.authResolver.isPerunAdmin())("tableId",n.tableId)}}var hi=(()=>{let o=class o{constructor(e,t,r,u){this.attributeManager=e,this.dialog=t,this.authResolver=r,this.entityStorageService=u,this.loading=!1,this.filterValue="",this.selection=new G(!0,[],!0,(I,w)=>I.id===w.id),this.cachedSubject=new R(!0),this.attrDefinitions=[],this.tableId=ut}ngOnInit(){this.loading=!0,this.service=this.entityStorageService.getEntity(),this.refreshTable()}refreshTable(){this.loading=!0,this.attributeManager.getRequiredAttributesDefinition(this.service.id).subscribe(e=>{this.selection.clear(),this.cachedSubject.next(!0),this.attrDefinitions=e,this.loading=!1})}onAdd(){let e=x();e.width="950px",e.data={serviceId:this.service.id,theme:"service-theme"},this.dialog.open(Lt,e).afterClosed().subscribe(r=>{r&&this.refreshTable()})}onRemove(){let e=x();e.width="650px",e.data={serviceId:this.service.id,attrDefinitions:this.selection.selected,theme:"service-theme"},this.dialog.open(kt,e).afterClosed().subscribe(r=>{r&&this.refreshTable()})}applyFilter(e){this.filterValue=e,this.refreshTable()}};o.\u0275fac=function(t){return new(t||o)(c(X),c(N),c(M),c(q))},o.\u0275cmp=E({type:o,selectors:[["app-service-required-attributes"]],decls:12,vars:8,consts:[[1,"page-subtitle"],[3,"refresh"],["color","accent","class","me-2 action-button","mat-flat-button","",3,"click",4,"ngIf"],["class","me-2","color","warn","mat-flat-button","",3,"disabled","click",4,"ngIf"],[3,"placeholder","filter"],["spinner",""],[1,"position-relative","table-min-height"],[3,"loading","definitions","filterValue","selection","cachedSubject","disableRouting","tableId","refreshEvent",4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],["color","accent","mat-flat-button","",1,"me-2","action-button",3,"click"],["color","warn","mat-flat-button","",1,"me-2",3,"disabled","click"],[3,"loading","definitions","filterValue","selection","cachedSubject","disableRouting","tableId","refreshEvent"]],template:function(t,r){if(t&1&&(s(0,"div")(1,"h1",0),g(2),m(3,"translate"),l(),s(4,"perun-web-apps-refresh-button",1),f("refresh",function(){return r.refreshTable()}),l(),_(5,en,3,3,"button",2)(6,tn,3,4,"button",3),s(7,"perun-web-apps-debounce-filter",4),f("filter",function(I){return r.applyFilter(I)}),l(),_(8,nn,1,0,"ng-template",null,5,k),s(10,"div",6),_(11,on,1,7,"app-attr-def-list",7),l()()),t&2){let u=L(9);a(2),D(d(3,6,"SERVICE_DETAIL.REQUIRED_ATTRIBUTES.TITLE")),a(3),p("ngIf",r.authResolver.isPerunAdmin()),a(),p("ngIf",r.authResolver.isPerunAdmin()),a(),p("placeholder","SERVICE_DETAIL.REQUIRED_ATTRIBUTES.FILTER"),a(4),p("perunWebAppsLoader",r.loading)("perunWebAppsLoaderIndicator",u)}},dependencies:[y,P,Fe,B,V,j,O,T]});let i=o;return i})();function rn(i,o){if(i&1){let n=A();s(0,"button",9),f("click",function(){v(n);let t=h();return S(t.onRemove())}),g(1),m(2,"translate"),l()}if(i&2){let n=h();p("disabled",n.loading||n.selection.selected.length===0),a(),C(" ",d(2,2,"SERVICE_DETAIL.DESTINATIONS.REMOVE")," ")}}function an(i,o){if(i&1){let n=A();s(0,"button",10),f("click",function(){v(n);let t=h();return S(t.onAllow())}),g(1),m(2,"translate"),l()}if(i&2){let n=h();p("disabled",n.loading||n.selection.selected.length===0),a(),C(" ",d(2,2,"SERVICE_DETAIL.DESTINATIONS.ALLOW")," ")}}function sn(i,o){if(i&1){let n=A();s(0,"button",9),f("click",function(){v(n);let t=h();return S(t.onBlock())}),g(1),m(2,"translate"),l()}if(i&2){let n=h();p("disabled",n.loading||n.selection.selected.length===0),a(),C(" ",d(2,2,"SERVICE_DETAIL.DESTINATIONS.BLOCK")," ")}}function ln(i,o){i&1&&b(0,"perun-web-apps-loading-table")}var pn=()=>["select","destinationId","facility","destination","type","status","propagationType"];function cn(i,o){if(i&1&&b(0,"app-perun-web-apps-destination-list",11),i&2){let n=h();p("loading",n.loading)("destinations",n.destinations)("filterValue",n.filterValue)("selection",n.selection)("cachedSubject",n.cachedSubject)("displayedColumns",W(7,pn))("tableId",n.tableId)}}var gi=(()=>{let o=class o{constructor(e,t,r,u,I,w){this.serviceManager=e,this.notificator=t,this.translate=r,this.dialog=u,this.authResolver=I,this.entityStorageService=w,this.loading=!1,this.filterValue="",this.destinations=[],this.selection=new G(!0,[],!0,(Y,J)=>Y.id===J.id),this.cachedSubject=new R(!0),this.tableId=dt}ngOnInit(){this.loading=!0,this.service=this.entityStorageService.getEntity(),this.refreshTable()}refreshTable(){this.loading=!0,this.serviceManager.getAllRichDestinationsForService(this.service.id).subscribe(e=>{this.selection.clear(),this.cachedSubject.next(!0),this.filterValue="",this.destinations=e,this.loading=!1})}onBlock(){this.loading=!0,this.blockServiceOnDestinations(this.selection.selected)}onAllow(){this.loading=!0,this.allowServiceOnDestinations(this.selection.selected)}onRemove(){let e=x();e.width="500px",e.data={destinations:this.selection.selected,theme:"admin-theme"},this.dialog.open(Dt,e).afterClosed().subscribe(r=>{r&&this.refreshTable()})}applyFilter(e){this.filterValue=e,this.refreshTable()}blockServiceOnDestinations(e){this.serviceManager.blockServicesOnDestinations({richDestinations:e}).subscribe({next:()=>{this.notificator.showSuccess(this.translate.instant("SERVICE_DETAIL.DESTINATIONS.BLOCK_SUCCESS")),this.refreshTable()},error:()=>this.loading=!1})}allowServiceOnDestinations(e){this.serviceManager.unblockServicesOnDestinations({richDestinations:e}).subscribe({next:()=>{this.notificator.showSuccess(this.translate.instant("SERVICE_DETAIL.DESTINATIONS.ALLOW_SUCCESS")),this.refreshTable()},error:()=>this.loading=!1})}};o.\u0275fac=function(t){return new(t||o)(c(De),c(Q),c(Me),c(N),c(M),c(q))},o.\u0275cmp=E({type:o,selectors:[["app-service-destinations"]],decls:13,vars:9,consts:[[1,"page-subtitle"],[3,"refresh"],["color","warn","class","me-2","mat-flat-button","",3,"disabled","click",4,"ngIf"],["class","me-2","color","accent","mat-flat-button","",3,"disabled","click",4,"ngIf"],["class","me-2","color","warn","mat-flat-button","",3,"disabled","click",4,"ngIf"],[3,"placeholder","filter"],["spinner",""],[1,"position-relative","table-min-height"],[3,"loading","destinations","filterValue","selection","cachedSubject","displayedColumns","tableId",4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],["color","warn","mat-flat-button","",1,"me-2",3,"disabled","click"],["color","accent","mat-flat-button","",1,"me-2",3,"disabled","click"],[3,"loading","destinations","filterValue","selection","cachedSubject","displayedColumns","tableId"]],template:function(t,r){if(t&1&&(s(0,"div")(1,"h1",0),g(2),m(3,"translate"),l(),s(4,"perun-web-apps-refresh-button",1),f("refresh",function(){return r.refreshTable()}),l(),_(5,rn,3,4,"button",2)(6,an,3,4,"button",3)(7,sn,3,4,"button",4),s(8,"perun-web-apps-debounce-filter",5),f("filter",function(I){return r.applyFilter(I)}),l(),_(9,ln,1,0,"ng-template",null,6,k),s(11,"div",7),_(12,cn,1,8,"app-perun-web-apps-destination-list",8),l()()),t&2){let u=L(10);a(2),D(d(3,7,"SERVICE_DETAIL.DESTINATIONS.TITLE")),a(3),p("ngIf",r.authResolver.isPerunAdmin()),a(),p("ngIf",r.authResolver.isPerunAdmin()),a(),p("ngIf",r.authResolver.isPerunAdmin()),a(),p("placeholder","SERVICE_DETAIL.DESTINATIONS.FILTER"),a(4),p("perunWebAppsLoader",r.loading)("perunWebAppsLoaderIndicator",u)}},dependencies:[y,P,xt,B,V,j,O,T]});let i=o;return i})();function mn(i,o){if(i&1){let n=A();s(0,"button",8),f("click",function(){v(n);let t=h();return S(t.addOwner())}),g(1),m(2,"translate"),l()}i&2&&(a(),C(" ",d(2,1,"ADMIN.OWNERS.ADD")," "))}function dn(i,o){if(i&1){let n=A();s(0,"button",9),f("click",function(){v(n);let t=h();return S(t.removeOwner())}),g(1),m(2,"translate"),l()}if(i&2){let n=h();p("disabled",n.loading||!n.selected.selected.length),a(),C(" ",d(2,2,"ADMIN.OWNERS.DELETE")," ")}}function un(i,o){i&1&&b(0,"perun-web-apps-loading-table")}function fn(i,o){if(i&1&&b(0,"perun-web-apps-owners-list",10),i&2){let n=h();p("selection",n.selected)("cachedSubject",n.cachedSubject)("loading",n.loading)("filterValue",n.filterValue)("owners",n.owners)("tableId",n.tableId)}}var _i=(()=>{let o=class o{constructor(e,t,r){this.ownersManagerService=e,this.dialog=t,this.guiAuthResolver=r,this.owners=[],this.selected=new G(!0,[],!0,(u,I)=>u.id===I.id),this.cachedSubject=new R(!0),this.filterValue="",this.tableId=pt}ngOnInit(){this.setAuth(),this.refreshTable()}setAuth(){this.removeAuth=this.guiAuthResolver.isAuthorized("deleteOwner_Owner_policy",[]),this.addAuth=this.guiAuthResolver.isAuthorized("createOwner_Owner_policy",[])}refreshTable(){this.loading=!0,this.ownersManagerService.getAllOwners().subscribe(e=>{this.owners=e,this.selected.clear(),this.cachedSubject.next(!0),this.loading=!1})}applyFilter(e){this.filterValue=e,this.refreshTable()}addOwner(){let e=x();e.width="400px",e.data={},this.dialog.open(Pt,e).afterClosed().subscribe(r=>{r&&this.refreshTable()})}removeOwner(){let e=x();e.width="400px",e.data=this.selected.selected,this.dialog.open(Ot,e).afterClosed().subscribe(r=>{r&&(this.selected.clear(),this.refreshTable())})}};o.\u0275fac=function(t){return new(t||o)(c(Qe),c(N),c(M))},o.\u0275cmp=E({type:o,selectors:[["app-admin-owners"]],decls:12,vars:8,consts:[[1,"page-subtitle"],[3,"refresh"],["color","accent","class","me-2 action-button","mat-flat-button","",3,"click",4,"ngIf"],["class","me-2","color","warn","mat-flat-button","",3,"disabled","click",4,"ngIf"],[3,"placeholder","filter"],["spinner",""],[1,"position-relative","table-min-height"],[3,"selection","cachedSubject","loading","filterValue","owners","tableId",4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],["color","accent","mat-flat-button","",1,"me-2","action-button",3,"click"],["color","warn","mat-flat-button","",1,"me-2",3,"disabled","click"],[3,"selection","cachedSubject","loading","filterValue","owners","tableId"]],template:function(t,r){if(t&1&&(s(0,"div")(1,"h1",0),g(2),m(3,"translate"),l(),s(4,"perun-web-apps-refresh-button",1),f("refresh",function(){return r.refreshTable()}),l(),_(5,mn,3,3,"button",2)(6,dn,3,4,"button",3),s(7,"perun-web-apps-debounce-filter",4),f("filter",function(I){return r.applyFilter(I)}),l(),_(8,un,1,0,"ng-template",null,5,k),s(10,"div",6),_(11,fn,1,6,"perun-web-apps-owners-list",7),l()()),t&2){let u=L(9);a(2),D(d(3,6,"ADMIN.OWNERS.TITLE")),a(3),p("ngIf",r.addAuth),a(),p("ngIf",r.removeAuth),a(),p("placeholder","ADMIN.OWNERS.FILTER"),a(4),p("perunWebAppsLoader",r.loading)("perunWebAppsLoaderIndicator",u)}},dependencies:[y,P,B,V,j,_t,O,T]});let i=o;return i})();function hn(i,o){i&1&&b(0,"perun-web-apps-loading-table")}function gn(i,o){if(i&1){let n=A();s(0,"app-audit-messages-list",7),f("queryChanged",function(t){v(n);let r=h();return S(r.nextPage.next(t))}),m(1,"async"),m(2,"async"),l()}if(i&2){let n=h();p("loading",d(1,4,n.loading$))("displayedColumns",n.displayedColumns)("auditMessages",d(2,6,n.messagesPage$))("tableId",n.tableId)}}var bi=(()=>{let o=class o{constructor(e){this.auditMessagesManagerService=e,this.tableId=ft,this.displayedColumns=["id","timestamp","name","actor","event.message","detail"],this.selectedEvents=[],this.eventOptions=[],this.eventOptionsForSearchSelect=[],this.nextPage=new R({}),this.messagesPage$=this.nextPage.pipe(ge(t=>this.auditMessagesManagerService.getMessagesPage({query:{offset:t.offset,pageSize:t.pageSize,order:t.order,selectedEvents:this.selectedEvents}})),_e(t=>{this.auditMessages=t.data,setTimeout(()=>this.loadingSubject$.next(!1),200)}),he({data:[],totalCount:0,offset:0,pageSize:0})),this.loadingSubject$=new R(!1),this.loading$=fe(this.loadingSubject$,this.nextPage.pipe(ue(()=>!0)))}ngOnInit(){this.auditMessagesManagerService.findAllPossibleEvents().subscribe(e=>{this.eventOptions=e.sort(),this.eventOptionsForSearchSelect=this.eventOptions})}refreshTable(){this.nextPage.next(this.nextPage.value)}toggleEvent(e){this.selectedEvents.splice(0,this.selectedEvents.length,...e)}refreshOnClosed(){this.selectedEvents=[...this.selectedEvents];let e=this.eventOptions.filter(t=>!this.selectedEvents.includes(t));this.eventOptionsForSearchSelect=[...this.selectedEvents,...e],this.refreshTable()}};o.\u0275fac=function(t){return new(t||o)(c($e))},o.\u0275cmp=E({type:o,selectors:[["app-admin-audit-log"]],decls:11,vars:9,consts:[[1,"page-subtitle"],[1,"align-elements"],[3,"refresh"],[3,"disableDeselectButton","auditLogs","auditLogsSelected","selectClosed"],["spinner",""],[1,"position-relative","w-100","table-min-height"],[3,"loading","displayedColumns","auditMessages","tableId","queryChanged",4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],[3,"loading","displayedColumns","auditMessages","tableId","queryChanged"]],template:function(t,r){if(t&1&&(s(0,"h1",0),g(1),m(2,"translate"),l(),s(3,"div",1)(4,"perun-web-apps-refresh-button",2),f("refresh",function(){return r.refreshTable()}),l(),s(5,"perun-web-apps-audit-log-search-select",3),f("auditLogsSelected",function(I){return r.toggleEvent(I)})("selectClosed",function(){return r.refreshOnClosed()}),l(),_(6,hn,1,0,"ng-template",null,4,k),s(8,"div",5),_(9,gn,3,8,"app-audit-messages-list",6),m(10,"async"),l()()),t&2){let u=L(7);a(),D(d(2,5,"ADMIN.AUDIT_LOG.TITLE")),a(4),p("disableDeselectButton",!1)("auditLogs",r.eventOptionsForSearchSelect),a(4),p("perunWebAppsLoader",d(10,7,r.loading$))("perunWebAppsLoaderIndicator",u)}},dependencies:[Bt,B,V,vt,O,Ce,T]});let i=o;return i})();function bn(i,o){i&1&&(s(0,"perun-web-apps-alert",9),g(1),m(2,"translate"),l()),i&2&&(a(),C(" ",d(2,1,"ADMIN.CONSENT_HUBS.GLOBAL_DISABLED")," "))}function vn(i,o){if(i&1){let n=A();s(0,"button",10),f("click",function(){v(n);let t=h();return S(t.evaluateConsents())}),g(1),m(2,"translate"),l()}if(i&2){let n=h();p("disabled",!n.globalForceConsents||n.loading||n.selection.selected.length===0),a(),C(" ",d(2,2,"ADMIN.CONSENT_HUBS.EVALUATE_CONSENTS")," ")}}function Sn(i,o){i&1&&b(0,"perun-web-apps-loading-table")}function In(i,o){if(i&1&&b(0,"app-perun-web-apps-consent-hubs-list",11),i&2){let n=h();p("loading",n.loading)("consentHubs",n.consentHubs)("selection",n.selection)("cachedSubject",n.cachedSubject)("filterValue",n.filterValue)("tableId",n.tableId)}}var vi=(()=>{let o=class o{constructor(e,t,r,u,I,w){this.consentsManager=e,this.authResolver=t,this.notificator=r,this.translate=u,this.store=I,this.dialog=w,this.loading=!1,this.tableId=ht,this.selection=new G(!0,[],!0,(Y,J)=>Y.id===J.id),this.filterValue="",this.consentHubs=[],this.cachedSubject=new R(!0)}ngOnInit(){this.globalForceConsents=this.store.getProperty("enforce_consents"),this.refreshTable()}applyFilter(e){this.filterValue=e,this.refreshTable()}refreshTable(){this.loading=!0,this.selection.clear(),this.cachedSubject.next(!0),this.consentsManager.getAllConsentHubs().subscribe(e=>{this.consentHubs=e,this.loading=!1})}evaluateConsents(){let e=x();e.width="500px",e.data={title:this.translate.instant("ADMIN.CONSENT_HUBS.CONFIRM_DIALOG_TITLE"),theme:"admin-theme",description:this.translate.instant("ADMIN.CONSENT_HUBS.CONFIRM_DIALOG_DESCRIPTION"),items:this.selection.selected.map(r=>r.name),type:"confirmation",showAsk:!1},this.dialog.open(Be,e).afterClosed().subscribe(r=>{r&&this.evaluateConsentsForConsentHubs()})}evaluateConsentsForConsentHubs(){this.loading=!0;let e=this.selection.selected.map(t=>t.id);this.consentsManager.evaluateConsentsForConsentHubs(e).subscribe({next:()=>{this.notificator.showSuccess(this.translate.instant("ADMIN.CONSENT_HUBS.EVALUATION_FINISH")),this.refreshTable()},error:()=>this.loading=!1})}};o.\u0275fac=function(t){return new(t||o)(c(xe),c(M),c(Q),c(Me),c(Le),c(N))},o.\u0275cmp=E({type:o,selectors:[["app-perun-web-apps-admin-consent-hubs"]],decls:14,vars:12,consts:[[1,"page-subtitle"],["alert_type","warn",4,"ngIf"],[3,"refresh"],[3,"matTooltipDisabled","matTooltip"],["color","accent","class","action-button me-2","mat-flat-button","",3,"disabled","click",4,"ngIf"],[3,"placeholder","filter"],["spinner",""],[1,"position-relative","table-min-height"],[3,"loading","consentHubs","selection","cachedSubject","filterValue","tableId",4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],["alert_type","warn"],["color","accent","mat-flat-button","",1,"action-button","me-2",3,"disabled","click"],[3,"loading","consentHubs","selection","cachedSubject","filterValue","tableId"]],template:function(t,r){if(t&1&&(s(0,"div")(1,"h1",0),g(2),m(3,"translate"),l(),_(4,bn,3,3,"perun-web-apps-alert",1),s(5,"perun-web-apps-refresh-button",2),f("refresh",function(){return r.refreshTable()}),l(),s(6,"span",3),m(7,"translate"),_(8,vn,3,4,"button",4),l(),s(9,"perun-web-apps-debounce-filter",5),f("filter",function(I){return r.applyFilter(I)}),l(),_(10,Sn,1,0,"ng-template",null,6,k),s(12,"div",7),_(13,In,1,6,"app-perun-web-apps-consent-hubs-list",8),l()()),t&2){let u=L(11);a(2),D(d(3,8,"ADMIN.CONSENT_HUBS.TITLE")),a(2),p("ngIf",!r.globalForceConsents),a(2),F("matTooltip",d(7,10,"ADMIN.CONSENT_HUBS.TOOLTIP")),p("matTooltipDisabled",r.globalForceConsents),a(2),p("ngIf",r.authResolver.isPerunAdmin()),a(),p("placeholder","ADMIN.CONSENT_HUBS.SEARCH"),a(4),p("perunWebAppsLoader",r.loading)("perunWebAppsLoaderIndicator",u)}},dependencies:[y,P,se,Vt,Pe,B,V,j,O,T]});let i=o;return i})();function Cn(i,o){if(i&1){let n=A();s(0,"button",10),f("click",function(){v(n);let t=h();return S(t.block())}),g(1),m(2,"translate"),l()}i&2&&(a(),C(" ",d(2,1,"ADMIN.BLOCKED_LOGINS.BLOCK")," "))}function An(i,o){if(i&1){let n=A();s(0,"button",11),f("click",function(){v(n);let t=h();return S(t.unblock())}),m(1,"async"),g(2),m(3,"translate"),l()}if(i&2){let n=h();p("disabled",d(1,2,n.loading$)||n.selection.selected.length===0),a(2),C(" ",d(3,4,"ADMIN.BLOCKED_LOGINS.UNBLOCK")," ")}}function En(i,o){i&1&&b(0,"perun-web-apps-loading-table")}function Tn(i,o){if(i&1){let n=A();s(0,"perun-web-apps-logins-list",12),f("queryChanged",function(t){v(n);let r=h();return S(r.nextPage.next(t))})("downloadAll",function(t){v(n);let r=h();return S(r.downloadAll(t))}),m(1,"async"),m(2,"async"),l()}if(i&2){let n=h();p("loading",d(1,7,n.loading$))("blockedLogins",d(2,9,n.blockedLoginsPage$))("displayedColumns",n.displayedColumns)("selection",n.selection)("filter",n.searchString)("tableId",n.tableId)("cacheSubject",n.cacheSubject)}}var Si=(()=>{let o=class o{constructor(e,t,r,u,I){this.cd=e,this.dialog=t,this.attributesService=r,this.authResolver=u,this.userManager=I,this.tableId=gt,this.isAdmin=!1,this.selection=new G(!0,[],!0,(w,Y)=>w.id===Y.id),this.logins=[],this.namespaceOptions=[],this.filterOptions=[],this.selectedNamespaces=[],this.namespaces=new Je,this.displayedColumns=["checkbox","login","namespace"],this.blockedLogins=[],this.nextPage=new R({}),this.blockedLoginsPage$=this.nextPage.pipe(ge(w=>this.userManager.getBlockedLoginsPage({query:{order:w.order,pageSize:w.pageSize,offset:w.offset,sortColumn:w.sortColumn,searchString:w.searchString,namespaces:this.selectedNamespaces}})),_e(w=>{this.blockedLogins=w.data,this.selection.clear(),setTimeout(()=>this.loadingSubject$.next(!1),200)}),he({data:[],totalCount:0,offset:0,pageSize:0})),this.loadingSubject$=new R(!1),this.cacheSubject=new R(!0),this.loading$=fe(this.loadingSubject$,this.nextPage.pipe(ue(()=>!0)))}refreshTable(){this.cacheSubject.next(!0),this.nextPage.next(this.nextPage.value)}onSearchByString(e){this.searchString=e,this.cd.detectChanges()}ngOnInit(){this.namespaces.setValue(this.selectedNamespaces),this.isAdmin=this.authResolver.isPerunAdmin(),this.attributesService.getAllNamespaces().subscribe(e=>{this.namespaceOptions=e,this.filterOptions=[""].concat(e)})}block(){let e=x();e.width="450px",e.data={theme:"admin-theme",namespaceOptions:this.namespaceOptions},this.dialog.open(jt,e).afterClosed().subscribe(r=>{r&&this.refreshTable()})}unblock(){let e=x();e.width="650px",e.data={logins:this.selection.selected,theme:"admin-theme"},this.dialog.open(Ut,e).afterClosed().subscribe(r=>{r&&this.refreshTable()})}toggleEvent(e){this.selectedNamespaces.splice(0,this.selectedNamespaces.length,...e.map(t=>t===""?null:t))}refreshOnClosed(){this.selectedNamespaces=[...this.selectedNamespaces],this.refreshTable()}downloadAll(e){let t=this.nextPage.getValue();this.userManager.getBlockedLoginsPage({query:{order:t.order,pageSize:e.length,offset:0,sortColumn:t.sortColumn,searchString:t.searchString,namespaces:this.selectedNamespaces}}).subscribe({next:r=>{tt(et(r.data,this.displayedColumns,e.getDataForColumnFun),e.format)}})}};o.\u0275fac=function(t){return new(t||o)(c(qe),c(N),c(X),c(M),c(we))},o.\u0275cmp=E({type:o,selectors:[["app-perun-web-apps-admin-blocked-logins"]],decls:16,vars:18,consts:[[1,"page-subtitle"],[1,"align-elements"],[3,"refresh"],["color","accent","class","me-2 action-button","data-cy","block-logins-button","mat-flat-button","",3,"click",4,"ngIf"],["class","me-2","color","warn","data-cy","unblock-logins-button","mat-flat-button","",3,"disabled","click",4,"ngIf"],[1,"pr-2","me-2","flex-grow-1",3,"namespaceOptions","multiple","disableAutoSelect","disableDeselectButton","customSelectPlaceholder","namespaceSelected","selectClosed"],[1,"search-field","flex-grow-1",3,"autoFocus","placeholder","filter"],["spinner",""],[1,"position-relative","table-min-height"],[3,"loading","blockedLogins","displayedColumns","selection","filter","tableId","cacheSubject","queryChanged","downloadAll",4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],["color","accent","data-cy","block-logins-button","mat-flat-button","",1,"me-2","action-button",3,"click"],["color","warn","data-cy","unblock-logins-button","mat-flat-button","",1,"me-2",3,"disabled","click"],[3,"loading","blockedLogins","displayedColumns","selection","filter","tableId","cacheSubject","queryChanged","downloadAll"]],template:function(t,r){if(t&1&&(s(0,"h1",0),g(1),m(2,"translate"),l(),s(3,"div",1)(4,"div")(5,"perun-web-apps-refresh-button",2),f("refresh",function(){return r.refreshTable()}),l(),_(6,Cn,3,3,"button",3)(7,An,4,6,"button",4),l(),s(8,"perun-web-apps-namespace-search-select",5),f("namespaceSelected",function(I){return r.toggleEvent(I)})("selectClosed",function(){return r.refreshOnClosed()}),m(9,"translate"),l(),s(10,"perun-web-apps-debounce-filter",6),f("filter",function(I){return r.onSearchByString(I)}),l()(),_(11,En,1,0,"ng-template",null,7,k),s(13,"div",8),_(14,Tn,3,11,"perun-web-apps-logins-list",9),m(15,"async"),l()),t&2){let u=L(12);a(),D(d(2,12,"ADMIN.BLOCKED_LOGINS.TITLE")),a(5),p("ngIf",r.isAdmin),a(),p("ngIf",r.isAdmin),a(),p("namespaceOptions",r.filterOptions)("multiple",!0)("disableAutoSelect",!0)("disableDeselectButton",!1)("customSelectPlaceholder",d(9,14,"ADMIN.BLOCKED_LOGINS.FILTER_NAMESPACE")),a(2),p("autoFocus",!0)("placeholder","ADMIN.BLOCKED_LOGINS.SEARCH_PLACEHOLDER"),a(4),p("perunWebAppsLoader",d(15,16,r.loading$))("perunWebAppsLoaderIndicator",u)}},dependencies:[y,P,B,V,j,O,St,It,Ce,T]});let i=o;return i})();function xn(i,o){i&1&&b(0,"mat-spinner",8)}function Dn(i,o){if(i&1&&(s(0,"div",6),_(1,xn,1,0,"mat-spinner",7),l()),i&2){let n=h();a(),p("ngIf",n.loading)}}var Ii=(()=>{let o=class o{constructor(e,t,r,u){this.groupsManager=e,this.tasksManager=t,this.notificator=r,this.translate=u,this.loading=!0}ngOnInit(){this.loading=!0,this.groupsManager.isSuspendedGroupSynchronization().subscribe({next:e=>{this.groupSyncSuspended=e,this.tasksManager.isSuspendedTasksPropagation().subscribe({next:t=>{this.tasksPropSuspended=t,this.loading=!1},error:()=>{this.loading=!1}})},error:()=>{this.loading=!1}})}toggleGroupSuspension(){this.groupSyncSuspended=!this.groupSyncSuspended,this.groupSyncSuspended?this.groupsManager.suspendGroupSynchronization().subscribe({next:()=>{this.notificator.showSuccess(this.translate.instant("ADMIN.TASKS.SYNC_SUSPENDED_SUCCESS"))},error:()=>{this.groupSyncSuspended=!this.groupSyncSuspended}}):this.groupsManager.resumeGroupSynchronization().subscribe({next:()=>{this.notificator.showSuccess(this.translate.instant("ADMIN.TASKS.SYNC_RESUMED_SUCCESS"))},error:()=>{this.groupSyncSuspended=!this.groupSyncSuspended}})}toggleTaskSuspension(){this.tasksPropSuspended=!this.tasksPropSuspended,this.tasksPropSuspended?this.tasksManager.suspendTasksPropagation(!0).subscribe({next:()=>{this.notificator.showSuccess(this.translate.instant("ADMIN.TASKS.PROPAGATION_SUSPENDED_SUCCESS"))},error:()=>{this.tasksPropSuspended=!this.tasksPropSuspended}}):this.tasksManager.resumeTasksPropagation(!0).subscribe({next:()=>{this.notificator.showSuccess(this.translate.instant("ADMIN.TASKS.PROPAGATION_RESUMED_SUCCESS"))},error:()=>{this.tasksPropSuspended=!this.tasksPropSuspended}})}};o.\u0275fac=function(t){return new(t||o)(c(Xe),c(Ze),c(Q),c(ye))},o.\u0275cmp=E({type:o,selectors:[["app-admin-tasks"]],decls:16,vars:17,consts:[[1,"page-subtitle"],["alert_type","info"],[1,"toggles"],["class","spinner-container",4,"ngIf"],["labelPosition","before",1,"mb-2",3,"disabled","checked","change"],["labelPosition","before",3,"disabled","checked","change"],[1,"spinner-container"],["class","ms-auto me-auto",4,"ngIf"],[1,"ms-auto","me-auto"]],template:function(t,r){t&1&&(s(0,"div")(1,"h1",0),g(2),m(3,"translate"),l(),s(4,"div")(5,"perun-web-apps-alert",1),g(6),m(7,"translate"),l()(),s(8,"div",2),_(9,Dn,2,1,"div",3),s(10,"mat-slide-toggle",4),f("change",function(){return r.toggleGroupSuspension()}),g(11),m(12,"translate"),l(),s(13,"mat-slide-toggle",5),f("change",function(){return r.toggleTaskSuspension()}),g(14),m(15,"translate"),l()()()),t&2&&(a(2),D(d(3,9,"ADMIN.TASKS.TITLE")),a(4),D(d(7,11,"ADMIN.TASKS.INFO")),a(3),p("ngIf",r.loading),a(),p("disabled",r.loading)("checked",r.groupSyncSuspended),a(),D(d(12,13,"ADMIN.TASKS.GROUP")),a(2),p("disabled",r.loading)("checked",r.tasksPropSuspended),a(),D(d(15,15,"ADMIN.TASKS.TASKS")))},dependencies:[y,ae,Ne,Pe,T],styles:[".toggles[_ngcontent-%COMP%]{display:flex;flex-direction:column;padding-left:1em}"]});let i=o;return i})();var wn=[{path:"",component:ri,canActivateChild:[je],children:[{path:"",component:ai,data:{animation:"AdminOverviewPage"}},{path:"attributes",component:si,data:{animation:"AdminAttributesPage"}},{path:"users",component:Gt,data:{animation:"AdminUsersPage"}},{path:"owners",component:_i,data:{animation:"AdminOwnersPage"}},{path:"services",component:$t,data:{animation:"AdminServicesPage"}},{path:"audit_log",component:bi,data:{animation:"AdminAuditLogPage"}},{path:"ext_sources",component:mi,data:{animation:"AdminExtSourcesPage"}},{path:"consent_hubs",component:vi,data:{animation:"AdminConsentHubsPage"}},{path:"searcher",component:Qt,data:{animation:"AdminSearcherPage"}},{path:"blocked_logins",component:Si,data:{animation:"AdminBlockedLoginsPage"}},{path:"tasks",component:Ii,data:{animation:"AdminTasksComponent"}}]},{path:"users/:userId",component:ci,canActivateChild:[je],children:[{path:"",component:Ht,data:{animation:"UserOverviewPage"}},{path:"accounts",component:Xt,data:{animation:"UserAccountsPage"}},{path:"assignments",component:Jt,data:{animation:"UserAssignmentsPage"}},{path:"attributes",component:Wt,data:{animation:"UserAttributesPage"}},{path:"identities",component:Kt,data:{animation:"UserIdentitiesPage"}},{path:"identities/:identityId",component:Rt,data:{animation:"UserIdentityDetailPage"}},{path:"roles",component:qt,data:{animation:"UserRolesPage"}},{path:"service-identities",component:zt,data:{animation:"UserServiceIdentities"}},{path:"associated-users",component:Yt,data:{animation:"AssociatedUsersPage"}},{path:"bans",component:Zt,data:{animation:"UserBansPage"}}]},{path:"services/:serviceId",component:ui,canActivateChild:[je],children:[{path:"",component:fi,data:{animation:"ServiceOverviewPage"}},{path:"required-attributes",component:hi,data:{animation:"ServiceRequiredAttributesPage"}},{path:"destinations",component:gi,data:{animation:"ServiceDestinationsPage"}}]}],Ci=(()=>{let o=class o{};o.\u0275fac=function(t){return new(t||o)},o.\u0275mod=ve({type:o}),o.\u0275inj=be({imports:[We.forChild(wn),We]});let i=o;return i})();var Ms=(()=>{let o=class o{};o.\u0275fac=function(t){return new(t||o)},o.\u0275mod=ve({type:o}),o.\u0275inj=be({imports:[Ke,Ci,Ft,it,rt,Ct,ot,ei]});let i=o;return i})();export{Ms as a};
