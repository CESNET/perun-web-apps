import{a as Ut,b as qt,c as Kt}from"./chunk-ZWIACL5N.js";import{a as Oe}from"./chunk-BK2DHELO.js";import{a as Ft,b as jt,c as Ht,d as Wt,e as Gt,f as zt,g as $t,h as Yt,i as Xt,j as Qt}from"./chunk-26PPFL5E.js";import{$f as W,Aa as y,Ab as qe,Ad as Ze,B as fe,Ba as C,Ca as be,Ce as ne,Da as He,Dj as xt,Eb as ze,Ef as rt,Ej as Dt,F as _e,Fd as Je,Gg as pt,Hg as k,Hj as wt,Ia as H,Ib as Ee,Ij as ke,Ja as pe,Jg as ct,Jh as gt,Jj as yt,K as E,Kb as Te,Kc as Ke,Kg as mt,Kh as ht,Ki as St,Kj as Mt,L as ge,Lg as Me,Lh as bt,Ma as m,Na as d,Ng as Re,Nj as Rt,O as v,Oh as vt,P as S,Pf as at,Qa as M,Qb as $e,Qf as st,Qg as dt,Rb as x,Rj as Lt,Sg as ut,Sh as Ne,Sj as Nt,Tb as xe,Tj as Ot,Ud as et,Uf as oe,Uj as kt,Vb as D,Vh as se,Wa as R,Wb as De,Xa as te,Xg as ae,Y as a,Ya as ve,Yj as Bt,Z as c,Zc as ie,Zg as B,Zj as Vt,_ as je,_e as ye,_j as Pt,ab as We,bc as j,be as tt,ca as h,d as ee,fa as p,fg as re,fh as Le,ga as he,hg as O,i as ce,id as T,ja as s,ka as l,kd as Ye,la as b,ld as Xe,m as me,oa as I,ob as Se,oj as It,pa as _,pe as it,ph as P,pj as Ct,qa as f,qc as L,qe as nt,qg as lt,rb as Ie,rj as At,sb as Ce,sj as Et,ta as F,th as ft,ub as Fe,uj as Tt,vh as _t,wb as K,we as ot,x as de,xb as Ge,xc as N,xd as Qe,y as ue,ya as w,yc as we,za as g,zb as Ae}from"./chunk-T6672D7J.js";var vi=()=>({color:"black"}),ii=(()=>{let n=class n{constructor(e){this.sideMenuService=e}ngOnInit(){this.sideMenuService.setAdminItems([])}};n.\u0275fac=function(t){return new(t||n)(c(re))},n.\u0275cmp=E({type:n,selectors:[["app-admin-page"]],decls:7,vars:5,consts:[[1,"container-fluid","ps-xl-5","pe-xl-5","admin-theme"],[1,"page-title","d-flex"],["svgIcon","perun-perun-admin",1,"perun-icon","icon-scale",3,"ngStyle"]],template:function(t,r){t&1&&(s(0,"div",0),b(1,"perun-web-apps-back-button"),s(2,"h1",1),b(3,"mat-icon",2),g(4),m(5,"translate"),l(),b(6,"app-animated-router-outlet"),l()),t&2&&(a(3),p("ngStyle",H(4,vi)),a(),C(" ",d(5,2,"ADMIN.TITLE")," "))},dependencies:[te,ne,se,ae,x]});let i=n;return i})();var ni=(()=>{let n=class n{constructor(){this.items=[{cssIcon:"perun-attributes",url:"/admin/attributes",label:"MENU_ITEMS.ADMIN.ATTRIBUTES",style:"admin-btn"},{cssIcon:"perun-user",url:"/admin/users",label:"MENU_ITEMS.ADMIN.USERS",style:"admin-btn"},{cssIcon:"perun-owner-grey",url:"/admin/owners",label:"MENU_ITEMS.ADMIN.OWNERS",style:"admin-btn"},{cssIcon:"perun-service",url:"/admin/services",label:"MENU_ITEMS.ADMIN.SERVICES",style:"admin-btn"},{cssIcon:"perun-external-sources",url:"/admin/ext_sources",label:"MENU_ITEMS.ADMIN.EXT_SOURCES",style:"admin-btn"},{cssIcon:"perun-audit-log",url:"/admin/audit_log",label:"MENU_ITEMS.ADMIN.AUDIT_LOG",style:"admin-btn"},{cssIcon:"perun-consent-hubs",url:"/admin/consent_hubs",label:"MENU_ITEMS.ADMIN.CONSENT_HUBS",style:"admin-btn"},{cssIcon:"perun-searcher",url:"/admin/searcher",label:"MENU_ITEMS.ADMIN.SEARCHER",style:"admin-btn"},{cssIcon:"perun-blocked-logins",url:"/admin/blocked_logins",label:"MENU_ITEMS.ADMIN.BLOCKED_LOGINS",style:"admin-btn"}]}};n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=E({type:n,selectors:[["app-admin-overview"]],hostVars:2,hostBindings:function(t,r){t&2&&he("router-component",r.true)},decls:2,vars:1,consts:[[3,"items"]],template:function(t,r){t&1&&(s(0,"div"),b(1,"perun-web-apps-menu-buttons-field",0),l()),t&2&&(a(),p("items",r.items))},dependencies:[Le]});let i=n;return i})();function Ci(i,n){if(i&1){let o=I();s(0,"button",9),_("click",function(){v(o);let t=f();return S(t.onCreate())}),g(1),m(2,"translate"),l()}i&2&&(a(),C(" ",d(2,1,"ADMIN.ATTRIBUTES.CREATE")," "))}function Ai(i,n){if(i&1){let o=I();s(0,"button",10),_("click",function(){v(o);let t=f();return S(t.onImport())}),g(1),m(2,"translate"),l()}i&2&&(a(),C(" ",d(2,1,"ADMIN.ATTRIBUTES.IMPORT")," "))}function Ei(i,n){if(i&1){let o=I();s(0,"button",11),_("click",function(){v(o);let t=f();return S(t.onDelete())}),g(1),m(2,"translate"),l()}if(i&2){let o=f();p("disabled",o.selected.selected.length===0),a(),C(" ",d(2,2,"ADMIN.ATTRIBUTES.DELETE")," ")}}function Ti(i,n){i&1&&b(0,"perun-web-apps-loading-table")}function xi(i,n){if(i&1){let o=I();s(0,"app-attr-def-list",12),_("refreshEvent",function(){v(o);let t=f();return S(t.refreshTable())}),l()}if(i&2){let o=f();p("loading",o.loading)("definitions",o.attrDefinitions)("disableRouting",!o.authResolver.isPerunAdminOrObserver())("filterValue",o.filterValue)("selection",o.selected)("tableId",o.tableId)}}var oi=(()=>{let n=class n{constructor(e,t,r){this.dialog=e,this.attributesManager=t,this.authResolver=r,this.attrDefinitions=[],this.selected=new j(!0,[]),this.filterValue="",this.tableId=Ze}ngOnInit(){this.refreshTable()}onCreate(){let e=T();e.width="650px",this.dialog.open(Ct,e).afterClosed().subscribe(r=>{r&&this.refreshTable()})}onDelete(){let e=T();e.width="450px",e.data={attributes:this.selected.selected,theme:"admin-theme"},this.dialog.open(It,e).afterClosed().subscribe(r=>{r&&(this.refreshTable(),this.selected.clear())})}refreshTable(){this.loading=!0,this.attributesManager.getAllAttributeDefinitions().subscribe(e=>{this.attrDefinitions=e,this.loading=!1})}applyFilter(e){this.filterValue=e}onImport(){let e=T();e.width="700px",this.dialog.open(Tt,e).afterClosed().subscribe(r=>{r===!0&&this.refreshTable()})}};n.\u0275fac=function(t){return new(t||n)(c(L),c(K),c(D))},n.\u0275cmp=E({type:n,selectors:[["app-admin-attributes"]],hostVars:2,hostBindings:function(t,r){t&2&&he("router-component",r.true)},decls:13,vars:9,consts:[[1,"page-subtitle"],[3,"refresh"],["class","me-2 action-button","color","accent","data-cy","new-attr-definition-button","mat-flat-button","",3,"click",4,"ngIf"],["class","me-2 action-button","color","accent","mat-flat-button","",3,"click",4,"ngIf"],["color","warn","class","me-2","data-cy","delete-attr-definition-button","mat-flat-button","",3,"disabled","click",4,"ngIf"],[3,"placeholder","filter"],["spinner",""],[1,"position-relative","table-min-height"],[3,"loading","definitions","disableRouting","filterValue","selection","tableId","refreshEvent",4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],["color","accent","data-cy","new-attr-definition-button","mat-flat-button","",1,"me-2","action-button",3,"click"],["color","accent","mat-flat-button","",1,"me-2","action-button",3,"click"],["color","warn","data-cy","delete-attr-definition-button","mat-flat-button","",1,"me-2",3,"disabled","click"],[3,"loading","definitions","disableRouting","filterValue","selection","tableId","refreshEvent"]],template:function(t,r){if(t&1&&(s(0,"div")(1,"h1",0),g(2),m(3,"translate"),l(),s(4,"perun-web-apps-refresh-button",1),_("refresh",function(){return r.refreshTable()}),l(),h(5,Ci,3,3,"button",2)(6,Ai,3,3,"button",3)(7,Ei,3,4,"button",4),s(8,"perun-web-apps-debounce-filter",5),_("filter",function(A){return r.applyFilter(A)}),l(),h(9,Ti,1,0,"ng-template",null,6,M),s(11,"div",7),h(12,xi,1,6,"app-attr-def-list",8),l()()),t&2){let u=w(10);a(2),y(d(3,7,"ADMIN.ATTRIBUTES.TITLE")),a(3),p("ngIf",r.authResolver.isPerunAdmin()),a(),p("ngIf",r.authResolver.isPerunAdmin()),a(),p("ngIf",r.authResolver.isPerunAdmin()),a(),p("placeholder","ADMIN.ATTRIBUTES.SEARCH"),a(4),p("perunWebAppsLoader",r.loading)("perunWebAppsLoaderIndicator",u)}},dependencies:[R,N,ke,k,B,P,O,x]});let i=n;return i})();function Ri(i,n){i&1&&b(0,"mat-spinner",3)}function Li(i,n){if(i&1){let o=I();s(0,"button",15),_("click",function(){v(o);let t=f(3);return S(t.editUser())}),m(1,"translate"),s(2,"mat-icon"),g(3,"edit"),l()()}i&2&&F("matTooltip",d(1,1,"ADMIN_USER.EDIT"))}function Ni(i,n){if(i&1){let o=I();s(0,"button",16),_("click",function(){v(o);let t=f(3);return S(t.anonymizeUser())}),m(1,"translate"),s(2,"mat-icon"),g(3,"no_accounts"),l()()}i&2&&F("matTooltip",d(1,1,"ADMIN_USER.ANONYMIZE"))}function Oi(i,n){if(i&1){let o=I();s(0,"button",16),_("click",function(){v(o);let t=f(3);return S(t.deleteUser())}),m(1,"translate"),s(2,"mat-icon"),g(3,"delete_forever"),l()()}i&2&&F("matTooltip",d(1,1,"ADMIN_USER.DELETE"))}function ki(i,n){i&1&&(s(0,"mat-icon",17),m(1,"translate"),g(2," blur_off "),l()),i&2&&F("matTooltip",d(1,1,"USER_DETAIL.DASHBOARD.ANONYMIZED"))}function Bi(i,n){if(i&1&&(s(0,"span"),h(1,Li,4,3,"button",12)(2,Ni,4,3,"button",13)(3,Oi,4,3,"button",13)(4,ki,3,3,"mat-icon",14),l()),i&2){let o=f(2);a(),p("ngIf",!o.anonymized),a(),p("ngIf",!o.anonymized&&!o.userDeletionForced),a(),p("ngIf",o.userDeletionForced),a(),p("ngIf",o.anonymized)}}var Vi=()=>({color:"black"}),Pi=i=>["/admin/users",i];function Ui(i,n){if(i&1&&(s(0,"div",4),b(1,"mat-icon",5),m(2,"translate"),s(3,"div",6)(4,"div",7)(5,"a",8),g(6),m(7,"userFullName"),l(),s(8,"span",9),g(9),l(),h(10,Bi,5,4,"span",10),l(),s(11,"div"),g(12),m(13,"translate"),l(),s(14,"span",11),g(15),m(16,"translate"),m(17,"translate"),l()()()),i&2){let o=f();a(),F("matTooltip",d(2,12,"ADMIN_USER.ENTITY")),p("ngStyle",H(22,Vi))("svgIcon",o.svgIcon),a(4),p("routerLink",pe(23,Pi,o.user.id)),a(),C(" ",d(7,14,o.user)," "),a(3),C(" \xA0#",o.user.id," "),a(),p("ngIf",o.authResolver.isPerunAdmin()),a(2),be("",d(13,16,"ADMIN_USER.UUID"),": ",o.user.uuid,""),a(3),He(" ",d(16,18,"ADMIN_USER.ENTITY"),", ",d(17,20,"ADMIN_USER.USER_TYPE"),": ",o.getUserType()," ")}}var ai=(()=>{let n=class n{constructor(e,t,r,u,A,V,Be,Ve,Pe,Ue){this.route=e,this.attributesService=t,this.usersService=r,this.sideMenuService=u,this.sideMenuItemService=A,this.dialog=V,this.authResolver=Be,this.entityStorageService=Ve,this.router=Pe,this.store=Ue,this.loading=!1,this.svgIcon="perun-user-dark"}ngOnInit(){this.loading=!0,this.userDeletionForced=this.store.getProperty("user_deletion_forced"),this.route.params.subscribe(e=>{let t=Number(e.userId);this.entityStorageService.setEntity({id:Number(t),beanName:"User"}),this.path=`/admin/users/${t}`,this.regex="/admin/users/\\d+",this.usersService.getUserById(t).subscribe({next:u=>{this.user=u,this.svgIcon=this.user.serviceUser?"perun-service-identity":"perun-user-dark";let A=this.sideMenuItemService.parseUser(u,this.path,this.regex);this.sideMenuService.setAdminItems([A]),this.loading=!1},error:()=>this.loading=!1}),this.attributesService.getAttribute("urn:perun:user:attribute-def:virt:anonymized",void 0,void 0,t).subscribe(u=>{this.anonymized=!!u.value})})}editUser(){let e=T();e.width="450px",e.data={theme:"admin-theme",user:this.user},this.dialog.open(Rt,e).afterClosed().subscribe(r=>{r&&this.usersService.getUserById(this.user.id).subscribe(u=>{this.user=u})})}getUserType(){return this.user.serviceUser?"Service":"Person"}anonymizeUser(){this.openDialog(dt)}deleteUser(){this.openDialog(ut)}openDialog(e){let t=T();t.width="550px",t.data={theme:"admin-theme",user:this.user},this.dialog.open(e,t).afterClosed().subscribe(u=>{u&&this.router.navigate(["/admin","users"],{queryParamsHandling:"merge"})})}};n.\u0275fac=function(t){return new(t||n)(c(Se),c(K),c(Te),c(re),c(Ne),c(L),c(D),c(W),c(Ie),c(De))},n.\u0275cmp=E({type:n,selectors:[["app-admin-user-detail-page"]],decls:5,vars:2,consts:[[1,"container-fluid","ps-xl-5","pe-xl-5","user-theme"],["class","me-auto ms-auto",4,"ngIf"],["class","d-flex page-title-headtitle",4,"ngIf"],[1,"me-auto","ms-auto"],[1,"d-flex","page-title-headtitle"],[1,"perun-icon","perun-icon-detail",3,"ngStyle","svgIcon","matTooltip"],[1,"page-title-block"],[1,"page-title-headline","d-flex","align-items-center"],["data-cy","user-name-link",1,"user-link",3,"routerLink"],[1,"text-muted"],[4,"ngIf"],[1,"mt-1","entity-info"],["mat-icon-button","","data-cy","edit-user-button",3,"matTooltip","click",4,"ngIf"],["mat-icon-button","",3,"matTooltip","click",4,"ngIf"],["class","mat-icon-war ms-2",3,"matTooltip",4,"ngIf"],["mat-icon-button","","data-cy","edit-user-button",3,"matTooltip","click"],["mat-icon-button","",3,"matTooltip","click"],[1,"mat-icon-war","ms-2",3,"matTooltip"]],template:function(t,r){t&1&&(s(0,"div",0),b(1,"perun-web-apps-back-button"),h(2,Ri,1,0,"mat-spinner",1)(3,Ui,18,25,"div",2),b(4,"app-animated-router-outlet"),l()),t&2&&(a(2),p("ngIf",r.loading),a(),p("ngIf",!r.loading&&r.user!==void 0))},dependencies:[R,te,Ce,ne,we,ye,ie,se,ae,Me,x,lt]});let i=n;return i})();function Fi(i,n){i&1&&b(0,"perun-web-apps-loading-table")}var ji=()=>["id","name","type"];function Hi(i,n){if(i&1&&b(0,"app-ext-sources-list",7),i&2){let o=f();p("loading",o.loading)("extSources",o.extSources)("filterValue",o.filterValue)("displayedColumns",H(5,ji))("tableId",o.tableId)}}var si=(()=>{let n=class n{constructor(e,t){this.extSourceService=e,this.authResolver=t,this.extSources=[],this.filterValue="",this.loading=!1,this.tableId=Je}ngOnInit(){this.refreshTable()}applyFilter(e){this.filterValue=e}loadConfigExtSources(){this.loading=!0,this.extSourceService.loadExtSourcesDefinitions().subscribe(()=>{this.refreshTable()})}refreshTable(){this.loading=!0,this.extSourceService.getExtSources().subscribe(e=>{this.extSources=e,this.loading=!1})}};n.\u0275fac=function(t){return new(t||n)(c(qe),c(D))},n.\u0275cmp=E({type:n,selectors:[["app-admin-ext-sources"]],decls:13,vars:9,consts:[[1,"page-subtitle"],[3,"click"],["mat-stroked-button","",1,"me-2",3,"click"],[3,"placeholder","filter"],["spinner",""],[1,"position-relative","table-min-height"],[3,"loading","extSources","filterValue","displayedColumns","tableId",4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],[3,"loading","extSources","filterValue","displayedColumns","tableId"]],template:function(t,r){if(t&1&&(s(0,"div")(1,"h1",0),g(2),m(3,"translate"),l(),s(4,"perun-web-apps-refresh-button",1),_("click",function(){return r.refreshTable()}),l(),s(5,"button",2),_("click",function(){return r.loadConfigExtSources()}),g(6),m(7,"translate"),l(),s(8,"perun-web-apps-debounce-filter",3),_("filter",function(A){return r.applyFilter(A)}),l(),h(9,Fi,1,0,"ng-template",null,4,M),s(11,"div",5),h(12,Hi,1,6,"app-ext-sources-list",6),l()()),t&2){let u=w(10);a(2),y(d(3,5,"ADMIN.EXT_SOURCES.TITLE")),a(4),C(" ",d(7,7,"ADMIN.EXT_SOURCES.LOAD")," "),a(2),p("placeholder","ADMIN.EXT_SOURCES.SEARCH"),a(4),p("perunWebAppsLoader",r.loading)("perunWebAppsLoaderIndicator",u)}},dependencies:[N,St,k,B,P,O,x]});let i=n;return i})();function Wi(i,n){i&1&&b(0,"mat-spinner",3)}function Gi(i,n){if(i&1){let o=I();s(0,"button",18),_("click",function(){v(o);let t=f(2);return S(t.editService())}),m(1,"translate"),s(2,"mat-icon"),g(3,"edit"),l()()}i&2&&F("matTooltip",d(1,1,"SERVICE_DETAIL.EDIT"))}function qi(i,n){if(i&1){let o=I();s(0,"button",19),_("click",function(){v(o);let t=f(2);return S(t.removeService())}),m(1,"translate"),s(2,"mat-icon"),g(3,"delete_forever"),l()()}i&2&&F("matTooltip",d(1,1,"SERVICE_DETAIL.DELETE"))}function zi(i,n){if(i&1){let o=I();s(0,"button",20),_("click",function(){v(o);let t=f(2);return S(t.evaluateConsents())}),g(1),m(2,"translate"),l()}i&2&&(a(),C(" ",d(2,1,"SERVICE_DETAIL.EVALUATE_CONSENTS")," "))}var $i=()=>({color:"black"}),li=i=>["/admin/services",i];function Ki(i,n){if(i&1){let o=I();s(0,"div",4),b(1,"mat-icon",5),m(2,"translate"),s(3,"div",6)(4,"div",7)(5,"div",8)(6,"div",9)(7,"a",10),_("auxclick",function(t){return t.preventDefault()}),g(8),l(),s(9,"span",11),g(10),l(),h(11,Gi,4,3,"button",12)(12,qi,4,3,"button",13),l(),s(13,"span",14),g(14),m(15,"translate"),l()()(),s(16,"div",15)(17,"mat-slide-toggle",16),_("toggleChange",function(){v(o);let t=f();return S(t.changeServiceStatus())}),g(18),m(19,"translate"),l(),s(20,"mat-slide-toggle",16),_("toggleChange",function(){v(o);let t=f();return S(t.propagationChange())}),g(21),m(22,"translate"),l(),h(23,zi,3,3,"button",17),l()()()}if(i&2){let o=f();a(),F("matTooltip",d(2,15,"SERVICE_DETAIL.ENTITY")),p("ngStyle",H(23,$i)),a(6),p("perunWebAppsMiddleClickRouterLink",pe(24,li,o.service.id.toString()))("routerLink",pe(26,li,o.service.id)),a(),C(" ",o.service.name," "),a(2),C(" \xA0 #",o.service.id," "),a(),p("ngIf",o.authResolver.isPerunAdmin()),a(),p("ngIf",o.authResolver.isPerunAdmin()),a(2),be(" ",d(15,17,"SERVICE_DETAIL.DESCRIPTION"),": ",o.service.description," "),a(3),p("checked",o.service.enabled),a(),C(" ",d(19,19,"SERVICE_DETAIL.ENABLE")," "),a(2),p("checked",o.service.useExpiredMembers),a(),C(" ",d(22,21,"SERVICE_DETAIL.PROPAGATE")," "),a(2),p("ngIf",o.authResolver.isPerunAdmin())}}var pi=(()=>{let n=class n{constructor(e,t,r,u,A,V,Be,Ve,Pe,Ue,bi){this.route=e,this.router=t,this.consentsManager=r,this.serviceManager=u,this.sideMenuService=A,this.sideMenuItemService=V,this.dialog=Be,this.authResolver=Ve,this.translate=Pe,this.notificator=Ue,this.entityStorageService=bi,this.loading=!1}ngOnInit(){this.loading=!0,this.route.params.subscribe(e=>{this.serviceId=Number(e.serviceId),this.entityStorageService.setEntity({id:this.serviceId,beanName:"Service"}),this.refresh()})}editService(){let e=T();e.width="600px",e.data={theme:"service-theme",service:this.service},this.dialog.open(xt,e).afterClosed().subscribe(r=>{r&&this.refresh()})}removeService(){let e=T();e.width="600px",e.data={theme:"service-theme",services:[this.service]},this.dialog.open(Dt,e).afterClosed().subscribe(r=>{r&&this.router.navigate(["/admin/services"],{queryParamsHandling:"preserve"})})}changeServiceStatus(){this.service.enabled=!this.service.enabled,this.serviceManager.updateService({service:this.service}).subscribe(()=>{this.notificator.showSuccess(this.translate.instant("SERVICE_DETAIL.STATUS_CHANGE_SUCCESS"))},()=>this.service.enabled=!this.service.enabled)}propagationChange(){this.service.useExpiredMembers=!this.service.useExpiredMembers,this.serviceManager.updateService({service:this.service}).subscribe(()=>{this.notificator.showSuccess(this.translate.instant("SERVICE_DETAIL.PROPAGATION_CHANGE_SUCCESS"))},()=>this.service.useExpiredMembers=!this.service.useExpiredMembers)}evaluateConsents(){let e=T();e.width="500px",e.data={title:this.translate.instant("SERVICE_DETAIL.CONFIRM_DIALOG_TITLE"),theme:"service-theme",description:this.translate.instant("SERVICE_DETAIL.CONFIRM_DIALOG_DESCRIPTION"),items:[this.service.name],type:"confirmation",showAsk:!1},this.dialog.open(Re,e).afterClosed().subscribe(r=>{r&&this.consentsManager.evaluateConsentsForService(this.service.id).subscribe(()=>this.notificator.showSuccess(this.translate.instant("SERVICE_DETAIL.EVALUATION_FINISH")))})}refresh(){this.serviceManager.getServiceById(this.serviceId).subscribe(e=>{this.service=e;let t=this.sideMenuItemService.parseService(this.service);this.sideMenuService.setAdminItems([t]),this.loading=!1},()=>this.loading=!1)}};n.\u0275fac=function(t){return new(t||n)(c(Se),c(Ie),c(Ae),c(Ee),c(re),c(Ne),c(L),c(D),c($e),c(oe),c(W))},n.\u0275cmp=E({type:n,selectors:[["app-service-detail-page"]],decls:5,vars:2,consts:[[1,"container-fluid","ps-xl-5","pe-xl-5","service-theme"],["class","ms-auto me-auto",4,"ngIf"],["class","page-title-headtitle detail-layout",4,"ngIf"],[1,"ms-auto","me-auto"],[1,"page-title-headtitle","detail-layout"],["svgIcon","perun-service",1,"perun-icon","perun-icon-detail",3,"matTooltip","ngStyle"],[1,"wrap-container"],[1,"detail-info"],[1,"flex-column"],[1,"page-title-headline","d-flex","align-items-center"],["data-cy","service-name-link",1,"service-link",3,"perunWebAppsMiddleClickRouterLink","routerLink","auxclick"],[1,"text-muted"],["aria-label","Edit service","data-cy","service-edit-button","mat-icon-button","",3,"matTooltip","click",4,"ngIf"],["aria-label","Remove service","mat-icon-button","",3,"matTooltip","click",4,"ngIf"],[1,"mt-1","entity-info"],[1,"detail-actions"],["labelPosition","before",1,"mb-25",3,"checked","toggleChange"],["class","action-button evaluate-button","mat-stroked-button","",3,"click",4,"ngIf"],["aria-label","Edit service","data-cy","service-edit-button","mat-icon-button","",3,"matTooltip","click"],["aria-label","Remove service","mat-icon-button","",3,"matTooltip","click"],["mat-stroked-button","",1,"action-button","evaluate-button",3,"click"]],template:function(t,r){t&1&&(s(0,"div",0),b(1,"perun-web-apps-back-button"),h(2,Wi,1,0,"mat-spinner",1)(3,Ki,24,28,"div",2),b(4,"app-animated-router-outlet"),l()),t&2&&(a(2),p("ngIf",r.loading),a(),p("ngIf",!r.loading))},dependencies:[R,te,Ce,ne,N,we,ye,ie,rt,se,ae,mt,Me,x],styles:[".detail-layout[_ngcontent-%COMP%]{display:flex;flex-direction:row;gap:1.2em}.detail-info[_ngcontent-%COMP%]{display:flex;flex-direction:row;margin-right:1.2em}.wrap-container[_ngcontent-%COMP%]{display:flex;flex-direction:row;flex-wrap:wrap;gap:.3em}.detail-actions[_ngcontent-%COMP%]{display:flex;flex-direction:column;border-left:1px solid rgba(0,0,0,.2);padding-left:.5em}.evaluate-button[_ngcontent-%COMP%]{width:fit-content}"],data:{animation:[_t]}});let i=n;return i})();var ci=(()=>{let n=class n{constructor(e){this.entityStorageService=e,this.navItems=[]}ngOnInit(){this.service=this.entityStorageService.getEntity(),this.initNavItems()}initNavItems(){this.navItems=[{cssIcon:"perun-attributes",url:`/admin/services/${this.service.id}/required-attributes`,label:"MENU_ITEMS.SERVICE.REQUIRED_ATTRIBUTES",style:"service-btn"},{cssIcon:"perun-service_destination",url:`/admin/services/${this.service.id}/destinations`,label:"MENU_ITEMS.SERVICE.DESTINATIONS",style:"service-btn"}]}};n.\u0275fac=function(t){return new(t||n)(c(W))},n.\u0275cmp=E({type:n,selectors:[["app-service-overview"]],decls:1,vars:1,consts:[[3,"items"]],template:function(t,r){t&1&&b(0,"perun-web-apps-menu-buttons-field",0),t&2&&p("items",r.navItems)},dependencies:[Le]});let i=n;return i})();function Yi(i,n){if(i&1){let o=I();s(0,"button",8),_("click",function(){v(o);let t=f();return S(t.onAdd())}),g(1),m(2,"translate"),l()}i&2&&(a(),C(" ",d(2,1,"SERVICE_DETAIL.REQUIRED_ATTRIBUTES.ADD")," "))}function Xi(i,n){if(i&1){let o=I();s(0,"button",9),_("click",function(){v(o);let t=f();return S(t.onRemove())}),g(1),m(2,"translate"),l()}if(i&2){let o=f();p("disabled",o.selection.selected.length===0),a(),C(" ",d(2,2,"SERVICE_DETAIL.REQUIRED_ATTRIBUTES.REMOVE")," ")}}function Qi(i,n){i&1&&b(0,"perun-web-apps-loading-table")}function Zi(i,n){if(i&1){let o=I();s(0,"app-attr-def-list",10),_("refreshEvent",function(){v(o);let t=f();return S(t.refreshTable())}),l()}if(i&2){let o=f();p("loading",o.loading)("definitions",o.attrDefinitions)("filterValue",o.filterValue)("selection",o.selection)("disableRouting",!o.authResolver.isPerunAdmin())("tableId",o.tableId)}}var mi=(()=>{let n=class n{constructor(e,t,r,u){this.attributeManager=e,this.dialog=t,this.authResolver=r,this.entityStorageService=u,this.loading=!1,this.filterValue="",this.selection=new j(!0,[]),this.attrDefinitions=[],this.tableId=tt}ngOnInit(){this.loading=!0,this.service=this.entityStorageService.getEntity(),this.refreshTable()}refreshTable(){this.loading=!0,this.attributeManager.getRequiredAttributesDefinition(this.service.id).subscribe(e=>{this.selection.clear(),this.attrDefinitions=e,this.loading=!1})}onAdd(){let e=T();e.width="950px",e.data={serviceId:this.service.id,theme:"service-theme"},this.dialog.open(yt,e).afterClosed().subscribe(r=>{r&&this.refreshTable()})}onRemove(){let e=T();e.width="650px",e.data={serviceId:this.service.id,attrDefinitions:this.selection.selected,theme:"service-theme"},this.dialog.open(Mt,e).afterClosed().subscribe(r=>{r&&this.refreshTable()})}applyFilter(e){this.filterValue=e}};n.\u0275fac=function(t){return new(t||n)(c(K),c(L),c(D),c(W))},n.\u0275cmp=E({type:n,selectors:[["app-service-required-attributes"]],decls:12,vars:8,consts:[[1,"page-subtitle"],[3,"refresh"],["color","accent","class","me-2 action-button","mat-flat-button","",3,"click",4,"ngIf"],["class","me-2","color","warn","mat-flat-button","",3,"disabled","click",4,"ngIf"],[3,"placeholder","filter"],["spinner",""],[1,"position-relative","table-min-height"],[3,"loading","definitions","filterValue","selection","disableRouting","tableId","refreshEvent",4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],["color","accent","mat-flat-button","",1,"me-2","action-button",3,"click"],["color","warn","mat-flat-button","",1,"me-2",3,"disabled","click"],[3,"loading","definitions","filterValue","selection","disableRouting","tableId","refreshEvent"]],template:function(t,r){if(t&1&&(s(0,"div")(1,"h1",0),g(2),m(3,"translate"),l(),s(4,"perun-web-apps-refresh-button",1),_("refresh",function(){return r.refreshTable()}),l(),h(5,Yi,3,3,"button",2)(6,Xi,3,4,"button",3),s(7,"perun-web-apps-debounce-filter",4),_("filter",function(A){return r.applyFilter(A)}),l(),h(8,Qi,1,0,"ng-template",null,5,M),s(10,"div",6),h(11,Zi,1,6,"app-attr-def-list",7),l()()),t&2){let u=w(9);a(2),y(d(3,6,"SERVICE_DETAIL.REQUIRED_ATTRIBUTES.TITLE")),a(3),p("ngIf",r.authResolver.isPerunAdmin()),a(),p("ngIf",r.authResolver.isPerunAdmin()),a(),p("placeholder","SERVICE_DETAIL.REQUIRED_ATTRIBUTES.FILTER"),a(4),p("perunWebAppsLoader",r.loading)("perunWebAppsLoaderIndicator",u)}},dependencies:[R,N,ke,k,B,P,O,x]});let i=n;return i})();function Ji(i,n){if(i&1){let o=I();s(0,"button",9),_("click",function(){v(o);let t=f();return S(t.onRemove())}),g(1),m(2,"translate"),l()}if(i&2){let o=f();p("disabled",o.selection.selected.length===0),a(),C(" ",d(2,2,"SERVICE_DETAIL.DESTINATIONS.REMOVE")," ")}}function en(i,n){if(i&1){let o=I();s(0,"button",10),_("click",function(){v(o);let t=f();return S(t.onAllow())}),g(1),m(2,"translate"),l()}if(i&2){let o=f();p("disabled",o.selection.selected.length===0),a(),C(" ",d(2,2,"SERVICE_DETAIL.DESTINATIONS.ALLOW")," ")}}function tn(i,n){if(i&1){let o=I();s(0,"button",9),_("click",function(){v(o);let t=f();return S(t.onBlock())}),g(1),m(2,"translate"),l()}if(i&2){let o=f();p("disabled",o.selection.selected.length===0),a(),C(" ",d(2,2,"SERVICE_DETAIL.DESTINATIONS.BLOCK")," ")}}function nn(i,n){i&1&&b(0,"perun-web-apps-loading-table")}var on=()=>["select","destinationId","facility","destination","type","status","propagationType"];function rn(i,n){if(i&1&&b(0,"app-perun-web-apps-destination-list",11),i&2){let o=f();p("loading",o.loading)("destinations",o.destinations)("filterValue",o.filterValue)("selection",o.selection)("displayedColumns",H(6,on))("tableId",o.tableId)}}var di=(()=>{let n=class n{constructor(e,t,r,u,A,V){this.serviceManager=e,this.notificator=t,this.translate=r,this.dialog=u,this.authResolver=A,this.entityStorageService=V,this.loading=!1,this.filterValue="",this.destinations=[],this.selection=new j(!0,[]),this.tableId=et}ngOnInit(){this.loading=!0,this.service=this.entityStorageService.getEntity(),this.refreshTable()}refreshTable(){this.loading=!0,this.serviceManager.getAllRichDestinationsForService(this.service.id).subscribe(e=>{this.selection.clear(),this.filterValue="",this.destinations=e,this.loading=!1})}onBlock(){this.loading=!0,this.blockServiceOnDestinations(this.selection.selected)}onAllow(){this.loading=!0,this.allowServiceOnDestinations(this.selection.selected)}onRemove(){let e=T();e.width="500px",e.data={destinations:this.selection.selected,theme:"admin-theme"},this.dialog.open(Et,e).afterClosed().subscribe(r=>{r&&this.refreshTable()})}applyFilter(e){this.filterValue=e}blockServiceOnDestinations(e){this.serviceManager.blockServicesOnDestinations({richDestinations:e}).subscribe({next:()=>{this.notificator.showSuccess(this.translate.instant("SERVICE_DETAIL.DESTINATIONS.BLOCK_SUCCESS")),this.refreshTable()},error:()=>this.loading=!1})}allowServiceOnDestinations(e){this.serviceManager.unblockServicesOnDestinations({richDestinations:e}).subscribe({next:()=>{this.notificator.showSuccess(this.translate.instant("SERVICE_DETAIL.DESTINATIONS.ALLOW_SUCCESS")),this.refreshTable()},error:()=>this.loading=!1})}};n.\u0275fac=function(t){return new(t||n)(c(Ee),c(oe),c(xe),c(L),c(D),c(W))},n.\u0275cmp=E({type:n,selectors:[["app-service-destinations"]],decls:13,vars:9,consts:[[1,"page-subtitle"],[3,"refresh"],["color","warn","class","me-2","mat-flat-button","",3,"disabled","click",4,"ngIf"],["class","me-2","color","accent","mat-flat-button","",3,"disabled","click",4,"ngIf"],["class","me-2","color","warn","mat-flat-button","",3,"disabled","click",4,"ngIf"],[3,"placeholder","filter"],["spinner",""],[1,"position-relative","table-min-height"],[3,"loading","destinations","filterValue","selection","displayedColumns","tableId",4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],["color","warn","mat-flat-button","",1,"me-2",3,"disabled","click"],["color","accent","mat-flat-button","",1,"me-2",3,"disabled","click"],[3,"loading","destinations","filterValue","selection","displayedColumns","tableId"]],template:function(t,r){if(t&1&&(s(0,"div")(1,"h1",0),g(2),m(3,"translate"),l(),s(4,"perun-web-apps-refresh-button",1),_("refresh",function(){return r.refreshTable()}),l(),h(5,Ji,3,4,"button",2)(6,en,3,4,"button",3)(7,tn,3,4,"button",4),s(8,"perun-web-apps-debounce-filter",5),_("filter",function(A){return r.applyFilter(A)}),l(),h(9,nn,1,0,"ng-template",null,6,M),s(11,"div",7),h(12,rn,1,7,"app-perun-web-apps-destination-list",8),l()()),t&2){let u=w(10);a(2),y(d(3,7,"SERVICE_DETAIL.DESTINATIONS.TITLE")),a(3),p("ngIf",r.authResolver.isPerunAdmin()),a(),p("ngIf",r.authResolver.isPerunAdmin()),a(),p("ngIf",r.authResolver.isPerunAdmin()),a(),p("placeholder","SERVICE_DETAIL.DESTINATIONS.FILTER"),a(4),p("perunWebAppsLoader",r.loading)("perunWebAppsLoaderIndicator",u)}},dependencies:[R,N,At,k,B,P,O,x]});let i=n;return i})();function an(i,n){if(i&1){let o=I();s(0,"button",8),_("click",function(){v(o);let t=f();return S(t.addOwner())}),g(1),m(2,"translate"),l()}i&2&&(a(),C(" ",d(2,1,"ADMIN.OWNERS.ADD")," "))}function sn(i,n){if(i&1){let o=I();s(0,"button",9),_("click",function(){v(o);let t=f();return S(t.removeOwner())}),g(1),m(2,"translate"),l()}if(i&2){let o=f();p("disabled",!o.selected.selected.length),a(),C(" ",d(2,2,"ADMIN.OWNERS.DELETE")," ")}}function ln(i,n){i&1&&b(0,"perun-web-apps-loading-table")}function pn(i,n){if(i&1&&b(0,"perun-web-apps-owners-list",10),i&2){let o=f();p("selection",o.selected)("loading",o.loading)("filterValue",o.filterValue)("owners",o.owners)("tableId",o.tableId)}}var ui=(()=>{let n=class n{constructor(e,t,r){this.ownersManagerService=e,this.dialog=t,this.guiAuthResolver=r,this.owners=[],this.selected=new j(!0,[]),this.filterValue="",this.tableId=Qe}ngOnInit(){this.setAuth(),this.refreshTable()}setAuth(){this.removeAuth=this.guiAuthResolver.isAuthorized("deleteOwner_Owner_policy",[]),this.addAuth=this.guiAuthResolver.isAuthorized("createOwner_Owner_policy",[])}refreshTable(){this.loading=!0,this.ownersManagerService.getAllOwners().subscribe(e=>{this.owners=e,this.selected.clear(),this.loading=!1})}applyFilter(e){this.filterValue=e}addOwner(){let e=T();e.width="400px",e.data={},this.dialog.open(Lt,e).afterClosed().subscribe(r=>{r&&this.refreshTable()})}removeOwner(){let e=T();e.width="400px",e.data=this.selected.selected,this.dialog.open(Nt,e).afterClosed().subscribe(r=>{r&&(this.selected.clear(),this.refreshTable())})}};n.\u0275fac=function(t){return new(t||n)(c(ze),c(L),c(D))},n.\u0275cmp=E({type:n,selectors:[["app-admin-owners"]],decls:12,vars:8,consts:[[1,"page-subtitle"],[3,"refresh"],["color","accent","class","me-2 action-button","mat-flat-button","",3,"click",4,"ngIf"],["class","me-2","color","warn","mat-flat-button","",3,"disabled","click",4,"ngIf"],[3,"placeholder","filter"],["spinner",""],[1,"position-relative","table-min-height"],[3,"selection","loading","filterValue","owners","tableId",4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],["color","accent","mat-flat-button","",1,"me-2","action-button",3,"click"],["color","warn","mat-flat-button","",1,"me-2",3,"disabled","click"],[3,"selection","loading","filterValue","owners","tableId"]],template:function(t,r){if(t&1&&(s(0,"div")(1,"h1",0),g(2),m(3,"translate"),l(),s(4,"perun-web-apps-refresh-button",1),_("refresh",function(){return r.refreshTable()}),l(),h(5,an,3,3,"button",2)(6,sn,3,4,"button",3),s(7,"perun-web-apps-debounce-filter",4),_("filter",function(A){return r.applyFilter(A)}),l(),h(8,ln,1,0,"ng-template",null,5,M),s(10,"div",6),h(11,pn,1,5,"perun-web-apps-owners-list",7),l()()),t&2){let u=w(9);a(2),y(d(3,6,"ADMIN.OWNERS.TITLE")),a(3),p("ngIf",r.addAuth),a(),p("ngIf",r.removeAuth),a(),p("placeholder","ADMIN.OWNERS.FILTER"),a(4),p("perunWebAppsLoader",r.loading)("perunWebAppsLoaderIndicator",u)}},dependencies:[R,N,k,B,P,ft,O,x]});let i=n;return i})();function cn(i,n){i&1&&b(0,"perun-web-apps-loading-table")}function mn(i,n){if(i&1){let o=I();s(0,"app-audit-messages-list",7),_("queryChanged",function(t){v(o);let r=f();return S(r.nextPage.next(t))}),m(1,"async"),m(2,"async"),l()}if(i&2){let o=f();p("loading",d(1,4,o.loading$))("displayedColumns",o.displayedColumns)("auditMessages",d(2,6,o.messagesPage$))("tableId",o.tableId)}}var fi=(()=>{let n=class n{constructor(e){this.auditMessagesManagerService=e,this.tableId=it,this.displayedColumns=["id","timestamp","name","actor","event.message","detail"],this.selectedEvents=[],this.eventOptions=[],this.eventOptionsForSearchSelect=[],this.nextPage=new ee({}),this.messagesPage$=this.nextPage.pipe(ue(t=>this.auditMessagesManagerService.getMessagesPage({query:{offset:t.offset,pageSize:t.pageSize,order:t.order,selectedEvents:this.selectedEvents}})),fe(t=>{this.auditMessages=t.data,setTimeout(()=>this.loadingSubject$.next(!1),200)}),de({data:[],totalCount:0,offset:0,pageSize:0})),this.loadingSubject$=new ee(!1),this.loading$=me(this.loadingSubject$,this.nextPage.pipe(ce(()=>!0)))}ngOnInit(){this.auditMessagesManagerService.findAllPossibleEvents().subscribe(e=>{this.eventOptions=e.sort(),this.eventOptionsForSearchSelect=this.eventOptions})}refreshTable(){this.nextPage.next(this.nextPage.value)}toggleEvent(e){this.selectedEvents.splice(0,this.selectedEvents.length,...e)}refreshOnClosed(){this.selectedEvents=[...this.selectedEvents];let e=this.eventOptions.filter(t=>!this.selectedEvents.includes(t));this.eventOptionsForSearchSelect=[...this.selectedEvents,...e],this.refreshTable()}};n.\u0275fac=function(t){return new(t||n)(c(Ge))},n.\u0275cmp=E({type:n,selectors:[["app-admin-audit-log"]],decls:11,vars:9,consts:[[1,"page-subtitle"],[1,"align-elements"],[3,"refresh"],[3,"disableDeselectButton","auditLogs","auditLogsSelected","selectClosed"],["spinner",""],[1,"position-relative","w-100","table-min-height"],[3,"loading","displayedColumns","auditMessages","tableId","queryChanged",4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],[3,"loading","displayedColumns","auditMessages","tableId","queryChanged"]],template:function(t,r){if(t&1&&(s(0,"h1",0),g(1),m(2,"translate"),l(),s(3,"div",1)(4,"perun-web-apps-refresh-button",2),_("refresh",function(){return r.refreshTable()}),l(),s(5,"perun-web-apps-audit-log-search-select",3),_("auditLogsSelected",function(A){return r.toggleEvent(A)})("selectClosed",function(){return r.refreshOnClosed()}),l(),h(6,cn,1,0,"ng-template",null,4,M),s(8,"div",5),h(9,mn,3,8,"app-audit-messages-list",6),m(10,"async"),l()()),t&2){let u=w(7);a(),y(d(2,5,"ADMIN.AUDIT_LOG.TITLE")),a(4),p("disableDeselectButton",!1)("auditLogs",r.eventOptionsForSearchSelect),a(4),p("perunWebAppsLoader",d(10,7,r.loading$))("perunWebAppsLoaderIndicator",u)}},dependencies:[Ot,k,B,gt,O,ve,x]});let i=n;return i})();function dn(i,n){i&1&&(s(0,"perun-web-apps-alert",9),g(1),m(2,"translate"),l()),i&2&&(a(),C(" ",d(2,1,"ADMIN.CONSENT_HUBS.GLOBAL_DISABLED")," "))}function un(i,n){if(i&1){let o=I();s(0,"button",10),_("click",function(){v(o);let t=f();return S(t.evaluateConsents())}),g(1),m(2,"translate"),l()}if(i&2){let o=f();p("disabled",!o.globalForceConsents||o.selection.selected.length===0),a(),C(" ",d(2,2,"ADMIN.CONSENT_HUBS.EVALUATE_CONSENTS")," ")}}function fn(i,n){i&1&&b(0,"perun-web-apps-loading-table")}function _n(i,n){if(i&1&&b(0,"app-perun-web-apps-consent-hubs-list",11),i&2){let o=f();p("loading",o.loading)("consentHubs",o.consentHubs)("selection",o.selection)("filterValue",o.filterValue)("tableId",o.tableId)}}var _i=(()=>{let n=class n{constructor(e,t,r,u,A,V){this.consentsManager=e,this.authResolver=t,this.notificator=r,this.translate=u,this.store=A,this.dialog=V,this.loading=!1,this.tableId=nt,this.selection=new j(!0,[]),this.filterValue="",this.consentHubs=[]}ngOnInit(){this.globalForceConsents=this.store.getProperty("enforce_consents"),this.refreshTable()}applyFilter(e){this.filterValue=e}refreshTable(){this.loading=!0,this.consentsManager.getAllConsentHubs().subscribe(e=>{this.consentHubs=e,this.loading=!1})}evaluateConsents(){let e=T();e.width="500px",e.data={title:this.translate.instant("ADMIN.CONSENT_HUBS.CONFIRM_DIALOG_TITLE"),theme:"admin-theme",description:this.translate.instant("ADMIN.CONSENT_HUBS.CONFIRM_DIALOG_DESCRIPTION"),items:this.selection.selected.map(r=>r.name),type:"confirmation",showAsk:!1},this.dialog.open(Re,e).afterClosed().subscribe(r=>{r&&this.evaluateConsentsForConsentHubs()})}evaluateConsentsForConsentHubs(){this.loading=!0;let e=this.selection.selected.map(t=>t.id);this.consentsManager.evaluateConsentsForConsentHubs(e).subscribe({next:()=>{this.notificator.showSuccess(this.translate.instant("ADMIN.CONSENT_HUBS.EVALUATION_FINISH")),this.selection.clear(),this.loading=!1},error:()=>this.loading=!1})}};n.\u0275fac=function(t){return new(t||n)(c(Ae),c(D),c(oe),c(xe),c(De),c(L))},n.\u0275cmp=E({type:n,selectors:[["app-perun-web-apps-admin-consent-hubs"]],decls:14,vars:12,consts:[[1,"page-subtitle"],["alert_type","warn",4,"ngIf"],[3,"refresh"],[3,"matTooltipDisabled","matTooltip"],["color","accent","class","action-button me-2","mat-flat-button","",3,"disabled","click",4,"ngIf"],[3,"placeholder","filter"],["spinner",""],[1,"position-relative","table-min-height"],[3,"loading","consentHubs","selection","filterValue","tableId",4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],["alert_type","warn"],["color","accent","mat-flat-button","",1,"action-button","me-2",3,"disabled","click"],[3,"loading","consentHubs","selection","filterValue","tableId"]],template:function(t,r){if(t&1&&(s(0,"div")(1,"h1",0),g(2),m(3,"translate"),l(),h(4,dn,3,3,"perun-web-apps-alert",1),s(5,"perun-web-apps-refresh-button",2),_("refresh",function(){return r.refreshTable()}),l(),s(6,"span",3),m(7,"translate"),h(8,un,3,4,"button",4),l(),s(9,"perun-web-apps-debounce-filter",5),_("filter",function(A){return r.applyFilter(A)}),l(),h(10,fn,1,0,"ng-template",null,6,M),s(12,"div",7),h(13,_n,1,5,"app-perun-web-apps-consent-hubs-list",8),l()()),t&2){let u=w(11);a(2),y(d(3,8,"ADMIN.CONSENT_HUBS.TITLE")),a(2),p("ngIf",!r.globalForceConsents),a(2),F("matTooltip",d(7,10,"ADMIN.CONSENT_HUBS.TOOLTIP")),p("matTooltipDisabled",r.globalForceConsents),a(2),p("ngIf",r.authResolver.isPerunAdmin()),a(),p("placeholder","ADMIN.CONSENT_HUBS.SEARCH"),a(4),p("perunWebAppsLoader",r.loading)("perunWebAppsLoaderIndicator",u)}},dependencies:[R,N,ie,kt,at,k,B,P,O,x]});let i=n;return i})();function gn(i,n){if(i&1){let o=I();s(0,"button",10),_("click",function(){v(o);let t=f();return S(t.block())}),g(1),m(2,"translate"),l()}i&2&&(a(),C(" ",d(2,1,"ADMIN.BLOCKED_LOGINS.BLOCK")," "))}function hn(i,n){if(i&1){let o=I();s(0,"button",11),_("click",function(){v(o);let t=f();return S(t.unblock())}),g(1),m(2,"translate"),l()}if(i&2){let o=f();p("disabled",o.selection.selected.length===0),a(),C(" ",d(2,2,"ADMIN.BLOCKED_LOGINS.UNBLOCK")," ")}}function bn(i,n){i&1&&b(0,"perun-web-apps-loading-table")}function vn(i,n){if(i&1){let o=I();s(0,"perun-web-apps-logins-dynamic-list",12),_("queryChanged",function(t){v(o);let r=f();return S(r.nextPage.next(t))})("downloadAll",function(t){v(o);let r=f();return S(r.downloadAll(t))}),m(1,"async"),m(2,"async"),l()}if(i&2){let o=f();p("loading",d(1,6,o.loading$))("blockedLogins",d(2,8,o.blockedLoginsPage$))("displayedColumns",o.displayedColumns)("selection",o.selection)("filter",o.searchString)("tableId",o.tableId)}}var gi=(()=>{let n=class n{constructor(e,t,r,u,A){this.cd=e,this.dialog=t,this.attributesService=r,this.authResolver=u,this.userManager=A,this.tableId=ot,this.isAdmin=!1,this.selection=new j(!0,[]),this.logins=[],this.namespaceOptions=[],this.filterOptions=[],this.selectedNamespaces=[],this.namespaces=new Ke,this.displayedColumns=["checkbox","login","namespace"],this.blockedLogins=[],this.nextPage=new ee({}),this.blockedLoginsPage$=this.nextPage.pipe(ue(V=>this.userManager.getBlockedLoginsPage({query:{order:V.order,pageSize:V.pageSize,offset:V.offset,sortColumn:V.sortColumn,searchString:V.searchString,namespaces:this.selectedNamespaces}})),fe(V=>{this.blockedLogins=V.data,this.selection.clear(),setTimeout(()=>this.loadingSubject$.next(!1),200)}),de({data:[],totalCount:0,offset:0,pageSize:0})),this.loadingSubject$=new ee(!1),this.loading$=me(this.loadingSubject$,this.nextPage.pipe(ce(()=>!0)))}refreshTable(){this.nextPage.next(this.nextPage.value)}onSearchByString(e){this.searchString=e,this.cd.detectChanges()}ngOnInit(){this.namespaces.setValue(this.selectedNamespaces),this.isAdmin=this.authResolver.isPerunAdmin(),this.attributesService.getAllNamespaces().subscribe(e=>{this.namespaceOptions=e,this.filterOptions=[""].concat(e)})}block(){let e=T();e.width="450px",e.data={theme:"admin-theme",namespaceOptions:this.namespaceOptions},this.dialog.open(Vt,e).afterClosed().subscribe(r=>{r&&(this.selection.clear(),this.nextPage.next(this.nextPage.value))})}unblock(){let e=T();e.width="650px",e.data={logins:this.selection.selected,theme:"admin-theme"},this.dialog.open(Bt,e).afterClosed().subscribe(r=>{r&&(this.selection.clear(),this.nextPage.next(this.nextPage.value))})}toggleEvent(e){this.selectedNamespaces.splice(0,this.selectedNamespaces.length,...e.map(t=>t===""?null:t))}refreshOnClosed(){this.selectedNamespaces=[...this.selectedNamespaces],this.nextPage.next(this.nextPage.value)}downloadAll(e){let t=this.nextPage.getValue();this.userManager.getBlockedLoginsPage({query:{order:t.order,pageSize:e.length,offset:0,sortColumn:t.sortColumn,searchString:t.searchString,namespaces:this.selectedNamespaces}}).subscribe({next:r=>{Xe(Ye(r.data,this.displayedColumns,e.getDataForColumnFun),e.format)}})}};n.\u0275fac=function(t){return new(t||n)(c(je),c(L),c(K),c(D),c(Te))},n.\u0275cmp=E({type:n,selectors:[["app-perun-web-apps-admin-blocked-logins"]],decls:16,vars:18,consts:[[1,"page-subtitle"],[1,"align-elements"],[3,"refresh"],["color","accent","class","me-2 action-button","data-cy","block-logins-button","mat-flat-button","",3,"click",4,"ngIf"],["class","me-2","color","warn","data-cy","unblock-logins-button","mat-flat-button","",3,"disabled","click",4,"ngIf"],[1,"pr-2","me-2","flex-grow-1",3,"namespaceOptions","multiple","disableAutoSelect","disableDeselectButton","customSelectPlaceholder","namespaceSelected","selectClosed"],[1,"search-field","flex-grow-1",3,"autoFocus","placeholder","filter"],["spinner",""],[1,"position-relative","table-min-height"],[3,"loading","blockedLogins","displayedColumns","selection","filter","tableId","queryChanged","downloadAll",4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],["color","accent","data-cy","block-logins-button","mat-flat-button","",1,"me-2","action-button",3,"click"],["color","warn","data-cy","unblock-logins-button","mat-flat-button","",1,"me-2",3,"disabled","click"],[3,"loading","blockedLogins","displayedColumns","selection","filter","tableId","queryChanged","downloadAll"]],template:function(t,r){if(t&1&&(s(0,"h1",0),g(1),m(2,"translate"),l(),s(3,"div",1)(4,"div")(5,"perun-web-apps-refresh-button",2),_("refresh",function(){return r.refreshTable()}),l(),h(6,gn,3,3,"button",3)(7,hn,3,4,"button",4),l(),s(8,"perun-web-apps-namespace-search-select",5),_("namespaceSelected",function(A){return r.toggleEvent(A)})("selectClosed",function(){return r.refreshOnClosed()}),m(9,"translate"),l(),s(10,"perun-web-apps-debounce-filter",6),_("filter",function(A){return r.onSearchByString(A)}),l()(),h(11,bn,1,0,"ng-template",null,7,M),s(13,"div",8),h(14,vn,3,10,"perun-web-apps-logins-dynamic-list",9),m(15,"async"),l()),t&2){let u=w(12);a(),y(d(2,12,"ADMIN.BLOCKED_LOGINS.TITLE")),a(5),p("ngIf",r.isAdmin),a(),p("ngIf",r.isAdmin),a(),p("namespaceOptions",r.filterOptions)("multiple",!0)("disableAutoSelect",!0)("disableDeselectButton",!1)("customSelectPlaceholder",d(9,14,"ADMIN.BLOCKED_LOGINS.FILTER_NAMESPACE")),a(2),p("autoFocus",!0)("placeholder","ADMIN.BLOCKED_LOGINS.SEARCH_PLACEHOLDER"),a(4),p("perunWebAppsLoader",d(15,16,r.loading$))("perunWebAppsLoaderIndicator",u)}},dependencies:[R,N,k,B,P,O,ht,bt,ve,x]});let i=n;return i})();var Sn=[{path:"",component:ii,canActivateChild:[Oe],children:[{path:"",component:ni,data:{animation:"AdminOverviewPage"}},{path:"attributes",component:oi,data:{animation:"AdminAttributesPage"}},{path:"users",component:Ut,data:{animation:"AdminUsersPage"}},{path:"owners",component:ui,data:{animation:"AdminOwnersPage"}},{path:"services",component:qt,data:{animation:"AdminServicesPage"}},{path:"audit_log",component:fi,data:{animation:"AdminAuditLogPage"}},{path:"ext_sources",component:si,data:{animation:"AdminExtSourcesPage"}},{path:"consent_hubs",component:_i,data:{animation:"AdminConsentHubsPage"}},{path:"searcher",component:Kt,data:{animation:"AdminSearcherPage"}},{path:"blocked_logins",component:gi,data:{animation:"AdminBlockedLoginsPage"}}]},{path:"users/:userId",component:ai,canActivateChild:[Oe],children:[{path:"",component:Ft,data:{animation:"UserOverviewPage"}},{path:"accounts",component:$t,data:{animation:"UserAccountsPage"}},{path:"assignments",component:Xt,data:{animation:"UserAssignmentsPage"}},{path:"attributes",component:jt,data:{animation:"UserAttributesPage"}},{path:"identities",component:Gt,data:{animation:"UserIdentitiesPage"}},{path:"identities/:identityId",component:wt,data:{animation:"UserIdentityDetailPage"}},{path:"roles",component:Ht,data:{animation:"UserRolesPage"}},{path:"service-identities",component:Wt,data:{animation:"UserServiceIdentities"}},{path:"associated-users",component:zt,data:{animation:"AssociatedUsersPage"}},{path:"bans",component:Yt,data:{animation:"UserBansPage"}}]},{path:"services/:serviceId",component:pi,canActivateChild:[Oe],children:[{path:"",component:ci,data:{animation:"ServiceOverviewPage"}},{path:"required-attributes",component:mi,data:{animation:"ServiceRequiredAttributesPage"}},{path:"destinations",component:di,data:{animation:"ServiceDestinationsPage"}}]}],hi=(()=>{let n=class n{};n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=ge({type:n}),n.\u0275inj=_e({imports:[Fe.forChild(Sn),Fe]});let i=n;return i})();var ls=(()=>{let n=class n{};n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=ge({type:n}),n.\u0275inj=_e({imports:[We,hi,Pt,st,ct,vt,pt,Qt]});let i=n;return i})();export{ls as a};
