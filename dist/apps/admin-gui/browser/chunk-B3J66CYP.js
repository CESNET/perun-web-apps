import{a as Zn,b as Jn,c as eo,d as to,e as io}from"./chunk-HZBLG2ZD.js";import{a as On,b as kn,c as $t,f as Nn,g as Bn,h as Pn,i as Gn,j as jn,k as Hn,l as Un,m as Wn,n as zn,o as $n,p as qn,q as Kn}from"./chunk-IEHTPU3A.js";import"./chunk-7LAQI6ZP.js";import{a as Kt,b as Xn,c as Qn}from"./chunk-7RKTKHRX.js";import{a as It,c as zt,d as Vn}from"./chunk-BJPWMLOV.js";import{b as Yn}from"./chunk-CPCVLOXF.js";import{a as Wt,b as qt}from"./chunk-XBAZQWI7.js";import{$a as He,$b as $e,$e as tn,$g as hn,Aa as ge,Ac as Oe,Ad as Pe,Ba as Ce,Bd as ht,Be as Wi,Bg as mn,Ca as v,Cc as ce,Ce as zi,Cg as un,Da as _,Dc as M,Dd as Vt,De as $i,E as fi,Ea as d,Ec as R,Ee as qi,Ei as En,Fe as Ki,Fh as Ht,Fi as xn,G as je,Ge as Xi,Gh as vn,Gi as Dn,H as hi,He as Qi,Hh as Ut,I as _i,Ia as Se,Id as O,Ie as Zi,Ja as ve,Jc as rt,Ji as Mn,K as gi,Ka as be,La as F,Ld as Gi,Lh as bn,Ma as Y,Mb as Ye,Mc as st,N as Ci,Na as Z,Nc as Mt,Nd as _t,Nh as In,Oa as p,Pa as T,Pc as Rt,Pd as ue,Pi as Rn,Q as Si,Qa as h,Qc as Ft,Qd as Te,Qe as Ji,Qf as H,Ra as Ie,Rb as We,Rc as Ri,Rd as ji,Re as en,S as g,Sa as yi,Sb as Fe,Sc as Fi,Se as Bt,T as C,Tb as ze,Tc as lt,Te as Pt,Ti as Fn,Ua as De,Uc as wt,Ue as Gt,Uf as cn,V as vi,Va as Me,Vi as wn,W as Tt,Wa as Re,Wi as Ln,Xa as ye,Xc as ct,Xh as de,Ya as fe,Yb as le,Yc as Lt,Za as Ti,Zb as Di,Zc as pt,Zf as j,Zg as ri,_ as At,_a as me,_c as wi,_e as Ct,_f as jt,_g as fn,aa as o,ab as ai,ad as Ot,af as nn,ah as si,bd as Li,ca as Et,cd as L,d as ae,db as l,dd as w,eb as c,ee as Hi,fb as gt,fc as Dt,fd as dt,fe as Nt,fh as _n,ga as u,gd as mt,ge as B,gf as on,gh as gn,ha as E,hd as ke,he as W,hf as an,id as Ve,ie as z,ii as yn,jb as V,jc as Mi,jd as Ne,je as J,k as Ge,kb as Ue,kc as qe,kd as Be,ke as ee,ki as Yt,la as bi,ld as pe,le as te,ma as A,mc as we,md as he,me as ie,mh as bt,nb as Ai,nc as Le,ne,nf as k,nh as Cn,oa as ni,oc as G,pa as Ii,pb as Ei,pc as Ke,pd as Oi,pf as rn,qb as xt,qc as Xe,qd as ki,qf as sn,qi as Tn,r as ui,ra as b,rc as Qe,rd as Vi,rf as ln,sa as I,sc as Ze,sd as Ni,sf as St,sg as pn,ta as oi,tb as xi,tc as Je,tf as vt,ti as An,ua as Ee,ub as x,uc as et,ud as ut,va as xe,vc as tt,vd as ft,wa as m,wc as it,wd as Bi,xa as r,xc as nt,xd as kt,xh as Ae,ya as a,yc as ot,yd as N,ye as Ui,yg as dn,yh as Sn,za as S,zc as at,zd as Pi,ze as Yi}from"./chunk-6NXECROM.js";import"./chunk-TSRGIXR5.js";var wo=()=>({color:"black"}),no=t=>["/facilities",t];function Lo(t,f){t&1&&S(0,"mat-spinner",1)}function Oo(t,f){if(t&1){let e=v();r(0,"button",10),l(1,"translate"),_("click",function(){g(e);let n=d(2);return C(n.editFacility())}),r(2,"mat-icon"),p(3,"edit"),a()()}t&2&&m("matTooltip",ye(c(1,2,"FACILITY_DETAIL.EDIT")))}function ko(t,f){if(t&1){let e=v();r(0,"button",10),l(1,"translate"),_("click",function(){g(e);let n=d(2);return C(n.deleteFacility())}),r(2,"mat-icon"),p(3,"delete_forever"),a()()}t&2&&m("matTooltip",ye(c(1,2,"FACILITY_DETAIL.DELETE")))}function Vo(t,f){if(t&1){let e=v();r(0,"div")(1,"div",2),S(2,"mat-icon",3),l(3,"translate"),r(4,"div",4)(5,"div",5)(6,"a",6),_("auxclick",function(n){return g(e),C(n.preventDefault())}),p(7),a(),r(8,"span",7),p(9),a(),b(10,Oo,4,4,"button",8),b(11,ko,4,4,"button",8),a(),r(12,"div"),p(13),l(14,"translate"),a(),r(15,"span",9),p(16),l(17,"translate"),l(18,"translate"),a()()(),S(19,"app-animated-router-outlet"),a()}if(t&2){let e=d();o(2),m("matTooltip",ye(c(3,14,"FACILITY_DETAIL.ENTITY")))("ngStyle",me(22,wo)),o(4),m("perunWebAppsMiddleClickRouterLink",He(23,no,e.facility.id.toString()))("routerLink",He(25,no,e.facility.id)),o(),T(e.facility.name),o(2),h(" \xA0#",e.facility.id," "),o(),I(e.editFacilityAuth?10:-1),o(),I(e.deleteAuth?11:-1),o(2),Ie("",c(14,16,"FACILITY_DETAIL.UUID"),": ",e.facility.uuid),o(3),yi(" ",c(17,18,"FACILITY_DETAIL.ENTITY"),", ",c(18,20,"FACILITY_DETAIL.DESCRIPTION"),": ",e.facility.description," ")}}var ao=(()=>{class t extends kn(){constructor(e,i,n,s,y,D,K,U,X){super(),this.dialog=e,this.facilityManager=i,this.route=n,this.sideMenuService=s,this.sideMenuItemService=y,this.guiAuthResolver=D,this.router=K,this.entityStorageService=U,this.reloadEntityDetail=X,this.editFacilityAuth=!1,this.deleteAuth=!1,this.loading=!1}ngOnInit(){this.reloadData(),this.reloadEntityDetail.entityDetailChange.pipe(_i(this.destroyed$)).subscribe(()=>{this.reloadData()})}reloadData(){this.loading=!0,this.route.params.subscribe(e=>{let i=Number(e.facilityId);this.facilityManager.getFacilityById(i).subscribe({next:n=>{this.facility=n,this.entityStorageService.setEntityAndPathParam({id:n.id,beanName:n.beanName},Hi.Facility),this.setMenuItems(),this.editFacilityAuth=this.guiAuthResolver.isAuthorized("updateFacility_Facility_policy",[this.facility]),this.deleteAuth=this.guiAuthResolver.isAuthorized("deleteFacility_Facility_Boolean_policy",[this.facility]),on("facilities",this.facility),an(this.facility),this.loading=!1},error:()=>this.loading=!1})})}setMenuItems(){let e=this.sideMenuItemService.parseFacility(this.facility);this.sideMenuService.setFacilityMenuItems([e])}editFacility(){let e=k();e.width="450px",e.data={theme:"facility-theme",facility:this.facility,dialogType:_n.FACILITY},this.dialog.open(gn,e).afterClosed().subscribe(n=>{n&&this.facilityManager.getFacilityById(this.facility.id).subscribe(s=>{this.facility=s,this.setMenuItems()})})}deleteFacility(){let e=k();e.width="500px",e.data={theme:"facility-theme",facility:this.facility},this.dialog.open(Zn,e).afterClosed().subscribe(n=>{n&&this.router.navigate([""],{queryParamsHandling:"preserve"})})}static{this.\u0275fac=function(i){return new(i||t)(u(J),u(O),u(rt),u(wn),u(Ln),u(B),u(st),u(j),u(On))}}static{this.\u0275cmp=E({type:t,selectors:[["app-facility-detail-page"]],features:[bi],decls:4,vars:2,consts:[[1,"container-fluid","ps-xl-5","pe-xl-5","facility-theme"],[1,"me-auto","ms-auto"],[1,"d-flex","page-title-headtitle"],["svgIcon","perun-facility-black",1,"perun-icon","perun-icon-detail",3,"matTooltip","ngStyle"],[1,"page-title-block"],[1,"page-title-headline","d-flex","align-items-center"],[1,"facility-link",3,"auxclick","perunWebAppsMiddleClickRouterLink","routerLink"],[1,"text-muted"],["mat-icon-button","",3,"matTooltip"],[1,"mt-1","entity-info"],["mat-icon-button","",3,"click","matTooltip"]],template:function(i,n){i&1&&(r(0,"div",0),S(1,"perun-web-apps-back-button"),b(2,Lo,1,0,"mat-spinner",1),b(3,Vo,20,27,"div"),a()),i&2&&(o(2),I(n.loading?2:-1),o(),I(!n.loading&&n.facility!==void 0?3:-1))},dependencies:[x,Ei,w,Li,Ve,ke,kt,Fn,Sn,Pi,Wt,Rt,Mt,mt,dt,R,Ye,M],encapsulation:2,data:{animation:[Yt]}})}}return t})();function No(t,f){t&1&&S(0,"mat-spinner",0)}function Bo(t,f){if(t&1&&(r(0,"div"),S(1,"perun-web-apps-menu-buttons-field",1)(2,"perun-web-apps-expandable-tiles",2),a()),t&2){let e=d();o(),m("items",e.items),o(),m("items",e.settingItems)("title","MENU_ITEMS.FACILITY.SETTINGS")("sectionId","settings")}}var ro=(()=>{class t{constructor(e,i,n,s){this.facilityManager=e,this.authResolver=i,this.entityStorageService=n,this.routePolicyService=s,this.items=[],this.settingItems=[],this.loading=!1}ngOnInit(){this.loading=!0,this.facility=this.entityStorageService.getEntity(),this.setItems(),this.setSettingsItems(),this.loading=!1}setItems(){this.items=[],this.routePolicyService.canNavigate("facilities-resources",this.facility)&&this.items.push({cssIcon:"perun-manage-facility",url:`/facilities/${this.facility.id}/resources`,label:"MENU_ITEMS.FACILITY.RESOURCES",style:"facility-btn"}),this.routePolicyService.canNavigate("facilities-allowed-users",this.facility)&&this.items.push({cssIcon:"perun-user",url:`/facilities/${this.facility.id}/allowed-users`,label:"MENU_ITEMS.FACILITY.ALLOWED_USERS",style:"facility-btn"}),this.routePolicyService.canNavigate("facilities-allowed-groups",this.facility)&&this.items.push({cssIcon:"perun-group",url:`/facilities/${this.facility.id}/allowed-groups`,label:"MENU_ITEMS.FACILITY.ALLOWED_GROUPS",style:"facility-btn"}),this.routePolicyService.canNavigate("facilities-services-status",this.facility)&&this.items.push({cssIcon:"perun-service-status",url:`/facilities/${this.facility.id}/services-status`,label:"MENU_ITEMS.FACILITY.SERVICES_STATUS",style:"facility-btn"}),this.routePolicyService.canNavigate("facilities-services-destinations",this.facility)&&this.items.push({cssIcon:"perun-service_destination",url:`/facilities/${this.facility.id}/services-destinations`,label:"MENU_ITEMS.FACILITY.SERVICES_DESTINATIONS",style:"facility-btn"}),this.routePolicyService.canNavigate("facilities-hosts",this.facility)&&this.items.push({cssIcon:"perun-hosts",url:`/facilities/${this.facility.id}/hosts`,label:"MENU_ITEMS.FACILITY.HOSTS",style:"facility-btn"}),this.routePolicyService.canNavigate("facilities-attributes",this.facility)&&this.items.push({cssIcon:"perun-attributes",url:`/facilities/${this.facility.id}/attributes`,label:"MENU_ITEMS.FACILITY.ATTRIBUTES",style:"facility-btn"})}setSettingsItems(){this.settingItems=[],this.routePolicyService.canNavigate("facilities-settings-managers",this.facility)&&this.settingItems.push({cssIcon:"perun-manager",url:`/facilities/${this.facility.id}/settings/managers`,label:"MENU_ITEMS.FACILITY.MANAGERS",style:"facility-btn"}),this.routePolicyService.canNavigate("facilities-settings-bans",this.facility)&&this.settingItems.push({cssIcon:"perun-ban",url:`/facilities/${this.facility.id}/settings/bans`,label:"MENU_ITEMS.FACILITY.BANS",style:"facility-btn"})}static{this.\u0275fac=function(i){return new(i||t)(u(O),u(B),u(j),u(jt))}}static{this.\u0275cmp=E({type:t,selectors:[["app-facility-overview"]],hostVars:2,hostBindings:function(i,n){i&2&&Y("router-component",n.true)},decls:2,vars:2,consts:[[1,"me-auto","ms-auto"],[3,"items"],[3,"items","title","sectionId"]],template:function(i,n){i&1&&(b(0,No,1,0,"mat-spinner",0),b(1,Bo,3,4,"div")),i&2&&(I(n.loading?0:-1),o(),I(n.loading?-1:1))},dependencies:[x,Ut,Rn,mt,dt],encapsulation:2})}}return t})();var so=(()=>{class t{static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=E({type:t,selectors:[["app-facility-settings"]],hostVars:2,hostBindings:function(i,n){i&2&&Y("router-component",n.true)},decls:1,vars:0,template:function(i,n){i&1&&S(0,"app-animated-router-outlet")},dependencies:[x,Wt],encapsulation:2,data:{animation:[Yt]}})}}return t})();function Po(t,f){t&1&&S(0,"mat-spinner",0)}function Go(t,f){if(t&1&&(r(0,"div"),S(1,"perun-web-apps-menu-buttons-field",1),a()),t&2){let e=d();o(),m("items",e.items)}}var lo=(()=>{class t{constructor(e,i,n,s){this.facilityManager=e,this.authResolver=i,this.entityStorageService=n,this.routePolicyService=s,this.items=[],this.loading=!1}ngOnInit(){this.loading=!0,this.facility=this.entityStorageService.getEntity(),this.initItems(),this.loading=!1}initItems(){this.items=[],this.routePolicyService.canNavigate("facilities-settings-managers",this.facility)&&this.items.push({cssIcon:"perun-manager",url:`/facilities/${this.facility.id}/settings/managers`,label:"MENU_ITEMS.FACILITY.MANAGERS",style:"facility-btn"}),this.routePolicyService.canNavigate("facilities-settings-bans",this.facility)&&this.items.push({cssIcon:"perun-ban",url:`/facilities/${this.facility.id}/settings/bans`,label:"MENU_ITEMS.FACILITY.BANS",style:"facility-btn"})}static{this.\u0275fac=function(i){return new(i||t)(u(O),u(B),u(j),u(jt))}}static{this.\u0275cmp=E({type:t,selectors:[["app-facility-settings-overview"]],hostVars:2,hostBindings:function(i,n){i&2&&Y("router-component",n.true)},decls:2,vars:2,consts:[[1,"me-auto","ms-auto"],[3,"items"]],template:function(i,n){i&1&&(b(0,Po,1,0,"mat-spinner",0),b(1,Go,2,1,"div")),i&2&&(I(n.loading?0:-1),o(),I(n.loading?-1:1))},dependencies:[x,Ut,mt,dt],encapsulation:2})}}return t})();function Ho(t,f){t&1&&(p(0),l(1,"translate")),t&2&&h(" ",c(1,1,"FACILITY_DETAIL.ENTITY")," ")}function Uo(t,f){if(t&1&&S(0,"app-one-entity-attribute-page",4),t&2){let e=d();m("entityId",e.facility.id)("entity","facility")}}function Yo(t,f){t&1&&(p(0),l(1,"translate"),l(2,"translate")),t&2&&Ie(" ",c(1,2,"FACILITY_DETAIL.ENTITY")," - ",c(2,4,"ADMIN_USER.ENTITY")," ")}function Wo(t,f){if(t&1&&S(0,"app-two-entity-attribute-page",5),t&2){let e=d(2);m("firstEntity","facility")("firstEntityId",e.facility.id)("secondEntity","user")}}function zo(t,f){t&1&&(r(0,"mat-tab"),A(1,Yo,3,6,"ng-template",2)(2,Wo,1,3,"ng-template",3),a())}var co=(()=>{class t{constructor(e,i){this.authResolver=e,this.entityStorageService=i}ngOnInit(){this.facility=this.entityStorageService.getEntity(),this.facilityUserAttAuth=this.authResolver.isAuthorized("getAssignedUsers_Facility_policy",[this.facility])}static{this.\u0275fac=function(i){return new(i||t)(u(B),u(j))}}static{this.\u0275cmp=E({type:t,selectors:[["app-facility-attributes"]],hostVars:2,hostBindings:function(i,n){i&2&&Y("router-component",n.true)},decls:9,vars:4,consts:[[1,"page-subtitle"],["mat-stretch-tabs","false"],["matTabLabel",""],["matTabContent",""],[3,"entityId","entity"],[3,"firstEntity","firstEntityId","secondEntity"]],template:function(i,n){i&1&&(r(0,"div")(1,"h1",0),p(2),l(3,"translate"),a(),r(4,"mat-tab-group",1)(5,"mat-tab"),A(6,Ho,2,3,"ng-template",2)(7,Uo,1,2,"ng-template",3),a(),b(8,zo,3,0,"mat-tab"),a()()),i&2&&(o(2),T(c(3,2,"FACILITY_DETAIL.SETTINGS.ATTRIBUTES.TITLE")),o(6),I(n.facilityUserAttAuth?8:-1))},dependencies:[x,zt,Vn,Gt,Ji,en,Bt,Pt,R,M],encapsulation:2})}}return t})();var $o=["FacilityAList"],qo=["ResourceAList"],Ko=["GroupAList"],Xo=["MemberAList"];function Qo(t,f){if(t&1&&S(0,"perun-web-apps-attributes-list",9,0),t&2){let e=d();m("attributes",e.facilityAttributes)("selection",e.selectionFacility)}}function Zo(t,f){if(t&1&&S(0,"perun-web-apps-attributes-list",9,1),t&2){let e=d(2);m("attributes",e.resourceAttributes)("selection",e.selectionResource)}}function Jo(t,f){if(t&1){let e=v();r(0,"mat-tab",6)(1,"button",7),_("click",function(){g(e);let n=d();return C(n.onAddAttResource())}),p(2),l(3,"translate"),a(),r(4,"button",8),_("click",function(){g(e);let n=d();return C(n.onSaveResource())}),p(5),l(6,"translate"),a(),b(7,Zo,2,2,"perun-web-apps-attributes-list",9),a()}if(t&2){let e=d();m("label",e.resource.name+" (resource)"),o(2),h(" ",c(3,5,"SHARED_LIB.PERUN.SERVICES_CONFIGURATIONS.ADD")," "),o(2),m("disabled",e.selectionResource.selected.length===0),o(),h(" ",c(6,7,"SHARED_LIB.PERUN.SERVICES_CONFIGURATIONS.SAVE")," "),o(2),I(e.resourceAttributes?7:-1)}}function ea(t,f){if(t&1&&S(0,"perun-web-apps-attributes-list",9,2),t&2){let e=d(2);m("attributes",e.groupAttributes)("selection",e.selectionGroup)}}function ta(t,f){if(t&1){let e=v();r(0,"mat-tab",6)(1,"button",7),_("click",function(){g(e);let n=d();return C(n.onAddAttGroup())}),p(2),l(3,"translate"),a(),r(4,"button",8),_("click",function(){g(e);let n=d();return C(n.onSaveGroup())}),p(5),l(6,"translate"),a(),b(7,ea,2,2,"perun-web-apps-attributes-list",9),a()}if(t&2){let e=d();m("label",e.group.name+" (group)"),o(2),h(" ",c(3,5,"SHARED_LIB.PERUN.SERVICES_CONFIGURATIONS.ADD")," "),o(2),m("disabled",e.selectionGroup.selected.length===0),o(),h(" ",c(6,7,"SHARED_LIB.PERUN.SERVICES_CONFIGURATIONS.SAVE")," "),o(2),I(e.groupAttributes?7:-1)}}function ia(t,f){if(t&1&&S(0,"perun-web-apps-attributes-list",9,3),t&2){let e=d(2);m("attributes",e.memberAttributes)("selection",e.selectionMember)}}function na(t,f){if(t&1){let e=v();r(0,"mat-tab",6)(1,"button",7),_("click",function(){g(e);let n=d();return C(n.onAddAttMember())}),p(2),l(3,"translate"),a(),r(4,"button",8),_("click",function(){g(e);let n=d();return C(n.onSaveMember())}),p(5),l(6,"translate"),a(),b(7,ia,2,2,"perun-web-apps-attributes-list",9),a()}if(t&2){let e=d();m("label",e.member.user.firstName+" "+e.member.user.lastName+" (member)"),o(2),h(" ",c(3,5,"SHARED_LIB.PERUN.SERVICES_CONFIGURATIONS.ADD")," "),o(2),m("disabled",e.selectionMember.selected.length===0),o(),h(" ",c(6,7,"SHARED_LIB.PERUN.SERVICES_CONFIGURATIONS.SAVE")," "),o(2),I(e.memberAttributes?7:-1)}}var po=(()=>{class t{constructor(e,i){this.attributesManager=e,this.dialog=i,this.selectionFacility=new G(!0,[]),this.selectionResource=new G(!0,[]),this.selectionGroup=new G(!0,[]),this.selectionMember=new G(!0,[]),this.showTab=0}ngOnInit(){this.loadFacilityAttributes()}ngOnChanges(e){if(e.service){this.reloadAll();return}e.resource?e.resource.currentValue===void 0?(this.resourceAttributes=void 0,this.showTab=0):(this.showTab=1,this.loadResourceAttributes()):e.group?e.group.currentValue===void 0?(this.groupAttributes=void 0,this.showTab=1):(this.showTab=2,this.attributesManager.getGroupAttributes(this.group.id).subscribe(i=>this.groupAttributes=i)):e.member&&(e.member.currentValue===void 0?(this.memberAttributes=void 0,this.showTab=2):(this.showTab=3,this.attributesManager.getMemberAttributes(this.member.id).subscribe(i=>this.memberAttributes=i)))}onAddAttFacility(){let e=k();e.width="1050px",e.data={entityId:this.facility.id,entity:"facility",notEmptyAttributes:this.facilityAttributes,style:"facility-theme"},this.dialog.open(It,e).afterClosed().subscribe(n=>{n==="saved"&&this.reloadAll()})}onSaveFacility(){this.facilityAlist.updateMapAttributes(),this.dialog.open(bt,{width:"450px",data:{entityId:this.facility.id,entity:"facility",attributes:this.selectionFacility.selected}}).afterClosed().subscribe(i=>{i&&(this.selectionFacility.clear(),this.ngOnInit())})}onAddAttResource(){let e=k();e.width="1050px",e.data={entityId:this.resource.id,entity:"resource",notEmptyAttributes:this.resourceAttributes,style:"facility-theme"},this.dialog.open(It,e).afterClosed().subscribe(n=>{n==="saved"&&this.reloadAll()})}onSaveResource(){this.resourceAList.updateMapAttributes(),this.dialog.open(bt,{width:"450px",data:{entityId:this.resource.id,entity:"resource",attributes:this.selectionResource.selected}}).afterClosed().subscribe(i=>{i&&(this.selectionResource.clear(),this.ngOnInit())})}onAddAttGroup(){let e=k();e.width="1050px",e.data={entityId:this.group.id,entity:"group",notEmptyAttributes:this.groupAttributes,style:"facility-theme"},this.dialog.open(It,e).afterClosed().subscribe(n=>{n==="saved"&&this.reloadAll()})}onSaveGroup(){this.groupAList.updateMapAttributes(),this.dialog.open(bt,{width:"450px",data:{entityId:this.group.id,entity:"group",attributes:this.selectionGroup.selected}}).afterClosed().subscribe(i=>{i&&(this.selectionGroup.clear(),this.ngOnInit())})}onAddAttMember(){let e=k();e.width="1050px",e.data={entityId:this.member.id,entity:"member",notEmptyAttributes:this.memberAttributes,style:"facility-theme"},this.dialog.open(It,e).afterClosed().subscribe(n=>{n==="saved"&&this.reloadAll()})}onSaveMember(){this.memberAList.updateMapAttributes(),this.dialog.open(bt,{width:"450px",data:{entityId:this.member.id,entity:"member",attributes:this.selectionMember.selected}}).afterClosed().subscribe(i=>{i&&(this.selectionMember.clear(),this.ngOnInit())})}loadResourceAttributes(){this.service==="NOT_SELECTED"?this.attributesManager.getResourceAttributes(this.resource.id).subscribe(e=>this.resourceAttributes=e):this.service==="ALL"?this.attributesManager.getRequiredAttributesResource(this.resource.id).subscribe(e=>this.resourceAttributes=e):this.attributesManager.getRequiredAttributesResourceService(this.service.id,this.resource.id).subscribe(e=>this.resourceAttributes=e)}loadFacilityAttributes(){this.service==="NOT_SELECTED"?this.attributesManager.getFacilityAttributes(this.facility.id).subscribe(e=>this.facilityAttributes=e):this.service==="ALL"?this.attributesManager.getRequiredAttributesFacility(this.facility.id).subscribe(e=>this.facilityAttributes=e):this.attributesManager.getRequiredAttributesFacilityService(this.service.id,this.facility.id).subscribe(e=>this.facilityAttributes=e)}reloadAll(){this.loadFacilityAttributes(),this.resource!==void 0&&this.loadResourceAttributes()}static{this.\u0275fac=function(i){return new(i||t)(u(Vt),u(J))}}static{this.\u0275cmp=E({type:t,selectors:[["app-perun-web-apps-service-configurator"]],viewQuery:function(i,n){if(i&1&&(Se($o,5),Se(qo,5),Se(Ko,5),Se(Xo,5)),i&2){let s;ve(s=be())&&(n.facilityAlist=s.first),ve(s=be())&&(n.resourceAList=s.first),ve(s=be())&&(n.groupAList=s.first),ve(s=be())&&(n.memberAList=s.first)}},inputs:{facility:"facility",service:"service",resource:"resource",group:"group",member:"member"},features:[Tt],decls:13,vars:14,consts:[["FacilityAList",""],["ResourceAList",""],["GroupAList",""],["MemberAList",""],[1,"min-height"],["mat-stretch-tabs","false",3,"selectedIndexChange","dynamicHeight","selectedIndex"],[3,"label"],["mat-flat-button","","color","accent",1,"me-2","mt-3",3,"click"],["mat-flat-button","","color","accent",1,"me-2","mt-3",3,"click","disabled"],[3,"attributes","selection"]],template:function(i,n){i&1&&(r(0,"div",4)(1,"mat-tab-group",5),Re("selectedIndexChange",function(y){return Me(n.showTab,y)||(n.showTab=y),y}),r(2,"mat-tab",6)(3,"button",7),_("click",function(){return n.onAddAttFacility()}),p(4),l(5,"translate"),a(),r(6,"button",8),_("click",function(){return n.onSaveFacility()}),p(7),l(8,"translate"),a(),b(9,Qo,2,2,"perun-web-apps-attributes-list",9),a(),b(10,Jo,8,9,"mat-tab",6),b(11,ta,8,9,"mat-tab",6),b(12,na,8,9,"mat-tab",6),a()()),i&2&&(o(),m("dynamicHeight",!0),De("selectedIndex",n.showTab),o(),m("label",n.facility.name+" (facility)"),o(2),h(" ",c(5,10,"SHARED_LIB.PERUN.SERVICES_CONFIGURATIONS.ADD")," "),o(2),m("disabled",n.selectionFacility.selected.length===0),o(),h(" ",c(8,12,"SHARED_LIB.PERUN.SERVICES_CONFIGURATIONS.SAVE")," "),o(2),I(n.facilityAttributes?9:-1),o(),I(n.resource?10:-1),o(),I(n.group?11:-1),o(),I(n.member?12:-1))},dependencies:[x,w,L,Gt,Bt,Pt,R,Ht,M],styles:[".min-height[_ngcontent-%COMP%]{min-height:500px}"]})}}return t})();var Xt=(t,f)=>f.id;function ra(t,f){if(t&1){let e=v();r(0,"mat-option",8),_("onSelectionChange",function(){let n=g(e).$implicit,s=d(3);return C(s.onSelectedService(n))}),p(1),a()}if(t&2){let e=f.$implicit;m("value",e),o(),h(" ",e.name," ")}}function sa(t,f){if(t&1){let e=v();r(0,"mat-form-field",4)(1,"mat-label"),p(2),l(3,"translate"),a(),r(4,"input",6),_("keyup",function(n){g(e);let s=d(2);return C(s.updatedSerVal(n))}),a(),r(5,"mat-autocomplete",7,0)(7,"mat-option",8),_("onSelectionChange",function(){g(e);let n=d(2);return C(n.onSelectedService("NOT_SELECTED"))}),p(8),l(9,"translate"),a(),r(10,"mat-option",8),_("onSelectionChange",function(){g(e);let n=d(2);return C(n.onSelectedService("ALL"))}),p(11),l(12,"translate"),a(),Ee(13,ra,2,2,"mat-option",9,Xt),l(15,"async"),a()()}if(t&2){let e=F(6),i=d(2);o(2),T(c(3,8,"FACILITY_DETAIL.SERVICE_CONFIG.SERVICE_SELECT")),o(2),m("formControl",i.serviceField)("matAutocomplete",e),o(),m("displayWith",i.serviceDisplayFn.bind(i)),o(2),m("value","NOT_SELECTED"),o(),h(" ",c(9,10,"FACILITY_DETAIL.SERVICE_CONFIG.NOT_SELECTED")," "),o(2),m("value","ALL"),o(),h(" ",c(12,12,"FACILITY_DETAIL.SERVICE_CONFIG.ALL")," "),o(2),xe(c(15,14,i.filteredServices))}}function la(t,f){if(t&1){let e=v();r(0,"mat-option",8),_("onSelectionChange",function(){let n=g(e).$implicit,s=d(3);return C(s.onSelectedResource(n))}),p(1),a()}if(t&2){let e=f.$implicit;m("value",e),o(),h(" ",e.name," ")}}function ca(t,f){if(t&1){let e=v();r(0,"mat-form-field",4)(1,"mat-label"),p(2),l(3,"translate"),a(),r(4,"input",6),_("keyup",function(n){g(e);let s=d(2);return C(s.updatedResVal(n))}),a(),r(5,"mat-autocomplete",7,0),Ee(7,la,2,2,"mat-option",9,Xt),l(9,"async"),a()()}if(t&2){let e=F(6),i=d(2);o(2),T(c(3,4,"FACILITY_DETAIL.SERVICE_CONFIG.RES_SELECT")),o(2),m("formControl",i.resourceField)("matAutocomplete",e),o(),m("displayWith",i.resourceDisplayFn.bind(i)),o(2),xe(c(9,6,i.filteredResources))}}function pa(t,f){if(t&1){let e=v();r(0,"mat-option",8),_("onSelectionChange",function(){let n=g(e).$implicit,s=d(3);return C(s.onSelectedGroup(n))}),p(1),a()}if(t&2){let e=f.$implicit;m("value",e),o(),h(" ",e.name," ")}}function da(t,f){if(t&1){let e=v();r(0,"mat-form-field",4)(1,"mat-label"),p(2),l(3,"translate"),a(),r(4,"input",6),_("keyup",function(n){g(e);let s=d(2);return C(s.updatedGroupVal(n))}),a(),r(5,"mat-autocomplete",10,0),Ee(7,pa,2,2,"mat-option",9,Xt),l(9,"async"),a()()}if(t&2){let e=F(6),i=d(2);o(2),T(c(3,4,"FACILITY_DETAIL.SERVICE_CONFIG.GROUP_SELECT")),o(2),m("formControl",i.groupField)("matAutocomplete",e),o(),m("displayWith",i.groupDisplayFn.bind(i)),o(2),xe(c(9,6,i.filteredGroups))}}function ma(t,f){if(t&1){let e=v();r(0,"mat-option",8),_("onSelectionChange",function(){let n=g(e).$implicit,s=d(3);return C(s.onSelectedMember(n))}),p(1),l(2,"userFullName"),a()}if(t&2){let e=f.$implicit;m("value",e),o(),h(" ",c(2,2,e.user)," ")}}function ua(t,f){if(t&1&&(r(0,"mat-form-field",4)(1,"mat-label"),p(2),l(3,"translate"),a(),S(4,"input",11),r(5,"mat-autocomplete",7,0),Ee(7,ma,3,4,"mat-option",9,Xt),l(9,"async"),a()()),t&2){let e=F(6),i=d(2);o(2),T(c(3,4,"FACILITY_DETAIL.SERVICE_CONFIG.MEMBER_SELECT")),o(2),m("matAutocomplete",e)("formControl",i.memberField),o(),m("displayWith",i.memberDisplayFn.bind(i)),o(2),xe(c(9,6,i.filteredMembers))}}function fa(t,f){if(t&1){let e=v();r(0,"div",2),b(1,sa,16,16,"mat-form-field",4),r(2,"mat-checkbox",5),_("change",function(n){g(e);let s=d();return C(s.onOfferAllServices(n))}),p(3),l(4,"translate"),a(),b(5,ca,10,8,"mat-form-field",4),b(6,da,10,8,"mat-form-field",4),b(7,ua,10,8,"mat-form-field",4),a()}if(t&2){let e=d();o(),I(e.services!==void 0?1:-1),o(2),h(" ",c(4,5,"FACILITY_DETAIL.SERVICE_CONFIG.ALL_SERVICES")," "),o(2),I(e.resources!==void 0&&e.resources.length!==0?5:-1),o(),I(e.selectedResource!==void 0&&e.groups!==void 0&&e.groups.length!==0?6:-1),o(),I(e.selectedGroup!==void 0&&e.members!==void 0&&e.members.length!==0?7:-1)}}function ha(t,f){if(t&1&&S(0,"app-perun-web-apps-service-configurator",3),t&2){let e=d();m("facility",e.facility)("resource",e.selectedResource)("group",e.selectedGroup)("member",e.selectedMember)("service",e.selectedService)}}var ho=(()=>{class t{constructor(e,i,n,s,y,D,K){this.facilityManager=e,this.resourceManager=i,this.serviceManager=n,this.membersManager=s,this.namePipe=y,this.translate=D,this.entityStorageService=K,this.serviceField=new le,this.resourceField=new le,this.groupField=new le,this.memberField=new le,this.allowedStatuses=["INVALID","VALID"],this.selectedService="NOT_SELECTED",this.attrNames=[],this.translate.get("FACILITY_DETAIL.SERVICE_CONFIG.ALL").subscribe(U=>this.serviceAllTranslation=U),this.translate.get("FACILITY_DETAIL.SERVICE_CONFIG.NOT_SELECTED").subscribe(U=>this.serviceNotSelectedTranslation=U)}ngOnInit(){this.facility=this.entityStorageService.getEntity(),this.facilityManager.getFacilityById(this.facility.id).subscribe(e=>{this.facility=e,this.facilityManager.getAssignedResourcesForFacility(e.id).subscribe(i=>this.resources=i),this.serviceManager.getAssignedServices(e.id).subscribe(i=>this.services=i)}),this.filteredServices=this.serviceField.valueChanges.pipe(je(""),Ge(e=>this._filterServices(e))),this.filteredResources=this.resourceField.valueChanges.pipe(je(""),Ge(e=>this._filterResources(e))),this.filteredGroups=this.groupField.valueChanges.pipe(je(""),Ge(e=>this._filterGroups(e))),this.filteredMembers=this.memberField.valueChanges.pipe(je(""),Ge(e=>this._filterMembers(e)))}onSelectedService(e){this.selectedService=e}onSelectedResource(e){this.selectedResource=e,this.selectedResource!==void 0?(this.resourceManager.getAssignedGroups(this.selectedResource.id).subscribe(i=>this.groups=i),this.selectedGroup=void 0,this.selectedMember=void 0):this.groups=void 0}onOfferAllServices(e){e.checked||this.serviceManager.getAssignedServices(this.facility.id).subscribe(i=>this.services=i)}onSelectedGroup(e){this.selectedGroup=e,this.selectedGroup!==void 0?(this.membersManager.getCompleteRichMembersForGroup(this.selectedGroup.id,!1,this.allowedStatuses,[],this.attrNames).subscribe(i=>this.members=i),this.selectedMember=void 0):this.members=void 0}onSelectedMember(e){this.selectedMember=e}serviceDisplayFn(e){if(e!==null)return e==="ALL"?this.serviceAllTranslation:e==="NOT_SELECTED"?this.serviceNotSelectedTranslation:typeof e!="string"?e.name:e}resourceDisplayFn(e){if(e!==null)return e.name}groupDisplayFn(e){if(e!==null)return e.name}memberDisplayFn(e){if(e!==null)return this.namePipe.transform(e.user)}updatedSerVal(e){e.target.value===""&&(this.selectedService="NOT_SELECTED")}updatedResVal(e){e.target.value===""&&(this.groups=void 0,this.members=void 0)}updatedGroupVal(e){e.target.value===""&&(this.members=void 0)}_filterServices(e){let i=e.toString().toLowerCase();return this.services.filter(n=>n.name.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").includes(i))}_filterResources(e){let i=e.toString().toLowerCase();return this.resources.filter(n=>n.name.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").includes(i))}_filterGroups(e){let i=e.toString().toLowerCase();return this.groups.filter(n=>n.name.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").includes(i))}_filterMembers(e){let i=e.toString().toLowerCase();return this.members.filter(n=>this.namePipe.transform(n.user).toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").includes(i))}static{this.\u0275fac=function(i){return new(i||t)(u(O),u(_t),u(ue),u(Gi),u(Pe),u(ce),u(j))}}static{this.\u0275cmp=E({type:t,selectors:[["app-facility-service-config"]],decls:6,vars:5,consts:[["auto","matAutocomplete"],[1,"page-subtitle"],[1,"col-12","col-lg-6","mb-2"],[3,"facility","resource","group","member","service"],[1,"w-100"],[3,"change"],["matInput","","type","text",3,"keyup","formControl","matAutocomplete"],["autoActiveFirstOption","",3,"displayWith"],[3,"onSelectionChange","value"],[3,"value"],["autoActiveFirstOption","",3,"displayWith","ngClass"],["matInput","","type","text",3,"matAutocomplete","formControl"]],template:function(i,n){i&1&&(r(0,"div")(1,"h1",1),p(2),l(3,"translate"),a(),b(4,fa,8,7,"div",2),b(5,ha,1,5,"app-perun-web-apps-service-configurator",3),a()),i&2&&(o(2),T(c(3,3,"FACILITY_DETAIL.SERVICE_CONFIG.TITLE")),o(2),I(n.facility?4:-1),o(),I(n.facility?5:-1))},dependencies:[x,Ai,pt,ct,lt,ft,ut,Ot,Lt,Le,we,qe,We,ze,$e,Dn,En,xn,R,po,xt,M,Pe],encapsulation:2})}}return t})();var Qt=(()=>{class t{constructor(e,i,n){this.facilityService=e,this.guiAuthResolver=i,this.entityStorageService=n,this.disableRouting=!1,this.disableSelf=!1,this.availableRoles=[],this.selected="user",this.type="Facility",this.theme="facility-theme"}ngOnInit(){this.facility=this.entityStorageService.getEntity(),this.guiAuthResolver.assignAvailableRoles(this.availableRoles,"Facility")}static{this.\u0275fac=function(i){return new(i||t)(u(O),u(B),u(j))}}static{this.\u0275cmp=E({type:t,selectors:[["app-perun-web-apps-facility-settings-managers"]],hostVars:2,hostBindings:function(i,n){i&2&&Y("router-component",n.true)},inputs:{disableRouting:"disableRouting",disableSelf:"disableSelf"},decls:1,vars:6,consts:[[3,"complementaryObject","availableRoles","complementaryObjectType","disableSelf","disableRouting","theme"]],template:function(i,n){i&1&&S(0,"app-managers-page",0),i&2&&m("complementaryObject",n.facility)("availableRoles",n.availableRoles)("complementaryObjectType",n.type)("disableSelf",n.disableSelf)("disableRouting",n.disableRouting)("theme",n.theme)},dependencies:[x,$t],encapsulation:2})}}return t})();var _a=(t,f)=>f.id;function ga(t,f){t&1&&S(0,"perun-web-apps-loading-dialog")}function Ca(t,f){t&1&&(r(0,"mat-option",6),p(1),l(2,"translate"),a()),t&2&&(o(),T(c(2,1,"DIALOGS.ADD_SERVICE_DESTINATION.SELECTION_ALL")))}function Sa(t,f){t&1&&(r(0,"mat-option",7),p(1),l(2,"translate"),a()),t&2&&(o(),T(c(2,1,"DIALOGS.ADD_SERVICE_DESTINATION.NO_SERVICE")))}function va(t,f){if(t&1&&(r(0,"mat-option",8),p(1),a()),t&2){let e=f.$implicit;m("value",e),o(),h(" ",e.name," ")}}function ba(t,f){t&1&&(r(0,"mat-error"),p(1),l(2,"translate"),a()),t&2&&(o(),h(" ",c(2,1,"DIALOGS.ADD_SERVICE_DESTINATION.CHOOSE_SERVICE")," "))}function Ia(t,f){if(t&1&&(r(0,"mat-option",8),p(1),a()),t&2){let e=f.$implicit,i=d(2);m("value",e),o(),h(" ",i.getTypeForView(e)," ")}}function ya(t,f){t&1&&(r(0,"mat-error"),p(1),l(2,"translate"),a()),t&2&&(o(),h(" ",c(2,1,"DIALOGS.ADD_SERVICE_DESTINATION.REQUIRED_FIELD")," "))}function Ta(t,f){t&1&&(r(0,"mat-error"),p(1),l(2,"translate"),a()),t&2&&(o(),h(" ",c(2,1,"DIALOGS.ADD_SERVICE_DESTINATION.INVALID_DESTINATION")," "))}function Aa(t,f){if(t&1&&(r(0,"mat-form-field",11)(1,"mat-label"),p(2),a(),S(3,"input",17),b(4,ya,3,3,"mat-error"),b(5,Ta,3,3,"mat-error"),a()),t&2){let e=d(2);o(2),T(e.getTypeForView(e.selectedType)),o(),m("formControl",e.destinationControl),o(),I(e.selectedType==="host"&&!e.useFacilityHost&&e.destinationControl.hasError("required")?4:-1),o(),I(e.destinationControl.hasError("invalidDestination")?5:-1)}}function Ea(t,f){if(t&1){let e=v();r(0,"mat-checkbox",13),Re("ngModelChange",function(n){g(e);let s=d(2);return Me(s.useFacilityHost,n)||(s.useFacilityHost=n),C(n)}),p(1),l(2,"translate"),a()}if(t&2){let e=d(2);De("ngModel",e.useFacilityHost),o(),h(" ",c(2,2,"DIALOGS.ADD_SERVICE_DESTINATION.USE_FACILITY_HOST")," ")}}function xa(t,f){if(t&1&&(r(0,"mat-option",8),p(1),a()),t&2){let e=f.$implicit;m("value",e),o(),h(" ",e," ")}}function Da(t,f){if(t&1){let e=v();r(0,"div")(1,"h1",2),p(2),l(3,"translate"),a(),r(4,"div",3)(5,"div",4),p(6),l(7,"translate"),a(),r(8,"mat-form-field")(9,"mat-label"),p(10),l(11,"translate"),a(),r(12,"mat-select",5),b(13,Ca,3,3,"mat-option",6),b(14,Sa,3,3,"mat-option",7),Ee(15,va,2,2,"mat-option",8,_a),a(),b(17,ba,3,3,"mat-error"),a(),r(18,"mat-checkbox",9),_("change",function(){g(e);let n=d();return C(n.getServices())}),Re("ngModelChange",function(n){g(e);let s=d();return Me(s.servicesOnFacility,n)||(s.servicesOnFacility=n),C(n)}),p(19),l(20,"translate"),a(),r(21,"mat-form-field")(22,"mat-label"),p(23),l(24,"translate"),a(),r(25,"mat-select",10),Re("ngModelChange",function(n){g(e);let s=d();return Me(s.selectedType,n)||(s.selectedType=n),C(n)}),_("selectionChange",function(){g(e);let n=d();return C(n.destinationControl.updateValueAndValidity())}),Ee(26,Ia,2,2,"mat-option",8,oi),a()(),b(28,Aa,6,4,"mat-form-field",11),b(29,Ea,3,4,"mat-checkbox",12),r(30,"mat-form-field")(31,"mat-label"),p(32),l(33,"translate"),a(),r(34,"mat-select",13),Re("ngModelChange",function(n){g(e);let s=d();return Me(s.selectedPropagation,n)||(s.selectedPropagation=n),C(n)}),Ee(35,xa,2,2,"mat-option",8,oi),a()(),r(37,"div",4),p(38),l(39,"translate"),a()(),r(40,"div",14)(41,"button",15),_("click",function(){g(e);let n=d();return C(n.onCancel())}),p(42),l(43,"translate"),a(),r(44,"button",16),_("click",function(){g(e);let n=d();return C(n.onSubmit())}),p(45),l(46,"translate"),a()()()}if(t&2){let e=d();o(2),T(c(3,19,"DIALOGS.ADD_SERVICE_DESTINATION.TITLE")),o(4),T(c(7,21,"DIALOGS.ADD_SERVICE_DESTINATION.DESCRIPTION")),o(4),T(c(11,23,"DIALOGS.ADD_SERVICE_DESTINATION.SERVICE")),o(2),m("formControl",e.serviceControl),o(),I(e.services.length!==0?13:-1),o(),I(e.services.length===0?14:-1),o(),xe(e.services),o(2),I(e.serviceControl.value===void 0?17:-1),o(),De("ngModel",e.servicesOnFacility),o(),h(" ",c(20,25,"DIALOGS.ADD_SERVICE_DESTINATION.IS_SERVICES_ONLY_ON_FACILITY")," "),o(4),T(c(24,27,"DIALOGS.ADD_SERVICE_DESTINATION.TYPE")),o(2),De("ngModel",e.selectedType),o(),xe(e.types),o(2),I(e.selectedType==="host"&&e.useFacilityHost?-1:28),o(),I(e.selectedType==="host"?29:-1),o(3),T(c(33,29,"DIALOGS.ADD_SERVICE_DESTINATION.PROPAGATION")),o(2),De("ngModel",e.selectedPropagation),o(),xe(e.propagations),o(3),h(" ",c(39,31,"DIALOGS.ADD_SERVICE_DESTINATION.PROPAGATION_TYPE_"+e.selectedPropagation)," "),o(4),h(" ",c(43,33,"DIALOGS.ADD_SERVICE_DESTINATION.CANCEL")," "),o(2),m("disabled",e.loading||e.invalidDestination()||e.serviceControl.invalid||e.serviceControl.value==="noService"),o(),h(" ",c(46,35,"DIALOGS.ADD_SERVICE_DESTINATION.ADD")," ")}}var _o=(()=>{class t{constructor(e,i,n,s){this.dialogRef=e,this.data=i,this.facilitiesManager=n,this.servicesManager=s,this.services=[],this.types=["host","user@host","user@host:port","user@host-windows","host-windows-proxy","url","service-specific","s3","s3-json","url-json"],this.selectedType="host",this.propagations=["PARALLEL","DUMMY"],this.selectedPropagation="PARALLEL",this.useFacilityHost=!1,this.loading=!1,this.emailRegex=new RegExp(nn),this.hostPattern=new RegExp("^(?!:\\/\\/)(?=.{1,255}$)((.{1,63}\\.){1,127}(?![0-9]*$)[a-z0-9-]+\\.?)$|^(25[0-5]|2[0-4]\\d|[0-1]?\\d?\\d)(\\.(25[0-5]|2[0-4]\\d|[0-1]?\\d?\\d)){3}$"),this.urlPattern=new RegExp("^(https?|ftp|file)://[-a-zA-Z0-9+&@#/%?=~_|!:,.;()*$']*[-a-zA-Z0-9+&@#/%=~_|()*$']$"),this.userAtHostPattern=new RegExp("^[a-z_]([a-z0-9_-]{0,31}|[a-z0-9_-]{0,30}\\$)@(?:(?!:\\/\\/)(?=.{1,255}$)((.{1,63}\\.){1,127}(?![0-9]*$)[a-z0-9-]+\\.?)$|(25[0-5]|2[0-4]\\d|[0-1]?\\d?\\d)(\\.(25[0-5]|2[0-4]\\d|[0-1]?\\d?\\d)){3}$)"),this.userAtHostPortPattern=new RegExp("^[a-z_]([a-z0-9_-]{0,31}|[a-z0-9_-]{0,30}\\$)@(?:(?!:\\/\\/)(?=.{1,255}$)((.{1,63}\\.){1,127}(?![0-9]*$)[a-z0-9-]+\\.?)|(25[0-5]|2[0-4]\\d|[0-1]?\\d?\\d)(\\.(25[0-5]|2[0-4]\\d|[0-1]?\\d?\\d)){3}):[0-9]+"),this.serviceSpecificPattern=new RegExp("^(?!-)[a-zA-Z0-9-_.:/]*$"),this.s3Pattern=new RegExp("^(https?://[-a-zA-Z0-9+&@#/%?=~_|!:,.;()*$']+)/([-a-zA-Z0-9+&@#%?=~_|!:,.;()*$'']+)$"),this.s3JsonPattern=this.s3Pattern,this.urlJsonPattern=this.urlPattern}ngOnInit(){this.serviceControl=new le(void 0,Fe.required),this.destinationControl=new le("",this.getDestinationValidator()),this.emailControl=new le("",[Fe.required,Fe.pattern(this.emailRegex)]),this.servicesOnFacility=!0,this.getServices()}onCancel(){this.dialogRef.close()}onSubmit(){this.loading=!0,this.serviceControl.value==="all"?this.useFacilityHost?this.servicesManager.addDestinationsDefinedByHostsOnFacilityWithListOfServiceAndFacility({services:this.services,facility:this.data.facility.id}).subscribe(()=>{this.dialogRef.close(!0)},()=>this.loading=!1):this.servicesManager.addDestinationToMultipleServices({services:this.services,facility:this.data.facility.id,destination:this.destinationControl.value,type:this.selectedType,propagationType:this.selectedPropagation}).subscribe(()=>{this.dialogRef.close(!0)},()=>this.loading=!1):this.useFacilityHost?this.servicesManager.addDestinationsDefinedByHostsOnFacilityWithServiceAndFacility(this.serviceControl.value.id,this.data.facility.id).subscribe(()=>{this.dialogRef.close(!0)},()=>this.loading=!1):this.servicesManager.addDestination(this.serviceControl.value.id,this.data.facility.id,this.destinationControl.value,this.selectedType,this.selectedPropagation).subscribe(()=>{this.dialogRef.close(!0)},()=>this.loading=!1)}getServices(){this.loading=!0,this.servicesOnFacility?this.data.configServices.length!==0?this.services=this.data.configServices:this.servicesManager.getAssignedServices(this.data.facility.id).subscribe(e=>{this.services=e},()=>this.loading=!1):this.servicesManager.getServices().subscribe(e=>{this.services=e},()=>this.loading=!1),this.loading=!1,this.serviceControl.setValue(void 0)}getTypeForView(e){return e==="service-specific"?"Service Specific":e}invalidDestination(){return this.selectedType==="host"&&this.useFacilityHost?!1:this.destinationControl.invalid}getDestinationValidator(){return e=>{if(!e.value)return null;let i;switch(this.selectedType){case"host":case"host-windows-proxy":i=this.hostPattern;break;case"url":i=this.urlPattern;break;case"user@host":case"user@host-windows":i=this.userAtHostPattern;break;case"user@host:port":i=this.userAtHostPortPattern;break;case"service-specific":i=this.serviceSpecificPattern;break;case"s3":i=this.s3Pattern;break;case"s3-json":i=this.s3JsonPattern;break;case"url-json":i=this.urlJsonPattern;break;default:return null}return i.test(e.value)?null:{invalidDestination:{value:e.value}}}}static{this.\u0275fac=function(i){return new(i||t)(u(W),u(z),u(O),u(ue))}}static{this.\u0275cmp=E({type:t,selectors:[["app-perun-web-apps-add-services-destination-dialog"]],decls:4,vars:5,consts:[["spinner",""],[4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],["mat-dialog-title",""],["mat-dialog-content","",1,"dialog-container"],[1,"font-italic"],["required","",3,"formControl"],["value","all"],["value","noService"],[3,"value"],[3,"change","ngModelChange","ngModel"],[3,"ngModelChange","selectionChange","ngModel"],[1,"w-100"],[3,"ngModel"],[3,"ngModelChange","ngModel"],["mat-dialog-actions",""],["mat-stroked-button","",1,"ms-auto",3,"click"],["color","accent","mat-flat-button","",1,"ms-2",3,"click","disabled"],["matInput","","required","",3,"formControl"]],template:function(i,n){if(i&1&&(A(0,ga,1,0,"ng-template",null,0,V),r(2,"div"),A(3,Da,47,37,"div",1),a()),i&2){let s=F(1);o(2),Z(fe("",n.data.theme," position-relative")),o(),m("perunWebAppsLoader",n.loading)("perunWebAppsLoaderIndicator",s)}},dependencies:[x,w,L,pt,ct,lt,wt,ft,ut,Ot,wi,Lt,Le,we,qe,We,ze,Dt,$e,Mi,Di,ne,ee,ie,te,he,R,N,M],encapsulation:2,data:{animation:[yn]}})}}return t})();function Ma(t,f){t&1&&(r(0,"perun-web-apps-alert",2),p(1),l(2,"translate"),a()),t&2&&(o(),h(" ",c(2,1,"FACILITY_DETAIL.SERVICES_DESTINATIONS.DESTINATIONS_INFO")," "))}function Ra(t,f){if(t&1){let e=v();r(0,"button",10),_("click",function(){g(e);let n=d();return C(n.addDestination())}),p(1),l(2,"translate"),a()}t&2&&(o(),h(" ",c(2,1,"FACILITY_DETAIL.SERVICES_DESTINATIONS.ADD")," "))}function Fa(t,f){if(t&1){let e=v();r(0,"button",11),_("click",function(){g(e);let n=d();return C(n.removeDestination())}),p(1),l(2,"translate"),a()}if(t&2){let e=d();m("disabled",e.loading||e.selected.selected.length===0),o(),h(" ",c(2,2,"FACILITY_DETAIL.SERVICES_DESTINATIONS.REMOVE")," ")}}function wa(t,f){if(t&1){let e=v();r(0,"button",12),_("click",function(){g(e);let n=d();return C(n.onAllow())}),r(1,"mat-icon"),p(2," check_circle_outline "),a(),p(3),l(4,"translate"),a()}if(t&2){let e=d();m("disabled",e.loading||e.selected.selected.length===0||e.allSelectedAllowed()),o(3),h(" ",c(4,2,"FACILITY_DETAIL.SERVICES_DESTINATIONS.ALLOW")," ")}}function La(t,f){if(t&1){let e=v();r(0,"button",12),_("click",function(){g(e);let n=d();return C(n.onBlock())}),r(1,"mat-icon"),p(2," block "),a(),p(3),l(4,"translate"),a()}if(t&2){let e=d();m("disabled",e.loading||e.selected.selected.length===0||e.allSelectedBlocked()),o(3),h(" ",c(4,2,"FACILITY_DETAIL.SERVICES_DESTINATIONS.BLOCK")," ")}}function Oa(t,f){t&1&&S(0,"perun-web-apps-loading-table")}function ka(t,f){if(t&1&&S(0,"app-perun-web-apps-destination-list",13),t&2){let e=d();m("filterValue",e.filterValue)("loading",e.loading)("selection",e.selected)("cachedSubject",e.cachedSubject)("destinations",e.destinations)("services",e.configServicesIds)("displayColumns",e.displayedColumns)}}var Zt=(()=>{class t{static{this.id="FacilityServicesDestinationsComponent"}constructor(e,i,n,s,y,D,K){this.dialog=e,this.servicesManager=i,this.translate=n,this.notificator=s,this.authResolver=y,this.serviceManager=D,this.entityStorageService=K,this.displayedColumns=["select","destinationId","service","destination","type","status","propagationType","lastSuccessfulPropagation","lastAttemptedPropagation"],this.configServices=[],this.configServicesIds=new Set,this.title="FACILITY_DETAIL.SERVICES_DESTINATIONS.TITLE",this.destinationEmitter=new Et,this.destinations=[],this.selected=new G(!0,[],!0,(U,X)=>U.id===X.id&&U.facility?.id===X.facility?.id&&U.service?.id===X.service?.id),this.cachedSubject=new ae(!0),this.filterValue=""}ngOnInit(){this.loading=!0,this.facility=this.entityStorageService.getEntity(),this.setAuthRights(),this.refreshTable()}refreshTable(){this.loading=!0,this.servicesManager.getAllRichDestinationsForFacility(this.facility.id).subscribe(e=>{this.destinations=e,this.destinationEmitter.emit(this.destinations),this.selected.clear(),this.cachedSubject.next(!0),this.setAuthRights(),this.loading=!1})}setAuthRights(){this.addAuth=this.authResolver.isAuthorized("addDestination_Service_Facility_Destination_policy",[this.facility]),this.removeAuth=this.authResolver.isAuthorized("removeDestination_Service_Facility_Destination_policy",[this.facility]),this.allowAuth=this.authResolver.isAuthorized("unblockServiceOnDestination_Service_int_policy",[this.facility]),this.blockAuth=this.authResolver.isAuthorized("blockServiceOnDestination_Service_int_policy",[this.facility]),this.displayedColumns=this.removeAuth?this.displayedColumns:this.displayedColumns.filter(e=>e!=="select")}addDestination(){let e=k();e.width="600px",e.data={facility:this.facility,theme:"facility-theme",configServices:this.configServices},this.dialog.open(_o,e).afterClosed().subscribe(n=>{n&&(this.refreshTable(),this.notificator.showSuccess(this.translate.instant("FACILITY_DETAIL.SERVICES_DESTINATIONS.ADD_SUCCESS")))})}removeDestination(){let e=k();e.width="600px",e.data={destinations:this.selected.selected,theme:"facility-theme"},this.dialog.open(Xn,e).afterClosed().subscribe(n=>{n&&this.refreshTable()})}blockServicesOnDestinations(e){this.serviceManager.blockServicesOnDestinations({richDestinations:e}).subscribe({next:()=>{this.notificator.showSuccess(this.translate.instant("FACILITY_DETAIL.SERVICES_DESTINATIONS.BLOCK_SUCCESS")),this.refreshTable()},error:()=>this.loading=!1})}onBlock(){this.loading=!0,this.blockServicesOnDestinations(this.selected.selected)}allowServicesOnDestinations(e){this.serviceManager.unblockServicesOnDestinations({richDestinations:e}).subscribe({next:()=>{this.notificator.showSuccess(this.translate.instant("FACILITY_DETAIL.SERVICES_DESTINATIONS.ALLOW_SUCCESS")),this.refreshTable()},error:()=>this.loading=!1})}onAllow(){this.loading=!0,this.allowServicesOnDestinations(this.selected.selected)}applyFilter(e){this.filterValue=e,this.refreshTable()}allSelectedAllowed(){return this.selected.selected.reduce((e,i)=>e&&!i.blocked,!0)}allSelectedBlocked(){return this.selected.selected.reduce((e,i)=>e&&i.blocked,!0)}static{this.\u0275fac=function(i){return new(i||t)(u(J),u(ue),u(ht),u(H),u(B),u(ue),u(j))}}static{this.\u0275cmp=E({type:t,selectors:[["app-perun-web-apps-facility-services-destinations"]],hostVars:2,hostBindings:function(i,n){i&2&&Y("router-component",n.true)},inputs:{displayedColumns:"displayedColumns",configServices:"configServices",configServicesIds:"configServicesIds",title:"title",loading:"loading"},outputs:{destinationEmitter:"destinationEmitter"},decls:15,vars:11,consts:[["spinner",""],[1,"page-subtitle"],["alert_type","info"],[3,"refresh"],["color","accent","mat-flat-button","",1,"me-2","action-button"],["color","warn","mat-flat-button","",1,"me-2",3,"disabled"],["mat-stroked-button","",1,"me-2",3,"disabled"],[3,"filter","placeholder"],[1,"position-relative","table-min-height"],[3,"filterValue","loading","selection","cachedSubject","destinations","services","displayColumns",4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],["color","accent","mat-flat-button","",1,"me-2","action-button",3,"click"],["color","warn","mat-flat-button","",1,"me-2",3,"click","disabled"],["mat-stroked-button","",1,"me-2",3,"click","disabled"],[3,"filterValue","loading","selection","cachedSubject","destinations","services","displayColumns"]],template:function(i,n){if(i&1){let s=v();r(0,"div")(1,"h1",1),p(2),l(3,"translate"),a(),b(4,Ma,3,3,"perun-web-apps-alert",2),r(5,"perun-web-apps-refresh-button",3),_("refresh",function(){return g(s),C(n.refreshTable())}),a(),b(6,Ra,3,3,"button",4),b(7,Fa,3,4,"button",5),b(8,wa,5,4,"button",6),b(9,La,5,4,"button",6),r(10,"perun-web-apps-debounce-filter",7),_("filter",function(D){return g(s),C(n.applyFilter(D))}),a(),A(11,Oa,1,0,"ng-template",null,0,V),r(13,"div",8),A(14,ka,1,7,"app-perun-web-apps-destination-list",9),a()()}if(i&2){let s=F(12);o(2),T(c(3,9,n.title)),o(2),I(n.title.includes("CONFIG")?4:-1),o(2),I(n.addAuth?6:-1),o(),I(n.removeAuth?7:-1),o(),I(n.allowAuth?8:-1),o(),I(n.blockAuth?9:-1),o(),m("placeholder","FACILITY_DETAIL.SERVICES_DESTINATIONS.FILTER"),o(4),m("perunWebAppsLoader",n.loading)("perunWebAppsLoaderIndicator",s)}},dependencies:[x,w,L,Ve,ke,Be,Ne,de,Ae,R,Kt,N,pe,M],encapsulation:2})}}return t})();function Va(t,f){t&1&&S(0,"perun-web-apps-loading-dialog")}function Na(t,f){t&1&&(r(0,"mat-error"),p(1),l(2,"translate"),a()),t&2&&(o(),h(" ",c(2,1,"DIALOGS.ADD_HOST.EMPTY_MESSAGE")," "))}function Ba(t,f){if(t&1&&(r(0,"mat-error"),p(1),l(2,"translate"),a()),t&2){let e=d(2);o(),Ie(" ",c(2,2,"DIALOGS.ADD_HOST.INVALID_HOST")," ",e.hostsCtrl.getError("invalidHost").value," ")}}function Pa(t,f){if(t&1){let e=v();r(0,"div")(1,"h1",2),p(2),l(3,"translate"),a(),r(4,"div",3)(5,"mat-form-field",4)(6,"mat-label"),p(7),l(8,"translate"),a(),r(9,"textarea",5),p(10,"        "),a(),b(11,Na,3,3,"mat-error"),b(12,Ba,3,4,"mat-error"),a(),r(13,"perun-web-apps-alert",6),p(14),l(15,"translate"),a()(),r(16,"div",7)(17,"button",8),_("click",function(){g(e);let n=d();return C(n.onCancel())}),p(18),l(19,"translate"),a(),r(20,"button",9),_("click",function(){g(e);let n=d();return C(n.onAdd())}),p(21),l(22,"translate"),a()()()}if(t&2){let e=d();o(2),T(c(3,9,"DIALOGS.ADD_HOST.TITLE")),o(5),T(c(8,11,"DIALOGS.ADD_HOST.SUBTITLE")),o(2),m("formControl",e.hostsCtrl),o(2),I(e.hostsCtrl.hasError("required")?11:-1),o(),I(e.hostsCtrl.hasError("invalidHost")?12:-1),o(2),T(c(15,13,"DIALOGS.ADD_HOST.HINT")),o(4),h(" ",c(19,15,"DIALOGS.ADD_HOST.CANCEL")," "),o(2),m("disabled",e.hostsCtrl.invalid||e.loading),o(),h(" ",c(22,17,"DIALOGS.ADD_HOST.ADD")," ")}}var go=(()=>{class t{constructor(e,i,n,s,y){this.dialogRef=e,this.data=i,this.facilitiesManager=n,this.notificator=s,this.translate=y,this.loading=!1,this.hostPattern=new RegExp("^(?!:\\/\\/)(?=.{1,255}$)((.{1,63}\\.){1,127}(?![0-9]*$)[a-z0-9-]+\\.?)$|^(25[0-5]|2[0-4]\\d|[0-1]?\\d?\\d)(\\.(25[0-5]|2[0-4]\\d|[0-1]?\\d?\\d)){3}$")}static parseRange(e){let[i,n]=e.split("-"),s=parseInt(i.substring(1,i.length),10),y=parseInt(n.substring(0,n.length),10);return[s,y]}ngOnInit(){this.theme=this.data.theme,this.hostsCtrl=new le("",[Fe.required,this.hostsNameValidator()]),this.hostsCtrl.markAllAsTouched()}onAdd(){this.loading=!0;let e=this.hostsCtrl.value.split(`
`),i=[];for(let n of e)i=i.concat(this.parseHostName(n));this.facilitiesManager.addHosts(this.data.facilityId,i).subscribe(()=>{this.notificator.showSuccess(this.translate.instant("DIALOGS.ADD_HOST.SUCCESS")),this.dialogRef.close(!0)},()=>this.loading=!1)}onCancel(){this.dialogRef.close(!1)}hostsNameValidator(){return e=>{let i=[],n=e.value.split(`
`);for(let s of n)i=i.concat(this.parseHostName(s));for(let s of i)if(!this.hostPattern.test(s))return{invalidHost:{value:s}};return null}}parseHostName(e){let i=new RegExp("[[0-9]+-[0-9]+]","g"),n=e.split(i),s=e.match(i);if(s==null)return e===""?[]:[e];let y=[];for(let D=0;D<n.length-1;D++){let[K,U]=t.parseRange(s[D]),X=[];for(let oe=K;oe<=U;oe++)X=X.concat(n[D].concat(oe.toString()));y=y.concat([X])}return y=y.concat([[n[n.length-1]]]),this.joinHostNames(y,0)}joinHostNames(e,i){if(i===e.length-1)return e[i];let n=this.joinHostNames(e,i+1),s=[];for(let y of e[i])for(let D of n)s.push(y.concat(D));return s}static{this.\u0275fac=function(i){return new(i||t)(u(W),u(z),u(O),u(H),u(ce))}}static{this.\u0275cmp=E({type:t,selectors:[["app-add-host-dialog"]],decls:4,vars:5,consts:[["spinner",""],[4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],["mat-dialog-title",""],["mat-dialog-content","",1,"dialog-container"],["subscriptSizing","dynamic"],["id","facilityAddHost","name","facilityAddHost","required","","matInput","","perunWebAppsAutoFocus","","rows","8",3,"formControl"],["alert_type","info"],["mat-dialog-actions",""],["mat-stroked-button","",1,"ms-auto",3,"click"],["color","accent","mat-flat-button","",1,"ms-2",3,"click","disabled"]],template:function(i,n){if(i&1&&(A(0,Va,1,0,"ng-template",null,0,V),r(2,"div"),A(3,Pa,23,19,"div",1),a()),i&2){let s=F(1);o(2),Z(fe("",n.theme," position-relative")),o(),m("perunWebAppsLoader",n.loading)("perunWebAppsLoaderIndicator",s)}},dependencies:[x,w,L,pt,ct,lt,wt,ft,ut,qe,We,ze,Dt,$e,ne,ee,ie,te,Be,Ne,he,R,N,Bi,M],encapsulation:2})}}return t})();function Ga(t,f){t&1&&S(0,"perun-web-apps-loading-dialog")}function ja(t,f){t&1&&S(0,"th",14)}function Ha(t,f){if(t&1&&(r(0,"td",15),p(1),a()),t&2){let e=f.$implicit;o(),T(e.hostname)}}function Ua(t,f){t&1&&S(0,"tr",16)}function Ya(t,f){t&1&&S(0,"tr",17)}function Wa(t,f){if(t&1){let e=v();r(0,"div")(1,"h1",2),p(2),l(3,"translate"),a(),r(4,"div",3)(5,"p"),p(6),l(7,"translate"),a(),r(8,"div",4),p(9),l(10,"translate"),a(),r(11,"table",5),ge(12,6),A(13,ja,1,0,"th",7)(14,Ha,2,1,"td",8),Ce(),A(15,Ua,1,0,"tr",9)(16,Ya,1,0,"tr",10),a()(),r(17,"div",11)(18,"button",12),_("click",function(){g(e);let n=d();return C(n.onCancel())}),p(19),l(20,"translate"),a(),r(21,"button",13),_("click",function(){g(e);let n=d();return C(n.onConfirm())}),p(22),l(23,"translate"),a()()()}if(t&2){let e=d();o(2),T(c(3,9,"DIALOGS.REMOVE_HOST.TITLE")),o(4),T(c(7,11,"DIALOGS.REMOVE_HOST.DESCRIPTION")),o(3),h(" ",c(10,13,"DIALOGS.REMOVE_HOST.ASK")," "),o(2),m("dataSource",e.dataSource),o(4),m("matHeaderRowDef",e.displayedColumns),o(),m("matRowDefColumns",e.displayedColumns),o(3),h(" ",c(20,15,"DIALOGS.REMOVE_HOST.CANCEL")," "),o(2),m("disabled",e.loading),o(),h(" ",c(23,17,"DIALOGS.REMOVE_HOST.CONFIRM")," ")}}var So=(()=>{class t{constructor(e,i,n,s,y){this.dialogRef=e,this.data=i,this.facilitiesManager=n,this.notificator=s,this.translate=y,this.displayedColumns=["name"],this.loading=!1}ngOnInit(){this.theme=this.data.theme,this.hosts=this.data.hosts,this.dataSource=new Oe(this.data.hosts)}onConfirm(){this.loading=!0,this.facilitiesManager.removeHosts(this.data.facilityId,this.hosts.map(e=>e.id)).subscribe(()=>{this.notificator.showSuccess(this.translate.instant("DIALOGS.REMOVE_HOST.SUCCESS")),this.dialogRef.close(!0)},()=>this.loading=!1)}onCancel(){this.dialogRef.close(!1)}static{this.\u0275fac=function(i){return new(i||t)(u(W),u(z),u(O),u(H),u(ce))}}static{this.\u0275cmp=E({type:t,selectors:[["app-remove-host-dialog"]],decls:4,vars:5,consts:[["spinner",""],[4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],["mat-dialog-title",""],["mat-dialog-content",""],[1,"fw-bold"],["mat-table","",1,"w-100",3,"dataSource"],["matColumnDef","name"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["class","font-weight-bolder","mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["mat-dialog-actions",""],["mat-stroked-button","",1,"ms-auto",3,"click"],["color","warn","mat-flat-button","",1,"ms-2",3,"click","disabled"],["mat-header-cell",""],["mat-cell",""],["mat-header-row","",1,"font-weight-bolder"],["mat-row",""]],template:function(i,n){if(i&1&&(A(0,Ga,1,0,"ng-template",null,0,V),r(2,"div"),A(3,Wa,24,19,"div",1),a()),i&2){let s=F(1);o(2),Z(fe("",n.theme," position-relative")),o(),m("perunWebAppsLoader",n.loading)("perunWebAppsLoaderIndicator",s)}},dependencies:[x,w,L,ne,ee,ie,te,he,at,Ke,Qe,tt,Ze,Xe,it,Je,et,nt,ot,R,N,M],encapsulation:2})}}return t})();var za=t=>({all:t}),$a=t=>({name:t}),vo=(t,f)=>["/facilities",t,"hosts",f];function qa(t,f){if(t&1){let e=v();r(0,"th",14)(1,"mat-checkbox",15),l(2,"masterCheckboxLabel"),l(3,"translate"),_("change",function(n){g(e);let s=d(2);return C(n?s.masterToggle():null)}),a()()}if(t&2){let e=d(),i=d();o(),ni("aria-label",c(3,5,c(2,3,e.all))),m("checked",i.selection.hasValue()&&e.all)("indeterminate",i.selection.hasValue()&&!e.all)}}function Ka(t,f){if(t&1){let e=v();r(0,"td",16)(1,"mat-checkbox",17),l(2,"checkboxLabel"),l(3,"translate"),_("change",function(n){let s=g(e).$implicit,y=d(2);return C(n?y.toggleRow(s):null)})("click",function(n){return g(e),C(n.stopPropagation())}),a()()}if(t&2){let e=f.$implicit,i=d(2);o(),ni("aria-label",gt(3,4,c(2,2,i.selection.isSelected(e)),He(7,$a,e.hostname))),m("checked",i.selection.isSelected(e))}}function Xa(t,f){t&1&&(ge(0,3),A(1,qa,4,7,"th",12)(2,Ka,4,9,"td",13),Ce())}function Qa(t,f){t&1&&(r(0,"th",18),p(1),l(2,"translate"),a()),t&2&&(o(),h(" ",c(2,1,"SHARED.COMPONENTS.HOSTS_LIST.TABLE_HOST_ID")," "))}function Za(t,f){if(t&1&&(r(0,"td",19),p(1),a()),t&2){let e=f.$implicit;o(),T(e.id)}}function Ja(t,f){t&1&&(r(0,"th",18),p(1),l(2,"translate"),a()),t&2&&(o(),h(" ",c(2,1,"SHARED.COMPONENTS.HOSTS_LIST.TABLE_HOST_NAME")," "))}function er(t,f){if(t&1&&(r(0,"td",20),l(1,"multiWordDataCy"),p(2),a()),t&2){let e=f.$implicit;Ii("data-cy",c(1,2,e.hostname)),o(2),h(" ",e.hostname," ")}}function tr(t,f){t&1&&S(0,"tr",21)}function ir(t,f){if(t&1&&S(0,"tr",22),t&2){let e=f.$implicit,i=d();Y("cursor-pointer",!i.disableRouting),m("perunWebAppsMiddleClickRouterLink",i.disableRouting?null:ai(4,vo,i.facilityId.toString(),e.id.toString()))("routerLink",i.disableRouting?null:ai(7,vo,i.facilityId,e.id))}}function nr(t,f){t&1&&(r(0,"perun-web-apps-alert",11),p(1),l(2,"translate"),a()),t&2&&(o(),h(" ",c(2,1,"SHARED_LIB.UI.ALERTS.NO_FILTER_RESULTS_ALERT")," "))}function or(t,f){t&1&&(r(0,"perun-web-apps-alert",11),p(1),l(2,"translate"),a()),t&2&&(o(),h(" ",c(2,1,"SHARED.COMPONENTS.HOSTS_LIST.NO_HOST_WARNING")," "))}var Jt=(()=>{class t{constructor(e,i,n,s){this.authResolver=e,this.tableCheckbox=i,this.destroyRef=n,this.tableConfigService=s,this.hosts=[],this.selection=new G(!0,[]),this.disableRouting=!1,this.pageSizeOptions=tn,this.displayedColumns=["select","id","name"],this.unfilteredColumns=this.displayedColumns,this.tableId="app-hosts-list"}set displayColumns(e){this.unfilteredColumns=e,localStorage.getItem("showIds")!=="true"&&(e=e.filter(i=>i!=="id")),this.displayedColumns=e}set matSort(e){this.sort=e,this.setDataSource()}static getDataForColumn(e,i){switch(i){case"id":return e.id.toString();case"name":return e.hostname;default:return""}}ngOnInit(){this.selection&&(this.cachedSelection=new G(this.selection.isMultipleSelection(),[],!0,this.selection.compareWith),this.cachedSubject?.pipe(ri(this.destroyRef)).subscribe(e=>{e&&this.cachedSelection.clear()})),this.watchForIdColumnChanges()}ngOnChanges(){this.dataSource=new Oe(this.hosts),this.setDataSource(),this.dataSource.filter=this.filterValue}exportAllData(e){vt(St(this.dataSource.filteredData,this.displayedColumns,t.getDataForColumn),e)}exportDisplayedData(e){let i=this.dataSource.paginator.pageIndex*this.dataSource.paginator.pageSize,n=i+this.dataSource.paginator.pageSize;vt(St(this.dataSource.sortData(this.dataSource.filteredData,this.dataSource.sort).slice(i,n),this.displayedColumns,t.getDataForColumn),e)}setDataSource(){this.dataSource&&(this.dataSource.sort=this.sort,this.dataSource.filterPredicate=(e,i)=>ln(e,i,this.displayedColumns,t.getDataForColumn),this.dataSource.sortData=(e,i)=>sn(e,i,t.getDataForColumn),this.dataSource.paginator=this.child.paginator)}isAllSelected(){return this.tableCheckbox.isAllSelected(this.selection.selected.length,this.dataSource)}masterToggle(){this.tableCheckbox.masterToggle(this.isAllSelected(),this.selection,this.cachedSelection,this.filterValue,this.dataSource,this.sort,this.child.paginator.pageSize,this.child.paginator.pageIndex,!1)}toggleRow(e){this.selection.toggle(e),this.cachedSelection.toggle(e)}pageChanged(){this.cachedSelection&&this.tableCheckbox.selectCachedDataOnPage(this.dataSource,this.selection,this.cachedSelection,this.selection.compareWith)}ngAfterViewInit(){this.dataSource.paginator=this.child.paginator}watchForIdColumnChanges(){this.tableConfigService.showIdsChanged.pipe(ri(this.destroyRef)).subscribe(e=>{e?this.displayedColumns=this.unfilteredColumns:this.displayedColumns=this.unfilteredColumns.filter(i=>i!=="id")}),localStorage.getItem("showIds")!=="true"&&(this.displayedColumns=this.displayedColumns.filter(e=>e!=="id"))}static{this.\u0275fac=function(i){return new(i||t)(u(B),u(cn),u(vi),u(hn))}}static{this.\u0275cmp=E({type:t,selectors:[["app-hosts-list"]],viewQuery:function(i,n){if(i&1&&(Se(si,7),Se(Ft,7)),i&2){let s;ve(s=be())&&(n.child=s.first),ve(s=be())&&(n.matSort=s.first)}},inputs:{hosts:"hosts",selection:"selection",cachedSubject:"cachedSubject",filterValue:"filterValue",facilityId:"facilityId",disableRouting:"disableRouting",loading:"loading",displayColumns:"displayColumns"},features:[Tt],decls:15,vars:15,consts:[[1,"card","mt-3",3,"hidden"],[3,"exportDisplayedData","exportAllData","pageChanged","pageSizeOptions","dataLength","tableId"],["mat-table","","matSort","","matSortActive","id","matSortDirection","asc","matSortDisableClear","",1,"w-100",3,"matSortChange","dataSource"],["matColumnDef","select"],["matColumnDef","id"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["class","static-column-size","mat-cell","",4,"matCellDef"],["matColumnDef","name"],["mat-cell","",4,"matCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["class","dark-hover-list-item","mat-row","",3,"cursor-pointer","perunWebAppsMiddleClickRouterLink","routerLink",4,"matRowDef","matRowDefColumns"],["alert_type","warn"],["class","align-checkbox","mat-header-cell","",4,"matHeaderCellDef"],["class","static-column-size align-checkbox","mat-cell","",4,"matCellDef"],["mat-header-cell","",1,"align-checkbox"],["color","primary",3,"change","aria-label","checked","indeterminate"],["mat-cell","",1,"static-column-size","align-checkbox"],["color","primary",3,"change","click","aria-label","checked"],["mat-header-cell","","mat-sort-header",""],["mat-cell","",1,"static-column-size"],["mat-cell",""],["mat-header-row",""],["mat-row","",1,"dark-hover-list-item",3,"perunWebAppsMiddleClickRouterLink","routerLink"]],template:function(i,n){if(i&1&&(r(0,"div",0)(1,"perun-web-apps-table-wrapper",1),_("exportDisplayedData",function(y){return n.exportDisplayedData(y)})("exportAllData",function(y){return n.exportAllData(y)})("pageChanged",function(){return n.pageChanged()}),r(2,"table",2),_("matSortChange",function(){return n.pageChanged()}),b(3,Xa,3,0,"ng-container",3),l(4,"isAllSelected"),ge(5,4),A(6,Qa,3,3,"th",5)(7,Za,2,1,"td",6),Ce(),ge(8,7),A(9,Ja,3,3,"th",5)(10,er,3,4,"td",8),Ce(),A(11,tr,1,0,"tr",9)(12,ir,1,10,"tr",10),a()()(),b(13,nr,3,3,"perun-web-apps-alert",11),b(14,or,3,3,"perun-web-apps-alert",11)),i&2){let s;m("hidden",n.dataSource.filteredData.length===0||n.hosts.length===0),o(),m("pageSizeOptions",n.pageSizeOptions)("dataLength",n.dataSource.filteredData.length)("tableId",n.tableId),o(),m("dataSource",n.dataSource),o(),I((s=He(13,za,gt(4,10,n.dataSource,n.selection.selected.length)))?3:-1,s),o(8),m("matHeaderRowDef",n.displayedColumns),o(),m("matRowDefColumns",n.displayedColumns),o(),I(n.dataSource.filteredData.length===0&&n.hosts.length!==0?13:-1),o(),I(!n.loading&&n.hosts.length===0?14:-1)}},dependencies:[x,Le,we,Be,Ne,kt,si,Rt,Mt,at,Ke,Qe,tt,Ze,Xe,it,Je,et,nt,ot,Fi,Ft,Ri,R,dn,M,un,mn,pn],styles:[".disable-outline[_ngcontent-%COMP%]{outline:none!important}.cursor-pointer[_ngcontent-%COMP%]{cursor:pointer}"]})}}return t})();function ar(t,f){if(t&1){let e=v();r(0,"button",8),_("click",function(){g(e);let n=d();return C(n.addHost())}),p(1),l(2,"translate"),a()}t&2&&(o(),h(" ",c(2,1,"FACILITY_DETAIL.HOSTS.ADD")," "))}function rr(t,f){if(t&1){let e=v();r(0,"button",9),_("click",function(){g(e);let n=d();return C(n.removeHost())}),p(1),l(2,"translate"),a()}if(t&2){let e=d();m("disabled",e.loading||e.selected.selected.length===0),o(),h(" ",c(2,2,"FACILITY_DETAIL.HOSTS.REMOVE")," ")}}function sr(t,f){t&1&&S(0,"perun-web-apps-loading-table")}function lr(t,f){if(t&1&&S(0,"app-hosts-list",10),t&2){let e=d();m("disableRouting",!e.routeAuth||e.disableRouting)("loading",e.loading)("filterValue",e.filterValue)("hosts",e.hosts)("selection",e.selected)("cachedSubject",e.cachedSubject)("displayColumns",e.displayedColumns)("facilityId",e.facility.id)}}var ei=(()=>{class t{constructor(e,i,n,s){this.dialog=e,this.facilitiesManager=i,this.authResolver=n,this.entityStorageService=s,this.disableRouting=!1,this.hostEmitter=new Et,this.hosts=[],this.selected=new G(!0,[],!0,(y,D)=>y.id===D.id),this.cachedSubject=new ae(!0),this.filterValue="",this.displayedColumns=["id","name"]}ngOnInit(){this.loading=!0,this.facility=this.entityStorageService.getEntity(),this.setAuthRights(),this.refreshTable()}refreshTable(){this.loading=!0,this.facilitiesManager.getHosts(this.facility.id).subscribe(e=>{this.hosts=e,this.hostEmitter.emit(this.hosts),this.selected.clear(),this.cachedSubject.next(!0),this.setAuthRights(),this.loading=!1})}setAuthRights(){this.addAuth=this.authResolver.isAuthorized("addHosts_Facility_List<String>_policy",[this.facility]),this.removeAuth=this.authResolver.isAuthorized("removeHosts_List<Host>_Facility_policy",[this.facility]),this.displayedColumns=this.removeAuth?["select","id","name"]:["id","name"],this.hosts.length!==0&&(this.routeAuth=this.authResolver.isAuthorized("getHostById_int_policy",[this.facility,this.hosts[0]]))}addHost(){let e=k();e.width="600px",e.data={facilityId:this.facility.id,theme:"facility-theme"},this.dialog.open(go,e).afterClosed().subscribe(n=>{n&&this.refreshTable()})}removeHost(){let e=k();e.width="600px",e.data={facilityId:this.facility.id,theme:"facility-theme",hosts:this.selected.selected},this.dialog.open(So,e).afterClosed().subscribe(n=>{n&&this.refreshTable()})}applyFilter(e){this.filterValue=e,this.refreshTable()}static{this.\u0275fac=function(i){return new(i||t)(u(J),u(O),u(B),u(j))}}static{this.\u0275cmp=E({type:t,selectors:[["app-facility-hosts"]],inputs:{disableRouting:"disableRouting"},outputs:{hostEmitter:"hostEmitter"},decls:12,vars:8,consts:[["spinner",""],[1,"page-subtitle"],[3,"refresh"],["color","accent","mat-flat-button","",1,"me-2","action-button"],["color","warn","mat-flat-button","",1,"me-2",3,"disabled"],[3,"filter","placeholder"],[1,"position-relative","table-min-height"],[3,"disableRouting","loading","filterValue","hosts","selection","cachedSubject","displayColumns","facilityId",4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],["color","accent","mat-flat-button","",1,"me-2","action-button",3,"click"],["color","warn","mat-flat-button","",1,"me-2",3,"click","disabled"],[3,"disableRouting","loading","filterValue","hosts","selection","cachedSubject","displayColumns","facilityId"]],template:function(i,n){if(i&1){let s=v();r(0,"div")(1,"h1",1),p(2),l(3,"translate"),a(),r(4,"perun-web-apps-refresh-button",2),_("refresh",function(){return g(s),C(n.refreshTable())}),a(),b(5,ar,3,3,"button",3),b(6,rr,3,4,"button",4),r(7,"perun-web-apps-debounce-filter",5),_("filter",function(D){return g(s),C(n.applyFilter(D))}),a(),A(8,sr,1,0,"ng-template",null,0,V),r(10,"div",6),A(11,lr,1,8,"app-hosts-list",7),a()()}if(i&2){let s=F(9);o(2),T(c(3,6,"FACILITY_DETAIL.HOSTS.TITLE")),o(3),I(n.addAuth?5:-1),o(),I(n.removeAuth?6:-1),o(),m("placeholder","FACILITY_DETAIL.HOSTS.FILTER"),o(4),m("perunWebAppsLoader",n.loading)("perunWebAppsLoaderIndicator",s)}},dependencies:[x,w,L,de,Ae,R,N,Jt,pe,M],encapsulation:2})}}return t})();var bo=(()=>{class t{constructor(e,i){this.facilityManager=e,this.route=i,this.host={beanName:"",id:0}}ngOnInit(){this.route.params.subscribe(e=>{this.hostId=Number(e.hostId),this.facilityManager.getHostById(this.hostId).subscribe(i=>{this.host=i})})}static{this.\u0275fac=function(i){return new(i||t)(u(O),u(rt))}}static{this.\u0275cmp=E({type:t,selectors:[["app-facility-hosts-detail"]],decls:5,vars:6,consts:[[1,"page-subtitle"],[3,"entityId","entity"]],template:function(i,n){i&1&&(r(0,"div")(1,"h1",0),p(2),l(3,"translate"),a(),S(4,"app-one-entity-attribute-page",1),a()),i&2&&(o(2),Ie(" ",c(3,4,"FACILITY_DETAIL.HOSTS.HOSTS_DETAIL.TITLE")," ",n.host.hostname," "),o(2),m("entityId",n.hostId)("entity","host"))},dependencies:[x,zt,R,M],encapsulation:2})}}return t})();function cr(t,f){t&1&&S(0,"perun-web-apps-loading-dialog")}function pr(t,f){t&1&&(r(0,"th",16),p(1),l(2,"translate"),a()),t&2&&(o(),h(" ",c(2,1,"DIALOGS.DELETE_TASK_RESULT.RESULT_ID")," "))}function dr(t,f){if(t&1&&(r(0,"td",17),p(1),a()),t&2){let e=f.$implicit;o(),T(e.id)}}function mr(t,f){t&1&&(r(0,"th",16),p(1),l(2,"translate"),a()),t&2&&(o(),h(" ",c(2,1,"DIALOGS.DELETE_TASK_RESULT.DESTINATION")," "))}function ur(t,f){if(t&1&&(r(0,"td",17),p(1),a()),t&2){let e=f.$implicit;o(),T(e.destination.destination)}}function fr(t,f){t&1&&(r(0,"th",16),p(1),l(2,"translate"),a()),t&2&&(o(),h(" ",c(2,1,"DIALOGS.DELETE_TASK_RESULT.TIME")," "))}function hr(t,f){if(t&1&&(r(0,"td",17),p(1),l(2,"date"),a()),t&2){let e=f.$implicit;o(),h(" ",gt(2,1,e.timestamp,"d.M.y H:mm:ss")," ")}}function _r(t,f){t&1&&S(0,"tr",18)}function gr(t,f){t&1&&S(0,"tr",19)}function Cr(t,f){if(t&1){let e=v();r(0,"div")(1,"h1",2),p(2),l(3,"translate"),a(),r(4,"div",3)(5,"p"),p(6),l(7,"translate"),a(),r(8,"div",4),p(9),l(10,"translate"),a(),r(11,"table",5),ge(12,6),A(13,pr,3,3,"th",7)(14,dr,2,1,"td",8),Ce(),ge(15,9),A(16,mr,3,3,"th",7)(17,ur,2,1,"td",8),Ce(),ge(18,10),A(19,fr,3,3,"th",7)(20,hr,3,4,"td",8),Ce(),A(21,_r,1,0,"tr",11)(22,gr,1,0,"tr",12),a()(),r(23,"div",13)(24,"button",14),_("click",function(){g(e);let n=d();return C(n.onCancel())}),p(25),l(26,"translate"),a(),r(27,"button",15),_("click",function(){g(e);let n=d();return C(n.onDelete())}),p(28),l(29,"translate"),a()()()}if(t&2){let e=d();o(2),T(c(3,9,"DIALOGS.DELETE_TASK_RESULT.TITLE")),o(4),T(c(7,11,"DIALOGS.DELETE_TASK_RESULT.DESCRIPTION")),o(3),h(" ",c(10,13,"DIALOGS.DELETE_TASK_RESULT.ASK")," "),o(2),m("dataSource",e.dataSource),o(10),m("matHeaderRowDef",e.displayedColumns),o(),m("matRowDefColumns",e.displayedColumns),o(3),h(" ",c(26,15,"DIALOGS.DELETE_TASK_RESULT.CANCEL")," "),o(2),m("disabled",e.loading),o(),h(" ",c(29,17,"DIALOGS.DELETE_TASK_RESULT.REMOVE")," ")}}var ti=(()=>{class t{constructor(e,i,n,s,y){this.dialogRef=e,this.data=i,this.taskManager=n,this.notificator=s,this.translate=y,this.loading=!1,this.dataSource=new Oe(this.data.taskResults),this.displayedColumns=["id","destination","time"]}ngOnInit(){this.theme=this.data.theme,this.taskResults=this.data.taskResults}onDelete(){this.loading=!0;let e=this.taskResults.map(i=>i.id);this.taskManager.deleteTaskResultsByIds(e).subscribe({next:()=>{this.dialogRef.close(!0),this.loading=!1,this.notificator.showSuccess(this.translate.instant("DIALOGS.DELETE_TASK_RESULT.SUCCESS"))},error:()=>this.loading=!1})}onCancel(){this.dialogRef.close(!1)}static{this.\u0275fac=function(i){return new(i||t)(u(W),u(z),u(Te),u(H),u(ht))}}static{this.\u0275cmp=E({type:t,selectors:[["app-delete-task-result-dialog"]],decls:4,vars:5,consts:[["spinner",""],[4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],["mat-dialog-title",""],["mat-dialog-content",""],[1,"fw-bold"],["mat-table","",1,"w-100",3,"dataSource"],["matColumnDef","id"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","destination"],["matColumnDef","time"],["class","font-weight-bolder","mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["mat-dialog-actions",""],["mat-stroked-button","",1,"ms-auto",3,"click"],["color","warn","mat-flat-button","",1,"ms-2",3,"click","disabled"],["mat-header-cell",""],["mat-cell",""],["mat-header-row","",1,"font-weight-bolder"],["mat-row",""]],template:function(i,n){if(i&1&&(A(0,cr,1,0,"ng-template",null,0,V),r(2,"div"),A(3,Cr,30,19,"div",1),a()),i&2){let s=F(1);o(2),Z(fe("",n.theme," position-relative")),o(),m("perunWebAppsLoader",n.loading)("perunWebAppsLoaderIndicator",s)}},dependencies:[x,w,L,ne,ee,ie,te,he,at,Ke,Qe,tt,Ze,Xe,it,Je,et,nt,ot,R,N,xi,M],encapsulation:2})}}return t})();function Sr(t,f){t&1&&S(0,"perun-web-apps-loading-dialog")}function vr(t,f){if(t&1){let e=v();r(0,"mat-checkbox",12),l(1,"translate"),_("change",function(n){g(e);let s=d(2);return C(s.change(n))}),p(2),l(3,"translate"),a()}if(t&2){let e=d(2);m("matTooltip",ye(c(1,6,"DIALOGS.REMOVE_SERVICE_FROM_FACILITY.CHECKBOXES_DISABLED")))("checked",e.taskChecked)("disabled",e.checkboxesDisabled)("matTooltipDisabled",!e.checkboxesDisabled),o(2),h(" ",c(3,8,"DIALOGS.REMOVE_SERVICE_FROM_FACILITY.CHECKBOX_TASK_AND_TASK_RESULTS")," ")}}function br(t,f){if(t&1){let e=v();r(0,"mat-checkbox",13),l(1,"translate"),_("change",function(n){g(e);let s=d(2);return C(s.change(n))}),p(2),l(3,"translate"),a()}if(t&2){let e=d(2);m("matTooltip",ye(c(1,6,"DIALOGS.REMOVE_SERVICE_FROM_FACILITY.CHECKBOXES_DISABLED")))("checked",e.taskResultsChecked)("disabled",e.checkboxesDisabled)("matTooltipDisabled",!e.checkboxesDisabled),o(2),h(" ",c(3,8,"DIALOGS.REMOVE_SERVICE_FROM_FACILITY.CHECKBOX_TASK_RESULTS")," ")}}function Ir(t,f){if(t&1){let e=v();r(0,"div")(1,"h1",2),p(2),l(3,"translate"),a(),r(4,"div",3)(5,"p"),p(6),l(7,"translate"),a(),r(8,"div"),b(9,vr,4,10,"mat-checkbox",4),b(10,br,4,10,"mat-checkbox",5),r(11,"mat-checkbox",6),l(12,"translate"),_("change",function(n){g(e);let s=d();return C(s.change(n))}),p(13),l(14,"translate"),a()(),r(15,"p"),p(16),l(17,"translate"),a(),r(18,"div",7),p(19),l(20,"translate"),a(),r(21,"perun-web-apps-resources-list",8),_("allSelected",function(n){g(e);let s=d();return C(s.disableCheckboxes(n))}),a()(),r(22,"div",9)(23,"button",10),_("click",function(){g(e);let n=d();return C(n.cancel())}),p(24),l(25,"translate"),a(),r(26,"button",11),_("click",function(){g(e);let n=d();return C(n.remove())}),p(27),l(28,"translate"),a()()()}if(t&2){let e=d();o(2),T(c(3,21,"DIALOGS.REMOVE_SERVICE_FROM_FACILITY.TITLE")),o(4),T(c(7,23,"DIALOGS.REMOVE_SERVICE_FROM_FACILITY.CHECKBOXES_DESCRIPTION")),o(3),I(e.taskId!==null?9:-1),o(),I(e.taskId!==null?10:-1),o(),m("matTooltip",ye(c(12,25,"DIALOGS.REMOVE_SERVICE_FROM_FACILITY.CHECKBOXES_DISABLED")))("disabled",e.checkboxesDisabled)("matTooltipDisabled",!e.checkboxesDisabled)("checked",e.destinationChecked),o(2),h(" ",c(14,27,"DIALOGS.REMOVE_SERVICE_FROM_FACILITY.CHECKBOX_DESTINATION")," "),o(3),T(c(17,29,"DIALOGS.REMOVE_SERVICE_FROM_FACILITY.DESCRIPTION")),o(3),h(" ",c(20,31,"DIALOGS.REMOVE_SERVICE_FROM_FACILITY.ASK")," "),o(2),m("loading",e.loading)("displayColumns",e.displayedColumns)("disableRouting",!0)("resources",e.resources)("selection",e.selected)("cachedSubject",e.cachedSubject),o(3),h(" ",c(25,33,"DIALOGS.REMOVE_SERVICE_FROM_FACILITY.CANCEL")," "),o(2),m("disabled",e.loading||e.selected.selected.length===0),o(),h(" ",c(28,35,"DIALOGS.REMOVE_SERVICE_FROM_FACILITY.REMOVE")," ")}}var Io=(()=>{class t{constructor(e,i,n,s,y,D,K,U){this.dialogRef=e,this.data=i,this.resourcesManager=n,this.tasksManager=s,this.serviceManager=y,this.translate=D,this.notificator=K,this.cd=U,this.loading=!1,this.resources=[],this.displayedColumns=["select","id","vo","name"],this.checkboxesDisabled=!1,this.taskChecked=!0,this.taskResultsChecked=!0,this.destinationChecked=!0,this.dataSource=new Oe(this.data.resource),this.selected=new G(!0,[...this.dataSource.data],!0,(X,oe)=>X.id===oe.id),this.cachedSubject=new ae(!0)}ngOnInit(){this.theme=this.data.theme,this.taskId=this.data.taskId,this.serviceId=this.data.serviceId,this.facilityId=this.data.facilityId,this.resources=this.data.resource}remove(){this.loading=!0,this.taskResultsChecked&&!this.taskChecked&&this.taskId!==null&&this.tasksManager.getTaskResultsForGUIByTask(this.taskId).subscribe(e=>{this.tasksManager.deleteTaskResultsByIds(e.map(i=>i.id)).subscribe()}),this.taskChecked&&this.taskId!==null&&this.tasksManager.deleteTask({task:this.taskId}).subscribe(),this.destinationChecked&&this.serviceManager.getRichDestinations(this.serviceId,this.facilityId).subscribe(e=>{this.serviceManager.removeDestinationsByRichDestinations({richDestinations:e}).subscribe()}),this.resourcesManager.removeServiceForResources(this.selected.selected.map(e=>e.id),this.serviceId).subscribe({next:()=>{this.notificator.showSuccess(this.translate.instant("DIALOGS.REMOVE_SERVICE_FROM_FACILITY.SUCCESS")),this.dialogRef.close(!0)},error:()=>this.loading=!1})}cancel(){this.dialogRef.close(!1)}disableCheckboxes(e){e&&this.checkboxesDisabled&&this.changeCheckboxes(!0),!e&&!this.checkboxesDisabled&&this.changeCheckboxes(!1)}changeCheckboxes(e){this.checkboxesDisabled=!e,this.taskChecked=e,this.taskResultsChecked=e,this.destinationChecked=e,this.cd.detectChanges()}change(e){switch(e.source.id){case"task":{this.taskChecked=e.checked;break}case"taskResults":{this.taskResultsChecked=e.checked;break}case"destination":{this.destinationChecked=e.checked;break}default:break}}static{this.\u0275fac=function(i){return new(i||t)(u(W),u(z),u(_t),u(Te),u(ue),u(ht),u(H),u(Ue))}}static{this.\u0275cmp=E({type:t,selectors:[["app-delete-service-from-facility"]],decls:4,vars:5,consts:[["spinner",""],[4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],["mat-dialog-title",""],["mat-dialog-content",""],["color","warn","id","task",1,"right-space",3,"checked","disabled","matTooltipDisabled","matTooltip"],["color","warn","id","taskResults",1,"right-space",3,"checked","disabled","matTooltipDisabled","matTooltip"],["color","warn","id","destination",3,"change","disabled","matTooltipDisabled","checked","matTooltip"],[1,"fw-bold"],[3,"allSelected","loading","displayColumns","disableRouting","resources","selection","cachedSubject"],["mat-dialog-actions",""],["mat-stroked-button","",1,"ms-auto",3,"click"],["color","warn","mat-flat-button","",1,"ms-2",3,"click","disabled"],["color","warn","id","task",1,"right-space",3,"change","checked","disabled","matTooltipDisabled","matTooltip"],["color","warn","id","taskResults",1,"right-space",3,"change","checked","disabled","matTooltipDisabled","matTooltip"]],template:function(i,n){if(i&1&&(A(0,Sr,1,0,"ng-template",null,0,V),r(2,"div"),A(3,Ir,29,37,"div",1),a()),i&2){let s=F(1);o(2),Z(fe("",n.theme," position-relative")),o(),m("perunWebAppsLoader",n.loading)("perunWebAppsLoaderIndicator",s)}},dependencies:[x,w,L,Le,we,ne,ee,ie,te,he,R,Ye,N,vn,M],styles:[".right-space[_ngcontent-%COMP%]{margin-right:40px}"]})}}return t})();function yr(t,f){t&1&&S(0,"perun-web-apps-loading-dialog")}function Tr(t,f){if(t&1){let e=v();r(0,"div")(1,"h1",2),p(2),l(3,"translate"),a(),r(4,"div",3)(5,"div",4),p(6),l(7,"translate"),a()(),r(8,"div",5)(9,"button",6),_("click",function(){g(e);let n=d();return C(n.cancel())}),p(10),l(11,"translate"),a(),r(12,"button",7),_("click",function(){g(e);let n=d();return C(n.remove())}),p(13),l(14,"translate"),a()()()}if(t&2){let e=d();o(2),T(c(3,5,"DIALOGS.DELETE_TASK.TITLE")),o(4),h(" ",c(7,7,"DIALOGS.DELETE_TASK.DESCRIPTION")," "),o(4),h(" ",c(11,9,"DIALOGS.DELETE_TASK.CANCEL")," "),o(2),m("disabled",e.loading),o(),h(" ",c(14,11,"DIALOGS.DELETE_TASK.DELETE")," ")}}var yo=(()=>{class t{constructor(e,i,n,s,y){this.dialogRef=e,this.data=i,this.tasksManager=n,this.translate=s,this.notificator=y,this.loading=!1}ngOnInit(){this.theme=this.data.theme,this.taskId=this.data.taskId}remove(){this.loading=!0,this.tasksManager.deleteTask({task:this.taskId}).subscribe(()=>{this.translate.get("DIALOGS.DELETE_TASK.SUCCESS").subscribe(e=>{this.notificator.showSuccess(e),this.dialogRef.close(!0)})},()=>this.loading=!1)}cancel(){this.dialogRef.close(!1)}static{this.\u0275fac=function(i){return new(i||t)(u(W),u(z),u(Te),u(ce),u(H))}}static{this.\u0275cmp=E({type:t,selectors:[["app-delete-task-dialog"]],decls:4,vars:5,consts:[["spinner",""],[4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],["mat-dialog-title",""],["mat-dialog-content",""],[1,"fw-bold"],["mat-dialog-actions",""],["mat-stroked-button","",1,"ms-auto",3,"click"],["color","warn","mat-flat-button","",1,"ms-2",3,"click","disabled"]],template:function(i,n){if(i&1&&(A(0,yr,1,0,"ng-template",null,0,V),r(2,"div"),A(3,Tr,15,13,"div",1),a()),i&2){let s=F(1);o(2),Z(fe("",n.theme," position-relative")),o(),m("perunWebAppsLoader",n.loading)("perunWebAppsLoaderIndicator",s)}},dependencies:[x,w,L,ne,ee,ie,te,he,R,N,M],encapsulation:2})}}return t})();function Ar(t,f){if(t&1){let e=v();r(0,"button",12),_("click",function(){g(e);let n=d();return C(n.forcePropagation())}),p(1),l(2,"translate"),a()}if(t&2){let e=d();m("disabled",e.selected.selected.length===0||e.disableForcePropagationButton||e.loading),o(),h(" ",c(2,2,"FACILITY_DETAIL.SERVICES_STATUS.FORCE_PROPAGATION")," ")}}function Er(t,f){if(t&1){let e=v();r(0,"button",12),_("click",function(){g(e);let n=d();return C(n.allow())}),p(1),l(2,"translate"),a()}if(t&2){let e=d();m("disabled",e.selected.selected.length===0||e.disableAllowButton||e.loading),o(),h(" ",c(2,2,"FACILITY_DETAIL.SERVICES_STATUS.ALLOW")," ")}}function xr(t,f){if(t&1){let e=v();r(0,"button",13),_("click",function(){g(e);let n=d();return C(n.block())}),p(1),l(2,"translate"),a()}if(t&2){let e=d();m("disabled",e.selected.selected.length===0||e.disableBlockButton||e.loading),o(),h(" ",c(2,2,"FACILITY_DETAIL.SERVICES_STATUS.BLOCK")," ")}}function Dr(t,f){if(t&1&&(r(0,"button",6),l(1,"translate"),p(2),l(3,"translate"),a()),t&2){let e=d(),i=F(10);m("matTooltip",ye(c(1,6,"DIALOGS.REMOVE_SERVICE_FROM_FACILITY.CHECKBOXES_DISABLED")))("disabled",e.selected.selected.length===0||e.disableRemoveButton||e.loading)("matMenuTriggerFor",i)("matTooltipDisabled",!e.disableRemoveButton),o(2),h(" ",c(3,8,"FACILITY_DETAIL.SERVICES_STATUS.REMOVE")," ")}}function Mr(t,f){if(t&1){let e=v();r(0,"button",8),_("click",function(){g(e);let n=d();return C(n.removeTaskResults())}),p(1),l(2,"translate"),a()}t&2&&(o(),h(" ",c(2,1,"FACILITY_DETAIL.SERVICES_STATUS.REMOVE_TASK_RESULTS")," "))}function Rr(t,f){t&1&&S(0,"perun-web-apps-loading-table")}function Fr(t,f){if(t&1){let e=v();r(0,"perun-web-apps-services-status-list",14),_("selectionChange",function(){g(e);let n=d();return C(n.selectionChanged())}),a()}if(t&2){let e=d();m("disableRouting",!e.routeAuth)("loading",e.loading)("filterValue",e.filterValue)("servicesStatus",e.servicesStates)("selection",e.selected)("cachedSubject",e.cachedSubject)}}var To=(()=>{class t{constructor(e,i,n,s,y,D,K,U,X){this.tasksManager=e,this.servicesManager=i,this.notificator=n,this.translate=s,this.authResolver=y,this.facilityManager=D,this.resourcesManager=K,this.dialog=U,this.entityStorageService=X,this.servicesStates=[],this.selected=new G(!0,[],!0,(oe,_e)=>oe.service.id===_e.service.id),this.cachedSubject=new ae(!0),this.filterValue="",this.disableAllowButton=!0,this.disableBlockButton=!0,this.disableRemoveButton=!0,this.disableForcePropagationButton=!1}ngOnInit(){this.loading=!0,this.facility=this.entityStorageService.getEntity(),this.setAuthRights(),this.refreshTable()}forcePropagation(){let e=this.selected.selected.map(i=>i.service.id);this.servicesManager.forceServicePropagationBulk(e,this.facility.id).subscribe({next:()=>{this.notificator.showInstantSuccess("FACILITY_DETAIL.SERVICES_STATUS.SUCCESS_FORCE_PROPAGATION"),this.loading=!1,this.refreshTable()},error:()=>{this.loading=!1}})}allow(){let e=this.selected.selected.map(i=>i.service.id);this.servicesManager.unblockServicesOnFacility(e,this.facility.id).subscribe({next:()=>{this.notificator.showInstantSuccess("FACILITY_DETAIL.SERVICES_STATUS.SUCCESS_ALLOW"),this.refreshTable()},error:()=>{this.loading=!1}})}block(){let e=this.selected.selected.map(i=>i.service.id);this.servicesManager.blockServicesOnFacility(e,this.facility.id).subscribe({next:()=>{this.notificator.showInstantSuccess("FACILITY_DETAIL.SERVICES_STATUS.SUCCESS_BLOCK"),this.refreshTable()},error:()=>{this.loading=!1}})}removeTaskResults(){this.loading=!0,this.tasksManager.getTaskResultsForGUIByTask(this.selected.selected[0].task.id).subscribe(e=>{let i=k();i.width="600px",i.data={theme:"facility-theme",taskResults:e},this.loading=!1,this.dialog.open(ti,i)})}removeServiceFromFacility(){this.loading=!0,this.facilityManager.getAssignedResourcesByAssignedServiceForFacility(this.selected.selected[0].facility.id,this.selected.selected[0].service.id).subscribe({next:e=>{let i=k();i.width="600px",this.taskId=this.taskIsNull?null:this.selected.selected[0].task.id,e.length===0?(i.data={theme:"facility-theme",taskId:this.taskId},this.loading=!1,this.dialog.open(yo,i).afterClosed().subscribe(s=>{s&&(this.disableRemoveButton=!0,this.refreshTable())})):this.resourcesManager.getRichResourcesByIds(e.map(n=>n.id)).subscribe(n=>{i.data={theme:"facility-theme",taskId:this.taskId,serviceId:this.selected.selected[0].service.id,facilityId:this.selected.selected[0].facility.id,resource:n},this.loading=!1,this.dialog.open(Io,i).afterClosed().subscribe(y=>{y&&(this.disableRemoveButton=!0,this.refreshTable())})})},error:()=>this.loading=!1})}refreshTable(){this.loading=!0,this.tasksManager.getFacilityServicesState(this.facility.id).subscribe(e=>{this.servicesStates=e,this.selected.clear(),this.cachedSubject.next(!0),this.setAuthRights(),this.loading=!1})}setAuthRights(){this.propagationAuth=this.authResolver.isAuthorized("forceServicePropagation_Facility_Service_policy",[this.facility]),this.blockAuth=this.authResolver.isAuthorized("blockServiceOnFacility_Service_Facility_policy",[this.facility]),this.allowAuth=this.authResolver.isAuthorized("unblockServiceOnFacility_Service_Facility_policy",[this.facility]),this.deleteAuth=this.authResolver.isAuthorized("deleteTask_Task_policy",[this.facility]),this.routeAuth=this.authResolver.isAuthorized("getTaskResultsByTask_int_policy",[this.facility])}applyFilter(e){this.filterValue=e,this.refreshTable()}selectionChanged(){this.disableBlockButton=!1,this.disableAllowButton=!1,this.disableRemoveButton=this.selected.selected.length!==1,this.disableForcePropagationButton=!1,this.disableRemoveButton||(this.taskIsNull=this.selected.selected[0].task===null);for(let e of this.selected.selected)e.blockedOnFacility?(this.disableBlockButton=!0,this.disableForcePropagationButton=!0):this.disableAllowButton=!0}static{this.\u0275fac=function(i){return new(i||t)(u(Te),u(ue),u(H),u(ce),u(B),u(O),u(_t),u(J),u(j))}}static{this.\u0275cmp=E({type:t,selectors:[["app-facility-service-status"]],decls:20,vars:14,consts:[["menu","matMenu"],["spinner",""],[1,"page-subtitle"],[3,"refresh"],["color","accent","mat-flat-button","",1,"me-2",3,"disabled"],["color","warn","mat-flat-button","",1,"me-2",3,"disabled"],["mat-flat-button","","color","warn",1,"me-2","dropdown-toggle",3,"disabled","matMenuTriggerFor","matTooltipDisabled","matTooltip"],["mat-menu-item",""],["mat-menu-item","",3,"click"],[3,"filter","placeholder"],[1,"position-relative","table-min-height"],[3,"disableRouting","loading","filterValue","servicesStatus","selection","cachedSubject","selectionChange",4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],["color","accent","mat-flat-button","",1,"me-2",3,"click","disabled"],["color","warn","mat-flat-button","",1,"me-2",3,"click","disabled"],[3,"selectionChange","disableRouting","loading","filterValue","servicesStatus","selection","cachedSubject"]],template:function(i,n){if(i&1){let s=v();r(0,"div")(1,"h1",2),p(2),l(3,"translate"),a(),r(4,"perun-web-apps-refresh-button",3),_("refresh",function(){return g(s),C(n.refreshTable())}),a(),b(5,Ar,3,4,"button",4),b(6,Er,3,4,"button",4),b(7,xr,3,4,"button",5),b(8,Dr,4,10,"button",6),r(9,"mat-menu",null,0),b(11,Mr,3,3,"button",7),r(12,"button",8),_("click",function(){return g(s),C(n.removeServiceFromFacility())}),p(13),l(14,"translate"),a()(),r(15,"perun-web-apps-debounce-filter",9),_("filter",function(D){return g(s),C(n.applyFilter(D))}),a(),A(16,Rr,1,0,"ng-template",null,1,V),r(18,"div",10),A(19,Fr,1,6,"perun-web-apps-services-status-list",11),a()()}if(i&2){let s=F(17);o(2),T(c(3,10,"FACILITY_DETAIL.SERVICES_STATUS.TITLE")),o(3),I(n.propagationAuth?5:-1),o(),I(n.allowAuth?6:-1),o(),I(n.blockAuth?7:-1),o(),I(n.deleteAuth?8:-1),o(3),I(n.taskIsNull?-1:11),o(2),h(" ",c(14,12,"FACILITY_DETAIL.SERVICES_STATUS.REMOVE_SERVICE_FROM_FACILITY")," "),o(2),m("placeholder","SHARED_LIB.PERUN.COMPONENTS.SERVICES_STATUS_LIST.TABLE_SEARCH"),o(4),m("perunWebAppsLoader",n.loading)("perunWebAppsLoaderIndicator",s)}},dependencies:[x,w,L,de,Ae,Ni,ki,Oi,Vi,R,Ye,bn,N,pe,M],encapsulation:2})}}return t})();function wr(t,f){if(t&1){let e=v();r(0,"button",8),_("click",function(){g(e);let n=d();return C(n.removeTaskResult())}),p(1),l(2,"translate"),a()}if(t&2){let e=d();m("disabled",e.loading||e.selection.selected.length===0),o(),h(" ",c(2,2,"FACILITY_DETAIL.TASK_RESULTS.REMOVE")," ")}}function Lr(t,f){t&1&&S(0,"perun-web-apps-loading-table")}function Or(t,f){if(t&1&&S(0,"perun-web-apps-task-results-list",9),t&2){let e=d();m("loading",e.loading)("displayColumns",e.displayedColumns)("filterValue",e.filterValue)("selection",e.selection)("cachedSubject",e.cachedSubject)("taskResults",e.taskResults)}}var Ao=(()=>{class t{constructor(e,i,n,s,y){this.route=e,this.taskManager=i,this.authResolver=n,this.dialog=s,this.entityStorageService=y,this.loading=!1,this.filterValue="",this.selection=new G(!0,[],!0,(D,K)=>D.id===K.id),this.task={id:0},this.taskResults=[],this.cachedSubject=new ae(!0),this.displayedColumns=["select","id","destination","type","service","status","time","returnCode","standardMessage","errorMessage"],this.removeAuth=!1}ngOnInit(){this.loading=!0,this.facility=this.entityStorageService.getEntity(),this.removeAuth=this.authResolver.isAuthorized("deleteTask_Task_policy",[this.facility]),this.removeAuth||(this.displayedColumns=["id","destination","type","service","status","time","returnCode","standardMessage","errorMessage"]),this.route.params.subscribe(e=>{this.taskId=Number(e.taskId),this.taskManager.getTaskById(this.taskId).subscribe(i=>{this.task=i,this.refreshTable()})})}refreshTable(){this.loading=!0,this.taskManager.getTaskResultsForGUIByTask(this.taskId).subscribe(e=>{this.selection.clear(),this.cachedSubject.next(!0),this.taskResults=e,this.loading=!1})}removeTaskResult(){let e=k();e.width="600px",e.data={theme:"facility-theme",taskResults:this.selection.selected},this.dialog.open(ti,e).afterClosed().subscribe(n=>{n&&this.refreshTable()})}applyFilter(e){this.filterValue=e,this.refreshTable()}static{this.\u0275fac=function(i){return new(i||t)(u(rt),u(Te),u(B),u(J),u(j))}}static{this.\u0275cmp=E({type:t,selectors:[["app-facility-task-results"]],decls:12,vars:9,consts:[["spinner",""],[1,"page-subtitle"],[1,"text-muted"],[3,"refresh"],["color","warn","mat-flat-button","",1,"me-2",3,"disabled"],[3,"filter","placeholder"],[1,"position-relative","table-min-height"],[3,"loading","displayColumns","filterValue","selection","cachedSubject","taskResults",4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],["color","warn","mat-flat-button","",1,"me-2",3,"click","disabled"],[3,"loading","displayColumns","filterValue","selection","cachedSubject","taskResults"]],template:function(i,n){if(i&1){let s=v();r(0,"h1",1),p(1),l(2,"translate"),r(3,"span",2),p(4),a()(),r(5,"perun-web-apps-refresh-button",3),_("refresh",function(){return g(s),C(n.refreshTable())}),a(),b(6,wr,3,4,"button",4),r(7,"perun-web-apps-debounce-filter",5),_("filter",function(D){return g(s),C(n.applyFilter(D))}),a(),A(8,Lr,1,0,"ng-template",null,0,V),r(10,"div",6),A(11,Or,1,6,"perun-web-apps-task-results-list",7),a()}if(i&2){let s=F(9);o(),Ie(" ",c(2,7,"FACILITY_DETAIL.TASK_RESULTS.TITLE")," - ",n.task.service?n.task.service.name:""," "),o(3),h(" \xA0#",n.task.id," "),o(2),I(n.removeAuth?6:-1),o(),m("placeholder","FACILITY_DETAIL.TASK_RESULTS.FILTER"),o(4),m("perunWebAppsLoader",n.loading)("perunWebAppsLoaderIndicator",s)}},dependencies:[x,w,L,de,Ae,R,In,N,pe,M],encapsulation:2})}}return t})();var Eo=(()=>{class t{constructor(e,i){this.dialogRef=e,this.data=i,this.theme=""}ngOnInit(){this.theme=this.data.theme}onCancel(){this.dialogRef.close(!1)}onSkip(){this.dialogRef.close(!0)}static{this.\u0275fac=function(i){return new(i||t)(u(W),u(z))}}static{this.\u0275cmp=E({type:t,selectors:[["app-no-service-dialog"]],decls:14,vars:14,consts:[["mat-dialog-title",""],["mat-dialog-content",""],["matDialogActions",""],["mat-stroked-button","",1,"ms-auto","me-2",3,"click"],["color","accent","mat-flat-button","",3,"click"]],template:function(i,n){i&1&&(r(0,"div")(1,"h1",0),p(2),l(3,"translate"),a(),r(4,"div",1),p(5),l(6,"translate"),a(),r(7,"div",2)(8,"button",3),_("click",function(){return n.onCancel()}),p(9),l(10,"translate"),a(),r(11,"button",4),_("click",function(){return n.onSkip()}),p(12),l(13,"translate"),a()()()),i&2&&(Z(n.theme),o(2),T(c(3,6,"DIALOGS.NO_SERVICE.TITLE")),o(3),h(" ",c(6,8,"DIALOGS.NO_SERVICE.INFO")," "),o(4),h(" ",c(10,10,"DIALOGS.NO_SERVICE.CANCEL")," "),o(3),h(" ",c(13,12,"DIALOGS.NO_SERVICE.SKIP")," "))},dependencies:[x,w,L,ne,ee,ie,te,R,M],encapsulation:2})}}return t})();var xo=(()=>{class t{constructor(e,i){this.dialogRef=e,this.data=i,this.theme=""}ngOnInit(){this.theme=this.data.theme}onCancel(){this.dialogRef.close(!1)}onSkip(){this.dialogRef.close(!0)}static{this.\u0275fac=function(i){return new(i||t)(u(W),u(z))}}static{this.\u0275cmp=E({type:t,selectors:[["app-config-unsaved-dialog"]],decls:14,vars:14,consts:[["mat-dialog-title",""],["mat-dialog-content",""],["matDialogActions",""],["mat-stroked-button","",1,"ms-auto","me-2",3,"click"],["color","accent","mat-flat-button","",3,"click"]],template:function(i,n){i&1&&(r(0,"div")(1,"h1",0),p(2),l(3,"translate"),a(),r(4,"div",1),p(5),l(6,"translate"),a(),r(7,"div",2)(8,"button",3),_("click",function(){return n.onCancel()}),p(9),l(10,"translate"),a(),r(11,"button",4),_("click",function(){return n.onSkip()}),p(12),l(13,"translate"),a()()()),i&2&&(Z(n.theme),o(2),T(c(3,6,"DIALOGS.CONFIG_UNSAVED.TITLE")),o(3),h(" ",c(6,8,"DIALOGS.CONFIG_UNSAVED.INFO")," "),o(4),h(" ",c(10,10,"DIALOGS.CONFIG_UNSAVED.CANCEL")," "),o(3),h(" ",c(13,12,"DIALOGS.CONFIG_UNSAVED.SKIP")," "))},dependencies:[x,w,L,ne,ee,ie,te,R,M],encapsulation:2})}}return t})();function kr(t,f){if(t&1&&(r(0,"div",1),S(1,"i",3),l(2,"translate"),a()),t&2){let e=d();o(),m("innerHTML",c(2,1,e.info),At)}}function Vr(t,f){if(t&1){let e=v();r(0,"button",8),_("click",function(){g(e);let n=d(2);return C(n.onKeep())}),p(1),l(2,"translate"),a()}t&2&&(o(),h(" ",c(2,1,"DIALOGS.CANCEL_CONFIG.KEEP")," "))}function Nr(t,f){if(t&1){let e=v();r(0,"div",2)(1,"button",4),_("click",function(){g(e);let n=d();return C(n.onCancel())}),p(2),l(3,"translate"),a(),r(4,"button",5),_("click",function(){g(e);let n=d();return C(n.onDelete())}),r(5,"mat-icon",6),p(6," warning "),a(),p(7),l(8,"translate"),a(),b(9,Vr,3,3,"button",7),a()}if(t&2){let e=d();o(2),h(" ",c(3,3,"DIALOGS.CANCEL_CONFIG.CANCEL")," "),o(5),h(" ",c(8,5,"DIALOGS.CANCEL_CONFIG.DELETE")," "),o(2),I(e.lastStep?-1:9)}}var Do=(()=>{class t{constructor(e,i,n,s,y){this.dialogRef=e,this.data=i,this.facilityService=n,this.notificator=s,this.translate=y,this.theme="",this.title="",this.info="",this.loading=!1}ngOnInit(){this.theme=this.data.theme,this.lastStep=this.data.lastStep,this.lastStep?(this.title="DIALOGS.CANCEL_CONFIG.TITLE_COMPLETE",this.info="DIALOGS.CANCEL_CONFIG.INFO_COMPLETE"):(this.title="DIALOGS.CANCEL_CONFIG.TITLE_INCOMPLETE",this.info="DIALOGS.CANCEL_CONFIG.INFO_INCOMPLETE")}onCancel(){this.dialogRef.close(!1)}onDelete(){this.loading=!0,this.facilityService.deleteFacility(this.data.facilityId,!0).subscribe(()=>{this.notificator.showSuccess(this.translate.instant("DIALOGS.CANCEL_CONFIG.SUCCESS")),this.dialogRef.close(!0),this.loading=!1},()=>this.loading=!1)}onKeep(){this.dialogRef.close(!0)}static{this.\u0275fac=function(i){return new(i||t)(u(W),u(z),u(O),u(H),u(ce))}}static{this.\u0275cmp=E({type:t,selectors:[["app-cancel-configuration-dialog"]],decls:6,vars:7,consts:[["mat-dialog-title",""],["mat-dialog-content",""],["matDialogActions",""],[3,"innerHTML"],["mat-stroked-button","",1,"me-2",3,"click"],["color","warn","mat-flat-button","",1,"ms-auto","me-2",3,"click"],["iconPositionEnd",""],["color","accent","mat-flat-button",""],["color","accent","mat-flat-button","",3,"click"]],template:function(i,n){i&1&&(r(0,"div")(1,"h1",0),p(2),l(3,"translate"),a(),b(4,kr,3,3,"div",1),b(5,Nr,10,7,"div",2),a()),i&2&&(Z(n.theme),o(2),T(c(3,5,n.title)),o(2),I(n.loading?-1:4),o(),I(n.loading?-1:5))},dependencies:[x,w,L,Ve,ke,ne,ee,ie,te,R,M],encapsulation:2})}}return t})();var Br=["stepper"],Pr=()=>["select","id","name","enabled","description"],Gr=()=>["select","destinationId","service","warn","destination","type","propagationType"],jr=()=>["id","name","enabled","script","description"],Hr=()=>["id","displayName","value","description"],Ur=()=>["id","vo","name","description"],Yr=()=>["id","name","email","logins","organization"],Wr=()=>["id","name"],zr=()=>["destinationId","service","warn","destination","type","propagationType"];function $r(t,f){t&1&&S(0,"perun-web-apps-loading-table")}function qr(t,f){t&1&&(p(0),l(1,"translate")),t&2&&T(c(1,1,"FACILITY_CONFIGURATION.HOSTS"))}function Kr(t,f){if(t&1){let e=v();r(0,"app-facility-hosts",15),_("hostEmitter",function(n){g(e);let s=d();return C(s.hosts=n)}),a()}t&2&&m("disableRouting",!0)}function Xr(t,f){t&1&&(p(0),l(1,"translate")),t&2&&T(c(1,1,"FACILITY_CONFIGURATION.SERVICES"))}function Qr(t,f){if(t&1){let e=v();r(0,"h1",16),p(1),l(2,"translate"),a(),r(3,"perun-web-apps-alert",17),p(4),l(5,"translate"),a(),r(6,"div",18)(7,"perun-web-apps-debounce-filter",19),_("filter",function(n){g(e);let s=d();return C(s.applyFilter(n))}),a()(),r(8,"app-services-list",20),_("selectionChanged",function(){g(e);let n=d();return C(n.singleServiceSelected())}),a()}if(t&2){let e=d();o(),T(c(2,10,"FACILITY_CONFIGURATION.SERVICES")),o(3),h(" ",c(5,12,"FACILITY_CONFIGURATION.SERVICES_INFO")," "),o(3),m("placeholder","FACILITY_CONFIGURATION.SERVICES_FILTER"),o(),m("loading",e.processing)("disableRouting",!0)("displayColumns",me(14,Pr))("selection",e.selection)("cachedSubject",e.cachedSubject)("filterValue",e.filterValue)("services",e.services)}}function Zr(t,f){t&1&&(p(0),l(1,"translate")),t&2&&T(c(1,1,"FACILITY_CONFIGURATION.SERVICE_CONFIG"))}function Jr(t,f){if(t&1){let e=v();r(0,"perun-web-apps-service-search-select",26),_("serviceSelected",function(n){g(e);let s=d(2);return C(s.filterAttributes(n))}),a()}if(t&2){let e=d(2);m("disableAutoSelect",!0)("services",e.selection.selected)("multiple",!0)("theme","facility-theme")}}function es(t,f){if(t&1&&S(0,"perun-web-apps-attributes-list",27),t&2){let e=d(2);m("loading",e.processing)("emptyListText","FACILITY_CONFIGURATION.EMPTY_REQ_ATT")("attributes",e.filteredAttributes)("selection",e.attSelection)("cachedSubject",e.cachedSubject)}}function ts(t,f){if(t&1){let e=v();r(0,"h1",16),p(1),l(2,"translate"),a(),r(3,"perun-web-apps-alert",17),p(4),l(5,"translate"),a(),r(6,"div",18)(7,"button",21),_("click",function(){g(e);let n=d();return C(n.onRemoveAttributes())}),p(8),l(9,"translate"),a(),r(10,"button",22),_("click",function(){g(e);let n=d();return C(n.onSaveAttributes())}),p(11),l(12,"translate"),a(),b(13,Jr,1,4,"perun-web-apps-service-search-select",23),a(),r(14,"div",24),A(15,es,1,5,"perun-web-apps-attributes-list",25),a()}if(t&2){let e=d(),i=F(5),n=F(7);o(),T(c(2,9,"FACILITY_CONFIGURATION.SERVICE_CONFIG")),o(3),h(" ",c(5,11,"FACILITY_CONFIGURATION.ATT_INFO")," "),o(3),m("disabled",e.processing||e.attSelection.selected.length===0),o(),h(" ",c(9,13,"FACILITY_CONFIGURATION.REMOVE")," "),o(2),m("disabled",e.processing||e.attSelection.selected.length===0),o(),h(" ",c(12,15,"FACILITY_CONFIGURATION.SAVE")," "),o(2),I(i.selectedIndex===e.ATTRIBUTES_IDX?13:-1),o(2),m("perunWebAppsLoader",e.processing)("perunWebAppsLoaderIndicator",n)}}function is(t,f){t&1&&(p(0),l(1,"translate")),t&2&&T(c(1,1,"FACILITY_CONFIGURATION.DESTINATION_CONFIG"))}function ns(t,f){if(t&1){let e=v();r(0,"app-perun-web-apps-facility-services-destinations",28),_("destinationEmitter",function(n){g(e);let s=d();return C(s.destinations=n)}),a()}if(t&2){let e=d();m("configServicesIds",e.serviceIds)("displayedColumns",me(5,Gr))("configServices",e.selection.selected)("loading",e.processing)("title","FACILITY_CONFIGURATION.DESTINATION_CONFIG")}}function os(t,f){t&1&&(p(0),l(1,"translate")),t&2&&T(c(1,1,"FACILITY_CONFIGURATION.MANAGERS"))}function as(t,f){t&1&&S(0,"app-perun-web-apps-facility-settings-managers",29),t&2&&m("disableRouting",!0)("disableSelf",!0)}function rs(t,f){t&1&&(p(0),l(1,"translate")),t&2&&T(c(1,1,"FACILITY_CONFIGURATION.SUMMARY"))}function ss(t,f){if(t&1&&S(0,"app-hosts-list",43),t&2){let e=d(3);m("loading",e.processing)("disableRouting",!0)("displayColumns",me(4,Wr))("hosts",e.hosts)}}function ls(t,f){if(t&1&&S(0,"app-perun-web-apps-destination-list",44),t&2){let e=d(3);m("loading",e.processing)("destinations",e.destinations)("displayColumns",me(4,zr))("services",e.serviceIds)}}function cs(t,f){if(t&1){let e=v();r(0,"mat-accordion")(1,"mat-expansion-panel",31)(2,"mat-expansion-panel-header")(3,"mat-panel-title"),S(4,"mat-icon",32),p(5),l(6,"translate"),a()(),r(7,"h1",16),p(8),l(9,"translate"),a(),r(10,"div",24),A(11,ss,1,5,"app-hosts-list",33),a()(),r(12,"mat-expansion-panel",31)(13,"mat-expansion-panel-header")(14,"mat-panel-title"),S(15,"mat-icon",34),p(16),l(17,"translate"),a()(),r(18,"h1",16),p(19),l(20,"translate"),a(),S(21,"app-services-list",35),a(),r(22,"mat-expansion-panel",36),_("opened",function(){g(e);let n=d(2);return C(n.getNonEmptyAttributes())}),r(23,"mat-expansion-panel-header")(24,"mat-panel-title"),S(25,"mat-icon",32),p(26),l(27,"translate"),a()(),r(28,"h1",16),p(29),l(30,"translate"),a(),S(31,"perun-web-apps-attributes-list",37),a(),r(32,"mat-expansion-panel",38),Re("expandedChange",function(n){g(e);let s=d(2);return Me(s.destinationServiceMissing,n)||(s.destinationServiceMissing=n),C(n)}),r(33,"mat-expansion-panel-header")(34,"mat-panel-title"),S(35,"mat-icon",39),p(36),l(37,"translate"),a()(),r(38,"h1",16),p(39),l(40,"translate"),a(),r(41,"div",24),A(42,ls,1,5,"app-perun-web-apps-destination-list",40),a()(),r(43,"mat-expansion-panel")(44,"mat-expansion-panel-header")(45,"mat-panel-title"),S(46,"mat-icon",41),p(47),l(48,"translate"),a()(),S(49,"app-managers-page",42),a()()}if(t&2){let e=d(2),i=F(7);m("@.disabled",!0),o(),m("disabled",e.hosts.length===0),o(),Y("cursor-default",e.hosts.length===0),o(3),h(" ",c(6,42,"FACILITY_CONFIGURATION.HOSTS")," "),o(3),T(c(9,44,"FACILITY_CONFIGURATION.HOSTS")),o(3),m("perunWebAppsLoader",e.processing)("perunWebAppsLoaderIndicator",i),o(),m("disabled",e.selection.selected.length===0),o(),Y("cursor-default",e.selection.selected.length===0),o(3),h(" ",c(17,46,"FACILITY_CONFIGURATION.SERVICES")," "),o(3),T(c(20,48,"FACILITY_CONFIGURATION.SERVICES")),o(2),m("loading",e.processing)("disableRouting",!0)("displayColumns",me(60,jr))("services",e.selection.selected),o(),m("disabled",e.selection.selected.length===0),o(),Y("cursor-default",e.selection.selected.length===0),o(3),h(" ",c(27,50,"FACILITY_CONFIGURATION.SERVICE_CONFIG")," "),o(3),T(c(30,52,"FACILITY_CONFIGURATION.ATTS")),o(2),m("loading",e.processing)("displayColumns",me(61,Hr))("attributes",e.filteredAttributes)("emptyListText","FACILITY_CONFIGURATION.EMPTY_REQ_ATT"),o(),De("expanded",e.destinationServiceMissing),m("disabled",e.selection.selected.length===0&&e.destinations.length===0),o(),Y("cursor-default",e.selection.selected.length===0&&e.destinations.length===0),o(3),h(" ",c(37,54,"FACILITY_CONFIGURATION.DESTINATION_CONFIG")," "),o(3),T(c(40,56,"FACILITY_CONFIGURATION.DESTINATION")),o(3),m("perunWebAppsLoader",e.processing)("perunWebAppsLoaderIndicator",i),o(5),h(" ",c(48,58,"FACILITY_CONFIGURATION.MANAGERS")," "),o(2),m("complementaryObject",e.facility)("configMode",!0)("disableRouting",!0)("availableRoles",e.availableRoles)("complementaryObjectType","Facility")("displayedGroupColumns",me(62,Ur))("displayedUserColumns",me(63,Yr))}}function ps(t,f){if(t&1&&(r(0,"perun-web-apps-alert",17),S(1,"i",30),l(2,"translate"),a(),b(3,cs,50,64,"mat-accordion")),t&2){d();let e=F(5);o(),m("innerHTML",c(2,2,"FACILITY_CONFIGURATION.SUMMARY_INFO"),At),o(2),I(e.selectedIndex===e.steps.length-1?3:-1)}}function ds(t,f){if(t&1){let e=v();r(0,"button",45),_("click",function(){g(e);let n=d();return C(n.back())}),p(1),l(2,"translate"),a()}t&2&&(o(),h(" ",c(2,1,"FACILITY_CONFIGURATION.BACK")," "))}function ms(t,f){if(t&1){let e=v();r(0,"button",46),_("click",function(){g(e);let n=d();return C(n.next())}),p(1),l(2,"translate"),a()}if(t&2){d();let e=F(5);Y("me-2",e!==void 0&&e.selectedIndex!==0)("ms-auto",!(e!==void 0&&e.selectedIndex!==0)),o(),h(" ",c(2,5,"FACILITY_CONFIGURATION.NEXT")," ")}}function us(t,f){if(t&1){let e=v();r(0,"button",47),_("click",function(){g(e);let n=d();return C(n.onFinish())}),p(1),l(2,"translate"),a()}t&2&&(o(),h(" ",c(2,1,"FACILITY_CONFIGURATION.FINISH")," "))}var Mo=(()=>{class t{constructor(e,i,n,s,y,D,K,U,X,oe){this.attributesManager=e,this.serviceManager=i,this.facilityService=n,this.cd=s,this.dialog=y,this.notificator=D,this.translate=K,this.router=U,this.guiAuthResolver=X,this.entityStorageService=oe,this.processing=!1,this.filteredAttributes=[],this.attSelection=new G(!0,[],!0,(_e,ii)=>_e.id===ii.id),this.cachedSubject=new ae(!0),this.services=[],this.serviceIds=new Set,this.selection=new G(!0,[],!0,(_e,ii)=>_e.id===ii.id),this.hosts=[],this.destinations=[],this.destinationServiceMissing=!1,this.availableRoles=[],this.filterValue="",this.ATTRIBUTES_IDX=2,this.serviceControl=new le(!1,Fe.requiredTrue),this.attributesControl=new le(!0,Fe.requiredTrue),this.allowNavigate=!1,this.attributes=[],this.attributeIds=new Set,this.attributesPerService=new Map,this.servicesPerPackage=new Map,this.saveMsg="",this.removeMsg="",this.BEFORE_OPTIONAL_IDX=1,this.DESTINATIONS_IDX=3,this.AFTER_OPTIONAL_IDX=4,this.translate.get("FACILITY_CONFIGURATION.ATT_SAVED").subscribe(_e=>this.saveMsg=_e),this.translate.get("FACILITY_CONFIGURATION.ATT_REMOVED").subscribe(_e=>this.removeMsg=_e)}ngOnInit(){this.facility=this.entityStorageService.getEntity(),this.guiAuthResolver.assignAvailableRoles(this.availableRoles,"Facility"),this.serviceManager.getServices().subscribe(e=>{this.services=e})}ngAfterViewInit(){this.cd.detectChanges(),this.attSelection.changed.subscribe(()=>{this.attributesControl.setValue(this.attSelection.selected.length===0)})}onCancel(){let e=k();e.width="550px",e.data={facilityId:this.facility.id,lastStep:this.stepper.selectedIndex===this.stepper.steps.length-1,theme:"facility-theme"},this.dialog.open(Do,e).afterClosed().subscribe(n=>{n&&(this.allowNavigate=!0,sessionStorage.removeItem("newFacilityId"),this.router.navigate(["facilities"],{queryParamsHandling:"merge"}))})}singleServiceSelected(){this.setServiceControl(),this.processing}back(){this.stepper.selectedIndex<=this.BEFORE_OPTIONAL_IDX&&this.setServiceControl(),this.stepper.selectedIndex===this.AFTER_OPTIONAL_IDX&&this.selection.selected.length===0?this.stepper.selectedIndex=this.BEFORE_OPTIONAL_IDX:this.stepper.previous()}onSaveAttributes(){return new Promise((e,i)=>{this.processing=!0,this.attributesManager.setFacilityAttributes({facility:this.facility.id,attributes:this.attSelection.selected}).subscribe({next:()=>{this.notificator.showSuccess(this.saveMsg),this.attSelection.clear(),this.cachedSubject.next(!0),this.processing=!1,e()},error:n=>{this.processing=!1,i(n)}})})}next(){this.checkDestinationDependency(this.stepper.selectedIndex),this.stepper.selectedIndex===this.BEFORE_OPTIONAL_IDX?this.selection.selected.length===0?this.openSkipDialog():(this.getRequiredAttributes(),this.stepper.next()):this.stepper.selectedIndex===this.ATTRIBUTES_IDX?this.attSelection.selected.length!==0?this.openUnsavedAttsDialog():this.stepper.next():this.stepper.next()}onFinish(){this.allowNavigate=!0,sessionStorage.removeItem("newFacilityId"),this.router.navigate(["facilities",this.facility.id],{queryParamsHandling:"merge"})}onRemoveAttributes(){this.processing=!0;let e=this.attSelection.selected.map(i=>i.id);this.attributesManager.removeFacilityAttributes(this.facility.id,e).subscribe({next:()=>{this.notificator.showSuccess(this.removeMsg),this.attSelection.clear(),this.cachedSubject.next(!0),this.getRequiredAttributes(),this.processing=!1},error:()=>this.processing=!1})}filterAttributes(e){if(e===void 0||e.length===0){this.filteredAttributes=this.attributes;return}let i=new Set;for(let n of e)this.attributesPerService.get(n.id).forEach(s=>i.add(s));this.filteredAttributes=[];for(let n of this.attributes)i.has(n.id)&&this.filteredAttributes.push(n);this.attSelection.clear(),this.cachedSubject.next(!0)}getNonEmptyAttributes(){this.filteredAttributes=this.attributes.filter(e=>{if(e.value&&(!Array.isArray(e.value)||e.value.length!==0))return e})}navigationStep(e){this.checkDestinationDependency(e.previouslySelectedIndex),e.selectedIndex===this.ATTRIBUTES_IDX?this.getRequiredAttributes():e.selectedIndex===this.DESTINATIONS_IDX?this.processing=!1:e.selectedIndex<=this.BEFORE_OPTIONAL_IDX&&this.setServiceControl()}applyFilter(e){this.filterValue=e,this.selection.clear(),this.cachedSubject.next(!0)}canDeactivate(){return this.allowNavigate||this.onCancel(),this.allowNavigate}getServiceRequiredAttributes(e,i){i!==e.length&&this.attributesManager.getRequiredAttributesDefinition(e[i].id).subscribe(n=>{n=n.filter(s=>this.attributeIds.has(s.id)),this.attributesPerService.set(e[i].id,n.map(s=>s.id)),this.getServiceRequiredAttributes(e,i+1)})}setServiceControl(){this.serviceControl.setValue(this.selection.selected.length!==0)}openSkipDialog(){let e=k();e.width="400px",e.data={theme:"facility-theme"},this.dialog.open(Eo,e).afterClosed().subscribe(n=>{n&&(this.serviceControl.setValue(!0),this.stepper.selectedIndex=this.AFTER_OPTIONAL_IDX)})}getRequiredAttributes(){this.processing=!0,this.attributesManager.getRequiredAttributesFacilityServices(this.selection.selected.map(e=>e.id),this.facility.id).subscribe(e=>{this.attSelection.clear(),this.attributes=e.filter(i=>!rn(i)),this.filteredAttributes=this.attributes,this.attributes.forEach(i=>this.attributeIds.add(i.id)),this.getServiceRequiredAttributes(this.selection.selected,0),this.processing=!1})}openUnsavedAttsDialog(){let e=k();e.width="400px",e.data={theme:"facility-theme"},this.dialog.open(xo,e).afterClosed().subscribe(n=>{n&&this.onSaveAttributes().then(()=>{this.stepper.next()},()=>this.getRequiredAttributes())})}checkDestinationDependency(e){(e===this.BEFORE_OPTIONAL_IDX||e===this.DESTINATIONS_IDX)&&(this.serviceIds=new Set([...this.selection.selected.map(i=>i.id)]),this.destinationServicePresent())}destinationServicePresent(){for(let e of this.destinations)if(!this.serviceIds.has(e.service.id)){this.destinationServiceMissing=!0;return}this.destinationServiceMissing=!1}static{this.\u0275fac=function(i){return new(i||t)(u(Vt),u(ue),u(O),u(Ue),u(J),u(H),u(ce),u(st),u(B),u(j))}}static{this.\u0275cmp=E({type:t,selectors:[["app-facility-configuration-page"]],viewQuery:function(i,n){if(i&1&&Se(Br,5),i&2){let s;ve(s=be())&&(n.stepper=s.first)}},decls:33,vars:15,consts:[["stepper",""],["spinner",""],[1,"facility-theme"],[1,"page-title"],[3,"selectionChange","linear"],["matStepLabel",""],["matStepContent",""],[3,"stepControl"],["optional","true",3,"editable","stepControl"],[3,"editable","optional"],[1,"actions"],["mat-stroked-button","",3,"click"],["mat-stroked-button","",1,"ms-auto","me-2"],["color","accent","mat-flat-button","",3,"me-2","ms-auto"],["color","accent","mat-flat-button","",1,"me-2"],[3,"hostEmitter","disableRouting"],[1,"page-subtitle"],["alert_type","info"],[1,"filters"],[1,"filter",3,"filter","placeholder"],[3,"selectionChanged","loading","disableRouting","displayColumns","selection","cachedSubject","filterValue","services"],["color","warn","mat-flat-button","",1,"me-2",3,"click","disabled"],["color","accent","mat-flat-button","",1,"me-2",3,"click","disabled"],[1,"service-search-select",3,"disableAutoSelect","services","multiple","theme"],[1,"position-relative","table-min-height"],[3,"loading","emptyListText","attributes","selection","cachedSubject",4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],[1,"service-search-select",3,"serviceSelected","disableAutoSelect","services","multiple","theme"],[3,"loading","emptyListText","attributes","selection","cachedSubject"],[3,"destinationEmitter","configServicesIds","displayedColumns","configServices","loading","title"],[3,"disableRouting","disableSelf"],[3,"innerHTML"],[3,"disabled"],["svgIcon","perun-hosts",1,"me-2"],[3,"loading","disableRouting","displayColumns","hosts",4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],["svgIcon","perun-service",1,"me-2"],[3,"loading","disableRouting","displayColumns","services"],[3,"opened","disabled"],[3,"loading","displayColumns","attributes","emptyListText"],[3,"expandedChange","expanded","disabled"],["svgIcon","perun-service_destination",1,"me-2"],[3,"loading","destinations","displayColumns","services",4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],["svgIcon","perun-manager",1,"me-2"],[3,"complementaryObject","configMode","disableRouting","availableRoles","complementaryObjectType","displayedGroupColumns","displayedUserColumns"],[3,"loading","disableRouting","displayColumns","hosts"],[3,"loading","destinations","displayColumns","services"],["mat-stroked-button","",1,"ms-auto","me-2",3,"click"],["color","accent","mat-flat-button","",3,"click"],["color","accent","mat-flat-button","",1,"me-2",3,"click"]],template:function(i,n){if(i&1){let s=v();r(0,"div",2)(1,"div",3),p(2),l(3,"translate"),a(),r(4,"mat-stepper",4,0),_("selectionChange",function(D){return g(s),C(n.navigationStep(D))}),A(6,$r,1,0,"ng-template",null,1,V),r(8,"mat-step"),A(9,qr,2,3,"ng-template",5)(10,Kr,1,1,"ng-template",6),a(),r(11,"mat-step",7),A(12,Xr,2,3,"ng-template",5)(13,Qr,9,15,"ng-template",6),a(),r(14,"mat-step",8),A(15,Zr,2,3,"ng-template",5)(16,ts,16,17,"ng-template",6),a(),r(17,"mat-step",9),A(18,is,2,3,"ng-template",5)(19,ns,1,6,"ng-template",6),a(),r(20,"mat-step"),A(21,os,2,3,"ng-template",5)(22,as,1,2,"ng-template",6),a(),r(23,"mat-step"),A(24,rs,2,3,"ng-template",5)(25,ps,4,4,"ng-template",6),a()(),r(26,"div",10)(27,"button",11),_("click",function(){return g(s),C(n.onCancel())}),p(28),l(29,"translate"),a(),b(30,ds,3,3,"button",12),b(31,ms,3,7,"button",13),b(32,us,3,3,"button",14),a()()}if(i&2){let s=F(5);o(2),h(" ",c(3,11,"FACILITY_CONFIGURATION.TITLE")," "),o(2),m("linear",!0),o(7),m("stepControl",n.serviceControl),o(3),m("editable",n.selection.selected.length!==0)("stepControl",n.attributesControl),o(3),m("editable",n.selection.selected.length!==0||n.destinations.length!==0)("optional",n.destinations.length===0),o(11),h(" ",c(29,13,"FACILITY_CONFIGURATION.CANCEL")," "),o(2),I(s!==void 0&&s.selectedIndex!==0?30:-1),o(),I(s!==void 0&&s.selectedIndex!==s.steps.length-1?31:-1),o(),I(s!==void 0&&s.selectedIndex===s.steps.length-1?32:-1)}},dependencies:[x,w,L,Ve,ke,Be,Ne,de,$t,$i,zi,Ui,Yi,Wi,Zi,Xi,qi,Qi,Ki,R,pe,ei,Yn,An,Ht,Zt,Qt,Jt,Kt,N,M],styles:[".icon-scale[_ngcontent-%COMP%]{transform:scale(1.7);margin-left:.5rem;margin-top:-.6rem;margin-right:.9rem}.filters[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;align-items:baseline}.package-search-select[_ngcontent-%COMP%]{width:650px}.service-search-select[_ngcontent-%COMP%]{width:400px}.filter[_ngcontent-%COMP%]{width:350px;margin-right:20px}.actions[_ngcontent-%COMP%]{background-color:#fff;display:flex;padding:20px}.cursor-default[_ngcontent-%COMP%]{cursor:default}"]})}}return t})();var mi=(()=>{class t{constructor(e){this.router=e}canActivate(e){return e.parent.params.facilityId===sessionStorage.getItem("newFacilityId")?!0:(this.router.navigate(["/home"],{queryParamsHandling:"merge"}),!1)}canDeactivate(e){return e.canDeactivate()}static{this.\u0275fac=function(i){return new(i||t)(Si(st))}}static{this.\u0275prov=Ci({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();var fs=()=>["id","name"];function hs(t,f){t&1&&S(0,"perun-web-apps-loading-table")}function _s(t,f){if(t&1){let e=v();r(0,"perun-web-apps-users-list",5),l(1,"async"),l(2,"async"),_("queryChanged",function(n){g(e);let s=d();return C(s.nextPage.next(n))})("downloadAll",function(n){g(e);let s=d();return C(s.downloadAll(n))}),a()}if(t&2){let e=d();m("loading",c(1,8,e.loading$))("disableRouting",!0)("users",c(2,10,e.usersPage$))("displayColumns",e.displayedColumns)("sortableColumns",me(12,fs))("selection",e.selection)("filter",e.searchString)("facilityId",e.data.entityId)}}var Ro=(()=>{class t{constructor(e,i,n,s,y,D,K,U,X){this.data=e,this.dialogRef=i,this.store=n,this.facilityService=s,this.notificator=y,this.dialog=D,this.cd=K,this.usersManager=U,this.authResolver=X,this.selection=new G(!1,[],!0,(oe,_e)=>oe.id===_e.id),this.attrNames=[Ct.USER_DEF_PREFERRED_MAIL].concat(this.store.getLoginAttributeNames()),this.displayedColumns=["select","id","name","email","logins"],this.searchString="",this.nextPage=new ae({}),this.routeAuth=!1,this.usersPage$=this.nextPage.pipe(hi(oe=>this.usersManager.getUsersPage({attrNames:this.attrNames,query:{order:oe.order,pageSize:oe.pageSize,offset:oe.offset,sortColumn:oe.sortColumn,searchString:oe.searchString,facilityId:this.data.entityId}}).pipe(fi(()=>this.cd.detectChanges()))),gi(()=>{this.selection.clear(),setTimeout(()=>this.loadingSubject$.next(!1),200)}),je({data:[],totalCount:0,offset:0,pageSize:0})),this.loadingSubject$=new ae(!1),this.loading$=ui(this.loadingSubject$,this.nextPage.pipe(Ge(()=>!0)))}ngOnInit(){this.selection.changed.subscribe(e=>{this.ban=this.data.bans.find(i=>i.userId===e.source.selected[0]?.id)}),this.routeAuth=this.authResolver.isPerunAdminOrObserver()}cancel(){this.dialogRef.close(!1)}submitBan(e){this.ban?this.updateBan(e):this.banUser(e)}setFilter(e){this.searchString=e,this.selection.clear(),this.cd.detectChanges()}downloadAll(e){let i=this.nextPage.getValue(),n=k();n.width="500px";let s=this.dialog.open(fn,n),y=this.usersManager.getUsersPage({attrNames:this.attrNames,query:{order:i.order,pageSize:e.length,offset:0,sortColumn:i.sortColumn,searchString:i.searchString,facilityId:this.data.entityId}}).subscribe({next:D=>{s.close(),vt(St(D.data,this.displayedColumns,e.getDataForColumnFun),e.format)},error:D=>{this.notificator.showRPCError(D),s.close()}});s.afterClosed().subscribe(()=>{y&&y.unsubscribe()})}banUser(e){this.facilityService.setFacilityBan({banOnFacility:{userId:this.selection.selected[0].id,facilityId:this.data.entityId,description:e.description,validityTo:e.validity,id:0,beanName:"BanOnVo"}}).subscribe({next:()=>{this.notificator.showSuccess("DIALOGS.ADD_BAN.SUCCESS_USER"),this.dialogRef.close(!0)}})}updateBan(e){this.facilityService.updateFacilityBan({banOnFacility:{id:this.ban.id,beanName:"BanOnFacility",facilityId:this.ban.facilityId,userId:this.ban.userId,description:e.description,validityTo:e.validity}}).subscribe({next:()=>{this.notificator.showSuccess("DIALOGS.UPDATE_BAN.SUCCESS"),this.dialogRef.close(!0)}})}static{this.\u0275fac=function(i){return new(i||t)(u(z),u(W),u(Nt),u(O),u(H),u(J),u(Ue),u(ji),u(B))}}static{this.\u0275cmp=E({type:t,selectors:[["app-add-facility-ban-dialog"]],decls:8,vars:10,consts:[["spinner",""],[3,"add","cancelled","disabled","theme","ban"],[3,"filter","placeholder"],[1,"position-relative","table-min-height"],[3,"loading","disableRouting","users","displayColumns","sortableColumns","selection","filter","facilityId","queryChanged","downloadAll",4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],[3,"queryChanged","downloadAll","loading","disableRouting","users","displayColumns","sortableColumns","selection","filter","facilityId"]],template:function(i,n){if(i&1){let s=v();r(0,"app-add-ban-dialog",1),l(1,"async"),_("add",function(D){return g(s),C(n.submitBan(D))})("cancelled",function(){return g(s),C(n.cancel())}),r(2,"perun-web-apps-debounce-filter",2),_("filter",function(D){return g(s),C(n.setFilter(D))}),a(),A(3,hs,1,0,"ng-template",null,0,V),r(5,"div",3),A(6,_s,3,13,"perun-web-apps-users-list",4),l(7,"async"),a()()}if(i&2){let s=F(4);m("disabled",c(1,6,n.loading$)||n.selection.selected.length===0)("theme",n.data.theme)("ban",n.ban),o(2),m("placeholder","DIALOGS.ADD_BAN.FILTER"),o(4),m("perunWebAppsLoader",c(7,8,n.loading$))("perunWebAppsLoaderIndicator",s)}},dependencies:[x,de,qn,Tn,N,pe,xt],encapsulation:2})}}return t})();function gs(t,f){if(t&1){let e=v();r(0,"button",8),_("click",function(){g(e);let n=d();return C(n.add())}),p(1),l(2,"translate"),a()}t&2&&(o(),h(" ",c(2,1,"FACILITY_DETAIL.SETTINGS.BANS.ADD")," "))}function Cs(t,f){if(t&1){let e=v();r(0,"button",9),_("click",function(){g(e);let n=d();return C(n.remove())}),p(1),l(2,"translate"),a()}if(t&2){let e=d();m("disabled",e.loading||e.selection.selected.length===0),o(),h(" ",c(2,2,"FACILITY_DETAIL.SETTINGS.BANS.REMOVE")," ")}}function Ss(t,f){if(t&1){let e=v();r(0,"perun-web-apps-ban-on-entity-list",10),_("updateBan",function(n){g(e);let s=d();return C(s.update(n))}),a()}if(t&2){let e=d();m("loading",e.loading)("bans",e.bans)("selection",e.selection)("cachedSubject",e.cachedSubject)("displayColumns",e.displayedColumns)("filter",e.filter)("updatePolicy","updateBan_BanOnFacility_policy")}}function vs(t,f){t&1&&S(0,"perun-web-apps-loading-table")}var Fo=(()=>{class t{constructor(e,i,n,s,y,D,K){this.facilityService=e,this.entityService=i,this.authResolver=n,this.dialog=s,this.notificator=y,this.store=D,this.userName=K,this.loading=!1,this.bans=[],this.removeAuth=!1,this.filter="",this.selection=new G(!1,[],!0,(U,X)=>U.ban.id===X.ban.id),this.cachedSubject=new ae(!0),this.attrNames=[Ct.MEMBER_DEF_MAIL,Ct.USER_DEF_PREFERRED_MAIL].concat(this.store.getLoginAttributeNames()),this.displayedColumns=["select","banId","subjectId","subjectName","description","expiration","edit"]}ngOnInit(){this.loading=!0,this.facility=this.entityService.getEntity(),this.addAuth=this.authResolver.isAuthorized("setBan_BanOnFacility_policy",[this.facility]),this.removeAuth=this.authResolver.isAuthorized("removeBan_int_policy",[this.facility]),this.refresh()}refresh(){this.loading=!0,this.facilityService.getEnrichedBansForFacility(this.facility.id,this.attrNames).subscribe({next:e=>{this.bans=e,this.selection.clear(),this.cachedSubject.next(!0),this.loading=!1},error:()=>this.loading=!1})}add(){let e=k();e.width="850px",e.data={entityId:this.facility.id,theme:"facility-theme",bans:this.bans.map(n=>n.ban)},this.dialog.open(Ro,e).afterClosed().subscribe(n=>{n&&this.refresh()})}remove(){let e=k();e.width="550px",e.data={theme:"facility-theme",title:"DIALOGS.REMOVE_BAN.TITLE",description:"DIALOGS.REMOVE_BAN.DESCRIPTION",items:[this.userName.transform(this.selection.selected[0].user)],type:"remove",showAsk:!0},this.dialog.open(Cn,e).afterClosed().subscribe(n=>{n&&(this.loading=!0,this.facilityService.removeFacilityBanById(this.selection.selected[0].ban.id).subscribe(()=>{this.notificator.showSuccess("DIALOGS.REMOVE_BAN.SUCCESS"),this.refresh()}))})}update(e){let i=k();i.width="600px",i.data={ban:e.ban,theme:"facility-theme"},this.dialog.open(Qn,i).afterClosed().subscribe(s=>{s&&this.refresh()})}applyFilter(e){this.filter=e,this.refresh()}static{this.\u0275fac=function(i){return new(i||t)(u(O),u(j),u(B),u(J),u(H),u(Nt),u(Pe))}}static{this.\u0275cmp=E({type:t,selectors:[["app-facility-settings-bans"]],features:[Ti([Pe])],decls:11,vars:8,consts:[["spinner",""],[1,"page-subtitle"],[3,"click"],["color","accent","mat-flat-button","",1,"me-2","action-button"],["color","warn","mat-flat-button","",1,"me-2",3,"disabled"],[1,"mt-2","search-field",3,"filter","placeholder"],[1,"position-relative","table-min-height"],[3,"loading","bans","selection","cachedSubject","displayColumns","filter","updatePolicy","updateBan",4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],["color","accent","mat-flat-button","",1,"me-2","action-button",3,"click"],["color","warn","mat-flat-button","",1,"me-2",3,"click","disabled"],[3,"updateBan","loading","bans","selection","cachedSubject","displayColumns","filter","updatePolicy"]],template:function(i,n){if(i&1){let s=v();r(0,"h1",1),p(1),l(2,"translate"),a(),r(3,"perun-web-apps-refresh-button",2),_("click",function(){return g(s),C(n.refresh())}),a(),b(4,gs,3,3,"button",3),b(5,Cs,3,4,"button",4),r(6,"perun-web-apps-debounce-filter",5),_("filter",function(D){return g(s),C(n.applyFilter(D))}),a(),r(7,"div",6),A(8,Ss,1,7,"perun-web-apps-ban-on-entity-list",7),a(),A(9,vs,1,0,"ng-template",null,0,V)}if(i&2){let s=F(10);o(),h(" ",c(2,6,"FACILITY_DETAIL.SETTINGS.BANS.TITLE"),`
`),o(3),I(n.addAuth?4:-1),o(),I(n.removeAuth?5:-1),o(),m("placeholder","FACILITY_DETAIL.SETTINGS.BANS.FILTER"),o(2),m("perunWebAppsLoader",n.loading)("perunWebAppsLoaderIndicator",s)}},dependencies:[x,w,L,de,Ae,R,Mn,N,pe,M],encapsulation:2})}}return t})();var ih=[{path:"",component:Jn,canActivate:[qt]},{path:":facilityId",component:ao,canActivateChild:[qt],children:[{path:"",component:ro,data:{animation:"FacilityOverviewPage"}},{path:"attributes",component:co,data:{animation:"FacilityAttributesPage"}},{path:"resources",component:eo,data:{animation:"FacilityResourcesPage"}},{path:"allowed-users",component:io,data:{animation:"FacilityAllowedUsersPage"}},{path:"allowed-groups",component:to,data:{animation:"FacilityAllowedGroupsPage"}},{path:"services-status",component:To,data:{animation:"FacilityServiceStatusPage"}},{path:"services-status/:taskId",component:Ao,data:{animation:"FacilityTaskResultsPage"}},{path:"service-config",component:ho,data:{animation:"FacilityServiceConfigPage"}},{path:"services-destinations",component:Zt,data:{animation:"FacilityServicesDestinationsPage"}},{path:"hosts",component:ei,data:{animation:"FacilityHostsPage"}},{path:"hosts/:hostId",component:bo,data:{animation:"FacilityHostsDetailPage"}},{path:"settings",component:so,children:[{path:"",component:lo,data:{animation:"FacilitySettingsOverviewPage"}},{path:"managers",component:Qt,data:{animation:"FacilitySettingsManagersPage"}},{path:"bans",component:Fo,data:{animation:"FacilitySettingsBansPage"}}]},{path:"configuration",component:Mo,canActivate:[mi],canDeactivate:[mi]}]},{path:":facilityId/resources/:resourceId",component:Nn,canActivateChild:[qt],children:[{path:"",component:Bn,data:{animation:"ResourceOverviewPage"}},{path:"attributes",component:Hn,data:{animation:"ResourceAttributesPage"}},{path:"groups",component:Pn,data:{animation:"ResourceGroupsComponent"}},{path:"services",component:Wn,data:{animation:"ResourceAssignedServicesComponent"}},{path:"members",component:zn,data:{animation:"ResourceAssignedMembersComponent"}},{path:"tags",component:$n,data:{animation:"ResourceTagsComponent"}},{path:"settings",component:Gn,children:[{path:"",component:jn,data:{animation:"ResourceSettingsOverviewPage"}},{path:"managers",component:Un,data:{animation:"ResourceSettingsManagersPage"}},{path:"bans",component:Kn,data:{animation:"ResourceSettingsBansPage"}}]}]}];export{ih as facilitiesRoutes};
