import{a as Vt,b as Ht,c as Kt}from"./chunk-B2UJ4L5D.js";import{a as Ot,b as Ut,c as jt,d as Ft,e as Gt,f as Wt,g as qt,h as zt,i as $t,j as Yt,k as Xt}from"./chunk-PZMYCRNF.js";import{a as je}from"./chunk-TILXPZVT.js";import{$b as R,$h as vt,Aa as h,Ae as et,B as _e,Ba as y,Bb as xe,Ca as C,Cb as Ye,Cc as N,Da as Ce,Dc as Le,Ea as Ke,Eb as Xe,Eh as gt,Ej as Ct,F as be,Fg as mt,Fj as It,Hj as At,If as nt,Ij as Et,Ja as G,Jf as V,K as E,Ka as me,Kb as De,Kj as Tt,L as ve,Lb as Qe,Lf as ot,Mb as ye,Me as Ne,Mf as rt,Na as m,Ne as tt,Nf as Be,O as v,Oa as d,Of as Ve,P as S,Pj as xt,Qc as Ze,Qj as Dt,Ra as L,Re as Q,Rf as at,Sf as st,Sg as dt,Tg as ut,Tj as yt,Ub as Me,Uh as ht,Uj as Fe,Vb as T,Vj as Mt,Wh as _t,Wj as wt,Xb as we,Xh as bt,Xi as St,Y as a,Ya as w,Ye as W,Z as c,Za as ee,Zb as Re,Zg as ft,Zj as Rt,_ as qe,_a as Ie,_b as Pe,ae as ne,bk as Pt,cb as ze,cf as oe,ck as Lt,d as M,da as _,di as Ue,ef as B,eg as lt,fh as re,ga as p,gc as H,gi as ae,gk as kt,ha as Se,hh as O,hk as Nt,i as ue,ie as ke,jg as pt,jk as Bt,ka as s,la as l,m as fe,ma as b,of as it,pa as A,ph as Oe,qa as f,qb as Ae,qd as te,ra as g,tb as Ee,ua as j,ub as Te,ud as ie,vc as k,wb as We,x as ge,xe as x,y as he,yb as X,yg as ct,za as P,zb as $e,ze as Je,zh as F}from"./chunk-5CH43A5R.js";var vi=()=>({color:"black"}),ti=(()=>{let o=class o{constructor(t){this.sideMenuService=t}ngOnInit(){this.sideMenuService.setAdminItems([])}};o.\u0275fac=function(e){return new(e||o)(c(oe))},o.\u0275cmp=E({type:o,selectors:[["app-admin-page"]],decls:7,vars:5,consts:[[1,"container-fluid","ps-xl-5","pe-xl-5","admin-theme"],[1,"page-title","d-flex"],["svgIcon","perun-perun-admin",1,"perun-icon","icon-scale",3,"ngStyle"]],template:function(e,r){e&1&&(s(0,"div",0),b(1,"perun-web-apps-back-button"),s(2,"h1",1),b(3,"mat-icon",2),h(4),m(5,"translate"),l(),b(6,"app-animated-router-outlet"),l()),e&2&&(a(3),p("ngStyle",G(4,vi)),a(),C(" ",d(5,2,"ADMIN.TITLE")," "))},dependencies:[ee,te,ae,re,T]});let i=o;return i})();var ii=(()=>{let o=class o{constructor(){this.items=[{cssIcon:"perun-attributes",url:"/admin/attributes",label:"MENU_ITEMS.ADMIN.ATTRIBUTES",style:"admin-btn"},{cssIcon:"perun-user",url:"/admin/users",label:"MENU_ITEMS.ADMIN.USERS",style:"admin-btn"},{cssIcon:"perun-service",url:"/admin/services",label:"MENU_ITEMS.ADMIN.SERVICES",style:"admin-btn"},{cssIcon:"perun-external-sources",url:"/admin/ext_sources",label:"MENU_ITEMS.ADMIN.EXT_SOURCES",style:"admin-btn"},{cssIcon:"perun-audit-log",url:"/admin/audit_log",label:"MENU_ITEMS.ADMIN.AUDIT_LOG",style:"admin-btn"},{cssIcon:"perun-consent-hubs",url:"/admin/consent_hubs",label:"MENU_ITEMS.ADMIN.CONSENT_HUBS",style:"admin-btn"},{cssIcon:"perun-searcher",url:"/admin/searcher",label:"MENU_ITEMS.ADMIN.SEARCHER",style:"admin-btn"},{cssIcon:"perun-blocked-logins",url:"/admin/blocked_logins",label:"MENU_ITEMS.ADMIN.BLOCKED_LOGINS",style:"admin-btn"},{cssIcon:"perun-automated-tasks",url:"/admin/tasks",label:"MENU_ITEMS.ADMIN.TASKS",style:"admin-btn"}]}};o.\u0275fac=function(e){return new(e||o)},o.\u0275cmp=E({type:o,selectors:[["app-admin-overview"]],hostVars:2,hostBindings:function(e,r){e&2&&Se("router-component",r.true)},decls:2,vars:1,consts:[[3,"items"]],template:function(e,r){e&1&&(s(0,"div"),b(1,"perun-web-apps-menu-buttons-field",0),l()),e&2&&(a(),p("items",r.items))},dependencies:[Oe]});let i=o;return i})();function Ii(i,o){if(i&1){let n=A();s(0,"button",9),f("click",function(){v(n);let e=g();return S(e.onCreate())}),h(1),m(2,"translate"),l()}i&2&&(a(),C(" ",d(2,1,"ADMIN.ATTRIBUTES.CREATE")," "))}function Ai(i,o){if(i&1){let n=A();s(0,"button",10),f("click",function(){v(n);let e=g();return S(e.onImport())}),h(1),m(2,"translate"),l()}i&2&&(a(),C(" ",d(2,1,"ADMIN.ATTRIBUTES.IMPORT")," "))}function Ei(i,o){if(i&1){let n=A();s(0,"button",11),f("click",function(){v(n);let e=g();return S(e.onDelete())}),h(1),m(2,"translate"),l()}if(i&2){let n=g();p("disabled",n.loading||n.selected.selected.length===0),a(),C(" ",d(2,2,"ADMIN.ATTRIBUTES.DELETE")," ")}}function Ti(i,o){i&1&&b(0,"perun-web-apps-loading-table")}function xi(i,o){if(i&1){let n=A();s(0,"app-attr-def-list",12),f("refreshEvent",function(){v(n);let e=g();return S(e.refreshTable())}),l()}if(i&2){let n=g();p("loading",n.loading)("definitions",n.attrDefinitions)("disableRouting",!n.authResolver.isPerunAdminOrObserver())("filterValue",n.filterValue)("selection",n.selected)("cachedSubject",n.cachedSubject)("tableId",n.tableId)}}var ni=(()=>{let o=class o{constructor(t,e,r){this.dialog=t,this.attributesManager=e,this.authResolver=r,this.attrDefinitions=[],this.selected=new H(!0,[],!0,(u,I)=>u.id===I.id),this.cachedSubject=new M(!0),this.filterValue="",this.tableId=lt}ngOnInit(){this.refreshTable()}onCreate(){let t=x();t.width="650px",this.dialog.open(It,t).afterClosed().subscribe(r=>{r&&this.refreshTable()})}onDelete(){let t=x();t.width="450px",t.data={attributes:this.selected.selected,theme:"admin-theme"},this.dialog.open(Ct,t).afterClosed().subscribe(r=>{r&&this.refreshTable()})}refreshTable(){this.loading=!0,this.attributesManager.getAllAttributeDefinitions().subscribe(t=>{this.attrDefinitions=t,this.selected.clear(),this.cachedSubject.next(!0),this.loading=!1})}applyFilter(t){this.filterValue=t,this.refreshTable()}onImport(){let t=x();t.width="700px",this.dialog.open(Tt,t).afterClosed().subscribe(r=>{r===!0&&this.refreshTable()})}};o.\u0275fac=function(e){return new(e||o)(c(k),c(X),c(R))},o.\u0275cmp=E({type:o,selectors:[["app-admin-attributes"]],hostVars:2,hostBindings:function(e,r){e&2&&Se("router-component",r.true)},decls:13,vars:9,consts:[[1,"page-subtitle"],[3,"refresh"],["class","me-2 action-button","color","accent","data-cy","new-attr-definition-button","mat-flat-button","",3,"click",4,"ngIf"],["class","me-2 action-button","color","accent","mat-flat-button","",3,"click",4,"ngIf"],["color","warn","class","me-2","data-cy","delete-attr-definition-button","mat-flat-button","",3,"disabled","click",4,"ngIf"],[3,"placeholder","filter"],["spinner",""],[1,"position-relative","table-min-height"],[3,"loading","definitions","disableRouting","filterValue","selection","cachedSubject","tableId","refreshEvent",4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],["color","accent","data-cy","new-attr-definition-button","mat-flat-button","",1,"me-2","action-button",3,"click"],["color","accent","mat-flat-button","",1,"me-2","action-button",3,"click"],["color","warn","data-cy","delete-attr-definition-button","mat-flat-button","",1,"me-2",3,"disabled","click"],[3,"loading","definitions","disableRouting","filterValue","selection","cachedSubject","tableId","refreshEvent"]],template:function(e,r){if(e&1&&(s(0,"div")(1,"h1",0),h(2),m(3,"translate"),l(),s(4,"perun-web-apps-refresh-button",1),f("refresh",function(){return r.refreshTable()}),l(),_(5,Ii,3,3,"button",2)(6,Ai,3,3,"button",3)(7,Ei,3,4,"button",4),s(8,"perun-web-apps-debounce-filter",5),f("filter",function(I){return r.applyFilter(I)}),l(),_(9,Ti,1,0,"ng-template",null,6,L),s(11,"div",7),_(12,xi,1,7,"app-attr-def-list",8),l()()),e&2){let u=P(10);a(2),y(d(3,7,"ADMIN.ATTRIBUTES.TITLE")),a(3),p("ngIf",r.authResolver.isPerunAdmin()),a(),p("ngIf",r.authResolver.isPerunAdmin()),a(),p("ngIf",r.authResolver.isPerunAdmin()),a(),p("placeholder","ADMIN.ATTRIBUTES.SEARCH"),a(4),p("perunWebAppsLoader",r.loading)("perunWebAppsLoaderIndicator",u)}},dependencies:[w,N,Fe,V,O,F,B,T]});let i=o;return i})();function wi(i,o){i&1&&b(0,"mat-spinner",3)}function Ri(i,o){if(i&1){let n=A();s(0,"button",15),f("click",function(){v(n);let e=g(3);return S(e.editUser())}),m(1,"translate"),s(2,"mat-icon"),h(3,"edit"),l()()}i&2&&j("matTooltip",d(1,1,"ADMIN_USER.EDIT"))}function Pi(i,o){if(i&1){let n=A();s(0,"button",16),f("click",function(){v(n);let e=g(3);return S(e.anonymizeUser())}),m(1,"translate"),s(2,"mat-icon"),h(3,"no_accounts"),l()()}i&2&&j("matTooltip",d(1,1,"ADMIN_USER.ANONYMIZE"))}function Li(i,o){if(i&1){let n=A();s(0,"button",16),f("click",function(){v(n);let e=g(3);return S(e.deleteUser())}),m(1,"translate"),s(2,"mat-icon"),h(3,"delete_forever"),l()()}i&2&&j("matTooltip",d(1,1,"ADMIN_USER.DELETE"))}function ki(i,o){i&1&&(s(0,"mat-icon",17),m(1,"translate"),h(2," blur_off "),l()),i&2&&j("matTooltip",d(1,1,"USER_DETAIL.DASHBOARD.ANONYMIZED"))}function Ni(i,o){if(i&1&&(s(0,"span"),_(1,Ri,4,3,"button",12)(2,Pi,4,3,"button",13)(3,Li,4,3,"button",13)(4,ki,3,3,"mat-icon",14),l()),i&2){let n=g(2);a(),p("ngIf",!n.anonymized),a(),p("ngIf",!n.anonymized&&!n.userDeletionForced),a(),p("ngIf",n.userDeletionForced),a(),p("ngIf",n.anonymized)}}var Bi=()=>({color:"black"}),Vi=i=>["/admin/users",i];function Oi(i,o){if(i&1&&(s(0,"div",4),b(1,"mat-icon",5),m(2,"translate"),s(3,"div",6)(4,"div",7)(5,"a",8),h(6),m(7,"userFullName"),l(),s(8,"span",9),h(9),l(),_(10,Ni,5,4,"span",10),l(),s(11,"div"),h(12),m(13,"translate"),l(),s(14,"span",11),h(15),m(16,"translate"),m(17,"translate"),l()()()),i&2){let n=g();a(),j("matTooltip",d(2,12,"ADMIN_USER.ENTITY")),p("ngStyle",G(22,Bi))("svgIcon",n.svgIcon),a(4),p("routerLink",me(23,Vi,n.user.id)),a(),C(" ",d(7,14,n.user)," "),a(3),C(" \xA0#",n.user.id," "),a(),p("ngIf",n.authResolver.isPerunAdmin()),a(2),Ce("",d(13,16,"ADMIN_USER.UUID"),": ",n.user.uuid,""),a(3),Ke(" ",d(16,18,"ADMIN_USER.ENTITY"),", ",d(17,20,"ADMIN_USER.USER_TYPE"),": ",n.getUserType()," ")}}var ai=(()=>{let o=class o{constructor(t,e,r,u,I,D,K,Z,Ge,He){this.route=t,this.attributesService=e,this.usersService=r,this.sideMenuService=u,this.sideMenuItemService=I,this.dialog=D,this.authResolver=K,this.entityStorageService=Z,this.router=Ge,this.store=He,this.loading=!1,this.svgIcon="perun-user-dark"}ngOnInit(){this.loading=!0,this.userDeletionForced=this.store.getProperty("user_deletion_forced"),this.route.params.subscribe(t=>{let e=Number(t.userId);this.entityStorageService.setEntityAndPathParam({id:Number(e),beanName:"User"},Re.User),this.path=`/admin/users/${e}`,this.regex="/admin/users/\\d+",this.usersService.getUserById(e).subscribe({next:u=>{this.user=u,this.svgIcon=this.user.serviceUser?"perun-service-identity":"perun-user-dark";let I=this.sideMenuItemService.parseUser(u,this.path,this.regex);this.sideMenuService.setAdminItems([I]),this.loading=!1},error:()=>this.loading=!1}),this.attributesService.getAttribute("urn:perun:user:attribute-def:virt:anonymized",void 0,void 0,e).subscribe(u=>{this.anonymized=!!u.value})})}editUser(){let t=x();t.width="450px",t.data={theme:"admin-theme",user:this.user},this.dialog.open(Rt,t).afterClosed().subscribe(r=>{r&&this.usersService.getUserById(this.user.id).subscribe(u=>{this.user=u})})}getUserType(){return this.user.serviceUser?"Service":"Person"}anonymizeUser(){this.openDialog(at)}deleteUser(){this.openDialog(st)}openDialog(t){let e=x();e.width="550px",e.data={theme:"admin-theme",user:this.user},this.dialog.open(t,e).afterClosed().subscribe(u=>{u&&this.router.navigate(["/admin","users"],{queryParamsHandling:"merge"})})}};o.\u0275fac=function(e){return new(e||o)(c(Ae),c(X),c(ye),c(oe),c(Ue),c(k),c(R),c(W),c(Ee),c(Pe))},o.\u0275cmp=E({type:o,selectors:[["app-admin-user-detail-page"]],decls:5,vars:2,consts:[[1,"container-fluid","ps-xl-5","pe-xl-5","user-theme"],["class","me-auto ms-auto",4,"ngIf"],["class","d-flex page-title-headtitle",4,"ngIf"],[1,"me-auto","ms-auto"],[1,"d-flex","page-title-headtitle"],[1,"perun-icon","perun-icon-detail",3,"ngStyle","svgIcon","matTooltip"],[1,"page-title-block"],[1,"page-title-headline","d-flex","align-items-center"],["data-cy","user-name-link",1,"user-link",3,"routerLink"],[1,"text-muted"],[4,"ngIf"],[1,"mt-1","entity-info"],["mat-icon-button","","data-cy","edit-user-button",3,"matTooltip","click",4,"ngIf"],["mat-icon-button","",3,"matTooltip","click",4,"ngIf"],["class","mat-icon-war ms-2",3,"matTooltip",4,"ngIf"],["mat-icon-button","","data-cy","edit-user-button",3,"matTooltip","click"],["mat-icon-button","",3,"matTooltip","click"],[1,"mat-icon-war","ms-2",3,"matTooltip"]],template:function(e,r){e&1&&(s(0,"div",0),b(1,"perun-web-apps-back-button"),_(2,wi,1,0,"mat-spinner",1)(3,Oi,18,25,"div",2),b(4,"app-animated-router-outlet"),l()),e&2&&(a(2),p("ngIf",r.loading),a(),p("ngIf",!r.loading&&r.user!==void 0))},dependencies:[w,ee,Te,te,Le,ie,ne,ae,re,Be,T,it]});let i=o;return i})();function Ui(i,o){i&1&&b(0,"perun-web-apps-loading-table")}var ji=()=>["id","name","type"];function Fi(i,o){if(i&1&&b(0,"app-ext-sources-list",7),i&2){let n=g();p("loading",n.loading)("extSources",n.extSources)("filterValue",n.filterValue)("displayedColumns",G(5,ji))("tableId",n.tableId)}}var si=(()=>{let o=class o{constructor(t,e){this.extSourceService=t,this.authResolver=e,this.extSources=[],this.filterValue="",this.loading=!1,this.tableId=pt}ngOnInit(){this.refreshTable()}applyFilter(t){this.filterValue=t}loadConfigExtSources(){this.loading=!0,this.extSourceService.loadExtSourcesDefinitions().subscribe(()=>{this.refreshTable()})}refreshTable(){this.loading=!0,this.extSourceService.getExtSources().subscribe(t=>{this.extSources=t,this.loading=!1})}};o.\u0275fac=function(e){return new(e||o)(c(Ye),c(R))},o.\u0275cmp=E({type:o,selectors:[["app-admin-ext-sources"]],decls:13,vars:9,consts:[[1,"page-subtitle"],[3,"click"],["mat-stroked-button","",1,"me-2",3,"click"],[3,"placeholder","filter"],["spinner",""],[1,"position-relative","table-min-height"],[3,"loading","extSources","filterValue","displayedColumns","tableId",4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],[3,"loading","extSources","filterValue","displayedColumns","tableId"]],template:function(e,r){if(e&1&&(s(0,"div")(1,"h1",0),h(2),m(3,"translate"),l(),s(4,"perun-web-apps-refresh-button",1),f("click",function(){return r.refreshTable()}),l(),s(5,"button",2),f("click",function(){return r.loadConfigExtSources()}),h(6),m(7,"translate"),l(),s(8,"perun-web-apps-debounce-filter",3),f("filter",function(I){return r.applyFilter(I)}),l(),_(9,Ui,1,0,"ng-template",null,4,L),s(11,"div",5),_(12,Fi,1,6,"app-ext-sources-list",6),l()()),e&2){let u=P(10);a(2),y(d(3,5,"ADMIN.EXT_SOURCES.TITLE")),a(4),C(" ",d(7,7,"ADMIN.EXT_SOURCES.LOAD")," "),a(2),p("placeholder","ADMIN.EXT_SOURCES.SEARCH"),a(4),p("perunWebAppsLoader",r.loading)("perunWebAppsLoaderIndicator",u)}},dependencies:[N,St,V,O,F,B,T]});let i=o;return i})();function Hi(i,o){i&1&&b(0,"mat-spinner",3)}function Wi(i,o){if(i&1){let n=A();s(0,"button",18),f("click",function(){v(n);let e=g(2);return S(e.editService())}),m(1,"translate"),s(2,"mat-icon"),h(3,"edit"),l()()}i&2&&j("matTooltip",d(1,1,"SERVICE_DETAIL.EDIT"))}function qi(i,o){if(i&1){let n=A();s(0,"button",19),f("click",function(){v(n);let e=g(2);return S(e.removeService())}),m(1,"translate"),s(2,"mat-icon"),h(3,"delete_forever"),l()()}i&2&&j("matTooltip",d(1,1,"SERVICE_DETAIL.DELETE"))}function Ki(i,o){if(i&1){let n=A();s(0,"button",20),f("click",function(){v(n);let e=g(2);return S(e.evaluateConsents())}),h(1),m(2,"translate"),l()}i&2&&(a(),C(" ",d(2,1,"SERVICE_DETAIL.EVALUATE_CONSENTS")," "))}var zi=()=>({color:"black"}),li=i=>["/admin/services",i];function $i(i,o){if(i&1){let n=A();s(0,"div",4),b(1,"mat-icon",5),m(2,"translate"),s(3,"div",6)(4,"div",7)(5,"div",8)(6,"div",9)(7,"a",10),f("auxclick",function(e){return e.preventDefault()}),h(8),l(),s(9,"span",11),h(10),l(),_(11,Wi,4,3,"button",12)(12,qi,4,3,"button",13),l(),s(13,"span",14),h(14),m(15,"translate"),l()()(),s(16,"div",15)(17,"mat-slide-toggle",16),f("toggleChange",function(){v(n);let e=g();return S(e.changeServiceStatus())}),h(18),m(19,"translate"),l(),s(20,"mat-slide-toggle",16),f("toggleChange",function(){v(n);let e=g();return S(e.groupPropagationChange())}),h(21),m(22,"translate"),l(),s(23,"mat-slide-toggle",16),f("toggleChange",function(){v(n);let e=g();return S(e.voPropagationChange())}),h(24),m(25,"translate"),l(),s(26,"mat-slide-toggle",16),f("toggleChange",function(){v(n);let e=g();return S(e.bannedPropagationChange())}),h(27),m(28,"translate"),l(),_(29,Ki,3,3,"button",17),l()()()}if(i&2){let n=g();a(),j("matTooltip",d(2,19,"SERVICE_DETAIL.ENTITY")),p("ngStyle",G(31,zi)),a(6),p("perunWebAppsMiddleClickRouterLink",me(32,li,n.service.id.toString()))("routerLink",me(34,li,n.service.id)),a(),C(" ",n.service.name," "),a(2),C(" \xA0 #",n.service.id," "),a(),p("ngIf",n.authResolver.isPerunAdmin()),a(),p("ngIf",n.authResolver.isPerunAdmin()),a(2),Ce(" ",d(15,21,"SERVICE_DETAIL.DESCRIPTION"),": ",n.service.description," "),a(3),p("checked",n.service.enabled),a(),C(" ",d(19,23,"SERVICE_DETAIL.ENABLE")," "),a(2),p("checked",n.service.useExpiredMembers),a(),C(" ",d(22,25,"SERVICE_DETAIL.PROPAGATE_GROUP")," "),a(2),p("checked",n.service.useExpiredVoMembers),a(),C(" ",d(25,27,"SERVICE_DETAIL.PROPAGATE_VO")," "),a(2),p("checked",n.service.useBannedMembers),a(),C(" ",d(28,29,"SERVICE_DETAIL.PROPAGATE_BANNED")," "),a(2),p("ngIf",n.authResolver.isPerunAdmin())}}var pi=(()=>{let o=class o{constructor(t,e,r,u,I,D,K,Z,Ge,He,bi){this.route=t,this.router=e,this.consentsManager=r,this.serviceManager=u,this.sideMenuService=I,this.sideMenuItemService=D,this.dialog=K,this.authResolver=Z,this.translate=Ge,this.notificator=He,this.entityStorageService=bi,this.loading=!1}ngOnInit(){this.loading=!0,this.route.params.subscribe(t=>{this.serviceId=Number(t.serviceId),this.entityStorageService.setEntityAndPathParam({id:this.serviceId,beanName:"Service"},Re.Service),this.refresh()})}editService(){let t=x();t.width="600px",t.data={theme:"service-theme",service:this.service},this.dialog.open(xt,t).afterClosed().subscribe(r=>{r&&this.refresh()})}removeService(){let t=x();t.width="600px",t.data={theme:"service-theme",services:[this.service]},this.dialog.open(Dt,t).afterClosed().subscribe(r=>{r&&this.router.navigate(["/admin/services"],{queryParamsHandling:"preserve"})})}changeServiceStatus(){this.service.enabled=!this.service.enabled,this.serviceManager.updateService({service:this.service}).subscribe(()=>{this.notificator.showSuccess(this.translate.instant("SERVICE_DETAIL.STATUS_CHANGE_SUCCESS"))},()=>this.service.enabled=!this.service.enabled)}groupPropagationChange(){this.service.useExpiredMembers=!this.service.useExpiredMembers,this.serviceManager.updateService({service:this.service}).subscribe({next:()=>{this.notificator.showSuccess(this.translate.instant("SERVICE_DETAIL.PROPAGATION_CHANGE_SUCCESS"))},error:()=>this.service.useExpiredMembers=!this.service.useExpiredMembers})}voPropagationChange(){this.service.useExpiredVoMembers=!this.service.useExpiredVoMembers,this.serviceManager.updateService({service:this.service}).subscribe({next:()=>{this.notificator.showSuccess(this.translate.instant("SERVICE_DETAIL.PROPAGATION_CHANGE_SUCCESS"))},error:()=>this.service.useExpiredVoMembers=!this.service.useExpiredVoMembers})}bannedPropagationChange(){this.service.useBannedMembers=!this.service.useBannedMembers,this.serviceManager.updateService({service:this.service}).subscribe({next:()=>{this.notificator.showSuccess(this.translate.instant("SERVICE_DETAIL.PROPAGATION_CHANGE_SUCCESS_BANNED"))},error:()=>this.service.useBannedMembers=!this.service.useBannedMembers})}evaluateConsents(){let t=x();t.width="500px",t.data={title:this.translate.instant("SERVICE_DETAIL.CONFIRM_DIALOG_TITLE"),theme:"service-theme",description:this.translate.instant("SERVICE_DETAIL.CONFIRM_DIALOG_DESCRIPTION"),items:[this.service.name],type:"confirmation",showAsk:!1},this.dialog.open(Ve,t).afterClosed().subscribe(r=>{r&&this.consentsManager.evaluateConsentsForService(this.service.id).subscribe(()=>this.notificator.showSuccess(this.translate.instant("SERVICE_DETAIL.EVALUATION_FINISH")))})}refresh(){this.serviceManager.getServiceById(this.serviceId).subscribe(t=>{this.service=t;let e=this.sideMenuItemService.parseService(this.service);this.sideMenuService.setAdminItems([e]),this.loading=!1},()=>this.loading=!1)}};o.\u0275fac=function(e){return new(e||o)(c(Ae),c(Ee),c(xe),c(De),c(oe),c(Ue),c(k),c(R),c(Me),c(Q),c(W))},o.\u0275cmp=E({type:o,selectors:[["app-service-detail-page"]],decls:5,vars:2,consts:[[1,"container-fluid","ps-xl-5","pe-xl-5","service-theme"],["class","ms-auto me-auto",4,"ngIf"],["class","page-title-headtitle detail-layout",4,"ngIf"],[1,"ms-auto","me-auto"],[1,"page-title-headtitle","detail-layout"],["svgIcon","perun-service",1,"perun-icon","perun-icon-detail",3,"matTooltip","ngStyle"],[1,"wrap-container"],[1,"detail-info"],[1,"flex-column"],[1,"page-title-headline","d-flex","align-items-center"],["data-cy","service-name-link",1,"service-link",3,"perunWebAppsMiddleClickRouterLink","routerLink","auxclick"],[1,"text-muted"],["aria-label","Edit service","data-cy","service-edit-button","mat-icon-button","",3,"matTooltip","click",4,"ngIf"],["aria-label","Remove service","mat-icon-button","",3,"matTooltip","click",4,"ngIf"],[1,"mt-1","entity-info"],[1,"detail-actions"],["labelPosition","before",1,"mb-25",3,"checked","toggleChange"],["class","action-button evaluate-button","mat-stroked-button","",3,"click",4,"ngIf"],["aria-label","Edit service","data-cy","service-edit-button","mat-icon-button","",3,"matTooltip","click"],["aria-label","Remove service","mat-icon-button","",3,"matTooltip","click"],["mat-stroked-button","",1,"action-button","evaluate-button",3,"click"]],template:function(e,r){e&1&&(s(0,"div",0),b(1,"perun-web-apps-back-button"),_(2,Hi,1,0,"mat-spinner",1)(3,$i,30,36,"div",2),b(4,"app-animated-router-outlet"),l()),e&2&&(a(2),p("ngIf",r.loading),a(),p("ngIf",!r.loading))},dependencies:[w,ee,Te,te,N,Le,ie,ne,ke,ae,re,rt,Be,T],styles:[".detail-layout[_ngcontent-%COMP%]{display:flex;flex-direction:row;gap:1.2em}.detail-info[_ngcontent-%COMP%]{display:flex;flex-direction:row;margin-right:1.2em}.wrap-container[_ngcontent-%COMP%]{display:flex;flex-direction:row;flex-wrap:wrap;gap:.3em}.detail-actions[_ngcontent-%COMP%]{display:flex;flex-direction:column;border-left:1px solid rgba(0,0,0,.2);padding-left:.5em}.evaluate-button[_ngcontent-%COMP%]{width:fit-content}"],data:{animation:[gt]}});let i=o;return i})();var ci=(()=>{let o=class o{constructor(t){this.entityStorageService=t,this.navItems=[]}ngOnInit(){this.service=this.entityStorageService.getEntity(),this.initNavItems()}initNavItems(){this.navItems=[{cssIcon:"perun-attributes",url:`/admin/services/${this.service.id}/required-attributes`,label:"MENU_ITEMS.SERVICE.REQUIRED_ATTRIBUTES",style:"service-btn"},{cssIcon:"perun-service_destination",url:`/admin/services/${this.service.id}/destinations`,label:"MENU_ITEMS.SERVICE.DESTINATIONS",style:"service-btn"}]}};o.\u0275fac=function(e){return new(e||o)(c(W))},o.\u0275cmp=E({type:o,selectors:[["app-service-overview"]],decls:1,vars:1,consts:[[3,"items"]],template:function(e,r){e&1&&b(0,"perun-web-apps-menu-buttons-field",0),e&2&&p("items",r.navItems)},dependencies:[Oe]});let i=o;return i})();function Yi(i,o){if(i&1){let n=A();s(0,"button",8),f("click",function(){v(n);let e=g();return S(e.onAdd())}),h(1),m(2,"translate"),l()}i&2&&(a(),C(" ",d(2,1,"SERVICE_DETAIL.REQUIRED_ATTRIBUTES.ADD")," "))}function Xi(i,o){if(i&1){let n=A();s(0,"button",9),f("click",function(){v(n);let e=g();return S(e.onRemove())}),h(1),m(2,"translate"),l()}if(i&2){let n=g();p("disabled",n.loading||n.selection.selected.length===0),a(),C(" ",d(2,2,"SERVICE_DETAIL.REQUIRED_ATTRIBUTES.REMOVE")," ")}}function Qi(i,o){i&1&&b(0,"perun-web-apps-loading-table")}function Zi(i,o){if(i&1){let n=A();s(0,"app-attr-def-list",10),f("refreshEvent",function(){v(n);let e=g();return S(e.refreshTable())}),l()}if(i&2){let n=g();p("loading",n.loading)("definitions",n.attrDefinitions)("filterValue",n.filterValue)("selection",n.selection)("cachedSubject",n.cachedSubject)("disableRouting",!n.authResolver.isPerunAdmin())("tableId",n.tableId)}}var mi=(()=>{let o=class o{constructor(t,e,r,u){this.attributeManager=t,this.dialog=e,this.authResolver=r,this.entityStorageService=u,this.loading=!1,this.filterValue="",this.selection=new H(!0,[],!0,(I,D)=>I.id===D.id),this.cachedSubject=new M(!0),this.attrDefinitions=[],this.tableId=mt}ngOnInit(){this.loading=!0,this.service=this.entityStorageService.getEntity(),this.refreshTable()}refreshTable(){this.loading=!0,this.attributeManager.getRequiredAttributesDefinition(this.service.id).subscribe(t=>{this.selection.clear(),this.cachedSubject.next(!0),this.attrDefinitions=t,this.loading=!1})}onAdd(){let t=x();t.width="950px",t.data={serviceId:this.service.id,theme:"service-theme"},this.dialog.open(Mt,t).afterClosed().subscribe(r=>{r&&this.refreshTable()})}onRemove(){let t=x();t.width="650px",t.data={serviceId:this.service.id,attrDefinitions:this.selection.selected,theme:"service-theme"},this.dialog.open(wt,t).afterClosed().subscribe(r=>{r&&this.refreshTable()})}applyFilter(t){this.filterValue=t,this.refreshTable()}};o.\u0275fac=function(e){return new(e||o)(c(X),c(k),c(R),c(W))},o.\u0275cmp=E({type:o,selectors:[["app-service-required-attributes"]],decls:12,vars:8,consts:[[1,"page-subtitle"],[3,"refresh"],["color","accent","class","me-2 action-button","mat-flat-button","",3,"click",4,"ngIf"],["class","me-2","color","warn","mat-flat-button","",3,"disabled","click",4,"ngIf"],[3,"placeholder","filter"],["spinner",""],[1,"position-relative","table-min-height"],[3,"loading","definitions","filterValue","selection","cachedSubject","disableRouting","tableId","refreshEvent",4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],["color","accent","mat-flat-button","",1,"me-2","action-button",3,"click"],["color","warn","mat-flat-button","",1,"me-2",3,"disabled","click"],[3,"loading","definitions","filterValue","selection","cachedSubject","disableRouting","tableId","refreshEvent"]],template:function(e,r){if(e&1&&(s(0,"div")(1,"h1",0),h(2),m(3,"translate"),l(),s(4,"perun-web-apps-refresh-button",1),f("refresh",function(){return r.refreshTable()}),l(),_(5,Yi,3,3,"button",2)(6,Xi,3,4,"button",3),s(7,"perun-web-apps-debounce-filter",4),f("filter",function(I){return r.applyFilter(I)}),l(),_(8,Qi,1,0,"ng-template",null,5,L),s(10,"div",6),_(11,Zi,1,7,"app-attr-def-list",7),l()()),e&2){let u=P(9);a(2),y(d(3,6,"SERVICE_DETAIL.REQUIRED_ATTRIBUTES.TITLE")),a(3),p("ngIf",r.authResolver.isPerunAdmin()),a(),p("ngIf",r.authResolver.isPerunAdmin()),a(),p("placeholder","SERVICE_DETAIL.REQUIRED_ATTRIBUTES.FILTER"),a(4),p("perunWebAppsLoader",r.loading)("perunWebAppsLoaderIndicator",u)}},dependencies:[w,N,Fe,V,O,F,B,T]});let i=o;return i})();function Ji(i,o){if(i&1){let n=A();s(0,"button",9),f("click",function(){v(n);let e=g();return S(e.onRemove())}),h(1),m(2,"translate"),l()}if(i&2){let n=g();p("disabled",n.loading||n.selection.selected.length===0),a(),C(" ",d(2,2,"SERVICE_DETAIL.DESTINATIONS.REMOVE")," ")}}function en(i,o){if(i&1){let n=A();s(0,"button",10),f("click",function(){v(n);let e=g();return S(e.onAllow())}),h(1),m(2,"translate"),l()}if(i&2){let n=g();p("disabled",n.loading||n.selection.selected.length===0),a(),C(" ",d(2,2,"SERVICE_DETAIL.DESTINATIONS.ALLOW")," ")}}function tn(i,o){if(i&1){let n=A();s(0,"button",9),f("click",function(){v(n);let e=g();return S(e.onBlock())}),h(1),m(2,"translate"),l()}if(i&2){let n=g();p("disabled",n.loading||n.selection.selected.length===0),a(),C(" ",d(2,2,"SERVICE_DETAIL.DESTINATIONS.BLOCK")," ")}}function nn(i,o){i&1&&b(0,"perun-web-apps-loading-table")}var on=()=>["select","destinationId","facility","destination","type","status","propagationType"];function rn(i,o){if(i&1&&b(0,"app-perun-web-apps-destination-list",11),i&2){let n=g();p("loading",n.loading)("destinations",n.destinations)("filterValue",n.filterValue)("selection",n.selection)("cachedSubject",n.cachedSubject)("displayedColumns",G(7,on))("tableId",n.tableId)}}var di=(()=>{let o=class o{constructor(t,e,r,u,I,D){this.serviceManager=t,this.notificator=e,this.translate=r,this.dialog=u,this.authResolver=I,this.entityStorageService=D,this.loading=!1,this.filterValue="",this.destinations=[],this.selection=new H(!0,[],!0,(K,Z)=>K.id===Z.id),this.cachedSubject=new M(!0),this.tableId=ct}ngOnInit(){this.loading=!0,this.service=this.entityStorageService.getEntity(),this.refreshTable()}refreshTable(){this.loading=!0,this.serviceManager.getAllRichDestinationsForService(this.service.id).subscribe(t=>{this.selection.clear(),this.cachedSubject.next(!0),this.filterValue="",this.destinations=t,this.loading=!1})}onBlock(){this.loading=!0,this.blockServiceOnDestinations(this.selection.selected)}onAllow(){this.loading=!0,this.allowServiceOnDestinations(this.selection.selected)}onRemove(){let t=x();t.width="500px",t.data={destinations:this.selection.selected,theme:"admin-theme"},this.dialog.open(Et,t).afterClosed().subscribe(r=>{r&&this.refreshTable()})}applyFilter(t){this.filterValue=t,this.refreshTable()}blockServiceOnDestinations(t){this.serviceManager.blockServicesOnDestinations({richDestinations:t}).subscribe({next:()=>{this.notificator.showSuccess(this.translate.instant("SERVICE_DETAIL.DESTINATIONS.BLOCK_SUCCESS")),this.refreshTable()},error:()=>this.loading=!1})}allowServiceOnDestinations(t){this.serviceManager.unblockServicesOnDestinations({richDestinations:t}).subscribe({next:()=>{this.notificator.showSuccess(this.translate.instant("SERVICE_DETAIL.DESTINATIONS.ALLOW_SUCCESS")),this.refreshTable()},error:()=>this.loading=!1})}};o.\u0275fac=function(e){return new(e||o)(c(De),c(Q),c(we),c(k),c(R),c(W))},o.\u0275cmp=E({type:o,selectors:[["app-service-destinations"]],decls:13,vars:9,consts:[[1,"page-subtitle"],[3,"refresh"],["color","warn","class","me-2","mat-flat-button","",3,"disabled","click",4,"ngIf"],["class","me-2","color","accent","mat-flat-button","",3,"disabled","click",4,"ngIf"],["class","me-2","color","warn","mat-flat-button","",3,"disabled","click",4,"ngIf"],[3,"placeholder","filter"],["spinner",""],[1,"position-relative","table-min-height"],[3,"loading","destinations","filterValue","selection","cachedSubject","displayedColumns","tableId",4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],["color","warn","mat-flat-button","",1,"me-2",3,"disabled","click"],["color","accent","mat-flat-button","",1,"me-2",3,"disabled","click"],[3,"loading","destinations","filterValue","selection","cachedSubject","displayedColumns","tableId"]],template:function(e,r){if(e&1&&(s(0,"div")(1,"h1",0),h(2),m(3,"translate"),l(),s(4,"perun-web-apps-refresh-button",1),f("refresh",function(){return r.refreshTable()}),l(),_(5,Ji,3,4,"button",2)(6,en,3,4,"button",3)(7,tn,3,4,"button",4),s(8,"perun-web-apps-debounce-filter",5),f("filter",function(I){return r.applyFilter(I)}),l(),_(9,nn,1,0,"ng-template",null,6,L),s(11,"div",7),_(12,rn,1,8,"app-perun-web-apps-destination-list",8),l()()),e&2){let u=P(10);a(2),y(d(3,7,"SERVICE_DETAIL.DESTINATIONS.TITLE")),a(3),p("ngIf",r.authResolver.isPerunAdmin()),a(),p("ngIf",r.authResolver.isPerunAdmin()),a(),p("ngIf",r.authResolver.isPerunAdmin()),a(),p("placeholder","SERVICE_DETAIL.DESTINATIONS.FILTER"),a(4),p("perunWebAppsLoader",r.loading)("perunWebAppsLoaderIndicator",u)}},dependencies:[w,N,At,V,O,F,B,T]});let i=o;return i})();function an(i,o){i&1&&b(0,"perun-web-apps-loading-table")}function sn(i,o){if(i&1){let n=A();s(0,"app-audit-messages-list",7),f("queryChanged",function(e){v(n);let r=g();return S(r.nextPage.next(e))}),m(1,"async"),m(2,"async"),l()}if(i&2){let n=g();p("loading",d(1,5,n.loading$))("resetPagination",n.resetPagination)("displayedColumns",n.displayedColumns)("auditMessages",d(2,7,n.messagesPage$))("tableId",n.tableId)}}var ui=(()=>{let o=class o{constructor(t){this.auditMessagesManagerService=t,this.tableId=dt,this.displayedColumns=["id","timestamp","name","actor","event.message","detail"],this.selectedEvents=[],this.eventOptions=[],this.eventOptionsForSearchSelect=[],this.nextPage=new M({}),this.resetPagination=new M(!1),this.messagesPage$=this.nextPage.pipe(he(e=>this.auditMessagesManagerService.getMessagesPage({query:{offset:e.offset,pageSize:e.pageSize,order:e.order,selectedEvents:this.selectedEvents}})),_e(e=>{this.auditMessages=e.data,setTimeout(()=>this.loadingSubject$.next(!1),200)}),ge({data:[],totalCount:0,offset:0,pageSize:0})),this.loadingSubject$=new M(!1),this.loading$=fe(this.loadingSubject$,this.nextPage.pipe(ue(()=>!0)))}ngOnInit(){this.auditMessagesManagerService.findAllPossibleEvents().subscribe(t=>{this.eventOptions=t.sort(),this.eventOptionsForSearchSelect=this.eventOptions})}refreshTable(){this.resetPagination.next(!0),this.nextPage.next(this.nextPage.value)}toggleEvent(t){this.selectedEvents.splice(0,this.selectedEvents.length,...t)}refreshOnClosed(){this.selectedEvents=[...this.selectedEvents];let t=this.eventOptions.filter(e=>!this.selectedEvents.includes(e));this.eventOptionsForSearchSelect=[...this.selectedEvents,...t],this.refreshTable()}};o.\u0275fac=function(e){return new(e||o)(c($e))},o.\u0275cmp=E({type:o,selectors:[["app-admin-audit-log"]],decls:11,vars:9,consts:[[1,"page-subtitle"],[1,"align-elements"],[3,"refresh"],[3,"disableDeselectButton","auditLogs","auditLogsSelected","selectClosed"],["spinner",""],[1,"position-relative","w-100","table-min-height"],[3,"loading","resetPagination","displayedColumns","auditMessages","tableId","queryChanged",4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],[3,"loading","resetPagination","displayedColumns","auditMessages","tableId","queryChanged"]],template:function(e,r){if(e&1&&(s(0,"h1",0),h(1),m(2,"translate"),l(),s(3,"div",1)(4,"perun-web-apps-refresh-button",2),f("refresh",function(){return r.refreshTable()}),l(),s(5,"perun-web-apps-audit-log-search-select",3),f("auditLogsSelected",function(I){return r.toggleEvent(I)})("selectClosed",function(){return r.refreshOnClosed()}),l(),_(6,an,1,0,"ng-template",null,4,L),s(8,"div",5),_(9,sn,3,9,"app-audit-messages-list",6),m(10,"async"),l()()),e&2){let u=P(7);a(),y(d(2,5,"ADMIN.AUDIT_LOG.TITLE")),a(4),p("disableDeselectButton",!1)("auditLogs",r.eventOptionsForSearchSelect),a(4),p("perunWebAppsLoader",d(10,7,r.loading$))("perunWebAppsLoaderIndicator",u)}},dependencies:[Pt,V,O,ht,B,Ie,T]});let i=o;return i})();function pn(i,o){i&1&&(s(0,"perun-web-apps-alert",9),h(1),m(2,"translate"),l()),i&2&&(a(),C(" ",d(2,1,"ADMIN.CONSENT_HUBS.GLOBAL_DISABLED")," "))}function cn(i,o){if(i&1){let n=A();s(0,"button",10),f("click",function(){v(n);let e=g();return S(e.evaluateConsents())}),h(1),m(2,"translate"),l()}if(i&2){let n=g();p("disabled",!n.globalForceConsents||n.loading||n.selection.selected.length===0),a(),C(" ",d(2,2,"ADMIN.CONSENT_HUBS.EVALUATE_CONSENTS")," ")}}function mn(i,o){i&1&&b(0,"perun-web-apps-loading-table")}function dn(i,o){if(i&1&&b(0,"app-perun-web-apps-consent-hubs-list",11),i&2){let n=g();p("loading",n.loading)("consentHubs",n.consentHubs)("selection",n.selection)("cachedSubject",n.cachedSubject)("filterValue",n.filterValue)("tableId",n.tableId)}}var fi=(()=>{let o=class o{constructor(t,e,r,u,I,D){this.consentsManager=t,this.authResolver=e,this.notificator=r,this.translate=u,this.store=I,this.dialog=D,this.loading=!1,this.tableId=ut,this.selection=new H(!0,[],!0,(K,Z)=>K.id===Z.id),this.filterValue="",this.consentHubs=[],this.cachedSubject=new M(!0)}ngOnInit(){this.globalForceConsents=this.store.getProperty("enforce_consents"),this.refreshTable()}applyFilter(t){this.filterValue=t,this.refreshTable()}refreshTable(){this.loading=!0,this.selection.clear(),this.cachedSubject.next(!0),this.consentsManager.getAllConsentHubs().subscribe(t=>{this.consentHubs=t,this.loading=!1})}evaluateConsents(){let t=x();t.width="500px",t.data={title:this.translate.instant("ADMIN.CONSENT_HUBS.CONFIRM_DIALOG_TITLE"),theme:"admin-theme",description:this.translate.instant("ADMIN.CONSENT_HUBS.CONFIRM_DIALOG_DESCRIPTION"),items:this.selection.selected.map(r=>r.name),type:"confirmation",showAsk:!1},this.dialog.open(Ve,t).afterClosed().subscribe(r=>{r&&this.evaluateConsentsForConsentHubs()})}evaluateConsentsForConsentHubs(){this.loading=!0;let t=this.selection.selected.map(e=>e.id);this.consentsManager.evaluateConsentsForConsentHubs(t).subscribe({next:()=>{this.notificator.showSuccess(this.translate.instant("ADMIN.CONSENT_HUBS.EVALUATION_FINISH")),this.refreshTable()},error:()=>this.loading=!1})}};o.\u0275fac=function(e){return new(e||o)(c(xe),c(R),c(Q),c(we),c(Pe),c(k))},o.\u0275cmp=E({type:o,selectors:[["app-perun-web-apps-admin-consent-hubs"]],decls:14,vars:12,consts:[[1,"page-subtitle"],["alert_type","warn",4,"ngIf"],[3,"refresh"],[3,"matTooltipDisabled","matTooltip"],["color","accent","class","action-button me-2","mat-flat-button","",3,"disabled","click",4,"ngIf"],[3,"placeholder","filter"],["spinner",""],[1,"position-relative","table-min-height"],[3,"loading","consentHubs","selection","cachedSubject","filterValue","tableId",4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],["alert_type","warn"],["color","accent","mat-flat-button","",1,"action-button","me-2",3,"disabled","click"],[3,"loading","consentHubs","selection","cachedSubject","filterValue","tableId"]],template:function(e,r){if(e&1&&(s(0,"div")(1,"h1",0),h(2),m(3,"translate"),l(),_(4,pn,3,3,"perun-web-apps-alert",1),s(5,"perun-web-apps-refresh-button",2),f("refresh",function(){return r.refreshTable()}),l(),s(6,"span",3),m(7,"translate"),_(8,cn,3,4,"button",4),l(),s(9,"perun-web-apps-debounce-filter",5),f("filter",function(I){return r.applyFilter(I)}),l(),_(10,mn,1,0,"ng-template",null,6,L),s(12,"div",7),_(13,dn,1,6,"app-perun-web-apps-consent-hubs-list",8),l()()),e&2){let u=P(11);a(2),y(d(3,8,"ADMIN.CONSENT_HUBS.TITLE")),a(2),p("ngIf",!r.globalForceConsents),a(2),j("matTooltip",d(7,10,"ADMIN.CONSENT_HUBS.TOOLTIP")),p("matTooltipDisabled",r.globalForceConsents),a(2),p("ngIf",r.authResolver.isPerunAdmin()),a(),p("placeholder","ADMIN.CONSENT_HUBS.SEARCH"),a(4),p("perunWebAppsLoader",r.loading)("perunWebAppsLoaderIndicator",u)}},dependencies:[w,N,ne,Lt,Ne,V,O,F,B,T]});let i=o;return i})();function un(i,o){if(i&1){let n=A();s(0,"button",10),f("click",function(){v(n);let e=g();return S(e.block())}),h(1),m(2,"translate"),l()}i&2&&(a(),C(" ",d(2,1,"ADMIN.BLOCKED_LOGINS.BLOCK")," "))}function fn(i,o){if(i&1){let n=A();s(0,"button",11),f("click",function(){v(n);let e=g();return S(e.unblock())}),m(1,"async"),h(2),m(3,"translate"),l()}if(i&2){let n=g();p("disabled",d(1,2,n.loading$)||n.selection.selected.length===0),a(2),C(" ",d(3,4,"ADMIN.BLOCKED_LOGINS.UNBLOCK")," ")}}function gn(i,o){i&1&&b(0,"perun-web-apps-loading-table")}function hn(i,o){if(i&1){let n=A();s(0,"perun-web-apps-logins-list",12),f("queryChanged",function(e){v(n);let r=g();return S(r.nextPage.next(e))})("downloadAll",function(e){v(n);let r=g();return S(r.downloadAll(e))}),m(1,"async"),m(2,"async"),l()}if(i&2){let n=g();p("loading",d(1,8,n.loading$))("blockedLogins",d(2,10,n.blockedLoginsPage$))("displayedColumns",n.displayedColumns)("selection",n.selection)("filter",n.searchString)("tableId",n.tableId)("cacheSubject",n.cacheSubject)("resetPagination",n.resetPagination)}}var gi=(()=>{let o=class o{constructor(t,e,r,u,I){this.cd=t,this.dialog=e,this.attributesService=r,this.authResolver=u,this.userManager=I,this.tableId=ft,this.isAdmin=!1,this.selection=new H(!0,[],!0,(D,K)=>D.id===K.id),this.logins=[],this.namespaceOptions=[],this.filterOptions=[],this.selectedNamespaces=[],this.namespaces=new Ze,this.displayedColumns=["checkbox","login","namespace"],this.blockedLogins=[],this.nextPage=new M({}),this.resetPagination=new M(!1),this.blockedLoginsPage$=this.nextPage.pipe(he(D=>this.userManager.getBlockedLoginsPage({query:{order:D.order,pageSize:D.pageSize,offset:D.offset,sortColumn:D.sortColumn,searchString:D.searchString,namespaces:this.selectedNamespaces}})),_e(D=>{this.blockedLogins=D.data,this.selection.clear(),setTimeout(()=>this.loadingSubject$.next(!1),200)}),ge({data:[],totalCount:0,offset:0,pageSize:0})),this.loadingSubject$=new M(!1),this.cacheSubject=new M(!0),this.loading$=fe(this.loadingSubject$,this.nextPage.pipe(ue(()=>!0)))}refreshTable(){this.cacheSubject.next(!0),this.resetPagination.next(!0),this.nextPage.next(this.nextPage.value)}onSearchByString(t){this.searchString=t,this.cd.detectChanges()}ngOnInit(){this.namespaces.setValue(this.selectedNamespaces),this.isAdmin=this.authResolver.isPerunAdmin(),this.attributesService.getAllNamespaces().subscribe(t=>{this.namespaceOptions=t,this.filterOptions=[""].concat(t)})}block(){let t=x();t.width="450px",t.data={theme:"admin-theme",namespaceOptions:this.namespaceOptions},this.dialog.open(Nt,t).afterClosed().subscribe(r=>{r&&this.refreshTable()})}unblock(){let t=x();t.width="650px",t.data={logins:this.selection.selected,theme:"admin-theme"},this.dialog.open(kt,t).afterClosed().subscribe(r=>{r&&this.refreshTable()})}toggleEvent(t){this.selectedNamespaces.splice(0,this.selectedNamespaces.length,...t.map(e=>e===""?null:e))}refreshOnClosed(){this.selectedNamespaces=[...this.selectedNamespaces],this.refreshTable()}downloadAll(t){let e=this.nextPage.getValue();this.userManager.getBlockedLoginsPage({query:{order:e.order,pageSize:t.length,offset:0,sortColumn:e.sortColumn,searchString:e.searchString,namespaces:this.selectedNamespaces}}).subscribe({next:r=>{et(Je(r.data,this.displayedColumns,t.getDataForColumnFun),t.format)}})}};o.\u0275fac=function(e){return new(e||o)(c(qe),c(k),c(X),c(R),c(ye))},o.\u0275cmp=E({type:o,selectors:[["app-perun-web-apps-admin-blocked-logins"]],decls:16,vars:18,consts:[[1,"page-subtitle"],[1,"align-elements"],[3,"refresh"],["color","accent","class","me-2 action-button","data-cy","block-logins-button","mat-flat-button","",3,"click",4,"ngIf"],["class","me-2","color","warn","data-cy","unblock-logins-button","mat-flat-button","",3,"disabled","click",4,"ngIf"],[1,"pr-2","me-2","flex-grow-1",3,"namespaceOptions","multiple","disableAutoSelect","disableDeselectButton","customSelectPlaceholder","namespaceSelected","selectClosed"],[1,"search-field","flex-grow-1",3,"autoFocus","placeholder","filter"],["spinner",""],[1,"position-relative","table-min-height"],[3,"loading","blockedLogins","displayedColumns","selection","filter","tableId","cacheSubject","resetPagination","queryChanged","downloadAll",4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],["color","accent","data-cy","block-logins-button","mat-flat-button","",1,"me-2","action-button",3,"click"],["color","warn","data-cy","unblock-logins-button","mat-flat-button","",1,"me-2",3,"disabled","click"],[3,"loading","blockedLogins","displayedColumns","selection","filter","tableId","cacheSubject","resetPagination","queryChanged","downloadAll"]],template:function(e,r){if(e&1&&(s(0,"h1",0),h(1),m(2,"translate"),l(),s(3,"div",1)(4,"div")(5,"perun-web-apps-refresh-button",2),f("refresh",function(){return r.refreshTable()}),l(),_(6,un,3,3,"button",3)(7,fn,4,6,"button",4),l(),s(8,"perun-web-apps-namespace-search-select",5),f("namespaceSelected",function(I){return r.toggleEvent(I)})("selectClosed",function(){return r.refreshOnClosed()}),m(9,"translate"),l(),s(10,"perun-web-apps-debounce-filter",6),f("filter",function(I){return r.onSearchByString(I)}),l()(),_(11,gn,1,0,"ng-template",null,7,L),s(13,"div",8),_(14,hn,3,12,"perun-web-apps-logins-list",9),m(15,"async"),l()),e&2){let u=P(12);a(),y(d(2,12,"ADMIN.BLOCKED_LOGINS.TITLE")),a(5),p("ngIf",r.isAdmin),a(),p("ngIf",r.isAdmin),a(),p("namespaceOptions",r.filterOptions)("multiple",!0)("disableAutoSelect",!0)("disableDeselectButton",!1)("customSelectPlaceholder",d(9,14,"ADMIN.BLOCKED_LOGINS.FILTER_NAMESPACE")),a(2),p("autoFocus",!0)("placeholder","ADMIN.BLOCKED_LOGINS.SEARCH_PLACEHOLDER"),a(4),p("perunWebAppsLoader",d(15,16,r.loading$))("perunWebAppsLoaderIndicator",u)}},dependencies:[w,N,V,O,F,B,_t,bt,Ie,T]});let i=o;return i})();function _n(i,o){i&1&&b(0,"mat-spinner",8)}function bn(i,o){if(i&1&&(s(0,"div",6),_(1,_n,1,0,"mat-spinner",7),l()),i&2){let n=g();a(),p("ngIf",n.loading)}}var hi=(()=>{let o=class o{constructor(t,e,r,u){this.groupsManager=t,this.tasksManager=e,this.notificator=r,this.translate=u,this.loading=!0}ngOnInit(){this.loading=!0,this.groupsManager.isSuspendedGroupSynchronization().subscribe({next:t=>{this.groupSyncSuspended=t,this.tasksManager.isSuspendedTasksPropagation().subscribe({next:e=>{this.tasksPropSuspended=e,this.loading=!1},error:()=>{this.loading=!1}})},error:()=>{this.loading=!1}})}toggleGroupSuspension(){this.groupSyncSuspended=!this.groupSyncSuspended,this.groupSyncSuspended?this.groupsManager.suspendGroupSynchronization().subscribe({next:()=>{this.notificator.showSuccess(this.translate.instant("ADMIN.TASKS.SYNC_SUSPENDED_SUCCESS"))},error:()=>{this.groupSyncSuspended=!this.groupSyncSuspended}}):this.groupsManager.resumeGroupSynchronization().subscribe({next:()=>{this.notificator.showSuccess(this.translate.instant("ADMIN.TASKS.SYNC_RESUMED_SUCCESS"))},error:()=>{this.groupSyncSuspended=!this.groupSyncSuspended}})}toggleTaskSuspension(){this.tasksPropSuspended=!this.tasksPropSuspended,this.tasksPropSuspended?this.tasksManager.suspendTasksPropagation(!0).subscribe({next:()=>{this.notificator.showSuccess(this.translate.instant("ADMIN.TASKS.PROPAGATION_SUSPENDED_SUCCESS"))},error:()=>{this.tasksPropSuspended=!this.tasksPropSuspended}}):this.tasksManager.resumeTasksPropagation(!0).subscribe({next:()=>{this.notificator.showSuccess(this.translate.instant("ADMIN.TASKS.PROPAGATION_RESUMED_SUCCESS"))},error:()=>{this.tasksPropSuspended=!this.tasksPropSuspended}})}};o.\u0275fac=function(e){return new(e||o)(c(Xe),c(Qe),c(Q),c(Me))},o.\u0275cmp=E({type:o,selectors:[["app-admin-tasks"]],decls:16,vars:17,consts:[[1,"page-subtitle"],["alert_type","info"],[1,"toggles"],["class","spinner-container",4,"ngIf"],["labelPosition","before",1,"mb-2",3,"disabled","checked","change"],["labelPosition","before",3,"disabled","checked","change"],[1,"spinner-container"],["class","ms-auto me-auto",4,"ngIf"],[1,"ms-auto","me-auto"]],template:function(e,r){e&1&&(s(0,"div")(1,"h1",0),h(2),m(3,"translate"),l(),s(4,"div")(5,"perun-web-apps-alert",1),h(6),m(7,"translate"),l()(),s(8,"div",2),_(9,bn,2,1,"div",3),s(10,"mat-slide-toggle",4),f("change",function(){return r.toggleGroupSuspension()}),h(11),m(12,"translate"),l(),s(13,"mat-slide-toggle",5),f("change",function(){return r.toggleTaskSuspension()}),h(14),m(15,"translate"),l()()()),e&2&&(a(2),y(d(3,9,"ADMIN.TASKS.TITLE")),a(4),y(d(7,11,"ADMIN.TASKS.INFO")),a(3),p("ngIf",r.loading),a(),p("disabled",r.loading)("checked",r.groupSyncSuspended),a(),y(d(12,13,"ADMIN.TASKS.GROUP")),a(2),p("disabled",r.loading)("checked",r.tasksPropSuspended),a(),y(d(15,15,"ADMIN.TASKS.TASKS")))},dependencies:[w,ie,ke,Ne,T],styles:[".toggles[_ngcontent-%COMP%]{display:flex;flex-direction:column;padding-left:1em}"]});let i=o;return i})();var vn=[{path:"",component:ti,canActivateChild:[je],children:[{path:"",component:ii,data:{animation:"AdminOverviewPage"}},{path:"attributes",component:ni,data:{animation:"AdminAttributesPage"}},{path:"users",component:Vt,data:{animation:"AdminUsersPage"}},{path:"services",component:Ht,data:{animation:"AdminServicesPage"}},{path:"audit_log",component:ui,data:{animation:"AdminAuditLogPage"}},{path:"ext_sources",component:si,data:{animation:"AdminExtSourcesPage"}},{path:"consent_hubs",component:fi,data:{animation:"AdminConsentHubsPage"}},{path:"searcher",component:Kt,data:{animation:"AdminSearcherPage"}},{path:"blocked_logins",component:gi,data:{animation:"AdminBlockedLoginsPage"}},{path:"tasks",component:hi,data:{animation:"AdminTasksComponent"}}]},{path:"users/:userId",component:ai,canActivateChild:[je],children:[{path:"",component:Ot,data:{animation:"UserOverviewPage"}},{path:"accounts",component:qt,data:{animation:"UserAccountsPage"}},{path:"assignments",component:$t,data:{animation:"UserAssignmentsPage"}},{path:"attributes",component:Ut,data:{animation:"UserAttributesPage"}},{path:"identities",component:Gt,data:{animation:"UserIdentitiesPage"}},{path:"identities/:identityId",component:yt,data:{animation:"UserIdentityDetailPage"}},{path:"roles",component:jt,data:{animation:"UserRolesPage"}},{path:"service-identities",component:Ft,data:{animation:"UserServiceIdentities"}},{path:"associated-users",component:Wt,data:{animation:"AssociatedUsersPage"}},{path:"bans",component:zt,data:{animation:"UserBansPage"}},{path:"applications",component:Yt,data:{animation:"UserApplicationsPage"}}]},{path:"services/:serviceId",component:pi,canActivateChild:[je],children:[{path:"",component:ci,data:{animation:"ServiceOverviewPage"}},{path:"required-attributes",component:mi,data:{animation:"ServiceRequiredAttributesPage"}},{path:"destinations",component:di,data:{animation:"ServiceDestinationsPage"}}]}],_i=(()=>{let o=class o{};o.\u0275fac=function(e){return new(e||o)},o.\u0275mod=ve({type:o}),o.\u0275inj=be({imports:[We.forChild(vn),We]});let i=o;return i})();var ss=(()=>{let o=class o{};o.\u0275fac=function(e){return new(e||o)},o.\u0275mod=ve({type:o}),o.\u0275inj=be({imports:[ze,_i,Bt,tt,ot,vt,nt,Xt]});let i=o;return i})();export{ss as a};
