import{$ as j,$b as F,$d as Gt,$e as Oi,$f as ji,Aa as m,Ab as ut,Ae as Ze,Ai as qt,B as pt,Ba as y,Be as Je,Bi as ke,Ca as b,Cd as Tt,Da as He,Dc as z,Dd as Et,De as Gi,Eb as de,Ec as ui,Ed as Ct,Eh as J,Fa as ai,Fd as At,Gb as ge,Gd as Rt,Hd as xt,Hh as Nt,Ib as be,Id as Mt,Ii as _o,Ja as Z,Jb as _t,Jd as yt,Ji as ho,K as x,Ka as Ae,Kd as Dt,Kf as K,Ki as fo,Ld as Lt,Li as go,Ma as si,Mb as ci,Mi as bo,N as lt,Na as c,Nd as xi,Ne as Ge,O as S,Oa as d,Oc as ve,Oi as Yt,P as I,Pa as Ve,Pb as ze,Pc as _i,Pi as Qt,Qc as hi,Qg as to,Qi as vo,Ra as U,Rc as ot,Ri as Kt,Se as le,Si as it,T as mt,Tc as Be,Td as Ye,Te as Ie,Ti as So,Uc as fi,Ud as Qe,Ui as Io,Vb as ht,Vc as vt,Vd as Ke,Vf as H,Wa as dt,Wb as V,Wc as gi,Wf as Ft,Xa as Fe,Xc as bi,Y as p,Ya as P,Yb as di,Yc as vi,Z as h,Za as pi,Ze as N,_ as ct,_a as pe,_d as wt,aa as ri,ac as we,af as Pi,ag as Hi,bb as li,bd as Si,be as Y,bf as Vi,c as at,cf as Ot,d as O,da as f,dd as We,df as Fi,dg as $i,di as lo,dj as To,ee as Mi,ei as mo,ej as Eo,fa as ii,fd as Ii,fe as yi,ff as Q,fi as $,g as ye,ga as l,gd as Ti,ge as Di,gf as Pt,gh as io,ha as w,hc as q,hd as Ei,he as Li,hh as Ne,hi as kt,i as _e,id as Ci,ih as Bt,jd as Ai,je as Xe,jg as zi,ka as a,kd as Ri,kg as Wi,kh as oo,ki as Ut,la as s,lj as Co,m as De,ma as E,mc as ft,md as St,mf as Vt,mh as W,mj as Ao,na as ie,ng as qi,nh as no,nj as Ro,oa as oe,oh as ro,oi as jt,oj as xo,pa as T,pd as It,pg as Yi,ph as ao,pi as tt,pj as Mo,q as st,qa as g,qb as mi,qe as A,qg as Qi,qh as so,qi as Ht,ra as _,rd as Se,rg as Ki,ri as $t,sg as Xi,sh as po,si as zt,tb as $e,te as wi,ti as Wt,ua as D,uc as gt,uf as Bi,uj as yo,vc as bt,vd as qe,vf as Ni,wa as ne,wc as B,wf as ki,x as Ce,xa as re,xf as Ui,xg as Zi,xh as et,y as je,ya as ae,yb as Le,ye as C,yg as Ji,yi as co,za as G,zg as eo,zi as uo}from"./chunk-E7YEJTUE.js";function Uo(t,r){if(t&1){let i=T();a(0,"button",11),g("click",function(){S(i);let o=_();return I(o.onRemoveVo())}),m(1),c(2,"translate"),s()}if(t&2){let i=_();l("disabled",i.selection.selected.length===0),p(),b(" ",d(2,2,"VO_MANAGEMENT.REMOVE_VO")," ")}}function jo(t,r){t&1&&E(0,"perun-web-apps-loading-table")}function Ho(t,r){if(t&1&&E(0,"perun-web-apps-vos-list",12),t&2){let i=_();l("loading",i.loading)("tableId",i.tableId)("displayedColumns",i.displayedColumns)("filterValue",i.filterValue)("recentIds",i.recentIds)("cachedSubject",i.cachedSubject)("selection",i.selection)("vos",i.vos)}}var $o=()=>({color:"black"}),Xs=(()=>{let r=class r{constructor(e,o,n,u,v,R,L,M){this.sideMenuService=e,this.voService=o,this.guiAuthResolver=n,this.dialog=u,this.notificator=v,this.apiRequest=R,this.cacheHelperService=L,this.destroyRef=M,this.vos=[],this.recentIds=[],this.filterValue="",this.selection=new q(!0,[],!0,(k,X)=>k.vo.id===X.vo.id),this.cachedSubject=new O(!0),this.tableId=ji}ngOnInit(){this.loading=!0,this.selection=new q(!1,[]),this.createAuth=this.guiAuthResolver.isAuthorized("createVo_Vo_policy",[]),this.deleteAuth=this.guiAuthResolver.isAuthorized("deleteVo_Vo_policy",[]),this.displayedColumns=this.deleteAuth?["checkbox","id","hierarchy","recent","shortName","name"]:["id","recent","hierarchy","shortName","name"],this.refreshTable(),this.cacheHelperService.refreshComponentCachedData().pipe(H(this.destroyRef)).subscribe(e=>{e===r.id&&this.refreshTable()})}ngAfterViewChecked(){this.sideMenuService.setAccessMenuItems([])}refreshTable(){this.loading=!0,this.selection.clear(),this.cachedSubject.next(!0),this.apiRequest.dontHandleErrorForNext(),this.voService.getMyEnrichedVos().subscribe({next:e=>{this.vos=e,this.recentIds=wi("vos"),this.loading=!1},error:e=>{e.name==="PrivilegeException"?(this.vos=[],this.loading=!1):this.notificator.showRPCError(e)}})}applyFilter(e){this.filterValue=e,this.refreshTable()}onCreateVo(){let e=C();e.width="610px",e.data={theme:"vo-theme"},this.dialog.open(mo,e).afterClosed().subscribe(n=>{n&&(this.loading=!0,this.refreshTable())})}onRemoveVo(){let e=C();e.width="500px",e.data={theme:"vo-theme",vos:[this.selection.selected[0].vo]},this.dialog.open(lo,e).afterClosed().subscribe(n=>{n&&this.refreshTable()})}};r.id="VoSelectPageComponent",r.\u0275fac=function(o){return new(o||r)(h(Fi),h(ze),h(F),h(B),h(le),h(Ie),h($),h(j))},r.\u0275cmp=x({type:r,selectors:[["app-vo-select-page"]],hostVars:2,hostBindings:function(o,n){o&2&&w("router-component",n.true)},decls:18,vars:18,consts:[[1,"container-fluid","ps-xl-5","pe-xl-5","vo-theme"],[1,"page-title","d-flex"],["svgIcon","perun-vo-black",1,"perun-icon","icon-scale",3,"ngStyle"],[3,"refresh"],["matTooltipPosition","below",3,"matTooltipDisabled","matTooltip"],["data-cy","new-vo-button","color","accent","mat-flat-button","",1,"me-2","action-button",3,"disabled","click"],["class","me-2","color","warn","mat-flat-button","",3,"disabled","click",4,"ngIf"],[3,"autoFocus","placeholder","filter"],["spinner",""],[1,"position-relative","table-min-height"],[3,"loading","tableId","displayedColumns","filterValue","recentIds","cachedSubject","selection","vos",4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],["color","warn","mat-flat-button","",1,"me-2",3,"disabled","click"],[3,"loading","tableId","displayedColumns","filterValue","recentIds","cachedSubject","selection","vos"]],template:function(o,n){if(o&1&&(a(0,"div",0),E(1,"perun-web-apps-back-button"),a(2,"h1",1),E(3,"mat-icon",2),m(4),c(5,"translate"),s(),a(6,"perun-web-apps-refresh-button",3),g("refresh",function(){return n.refreshTable()}),s(),a(7,"span",4),c(8,"translate"),a(9,"button",5),g("click",function(){return n.onCreateVo()}),m(10),c(11,"translate"),s()(),f(12,Uo,3,4,"button",6),a(13,"perun-web-apps-debounce-filter",7),g("filter",function(v){return n.applyFilter(v)}),s(),f(14,jo,1,0,"ng-template",null,8,U),a(16,"div",9),f(17,Ho,1,8,"perun-web-apps-vos-list",10),s()()),o&2){let u=G(15);p(3),l("ngStyle",Z(17,$o)),p(),b(" ",d(5,11,"VO_MANAGEMENT.TITLE")," "),p(3),D("matTooltip",d(8,13,"VO_MANAGEMENT.CREATE_DISABLED")),l("matTooltipDisabled",n.createAuth),p(2),l("disabled",!n.createAuth),p(),b(" ",d(11,15,"VO_MANAGEMENT.CREATE_VO")," "),p(2),l("ngIf",n.deleteAuth),p(),l("autoFocus",!0)("placeholder","VO_MANAGEMENT.FILTER_PLACEHOLDER"),p(4),l("perunWebAppsLoader",n.loading)("perunWebAppsLoaderIndicator",u)}},dependencies:[P,pi,Se,z,Y,K,io,W,oo,J,Q,V],styles:[".icon-scale[_ngcontent-%COMP%]{transform:scale(1.7);margin-left:.5rem;margin-top:-.4rem;margin-right:.9rem}"]});let t=r;return t})();var zo=["toggle"];function Wo(t,r){if(t&1){let i=T();a(0,"button",12),g("click",function(){S(i);let o=_();return I(o.onCreateGroup())}),m(1),c(2,"translate"),s()}t&2&&(p(),b(" ",d(2,1,"VO_DETAIL.GROUPS.CREATE_GROUP")," "))}function qo(t,r){if(t&1){let i=T();a(0,"span",13),c(1,"translate"),a(2,"button",14),g("click",function(){S(i);let o=_();return I(o.deleteGroup())}),c(3,"async"),m(4),c(5,"translate"),s()()}if(t&2){let i=r.ngIf,e=_();D("matTooltip",d(1,4,"VO_DETAIL.GROUPS.DELETE_PERMISSION_HINT")),l("matTooltipDisabled",i.removeAuth),p(2),l("disabled",d(3,6,e.loading$)||e.selected.selected.length===0||!i.removeAuth),p(2),b(" ",d(5,8,"VO_DETAIL.GROUPS.DELETE_GROUP")," ")}}var Yo=()=>["nameWithId","description","menu"];function Qo(t,r){if(t&1){let i=T();a(0,"perun-web-apps-groups-tree",16),g("moveGroup",function(o){S(i);let n=_(2);return I(n.onMoveGroup(o))})("refreshTable",function(){S(i);let o=_(2);return I(o.refresh())}),c(1,"async"),s()}if(t&2){let i=_(2);l("loading",d(1,8,i.loading$))("displayedColumns",Z(10,Yo))("expandAll",i.filtering)("disableRouting",!i.routeAuth)("groups",i.groups)("selection",i.selected)("filterValue",i.filterValue)("vo",i.vo)}}function Ko(t,r){if(t&1&&(a(0,"div"),f(1,Qo,2,11,"perun-web-apps-groups-tree",15),c(2,"async"),s()),t&2){let i=_(),e=G(22);p(),l("perunWebAppsLoader",d(2,2,i.loading$))("perunWebAppsLoaderIndicator",e)}}function Xo(t,r){if(t&1){let i=T();a(0,"perun-web-apps-groups-list",18),g("groupMoved",function(o){S(i);let n=_(2);return I(n.onMoveGroup(o))})("queryChanged",function(o){S(i);let n=_(2);return I(n.nextPage.next(o))})("refreshTable",function(){S(i);let o=_(2);return I(o.refresh())})("downloadAll",function(o){S(i);let n=_(2);return I(n.downloadAll(o))}),c(1,"async"),c(2,"async"),s()}if(t&2){let i=_(2);l("loading",d(1,9,i.loading$))("disableMembers",!0)("displayedColumns",i.displayedColumns)("disableRouting",!i.routeAuth)("groups",d(2,11,i.groupPage$))("selection",i.selected)("filter",i.filterValue)("tableId",i.tableId)("cacheSubject",i.cacheSubject)}}function Zo(t,r){if(t&1&&(a(0,"div"),f(1,Xo,3,13,"perun-web-apps-groups-list",17),c(2,"async"),s()),t&2){let i=_(),e=G(22);p(),l("perunWebAppsLoader",d(2,2,i.loading$))("perunWebAppsLoaderIndicator",e)}}function Jo(t,r){t&1&&E(0,"perun-web-apps-loading-table")}var en=t=>({removeAuth:t}),bp=(()=>{let r=class r{constructor(e,o,n,u,v,R,L){this.dialog=e,this.groupService=o,this.authResolver=n,this.entityStorageService=u,this.groupUtils=v,this.cacheHelperService=R,this.destroyRef=L,this.groups=[],this.nextPage=new O({}),this.groupPage$=this.nextPage.pipe(je(M=>this.groupService.getGroupsPage({vo:this.vo.id,attrNames:this.attrNames,query:{order:M.order,pageSize:M.pageSize,offset:M.offset,searchString:M.searchString,sortColumn:M.sortColumn,roles:this.selectedRoles,types:this.selectedRoleTypes}})),pt(M=>{this.groups=M.data,this.setAuthRights(),this.selected.clear(),setTimeout(()=>this.loadingSubject$.next(!1),200)}),Ce({data:[],totalCount:0,offset:0,pageSize:0})),this.showGroupList=!1,this.selected=new q(!0,[],!0,(M,k)=>M.id===k.id),this.loadingSubject$=new O(!1),this.loading$=De(this.loadingSubject$,this.nextPage.pipe(_e(()=>!0))),this.filtering=!1,this.filterValue="",this.tableId=eo,this.displayedColumns=["select","id","name","description","menu"],this.selectedRoles=[],this.selectedRoleTypes=[],this.removeAuth$=this.selected.changed.pipe(_e(M=>M.source.selected.reduce((k,X)=>k&&this.authResolver.isAuthorized("deleteGroup_Group_boolean_policy",[this.vo,X]),!0)),Ce(!0)),this.cacheSubject=new O(!0),this.attrNames=[A.GROUP_SYNC_ENABLED,A.GROUP_LAST_SYNC_STATE,A.GROUP_LAST_SYNC_TIMESTAMP,A.GROUP_STRUCTURE_SYNC_ENABLED,A.GROUP_LAST_STRUCTURE_SYNC_STATE,A.GROUP_LAST_STRUCTURE_SYNC_TIMESTAMP]}onCreateGroup(){let e=C();e.width="450px",e.data={voId:this.vo.id,parentGroup:null,theme:"vo-theme"},this.dialog.open(Ut,e).afterClosed().subscribe(n=>{n&&this.refresh()})}ngOnInit(){this.vo=this.entityStorageService.getEntity(),this.setAuthRights(),localStorage.getItem("preferedValue")==="list"?(this.toggle.toggle(),this.showGroupList=!0):this.refresh(),this.toggle.change.subscribe(()=>{let e=this.toggle.checked?"list":"tree";localStorage.setItem("preferedValue",e),this.refresh()}),this.cacheHelperService.refreshComponentCachedData().pipe(H(this.destroyRef)).subscribe(e=>{e===r.id&&this.refresh()})}setAuthRights(){this.createAuth=this.authResolver.isAuthorized("createGroup_Vo_Group_policy",[this.vo]),this.groups.length!==0&&(this.routeAuth=this.authResolver.isAuthorized("getGroupById_int_policy",[this.vo,this.groups[0]]))}deleteGroup(){let e=C();e.width="450px",e.data={voId:this.vo.id,groups:this.selected.selected,theme:"vo-theme"},this.dialog.open(kt,e).afterClosed().subscribe(n=>{n&&this.refresh()})}labelToggle(){this.showGroupList=!this.showGroupList,this.refresh()}removeAllGroups(){this.selected.clear()}onMoveGroup(e){let o=C();o.width="550px",o.data={group:e,theme:"vo-theme"},this.dialog.open(jt,o).afterClosed().subscribe(u=>{u&&this.refresh()})}loadAllGroups(){this.groupService.getAllRichGroupsWithAttributesByNames(this.vo.id,this.attrNames,this.selectedRoles,this.selectedRoleTypes).subscribe(e=>{this.groups=e,this.cacheSubject.next(!0),this.selected.clear(),this.setAuthRights(),this.loadingSubject$.next(!1)})}applyFilter(e){this.filterValue=e,this.filtering=e!==""}applyRoles(e){this.selectedRoles=e,this.refresh()}applyRoleTypes(e){this.selectedRoleTypes=e,this.refresh()}refresh(){this.loadingSubject$.next(!0),this.showGroupList?(this.cacheSubject.next(!0),this.nextPage.next(this.nextPage.value)):this.loadAllGroups()}downloadAll(e){let o=this.nextPage.getValue(),n=(u,v)=>this.groupUtils.getDataForColumn(u,v);this.groupService.getGroupsPage({vo:this.vo.id,attrNames:this.attrNames,query:{order:o.order,pageSize:e.length,offset:0,searchString:o.searchString,sortColumn:o.sortColumn,roles:this.selectedRoles,types:this.selectedRoleTypes}}).subscribe({next:u=>{Je(Ze(u.data,this.displayedColumns,n),e.format)}})}};r.id="VoGroupsComponent",r.\u0275fac=function(o){return new(o||r)(h(B),h(de),h(F),h(N),h(Oi),h($),h(j))},r.\u0275cmp=x({type:r,selectors:[["app-vo-groups"]],viewQuery:function(o,n){if(o&1&&ne(zo,7),o&2){let u;re(u=ae())&&(n.toggle=u.first)}},hostVars:2,hostBindings:function(o,n){o&2&&w("router-component",n.true)},decls:23,vars:20,consts:[[1,"page-subtitle"],[3,"refresh"],["color","accent","class","me-2 action-button","data-cy","create-group-button","mat-flat-button","",3,"click",4,"ngIf"],[3,"matTooltipDisabled","matTooltip",4,"ngIf"],[3,"theme","filterRoles","filterRoleTypes"],[3,"placeholder","filter"],[1,"slide-label",3,"click"],[1,"me-1",3,"ngModel","change","ngModelChange"],["toggle",""],[1,"mt-3","position-relative","table-min-height"],[4,"ngIf"],["spinner",""],["color","accent","data-cy","create-group-button","mat-flat-button","",1,"me-2","action-button",3,"click"],[3,"matTooltipDisabled","matTooltip"],["color","warn","data-cy","delete-group-button","mat-flat-button","",1,"me-2",3,"disabled","click"],["theme","vo-theme",3,"loading","displayedColumns","expandAll","disableRouting","groups","selection","filterValue","vo","moveGroup","refreshTable",4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],["theme","vo-theme",3,"loading","displayedColumns","expandAll","disableRouting","groups","selection","filterValue","vo","moveGroup","refreshTable"],["theme","vo-theme",3,"loading","disableMembers","displayedColumns","disableRouting","groups","selection","filter","tableId","cacheSubject","groupMoved","queryChanged","refreshTable","downloadAll",4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],["theme","vo-theme",3,"loading","disableMembers","displayedColumns","disableRouting","groups","selection","filter","tableId","cacheSubject","groupMoved","queryChanged","refreshTable","downloadAll"]],template:function(o,n){o&1&&(a(0,"div")(1,"h1",0),m(2),c(3,"translate"),s(),a(4,"perun-web-apps-refresh-button",1),g("refresh",function(){return n.refresh()}),s(),f(5,Wo,3,3,"button",2)(6,qo,6,10,"span",3),c(7,"async"),a(8,"app-group-roles-filter",4),g("filterRoles",function(v){return n.applyRoles(v)})("filterRoleTypes",function(v){return n.applyRoleTypes(v)}),s(),a(9,"perun-web-apps-debounce-filter",5),g("filter",function(v){return n.applyFilter(v)}),s(),a(10,"label",6),g("click",function(){return n.labelToggle()}),m(11),c(12,"translate"),s(),a(13,"mat-slide-toggle",7,8),g("change",function(){return n.removeAllGroups()})("ngModelChange",function(v){return n.showGroupList=v}),s(),a(15,"label",6),g("click",function(){return n.labelToggle()}),m(16),c(17,"translate"),s(),a(18,"div",9),f(19,Ko,3,4,"div",10)(20,Zo,3,4,"div",10),s()(),f(21,Jo,1,0,"ng-template",null,11,U)),o&2&&(p(2),y(d(3,10,"VO_DETAIL.GROUPS.TITLE")),p(3),l("ngIf",n.createAuth),p(),l("ngIf",Ae(18,en,d(7,12,n.removeAuth$))),p(2),l("theme","vo-theme"),p(),l("placeholder","VO_DETAIL.GROUPS.FILTER"),p(2),b("",d(12,14,"VO_DETAIL.GROUPS.TREE_VIEW")," "),p(2),l("ngModel",n.showGroupList),p(3),b("",d(17,16,"VO_DETAIL.GROUPS.LIST_VIEW")," "),p(3),l("ngIf",!n.showGroupList),p(),l("ngIf",n.showGroupList))},dependencies:[P,ve,Be,z,Y,Xe,tt,K,Ne,W,et,J,Q,pe,V],styles:[".slide-label[_ngcontent-%COMP%]{display:inline;cursor:pointer}"],changeDetection:0});let t=r;return t})();var Go=(()=>{let r=class r{constructor(e,o,n,u,v,R,L,M,k){this.data=e,this.dialogRef=o,this.membersManagerService=n,this.voService=u,this.registrarManager=v,this.store=R,this.requestService=L,this.addMemberService=M,this.notificator=k,this.loading=!1,this.showInvite=!1,this.searcher=new at,this.members=this.searcher.pipe(je(X=>De(ye(null),this.voService.getCompleteCandidatesForVo(this.data.voId,this.attrNames,X))),Ce(void 0)),this.failed=[],this.selection=new q(!0,[],!0,(X,fe)=>X.richUser?.id===fe.richUser?.id&&X.member?.id===fe.member?.id),this.cachedSubject=new O(!0),this.attrNames=[A.USER_DEF_ORGANIZATION,A.USER_DEF_PREFERRED_MAIL].concat(this.store.getLoginAttributeNames()),this.languages=this.store.getProperty("supported_languages"),this.addMemberService.setDialogRef(this.dialogRef),this.addMemberService.setType("vo")}ngOnInit(){this.registrarManager.invitationFormExists(this.data.voId).subscribe(e=>{this.showInvite=e})}add(){this.loading=!0,this.membersManagerService.addMemberCandidates({candidates:this.addMemberService.convertToMemberCandidates(this.selection.selected),vo:this.data.voId}).subscribe({next:()=>{this.addMemberService.success("DIALOGS.ADD_MEMBERS.SUCCESS_ADD")},error:e=>{this.loading=!1,this.notificator.showRPCError(e)}})}invite(e){this.loading=!0,this.registrarManager.inviteMemberCandidates({candidates:this.addMemberService.convertToMemberCandidates(this.selection.selected),vo:this.data.voId,lang:e}).subscribe({next:()=>{this.addMemberService.success("DIALOGS.ADD_MEMBERS.SUCCESS_INVITE")},error:o=>{this.loading=!1,this.notificator.showRPCError(o)}})}cancel(e){this.dialogRef.close(e)}};r.\u0275fac=function(o){return new(o||r)(h(bt),h(gt),h(ge),h(ze),h(be),h(we),h(Ie),h(zt),h(le))},r.\u0275cmp=x({type:r,selectors:[["app-vo-add-member-dialog"]],decls:2,vars:10,consts:[[3,"loading","showInvite","languages","failed","members","selection","cachedSubject","theme","add","cancel","invite","search"]],template:function(o,n){o&1&&(a(0,"app-add-member-dialog",0),g("add",function(){return n.add()})("cancel",function(v){return n.cancel(v)})("invite",function(v){return n.invite(v)})("search",function(v){return n.searcher.next(v)}),c(1,"async"),s()),o&2&&l("loading",n.loading)("showInvite",n.showInvite)("languages",n.languages)("failed",n.failed)("members",d(1,8,n.members))("selection",n.selection)("cachedSubject",n.cachedSubject)("theme","vo-theme")}});let t=r;return t})();function ln(t,r){if(t&1){let i=T();a(0,"button",19),g("click",function(){S(i);let o=_();return I(o.onAddMember())}),m(1),c(2,"translate"),s()}if(t&2){let i=_();l("disabled",i.blockManualMemberAdding),p(),b(" ",d(2,2,"VO_DETAIL.MEMBERS.ADD_MEMBER")," ")}}function mn(t,r){if(t&1&&(a(0,"button",20),m(1),c(2,"translate"),s()),t&2){let i=_(),e=G(13);l("disabled",i.blockManualMemberAdding||i.inviteDisabled)("matMenuTriggerFor",e),p(),b(" ",d(2,3,"VO_DETAIL.MEMBERS.INVITE")," ")}}function cn(t,r){if(t&1){let i=T();a(0,"button",21),g("click",function(){S(i);let o=_();return I(o.onInviteMember())}),m(1),c(2,"translate"),s()}t&2&&(p(),b(" ",d(2,1,"VO_DETAIL.MEMBERS.INVITE_ONE")," "))}function dn(t,r){if(t&1){let i=T();a(0,"button",21),g("click",function(){S(i);let o=_();return I(o.onBulkInvite())}),m(1),c(2,"translate"),s()}t&2&&(p(),b(" ",d(2,1,"VO_DETAIL.MEMBERS.INVITE_BULK")," "))}function un(t,r){if(t&1){let i=T();a(0,"button",22),g("click",function(){S(i);let o=_();return I(o.copyInvitationLink())}),a(1,"mat-icon"),m(2,"file_copy"),s(),a(3,"span",23),m(4),c(5,"translate"),s()()}if(t&2){let i=_();l("disabled",i.copyInvitationDisabled),p(4),b(" ",d(5,2,"VO_DETAIL.MEMBERS.COPY_INVITATION_LINK")," ")}}function _n(t,r){if(t&1){let i=T();a(0,"button",24),g("click",function(){S(i);let o=_();return I(o.onRemoveMembers())}),c(1,"async"),m(2),c(3,"translate"),s()}if(t&2){let i=_();l("disabled",d(1,2,i.loading$)||i.selection.isEmpty()),p(2),b(" ",d(3,4,"VO_DETAIL.MEMBERS.REMOVE_MEMBERS")," ")}}function hn(t,r){if(t&1&&(a(0,"mat-option",25),m(1),c(2,"memberStatus"),s()),t&2){let i=r.$implicit;l("value",i),p(),y(d(2,2,i))}}function fn(t,r){t&1&&E(0,"perun-web-apps-loading-table")}function gn(t,r){if(t&1){let i=T();a(0,"perun-web-apps-members-list",26),g("queryChanged",function(o){S(i);let n=_();return I(n.nextPage.next(o))})("refreshTable",function(){S(i);let o=_();return I(o.refreshTable())})("downloadAll",function(o){S(i);let n=_();return I(n.downloadAll(o))}),c(1,"async"),c(2,"async"),s()}if(t&2){let i=_();l("loading",d(1,9,i.loading$))("displayedColumns",i.displayedColumns)("disableRouting",!i.routeAuth)("members",d(2,11,i.membersPage$))("selection",i.selection)("filter",i.searchString)("tableId",i.tableId)("voId",i.vo.id)("cacheSubject",i.cacheSubject)}}var ml=(()=>{let r=class r{constructor(e,o,n,u,v,R,L,M,k,X,fe,Pe,Ue,Jt){this.registrarService=e,this.notificator=o,this.dialog=n,this.authzService=u,this.storeService=v,this.attributesManager=R,this.apiRequest=L,this.entityStorageService=M,this.cd=k,this.cacheHelperService=X,this.clipboard=fe,this.membersService=Pe,this.membersListService=Ue,this.destroyRef=Jt,this.selection=new q(!0,[],!0,(ei,ti)=>ei.id===ti.id),this.attrNames=[A.MEMBER_DEF_ORGANIZATION,A.MEMBER_DEF_MAIL,A.USER_DEF_ORGANIZATION,A.USER_DEF_PREFERRED_MAIL,A.MEMBER_DEF_EXPIRATION,A.MEMBER_LIFECYCLE_ALTERABLE],this.statuses=new ot([""]),this.statusList=["VALID","INVALID","EXPIRED","DISABLED"],this.selectedStatuses=[],this.tableId=Wi,this.displayedColumns=["checkbox","id","fullName","status","organization","email","logins"],this.searchString="",this.updateTable=!1,this.inviteDisabled=!0,this.copyInvitationDisabled=!0,this.nextPage=new O({}),this.loadingSubject$=new O(!1),this.cacheSubject=new O(!0),this.loading$=De(this.loadingSubject$,this.nextPage.pipe(_e(()=>!0)))}ngAfterViewInit(){this.cd.detectChanges()}ngOnInit(){this.statuses.setValue(this.selectedStatuses),this.attrNames=this.attrNames.concat(this.storeService.getLoginAttributeNames()),this.vo=this.entityStorageService.getEntity(),this.membersPage$=this.membersListService.nextPageHandler(this.nextPage,this.membersService,this.vo.id,this.attrNames,this.statuses,null,null,this.selection,this.loadingSubject$).pipe(pt(e=>{this.setAuthRights(e.data)})),this.isManualAddingBlocked(this.vo.id),this.cacheHelperService.refreshComponentCachedData().pipe(H(this.destroyRef)).subscribe(e=>{e===r.id&&this.refreshTable()})}setAuthRights(e){this.addAuth=this.authzService.isAuthorized("createMember_Vo_User_List<Group>_policy",[this.vo])&&this.authzService.isAuthorized("createMember_Vo_Candidate_List<Group>_policy",[this.vo]),this.removeAuth=this.authzService.isAuthorized("deleteMembers_List<Member>_policy",[this.vo]),this.displayedColumns=this.removeAuth?this.displayedColumns:["id","fullName","status","organization","email","logins"],e!==null&&e.length!==0&&(this.routeAuth=this.authzService.isAuthorized("getMemberById_int_policy",[this.vo,e[0]])),this.inviteAuth=this.authzService.isAuthorized("vo-sendInvitation_Vo_Group_String_String_String_policy",[this.vo]),this.inviteAuth&&(this.registrarService.isInvitationEnabled(this.vo.id,null).subscribe(o=>{this.inviteDisabled=!o}),this.registrarService.isLinkInvitationEnabled(this.vo.id,null).subscribe(o=>{this.copyInvitationDisabled=!o}))}onSearchByString(e){this.searchString=e,this.refreshTable()}onAddMember(){let e=C();e.width="1000px",e.data={voId:this.vo.id},this.dialog.open(Go,e).afterClosed().subscribe(n=>{n&&this.refreshTable()})}onRemoveMembers(){let e=C();e.width="450px",e.data={members:this.selection.selected,theme:"vo-theme"},this.dialog.open(Ht,e).afterClosed().subscribe(n=>{n&&this.refreshTable()})}onInviteMember(){let e=C();e.width="650px",e.data={voId:this.vo.id,theme:"vo-theme"},this.dialog.open($t,e)}onBulkInvite(){let e=C();e.width="650px",e.data={voId:this.vo.id,theme:"vo-theme"},this.dialog.open(Wt,e)}copyInvitationLink(){(this.invitationLink?ye(this.invitationLink):this.registrarService.buildInviteURL(this.vo.id).pipe(st(o=>(this.invitationLink=o,ye(this.invitationLink))))).subscribe(o=>{this.clipboard.copy(o),this.notificator.showSuccess("VO_DETAIL.MEMBERS.COPY_INVITATION_LINK_SUCCESS")})}displaySelectedStatuses(){if(this.selectedStatuses.length===this.statusList.length)return"ALL";let e=this.statuses.value;return e?`${e[0]}  ${e.length>1?"(+"+(e.length-1).toString()+" "+(e.length===2?"other)":"others)"):""}`:""}isManualAddingBlocked(e){return new Promise(o=>{this.apiRequest.dontHandleErrorForNext(),this.attributesManager.getVoAttributeByName(e,"urn:perun:vo:attribute-def:def:blockManualMemberAdding").subscribe({next:n=>{this.blockManualMemberAdding=n.value!==null,o()},error:n=>{n.name!=="PrivilegeException"&&this.notificator.showError(n.name),o()}})})}changeStatuses(){this.selectedStatuses=this.statuses.value,this.refreshTable()}refreshTable(){this.cacheSubject.next(!0),this.nextPage.next(this.nextPage.value)}downloadAll(e){let o=this.nextPage.getValue(),n=C();n.width="500px";let u=this.dialog.open(Ft,n),v=this.membersService.getMembersPage({vo:this.vo.id,attrNames:this.attrNames,query:{order:o.order,pageSize:e.length,offset:0,sortColumn:this.membersListService.getSortColumn(o.sortColumn),searchString:o.searchString,statuses:this.statuses.value}}).subscribe({next:R=>{u.close(),Je(Ze(R.data,this.displayedColumns,e.getDataForColumnFun),e.format)},error:R=>{this.notificator.showRPCError(R),u.close()}});u.afterClosed().subscribe(()=>{v&&v.unsubscribe()})}};r.id="VoMembersComponent",r.\u0275fac=function(o){return new(o||r)(h(be),h(le),h(B),h(F),h(we),h(Le),h(Ie),h(N),h(ct),h($),h(Vt),h(ge),h(Ot),h(j))},r.\u0275cmp=x({type:r,selectors:[["app-vo-members"]],hostVars:2,hostBindings:function(o,n){o&2&&w("router-component",n.true)},decls:35,vars:36,consts:[[1,"vo-theme"],[1,"page-subtitle"],[1,"align-elements"],[3,"click"],[3,"matTooltipDisabled","matTooltip"],["color","accent","class","me-2 action-button","data-cy","add-members","mat-flat-button","",3,"disabled","click",4,"ngIf"],[3,"matTooltipDisabled","matTooltipPosition","matTooltip"],["class","me-2 dropdown-toggle","color","accent","mat-flat-button","",3,"disabled","matMenuTriggerFor",4,"ngIf"],["menu","matMenu"],["class","action-button","mat-menu-item","",3,"click",4,"ngIf"],["class","me-2","mat-stroked-button","",3,"disabled","click",4,"ngIf"],["color","warn","data-cy","remove-members","class","me-2","mat-flat-button","",3,"disabled","click",4,"ngIf"],[1,"me-2","fix-select"],["multiple","",3,"formControl","closed"],["class","vo-theme",3,"value",4,"ngFor","ngForOf"],[1,"mt-2","search-field",3,"placeholder","filter"],["spinner",""],[1,"position-relative","table-min-height"],[3,"loading","displayedColumns","disableRouting","members","selection","filter","tableId","voId","cacheSubject","queryChanged","refreshTable","downloadAll",4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],["color","accent","data-cy","add-members","mat-flat-button","",1,"me-2","action-button",3,"disabled","click"],["color","accent","mat-flat-button","",1,"me-2","dropdown-toggle",3,"disabled","matMenuTriggerFor"],["mat-menu-item","",1,"action-button",3,"click"],["mat-stroked-button","",1,"me-2",3,"disabled","click"],[1,"ms-1"],["color","warn","data-cy","remove-members","mat-flat-button","",1,"me-2",3,"disabled","click"],[1,"vo-theme",3,"value"],[3,"loading","displayedColumns","disableRouting","members","selection","filter","tableId","voId","cacheSubject","queryChanged","refreshTable","downloadAll"]],template:function(o,n){if(o&1&&(a(0,"div",0)(1,"h1",1),m(2),c(3,"translate"),s(),a(4,"div",2)(5,"perun-web-apps-refresh-button",3),g("click",function(){return n.refreshTable()}),s(),a(6,"div",4),c(7,"translate"),f(8,ln,3,4,"button",5),s(),a(9,"span",6),c(10,"translate"),f(11,mn,3,5,"button",7),a(12,"mat-menu",null,8),f(14,cn,3,3,"button",9)(15,dn,3,3,"button",9),s()(),a(16,"span",6),c(17,"translate"),f(18,un,6,4,"button",10),s(),f(19,_n,4,6,"button",11),a(20,"mat-form-field",12)(21,"mat-label"),m(22),c(23,"translate"),s(),a(24,"mat-select",13),g("closed",function(){return n.changeStatuses()}),a(25,"mat-select-trigger"),m(26),c(27,"memberStatus"),s(),f(28,hn,3,4,"mat-option",14),s()(),a(29,"perun-web-apps-debounce-filter",15),g("filter",function(v){return n.onSearchByString(v)}),s()(),f(30,fn,1,0,"ng-template",null,16,U),a(32,"div",17),f(33,gn,3,13,"perun-web-apps-members-list",18),c(34,"async"),s()()),o&2){let u=G(31);p(2),y(d(3,22,"VO_DETAIL.MEMBERS.TITLE")),p(4),D("matTooltip",d(7,24,"VO_DETAIL.MEMBERS.ADD_MEMBER_DISABLED")),l("matTooltipDisabled",!n.blockManualMemberAdding),p(2),l("ngIf",n.addAuth),p(),D("matTooltip",d(10,26,"VO_DETAIL.MEMBERS.INVITE_DISABLED")),l("matTooltipDisabled",!n.inviteDisabled)("matTooltipPosition","above"),p(2),l("ngIf",n.inviteAuth),p(3),l("ngIf",n.inviteAuth),p(),l("ngIf",n.inviteAuth),p(),D("matTooltip",d(17,28,"VO_DETAIL.MEMBERS.COPY_INVITATION_LINK_DISABLED")),l("matTooltipDisabled",!n.copyInvitationDisabled)("matTooltipPosition","above"),p(2),l("ngIf",n.inviteAuth),p(),l("ngIf",n.removeAuth),p(3),y(d(23,30,"VO_DETAIL.MEMBERS.FILTER_STATUS")),p(2),l("formControl",n.statuses),p(2),b(" ",d(27,32,n.displaySelectedStatuses())," "),p(2),l("ngForOf",n.statusList),p(),l("placeholder","VO_DETAIL.MEMBERS.SEARCH_DESCRIPTION"),p(4),l("perunWebAppsLoader",d(34,34,n.loading$))("perunWebAppsLoaderIndicator",u)}},dependencies:[Fe,P,ft,It,St,ve,vt,Se,z,wt,Gt,Y,Qe,Ye,Ke,K,W,Nt,J,Q,pe,V,Pt],styles:[".search-field[_ngcontent-%COMP%]{width:325px}.fix-select[_ngcontent-%COMP%]{margin-top:8px}"]});let t=r;return t})();var bn=["toggle"],vn=["list"];function Sn(t,r){if(t&1){let i=T();a(0,"button",14),g("click",function(){S(i);let o=_();return I(o.addGroup())}),m(1),c(2,"translate"),s()}t&2&&(p(),b(" ",d(2,1,"MEMBER_DETAIL.GROUPS.ADD"),`
`))}function In(t,r){if(t&1){let i=T();a(0,"span",15),c(1,"translate"),a(2,"button",16),g("click",function(){S(i);let o=_();return I(o.removeGroup())}),m(3),c(4,"translate"),s()()}if(t&2){let i=r.ngIf,e=_();D("matTooltip",d(1,4,"MEMBER_DETAIL.GROUPS.REMOVE_PERMISSION_HINT")),l("matTooltipDisabled",i.removeAuth),p(2),l("disabled",e.selection.selected.length===0||!i.removeAuth),p(),b(" ",d(4,6,"MEMBER_DETAIL.GROUPS.REMOVE")," ")}}function Tn(t,r){t&1&&E(0,"perun-web-apps-loading-table")}var En=()=>["nameWithId","description","expiration","status"];function Cn(t,r){if(t&1){let i=T();a(0,"perun-web-apps-groups-tree",18),g("refreshTable",function(){S(i);let o=_(2);return I(o.refreshTable())})("changeExpiration",function(o){S(i);let n=_(2);return I(n.changeExpiration(o))}),s()}if(t&2){let i=_(2);l("loading",i.loading)("expandAll",i.filtering)("disableRouting",!i.routeAuth)("groups",i.groups)("selection",i.selection)("filterValue",i.filterValue)("displayedColumns",Z(7,En))}}function An(t,r){if(t&1&&(a(0,"div"),f(1,Cn,1,8,"perun-web-apps-groups-tree",17),s()),t&2){let i=_(),e=G(18);p(),l("perunWebAppsLoader",i.loading)("perunWebAppsLoaderIndicator",e)}}var Rn=()=>["select","id","name","description","expiration","groupStatus"];function xn(t,r){if(t&1){let i=T();a(0,"perun-web-apps-groups-list",19,20),g("refreshTable",function(){S(i);let o=_();return I(o.refreshTable())}),s()}if(t&2){let i=_();l("loading",i.loading)("displayedColumns",Z(10,Rn))("memberId",i.member.id)("disableRouting",!i.routeAuth)("groups",i.groups)("filter",i.filterValue)("memberGroupStatus",i.member==null?null:i.member.groupStatus)("selection",i.selection)("tableId",i.tableId)("cacheSubject",i.cacheSubject)}}var Mn=t=>({removeAuth:t}),Ll=(()=>{let r=class r{constructor(e,o,n,u,v,R,L,M){this.groupsService=e,this.route=o,this.dialog=n,this.authResolver=u,this.memberService=v,this.entityService=R,this.cacheHelperService=L,this.destroyRef=M,this.groups=[],this.filterValue="",this.filtering=!1,this.tableId=Xi,this.showGroupList=!1,this.selection=new q(!0,[],!0,(k,X)=>k.id===X.id),this.selectedRoles=[],this.selectedRoleTypes=[],this.removeAuth$=this.selection.changed.pipe(_e(k=>k.source.selected.reduce((X,fe)=>X&&this.authResolver.isAuthorized("removeMember_Member_List<Group>_policy",[fe]),!0)),Ce(!0)),this.cacheSubject=new O(!0)}ngOnInit(){this.loading=!0,this.member=this.entityService.getEntity(),this.groupsService.getAllGroups(this.member.voId).subscribe(e=>{this.allGroups=e,this.addAuth=this.allGroups.reduce((o,n)=>o||this.authResolver.isAuthorized("addMember_Group_Member_policy",[n]),!1),this.refreshTable(),localStorage.getItem("preferedValue")==="list"&&(this.toggle.toggle(),this.showGroupList=!0),this.toggle.change.subscribe(()=>{let o=this.toggle.checked?"list":"tree";localStorage.setItem("preferedValue",o),this.refreshTable()})}),this.cacheHelperService.refreshComponentCachedData().pipe(H(this.destroyRef)).subscribe(e=>{e===r.id&&this.refreshTable()})}refreshTable(){this.loading=!0,this.groupsService.getMemberRichGroupsWithAttributesByNames(this.member.id,[A.MEMBER_DEF_GROUP_EXPIRATION,A.MEMBER_GROUP_STATUS,A.MEMBER_GROUP_STATUS_INDIRECT],this.selectedRoles,this.selectedRoleTypes).subscribe({next:e=>{this.cacheSubject.next(!0),this.selection.clear(),this.groups=e,this.groups.length!==0&&(this.routeAuth=this.authResolver.isAuthorized("getGroupById_int_policy",[{id:this.member.voId,beanName:"Vo"},this.groups[0]])),this.loading=!1},error:()=>this.loading=!1})}changeExpiration(e){this.list.changeExpiration(e)}addGroup(){let e=C();e.width="850px",e.data={memberId:this.member.id,membersGroups:new Set(this.groups.map(n=>n.id)),theme:"member-theme"},this.dialog.open(co,e).afterClosed().subscribe(n=>{n&&this.refreshTable()})}removeGroup(){let e=C();e.width="650px",e.data={memberId:this.member.id,groups:this.selection.selected,theme:"member-theme"},this.dialog.open(uo,e).afterClosed().subscribe(n=>{n&&this.refreshTable()})}applyFilter(e){this.filterValue=e,this.filtering=e!=="",this.selection.clear()}applyRoles(e){this.selectedRoles=e,this.selection.clear(),this.refreshTable()}applyRoleTypes(e){this.selectedRoleTypes=e,this.selection.clear(),this.refreshTable()}labelToggle(){this.cacheSubject.next(!0),this.selection.clear(),this.showGroupList=!this.showGroupList,this.refreshTable()}};r.id="MemberGroupsComponent",r.\u0275fac=function(o){return new(o||r)(h(de),h(mi),h(B),h(F),h(ge),h(N),h($),h(j))},r.\u0275cmp=x({type:r,selectors:[["app-member-groups"]],viewQuery:function(o,n){if(o&1&&(ne(bn,7),ne(vn,5)),o&2){let u;re(u=ae())&&(n.toggle=u.first),re(u=ae())&&(n.list=u.first)}},hostVars:2,hostBindings:function(o,n){o&2&&w("router-component",n.true)},decls:23,vars:23,consts:[[1,"page-subtitle"],[3,"refresh"],["color","accent","class","me-2 action-button","mat-flat-button","",3,"click",4,"ngIf"],[3,"matTooltipDisabled","matTooltip",4,"ngIf"],[3,"hidden","theme","filterRoles","filterRoleTypes"],[3,"placeholder","filter"],[1,"slide-label",3,"click"],[1,"me-1",3,"ngModel","change","ngModelChange"],["toggle",""],["spinner",""],[1,"position-relative","table-min-height"],[4,"ngIf"],[3,"hidden"],[3,"loading","displayedColumns","memberId","disableRouting","groups","filter","memberGroupStatus","selection","tableId","cacheSubject","refreshTable",4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],["color","accent","mat-flat-button","",1,"me-2","action-button",3,"click"],[3,"matTooltipDisabled","matTooltip"],["color","warn","mat-flat-button","",1,"me-2",3,"disabled","click"],["theme","member-theme",3,"loading","expandAll","disableRouting","groups","selection","filterValue","displayedColumns","refreshTable","changeExpiration",4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],["theme","member-theme",3,"loading","expandAll","disableRouting","groups","selection","filterValue","displayedColumns","refreshTable","changeExpiration"],[3,"loading","displayedColumns","memberId","disableRouting","groups","filter","memberGroupStatus","selection","tableId","cacheSubject","refreshTable"],["list",""]],template:function(o,n){if(o&1&&(a(0,"h1",0),m(1),c(2,"translate"),s(),a(3,"perun-web-apps-refresh-button",1),g("refresh",function(){return n.refreshTable()}),s(),f(4,Sn,3,3,"button",2)(5,In,5,8,"span",3),c(6,"async"),a(7,"app-group-roles-filter",4),g("filterRoles",function(v){return n.applyRoles(v)})("filterRoleTypes",function(v){return n.applyRoleTypes(v)}),s(),a(8,"perun-web-apps-debounce-filter",5),g("filter",function(v){return n.applyFilter(v)}),s(),a(9,"label",6),g("click",function(){return n.labelToggle()}),m(10),c(11,"translate"),s(),a(12,"mat-slide-toggle",7,8),g("change",function(){return n.selection.clear()})("ngModelChange",function(v){return n.showGroupList=v}),s(),a(14,"label",6),g("click",function(){return n.labelToggle()}),m(15),c(16,"translate"),s(),f(17,Tn,1,0,"ng-template",null,9,U),a(19,"div",10),f(20,An,2,2,"div",11),a(21,"div",12),f(22,xn,2,11,"perun-web-apps-groups-list",13),s()()),o&2){let u=G(18);p(),y(d(2,13,"MEMBER_DETAIL.GROUPS.TITLE")),p(3),l("ngIf",n.addAuth),p(),l("ngIf",Ae(21,Mn,d(6,15,n.removeAuth$))),p(2),l("hidden",!0)("theme","member-theme"),p(),l("placeholder","MEMBER_DETAIL.GROUPS.FILTER"),p(2),b(" ",d(11,17,"MEMBER_DETAIL.GROUPS.TREE_VIEW"),`
`),p(2),l("ngModel",n.showGroupList),p(3),b(" ",d(16,19,"MEMBER_DETAIL.GROUPS.LIST_VIEW"),`
`),p(5),l("ngIf",!n.showGroupList),p(),l("hidden",!n.showGroupList),p(),l("perunWebAppsLoader",n.loading)("perunWebAppsLoaderIndicator",u)}},dependencies:[P,ve,Be,z,Y,Xe,tt,K,Ne,W,et,J,Q,pe,V],styles:[".slide-label[_ngcontent-%COMP%]{display:inline;cursor:pointer}"]});let t=r;return t})();var yn=["toggle"];function Dn(t,r){if(t&1){let i=T();a(0,"button",12),g("click",function(){S(i);let o=_();return I(o.onCreateGroup())}),m(1),c(2,"translate"),s()}t&2&&(p(),b(" ",d(2,1,"GROUP_DETAIL.SUBGROUPS.CREATE_GROUP")," "))}function Ln(t,r){if(t&1){let i=T();a(0,"button",15),g("click",function(){S(i);let o=_(2);return I(o.deleteGroup())}),m(1),c(2,"translate"),s()}if(t&2){let i=_().ngIf,e=_();l("disabled",e.loading||e.selected.selected.length===0||!i.removeAuth),p(),b(" ",d(2,2,"GROUP_DETAIL.SUBGROUPS.DELETE_GROUP")," ")}}function wn(t,r){if(t&1&&(a(0,"span",13),c(1,"translate"),f(2,Ln,3,4,"button",14),s()),t&2){let i=r.ngIf,e=_();D("matTooltip",d(1,3,"GROUP_DETAIL.SUBGROUPS.DELETE_PERMISSION_HINT")),l("matTooltipDisabled",e.loading||e.selected.selected.length===0||i.removeAuth),p(2),l("ngIf",e.deleteAuth)}}function Gn(t,r){t&1&&E(0,"perun-web-apps-loading-table")}var On=()=>["nameWithId","description","menu"];function Pn(t,r){if(t&1){let i=T();a(0,"perun-web-apps-groups-tree",18),g("moveGroup",function(o){S(i);let n=_(2);return I(n.onMoveGroup(o))})("refreshTable",function(){S(i);let o=_(2);return I(o.refreshTable())}),s()}if(t&2){let i=_(2);l("loading",i.loading)("disableRouting",!i.routeAuth)("expandAll",i.filtering)("groups",i.groups)("displayedColumns",Z(8,On))("hideCheckbox",!i.deleteAuth)("filterValue",i.filterValue)("selection",i.selected)}}var Vn=()=>["select","id","name","description","menu"],Fn=()=>["id","name","description","menu"];function Bn(t,r){if(t&1){let i=T();a(0,"perun-web-apps-groups-list",19),g("groupMoved",function(o){S(i);let n=_(2);return I(n.onMoveGroup(o))})("refreshTable",function(){S(i);let o=_(2);return I(o.refreshTable())}),s()}if(t&2){let i=_(2);l("loading",i.loading)("disableMembers",!0)("disableRouting",!i.routeAuth)("displayedColumns",i.deleteAuth?Z(9,Vn):Z(10,Fn))("groups",i.groups)("selection",i.selected)("filter",i.filterValue)("tableId",i.tableId)("cacheSubject",i.cacheSubject)}}function Nn(t,r){if(t&1&&(a(0,"div"),f(1,Pn,1,9,"perun-web-apps-groups-tree",16)(2,Bn,1,11,"perun-web-apps-groups-list",17),s()),t&2){let i=_();p(),l("ngIf",!i.showGroupList),p(),l("ngIf",i.showGroupList)}}var kn=t=>({removeAuth:t}),Kl=(()=>{let r=class r{constructor(e,o,n,u,v,R,L){this.dialog=e,this.groupService=o,this.guiAuthResolver=n,this.entityStorageService=u,this.cacheHelperService=v,this.destroyRef=R,this.cd=L,this.groups=[],this.selected=new q(!0,[],!0,(M,k)=>M.id===k.id),this.selectedRoles=[],this.selectedRoleTypes=[],this.showGroupList=!1,this.filtering=!1,this.tableId=Ji,this.filterValue="",this.removeAuth$=this.selected.changed.pipe(_e(M=>M.source.selected.reduce((k,X)=>k&&this.guiAuthResolver.isAuthorized("deleteGroup_Group_boolean_policy",[X]),!0)),Ce(!0)),this.cacheSubject=new O(!0)}onCreateGroup(){let e=C();e.width="450px",e.data={parentGroup:this.group,theme:"group-theme"},this.dialog.open(Ut,e).afterClosed().subscribe(n=>{n&&(this.loading=!0,this.refreshTable())})}ngOnInit(){localStorage.getItem("preferedValue")==="list"&&(this.toggle.toggle(),this.selected.clear(),this.showGroupList=!0),this.toggle.change.subscribe(()=>{let e=this.toggle.checked?"list":"tree";localStorage.setItem("preferedValue",e)}),this.group=this.entityStorageService.getEntity(),this.setAuthRights(),this.refreshTable(),this.cacheHelperService.refreshComponentCachedData().pipe(H(this.destroyRef)).subscribe(e=>{e===r.id&&this.refreshTable()})}setAuthRights(){this.createAuth=this.guiAuthResolver.isAuthorized("createGroup_Group_Group_policy",[this.group]),this.deleteAuth=this.guiAuthResolver.isAuthorized("deleteGroups_List<Group>_boolean_policy",[this.group]),this.groups.length!==0&&(this.routeAuth=this.guiAuthResolver.isAuthorized("getGroupById_int_policy",[this.groups[0]]))}deleteGroup(){let e=C();e.width="450px",e.data={voId:this.group.id,groups:this.selected.selected,theme:"group-theme"},this.dialog.open(kt,e).afterClosed().subscribe(n=>{n&&this.refreshTable()})}labelToggle(){this.showGroupList=!this.showGroupList,this.refreshTable()}refreshTable(){this.loading=!0,this.groupService.getAllRichSubGroupsWithGroupAttributesByNames(this.group.id,[A.GROUP_DEF_MAIL_FOOTER,A.GROUP_SYNC_ENABLED,A.GROUP_LAST_SYNC_STATE,A.GROUP_LAST_SYNC_TIMESTAMP,A.GROUP_STRUCTURE_SYNC_ENABLED,A.GROUP_LAST_STRUCTURE_SYNC_STATE,A.GROUP_LAST_STRUCTURE_SYNC_TIMESTAMP],this.selectedRoles,this.selectedRoleTypes).subscribe(e=>{this.groups=e,this.cacheSubject.next(!0),this.selected.clear(),this.setAuthRights(),this.loading=!1})}applyFilter(e){this.filterValue=e,this.filtering=e!=="",this.selected.clear()}applyRoles(e){this.selectedRoles=e,this.refreshTable()}applyRoleTypes(e){this.selectedRoleTypes=e,this.refreshTable()}onMoveGroup(e){let o=C();o.width="550px",o.data={group:e,theme:"group-theme"},this.dialog.open(jt,o).afterClosed().subscribe(u=>{u&&this.refreshTable()})}};r.id="GroupSubgroupsComponent",r.\u0275fac=function(o){return new(o||r)(h(B),h(de),h(F),h(N),h($),h(j),h(ct))},r.\u0275cmp=x({type:r,selectors:[["app-group-subgroups"]],viewQuery:function(o,n){if(o&1&&ne(yn,7),o&2){let u;re(u=ae())&&(n.toggle=u.first)}},hostVars:2,hostBindings:function(o,n){o&2&&w("router-component",n.true)},decls:22,vars:20,consts:[[1,"page-subtitle"],[3,"refresh"],["class","me-2 action-button","color","accent","data-cy","new-subgroup-button","mat-flat-button","",3,"click",4,"ngIf"],[3,"matTooltipDisabled","matTooltip",4,"ngIf"],[3,"theme","filterRoles","filterRoleTypes"],[3,"placeholder","filter"],[1,"slide-label",3,"click"],["labelPosition","before",1,"me-1",3,"ngModel","change","ngModelChange"],["toggle",""],["spinner",""],[1,"position-relative","mt-3","table-min-height"],[4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],["color","accent","data-cy","new-subgroup-button","mat-flat-button","",1,"me-2","action-button",3,"click"],[3,"matTooltipDisabled","matTooltip"],["color","warn","class","me-2","data-cy","delete-group-button","mat-flat-button","",3,"disabled","click",4,"ngIf"],["color","warn","data-cy","delete-group-button","mat-flat-button","",1,"me-2",3,"disabled","click"],[3,"loading","disableRouting","expandAll","groups","displayedColumns","hideCheckbox","filterValue","selection","moveGroup","refreshTable",4,"ngIf"],[3,"loading","disableMembers","disableRouting","displayedColumns","groups","selection","filter","tableId","cacheSubject","groupMoved","refreshTable",4,"ngIf"],[3,"loading","disableRouting","expandAll","groups","displayedColumns","hideCheckbox","filterValue","selection","moveGroup","refreshTable"],[3,"loading","disableMembers","disableRouting","displayedColumns","groups","selection","filter","tableId","cacheSubject","groupMoved","refreshTable"]],template:function(o,n){if(o&1&&(a(0,"div")(1,"h1",0),m(2),c(3,"translate"),s(),a(4,"perun-web-apps-refresh-button",1),g("refresh",function(){return n.refreshTable()}),s(),f(5,Dn,3,3,"button",2)(6,wn,3,5,"span",3),c(7,"async"),a(8,"app-group-roles-filter",4),g("filterRoles",function(v){return n.applyRoles(v)})("filterRoleTypes",function(v){return n.applyRoleTypes(v)}),s(),a(9,"perun-web-apps-debounce-filter",5),g("filter",function(v){return n.applyFilter(v)}),s(),a(10,"label",6),g("click",function(){return n.labelToggle()}),m(11),c(12,"translate"),s(),a(13,"mat-slide-toggle",7,8),g("change",function(){return n.selected.clear()})("ngModelChange",function(v){return n.showGroupList=v}),s(),a(15,"label",6),g("click",function(){return n.labelToggle()}),m(16),c(17,"translate"),s(),f(18,Gn,1,0,"ng-template",null,9,U),a(20,"div",10),f(21,Nn,3,2,"div",11),s()()),o&2){let u=G(19);p(2),y(d(3,10,"GROUP_DETAIL.SUBGROUPS.TITLE")),p(3),l("ngIf",n.createAuth),p(),l("ngIf",Ae(18,kn,d(7,12,n.removeAuth$))),p(2),l("theme","group-theme"),p(),l("placeholder","GROUP_DETAIL.SUBGROUPS.FILTER"),p(2),b(" ",d(12,14,"GROUP_DETAIL.SUBGROUPS.TREE_VIEW")," "),p(2),l("ngModel",n.showGroupList),p(3),b(" ",d(17,16,"GROUP_DETAIL.SUBGROUPS.LIST_VIEW")," "),p(5),l("perunWebAppsLoader",n.loading)("perunWebAppsLoaderIndicator",u)}},dependencies:[P,ve,Be,z,Y,Xe,tt,K,Ne,W,et,J,Q,pe,V],styles:[".slide-label[_ngcontent-%COMP%]{display:inline;cursor:pointer}"]});let t=r;return t})();var mm=(()=>{let r=class r{constructor(e,o,n,u,v,R){this.entityStorageService=e,this.attributeService=o,this.dialog=n,this.authResolver=u,this.cacheHelperService=v,this.destroyRef=R,this.authRights={approve:!1,reject:!1,delete:!1,resend:!1,columnSettings:!1},this.tableId=Qi,this.detailTableId=Ki,this.fedAttrs=[]}ngOnInit(){this.vo=this.entityStorageService.getEntity(),this.setAuthRights(),this.attributeService.getIdpAttributeDefinitions().subscribe(e=>{e.forEach(o=>{this.fedAttrs.includes(o)||this.fedAttrs.push(o),this.viewPreferences$=this.attributeService.getVoAttributeByName(this.vo.id,"urn:perun:vo:attribute-def:def:applicationViewPreferences")})}),this.cacheHelperService.refreshComponentCachedData().pipe(H(this.destroyRef)).subscribe(e=>{e===r.id&&this.applicationActions.refreshTable()})}setColumns(){let e=C();e.width="650px",e.data={columns:[],voId:this.vo.id,theme:"vo-theme"},this.dialog.open(qt,e).afterClosed().subscribe(n=>{n&&(this.viewPreferences$=this.attributeService.getVoAttributeByName(this.vo.id,"urn:perun:vo:attribute-def:def:applicationViewPreferences"))})}setAuthRights(){this.authRights.approve=this.authResolver.isAuthorized("vo-approveApplicationInternal_int_policy",[this.vo]),this.authRights.reject=this.authResolver.isAuthorized("vo-rejectApplication_int_String_policy",[this.vo]),this.authRights.delete=this.authResolver.isAuthorized("vo-deleteApplication_Application_policy",[this.vo]),this.authRights.resend=this.authResolver.isAuthorized("vo-sendMessage_Application_MailType_String_policy",[this.vo])}};r.id="VoApplicationsComponent",r.\u0275fac=function(o){return new(o||r)(h(N),h(Le),h(B),h(F),h($),h(j))},r.\u0275cmp=x({type:r,selectors:[["app-vo-applications"]],viewQuery:function(o,n){if(o&1&&ne(ke,5),o&2){let u;re(u=ae())&&(n.applicationActions=u.first)}},hostVars:2,hostBindings:function(o,n){o&2&&w("router-component",n.true)},decls:2,vars:9,consts:[[3,"theme","vo","authRights","tableId","detailTableId","fedAttrs","viewPreferences","changeView"]],template:function(o,n){o&1&&(a(0,"app-application-actions",0),g("changeView",function(){return n.setColumns()}),c(1,"async"),s()),o&2&&l("theme","vo-theme")("vo",n.vo)("authRights",n.authRights)("tableId",n.tableId)("detailTableId",n.detailTableId)("fedAttrs",n.fedAttrs)("viewPreferences",d(1,7,n.viewPreferences$))},dependencies:[ke,pe]});let t=r;return t})();var Cm=(()=>{let r=class r{constructor(e,o,n,u,v,R){this.entityStorageService=e,this.attributeService=o,this.dialog=n,this.authResolver=u,this.cacheHelperService=v,this.destroyRef=R,this.authRights={approve:!1,reject:!1,delete:!1,resend:!1,columnSettings:!1},this.tableId=Yi,this.detailTableId=qi,this.fedAttrs=[]}ngOnInit(){this.group=this.entityStorageService.getEntity(),this.setAuthRights(),this.attributeService.getIdpAttributeDefinitions().subscribe(e=>{e.forEach(o=>{this.fedAttrs.includes(o)||this.fedAttrs.push(o),this.viewPreferences$=this.attributeService.getGroupAttributeByName(this.group.id,"urn:perun:group:attribute-def:def:applicationViewPreferences")})}),this.cacheHelperService.refreshComponentCachedData().pipe(H(this.destroyRef)).subscribe(e=>{e===r.id&&this.applicationActions.refreshTable()})}setColumns(){let e=C();e.width="650px",e.data={columns:[],groupId:this.group.id,voId:this.group.voId,theme:"group-theme"},this.dialog.open(qt,e).afterClosed().subscribe(n=>{n&&(this.viewPreferences$=this.attributeService.getGroupAttributeByName(this.group.id,"urn:perun:group:attribute-def:def:applicationViewPreferences"))})}setAuthRights(){this.authRights.approve=this.authResolver.isAuthorized("group-approveApplicationInternal_int_policy",[this.group]),this.authRights.reject=this.authResolver.isAuthorized("group-rejectApplication_int_String_policy",[this.group]),this.authRights.delete=this.authResolver.isAuthorized("group-deleteApplication_Application_policy",[this.group]),this.authRights.resend=this.authResolver.isAuthorized("group-sendMessage_Application_MailType_String_policy",[this.group])}};r.id="GroupApplicationsComponent",r.\u0275fac=function(o){return new(o||r)(h(N),h(Le),h(B),h(F),h($),h(j))},r.\u0275cmp=x({type:r,selectors:[["app-group-applications"]],viewQuery:function(o,n){if(o&1&&ne(ke,5),o&2){let u;re(u=ae())&&(n.applicationActions=u.first)}},hostVars:2,hostBindings:function(o,n){o&2&&w("router-component",n.true)},decls:2,vars:9,consts:[[3,"theme","group","authRights","tableId","detailTableId","fedAttrs","viewPreferences","changeView"]],template:function(o,n){o&1&&(a(0,"app-application-actions",0),g("changeView",function(){return n.setColumns()}),c(1,"async"),s()),o&2&&l("theme","group-theme")("group",n.group)("authRights",n.authRights)("tableId",n.tableId)("detailTableId",n.detailTableId)("fedAttrs",n.fedAttrs)("viewPreferences",d(1,7,n.viewPreferences$))},dependencies:[ke,pe]});let t=r;return t})();var Po=(()=>{let r=class r{constructor(e,o,n,u,v,R,L,M,k,X,fe){this.data=e,this.dialogRef=o,this.membersManagerService=n,this.voService=u,this.registrarManager=v,this.groupService=R,this.store=L,this.guiAuthResolver=M,this.requestService=k,this.addMemberService=X,this.notificator=fe,this.loading=!1,this.searcher=new at,this.members=this.searcher.pipe(je(Pe=>De(ye(null),this.voService.getCompleteCandidatesForGroup(this.data.group.id,this.attrNames,Pe))),Ce(void 0)),this.failed=[],this.selection=new q(!0,[],!0,(Pe,Ue)=>Pe.richUser?.id===Ue.richUser?.id&&Pe.member?.id===Ue.member?.id),this.cachedSubject=new O(!0),this.attrNames=[A.USER_DEF_ORGANIZATION,A.USER_DEF_PREFERRED_MAIL].concat(this.store.getLoginAttributeNames()),this.languages=this.store.getProperty("supported_languages"),this.addMemberService.setDialogRef(this.dialogRef),this.addMemberService.setType("group")}ngOnInit(){this.inviteAuth=this.guiAuthResolver.isAuthorized("group-sendInvitation_Vo_Group_User_policy",[this.data.group]),this.selection.changed.subscribe(e=>{e.source.selected.every(o=>o.member)?this.addAuth=!0:this.addAuth=this.guiAuthResolver.isAuthorized("createMember_Vo_User_List<Group>_policy",[this.data.group])&&this.guiAuthResolver.isAuthorized("createMember_Vo_Candidate_List<Group>_policy",[this.data.group])}),this.registrarManager.invitationFormExists(this.data.group.voId,this.data.group.id).subscribe(e=>{this.showInvite=e})}add(){this.loading=!0,this.membersManagerService.addMemberCandidates({candidates:this.addMemberService.convertToMemberCandidates(this.selection.selected),vo:this.data.group.voId,group:this.data.group.id}).subscribe({next:()=>{this.addMemberService.success("DIALOGS.ADD_MEMBERS.SUCCESS_ADD")},error:e=>{this.loading=!1,this.notificator.showRPCError(e)}})}invite(e){this.loading=!0,this.registrarManager.inviteMemberCandidates({candidates:this.addMemberService.convertToMemberCandidates(this.selection.selected),vo:this.data.group.voId,lang:e,group:this.data.group.id}).subscribe({next:()=>{this.addMemberService.success("DIALOGS.ADD_MEMBERS.SUCCESS_INVITE")},error:o=>{this.loading=!1,this.notificator.showRPCError(o)}})}cancel(e){this.dialogRef.close(e)}};r.\u0275fac=function(o){return new(o||r)(h(bt),h(gt),h(ge),h(ze),h(be),h(de),h(we),h(F),h(Ie),h(zt),h(le))},r.\u0275cmp=x({type:r,selectors:[["app-group-add-member-dialog"]],decls:2,vars:13,consts:[[3,"showInvite","loading","languages","manualAddingBlocked","addAuth","inviteAuth","failed","members","selection","cachedSubject","theme","add","cancel","invite","search"]],template:function(o,n){o&1&&(a(0,"app-add-member-dialog",0),g("add",function(){return n.add()})("cancel",function(v){return n.cancel(v)})("invite",function(v){return n.invite(v)})("search",function(v){return n.searcher.next(v)}),c(1,"async"),s()),o&2&&l("showInvite",n.showInvite)("loading",n.loading)("languages",n.languages)("manualAddingBlocked",n.data.manualAddingBlocked)("addAuth",n.addAuth)("inviteAuth",n.inviteAuth)("failed",n.failed)("members",d(1,11,n.members))("selection",n.selection)("cachedSubject",n.cachedSubject)("theme","group-theme")}});let t=r;return t})();function jn(t,r){t&1&&(a(0,"perun-web-apps-alert",19),m(1),c(2,"translate"),s()),t&2&&(p(),b(" ",d(2,1,"GROUP_DETAIL.MEMBERS.ACTIONS_DISABLED"),`
`))}function Hn(t,r){if(t&1){let i=T();a(0,"button",20),g("click",function(){S(i);let o=_();return I(o.onAddMember())}),c(1,"groupMembersActionButtonDisabled"),m(2),c(3,"translate"),s()}if(t&2){let i=_();l("disabled",Ve(1,2,i.group,"add")),p(2),b(" ",d(3,5,"GROUP_DETAIL.MEMBERS.ADD_MEMBER")," ")}}function $n(t,r){if(t&1&&(a(0,"button",21),c(1,"groupMembersActionButtonDisabled"),m(2),c(3,"translate"),s()),t&2){let i=_(),e=G(18);l("disabled",d(1,3,i.group)||i.inviteDisabled&&i.preApprovedInviteDisabled)("matMenuTriggerFor",e),p(2),b(" ",d(3,5,"GROUP_DETAIL.MEMBERS.INVITE")," ")}}function zn(t,r){if(t&1){let i=T();a(0,"button",22),g("click",function(){S(i);let o=_();return I(o.onInviteMember())}),c(1,"groupMembersActionButtonDisabled"),m(2),c(3,"translate"),s()}if(t&2){let i=_();l("disabled",d(1,2,i.group)||i.inviteDisabled),p(2),b(" ",d(3,4,"GROUP_DETAIL.MEMBERS.INVITE_ONE")," ")}}function Wn(t,r){if(t&1){let i=T();a(0,"button",22),g("click",function(){S(i);let o=_();return I(o.onInvitePreapprovedMember())}),c(1,"groupMembersActionButtonDisabled"),m(2),c(3,"translate"),s()}if(t&2){let i=_();l("disabled",d(1,2,i.group)||i.preApprovedInviteDisabled),p(2),b(" ",d(3,4,"GROUP_DETAIL.MEMBERS.INVITE_ONE_PREAPPROVED")," ")}}function qn(t,r){if(t&1){let i=T();a(0,"button",22),g("click",function(){S(i);let o=_();return I(o.onBulkInvite())}),c(1,"groupMembersActionButtonDisabled"),m(2),c(3,"translate"),s()}if(t&2){let i=_();l("disabled",d(1,2,i.group)||i.inviteDisabled),p(2),b(" ",d(3,4,"GROUP_DETAIL.MEMBERS.INVITE_BULK")," ")}}function Yn(t,r){if(t&1){let i=T();a(0,"button",22),g("click",function(){S(i);let o=_();return I(o.onBulkPreapprovedInvite())}),c(1,"groupMembersActionButtonDisabled"),m(2),c(3,"translate"),s()}if(t&2){let i=_();l("disabled",d(1,2,i.group)||i.preApprovedInviteDisabled),p(2),b(" ",d(3,4,"GROUP_DETAIL.MEMBERS.INVITE_BULK_PREAPPROVED")," ")}}function Qn(t,r){if(t&1){let i=T();a(0,"button",23),g("click",function(){S(i);let o=_();return I(o.copyInvitationLink())}),c(1,"groupMembersActionButtonDisabled"),a(2,"mat-icon"),m(3,"file_copy"),s(),a(4,"span",24),m(5),c(6,"translate"),s()()}if(t&2){let i=_();l("disabled",d(1,2,i.group)||i.copyInvitationDisabled),p(5),b(" ",d(6,4,"GROUP_DETAIL.MEMBERS.COPY_INVITATION_LINK")," ")}}function Kn(t,r){if(t&1){let i=T();a(0,"button",25),g("click",function(){S(i);let o=_();return I(o.onCopyMembers())}),m(1),c(2,"translate"),s()}if(t&2){let i=_();l("disabled",i.copyDisabled),p(),b(" ",d(2,2,"GROUP_DETAIL.MEMBERS.COPY_MEMBERS")," ")}}function Xn(t,r){if(t&1){let i=T();a(0,"button",26),g("click",function(){S(i);let o=_();return I(o.onRemoveMembers())}),c(1,"async"),c(2,"groupMembersActionButtonDisabled"),m(3),c(4,"translate"),s()}if(t&2){let i=_();l("disabled",d(1,2,i.loading$)||i.selection.isEmpty()||d(2,4,i.group)),p(3),b(" ",d(4,6,"GROUP_DETAIL.MEMBERS.REMOVE_MEMBERS")," ")}}function Zn(t,r){if(t&1&&(a(0,"mat-option",27),m(1),c(2,"memberStatus"),s()),t&2){let i=r.$implicit;l("value",i),p(),y(d(2,2,i))}}function Jn(t,r){if(t&1&&(a(0,"mat-option",27),m(1),c(2,"memberStatus"),s()),t&2){let i=r.$implicit;l("value",i),p(),y(d(2,2,i))}}function er(t,r){t&1&&E(0,"perun-web-apps-loading-table")}function tr(t,r){if(t&1){let i=T();a(0,"perun-web-apps-members-list",28),g("queryChanged",function(o){S(i);let n=_();return I(n.nextPage.next(o))})("refreshTable",function(){S(i);let o=_();return I(o.refreshTable())})("downloadAll",function(o){S(i);let n=_();return I(n.downloadAll(o))}),c(1,"async"),c(2,"async"),s()}if(t&2){let i=_();l("loading",d(1,10,i.loading$))("displayedColumns",i.displayedColumns)("groupId",i.group.id)("voId",i.group.voId)("isMembersGroup",i.group.name==="members")("members",d(2,12,i.membersPage$))("selection",i.selection)("filter",i.searchString)("tableId",i.tableId)("cacheSubject",i.cacheSubject)}}var Ec=(()=>{let r=class r{constructor(e,o,n,u,v,R,L,M,k,X,fe,Pe,Ue,Jt){this.groupService=e,this.registrarService=o,this.dialog=n,this.guiAuthResolver=u,this.storeService=v,this.attributesManager=R,this.apiRequest=L,this.notificator=M,this.entityStorageService=k,this.cacheHelperService=X,this.clipboard=fe,this.membersService=Pe,this.membersListService=Ue,this.destroyRef=Jt,this.selection=new q(!0,[],!0,(ei,ti)=>ei.id===ti.id),this.synchEnabled=!1,this.searchString="",this.updateTable=!1,this.tableId=zi,this.memberAttrNames=[A.MEMBER_DEF_ORGANIZATION,A.MEMBER_DEF_MAIL,A.USER_DEF_ORGANIZATION,A.USER_DEF_PREFERRED_MAIL,A.MEMBER_DEF_EXPIRATION,A.MEMBER_DEF_GROUP_EXPIRATION,A.MEMBER_LIFECYCLE_ALTERABLE],this.inviteDisabled=!0,this.preApprovedInviteDisabled=!0,this.copyInvitationDisabled=!0,this.copyDisabled=!1,this.displayedColumns=["checkbox","id","type","fullName","status","groupStatus","organization","email","logins"],this.statuses=new ot([""]),this.statusList=["VALID","INVALID","EXPIRED","DISABLED"],this.selectedStatuses=["VALID","INVALID"],this.groupStatuses=new ot([""]),this.groupStatusList=["VALID","EXPIRED"],this.selectedGroupStatuses=["VALID"],this.nextPage=new O({}),this.loadingSubject$=new O(!1),this.cacheSubject=new O(!0),this.loading$=De(this.loadingSubject$,this.nextPage.pipe(_e(()=>!0))),this.groupAttrNames=[A.GROUP_SYNC_ENABLED,A.GROUP_LAST_SYNC_STATE,A.GROUP_LAST_SYNC_TIMESTAMP,A.GROUP_STRUCTURE_SYNC_ENABLED,A.GROUP_LAST_STRUCTURE_SYNC_STATE,A.GROUP_LAST_STRUCTURE_SYNC_TIMESTAMP,A.GROUP_BLOCK_MANUAL_MEMBER_ADDING]}ngOnInit(){this.statuses.setValue(this.selectedStatuses),this.groupStatuses.setValue(this.selectedGroupStatuses),this.memberAttrNames=this.memberAttrNames.concat(this.storeService.getLoginAttributeNames()),this.group=this.entityStorageService.getEntity(),this.membersPage$=this.membersListService.nextPageHandler(this.nextPage,this.membersService,this.group.voId,this.memberAttrNames,this.statuses,this.group.id,this.groupStatuses,this.selection,this.loadingSubject$),this.setAuthRights(),this.isManualAddingBlocked(this.group.voId).then(()=>this.loadPage(this.group.id)),this.isCopyMembersDisabled(),this.cacheHelperService.refreshComponentCachedData().pipe(H(this.destroyRef)).subscribe(e=>{e===r.id&&this.refreshTable()})}loadPage(e){this.groupService.getRichGroupByIdWithAttributesByNames(e,this.groupAttrNames).subscribe(o=>{this.group=o,this.synchEnabled=Gi(this.group)})}setAuthRights(){this.addAuth=this.guiAuthResolver.isAuthorized("addMembers_Group_List<Member>_policy",[this.group]),this.removeAuth=this.guiAuthResolver.isAuthorized("removeMembers_Group_List<Member>_policy",[this.group]),this.displayedColumns=this.removeAuth?this.displayedColumns:["id","type","fullName","status","groupStatus","organization","email","logins"],this.inviteAuth=this.guiAuthResolver.isAuthorized("group-sendInvitation_Vo_Group_String_String_String_policy",[this.group]),this.preApprovedInviteAuth=this.guiAuthResolver.isAuthorized("inviteToGroup_Vo_Group_String_String_String_LocalDate_String_policy",[this.group]),this.copyAuth=this.guiAuthResolver.isAuthorized("source-copyMembers_Group_List<Group>_List<Member>_boolean_policy",[this.group]),this.inviteAuth&&(this.registrarService.isInvitationEnabled(this.group.voId,this.group.id).subscribe(e=>{this.inviteDisabled=!e}),this.registrarService.isLinkInvitationEnabled(this.group.voId,this.group.id).subscribe(e=>{this.copyInvitationDisabled=!e})),this.preApprovedInviteAuth&&this.registrarService.isPreApprovedInvitationEnabled(this.group.voId,this.group.id).subscribe(e=>{this.preApprovedInviteDisabled=!e})}onSearchByString(e){this.searchString=e,this.refreshTable()}onAddMember(){let e=C();e.width="1000px",e.data={group:this.group,manualAddingBlocked:this.blockManualMemberAdding},this.dialog.open(Po,e).afterClosed().subscribe(n=>{n&&this.refreshTable()})}onRemoveMembers(){let e=C();e.width="450px",e.data={groupId:this.group.id,members:this.selection.selected,theme:"group-theme"},this.dialog.open(Ht,e).afterClosed().subscribe(n=>{n&&this.refreshTable()})}onInviteMember(){let e=C();e.width="650px",e.data={voId:this.group.voId,groupId:this.group.id,theme:"group-theme"},this.dialog.open($t,e)}onInvitePreapprovedMember(){let e=C();e.width="650px",e.data={voId:this.group.voId,groupId:this.group.id,theme:"group-theme"},this.dialog.open(ho,e)}onBulkInvite(){let e=C();e.width="650px",e.data={voId:this.group.voId,groupId:this.group.id,theme:"group-theme"},this.dialog.open(Wt,e)}onBulkPreapprovedInvite(){let e=C();e.width="650px",e.data={voId:this.group.voId,groupId:this.group.id,theme:"group-theme"},this.dialog.open(fo,e)}copyInvitationLink(){(this.invitationLink?ye(this.invitationLink):this.registrarService.buildInviteURL(this.group.voId,this.group.id).pipe(st(o=>(this.invitationLink=o,ye(this.invitationLink))))).subscribe(o=>{this.clipboard.copy(o),this.notificator.showSuccess("GROUP_DETAIL.MEMBERS.COPY_INVITATION_LINK_SUCCESS")})}onCopyMembers(){let e=C();e.width="650px",e.data={voId:this.group.voId,groupId:this.group.id,theme:"group-theme",members:this.selection.selected},this.dialog.open(_o,e).afterClosed().subscribe(n=>{n&&this.selection.clear()})}displaySelectedStatuses(){if(this.selectedStatuses.length===this.statusList.length)return"ALL";let e=this.statuses.value;return e?`${e[0]}  ${e.length>1?"(+"+(e.length-1).toString()+" "+(e.length===2?"other)":"others)"):""}`:""}displaySelectedGroupStatuses(){return this.selectedGroupStatuses.length===this.groupStatusList.length?"ALL":`${this.groupStatuses.value[0]}`}isManualAddingBlocked(e){return new Promise(o=>{this.apiRequest.dontHandleErrorForNext(),this.attributesManager.getVoAttributeByName(e,"urn:perun:vo:attribute-def:def:blockManualMemberAdding").subscribe({next:n=>{this.blockManualMemberAdding=n.value!==null,o()},error:n=>{n.name!=="PrivilegeException"&&this.notificator.showError(n.name),o()}})})}isCopyMembersDisabled(){this.copyDisabled=!0,this.groupService.getGroupDirectMembersCount(this.group.id).subscribe({next:e=>{this.copyDisabled=e===0},error:()=>{this.copyDisabled=!0}})}changeVoStatuses(){this.selectedStatuses=this.statuses.value,this.refreshTable()}changeGroupStatuses(){this.selectedGroupStatuses=this.groupStatuses.value,this.refreshTable()}refreshTable(){this.cacheSubject.next(!0),this.nextPage.next(this.nextPage.value),this.isCopyMembersDisabled()}downloadAll(e){let o=this.nextPage.getValue(),n=C();n.width="500px";let u=this.dialog.open(Ft,n),v=this.membersService.getMembersPage({vo:this.group.voId,attrNames:this.memberAttrNames,query:{order:o.order,pageSize:e.length,offset:0,sortColumn:this.membersListService.getSortColumn(o.sortColumn),searchString:o.searchString,groupId:this.group.id,statuses:this.statuses.value,groupStatuses:this.groupStatuses?.value}}).subscribe({next:R=>{u.close(),Je(Ze(R.data,this.displayedColumns,e.getDataForColumnFun),e.format)},error:R=>{this.notificator.showRPCError(R),u.close()}});u.afterClosed().subscribe(()=>{v&&v.unsubscribe()})}};r.id="GroupMembersComponent",r.\u0275fac=function(o){return new(o||r)(h(de),h(be),h(B),h(F),h(we),h(Le),h(Ie),h(le),h(N),h($),h(Vt),h(ge),h(Ot),h(j))},r.\u0275cmp=x({type:r,selectors:[["app-group-members"]],hostVars:2,hostBindings:function(o,n){o&2&&w("router-component",n.true)},decls:66,vars:95,consts:[[1,"page-subtitle"],["alert_type","warn",4,"ngIf"],[1,"align-elements"],[3,"click"],[3,"matTooltipDisabled","matTooltipPosition","matTooltip"],["class","me-2 action-button","color","accent","data-cy","add-members","mat-flat-button","",3,"disabled","click",4,"ngIf"],["class","me-2 dropdown-toggle","color","accent","mat-flat-button","",3,"disabled","matMenuTriggerFor",4,"ngIf"],["menu","matMenu"],["class","action-button","mat-menu-item","",3,"disabled","click",4,"ngIf"],["class","me-2","mat-stroked-button","",3,"disabled","click",4,"ngIf"],["class","me-2","color","accent","mat-flat-button","",3,"disabled","click",4,"ngIf"],["class","me-2","color","warn","data-cy","remove-members","mat-flat-button","",3,"disabled","click",4,"ngIf"],[1,"me-2","fix-select"],["multiple","",3,"formControl","closed"],["class","group-theme",3,"value",4,"ngFor","ngForOf"],[1,"mt-2","search-field",3,"placeholder","filter"],["spinner",""],[1,"position-relative","table-min-height"],[3,"loading","displayedColumns","groupId","voId","isMembersGroup","members","selection","filter","tableId","cacheSubject","queryChanged","refreshTable","downloadAll",4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],["alert_type","warn"],["color","accent","data-cy","add-members","mat-flat-button","",1,"me-2","action-button",3,"disabled","click"],["color","accent","mat-flat-button","",1,"me-2","dropdown-toggle",3,"disabled","matMenuTriggerFor"],["mat-menu-item","",1,"action-button",3,"disabled","click"],["mat-stroked-button","",1,"me-2",3,"disabled","click"],[1,"ms-1"],["color","accent","mat-flat-button","",1,"me-2",3,"disabled","click"],["color","warn","data-cy","remove-members","mat-flat-button","",1,"me-2",3,"disabled","click"],[1,"group-theme",3,"value"],[3,"loading","displayedColumns","groupId","voId","isMembersGroup","members","selection","filter","tableId","cacheSubject","queryChanged","refreshTable","downloadAll"]],template:function(o,n){if(o&1&&(a(0,"h1",0),m(1),c(2,"translate"),s(),f(3,jn,3,3,"perun-web-apps-alert",1),a(4,"div",2)(5,"perun-web-apps-refresh-button",3),g("click",function(){return n.refreshTable()}),s(),a(6,"span",4),c(7,"groupMembersActionButtonDisabled"),c(8,"translate"),c(9,"groupMembersActionButtonDisabledTooltip"),f(10,Hn,4,7,"button",5),s(),a(11,"span",4),c(12,"groupMembersActionButtonDisabled"),c(13,"translate"),c(14,"translate"),c(15,"groupMembersActionButtonDisabledTooltip"),f(16,$n,4,7,"button",6),a(17,"mat-menu",null,7)(19,"span",4),c(20,"translate"),f(21,zn,4,6,"button",8),s(),a(22,"span",4),c(23,"translate"),f(24,Wn,4,6,"button",8),s(),a(25,"span",4),c(26,"translate"),f(27,qn,4,6,"button",8),s(),a(28,"span",4),c(29,"translate"),f(30,Yn,4,6,"button",8),s()()(),a(31,"span",4),c(32,"translate"),f(33,Qn,7,6,"button",9),s(),a(34,"span",4),c(35,"translate"),f(36,Kn,3,4,"button",10),s(),a(37,"span",4),c(38,"groupMembersActionButtonDisabled"),c(39,"translate"),c(40,"groupMembersActionButtonDisabledTooltip"),f(41,Xn,5,8,"button",11),s(),a(42,"mat-form-field",12)(43,"mat-label"),m(44),c(45,"translate"),s(),a(46,"mat-select",13),g("closed",function(){return n.changeVoStatuses()}),a(47,"mat-select-trigger"),m(48),c(49,"memberStatus"),s(),f(50,Zn,3,4,"mat-option",14),s()(),a(51,"mat-form-field",12)(52,"mat-label"),m(53),c(54,"translate"),s(),a(55,"mat-select",13),g("closed",function(){return n.changeGroupStatuses()}),a(56,"mat-select-trigger"),m(57),c(58,"memberStatus"),s(),f(59,Jn,3,4,"mat-option",14),s()(),a(60,"perun-web-apps-debounce-filter",15),g("filter",function(v){return n.onSearchByString(v)}),s()(),f(61,er,1,0,"ng-template",null,16,U),a(63,"div",17),f(64,tr,3,14,"perun-web-apps-members-list",18),c(65,"async"),s()),o&2){let u=G(62);p(),y(d(2,49,"GROUP_DETAIL.MEMBERS.TITLE")),p(2),l("ngIf",n.synchEnabled),p(3),D("matTooltip",d(8,54,Ve(9,56,n.group,"add"))),l("matTooltipDisabled",!Ve(7,51,n.group,"add"))("matTooltipPosition","above"),p(4),l("ngIf",n.addAuth),p(),D("matTooltip",n.inviteDisabled&&n.preApprovedInviteDisabled?d(13,61,"GROUP_DETAIL.MEMBERS.INVITE_BUTTON_DISABLED"):d(14,63,d(15,65,n.group))),l("matTooltipDisabled",!(d(12,59,n.group)||n.inviteDisabled&&n.preApprovedInviteDisabled))("matTooltipPosition","above"),p(5),l("ngIf",n.inviteAuth),p(3),D("matTooltip",d(20,67,"GROUP_DETAIL.MEMBERS.INVITE_DISABLED")),l("matTooltipDisabled",!n.inviteDisabled)("matTooltipPosition","right"),p(2),l("ngIf",n.inviteAuth),p(),D("matTooltip",d(23,69,"GROUP_DETAIL.MEMBERS.PREAPPROVED_INVITE_DISABLED")),l("matTooltipDisabled",!n.preApprovedInviteDisabled)("matTooltipPosition","right"),p(2),l("ngIf",n.preApprovedInviteAuth),p(),D("matTooltip",d(26,71,"GROUP_DETAIL.MEMBERS.INVITE_DISABLED")),l("matTooltipDisabled",!n.inviteDisabled)("matTooltipPosition","right"),p(2),l("ngIf",n.inviteAuth),p(),D("matTooltip",d(29,73,"GROUP_DETAIL.MEMBERS.PREAPPROVED_INVITE_DISABLED")),l("matTooltipDisabled",!n.preApprovedInviteDisabled)("matTooltipPosition","right"),p(2),l("ngIf",n.preApprovedInviteAuth),p(),D("matTooltip",d(32,75,"GROUP_DETAIL.MEMBERS.COPY_INVITATION_LINK_DISABLED")),l("matTooltipDisabled",!n.copyInvitationDisabled)("matTooltipPosition","above"),p(2),l("ngIf",n.inviteAuth),p(),D("matTooltip",d(35,77,"GROUP_DETAIL.MEMBERS.COPY_MEMBERS_DISABLED")),l("matTooltipDisabled",!n.copyDisabled)("matTooltipPosition","above"),p(2),l("ngIf",n.copyAuth),p(),D("matTooltip",d(39,81,d(40,83,n.group))),l("matTooltipDisabled",!d(38,79,n.group))("matTooltipPosition","above"),p(4),l("ngIf",n.removeAuth),p(3),y(d(45,85,"GROUP_DETAIL.MEMBERS.FILTER_STATUS")),p(2),l("formControl",n.statuses),p(2),b(" ",d(49,87,n.displaySelectedStatuses())," "),p(2),l("ngForOf",n.statusList),p(3),y(d(54,89,"GROUP_DETAIL.MEMBERS.FILTER_GROUP_STATUS")),p(2),l("formControl",n.groupStatuses),p(2),b(" ",d(58,91,n.displaySelectedGroupStatuses())," "),p(2),l("ngForOf",n.groupStatusList),p(),l("placeholder","GROUP_DETAIL.MEMBERS.SEARCH_DESCRIPTION"),p(4),l("perunWebAppsLoader",d(65,93,n.loading$))("perunWebAppsLoaderIndicator",u)}},dependencies:[Fe,P,ft,It,St,ve,vt,Se,z,wt,Gt,Y,Qe,Ye,Ke,Ge,K,W,Nt,J,Q,pe,V,Pt,ki,Ui],styles:[".search-field[_ngcontent-%COMP%]{width:325px}.fix-select[_ngcontent-%COMP%]{margin-top:8px}"]});let t=r;return t})();var or=["list"];function nr(t,r){if(t&1){let i=T();a(0,"button",8),g("click",function(){S(i);let o=_();return I(o.addResource())}),m(1),c(2,"translate"),s()}t&2&&(p(),b(" ",d(2,1,"GROUP_DETAIL.RESOURCES.ADD")," "))}function rr(t,r){t&1&&E(0,"perun-web-apps-loading-table")}var ar=()=>["select","id","indirectResourceAssigment","name","status","facility","tags","description"];function sr(t,r){if(t&1){let i=T();a(0,"perun-web-apps-resources-list",11,12),g("refreshTable",function(){S(i);let o=_(2);return I(o.refreshTable())}),s()}if(t&2){let i=_(2);l("loading",i.loading)("disableRouting",!i.routingAuth)("filterValue",i.filterValue)("resources",i.resources)("routingVo",!0)("displayedColumns",Z(12,ar))("selection",i.selected)("cachedSubject",i.cachedSubject)("groupId",i.group.id)("groupToResource",i.group)("resourcesToDisableCheckbox",i.resourcesToDisable)("tableId",i.tableId)}}function pr(t,r){if(t&1&&(a(0,"div",9),f(1,sr,2,13,"perun-web-apps-resources-list",10),s()),t&2){let i=_(),e=G(13);p(),l("perunWebAppsLoader",i.loading)("perunWebAppsLoaderIndicator",e)}}var jc=(()=>{let r=class r{constructor(e,o,n,u,v,R,L){this.resourcesManager=e,this.groupService=o,this.dialog=n,this.guiAuthResolver=u,this.entityStorageService=v,this.cacheHelperService=R,this.destroyRef=L,this.resources=[],this.selected=new q(!0,[],!0,(M,k)=>M.id===k.id),this.cachedSubject=new O(!0),this.filterValue="",this.tableId=$i,this.addAuth=!1}ngOnInit(){this.group=this.entityStorageService.getEntity(),this.setAuthorization(),this.refreshTable(),this.cacheHelperService.refreshComponentCachedData().pipe(H(this.destroyRef)).subscribe(e=>{e===r.id&&this.refreshTable()})}setAuthorization(){this.resources!==null&&this.resources.length!==0&&(this.routingAuth=this.guiAuthResolver.isAuthorized("getResourceById_int_policy",[this.resources[0]])),this.addAuth=this.guiAuthResolver.isAuthorized("getResources_Vo_policy",[this.group])}refreshTable(){this.loading=!0,this.resourcesManager.getResourceAssignments(this.group.id).subscribe(e=>{this.resources=e.map(o=>{let n=o.enrichedResource.resource;return n.facility=o.facility,n.status=o.status,n.resourceTags=o.resourceTags,n.failureCause=o.failureCause,n.sourceGroupId=o.sourceGroupId,n}),this.selected.clear(),this.cachedSubject.next(!0),this.resourcesToDisable=new Set(this.resources.filter(o=>o.sourceGroupId!==null).map(o=>o.id)),this.setAuthorization(),this.loading=!1})}applyFilter(e){this.filterValue=e,this.refreshTable()}addResource(){let e=C();e.width="1000px",e.data={theme:"group-theme",group:this.group},this.dialog.open(go,e).afterClosed().subscribe(n=>{n&&this.refreshTable()})}removeResource(){let e=C();e.width="450px",e.data={theme:"group-theme",resources:this.selected.selected,groupId:this.group.id},this.dialog.open(bo,e).afterClosed().subscribe(n=>{n&&this.refreshTable()})}};r.id="GroupResourcesComponent",r.\u0275fac=function(o){return new(o||r)(h(_t),h(de),h(B),h(F),h(N),h($),h(j))},r.\u0275cmp=x({type:r,selectors:[["app-group-resources"]],viewQuery:function(o,n){if(o&1&&ne(or,5),o&2){let u;re(u=ae())&&(n.list=u.first)}},hostVars:2,hostBindings:function(o,n){o&2&&w("router-component",n.true)},decls:15,vars:14,consts:[[1,"page-subtitle"],[3,"refresh"],["color","accent","class","me-2 action-button","mat-flat-button","",3,"click",4,"ngIf"],[3,"matTooltipDisabled","matTooltip"],["color","warn","mat-flat-button","",1,"me-2",3,"disabled","click"],[3,"placeholder","filter"],["spinner",""],["class","position-relative table-min-height",4,"ngIf"],["color","accent","mat-flat-button","",1,"me-2","action-button",3,"click"],[1,"position-relative","table-min-height"],[3,"loading","disableRouting","filterValue","resources","routingVo","displayedColumns","selection","cachedSubject","groupId","groupToResource","resourcesToDisableCheckbox","tableId","refreshTable",4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],[3,"loading","disableRouting","filterValue","resources","routingVo","displayedColumns","selection","cachedSubject","groupId","groupToResource","resourcesToDisableCheckbox","tableId","refreshTable"],["list",""]],template:function(o,n){o&1&&(a(0,"div")(1,"h1",0),m(2),c(3,"translate"),s(),a(4,"perun-web-apps-refresh-button",1),g("refresh",function(){return n.refreshTable()}),s(),f(5,nr,3,3,"button",2),a(6,"span",3),c(7,"translate"),a(8,"button",4),g("click",function(){return n.removeResource()}),m(9),c(10,"translate"),s()(),a(11,"perun-web-apps-debounce-filter",5),g("filter",function(v){return n.applyFilter(v)}),s(),f(12,rr,1,0,"ng-template",null,6,U)(14,pr,2,2,"div",7),s()),o&2&&(p(2),y(d(3,8,"GROUP_DETAIL.RESOURCES.TITLE")),p(3),l("ngIf",n.addAuth),p(),D("matTooltip",d(7,10,"GROUP_DETAIL.RESOURCES.DELETE_PERMISSION_HINT")),l("matTooltipDisabled",n.selected.selected.length===0||n.list!==void 0&&n.list.removeAuth),p(2),l("disabled",n.loading||n.selected.selected.length===0||n.list!==void 0&&!n.list.removeAuth),p(),b(" ",d(10,12,"GROUP_DETAIL.RESOURCES.DELETE")," "),p(2),l("placeholder","SHARED_LIB.PERUN.COMPONENTS.RESOURCES_LIST.TABLE_SEARCH"),p(3),l("ngIf",n.resources))},dependencies:[P,z,Y,K,W,Bt,J,Q,V]});let t=r;return t})();var mr=["table"];function cr(t,r){t&1&&E(0,"th",22)}function dr(t,r){if(t&1){let i=T();a(0,"td",23)(1,"button",24),g("mousedown",function(){S(i);let o=_(2);return I(o.dragDisabled=!1)}),c(2,"translate"),a(3,"mat-icon"),m(4,"drag_indicator"),s()()()}t&2&&(p(),D("matTooltip",d(2,1,"VO_DETAIL.SETTINGS.APPLICATION_FORM.DRAG")))}function ur(t,r){t&1&&(a(0,"th",22),m(1),c(2,"translate"),s()),t&2&&(p(),b(" ",d(2,1,"VO_DETAIL.SETTINGS.APPLICATION_FORM.SHORTNAME")," "))}function _r(t,r){if(t&1&&(a(0,"td",23),c(1,"multiWordDataCy"),m(2),s()),t&2){let i=r.$implicit;ii("data-cy","",d(1,3,i.shortname),"-shortname-td"),p(2),He(" ",i.shortname,"",i.required?"*":""," ")}}function hr(t,r){t&1&&(a(0,"th",22),m(1),c(2,"translate"),s()),t&2&&(p(),b(" ",d(2,1,"VO_DETAIL.SETTINGS.APPLICATION_FORM.TYPE")," "))}function fr(t,r){if(t&1&&(a(0,"td",23),m(1),c(2,"applicationFormItemType"),s()),t&2){let i=r.$implicit;p(),b(" ",d(2,1,i.type)," ")}}function gr(t,r){t&1&&(a(0,"th",25),m(1),c(2,"translate"),s()),t&2&&(p(),b(" ",d(2,1,"VO_DETAIL.SETTINGS.APPLICATION_FORM.DISABLED_HEADER")," "))}function br(t,r){if(t&1&&(a(0,"div")(1,"mat-icon",28),m(2,"lock "),s(),E(3,"br"),m(4),s()),t&2){let i=_().$implicit,e=_(2);p(),l("matTooltip",e.disabledTooltip(i)),p(3),b(" ",e.disabledHiddenDependency(i,i.disabled,i.disabledDependencyItemId)," ")}}function vr(t,r){if(t&1&&(a(0,"td",26),f(1,br,5,2,"div",27),s()),t&2){let i=r.$implicit;p(),l("ngIf",i.disabled!=="NEVER")}}function Sr(t,r){t&1&&(a(0,"th",25),m(1),c(2,"translate"),s()),t&2&&(p(),b(" ",d(2,1,"VO_DETAIL.SETTINGS.APPLICATION_FORM.HIDDEN_HEADER")," "))}function Ir(t,r){if(t&1&&(a(0,"div")(1,"mat-icon",28),m(2,"visibility_off "),s(),E(3,"br"),m(4),s()),t&2){let i=_().$implicit,e=_(2);p(),l("matTooltip",e.hiddenTooltip(i)),p(3),b(" ",e.disabledHiddenDependency(i,i.hidden,i.hiddenDependencyItemId)," ")}}function Tr(t,r){if(t&1&&(a(0,"td",26),f(1,Ir,5,2,"div",27),s()),t&2){let i=r.$implicit;p(),l("ngIf",i.hidden!=="NEVER")}}function Er(t,r){t&1&&(a(0,"th",22),m(1),c(2,"translate"),s()),t&2&&(p(),b(" ",d(2,1,"VO_DETAIL.SETTINGS.APPLICATION_FORM.PREVIEW")," "))}function Cr(t,r){t&1&&(a(0,"div")(1,"form"),E(2,"input",29),s()())}function Ar(t,r){t&1&&(a(0,"div")(1,"form"),E(2,"input",30)(3,"br")(4,"input",29),s()())}function Rr(t,r){if(t&1&&(a(0,"div"),E(1,"input",33),m(2),E(3,"br"),s()),t&2){let i=r.$implicit;p(2),b(" ",i,"")}}function xr(t,r){if(t&1&&(a(0,"div")(1,"form"),f(2,Rr,4,1,"div",31),E(3,"input",32),c(4,"translate"),s()()),t&2){let i=_().$implicit,e=_(2);p(2),l("ngForOf",e.getLocalizedOptions(i)),p(),D("value",d(4,2,"VO_DETAIL.SETTINGS.APPLICATION_FORM.CLEAR_SELECTION"))}}function Mr(t,r){if(t&1&&(a(0,"div"),E(1,"span",34),s()),t&2){let i=_().$implicit,e=_(2);p(),l("innerHTML",e.getLocalizedLabel(i),mt)}}function yr(t,r){if(t&1&&(a(0,"div"),E(1,"span",34),c(2,"sanitizeHtml"),s()),t&2){let i=_().$implicit,e=_(2);p(),l("innerHTML",d(2,1,e.getLocalizedLabel(i)),mt)}}function Dr(t,r){if(t&1&&(a(0,"option"),m(1),s()),t&2){let i=r.$implicit;p(),b(" ",i," ")}}function Lr(t,r){if(t&1&&(a(0,"div")(1,"select"),f(2,Dr,2,1,"option",31),s()()),t&2){let i=_().$implicit,e=_(2);p(2),l("ngForOf",e.getLocalizedOptions(i))}}function wr(t,r){t&1&&(a(0,"div"),E(1,"textarea"),s())}function Gr(t,r){if(t&1&&(a(0,"option",38),m(1),s()),t&2){let i=r.$implicit;p(),b(" ",i," ")}}function Or(t,r){t&1&&(a(0,"div")(1,"form"),E(2,"input",29),s()())}function Pr(t,r){if(t&1){let i=T();a(0,"div")(1,"select",35),g("ngModelChange",function(o){S(i);let n=_().$implicit,u=_(2);return I(u.mapForCombobox[n.id]=o)}),f(2,Gr,2,1,"option",36),a(3,"option",37),m(4),c(5,"translate"),s()(),f(6,Or,3,0,"div",27),s()}if(t&2){let i=_().$implicit,e=_(2);p(),l("ngModel",e.mapForCombobox[i.id]),p(),l("ngForOf",e.getLocalizedOptions(i)),p(2),b(" ",d(5,4,"VO_DETAIL.SETTINGS.APPLICATION_FORM.OTHER_VALUE")," "),p(2),l("ngIf",e.mapForCombobox[i.id]==="true")}}function Vr(t,r){if(t&1&&(a(0,"div"),E(1,"input",39)(2,"span",34),s()),t&2){let i=r.$implicit;p(2),l("innerHTML",i,mt)}}function Fr(t,r){if(t&1&&(a(0,"div")(1,"form"),f(2,Vr,3,1,"div",31),s()()),t&2){let i=_().$implicit,e=_(2);p(2),l("ngForOf",e.getLocalizedOptions(i))}}function Br(t,r){if(t&1&&(a(0,"div")(1,"button",40),m(2),s()()),t&2){let i=_().$implicit,e=_(2);p(2),b(" ",e.getLocalizedLabel(i)," ")}}function Nr(t,r){t&1&&(a(0,"div")(1,"select",41)(2,"option",42),m(3),c(4,"translate"),s(),a(5,"option",43),m(6,"(GMT -12:00) Eniwetok, Kwajalein"),s(),a(7,"option",44),m(8,"(GMT -11:00) Midway Island, Samoa"),s(),a(9,"option",45),m(10,"(GMT -10:00) Hawaii"),s(),a(11,"option",46),m(12,"(GMT -9:30) Taiohae"),s(),a(13,"option",47),m(14,"(GMT -9:00) Alaska"),s(),a(15,"option",48),m(16,"(GMT -8:00) Pacific Time (US & Canada)"),s(),a(17,"option",49),m(18,"(GMT -7:00) Mountain Time (US & Canada)"),s(),a(19,"option",50),m(20," (GMT -6:00) Central Time (US & Canada), Mexico City "),s(),a(21,"option",51),m(22," (GMT -5:00) Eastern Time (US & Canada), Bogota, Lima "),s(),a(23,"option",52),m(24,"(GMT -4:30) Caracas"),s(),a(25,"option",53),m(26,"(GMT -4:00) Atlantic Time (Canada), Caracas, La Paz"),s(),a(27,"option",54),m(28,"(GMT -3:30) Newfoundland"),s(),a(29,"option",55),m(30,"(GMT -3:00) Brazil, Buenos Aires, Georgetown"),s(),a(31,"option",56),m(32,"(GMT -2:00) Mid-Atlantic"),s(),a(33,"option",57),m(34,"(GMT -1:00) Azores, Cape Verde Islands"),s(),a(35,"option",58),m(36," (GMT) Western Europe Time, London, Lisbon, Casablanca "),s(),a(37,"option",59),m(38,"(GMT +1:00) Brussels, Copenhagen, Madrid, Paris"),s(),a(39,"option",60),m(40,"(GMT +2:00) Kaliningrad, South Africa"),s(),a(41,"option",61),m(42,"(GMT +3:00) Baghdad, Riyadh, Moscow, St. Petersburg"),s(),a(43,"option",62),m(44,"(GMT +3:30) Tehran"),s(),a(45,"option",63),m(46,"(GMT +4:00) Abu Dhabi, Muscat, Baku, Tbilisi"),s(),a(47,"option",64),m(48,"(GMT +4:30) Kabul"),s(),a(49,"option",65),m(50," (GMT +5:00) Ekaterinburg, Islamabad, Karachi, Tashkent "),s(),a(51,"option",66),m(52,"(GMT +5:30) Bombay, Calcutta, Madras, New Delhi"),s(),a(53,"option",67),m(54,"(GMT +5:45) Kathmandu, Pokhara"),s(),a(55,"option",68),m(56,"(GMT +6:00) Almaty, Dhaka, Colombo"),s(),a(57,"option",69),m(58,"(GMT +6:30) Yangon, Mandalay"),s(),a(59,"option",70),m(60,"(GMT +7:00) Bangkok, Hanoi, Jakarta"),s(),a(61,"option",71),m(62,"(GMT +8:00) Beijing, Perth, Singapore, Hong Kong"),s(),a(63,"option",72),m(64,"(GMT +8:45) Eucla"),s(),a(65,"option",73),m(66,"(GMT +9:00) Tokyo, Seoul, Osaka, Sapporo, Yakutsk"),s(),a(67,"option",74),m(68,"(GMT +9:30) Adelaide, Darwin"),s(),a(69,"option",75),m(70,"(GMT +10:00) Eastern Australia, Guam, Vladivostok"),s(),a(71,"option",76),m(72,"(GMT +10:30) Lord Howe Island"),s(),a(73,"option",77),m(74,"(GMT +11:00) Magadan, Solomon Islands, New Caledonia"),s(),a(75,"option",78),m(76,"(GMT +11:30) Norfolk Island"),s(),a(77,"option",79),m(78,"(GMT +12:00) Auckland, Wellington, Fiji, Kamchatka"),s(),a(79,"option",80),m(80,"(GMT +12:45) Chatham Islands"),s(),a(81,"option",81),m(82,"(GMT +13:00) Apia, Nukualofa"),s(),a(83,"option",82),m(84,"(GMT +14:00) Line Islands, Tokelau"),s()()()),t&2&&(p(3),b(" ",d(4,1,"VO_DETAIL.SETTINGS.APPLICATION_FORM.NOT_SELECTED")," "))}function kr(t,r){if(t&1&&(a(0,"div")(1,"button",40),m(2),s()()),t&2){let i=_().$implicit,e=_(2);p(2),b(" ",e.getLocalizedLabel(i)," ")}}function Ur(t,r){t&1&&(a(0,"div")(1,"form"),E(2,"input",39),m(3," example group1 "),E(4,"br")(5,"input",39),m(6," example group2 "),E(7,"br")(8,"input",39),m(9," example group3 "),s()())}var jr=()=>["Example 1","Example 2"],Vo=t=>({id:0,beanName:"Attribute",namespace:"",value:t});function Hr(t,r){t&1&&(a(0,"div"),E(1,"perun-web-apps-attribute-value-list",83),s()),t&2&&(p(),l("attribute",Ae(2,Vo,Z(1,jr))))}var $r=()=>({key1:"value 1",key2:"value 2"});function zr(t,r){t&1&&(a(0,"div"),E(1,"perun-web-apps-attribute-value-map",83),s()),t&2&&(p(),l("attribute",Ae(2,Vo,Z(1,$r))))}function Wr(t,r){if(t&1&&(a(0,"td",23),f(1,Cr,3,0,"div",27)(2,Ar,5,0,"div",27)(3,xr,5,4,"div",27)(4,Mr,2,1,"div",27)(5,yr,3,3,"div",27)(6,Lr,3,1,"div",27)(7,wr,2,0,"div",27)(8,Pr,7,6,"div",27)(9,Fr,3,1,"div",27)(10,Br,3,1,"div",27)(11,Nr,85,3,"div",27)(12,kr,3,1,"div",27)(13,Ur,10,0,"div",27)(14,Hr,2,4,"div",27)(15,zr,2,4,"div",27),s()),t&2){let i=r.$implicit;p(),l("ngIf",i.type==="TEXTFIELD"||i.type==="VALIDATED_EMAIL"||i.type==="USERNAME"),p(),l("ngIf",i.type==="PASSWORD"),p(),l("ngIf",i.type==="RADIO"),p(),l("ngIf",i.type==="HEADING"),p(),l("ngIf",i.type==="HTML_COMMENT"),p(),l("ngIf",i.type==="SELECTIONBOX"),p(),l("ngIf",i.type==="TEXTAREA"),p(),l("ngIf",i.type==="COMBOBOX"),p(),l("ngIf",i.type==="CHECKBOX"),p(),l("ngIf",i.type==="SUBMIT_BUTTON"),p(),l("ngIf",i.type==="TIMEZONE"),p(),l("ngIf",i.type==="AUTO_SUBMIT_BUTTON"),p(),l("ngIf",i.type==="EMBEDDED_GROUP_APPLICATION"),p(),l("ngIf",i.type==="LIST_INPUT_BOX"),p(),l("ngIf",i.type==="MAP_INPUT_BOX")}}function qr(t,r){t&1&&E(0,"th",22)}function Yr(t,r){if(t&1){let i=T();a(0,"button",86),g("click",function(){S(i);let o=_(3);return I(o.openManagingGroups())}),c(1,"translate"),a(2,"mat-icon"),m(3,"supervised_user_circle"),s()()}if(t&2){let i=_(3);D("matTooltip",d(1,2,"VO_DETAIL.SETTINGS.APPLICATION_FORM.MANAGE_GROUPS")),l("disabled",!i.embeddedGroupsItemSaved)}}function Qr(t,r){if(t&1&&(a(0,"td",23)(1,"span",84),c(2,"translate"),f(3,Yr,4,4,"button",85),s()()),t&2){let i=r.$implicit,e=_(2);p(),D("matTooltip",d(2,3,"VO_DETAIL.SETTINGS.APPLICATION_FORM.MANAGE_GROUPS_DISABLED")),l("matTooltipDisabled",e.embeddedGroupsItemSaved),p(2),l("ngIf",i.type==="EMBEDDED_GROUP_APPLICATION"&&!i.forDelete)}}function Kr(t,r){t&1&&E(0,"th",22)}function Xr(t,r){if(t&1){let i=T();a(0,"button",89),g("click",function(){S(i);let o=_().$implicit,n=_(2);return I(n.edit(o))}),c(1,"translate"),a(2,"mat-icon"),m(3,"edit"),s()()}t&2&&D("matTooltip",d(1,1,"VO_DETAIL.SETTINGS.APPLICATION_FORM.EDIT"))}function Zr(t,r){t&1&&(a(0,"div",90),m(1),c(2,"translate"),s()),t&2&&(p(),b(" ",d(2,1,"VO_DETAIL.SETTINGS.APPLICATION_FORM.MARK_DELETE")," "))}function Jr(t,r){if(t&1&&(a(0,"td",23),f(1,Xr,4,3,"button",87)(2,Zr,3,3,"div",88),s()),t&2){let i=r.$implicit;p(),l("ngIf",!i.forDelete),p(),l("ngIf",i.forDelete)}}function ea(t,r){t&1&&E(0,"th",22)}function ta(t,r){if(t&1){let i=T();a(0,"button",93),g("click",function(){S(i);let o=_().$implicit,n=_(2);return I(n.delete(o))}),c(1,"multiWordDataCy"),c(2,"translate"),a(3,"mat-icon"),m(4,"delete"),s()()}if(t&2){let i=_().$implicit;ii("data-cy","",d(1,2,i.shortname),"-delete"),D("matTooltip",d(2,4,"VO_DETAIL.SETTINGS.APPLICATION_FORM.DELETE"))}}function ia(t,r){if(t&1){let i=T();a(0,"button",94),g("click",function(){S(i);let o=_().$implicit,n=_(2);return I(n.restore(o))}),c(1,"translate"),a(2,"mat-icon"),m(3,"settings_backup_restore"),s()()}t&2&&D("matTooltip",d(1,1,"VO_DETAIL.SETTINGS.APPLICATION_FORM.REVERT_DELETE"))}function oa(t,r){if(t&1&&(a(0,"td",23),f(1,ta,5,6,"button",91)(2,ia,4,3,"button",92),s()),t&2){let i=r.$implicit;p(),l("ngIf",!i.forDelete),p(),l("ngIf",i.forDelete)}}function na(t,r){t&1&&E(0,"tr",95)}function ra(t,r){if(t&1&&E(0,"tr",96),t&2){let i=r.$implicit,e=_(2);w("make-green",i.id<=0)("make-red",i.forDelete)("make-yellow",e.itemsChanged.indexOf(i.id)!==-1&&!i.forDelete&&i.id>0),l("cdkDragData",i)}}function aa(t,r){if(t&1){let i=T();a(0,"div",2)(1,"div",3)(2,"div",4)(3,"table",5,6),g("cdkDropListDropped",function(o){S(i);let n=_();return I(n.drop(o))}),ie(5,7),f(6,cr,1,0,"th",8)(7,dr,5,3,"td",9),oe(),ie(8,10),f(9,ur,3,3,"th",8)(10,_r,3,5,"td",9),oe(),ie(11,11),f(12,hr,3,3,"th",8)(13,fr,3,3,"td",9),oe(),ie(14,12),f(15,gr,3,3,"th",13)(16,vr,2,1,"td",14),oe(),ie(17,15),f(18,Sr,3,3,"th",13)(19,Tr,2,1,"td",14),oe(),ie(20,16),f(21,Er,3,3,"th",8)(22,Wr,16,15,"td",9),oe(),ie(23,17),f(24,qr,1,0,"th",8)(25,Qr,4,5,"td",9),oe(),ie(26,18),f(27,Kr,1,0,"th",8)(28,Jr,3,2,"td",9),oe(),ie(29,19),f(30,ea,1,0,"th",8)(31,oa,3,2,"td",9),oe(),f(32,na,1,0,"tr",20)(33,ra,1,7,"tr",21),s()()()()}if(t&2){let i=_();p(3),l("cdkDropListDisabled",i.dragDisabled)("dataSource",i.dataSource),p(29),l("matHeaderRowDef",i.displayedColumns),p(),l("matRowDefColumns",i.displayedColumns)}}function sa(t,r){t&1&&(a(0,"perun-web-apps-alert",97),m(1),c(2,"translate"),s()),t&2&&(p(),b(" ",d(2,1,"VO_DETAIL.SETTINGS.APPLICATION_FORM.NO_APPLICATION_FORM"),`
`))}var Zt=(()=>{let r=class r{constructor(e,o,n,u){this.dialog=e,this.notificator=o,this.router=n,this.translate=u,this.applicationFormItems=[],this.embeddedGroupsItemSaved=!1,this.displayedColumns=["drag","shortname","type","disabled","hidden","preview","managegroups","edit","delete"],this.applicationFormItemsChange=new ri,this.itemsChanged=[],this.dataSource=this.applicationFormItems,this.mapForCombobox=new Map,this.dragDisabled=!0}ngOnInit(){this.ifEmpty=this.translate.instant("VO_DETAIL.SETTINGS.APPLICATION_FORM.DISABLED_HIDDEN_ICON.IF_EMPTY"),this.ifPrefilled=this.translate.instant("VO_DETAIL.SETTINGS.APPLICATION_FORM.DISABLED_HIDDEN_ICON.IF_PREFILLED"),this.alwaysDisabled=this.translate.instant("VO_DETAIL.SETTINGS.APPLICATION_FORM.DISABLED_HIDDEN_ICON.ALWAYS_DISABLED_HINT"),this.alwaysHidden=this.translate.instant("VO_DETAIL.SETTINGS.APPLICATION_FORM.DISABLED_HIDDEN_ICON.ALWAYS_HIDDEN_HINT"),this.isDisabledIf=this.translate.instant("VO_DETAIL.SETTINGS.APPLICATION_FORM.DISABLED_HIDDEN_ICON.DISABLED_IF_HINT"),this.isHiddenIf=this.translate.instant("VO_DETAIL.SETTINGS.APPLICATION_FORM.DISABLED_HIDDEN_ICON.HIDDEN_IF_HINT"),this.isEmpty=this.translate.instant("VO_DETAIL.SETTINGS.APPLICATION_FORM.DISABLED_HIDDEN_ICON.IS_EMPTY_HINT"),this.isPrefilled=this.translate.instant("VO_DETAIL.SETTINGS.APPLICATION_FORM.DISABLED_HIDDEN_ICON.IS_PREFILLED_HINT")}ngOnChanges(){this.dataSource=this.applicationFormItems,this.refreshApplicationForm&&(this.itemsChanged=[])}disabledHiddenDependency(e,o,n){let u="";if(o==="IF_EMPTY"||o==="IF_PREFILLED"){let v=n===null?"":this.applicationFormItems.find(R=>R.id===n).shortname;u=o==="IF_EMPTY"?`(${this.ifEmpty} ${v})`:`(${this.ifPrefilled} ${v})`}return u}disabledTooltip(e){let o;switch(e.disabled){case"ALWAYS":return this.alwaysDisabled;case"IF_EMPTY":return o=e.disabledDependencyItemId===null?"":this.applicationFormItems.find(n=>n.id===e.disabledDependencyItemId).shortname,`${this.isDisabledIf} ${o} ${this.isEmpty}`;case"IF_PREFILLED":return o=e.disabledDependencyItemId===null?"":this.applicationFormItems.find(n=>n.id===e.disabledDependencyItemId).shortname,`${this.isDisabledIf} ${o} ${this.isPrefilled}`}}hiddenTooltip(e){let o;switch(e.hidden){case"ALWAYS":return this.alwaysHidden;case"IF_EMPTY":return o=e.hiddenDependencyItemId===null?"":this.applicationFormItems.find(n=>n.id===e.hiddenDependencyItemId).shortname,`${this.isHiddenIf} ${o} ${this.isEmpty}`;case"IF_PREFILLED":return o=e.hiddenDependencyItemId===null?"":this.applicationFormItems.find(n=>n.id===e.hiddenDependencyItemId).shortname,`${this.isHiddenIf} ${o} ${this.isPrefilled}`}}edit(e){let o=C();o.width="600px",o.height="600px",o.data={voId:this.applicationForm.vo.id,group:this.applicationForm.group,applicationFormItem:e,theme:this.theme,allItems:this.applicationFormItems},this.dialog.open(it,o).afterClosed().subscribe(u=>{u&&(this.itemsChanged.push(e.id),this.applicationFormItemsChange.emit())})}delete(e){let o="",n=this.applicationFormItems.find(L=>L.hiddenDependencyItemId===e.id),u=this.applicationFormItems.find(L=>L.disabledDependencyItemId===e.id);(n||u)&&(o=this.translate.instant("DIALOGS.APPLICATION_FORM_EDIT_ITEM.DEPENDENCY_ERROR_MESSAGE",n?{dependency:"hidden",shortname:n.shortname}:{dependency:"disabled",shortname:u.shortname}));let v=C();v.width="500px",v.data={errorMessage:o},this.dialog.open(So,v).afterClosed().subscribe(L=>{L&&(e.forDelete=!0,e.id===0&&(this.applicationFormItems.splice(this.applicationFormItems.indexOf(e),1),this.table.renderRows()),this.applicationFormItemsChange.emit())})}drop(e){this.dragDisabled=!0;let o=this.applicationFormItems.indexOf(e.item.data);ro(this.applicationFormItems,o,e.currentIndex),this.itemsChanged.push(this.applicationFormItems[e.currentIndex].id),this.applicationFormItemsChange.emit(),this.table.renderRows()}getLocalizedOptions(e){if(e.i18n[this.translate.getDefaultLang()]){let o=e.i18n[this.translate.getDefaultLang()].options;if(o!==null&&o!==""){let n=[];for(let u of o.split("|"))n.push(u.split("#")[1]);return n}}return[]}getLocalizedLabel(e){return e.i18n[this.translate.getDefaultLang()]?e.i18n[this.translate.getDefaultLang()].label:e.shortname}restore(e){e.forDelete=!1}openManagingGroups(){let e=this.applicationForm.group?["/organizations",this.applicationForm.vo.id,"groups",this.applicationForm.group.id,"settings","applicationForm","manageGroups"]:["/organizations",this.applicationForm.vo.id,"settings","applicationForm","manageGroups"];this.router.navigate(e,{queryParamsHandling:"preserve"})}};r.\u0275fac=function(o){return new(o||r)(h(B),h(le),h($e),h(di))},r.\u0275cmp=x({type:r,selectors:[["app-application-form-list"]],viewQuery:function(o,n){if(o&1&&ne(mr,5),o&2){let u;re(u=ae())&&(n.table=u.first)}},inputs:{applicationForm:"applicationForm",applicationFormItems:"applicationFormItems",embeddedGroupsItemSaved:"embeddedGroupsItemSaved",theme:"theme",displayedColumns:"displayedColumns",refreshApplicationForm:"refreshApplicationForm",loading:"loading"},outputs:{applicationFormItemsChange:"applicationFormItemsChange"},features:[lt],decls:2,vars:2,consts:[["class","card mt-2",4,"ngIf"],["alert_type","warn",4,"ngIf"],[1,"card","mt-2"],[1,"card-body","table-theme"],[1,"overflow-auto"],["cdkDropList","","cdkDropListData","dataSource","mat-table","",1,"w-100",3,"cdkDropListDisabled","dataSource","cdkDropListDropped"],["table",""],["matColumnDef","drag"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","shortname"],["matColumnDef","type"],["matColumnDef","disabled"],["class","center","mat-header-cell","",4,"matHeaderCellDef"],["class","center","mat-cell","",4,"matCellDef"],["matColumnDef","hidden"],["matColumnDef","preview"],["matColumnDef","managegroups"],["matColumnDef","edit"],["matColumnDef","delete"],["mat-header-row","",4,"matHeaderRowDef"],["cdkDrag","","mat-row","",3,"cdkDragData","make-green","make-red","make-yellow",4,"matRowDef","matRowDefColumns"],["mat-header-cell",""],["mat-cell",""],["mat-icon-button","",3,"matTooltip","mousedown"],["mat-header-cell","",1,"center"],["mat-cell","",1,"center"],[4,"ngIf"],[1,"pointer",3,"matTooltip"],["type","text"],["type","text",1,"mb-1"],[4,"ngFor","ngForOf"],["type","reset",3,"value"],["name","temp","type","radio"],[3,"innerHTML"],[3,"ngModel","ngModelChange"],["selected","","value","false",4,"ngFor","ngForOf"],["value","true"],["selected","","value","false"],["type","checkbox"],["color","accent","mat-flat-button",""],["id","timezone-offset","name","timezone_offset",1,"span5"],["selected","selected","value","-12:00"],["value","-12:00"],["value","-11:00"],["value","-10:00"],["value","-09:50"],["value","-09:00"],["value","-08:00"],["value","-07:00"],["value","-06:00"],["value","-05:00"],["value","-04:50"],["value","-04:00"],["value","-03:50"],["value","-03:00"],["value","-02:00"],["value","-01:00"],["value","+00:00"],["value","+01:00"],["value","+02:00"],["value","+03:00"],["value","+03:50"],["value","+04:00"],["value","+04:50"],["value","+05:00"],["value","+05:50"],["value","+05:75"],["value","+06:00"],["value","+06:50"],["value","+07:00"],["value","+08:00"],["value","+08:75"],["value","+09:00"],["value","+09:50"],["value","+10:00"],["value","+10:50"],["value","+11:00"],["value","+11:50"],["value","+12:00"],["value","+12:75"],["value","+13:00"],["value","+14:00"],[3,"attribute"],[1,"d-inline-block",3,"matTooltip","matTooltipDisabled"],["mat-icon-button","",3,"disabled","matTooltip","click",4,"ngIf"],["mat-icon-button","",3,"disabled","matTooltip","click"],["class","ms-auto","mat-icon-button","",3,"matTooltip","click",4,"ngIf"],["class","fw-bold",4,"ngIf"],["mat-icon-button","",1,"ms-auto",3,"matTooltip","click"],[1,"fw-bold"],["color","warn","mat-icon-button","",3,"matTooltip","click",4,"ngIf"],["mat-icon-button","",3,"matTooltip","click",4,"ngIf"],["color","warn","mat-icon-button","",3,"matTooltip","click"],["mat-icon-button","",3,"matTooltip","click"],["mat-header-row",""],["cdkDrag","","mat-row","",3,"cdkDragData"],["alert_type","warn"]],template:function(o,n){o&1&&f(0,aa,34,4,"div",0)(1,sa,3,3,"perun-web-apps-alert",1),o&2&&(l("ngIf",n.applicationFormItems.length!==0),p(),l("ngIf",!n.loading&&n.applicationFormItems.length===0))},dependencies:[Fe,P,fi,bi,vi,gi,ve,_i,Be,hi,Se,Tt,Ct,Mt,At,Et,yt,Rt,xt,Dt,Lt,z,ui,Y,so,ao,Ge,po,no,V,vo,Bi,Ni],styles:[".cdk-drag-preview[_ngcontent-%COMP%]{box-sizing:border-box;border-radius:4px;box-shadow:0 5px 5px -3px #0003,0 8px 10px 1px #00000024,0 3px 14px 2px #0000001f}.cdk-drag-placeholder[_ngcontent-%COMP%]{opacity:0}.cdk-drag-animating[_ngcontent-%COMP%]{transition:transform .25s cubic-bezier(0,0,.2,1)}.cdk-drop-list-dragging[_ngcontent-%COMP%]   .mat-mdc-row[_ngcontent-%COMP%]:not(.cdk-drag-placeholder){transition:transform .25s cubic-bezier(0,0,.2,1)}.movable-row[_ngcontent-%COMP%]{cursor:move}.make-red[_ngcontent-%COMP%]{background-color:#ffcdd2}.make-green[_ngcontent-%COMP%]{background-color:#c8e6c9}.make-yellow[_ngcontent-%COMP%]{background-color:#fff9c4}.center[_ngcontent-%COMP%]{text-align:center}.pointer[_ngcontent-%COMP%]{cursor:pointer}"]});let t=r;return t})();function pa(t,r){t&1&&E(0,"mat-spinner",15)}function la(t,r){if(t&1){let i=T();a(0,"button",21),g("click",function(){S(i);let o=_(2);return I(o.settings())}),a(1,"i",22),m(2,"edit"),s(),a(3,"span",23),m(4),c(5,"translate"),s()()}t&2&&(p(4),b(" ",d(5,1,"VO_DETAIL.SETTINGS.APPLICATION_FORM.SETTINGS_BUTTON")," "))}function ma(t,r){if(t&1&&(a(0,"div",16)(1,"div")(2,"div",17),m(3),c(4,"translate"),s(),a(5,"div")(6,"span",17),m(7),c(8,"translate"),s(),m(9,": "),a(10,"mat-icon",18),m(11,"arrow_right_alt"),s(),m(12),c(13,"translate"),c(14,"translate"),a(15,"mat-icon",19),m(16,"restore"),s(),m(17),c(18,"translate"),c(19,"translate"),f(20,la,6,3,"button",20),s()()()),t&2){let i=_();p(3),He(" ",d(4,6,"VO_DETAIL.SETTINGS.APPLICATION_FORM.MODULE_NAMES"),": ",i.applicationForm.moduleClassNames," "),p(4),y(d(8,8,"VO_DETAIL.SETTINGS.APPLICATION_FORM.APPLICATION_TYPE")),p(5),b(" ",i.applicationForm.automaticApproval?d(13,10,"VO_DETAIL.SETTINGS.APPLICATION_FORM.AUTOMATIC"):d(14,12,"VO_DETAIL.SETTINGS.APPLICATION_FORM.MANUAL")," , "),p(5),b(" ",i.applicationForm.automaticApprovalExtension?d(18,14,"VO_DETAIL.SETTINGS.APPLICATION_FORM.AUTOMATIC"):d(19,16,"VO_DETAIL.SETTINGS.APPLICATION_FORM.MANUAL")," "),p(3),l("ngIf",i.editAuth)}}function ca(t,r){if(t&1){let i=T();a(0,"button",24),g("click",function(){S(i);let o=_();return I(o.add())}),m(1),c(2,"translate"),s()}if(t&2){let i=_();l("disabled",i.loadingTable),p(),b(" ",d(2,2,"VO_DETAIL.SETTINGS.APPLICATION_FORM.ADD_BUTTON")," ")}}function da(t,r){if(t&1){let i=T();a(0,"button",25),g("click",function(){S(i);let o=_();return I(o.save())}),a(1,"i",10),m(2,"save"),s(),m(3),c(4,"translate"),s()}if(t&2){let i=_();l("disabled",!i.itemsChanged),p(3),b(" ",d(4,2,"VO_DETAIL.SETTINGS.APPLICATION_FORM.SAVE_BUTTON")," ")}}function ua(t,r){if(t&1){let i=T();a(0,"button",26),g("click",function(){S(i);let o=_();return I(o.copy())}),a(1,"i",22),m(2,"file_copy"),s(),a(3,"span",23),m(4),c(5,"translate"),s()()}t&2&&(p(4),b(" ",d(5,1,"VO_DETAIL.SETTINGS.APPLICATION_FORM.COPY_VO_BUTTON")," "))}function _a(t,r){t&1&&(a(0,"perun-web-apps-alert",27),m(1),c(2,"translate"),s()),t&2&&(p(),b(" ",d(2,1,"VO_DETAIL.SETTINGS.APPLICATION_FORM.DRAG_AND_DROP_INFO")," "))}function ha(t,r){t&1&&E(0,"perun-web-apps-loading-table")}function fa(t,r){if(t&1){let i=T();a(0,"app-application-form-list",28),g("applicationFormItemsChange",function(){S(i);let o=_();return I(o.changeItems())}),s()}if(t&2){let i=_();l("loading",i.loadingTable)("applicationForm",i.applicationForm)("applicationFormItems",i.applicationFormItems)("displayedColumns",i.displayedColumns)("refreshApplicationForm",i.refreshApplicationForm)("embeddedGroupsItemSaved",i.embeddedGroupsItemSaved)("theme","vo-theme")}}var vd=(()=>{let r=class r{constructor(e,o,n,u,v,R,L){this.registrarManager=e,this.dialog=o,this.notificator=n,this.translate=u,this.router=v,this.authResolver=R,this.entityStorageService=L,this.loadingHeader=!1,this.loadingTable=!1,this.applicationFormItems=[],this.itemsChanged=!1,this.displayedColumns=[],this.refreshApplicationForm=!1,this.embeddedGroupsItemSaved=!1,this.idCounter=-1}ngOnInit(){this.loadingHeader=!0,this.loadingTable=!0,this.vo=this.entityStorageService.getEntity(),this.setAuthRights(),this.registrarManager.getVoApplicationForm(this.vo.id).subscribe(e=>{this.applicationForm=e,this.registrarManager.getFormItemsForVo(this.vo.id).subscribe(o=>{this.applicationFormItems=o,this.embeddedGroupsItemSaved=o.filter(n=>n.type==="EMBEDDED_GROUP_APPLICATION").length>0,this.loadingHeader=!1,this.loadingTable=!1})})}add(){let e=C();e.width="500px",e.data={applicationFormItems:this.applicationFormItems,fakeId:this.idCounter--},this.dialog.open(Kt,e).afterClosed().subscribe(n=>{n&&(this.applicationFormItems=Object.assign([],n[0]),e=C(),e.width="600px",e.height="600px",e.data={voId:this.vo.id,applicationFormItem:n[1],theme:"vo-theme",allItems:this.applicationFormItems},this.dialog.open(it,e),this.itemsChanged=!0)})}copy(){let e=C();e.width="500px",e.data={voId:this.vo.id,theme:"vo-theme"},this.dialog.open(Qt,e).afterClosed().subscribe(n=>{n&&this.updateFormItems()})}settings(){let e=C();e.width="400px",e.data={entity:"vo",applicationForm:this.applicationForm,theme:"vo-theme"},this.dialog.open(Yt,e).afterClosed().subscribe(n=>{n&&(this.translate.get("VO_DETAIL.SETTINGS.APPLICATION_FORM.CHANGE_SETTINGS_SUCCESS").subscribe(u=>{this.notificator.showSuccess(u)}),this.applicationForm=n)})}preview(){this.router.navigate(["/organizations",this.vo.id,"settings","applicationForm","preview"],{queryParams:{applicationFormItems:JSON.stringify(this.applicationFormItems)},queryParamsHandling:"merge"})}updateFormItems(){this.loadingTable=!0,this.refreshApplicationForm=!0,this.registrarManager.getFormItemsForVo(this.vo.id).subscribe(e=>{this.applicationFormItems=e,this.itemsChanged=!1,this.embeddedGroupsItemSaved=e.filter(o=>o.type==="EMBEDDED_GROUP_APPLICATION").length>0,this.setAuthRights(),this.refreshApplicationForm=!1,this.loadingTable=!1})}changeItems(){this.itemsChanged=!0}save(){this.loadingTable=!0;let e=0;for(let o of this.applicationFormItems)o.ordnum=e,o.forDelete||e++;this.registrarManager.updateFormItemsForVo({vo:this.vo.id,items:this.applicationFormItems}).subscribe({next:()=>{this.translate.get("VO_DETAIL.SETTINGS.APPLICATION_FORM.CHANGE_APPLICATION_FORM_ITEMS_SUCCESS").subscribe(o=>{this.notificator.showSuccess(o)}),this.updateFormItems()},error:()=>this.loadingTable=!1})}clear(){this.applicationFormItems.forEach(e=>e.forDelete=!0),this.itemsChanged=!0}setAuthRights(){this.editAuth=this.authResolver.isAuthorized("vo-updateFormItems_ApplicationForm_List<ApplicationFormItem>_policy",[this.vo]),this.displayedColumns=this.editAuth?["drag","shortname","type","disabled","hidden","preview","managegroups","edit","delete"]:["shortname","type","disabled","hidden","preview","managegroups"]}};r.id="VoSettingsApplicationFormComponent",r.\u0275fac=function(o){return new(o||r)(h(be),h(B),h(le),h(ht),h($e),h(F),h(N))},r.\u0275cmp=x({type:r,selectors:[["app-vo-settings-application-form"]],hostVars:2,hostBindings:function(o,n){o&2&&w("router-component",n.true)},decls:22,vars:14,consts:[[1,"page-subtitle"],["class","ms-auto me-auto",4,"ngIf"],["class","d-flex w-75",4,"ngIf"],[1,"mb-2","mt-2"],[1,"w-100","d-flex"],[3,"refresh"],["color","accent","class","me-2 action-button","data-cy","add-form-item","mat-flat-button","",3,"disabled","click",4,"ngIf"],["color","accent","data-cy","save-application-form","class","me-2","mat-flat-button","",3,"disabled","click",4,"ngIf"],["class","me-2 action-button","mat-stroked-button","",3,"click",4,"ngIf"],["mat-stroked-button","",3,"click"],[1,"material-icons"],["alert_type","info",4,"ngIf"],["spinner",""],[1,"position-relative","table-min-height"],[3,"loading","applicationForm","applicationFormItems","displayedColumns","refreshApplicationForm","embeddedGroupsItemSaved","theme","applicationFormItemsChange",4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],[1,"ms-auto","me-auto"],[1,"d-flex","w-75"],[1,"fw-bold"],["matTooltip","Initial",1,"align-middle"],["matTooltip","Extension",1,"align-middle"],["class","ms-3 action-button","mat-stroked-button","",3,"click",4,"ngIf"],["mat-stroked-button","",1,"ms-3","action-button",3,"click"],[1,"material-icons","align-middle"],[1,"align-middle"],["color","accent","data-cy","add-form-item","mat-flat-button","",1,"me-2","action-button",3,"disabled","click"],["color","accent","data-cy","save-application-form","mat-flat-button","",1,"me-2",3,"disabled","click"],["mat-stroked-button","",1,"me-2","action-button",3,"click"],["alert_type","info"],[3,"loading","applicationForm","applicationFormItems","displayedColumns","refreshApplicationForm","embeddedGroupsItemSaved","theme","applicationFormItemsChange"]],template:function(o,n){if(o&1&&(a(0,"h1",0),m(1),c(2,"translate"),s(),f(3,pa,1,0,"mat-spinner",1),a(4,"div"),f(5,ma,21,18,"div",2),E(6,"mat-divider",3),a(7,"div",4)(8,"perun-web-apps-refresh-button",5),g("refresh",function(){return n.updateFormItems()}),s(),f(9,ca,3,4,"button",6)(10,da,5,4,"button",7)(11,ua,6,3,"button",8),a(12,"button",9),g("click",function(){return n.preview()}),a(13,"i",10),m(14,"search"),s(),m(15),c(16,"translate"),s()(),f(17,_a,3,3,"perun-web-apps-alert",11)(18,ha,1,0,"ng-template",null,12,U),a(20,"div",13),f(21,fa,1,7,"app-application-form-list",14),s()()),o&2){let u=G(19);p(),b(" ",d(2,10,"VO_DETAIL.SETTINGS.APPLICATION_FORM.TITLE"),`
`),p(2),l("ngIf",n.loadingHeader),p(2),l("ngIf",!n.loadingHeader),p(4),l("ngIf",n.editAuth),p(),l("ngIf",n.editAuth),p(),l("ngIf",n.editAuth),p(4),b(" ",d(16,12,"VO_DETAIL.SETTINGS.APPLICATION_FORM.PREVIEW_BUTTON")," "),p(2),l("ngIf",n.editAuth),p(4),l("perunWebAppsLoader",n.loadingTable)("perunWebAppsLoaderIndicator",u)}},dependencies:[P,Se,z,qe,Y,We,Ge,K,W,Q,Zt,V]});let t=r;return t})();function ga(t,r){if(t&1){let i=T();a(0,"button",7),g("click",function(){S(i);let o=_();return I(o.deleteSelectedResources())}),m(1),c(2,"translate"),s()}if(t&2){let i=_();l("disabled",i.selected.selected.length===0||i.loading),p(),b(" ",d(2,2,"VO_DETAIL.RESOURCES.LIST.DELETE")," ")}}function ba(t,r){t&1&&E(0,"perun-web-apps-loading-table")}function va(t,r){if(t&1&&E(0,"perun-web-apps-resources-list",8),t&2){let i=_();l("loading",i.loading)("disableRouting",!i.routeAuth)("filterValue",i.filterValue)("resources",i.resources)("routingVo",!0)("displayedColumns",i.displayedColumns)("selection",i.selected)("cachedSubject",i.cachedSubject)("tableId",i.tableId)}}var Od=(()=>{let r=class r{constructor(e,o,n,u,v,R){this.resourcesManager=e,this.dialog=o,this.authResolver=n,this.entityStorageService=u,this.cacheHelperService=v,this.destroyRef=R,this.resources=[],this.selected=new q(!0,[],!0,(L,M)=>L.id===M.id),this.cachedSubject=new O(!0),this.filterValue="",this.displayedColumns=[],this.tableId=Hi,this.routeAuth=!1}ngOnInit(){this.loading=!0,this.vo=this.entityStorageService.getEntity(),this.setAuthRights(),this.refreshTable(),this.cacheHelperService.refreshComponentCachedData().pipe(H(this.destroyRef)).subscribe(e=>{e===r.id&&this.refreshTable()})}setAuthRights(){this.removeAuth=this.authResolver.isAuthorized("deleteResource_Resource_policy",[this.vo]),this.resources.length!==0&&(this.routeAuth=this.authResolver.isAuthorized("getResourceById_int_policy",[this.vo,this.resources[0]])),this.displayedColumns=this.removeAuth?["select","id","name","facility","tags","description"]:["id","name","facility","tags","description"]}refreshTable(){this.loading=!0,this.resourcesManager.getRichResources(this.vo.id).subscribe(e=>{this.resources=e,this.selected.clear(),this.cachedSubject.next(!0),this.setAuthRights(),this.loading=!1})}applyFilter(e){this.filterValue=e,this.refreshTable()}deleteSelectedResources(){let e=C();e.width="450px",e.data={theme:"vo-theme",resources:this.selected.selected},this.dialog.open(Io,e).afterClosed().subscribe(n=>{n&&this.refreshTable()})}};r.id="VoResourcesPreviewComponent",r.\u0275fac=function(o){return new(o||r)(h(_t),h(B),h(F),h(N),h($),h(j))},r.\u0275cmp=x({type:r,selectors:[["app-vo-resources-preview"]],hostVars:2,hostBindings:function(o,n){o&2&&w("router-component",n.true)},decls:11,vars:7,consts:[[1,"page-subtitle"],[3,"refresh"],["class","me-2","color","warn","mat-flat-button","",3,"disabled","click",4,"ngIf"],[3,"placeholder","filter"],["spinner",""],[1,"position-relative","table-min-height"],[3,"loading","disableRouting","filterValue","resources","routingVo","displayedColumns","selection","cachedSubject","tableId",4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],["color","warn","mat-flat-button","",1,"me-2",3,"disabled","click"],[3,"loading","disableRouting","filterValue","resources","routingVo","displayedColumns","selection","cachedSubject","tableId"]],template:function(o,n){if(o&1&&(a(0,"div")(1,"h1",0),m(2),c(3,"translate"),s(),a(4,"perun-web-apps-refresh-button",1),g("refresh",function(){return n.refreshTable()}),s(),f(5,ga,3,4,"button",2),a(6,"perun-web-apps-debounce-filter",3),g("filter",function(v){return n.applyFilter(v)}),s(),f(7,ba,1,0,"ng-template",null,4,U),a(9,"div",5),f(10,va,1,9,"perun-web-apps-resources-list",6),s()()),o&2){let u=G(8);p(2),y(d(3,5,"VO_DETAIL.RESOURCES.LIST.TITLE")),p(3),l("ngIf",n.removeAuth),p(),l("placeholder","SHARED_LIB.PERUN.COMPONENTS.RESOURCES_LIST.TABLE_SEARCH"),p(4),l("perunWebAppsLoader",n.loading)("perunWebAppsLoaderIndicator",u)}},dependencies:[P,z,K,W,Bt,J,Q,V]});let t=r;return t})();function Sa(t,r){t&1&&E(0,"mat-spinner",2)}function Ia(t,r){if(t&1&&(a(0,"div")(1,"i",11),m(2," error "),s(),m(3),c(4,"translate"),c(5,"translate"),s()),t&2){let i=_().$implicit,e=_(2);p(3),ai(" ",e.getErrorCountStates(i)," ",d(4,4,"VO_DETAIL.RESOURCES.STATES.FROM")," ",i.taskList.length," ",d(5,6,"VO_DETAIL.RESOURCES.STATES.TASKS_WITH_ERROR_STATE")," ")}}function Ta(t,r){if(t&1&&(m(0),c(1,"translate"),c(2,"translate")),t&2){let i=_().$implicit;b(" ",i.taskList.length===0?d(1,1,"VO_DETAIL.RESOURCES.STATES.NO_SERVICES_ASSIGNED"):i.taskList.length+" "+d(2,3,"VO_DETAIL.RESOURCES.STATES.SERVICES_ASSIGNED")," ")}}function Ea(t,r){t&1&&(a(0,"th",25),m(1),c(2,"translate"),s()),t&2&&(p(),b(" ",d(2,1,"VO_DETAIL.RESOURCES.STATES.TABLE_ID")," "))}function Ca(t,r){if(t&1&&(a(0,"td",26),m(1),s()),t&2){let i=r.$implicit;p(),y(i.id)}}function Aa(t,r){t&1&&(a(0,"th",25),m(1),c(2,"translate"),s()),t&2&&(p(),b(" ",d(2,1,"VO_DETAIL.RESOURCES.STATES.TABLE_SERVICE")," "))}function Ra(t,r){if(t&1&&(a(0,"td",26),m(1),s()),t&2){let i=r.$implicit;p(),y(i.service.name)}}function xa(t,r){t&1&&(a(0,"th",25),m(1),c(2,"translate"),s()),t&2&&(p(),b(" ",d(2,1,"VO_DETAIL.RESOURCES.STATES.TABLE_STATUS")," "))}function Ma(t,r){if(t&1&&(a(0,"td",26),m(1),s()),t&2){let i=r.$implicit;p(),y(i.status)}}function ya(t,r){t&1&&(a(0,"th",25),m(1),c(2,"translate"),s()),t&2&&(p(),b(" ",d(2,1,"VO_DETAIL.RESOURCES.STATES.TABLE_SCHEDULED")," "))}function Da(t,r){if(t&1&&(a(0,"div"),m(1),c(2,"date"),s()),t&2){let i=_().$implicit;p(),b(" ",Ve(2,1,i.schedule,"d.M.y H:mm:ss")," ")}}function La(t,r){t&1&&(m(0),c(1,"translate")),t&2&&b(" ",d(1,1,"VO_DETAIL.RESOURCES.STATES.NOT_YET")," ")}function wa(t,r){if(t&1&&(a(0,"td",26),f(1,Da,3,4,"div",8)(2,La,2,3,"ng-template",27,28,U),s()),t&2){let i=r.$implicit,e=G(3);p(),l("ngIf",i.schedule)("ngIfElse",e)}}function Ga(t,r){t&1&&(a(0,"th",25),m(1),c(2,"translate"),s()),t&2&&(p(),b(" ",d(2,1,"VO_DETAIL.RESOURCES.STATES.TABLE_STARTED")," "))}function Oa(t,r){if(t&1&&(a(0,"div"),m(1),c(2,"date"),s()),t&2){let i=_().$implicit;p(),b(" ",Ve(2,1,i.startTime,"d.M.y H:mm:ss")," ")}}function Pa(t,r){t&1&&(m(0),c(1,"translate")),t&2&&b(" ",d(1,1,"VO_DETAIL.RESOURCES.STATES.NOT_YET")," ")}function Va(t,r){if(t&1&&(a(0,"td",26),f(1,Oa,3,4,"div",8)(2,Pa,2,3,"ng-template",27,29,U),s()),t&2){let i=r.$implicit,e=G(3);p(),l("ngIf",i.startTime)("ngIfElse",e)}}function Fa(t,r){t&1&&(a(0,"th",25),m(1),c(2,"translate"),s()),t&2&&(p(),b(" ",d(2,1,"VO_DETAIL.RESOURCES.STATES.TABLE_ENDED")," "))}function Ba(t,r){if(t&1&&(a(0,"div"),m(1),c(2,"date"),s()),t&2){let i=_().$implicit;p(),b(" ",Ve(2,1,i.endTime,"d.M.y H:mm:ss")," ")}}function Na(t,r){t&1&&(m(0),c(1,"translate")),t&2&&b(" ",d(1,1,"VO_DETAIL.RESOURCES.STATES.NOT_YET")," ")}function ka(t,r){if(t&1&&(a(0,"td",26),f(1,Ba,3,4,"div",8)(2,Na,2,3,"ng-template",27,30,U),s()),t&2){let i=r.$implicit,e=G(3);p(),l("ngIf",i.endTime)("ngIfElse",e)}}function Ua(t,r){t&1&&E(0,"tr",31)}var ja=(t,r,i)=>({redTableItem:t,greenTableItem:r,yellowTableItem:i});function Ha(t,r){if(t&1&&E(0,"tr",32),t&2){let i=r.$implicit;l("ngClass",si(1,ja,i.status==="ERROR"||i.status==="SENDERROR"||i.status==="GENERROR",i.status==="DONE",i.status==="WARNING"))}}function $a(t,r){if(t&1&&(a(0,"table",14),ie(1,15),f(2,Ea,3,3,"th",16)(3,Ca,2,1,"td",17),oe(),ie(4,18),f(5,Aa,3,3,"th",16)(6,Ra,2,1,"td",17),oe(),ie(7,19),f(8,xa,3,3,"th",16)(9,Ma,2,1,"td",17),oe(),ie(10,20),f(11,ya,3,3,"th",16)(12,wa,4,2,"td",17),oe(),ie(13,21),f(14,Ga,3,3,"th",16)(15,Va,4,2,"td",17),oe(),ie(16,22),f(17,Fa,3,3,"th",16)(18,ka,4,2,"td",17),oe(),f(19,Ua,1,0,"tr",23)(20,Ha,1,5,"tr",24),s()),t&2){let i=_(2).$implicit,e=_(2);l("dataSource",e.datasources[e.propagation.indexOf(i)]),p(19),l("matHeaderRowDef",e.displayedColumns),p(),l("matRowDefColumns",e.displayedColumns)}}function za(t,r){t&1&&(a(0,"div"),m(1),c(2,"translate"),s()),t&2&&(p(),b(" ",d(2,1,"VO_DETAIL.RESOURCES.STATES.NO_TASKS")," "))}function Wa(t,r){if(t&1&&(E(0,"mat-divider"),f(1,$a,21,3,"table",12)(2,za,3,3,"div",13)),t&2){let i=_().$implicit;p(),l("ngIf",i.taskList.length!==0),p(),l("ngIf",i.taskList.length===0)}}function qa(t,r){if(t&1&&(a(0,"mat-expansion-panel")(1,"mat-expansion-panel-header")(2,"mat-panel-title"),E(3,"img",6),a(4,"div",7),m(5),s()(),a(6,"mat-panel-description"),f(7,Ia,6,8,"div",8)(8,Ta,3,5,"ng-template",null,9,U),s()(),f(10,Wa,3,2,"ng-template",10),s()),t&2){let i=r.$implicit,e=G(9),o=_(2);p(5),b(" ",i.resource.name," "),p(2),l("ngIf",o.getErrorCountStates(i)!==0)("ngIfElse",e)}}function Ya(t,r){if(t&1&&(a(0,"div",3)(1,"mat-accordion",4),f(2,qa,11,3,"mat-expansion-panel",5),s()()),t&2){let i=_();p(2),l("ngForOf",i.propagation)}}var ko=(()=>{let r=class r{constructor(){this.propagation=[],this.loading=!1,this.datasources=[],this.displayedColumns=["id","service","status","scheduled","started","ended"]}getErrorCountStates(e){let o=0;for(let n of e.taskList)(n.status==="ERROR"||n.status==="GENERROR"||n.status==="SENDERROR")&&o++;return o}getDataSource(){this.datasources=[];for(let e of this.propagation)this.datasources.push(new xi(e.taskList))}ngOnChanges(){this.getDataSource()}};r.\u0275fac=function(o){return new(o||r)},r.\u0275cmp=x({type:r,selectors:[["app-state-tab"]],inputs:{propagation:"propagation",loading:"loading"},features:[lt],decls:2,vars:2,consts:[["class","ms-auto me-auto",4,"ngIf"],["class","p-2",4,"ngIf"],[1,"ms-auto","me-auto"],[1,"p-2"],["multi","true","togglePosition","before",1,"headers-align"],[4,"ngFor","ngForOf"],["height","28","src","assets/img/PerunWebImages/resource-black.svg","width","28"],[1,"ms-2"],[4,"ngIf","ngIfElse"],["okStateDescription",""],["matExpansionPanelContent",""],[1,"material-icons","red"],["class","w-100","mat-table","",3,"dataSource",4,"ngIf"],[4,"ngIf"],["mat-table","",1,"w-100",3,"dataSource"],["matColumnDef","id"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","service"],["matColumnDef","status"],["matColumnDef","scheduled"],["matColumnDef","started"],["matColumnDef","ended"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",3,"ngClass",4,"matRowDef","matRowDefColumns"],["mat-header-cell",""],["mat-cell",""],["class","font-italic"],["notScheduledYet",""],["notStartedYet",""],["notEndedYet",""],["mat-header-row",""],["mat-row","",3,"ngClass"]],template:function(o,n){o&1&&f(0,Sa,1,0,"mat-spinner",0)(1,Ya,3,1,"div",1),o&2&&(l("ngIf",n.loading),p(),l("ngIf",!n.loading))},dependencies:[dt,Fe,P,Tt,Ct,Mt,At,Et,yt,Rt,xt,Dt,Lt,qe,We,Ri,Ti,Ei,Ai,Ci,Ii,li,V],styles:[".greenTableItem[_ngcontent-%COMP%]{background-color:#c4ffcb}.yellowTableItem[_ngcontent-%COMP%]{background-color:#fffde7}.redTableItem[_ngcontent-%COMP%]{background-color:#ffcdd2}.headers-align[_ngcontent-%COMP%]   .mat-expansion-panel-header-title[_ngcontent-%COMP%], .headers-align[_ngcontent-%COMP%]   .mat-expansion-panel-header-description[_ngcontent-%COMP%]{flex-basis:0}.headers-align[_ngcontent-%COMP%]   .mat-expansion-panel-header-description[_ngcontent-%COMP%]{margin-left:15%;justify-content:space-between;align-items:center}"]});let t=r;return t})();function Ka(t,r){if(t&1&&(m(0),c(1,"translate"),a(2,"span",5),m(3),s()),t&2){let i=_();b(" ",d(1,2,"VO_DETAIL.RESOURCES.STATES.ERROR_RESOURCES")," "),p(3),y(i.errorPropagation.length)}}function Xa(t,r){t&1&&(a(0,"perun-web-apps-alert",8),m(1),c(2,"translate"),s()),t&2&&(p(),b(" ",d(2,1,"VO_DETAIL.RESOURCES.STATES.NO_RESOURCES_IN_ERROR")," "))}function Za(t,r){if(t&1&&(f(0,Xa,3,3,"perun-web-apps-alert",6),E(1,"app-state-tab",7)),t&2){let i=_();l("ngIf",!i.loading&&i.errorPropagation.length===0),p(),l("loading",i.loading)("propagation",i.errorPropagation)}}function Ja(t,r){if(t&1&&(m(0),c(1,"translate"),a(2,"span",9),m(3),s()),t&2){let i=_();b(" ",d(1,2,"VO_DETAIL.RESOURCES.STATES.OK_RESOURCES")," "),p(3),y(i.okPropagation.length)}}function es(t,r){t&1&&(a(0,"perun-web-apps-alert",8),m(1),c(2,"translate"),s()),t&2&&(p(),b(" ",d(2,1,"VO_DETAIL.RESOURCES.STATES.NO_RESOURCES_IN_OK")," "))}function ts(t,r){if(t&1&&(f(0,es,3,3,"perun-web-apps-alert",6),E(1,"app-state-tab",7)),t&2){let i=_();l("ngIf",!i.loading&&i.okPropagation.length===0),p(),l("loading",i.loading)("propagation",i.okPropagation)}}var Wd=(()=>{let r=class r{constructor(e,o,n,u){this.taskService=e,this.entityStorageService=o,this.cacheHelperService=n,this.destroyRef=u,this.loading=!1,this.okPropagation=[],this.errorPropagation=[],this.resourceStates=[],this.selectedIndex=0}ngOnInit(){this.loading=!0,this.vo=this.entityStorageService.getEntity(),this.refreshTable(),this.cacheHelperService.refreshComponentCachedData().pipe(H(this.destroyRef)).subscribe(e=>{e===r.id&&this.refreshTable()})}refreshTable(){this.loading=!0,this.taskService.getAllResourcesState(this.vo.id).subscribe(e=>{this.resourceStates=e,this.okPropagation=[],this.errorPropagation=[];for(let o of e){let n=!0;for(let u of o.taskList)if(u.status==="ERROR"||u.status==="GENERROR"||u.status==="SENDERROR"){n=!1;break}n?this.okPropagation.push(o):this.errorPropagation.push(o)}this.loading=!1},()=>this.loading=!1)}};r.id="VoResourcesStatesComponent",r.\u0275fac=function(o){return new(o||r)(h(ci),h(N),h($),h(j))},r.\u0275cmp=x({type:r,selectors:[["app-vo-resources-states"]],hostVars:2,hostBindings:function(o,n){o&2&&w("router-component",n.true)},decls:11,vars:4,consts:[[1,"page-subtitle"],[3,"refresh"],["animationDuration","0ms","mat-stretch-tabs","false",1,"mt-3",3,"selectedIndex","selectedIndexChange"],["mat-tab-label",""],["matTabContent",""],[1,"badge","bg-danger","ms-2"],["alert_type","warn",4,"ngIf"],[3,"loading","propagation"],["alert_type","warn"],[1,"badge","bg-success","ms-2"]],template:function(o,n){o&1&&(a(0,"h1",0),m(1),c(2,"translate"),s(),a(3,"perun-web-apps-refresh-button",1),g("refresh",function(){return n.refreshTable()}),s(),a(4,"mat-tab-group",2),g("selectedIndexChange",function(v){return n.selectedIndex=v}),a(5,"mat-tab"),f(6,Ka,4,4,"ng-template",3)(7,Za,2,3,"ng-template",4),s(),a(8,"mat-tab"),f(9,Ja,4,4,"ng-template",3)(10,ts,2,3,"ng-template",4),s()()),o&2&&(p(),y(d(2,2,"VO_DETAIL.RESOURCES.STATES.TITLE")),p(3),l("selectedIndex",n.selectedIndex))},dependencies:[P,Mi,yi,Di,Li,Ge,W,ko,V]});let t=r;return t})();var is=["autoRegToggle"];function os(t,r){t&1&&E(0,"mat-spinner",3)}function ns(t,r){if(t&1&&(a(0,"span",24),m(1," , "),a(2,"mat-icon",25),m(3,"nat"),s(),m(4),c(5,"translate"),c(6,"translate"),s()),t&2){let i=_(3);p(4),b(" ",i.applicationForm.automaticApprovalEmbedded?d(5,1,"GROUP_DETAIL.SETTINGS.APPLICATION_FORM.AUTOMATIC"):d(6,3,"GROUP_DETAIL.SETTINGS.APPLICATION_FORM.MANUAL")," ")}}function rs(t,r){if(t&1){let i=T();a(0,"button",26),g("click",function(){S(i);let o=_(3);return I(o.settings())}),a(1,"i",27),m(2,"edit"),s(),a(3,"span",28),m(4),c(5,"translate"),s()()}t&2&&(p(4),b(" ",d(5,1,"GROUP_DETAIL.SETTINGS.APPLICATION_FORM.SETTINGS_BUTTON")," "))}function as(t,r){t&1&&(a(0,"span")(1,"mat-icon",29),m(2,"info"),s(),m(3),c(4,"translate"),s()),t&2&&(p(3),b(" ",d(4,1,"GROUP_DETAIL.SETTINGS.APPLICATION_FORM.ALLOW_EMBEDDED")," "))}function ss(t,r){if(t&1&&(a(0,"div",17)(1,"div")(2,"div",18),m(3),c(4,"translate"),s(),a(5,"div")(6,"span",18),m(7),c(8,"translate"),s(),m(9,": "),a(10,"mat-icon",19),m(11,"arrow_right_alt"),s(),m(12),c(13,"translate"),c(14,"translate"),a(15,"span",20)(16,"mat-icon",21),m(17,"restore"),s(),m(18),c(19,"translate"),c(20,"translate"),s(),f(21,ns,7,5,"span",22)(22,rs,6,3,"button",23),s(),f(23,as,5,3,"span",2),s()()),t&2){let i=_(2);p(3),He(" ",d(4,9,"GROUP_DETAIL.SETTINGS.APPLICATION_FORM.MODULE_NAMES"),": ",i.applicationForm.moduleClassNames," "),p(4),y(d(8,11,"GROUP_DETAIL.SETTINGS.APPLICATION_FORM.APPLICATION_TYPE")),p(5),b(" ",i.applicationForm.automaticApproval?d(13,13,"GROUP_DETAIL.SETTINGS.APPLICATION_FORM.AUTOMATIC"):d(14,15,"GROUP_DETAIL.SETTINGS.APPLICATION_FORM.MANUAL")," , "),p(3),l("ngClass",i.autoRegistrationEnabled?"":"me-2"),p(3),b(" ",i.applicationForm.automaticApprovalExtension?d(19,17,"GROUP_DETAIL.SETTINGS.APPLICATION_FORM.AUTOMATIC"):d(20,19,"GROUP_DETAIL.SETTINGS.APPLICATION_FORM.MANUAL")," "),p(3),l("ngIf",i.autoRegistrationEnabled),p(),l("ngIf",i.editAuth),p(),l("ngIf",i.autoRegistrationEnabled)}}function ps(t,r){if(t&1){let i=T();a(0,"button",30),g("click",function(){S(i);let o=_(2);return I(o.add())}),m(1),c(2,"translate"),s()}if(t&2){let i=_(2);l("disabled",i.loadingTable),p(),b(" ",d(2,2,"GROUP_DETAIL.SETTINGS.APPLICATION_FORM.ADD_BUTTON")," ")}}function ls(t,r){if(t&1){let i=T();a(0,"button",31),g("click",function(){S(i);let o=_(2);return I(o.save())}),a(1,"i",12),m(2,"save"),s(),m(3),c(4,"translate"),s()}if(t&2){let i=_(2);l("disabled",!i.itemsChanged),p(3),b(" ",d(4,2,"VO_DETAIL.SETTINGS.APPLICATION_FORM.SAVE_BUTTON")," ")}}function ms(t,r){if(t&1){let i=T();a(0,"button",32),g("click",function(){S(i);let o=_(2);return I(o.copy())}),a(1,"i",27),m(2,"file_copy"),s(),a(3,"span",28),m(4),c(5,"translate"),s()()}t&2&&(p(4),b(" ",d(5,1,"GROUP_DETAIL.SETTINGS.APPLICATION_FORM.COPY_GROUP_BUTTON")," "))}function cs(t,r){t&1&&(a(0,"perun-web-apps-alert",33),m(1),c(2,"translate"),s()),t&2&&(p(),b(" ",d(2,1,"GROUP_DETAIL.SETTINGS.APPLICATION_FORM.DRAG_AND_DROP_INFO")," "))}function ds(t,r){t&1&&E(0,"perun-web-apps-loading-table")}var us=()=>["drag","shortname","type","disabled","hidden","preview","managegroups","edit","delete"],_s=()=>["shortname","type","disabled","hidden","preview","managegroups"];function hs(t,r){if(t&1){let i=T();a(0,"app-application-form-list",34),g("applicationFormItemsChange",function(){S(i);let o=_(2);return I(o.changeItems())}),s()}if(t&2){let i=_(2);l("loading",i.loadingTable)("applicationForm",i.applicationForm)("applicationFormItems",i.applicationFormItems)("displayedColumns",i.editAuth?Z(7,us):Z(8,_s))("refreshApplicationForm",i.refreshApplicationForm)("embeddedGroupsItemSaved",i.embeddedGroupsItemSaved)("theme","group-theme")}}function fs(t,r){if(t&1){let i=T();a(0,"div"),f(1,ss,24,21,"div",4),E(2,"mat-divider",5),a(3,"div",6)(4,"perun-web-apps-refresh-button",7),g("refresh",function(){S(i);let o=_();return I(o.updateFormItems())}),s(),f(5,ps,3,4,"button",8)(6,ls,5,4,"button",9)(7,ms,6,3,"button",10),a(8,"button",11),g("click",function(){S(i);let o=_();return I(o.preview())}),a(9,"i",12),m(10,"search"),s(),m(11),c(12,"translate"),s()(),f(13,cs,3,3,"perun-web-apps-alert",13)(14,ds,1,0,"ng-template",null,14,U),a(16,"div",15),f(17,hs,1,9,"app-application-form-list",16),s()()}if(t&2){let i=G(15),e=_();p(),l("ngIf",!e.loadingHeader),p(4),l("ngIf",e.editAuth),p(),l("ngIf",e.editAuth),p(),l("ngIf",e.editAuth),p(4),b(" ",d(12,8,"GROUP_DETAIL.SETTINGS.APPLICATION_FORM.PREVIEW_BUTTON")," "),p(2),l("ngIf",e.editAuth),p(4),l("perunWebAppsLoader",e.loadingTable)("perunWebAppsLoaderIndicator",i)}}function gs(t,r){if(t&1){let i=T();a(0,"button",37),g("click",function(){S(i);let o=_(2);return I(o.createEmptyApplicationForm())}),m(1),c(2,"translate"),s()}t&2&&(p(),b(" ",d(2,1,"GROUP_DETAIL.SETTINGS.APPLICATION_FORM.CREATE_APPLICATION_FORM")," "))}function bs(t,r){if(t&1&&(a(0,"div")(1,"perun-web-apps-alert",35),m(2),c(3,"translate"),s(),f(4,gs,3,3,"button",36),s()),t&2){let i=_();p(2),y(d(3,2,"GROUP_DETAIL.SETTINGS.APPLICATION_FORM.NO_APPLICATION_FORM")),p(2),l("ngIf",i.createEmptyForm)}}var su=(()=>{let r=class r{constructor(e,o,n,u,v,R,L,M,k){this.registrarManager=e,this.dialog=o,this.notificator=n,this.translate=u,this.apiRequest=v,this.router=R,this.guiAuthResolver=L,this.attributesManager=M,this.entityStorageService=k,this.loadingHeader=!1,this.loadingTable=!1,this.applicationFormItems=[],this.noApplicationForm=!1,this.itemsChanged=!1,this.editAuth=!1,this.createEmptyForm=!1,this.refreshApplicationForm=!1,this.embeddedGroupsItemSaved=!1,this.idCounter=-1}ngOnInit(){this.loadingHeader=!0,this.loadingTable=!0,this.group=this.entityStorageService.getEntity(),this.setAuth(),this.apiRequest.dontHandleErrorForNext(),this.registrarManager.getGroupApplicationForm(this.group.id).subscribe({next:e=>{this.applicationForm=e,this.registrarManager.getFormItemsForGroup(this.group.id).subscribe({next:o=>{this.applicationFormItems=o,this.embeddedGroupsItemSaved=o.filter(n=>n.type==="EMBEDDED_GROUP_APPLICATION").length>0,this.attributesManager.getGroupAttributeByName(this.group.id,"urn:perun:group:attribute-def:virt:autoRegistrationEnabled").subscribe(n=>{this.autoRegistrationEnabled=!!n.value,this.loadingHeader=!1,this.loadingTable=!1})},error:()=>{this.loadingHeader=!1,this.loadingTable=!1}})},error:e=>{e.name==="FormNotExistsException"?(this.noApplicationForm=!0,this.loadingHeader=!1,this.loadingTable=!1):this.notificator.showRPCError(e)}})}setAuth(){this.editAuth=this.guiAuthResolver.isAuthorized("group-updateFormItems_ApplicationForm_List<ApplicationFormItem>_policy",[this.group]),this.createEmptyForm=this.guiAuthResolver.isAuthorized("createApplicationFormInGroup_Group_policy",[this.group])}add(){let e=C();e.width="500px",e.data={applicationFormItems:this.applicationFormItems,fakeId:this.idCounter--},this.dialog.open(Kt,e).afterClosed().subscribe(n=>{n&&(this.applicationFormItems=Object.assign([],n[0]),e=C(),e.width="600px",e.height="600px",e.data={voId:this.group.voId,groupId:this.group.id,applicationFormItem:n[1],theme:"group-theme",allItems:this.applicationFormItems},this.dialog.open(it,e),this.itemsChanged=!0)})}copy(){let e=C();e.width="500px",e.data={voId:this.group.voId,groupId:this.group.id,theme:"group-theme"},this.dialog.open(Qt,e).afterClosed().subscribe(n=>{n&&this.updateFormItems()})}settings(){let e=C();e.width="400px",e.data={entity:"group",applicationForm:this.applicationForm,theme:"group-theme",autoRegistrationEnabled:this.autoRegistrationEnabled},this.dialog.open(Yt,e).afterClosed().subscribe(n=>{n&&(this.translate.get("GROUP_DETAIL.SETTINGS.APPLICATION_FORM.CHANGE_SETTINGS_SUCCESS").subscribe(u=>{this.notificator.showSuccess(u)}),this.applicationForm=n)})}preview(){this.router.navigate(["/organizations",this.group.voId,"groups",this.group.id,"settings","applicationForm","preview"],{queryParams:{applicationFormItems:JSON.stringify(this.applicationFormItems)},queryParamsHandling:"merge"})}updateFormItems(){this.loadingTable=!0,this.refreshApplicationForm=!0,this.registrarManager.getFormItemsForGroup(this.group.id).subscribe({next:e=>{this.applicationFormItems=e,this.embeddedGroupsItemSaved=e.filter(o=>o.type==="EMBEDDED_GROUP_APPLICATION").length>0,this.itemsChanged=!1,this.refreshApplicationForm=!1,this.loadingTable=!1},error:()=>this.loadingTable=!1})}changeItems(){this.itemsChanged=!0}createEmptyApplicationForm(){this.registrarManager.createApplicationFormInGroup(this.group.id).subscribe(()=>{this.noApplicationForm=!1,this.ngOnInit()})}save(){let e=0;for(let o of this.applicationFormItems)o.ordnum=e,o.forDelete||e++;this.registrarManager.updateFormItemsForGroup({group:this.group.id,items:this.applicationFormItems}).subscribe(()=>{this.translate.get("VO_DETAIL.SETTINGS.APPLICATION_FORM.CHANGE_APPLICATION_FORM_ITEMS_SUCCESS").subscribe(o=>{this.notificator.showSuccess(o)}),this.updateFormItems()})}clear(){this.applicationFormItems=[],this.itemsChanged=!0}};r.id="GroupSettingsApplicationFormComponent",r.\u0275fac=function(o){return new(o||r)(h(be),h(B),h(le),h(ht),h(Ie),h($e),h(F),h(Le),h(N))},r.\u0275cmp=x({type:r,selectors:[["app-group-settings-application-form"]],viewQuery:function(o,n){if(o&1&&ne(is,5),o&2){let u;re(u=ae())&&(n.autoRegToggle=u.first)}},hostVars:2,hostBindings:function(o,n){o&2&&w("router-component",n.true)},decls:6,vars:6,consts:[[1,"page-subtitle"],["class","ms-auto me-auto",4,"ngIf"],[4,"ngIf"],[1,"ms-auto","me-auto"],["class","d-flex w-75",4,"ngIf"],[1,"mb-2","mt-2"],[1,"w-100","d-flex"],[3,"refresh"],["color","accent","class","me-2 action-button","data-cy","add-form-item","mat-flat-button","",3,"disabled","click",4,"ngIf"],["color","accent","class","me-2","data-cy","save-application-form","mat-flat-button","",3,"disabled","click",4,"ngIf"],["class","me-2 action-button","mat-stroked-button","",3,"click",4,"ngIf"],["mat-stroked-button","",3,"click"],[1,"material-icons"],["alert_type","info",4,"ngIf"],["spinner",""],[1,"position-relative","table-min-height"],[3,"loading","applicationForm","applicationFormItems","displayedColumns","refreshApplicationForm","embeddedGroupsItemSaved","theme","applicationFormItemsChange",4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],[1,"d-flex","w-75"],[1,"fw-bold"],["matTooltip","Initial",1,"align-middle"],[3,"ngClass"],["matTooltip","Extension",1,"align-middle"],["class","me-2",4,"ngIf"],["class","ms-2 action-button","mat-stroked-button","",3,"click",4,"ngIf"],[1,"me-2"],["matTooltip","Embedded",1,"align-middle"],["mat-stroked-button","",1,"ms-2","action-button",3,"click"],[1,"material-icons","align-middle"],[1,"align-middle"],[1,"align-bottom"],["color","accent","data-cy","add-form-item","mat-flat-button","",1,"me-2","action-button",3,"disabled","click"],["color","accent","data-cy","save-application-form","mat-flat-button","",1,"me-2",3,"disabled","click"],["mat-stroked-button","",1,"me-2","action-button",3,"click"],["alert_type","info"],[3,"loading","applicationForm","applicationFormItems","displayedColumns","refreshApplicationForm","embeddedGroupsItemSaved","theme","applicationFormItemsChange"],["alert_type","warn"],["data-cy","create-empty-form","mat-stroked-button","",3,"click",4,"ngIf"],["data-cy","create-empty-form","mat-stroked-button","",3,"click"]],template:function(o,n){o&1&&(a(0,"h1",0),m(1),c(2,"translate"),s(),f(3,os,1,0,"mat-spinner",1)(4,fs,18,10,"div",2)(5,bs,5,4,"div",2)),o&2&&(p(),b(" ",d(2,4,"GROUP_DETAIL.SETTINGS.APPLICATION_FORM.TITLE"),`
`),p(2),l("ngIf",n.loadingHeader),p(),l("ngIf",!n.noApplicationForm),p(),l("ngIf",!n.loadingTable&&n.noApplicationForm))},dependencies:[dt,P,Se,z,qe,Y,We,Ge,K,W,Q,Zt,V]});let t=r;return t})();function vs(t,r){if(t&1){let i=T();a(0,"span",9),c(1,"translate"),a(2,"button",10),g("click",function(){S(i);let o=_();return I(o.onDelete())}),m(3),c(4,"translate"),s()()}if(t&2){let i=r.ngIf,e=_();D("matTooltip",d(1,4,"GROUP_DETAIL.SETTINGS.RELATIONS.DELETE_TOOLTIP")),l("matTooltipDisabled",e.loading||e.selection.selected.length===0||i.removeAuth),p(2),l("disabled",e.loading||e.selection.selected.length===0||!i.removeAuth||e.reverse),p(),b(" ",d(4,6,"GROUP_DETAIL.SETTINGS.RELATIONS.DELETE")," ")}}function Ss(t,r){t&1&&E(0,"perun-web-apps-loading-table")}var Is=()=>["select","id","vo","name","description"];function Ts(t,r){if(t&1&&E(0,"perun-web-apps-groups-list",11),t&2){let i=_();l("loading",i.loading)("groups",i.groups)("parentGroup",i.group)("disableHeadCheckbox",!0)("selection",i.selection)("displayedColumns",Z(9,Is))("filter",i.filterValue)("tableId",i.tableId)("cacheSubject",i.cacheSubject)}}var Es=t=>({removeAuth:t}),Au=(()=>{let r=class r{constructor(e,o,n,u,v,R){this.groupService=e,this.dialog=o,this.entityStorageService=n,this.authResolver=u,this.cacheHelperService=v,this.destroyRef=R,this.selection=new q(!0,[],!0,(L,M)=>L.id===M.id),this.groups=[],this.reverse=!1,this.filterValue="",this.tableId=Zi,this.removeAuth$=this.selection.changed.pipe(_e(L=>L.source.selected.reduce((M,k)=>M&&this.authResolver.isAuthorized("result-removeGroupUnion_Group_Group_policy",[{id:this.group.id,beanName:"Group",voId:this.group.voId}])&&this.authResolver.isAuthorized("operand-removeGroupUnion_Group_Group_policy",[k]),!0))),this.cacheSubject=new O(!0)}ngOnInit(){this.group=this.entityStorageService.getEntity(),this.refreshTable(),this.cacheHelperService.refreshComponentCachedData().pipe(H(this.destroyRef)).subscribe(e=>{e===r.id&&this.refreshTable()})}onCreate(){let e=C();e.width="1050px",e.data={groups:this.groups,theme:"group-theme",group:this.group,voId:this.group.voId,reverse:this.reverse},this.dialog.open(To,e).afterClosed().subscribe(n=>{n&&this.refreshTable()})}onDelete(){let e=C();e.width="450px",e.data={groups:this.selection.selected,theme:"group-theme",groupId:this.group.id,reverse:this.reverse},this.dialog.open(Eo,e).afterClosed().subscribe(n=>{n&&this.refreshTable()})}refreshTable(){this.loading=!0,this.cacheSubject.next(!0),this.selection.clear(),this.groupService.getGroupUnions(this.group.id,this.reverse).subscribe({next:e=>{this.groups=e,this.loading=!1},error:()=>this.loading=!1})}applyFilter(e){this.filterValue=e,this.selection.clear()}showReverseUnions(){this.reverse=!this.reverse,this.refreshTable()}};r.id="GroupSettingsRelationsComponent",r.\u0275fac=function(o){return new(o||r)(h(de),h(B),h(N),h(F),h($),h(j))},r.\u0275cmp=x({type:r,selectors:[["app-group-settings-relations"]],hostVars:2,hostBindings:function(o,n){o&2&&w("router-component",n.true)},decls:18,vars:18,consts:[[1,"page-subtitle"],[3,"refresh"],["color","accent","mat-flat-button","",1,"me-2","action-button",3,"disabled","click"],[3,"matTooltip","matTooltipDisabled",4,"ngIf"],[3,"placeholder","filter"],[3,"change"],["spinner",""],[1,"position-relative","table-min-height"],[3,"loading","groups","parentGroup","disableHeadCheckbox","selection","displayedColumns","filter","tableId","cacheSubject",4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],[3,"matTooltip","matTooltipDisabled"],["color","warn","mat-flat-button","",1,"me-2",3,"disabled","click"],[3,"loading","groups","parentGroup","disableHeadCheckbox","selection","displayedColumns","filter","tableId","cacheSubject"]],template:function(o,n){if(o&1&&(a(0,"div")(1,"h1",0),m(2),c(3,"translate"),s(),a(4,"perun-web-apps-refresh-button",1),g("refresh",function(){return n.refreshTable()}),s(),a(5,"button",2),g("click",function(){return n.onCreate()}),m(6),c(7,"translate"),s(),f(8,vs,5,8,"span",3),c(9,"async"),a(10,"perun-web-apps-debounce-filter",4),g("filter",function(v){return n.applyFilter(v)}),s(),a(11,"mat-checkbox",5),g("change",function(){return n.showReverseUnions()}),m(12),c(13,"translate"),s(),f(14,Ss,1,0,"ng-template",null,6,U),a(16,"div",7),f(17,Ts,1,10,"perun-web-apps-groups-list",8),s()()),o&2){let u=G(15);p(2),y(d(3,8,"GROUP_DETAIL.SETTINGS.RELATIONS.TITLE")),p(3),l("disabled",n.reverse),p(),b(" ",d(7,10,"GROUP_DETAIL.SETTINGS.RELATIONS.CREATE")," "),p(2),l("ngIf",Ae(16,Es,d(9,12,n.removeAuth$))),p(2),l("placeholder","GROUP_DETAIL.SETTINGS.RELATIONS.FILTER"),p(2),y(d(13,14,"GROUP_DETAIL.SETTINGS.RELATIONS.REVERSE_UNIONS")),p(5),l("perunWebAppsLoader",n.loading)("perunWebAppsLoaderIndicator",u)}},dependencies:[P,z,Si,Y,K,Ne,W,J,Q,pe,V]});let t=r;return t})();function Cs(t,r){if(t&1&&(a(0,"button",13),m(1),c(2,"translate"),s()),t&2){let i=_(),e=G(9);l("disabled",i.findSponsorsAuth&&!i.sponsorshipIsPossible)("matMenuTriggerFor",e),p(),b(" ",d(2,3,"VO_DETAIL.SETTINGS.SPONSORED_MEMBERS.CREATE")," ")}}function As(t,r){if(t&1){let i=T();a(0,"button",14),g("click",function(){S(i);let o=_();return I(o.onCreate())}),m(1),c(2,"translate"),s()}t&2&&(p(),b(" ",d(2,1,"VO_DETAIL.SETTINGS.SPONSORED_MEMBERS.CREATE_ONE")," "))}function Rs(t,r){if(t&1){let i=T();a(0,"button",15),g("click",function(){S(i);let o=_();return I(o.onGenerate())}),m(1),c(2,"translate"),s()}t&2&&(p(),b(" ",d(2,1,"VO_DETAIL.SETTINGS.SPONSORED_MEMBERS.GENERATE")," "))}function xs(t,r){if(t&1){let i=T();a(0,"button",16),g("click",function(){S(i);let o=_();return I(o.onSponsorExistingMember())}),m(1),c(2,"translate"),s()}if(t&2){let i=_();l("disabled",i.findSponsorsAuth&&!i.sponsorshipIsPossible),p(),b(" ",d(2,2,"VO_DETAIL.SETTINGS.SPONSORED_MEMBERS.SPONSOR_EXISTING")," ")}}function Ms(t,r){if(t&1){let i=T();a(0,"button",17),g("click",function(){S(i);let o=_();return I(o.copySponsoredMembers())}),m(1),c(2,"translate"),s()}if(t&2){let i=_();l("disabled",i.findSponsorsAuth&&!i.sponsorshipIsPossible),p(),b(" ",d(2,2,"VO_DETAIL.SETTINGS.SPONSORED_MEMBERS.COPY")," ")}}function ys(t,r){t&1&&E(0,"perun-web-apps-loading-table")}function Ds(t,r){if(t&1){let i=T();a(0,"app-sponsored-members-list",18),g("refreshTable",function(){S(i);let o=_();return I(o.refresh())}),s()}if(t&2){let i=_();l("tableLoading",i.loading)("disableRouting",!i.routeAuth)("selection",i.selection)("cachedSubject",i.cachedSubject)("filterValue",i.searchString)("sponsoredMembers",i.members)("tableId",i.tableId)}}var Yu=(()=>{let r=class r{constructor(e,o,n,u,v,R,L,M,k){this.membersManager=e,this.dialog=o,this.authResolver=n,this.storeService=u,this.authzResolver=v,this.entityStorageService=R,this.findSponsors=L,this.cacheHelperService=M,this.destroyRef=k,this.members=[],this.sponsorshipIsPossible=!1,this.selection=new q(!0,[],!0,(X,fe)=>X.member?.id===fe.member?.id),this.cachedSubject=new O(!0),this.searchString="",this.loading=!1,this.tableId=to,this.attrNames=[A.USER_DEF_PREFERRED_MAIL]}ngOnInit(){this.loading=!0,this.vo=this.entityStorageService.getEntity(),this.attrNames=this.attrNames.concat(this.storeService.getLoginAttributeNames()),this.setAuthRights(),this.findSponsorsAuth=this.findSponsors.findSponsorsAuth(this.vo),this.findSponsorsAuth?this.findSponsors.someSponsorExists(this.vo.id).subscribe(e=>{this.sponsorshipIsPossible=e,this.refresh()}):this.refresh(),this.cacheHelperService.refreshComponentCachedData().pipe(H(this.destroyRef)).subscribe(e=>{e===r.id&&this.refresh()})}setAuthRights(){this.createAuth=this.authResolver.isAuthorized("createSponsoredMember_Vo_String_Map<String_String>_String_User_LocalDate_policy",[this.vo,this.storeService.getPerunPrincipal().user]),this.generateAuth=this.authResolver.isAuthorized("createSponsoredMembers_Vo_String_List<String>_User_policy",[this.vo,this.storeService.getPerunPrincipal().user]),this.setSponsorshipAuth=this.authResolver.isAuthorized("setSponsorshipForMember_Member_User_LocalDate_policy",[this.vo,this.storeService.getPerunPrincipal().user]),this.members!==null&&this.members.length!==0&&(this.routeAuth=this.authResolver.isAuthorized("getMemberById_int_policy",[this.vo,this.members[0].member]))}onCreate(){let e=C();e.width="750px",e.data={entityId:this.vo.id,voId:this.vo.id,theme:"vo-theme"},this.dialog.open(Co,e).afterClosed().subscribe(n=>{n&&(this.loading=!0,this.authzResolver.getPerunPrincipal().subscribe(u=>{this.storeService.setPerunPrincipal(u),this.refresh()}))})}onGenerate(){let e=C();e.width="750px",e.data={voId:this.vo.id,theme:"vo-theme"},this.dialog.open(Ao,e).afterClosed().subscribe(n=>{n&&(this.loading=!0,this.authzResolver.getPerunPrincipal().subscribe(u=>{this.storeService.setPerunPrincipal(u),this.refresh()}))})}onSponsorExistingMember(){let e=C();e.width="750px",e.data={voId:this.vo.id,theme:"vo-theme",findSponsorsAuth:this.findSponsorsAuth},this.dialog.open(Ro,e).afterClosed().subscribe(n=>{n&&(this.loading=!0,this.authzResolver.getPerunPrincipal().subscribe(u=>{this.storeService.setPerunPrincipal(u),this.refresh()}))})}copySponsoredMembers(){let e=C();e.width="1000px",e.data={voId:this.vo.id,theme:"vo-theme",findSponsorsAuth:this.findSponsorsAuth},this.dialog.open(Mo,e).afterClosed().subscribe(n=>{n&&(this.loading=!0,this.authzResolver.getPerunPrincipal().subscribe(u=>{this.storeService.setPerunPrincipal(u),this.refresh()}))})}refresh(){this.loading=!0,this.membersManager.getSponsoredMembersAndTheirSponsors(this.vo.id,this.attrNames).subscribe(e=>{this.selection.clear(),this.cachedSubject.next(!0),this.members=e,this.setAuthRights(),this.loading=!1})}applyFilter(e){this.searchString=e,this.refresh()}};r.id="VoSponsoredMembersComponent",r.\u0275fac=function(o){return new(o||r)(h(ge),h(B),h(F),h(we),h(ut),h(N),h(Pi),h($),h(j))},r.\u0275cmp=x({type:r,selectors:[["app-vo-settings-sponsored-members"]],hostVars:2,hostBindings:function(o,n){o&2&&w("router-component",n.true)},decls:19,vars:15,consts:[[1,"page-subtitle"],[3,"refresh"],["matTooltipPosition","above",3,"matTooltip","matTooltipDisabled"],["data-cy","sponsor-dropdown-button","class","me-2 dropdown-toggle","color","accent","mat-flat-button","",3,"disabled","matMenuTriggerFor",4,"ngIf"],["menu","matMenu"],["data-cy","sponsor-new-button","class","action-button","mat-menu-item","",3,"click",4,"ngIf"],["data-cy","sponsor-csv-button","class","action-button","mat-menu-item","",3,"click",4,"ngIf"],["data-cy","sponsor-existing-button","color","accent","class","me-2 action-button","mat-flat-button","",3,"disabled","click",4,"ngIf"],["color","accent","class","me-2 action-button","mat-flat-button","",3,"disabled","click",4,"ngIf"],[3,"placeholder","filter"],["spinner",""],[1,"position-relative","table-min-height"],[3,"tableLoading","disableRouting","selection","cachedSubject","filterValue","sponsoredMembers","tableId","refreshTable",4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],["data-cy","sponsor-dropdown-button","color","accent","mat-flat-button","",1,"me-2","dropdown-toggle",3,"disabled","matMenuTriggerFor"],["data-cy","sponsor-new-button","mat-menu-item","",1,"action-button",3,"click"],["data-cy","sponsor-csv-button","mat-menu-item","",1,"action-button",3,"click"],["data-cy","sponsor-existing-button","color","accent","mat-flat-button","",1,"me-2","action-button",3,"disabled","click"],["color","accent","mat-flat-button","",1,"me-2","action-button",3,"disabled","click"],[3,"tableLoading","disableRouting","selection","cachedSubject","filterValue","sponsoredMembers","tableId","refreshTable"]],template:function(o,n){if(o&1&&(a(0,"div")(1,"h1",0),m(2),c(3,"translate"),s(),a(4,"perun-web-apps-refresh-button",1),g("refresh",function(){return n.refresh()}),s(),a(5,"span",2),c(6,"translate"),f(7,Cs,3,5,"button",3),s(),a(8,"mat-menu",null,4),f(10,As,3,3,"button",5)(11,Rs,3,3,"button",6),s(),f(12,xs,3,4,"button",7)(13,Ms,3,4,"button",8),a(14,"perun-web-apps-debounce-filter",9),g("filter",function(v){return n.applyFilter(v)}),s(),f(15,ys,1,0,"ng-template",null,10,U),a(17,"div",11),f(18,Ds,1,7,"app-sponsored-members-list",12),s()()),o&2){let u=G(16);p(2),y(d(3,11,"VO_DETAIL.SETTINGS.SPONSORED_MEMBERS.TITLE")),p(3),D("matTooltip",d(6,13,"VO_DETAIL.SETTINGS.SPONSORED_MEMBERS.NO_SPONSORS")),l("matTooltipDisabled",!(n.findSponsorsAuth&&!n.sponsorshipIsPossible)),p(2),l("ngIf",n.createAuth||n.generateAuth),p(3),l("ngIf",n.createAuth),p(),l("ngIf",n.generateAuth),p(),l("ngIf",n.setSponsorshipAuth),p(),l("ngIf",n.setSponsorshipAuth),p(),l("placeholder","VO_DETAIL.SETTINGS.SPONSORED_MEMBERS.FILTER"),p(4),l("perunWebAppsLoader",n.loading)("perunWebAppsLoaderIndicator",u)}},dependencies:[P,z,Y,Qe,Ye,Ke,xo,K,W,J,Q,V]});let t=r;return t})();var r0=(()=>{let r=class r{constructor(e,o,n,u,v){this.authzResolverService=e,this.entityStorageService=o,this.roleService=n,this.cacheHelperService=u,this.destroyRef=v,this.roles=new Map}ngOnInit(){this.groupId=this.entityStorageService.getEntity().id,this.getData(),this.cacheHelperService.refreshComponentCachedData().pipe(H(this.destroyRef)).subscribe(e=>{e===r.id&&this.getData()})}getData(){this.outerLoading=!0,this.roles.clear(),this.authzResolverService.getGroupRoles(this.groupId).subscribe(e=>{let o=Object.keys(e).map(n=>n.toUpperCase());this.roles=this.roleService.prepareRoles(e,o),this.outerLoading=!1})}};r.id="GroupRolesComponent",r.\u0275fac=function(o){return new(o||r)(h(ut),h(N),h(Vi),h($),h(j))},r.\u0275cmp=x({type:r,selectors:[["app-group-roles"]],hostVars:2,hostBindings:function(o,n){o&2&&w("router-component",n.true)},decls:1,vars:5,consts:[[3,"outerLoading","roles","entityId","entityType","showDescription","reload","startLoading"]],template:function(o,n){o&1&&(a(0,"app-perun-web-apps-roles-page",0),g("reload",function(){return n.getData()})("startLoading",function(){return n.outerLoading=!0}),s()),o&2&&l("outerLoading",n.outerLoading)("roles",n.roles)("entityId",n.groupId)("entityType","GROUP")("showDescription",!0)},dependencies:[yo]});let t=r;return t})();export{Xs as a,bp as b,Go as c,ml as d,Ll as e,Kl as f,mm as g,Cm as h,Po as i,Ec as j,jc as k,vd as l,Od as m,Wd as n,su as o,Au as p,Yu as q,r0 as r};
