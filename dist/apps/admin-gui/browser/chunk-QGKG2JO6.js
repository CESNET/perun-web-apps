import{a as et}from"./chunk-HQHC3UUF.js";import{a as tt,b as it,c as nt}from"./chunk-O62ENX2P.js";import{a as Ze}from"./chunk-EIFLC2UB.js";import{a as z,b as Z}from"./chunk-C3YVI7GE.js";import{$b as ue,Ad as De,Ba as b,Bi as Ve,Ca as I,Cc as M,Cd as $,Da as E,Dc as T,Fi as Qe,Gf as Oe,Ha as F,Ia as V,Ic as ve,Ja as Q,Ka as x,La as re,Lb as me,Mc as Se,Mi as Y,Na as g,Ni as We,Oa as R,Oc as he,Of as je,Pa as _,Pf as Fe,Pj as He,Qa as oe,Qd as H,Qj as Ye,Ra as se,Rb as k,Rj as Ke,S,T as h,Tb as le,Ui as qe,Wa as J,Wi as K,Xf as v,Yi as $e,Za as ae,Ze as ke,_a as X,aa as s,ad as Ie,bd as N,cb as d,cd as w,ck as ze,d as ne,db as f,de as Le,ea as r,ed as Ce,fa as l,fd as _e,fe as Ue,gd as ye,ge as xe,gk as Je,hc as de,hd as be,he as Re,ib as W,ie as G,ik as Xe,jb as ce,jc as fe,je as Ne,ka as U,kd as Ee,ke as Ge,ld as Me,le as Pe,me as Be,mf as P,nc as ge,ob as pe,qa as O,ra as j,tb as u,va as p,wa as a,wd as Te,xa as c,xd as q,ya as m,yd as we,zd as Ae}from"./chunk-353QRQI4.js";import"./chunk-TSRGIXR5.js";var St=()=>({color:"black"}),rt=i=>["/service-identities",i];function ht(i,L){i&1&&m(0,"mat-spinner",1)}function It(i,L){if(i&1){let e=b();a(0,"button",10),d(1,"translate"),I("click",function(){S(e);let n=E(2);return h(n.editUser())}),a(2,"mat-icon"),g(3,"edit"),c()()}i&2&&p("matTooltip",J(f(1,2,"MENU_ITEMS.USER.EDIT")))}function Ct(i,L){if(i&1){let e=b();a(0,"div",2),m(1,"mat-icon",3),d(2,"translate"),a(3,"div",4)(4,"div",5)(5,"a",6),I("auxclick",function(n){return S(e),h(n.preventDefault())}),g(6),d(7,"userFullName"),c(),a(8,"span",7),g(9),c(),O(10,It,4,4,"button",8),c(),a(11,"div"),g(12),d(13,"translate"),c(),a(14,"span",9),g(15),d(16,"translate"),d(17,"translate"),c()()(),m(18,"app-animated-router-outlet")}if(i&2){let e=E();s(),p("matTooltip",J(f(2,13,"MENU_ITEMS.USER.ENTITY")))("ngStyle",ae(23,St)),s(4),p("perunWebAppsMiddleClickRouterLink",X(24,rt,e.user.id.toString()))("routerLink",X(26,rt,e.user.id)),s(),_(" ",f(7,15,e.user)," "),s(3),_(" \xA0#",e.user.id," "),s(),j(e.authResolver.isPerunAdmin()?10:-1),s(2),oe("",f(13,17,"ADMIN_USER.UUID"),": ",e.user.uuid),s(3),se(" ",f(16,19,"MENU_ITEMS.USER.ENTITY"),", ",f(17,21,"MENU_ITEMS.USER.USER_TYPE"),": ",e.getUserType()," ")}}var st=(()=>{class i{constructor(e,t,n,o,C,y,B){this.sideMenuService=e,this.usersService=t,this.sideMenuItemService=n,this.route=o,this.dialog=C,this.authResolver=y,this.entityStorageService=B,this.loading=!1}ngOnInit(){this.loading=!0,this.route.params.subscribe(e=>{let t=Number(e.userId);this.entityStorageService.setEntityAndPathParam({id:t,beanName:"User"},Le.User),this.usersService.getUserById(t).subscribe({next:n=>{this.user=n;let o=this.sideMenuItemService.parseServiceIdentity(n);this.sideMenuService.setServiceIdentitiesItems([o]),this.loading=!1},error:()=>this.loading=!1})})}getUserType(){return this.user.serviceUser?"Service":"Person"}editUser(){let e=P();e.width="450px",e.data={theme:"admin-theme",user:this.user},this.dialog.open(tt,e).afterClosed().subscribe(n=>{n&&this.usersService.getUserById(this.user.id).subscribe(o=>{this.user=o})})}static{this.\u0275fac=function(t){return new(t||i)(r(Xe),r(H),r(Ze),r(ve),r(G),r(Ue),r(v))}}static{this.\u0275cmp=l({type:i,selectors:[["app-service-identity-detail-page"]],decls:4,vars:2,consts:[[1,"container-fluid","ps-xl-5","pe-xl-5","user-theme"],[1,"me-auto","ms-auto"],[1,"d-flex","page-title-headtitle"],["svgIcon","perun-service-identity",1,"perun-icon","perun-icon-detail",3,"matTooltip","ngStyle"],[1,"page-title-block"],[1,"page-title-headline","d-flex","align-items-center"],[1,"user-link",3,"auxclick","perunWebAppsMiddleClickRouterLink","routerLink"],[1,"text-muted"],["mat-icon-button","",3,"matTooltip"],[1,"mt-1","entity-info"],["mat-icon-button","",3,"click","matTooltip"]],template:function(t,n){t&1&&(a(0,"div",0),m(1,"perun-web-apps-back-button"),O(2,ht,1,0,"mat-spinner",1),O(3,Ct,19,28),c()),t&2&&(s(2),j(n.loading?2:-1),s(),j(!n.loading&&n.user!==void 0?3:-1))},dependencies:[u,pe,w,Ie,be,ye,Te,Je,We,we,z,he,Se,_e,Ce,T,me,M,Ae],encapsulation:2})}}return i})();var at=(()=>{class i{constructor(e){this.entityStorageService=e,this.navItems=[],this.authenticationItems=[]}ngOnInit(){this.serviceAccount=this.entityStorageService.getEntity(),this.initNavItems()}initNavItems(){this.navItems=[{cssIcon:"perun-manager",url:`/service-identities/${this.serviceAccount.id}/associated-users`,label:"MENU_ITEMS.USER.ASSOCIATED_USERS",style:"user-btn"},{cssIcon:"perun-statistics",url:`/service-identities/${this.serviceAccount.id}/data-quotas`,label:"MENU_ITEMS.USER.DATA_QUOTAS",style:"user-btn"},{cssIcon:"perun-notification",url:`/service-identities/${this.serviceAccount.id}/mailing-lists`,label:"MENU_ITEMS.USER.MAILING_LISTS",style:"user-btn"}],this.authenticationItems=[{cssIcon:"perun-logins",url:`/service-identities/${this.serviceAccount.id}/authentication/logins`,label:"MENU_ITEMS.USER.LOGINS",style:"user-btn"},{cssIcon:"perun-certificates",url:`/service-identities/${this.serviceAccount.id}/authentication/certificates`,label:"MENU_ITEMS.USER.CERTIFICATES",style:"user-btn"},{cssIcon:"perun-key",url:`/service-identities/${this.serviceAccount.id}/authentication/ssh-keys`,label:"MENU_ITEMS.USER.SSH_KEYS",style:"user-btn"}]}static{this.\u0275fac=function(t){return new(t||i)(r(v))}}static{this.\u0275cmp=l({type:i,selectors:[["app-service-identity-overview"]],decls:2,vars:4,consts:[[3,"items"],[3,"items","title","sectionId"]],template:function(t,n){t&1&&m(0,"perun-web-apps-menu-buttons-field",0)(1,"perun-web-apps-expandable-tiles",1),t&2&&(p("items",n.navItems),s(),p("items",n.authenticationItems)("title","MENU_ITEMS.USER.AUTHENTICATION")("sectionId","authentication"))},dependencies:[u,K,ze],encapsulation:2})}}return i})();var ct=(()=>{class i{constructor(e){this.entityStorageService=e}ngOnInit(){this.user=this.entityStorageService.getEntity()}static{this.\u0275fac=function(t){return new(t||i)(r(v))}}static{this.\u0275cmp=l({type:i,selectors:[["app-perun-web-apps-user-settings-mailing-lists"]],decls:1,vars:2,consts:[[3,"user","isService"]],template:function(t,n){t&1&&m(0,"perun-web-apps-mailing-lists",0),t&2&&p("user",n.user)("isService",!0)},dependencies:[u,He],encapsulation:2})}}return i})();var pt=(()=>{class i{constructor(e){this.entityStorageService=e}ngOnInit(){this.user=this.entityStorageService.getEntity()}static{this.\u0275fac=function(t){return new(t||i)(r(v))}}static{this.\u0275cmp=l({type:i,selectors:[["app-perun-web-apps-user-settings-data-quotas"]],decls:1,vars:1,consts:[[3,"user"]],template:function(t,n){t&1&&m(0,"perun-web-apps-data-quotas",0),t&2&&p("user",n.user)},dependencies:[u,Ye],encapsulation:2})}}return i})();var mt=(()=>{class i{constructor(e){this.entityStorageService=e,this.navItems=[]}ngOnInit(){this.serviceAccount=this.entityStorageService.getEntity(),this.initNavItems()}initNavItems(){this.navItems=[{cssIcon:"perun-logins",url:`/service-identities/${this.serviceAccount.id}/authentication/logins`,label:"MENU_ITEMS.USER.LOGINS",style:"user-btn"},{cssIcon:"perun-certificates",url:`/service-identities/${this.serviceAccount.id}/authentication/certificates`,label:"MENU_ITEMS.USER.CERTIFICATES",style:"user-btn"},{cssIcon:"perun-key",url:`/service-identities/${this.serviceAccount.id}/authentication/ssh-keys`,label:"MENU_ITEMS.USER.SSH_KEYS",style:"user-btn"}]}static{this.\u0275fac=function(t){return new(t||i)(r(v))}}static{this.\u0275cmp=l({type:i,selectors:[["app-service-identity-authentication-overview"]],decls:1,vars:1,consts:[[3,"items"]],template:function(t,n){t&1&&m(0,"perun-web-apps-menu-buttons-field",0),t&2&&p("items",n.navItems)},dependencies:[u,K],encapsulation:2})}}return i})();function _t(i,L){i&1&&m(0,"perun-web-apps-loading-dialog")}function yt(i,L){if(i&1){let e=b();a(0,"div")(1,"h1",3),g(2),d(3,"translate"),c(),a(4,"div",4),m(5,"app-login-password-form-with-generate-option",5),c(),a(6,"div",6)(7,"button",7),I("click",function(){S(e);let n=E();return h(n.onCancel())}),g(8),d(9,"translate"),c(),a(10,"button",8),I("click",function(){S(e);let n=E();return h(n.onSetLogin())}),g(11),d(12,"translate"),c()()()}if(i&2){let e=E();s(2),R(f(3,6,"DIALOGS.SET_LOGIN.TITLE")),s(3),p("formGroup",e.formGroup)("filteredNamespace",e.data.filteredNamespaces),s(3),_(" ",f(9,8,"DIALOGS.SET_LOGIN.CANCEL")," "),s(2),p("disabled",e.formGroup.get("namespaceCtrl").value==="Not selected"||e.formGroup.invalid||e.formGroup.pending||e.processing),s(),_(" ",f(12,10,"DIALOGS.SET_LOGIN.SET_LOGIN")," ")}}var lt=(()=>{class i{constructor(e,t,n,o,C,y,B,gt,vt){this.dialogRef=e,this.data=t,this.formBuilder=n,this.usersManagerService=o,this.attributesManagerService=C,this.apiRequestConfiguration=y,this.notificator=B,this.translate=gt,this.cd=vt,this.formGroup=this.formBuilder.group({namespaceCtrl:["Not selected"],loginCtrl:["",[k.pattern("^[a-z][a-z0-9_-]+$"),k.maxLength(15),k.minLength(2)]],passwordCtrl:["",k.required,[Qe(null,this.usersManagerService,this.apiRequestConfiguration)]],passwordAgainCtrl:[""],generatePasswordCtrl:[!0]},{validators:Oe.passwordMatchValidator}),this.processing=!1}ngOnInit(){this.userId=this.data.userId}ngAfterViewInit(){this.cd.detectChanges()}onSetLogin(){this.processing=!0;let e=this.formGroup.value.namespaceCtrl.toLowerCase(),t=this.formGroup.value.loginCtrl;if(t)this.setLogin(e,t);else{let n=`urn:perun:user:attribute-def:def:login-namespace:${e}`;this.attributesManagerService.getUserAttributeByName(this.userId,"urn:perun:user:attribute-def:core:lastName").subscribe(o=>{let C=o.value;this.usersManagerService.generateAccountForName(e,C).subscribe({next:y=>{let B=y[n];this.setLogin(e,B)},error:()=>this.processing=!1})})}}setLogin(e,t){this.usersManagerService.setLogin(this.userId,t,e).subscribe({next:()=>{this.notificator.showSuccess(this.translate.instant("DIALOGS.SET_LOGIN.SUCCESS_LOGIN")),this.setPassword()},error:()=>{this.processing=!1}})}setPassword(){let e=this.formGroup.value.namespaceCtrl.toLowerCase(),t=this.formGroup.value.passwordCtrl;if(this.formGroup.value.generatePasswordCtrl){if(!this.formGroup.get("loginCtrl").value)return;this.usersManagerService.reserveRandomPassword(this.userId,e).subscribe({next:()=>{this.usersManagerService.validatePasswordForUser(this.userId,e).subscribe({next:()=>{this.dialogRef.close(!0)},error:()=>{this.processing=!1}})},error:()=>{this.processing=!1}})}else this.usersManagerService.reservePasswordForUser({user:this.userId,namespace:e,password:t}).subscribe({next:()=>{this.usersManagerService.validatePasswordForUser(this.userId,e).subscribe({next:()=>{this.notificator.showSuccess(this.translate.instant("DIALOGS.SET_LOGIN.SUCCESS_PASSWORD")),this.dialogRef.close(!0)},error:()=>{this.processing=!1}})},error:()=>{this.processing=!1}})}onCancel(){this.dialogRef.close(!1)}static{this.\u0275fac=function(t){return new(t||i)(r(xe),r(Re),r(de),r(H),r($),r(Fe),r(je),r(De),r(ce))}}static{this.\u0275cmp=l({type:i,selectors:[["app-perun-web-apps-set-login-dialog"]],decls:4,vars:2,consts:[["spinner",""],[1,"vo-theme","position-relative"],[4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],["mat-dialog-title",""],["mat-dialog-content","",1,"dialog-container"],[3,"formGroup","filteredNamespace"],["mat-dialog-actions",""],["mat-stroked-button","",1,"ms-auto",3,"click"],["color","accent","mat-flat-button","",1,"ms-2",3,"click","disabled"]],template:function(t,n){if(t&1&&(U(0,_t,1,0,"ng-template",null,0,W),a(2,"div",1),U(3,yt,13,12,"div",2),c()),t&2){let o=x(1);s(3),p("perunWebAppsLoader",n.processing)("perunWebAppsLoaderIndicator",o)}},dependencies:[u,w,N,fe,le,ue,Be,Ne,Pe,Ge,Me,T,q,et,M],encapsulation:2})}}return i})();var bt=["logins"],ut=(()=>{class i{constructor(e,t){this.dialog=e,this.entityStorageService=t,this.filteredNamespaces=[]}ngOnInit(){this.userId=this.entityStorageService.getEntity().id}onAdd(){let e=P();e.width="500px",e.data={userId:this.userId,filteredNamespaces:this.filteredNamespaces},this.dialog.open(lt,e).afterClosed().subscribe(n=>{n&&this.logins.refreshTable()})}static{this.\u0275fac=function(t){return new(t||i)(r(G),r(v))}}static{this.\u0275cmp=l({type:i,selectors:[["app-perun-web-apps-user-settings-logins"]],viewQuery:function(t,n){if(t&1&&F(bt,5),t&2){let o;V(o=Q())&&(n.logins=o.first)}},decls:9,vars:7,consts:[["logins",""],[1,"page-title"],[3,"refresh"],["color","accent","mat-flat-button","",1,"me-2","action-button",3,"click"],[3,"filteredNamespaces","authenticationPage"]],template:function(t,n){if(t&1){let o=b();a(0,"h1",1),g(1),d(2,"translate"),c(),a(3,"perun-web-apps-refresh-button",2),I("refresh",function(){S(o);let y=x(8);return h(y.refreshTable())}),c(),a(4,"button",3),I("click",function(){return S(o),h(n.onAdd())}),g(5),d(6,"translate"),c(),a(7,"perun-web-apps-password-reset",4,0),I("filteredNamespaces",function(y){return S(o),h(n.filteredNamespaces=y)}),c()}t&2&&(s(),R(f(2,3,"USER_DETAIL.SETTINGS.LOGINS.TITLE")),s(4),_(" ",f(6,5,"USER_DETAIL.SETTINGS.LOGINS.ADD"),`
`),s(2),p("authenticationPage",!0))},dependencies:[u,w,N,Y,T,$e,M],encapsulation:2})}}return i})();var dt=(()=>{class i{static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275cmp=l({type:i,selectors:[["app-service-identity-authentication"]],hostVars:2,hostBindings:function(t,n){t&2&&re("router-component",n.true)},decls:1,vars:0,template:function(t,n){t&1&&m(0,"app-animated-router-outlet")},dependencies:[u,z],encapsulation:2})}}return i})();var Et=["list"];function Mt(i,L){i&1&&m(0,"perun-web-apps-loading-table")}function Tt(i,L){if(i&1&&m(0,"perun-web-apps-attributes-list",7,1),i&2){let e=E();p("loading",e.loading)("attributes",e.certificates)("selection",e.selection)("cachedSubject",e.cachedSubject)("emptyListText","USER_DETAIL.SETTINGS.CERTIFICATES.EMPTY")}}var ft=(()=>{class i{constructor(e,t,n){this.entityStorageService=e,this.attributesManagerService=t,this.dialog=n,this.certificates=[],this.selection=new ge(!0,[],!0,(o,C)=>o.id===C.id),this.cachedSubject=new ne(!0)}ngOnInit(){this.userId=this.entityStorageService.getEntity().id,this.refresh()}refresh(){this.loading=!0,this.attributesManagerService.getUserAttributeByName(this.userId,ke.USER_DEF_CERTIFICATES).subscribe({next:e=>{this.certificates.push(e),this.selection.clear(),this.cachedSubject.next(!0),this.loading=!1},error:()=>{this.loading=!1}})}save(){this.list.updateMapAttributes();let e=P();e.width="450px",e.data={entityId:this.userId,entity:"user",attributes:this.selection.selected},this.dialog.open(Ve,e).afterClosed().subscribe(n=>{n&&this.refresh()})}static{this.\u0275fac=function(t){return new(t||i)(r(v),r($),r(G))}}static{this.\u0275cmp=l({type:i,selectors:[["app-service-identity-certificates"]],viewQuery:function(t,n){if(t&1&&F(Et,5),t&2){let o;V(o=Q())&&(n.list=o.first)}},decls:11,vars:9,consts:[["spinner",""],["list",""],[1,"page-title"],[1,"mt-2",3,"refresh"],["color","accent","mat-flat-button","",1,"me-2","mt-2",3,"click","disabled"],[1,"position-relative","table-min-height"],[3,"loading","attributes","selection","cachedSubject","emptyListText",4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],[3,"loading","attributes","selection","cachedSubject","emptyListText"]],template:function(t,n){if(t&1){let o=b();a(0,"h1",2),g(1),d(2,"translate"),c(),a(3,"perun-web-apps-refresh-button",3),I("refresh",function(){return S(o),h(n.refresh())}),c(),a(4,"button",4),I("click",function(){return S(o),h(n.save())}),g(5),d(6,"translate"),c(),U(7,Mt,1,0,"ng-template",null,0,W),a(9,"div",5),U(10,Tt,2,5,"perun-web-apps-attributes-list",6),c()}if(t&2){let o=x(8);s(),R(f(2,5,"USER_DETAIL.SETTINGS.CERTIFICATES.TITLE")),s(3),p("disabled",n.loading||n.selection.selected.length===0),s(),_(" ",f(6,7,"USER_DETAIL.SETTINGS.CERTIFICATES.SAVE"),`
`),s(5),p("perunWebAppsLoader",n.loading)("perunWebAppsLoaderIndicator",o)}},dependencies:[u,w,N,Y,T,q,qe,Ee,M],encapsulation:2})}}return i})();var Nn=[{path:"",component:it},{path:":userId",component:st,canActivate:[Z],canActivateChild:[Z],children:[{path:"",component:at},{path:"associated-users",component:nt},{path:"authentication",component:dt,children:[{path:"",component:mt},{path:"logins",component:ut},{path:"certificates",component:ft},{path:"ssh-keys",component:Ke}]},{path:"mailing-lists",component:ct},{path:"data-quotas",component:pt}]}];export{Nn as usersRoutes};
