import{$b as p,E as h,Eb as d,Gb as f,H as s,Ib as m,Re as v,Se as y,Ze as g,g as u,i as n,p as a,tb as l}from"./chunk-BTQUX7P4.js";var w=(()=>{let o=class o{constructor(r,i,e,t,R,b,A,I){this.authResolver=r,this.routePolicyService=i,this.router=e,this.notificator=t,this.apiRequest=R,this.memberManager=b,this.groupManager=A,this.resourceManager=I}static getBeanName(r){switch(r){case"organizations":return"Vo";case"groups":return"Group";case"facilities":return"Facility";case"services":return"Facility";case"resources":return"Resource";case"members":return"Member";default:return""}}static parseUrl(r){let i=r.slice(1).split("/").reverse(),e={key:"",entity:{id:-1,beanName:""}};for(let t of i){if(Number(t)){if(e.entity.id===-1){e.entity.id=Number(t);continue}e.key==="services-status-"&&(e.entity.id=Number(t));break}e.key=t.concat("-",e.key)}return e.key=e.key.slice(0,e.key.length-1),e.entity.beanName=o.getBeanName(e.key.split("-")[0]),e}canActivateChild(r,i){if(this.authResolver.isPerunAdminOrObserver())return!0;let e=o.parseUrl(i.url);return e.key.startsWith("members")?(this.apiRequest.dontHandleErrorForNext(),this.memberManager.getMemberById(e.entity.id).pipe(n(t=>(e.entity.userId=t.userId,e.entity.voId=t.voId,this.finalizeCanActivateChild(e))),a(t=>this.errorRedirectUrl(t)))):e.key.startsWith("groups")?(this.apiRequest.dontHandleErrorForNext(),this.groupManager.getGroupById(e.entity.id).pipe(n(t=>(e.entity.voId=t.voId,this.finalizeCanActivateChild(e))),a(t=>this.errorRedirectUrl(t)))):e.key.startsWith("resources")?(this.apiRequest.dontHandleErrorForNext(),this.resourceManager.getResourceById(e.entity.id).pipe(n(t=>(e.entity.facilityId=t.facilityId,e.entity.voId=t.voId,this.finalizeCanActivateChild(e))),a(t=>this.errorRedirectUrl(t)))):this.finalizeCanActivateChild(e)}canActivate(r,i){return this.canActivateChild(r,i)}finalizeCanActivateChild(r){return this.routePolicyService.canNavigate(r.key,r.entity)?!0:(this.notificator.showRouteError(),this.router.parseUrl("/notAuthorized"))}errorRedirectUrl(r){if(r.name==="PrivilegeException")return this.notificator.showRouteError(),u(this.router.parseUrl("/notAuthorized"))}};o.\u0275fac=function(i){return new(i||o)(s(p),s(g),s(l),s(v),s(y),s(f),s(d),s(m))},o.\u0275prov=h({token:o,factory:o.\u0275fac,providedIn:"root"});let c=o;return c})();export{w as a};
