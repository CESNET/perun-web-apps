import{e as Gt}from"./chunk-HMVCITBB.js";import{Aa as D,Ad as F,Ag as jt,Ba as N,Ca as T,Cc as R,Da as f,Dc as P,Ha as G,Hd as At,Ia as W,Ja as $,Jg as L,Ka as et,Lb as ot,Ma as O,Na as c,Oa as g,Od as yt,Of as U,Pa as u,Pc as k,Qc as Dt,Rc as Tt,S as E,Sf as Bt,T as v,V as X,W as Z,Wa as M,Wg as Ut,Xa as it,Ya as nt,_a as z,_e as Rt,aa as o,bd as gt,cb as p,cd as It,db as m,ea as _,eb as Q,fa as A,fe as Nt,gd as Et,ge as H,hd as vt,he as j,ib as at,id as B,jd as V,je as Ot,ka as h,ke as Lt,lc as lt,ld as xt,le as Mt,mc as rt,me as wt,nc as Y,oa as tt,oc as st,pc as pt,pf as Pt,pi as J,qa as x,qc as ct,qf as kt,qg as Vt,ra as b,rc as mt,rf as q,sc as dt,sf as K,tb as y,tc as ut,uc as _t,va as d,vc as ht,wa as l,wc as St,wg as Ft,xa as r,xc as ft,xd as bt,ya as I,yc as Ct,za as C,zc as w,zg as Ht}from"./chunk-353QRQI4.js";var qt=t=>({all:t}),Kt=t=>({name:t});function Jt(t,a){if(t&1){let e=N();l(0,"th",24)(1,"mat-checkbox",25),p(2,"masterCheckboxLabel"),p(3,"translate"),T("change",function(n){E(e);let s=f(2);return v(n?s.masterToggle():null)}),r()()}if(t&2){let e=f(),i=f();o(),d("aria-label",m(3,5,m(2,3,e.all)))("checked",i.selection.hasValue()&&e.all)("indeterminate",i.selection.hasValue()&&!e.all)}}function Xt(t,a){if(t&1){let e=N();l(0,"td",26)(1,"mat-checkbox",27),p(2,"checkboxLabel"),p(3,"translate"),T("change",function(n){let s=E(e).$implicit,S=f(2);return v(n?S.toggleRow(s):null)})("click",function(n){return E(e),v(n.stopPropagation())}),r()()}if(t&2){let e=a.$implicit,i=f(2);o(),d("aria-label",Q(3,4,m(2,2,i.selection.isSelected(e)),z(7,Kt,e.destination)))("checked",i.selection.isSelected(e))}}function Zt(t,a){t&1&&(C(0,3),h(1,Jt,4,7,"th",22)(2,Xt,4,9,"td",23),D())}function te(t,a){t&1&&(l(0,"th",28),c(1),p(2,"translate"),r()),t&2&&(o(),u(" ",m(2,1,"SHARED.COMPONENTS.DESTINATIONS_LIST.DESTINATION_ID")," "))}function ee(t,a){if(t&1&&(l(0,"td",29),c(1),r()),t&2){let e=a.$implicit;o(),u(" ",e.id," ")}}function ie(t,a){t&1&&(l(0,"th",28),c(1),p(2,"translate"),r()),t&2&&(o(),u(" ",m(2,1,"SHARED.COMPONENTS.DESTINATIONS_LIST.SERVICE")," "))}function ne(t,a){if(t&1&&(l(0,"td",30),c(1),r()),t&2){let e=a.$implicit;o(),g(e.service.name)}}function ae(t,a){t&1&&I(0,"th",31)}function oe(t,a){t&1&&(l(0,"mat-icon",32),p(1,"translate"),c(2," warning "),r()),t&2&&d("matTooltip",M(m(1,2,"SHARED.COMPONENTS.DESTINATIONS_LIST.WARN")))}function le(t,a){if(t&1&&(l(0,"td",30),x(1,oe,3,4,"mat-icon",32),r()),t&2){let e=a.$implicit,i=f();o(),b(i.services.has(e.service.id)?-1:1)}}function re(t,a){t&1&&(l(0,"th",28),c(1),p(2,"translate"),r()),t&2&&(o(),u(" ",m(2,1,"SHARED.COMPONENTS.DESTINATIONS_LIST.FACILITY")," "))}function se(t,a){if(t&1&&(l(0,"td",30),c(1),r()),t&2){let e=a.$implicit;o(),g(e.facility.name)}}function pe(t,a){t&1&&(l(0,"th",28),c(1),p(2,"translate"),r()),t&2&&(o(),u(" ",m(2,1,"SHARED.COMPONENTS.DESTINATIONS_LIST.DESTINATION")," "))}function ce(t,a){if(t&1&&(l(0,"td",30),p(1,"multiWordDataCy"),c(2),r()),t&2){let e=a.$implicit;tt("data-cy",m(1,2,e.destination)),o(2),u(" ",e.destination," ")}}function me(t,a){t&1&&(l(0,"th",28),c(1),p(2,"translate"),r()),t&2&&(o(),u(" ",m(2,1,"SHARED.COMPONENTS.DESTINATIONS_LIST.TYPE")," "))}function de(t,a){if(t&1&&(l(0,"td",30),c(1),r()),t&2){let e=a.$implicit;o(),g(e.type.toUpperCase())}}function ue(t,a){t&1&&I(0,"th",31)}function _e(t,a){t&1&&(l(0,"mat-icon",33),p(1,"translate"),c(2," check_circle_outline "),r()),t&2&&d("matTooltip",M(m(1,2,"SHARED.COMPONENTS.DESTINATIONS_LIST.ALLOWED")))}function he(t,a){t&1&&(l(0,"mat-icon",33),p(1,"translate"),c(2," block "),r()),t&2&&d("matTooltip",M(m(1,2,"SHARED.COMPONENTS.DESTINATIONS_LIST.BLOCKED")))}function Se(t,a){if(t&1&&(l(0,"td",30),x(1,_e,3,4,"mat-icon",33),x(2,he,3,4,"mat-icon",33),r()),t&2){let e=a.$implicit;o(),b(e.blocked?-1:1),o(),b(e.blocked?2:-1)}}function fe(t,a){t&1&&(l(0,"th",28),c(1),p(2,"translate"),r()),t&2&&(o(),u(" ",m(2,1,"SHARED.COMPONENTS.DESTINATIONS_LIST.PROPAGATION_TYPE")," "))}function Ce(t,a){if(t&1&&(l(0,"td",30),c(1),r()),t&2){let e=a.$implicit;o(),g(e.propagationType)}}function De(t,a){t&1&&(l(0,"th",28),c(1),p(2,"translate"),r()),t&2&&(o(),u(" ",m(2,1,"SHARED.COMPONENTS.DESTINATIONS_LIST.LAST_SUCCESS")," "))}function Te(t,a){if(t&1&&(l(0,"td",34),p(1,"lastPropagation"),c(2),p(3,"lastPropagation"),r()),t&2){let e=a.$implicit,i=f();O(e.lastSuccessfulPropagation?"":"fst-italic"),d("matTooltip",m(1,4,e.lastSuccessfulPropagation)===i.noTimestampText?i.noTimestampTooltip:null),o(2),u(" ",m(3,6,e.lastSuccessfulPropagation)," ")}}function ge(t,a){t&1&&(l(0,"th",28),c(1),p(2,"translate"),r()),t&2&&(o(),u(" ",m(2,1,"SHARED.COMPONENTS.DESTINATIONS_LIST.LAST_ATTEMPT")," "))}function Ie(t,a){if(t&1&&(l(0,"td",34),p(1,"lastPropagation"),c(2),p(3,"lastPropagation"),r()),t&2){let e=a.$implicit,i=f();O(e.lastAttemptedPropagation?"":"fst-italic"),d("matTooltip",m(1,4,e.lastAttemptedPropagation)===i.noTimestampText?i.noTimestampTooltip:null),o(2),u(" ",m(3,6,e.lastAttemptedPropagation)," ")}}function Ee(t,a){t&1&&I(0,"tr",35)}function ve(t,a){t&1&&I(0,"tr",36)}function xe(t,a){t&1&&(l(0,"perun-web-apps-alert",21),c(1),p(2,"translate"),r()),t&2&&(o(),u(" ",m(2,1,"SHARED_LIB.UI.ALERTS.NO_FILTER_RESULTS_ALERT")," "))}function be(t,a){t&1&&(l(0,"perun-web-apps-alert",21),c(1),p(2,"translate"),r()),t&2&&(o(),u(" ",m(2,1,"SHARED.COMPONENTS.DESTINATIONS_LIST.NO_DESTINATIONS")," "))}var zt=(()=>{class t{constructor(e,i,n,s,S){this.authResolver=e,this.tableCheckbox=i,this.lastPropagationPipe=n,this.destroyRef=s,this.translate=S,this.destinations=[],this.selection=new Y(!0,[]),this.filterValue="",this.pageSizeOptions=Rt,this.noTimestampText="",this.noTimestampTooltip=""}set matSort(e){this.sort=e,this.setDataSource()}ngOnInit(){this.selection&&(this.cachedSelection=new Y(this.selection.isMultipleSelection(),[],!0,this.selection.compareWith),this.cachedSubject?.pipe(Ut(this.destroyRef)).subscribe(e=>{e&&this.cachedSelection.clear()})),this.noTimestampText=this.translate.instant("SHARED.COMPONENTS.DESTINATIONS_LIST.NO_TIMESTAMP"),this.noTimestampTooltip=this.translate.instant("SHARED.COMPONENTS.DESTINATIONS_LIST.NO_TIMESTAMP_TOOLTIP")}getDataForColumn(e,i){switch(i){case"destinationId":return e.id.toString();case"service":return e.service.name;case"facility":return e.facility.name;case"destination":return e.destination;case"type":return e.type;case"status":return e.blocked?"blocked":"allowed";case"propagationType":return e.propagationType;case"lastPropagation":return this.lastPropagationPipe.transform(e.lastSuccessfulPropagation);case"lastAttemptedPropagation":return this.lastPropagationPipe.transform(e.lastAttemptedPropagation);default:return""}}ngOnChanges(){localStorage.getItem("showIds")!=="true"&&(this.displayedColumns=this.displayedColumns.filter(e=>e!=="destinationId")),this.dataSource=new w(this.destinations),this.setDataSource(),this.dataSource.filter=this.filterValue.toLowerCase()}exportAllData(e){K(q(this.dataSource.filteredData,this.displayedColumns,(i,n)=>this.getDataForColumn(i,n)),e)}exportDisplayedData(e){let i=this.dataSource.paginator.pageIndex*this.dataSource.paginator.pageSize,n=i+this.dataSource.paginator.pageSize;K(q(this.dataSource.sortData(this.dataSource.filteredData,this.dataSource.sort).slice(i,n),this.displayedColumns,(s,S)=>this.getDataForColumn(s,S)),e)}setDataSource(){this.dataSource&&(this.dataSource.sort=this.sort,this.dataSource.filterPredicate=(e,i)=>kt(e,i,this.displayedColumns,(n,s)=>this.getDataForColumn(n,s)),this.dataSource.sortData=(e,i)=>Pt(e,i,(n,s)=>this.getDataForColumn(n,s)),this.dataSource.paginator=this.child.paginator)}isAllSelected(){return this.tableCheckbox.isAllSelected(this.selection.selected.length,this.dataSource)}masterToggle(){this.tableCheckbox.masterToggle(this.isAllSelected(),this.selection,this.cachedSelection,this.filterValue,this.dataSource,this.sort,this.child.paginator.pageSize,this.child.paginator.pageIndex,!1)}ngAfterViewInit(){this.dataSource.paginator=this.child.paginator}toggleRow(e){this.selection.toggle(e),this.cachedSelection.toggle(e)}pageChanged(){this.cachedSelection&&this.tableCheckbox.selectCachedDataOnPage(this.dataSource,this.selection,this.cachedSelection,this.selection.compareWith)}static{this.\u0275fac=function(i){return new(i||t)(_(Nt),_(Bt),_(L),_(X),_(F))}}static{this.\u0275cmp=A({type:t,selectors:[["app-perun-web-apps-destination-list"]],viewQuery:function(i,n){if(i&1&&(G(J,7),G(k,7)),i&2){let s;W(s=$())&&(n.child=s.first),W(s=$())&&(n.matSort=s.first)}},inputs:{destinations:"destinations",selection:"selection",cachedSubject:"cachedSubject",filterValue:"filterValue",tableId:"tableId",displayedColumns:"displayedColumns",services:"services",loading:"loading"},features:[nt([L]),Z],decls:39,vars:15,consts:[[1,"card","mt-3",3,"hidden"],[3,"exportDisplayedData","exportAllData","pageChanged","pageSizeOptions","dataLength","tableId"],["mat-table","","matSort","","matSortActive","id","matSortDirection","asc","matSortDisableClear","",1,"w-100",3,"matSortChange","dataSource"],["matColumnDef","select"],["matColumnDef","destinationId"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["class","static-column-size","mat-cell","",4,"matCellDef"],["matColumnDef","service"],["mat-cell","",4,"matCellDef"],["matColumnDef","warn"],["mat-header-cell","",4,"matHeaderCellDef"],["matColumnDef","facility"],["matColumnDef","destination"],["matColumnDef","type"],["matColumnDef","status"],["matColumnDef","propagationType"],["matColumnDef","lastSuccessfulPropagation"],["mat-cell","",3,"matTooltip","class",4,"matCellDef"],["matColumnDef","lastAttemptedPropagation"],["mat-header-row","",4,"matHeaderRowDef"],["class","dark-hover-list-item","mat-row","",4,"matRowDef","matRowDefColumns"],["alert_type","warn"],["class","align-checkbox","mat-header-cell","",4,"matHeaderCellDef"],["class","static-column-size align-checkbox","mat-cell","",4,"matCellDef"],["mat-header-cell","",1,"align-checkbox"],["color","primary",3,"change","aria-label","checked","indeterminate"],["mat-cell","",1,"static-column-size","align-checkbox"],["color","primary",3,"change","click","aria-label","checked"],["mat-header-cell","","mat-sort-header",""],["mat-cell","",1,"static-column-size"],["mat-cell",""],["mat-header-cell",""],["matTooltipPosition","above",1,"warn",3,"matTooltip"],[1,"align-bottom",3,"matTooltip"],["mat-cell","",3,"matTooltip"],["mat-header-row",""],["mat-row","",1,"dark-hover-list-item"]],template:function(i,n){if(i&1&&(l(0,"div",0)(1,"perun-web-apps-table-wrapper",1),T("exportDisplayedData",function(S){return n.exportDisplayedData(S)})("exportAllData",function(S){return n.exportAllData(S)})("pageChanged",function(){return n.pageChanged()}),l(2,"table",2),T("matSortChange",function(){return n.pageChanged()}),x(3,Zt,3,0,"ng-container",3),p(4,"isAllSelected"),C(5,4),h(6,te,3,3,"th",5)(7,ee,2,1,"td",6),D(),C(8,7),h(9,ie,3,3,"th",5)(10,ne,2,1,"td",8),D(),C(11,9),h(12,ae,1,0,"th",10)(13,le,2,1,"td",8),D(),C(14,11),h(15,re,3,3,"th",5)(16,se,2,1,"td",8),D(),C(17,12),h(18,pe,3,3,"th",5)(19,ce,3,4,"td",8),D(),C(20,13),h(21,me,3,3,"th",5)(22,de,2,1,"td",8),D(),C(23,14),h(24,ue,1,0,"th",10)(25,Se,3,2,"td",8),D(),C(26,15),h(27,fe,3,3,"th",5)(28,Ce,2,1,"td",8),D(),C(29,16),h(30,De,3,3,"th",5)(31,Te,4,8,"td",17),D(),C(32,18),h(33,ge,3,3,"th",5)(34,Ie,4,8,"td",17),D(),h(35,Ee,1,0,"tr",19)(36,ve,1,0,"tr",20),r()()(),x(37,xe,3,3,"perun-web-apps-alert",21),x(38,be,3,3,"perun-web-apps-alert",21)),i&2){let s;d("hidden",n.dataSource.filteredData.length===0||n.destinations.length===0),o(),d("pageSizeOptions",n.pageSizeOptions)("dataLength",n.dataSource.filteredData.length)("tableId",n.tableId),o(),d("dataSource",n.dataSource),o(),b((s=z(13,qt,Q(4,10,n.dataSource,n.selection.selected.length)))?3:-1,s),o(32),d("matHeaderRowDef",n.displayedColumns),o(),d("matRowDefColumns",n.displayedColumns),o(),b(n.dataSource.filteredData.length===0&&n.destinations.length!==0?37:-1),o(),b(!n.loading&&n.destinations.length===0?38:-1)}},dependencies:[y,vt,Et,rt,lt,V,B,J,Ct,st,ct,_t,mt,pt,ht,dt,ut,St,ft,Tt,k,Dt,P,ot,Ft,R,L,Ht,Vt,jt],styles:[".warn[_ngcontent-%COMP%]{color:#ebe134}"]})}}return t})();function Ne(t,a){t&1&&I(0,"perun-web-apps-loading-dialog")}function Oe(t,a){if(t&1){let e=N();l(0,"div")(1,"h1",2),c(2),p(3,"translate"),r(),l(4,"div",3)(5,"perun-web-apps-alert",4),c(6),p(7,"translate"),r(),l(8,"p"),c(9),p(10,"translate"),r(),l(11,"div",5),c(12),p(13,"translate"),r(),I(14,"app-perun-web-apps-destination-list",6),r(),l(15,"div",7)(16,"button",8),T("click",function(){E(e);let n=f();return v(n.onCancel())}),c(17),p(18,"translate"),r(),l(19,"button",9),T("click",function(){E(e);let n=f();return v(n.onConfirm())}),c(20),p(21,"translate"),r()()()}if(t&2){let e=f();o(2),g(m(3,10,"DIALOGS.REMOVE_DESTINATIONS.TITLE")),o(4),g(m(7,12,"DIALOGS.REMOVE_DESTINATIONS.WARNING")),o(3),g(m(10,14,"DIALOGS.REMOVE_DESTINATIONS.DESCRIPTION")),o(3),u(" ",m(13,16,"DIALOGS.REMOVE_DESTINATIONS.ASK")," "),o(2),d("loading",e.loading)("destinations",e.destinations)("displayedColumns",e.displayedColumns),o(3),u(" ",m(18,18,"DIALOGS.REMOVE_DESTINATIONS.CANCEL")," "),o(2),d("disabled",e.loading),o(),u(" ",m(21,20,"DIALOGS.REMOVE_DESTINATIONS.CONFIRM")," ")}}var fi=(()=>{class t{constructor(e,i,n,s,S){this.dialogRef=e,this.data=i,this.notificator=n,this.translate=s,this.serviceManager=S,this.displayedColumns=[],this.loading=!1}ngOnInit(){this.theme=this.data.theme,this.destinations=this.data.destinations,this.displayedColumns=this.theme==="admin-theme"?["destinationId","facility","destination","type","propagationType"]:["destinationId","service","destination","type","propagationType"],this.dataSource=new w(this.data.destinations)}onCancel(){this.dialogRef.close(!1)}deleteDestinations(){this.serviceManager.removeDestinationsByRichDestinations({richDestinations:this.destinations}).subscribe({next:()=>{this.notificator.showSuccess(this.translate.instant("DIALOGS.REMOVE_DESTINATIONS.SUCCESS")),this.dialogRef.close(!0)},error:()=>this.loading=!1})}onConfirm(){this.loading=!0,this.deleteDestinations()}static{this.\u0275fac=function(i){return new(i||t)(_(H),_(j),_(U),_(F),_(yt))}}static{this.\u0275cmp=A({type:t,selectors:[["app-perun-web-apps-remove-destination-dialog"]],decls:4,vars:5,consts:[["spinner",""],[4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],["mat-dialog-title",""],["mat-dialog-content",""],["alert_type","warn"],[1,"fw-bold"],[3,"loading","destinations","displayedColumns"],["mat-dialog-actions",""],["mat-stroked-button","",1,"ms-auto",3,"click"],["color","warn","mat-flat-button","",1,"ms-2",3,"click","disabled"]],template:function(i,n){if(i&1&&(h(0,Ne,1,0,"ng-template",null,0,at),l(2,"div"),h(3,Oe,22,22,"div",1),r()),i&2){let s=et(1);o(2),O(it("",n.theme," position-relative")),o(),d("perunWebAppsLoader",n.loading)("perunWebAppsLoaderIndicator",s)}},dependencies:[y,It,gt,wt,Ot,Mt,Lt,V,B,xt,P,bt,zt,R],encapsulation:2})}}return t})();var Ai=(()=>{class t{constructor(e,i,n,s){this.data=e,this.dialogRef=i,this.facilityService=n,this.notificator=s,this.loading=!1}update(e){this.loading=!0,this.facilityService.updateFacilityBan({banOnFacility:{id:this.data.ban.id,beanName:"BanOnFacility",facilityId:this.data.ban.facilityId,userId:this.data.ban.userId,description:e.description,validityTo:e.validity}}).subscribe({next:()=>{this.notificator.showSuccess("DIALOGS.UPDATE_BAN.SUCCESS"),this.dialogRef.close(!0)},error:()=>{this.loading=!1}})}cancel(){this.dialogRef.close(!1)}static{this.\u0275fac=function(i){return new(i||t)(_(j),_(H),_(At),_(U))}}static{this.\u0275cmp=A({type:t,selectors:[["app-update-facility-ban-dialog"]],decls:1,vars:3,consts:[[3,"cancelled","update","ban","theme","loading"]],template:function(i,n){i&1&&(l(0,"app-update-ban-dialog",0),T("cancelled",function(){return n.cancel()})("update",function(S){return n.update(S)}),r()),i&2&&d("ban",n.data.ban)("theme","facility-theme")("loading",n.loading)},dependencies:[y,Gt],encapsulation:2})}}return t})();export{zt as a,fi as b,Ai as c};
