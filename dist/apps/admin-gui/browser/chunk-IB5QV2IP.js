import{$b as M,Aa as m,Ab as z,Af as le,Ba as b,Bf as ce,Ca as I,Da as U,Db as $,Dc as te,Eb as q,Ja as x,Jb as Y,Je as O,K as C,Ka as H,Na as h,Nb as J,Nc as ie,O as N,Oa as g,P as k,Pb as Q,Ra as j,Sc as ne,Sg as ve,Vb as K,Vg as be,Wb as y,We as se,Wg as Ie,Xa as A,Xf as de,Y as r,Ya as R,Z as c,_g as Se,ac as X,ag as me,bg as ue,da as u,dd as L,dh as xe,eh as Ce,ff as ae,fh as Re,ga as a,gg as he,gh as ye,ha as B,ja as F,jd as w,ka as p,kc as Z,kd as oe,la as l,ma as f,ng as ge,od as re,pa as V,pg as fe,qa as S,qb as G,ra as d,tb as W,ua as D,ub as T,wc as ee,za as E,zf as pe,zg as _e}from"./chunk-XQ7YXRXE.js";function Ue(e,o){e&1&&f(0,"perun-web-apps-loading-table")}var He=()=>["id","recent","shortName","name"];function je(e,o){if(e&1&&f(0,"perun-web-apps-vos-list",9),e&2){let n=d(2);a("loading",n.loading)("displayedColumns",x(4,He))("recentIds",n.recentIds)("vos",n.objects)}}function Ge(e,o){if(e&1&&(p(0,"div",7),u(1,je,1,5,"perun-web-apps-vos-list",8),l()),e&2){let n=d(),t=E(10);r(),a("perunWebAppsLoader",n.loading)("perunWebAppsLoaderIndicator",t)}}var We=()=>["id","recent","vo","name","description"];function ze(e,o){if(e&1&&f(0,"perun-web-apps-groups-list",11),e&2){let n=d(2);a("loading",n.loading)("displayedColumns",x(4,We))("groups",n.objects)("recentIds",n.recentIds)}}function $e(e,o){if(e&1&&(p(0,"div",7),u(1,ze,1,5,"perun-web-apps-groups-list",10),l()),e&2){let n=d(),t=E(10);r(),a("perunWebAppsLoader",n.loading)("perunWebAppsLoaderIndicator",t)}}var qe=()=>["id","recent","name","vo","facility"];function Ye(e,o){if(e&1&&f(0,"perun-web-apps-resources-list",13),e&2){let n=d(2);a("loading",n.loading)("displayedColumns",x(5,qe))("resources",n.objects)("recentIds",n.recentIds)("routingVo",!0)}}function Je(e,o){if(e&1&&(p(0,"div",7),u(1,Ye,1,6,"perun-web-apps-resources-list",12),l()),e&2){let n=d(),t=E(10);r(),a("perunWebAppsLoader",n.loading)("perunWebAppsLoaderIndicator",t)}}var Qe=()=>["id","recent","name","description"];function Ke(e,o){if(e&1&&f(0,"perun-web-apps-facilities-list",15),e&2){let n=d(2);a("loading",n.loading)("displayedColumns",x(4,Qe))("facilities",n.objects)("recentIds",n.recentIds)}}function Xe(e,o){if(e&1&&(p(0,"div",7),u(1,Ke,1,5,"perun-web-apps-facilities-list",14),l()),e&2){let n=d(),t=E(10);r(),a("perunWebAppsLoader",n.loading)("perunWebAppsLoaderIndicator",t)}}var Me=(()=>{let o=class o{constructor(t,i,s){this.authzResolver=t,this.guiAuthResolver=i,this.resourceService=s,this.objects=[],this.loading=!1,this.recentIds=[]}ngOnInit(){this.loading=!0,this.primaryObject=this.guiAuthResolver.getPrimaryObjectOfRole(this.roleName),this.svgIcon="perun-"+this.primaryObject.toLowerCase()+"-black",this.title="USER_DETAIL.DASHBOARD.CARD_TITLE_"+this.roleName,this.roleTooltipInfo="USER_DETAIL.DASHBOARD.ROLE_INFO_"+this.roleName,this.getObjects()}getObjects(){switch(this.primaryObject){case"Vo":{this.authzResolver.getVosWhereUserIsInRoles([this.roleName]).subscribe(t=>{this.objects=t,this.recentIds=w("vos"),this.loading=!1});break}case"Group":{this.authzResolver.getGroupsWhereUserIsInRoles([this.roleName]).subscribe(t=>{this.objects=t,this.recentIds=w("groups"),this.loading=!1});break}case"Resource":{this.resourceService.getRichResourcesByIds(this.role[this.primaryObject]).subscribe(t=>{this.objects=t,this.recentIds=w("resources"),this.loading=!1});break}case"Facility":{this.authzResolver.getFacilitiesWhereUserIsInRoles([this.roleName]).subscribe(t=>{this.objects=t.map(i=>({facility:i})),this.recentIds=w("facilities"),this.loading=!1});break}default:this.objects=[],this.loading=!1}}};o.\u0275fac=function(i){return new(i||o)(c(z),c(M),c(Y))},o.\u0275cmp=C({type:o,selectors:[["app-perun-web-apps-dashboard-card"]],inputs:{role:"role",roleName:"roleName"},decls:15,vars:11,consts:[[1,"py-3"],[1,"d-flex","flex-row","align-items-center","gap-2","card-title"],[1,"d-flex","cover-image",3,"svgIcon"],["matTooltipPosition","above",3,"matTooltip"],[1,"dashboard-icon"],["spinner",""],["class","position-relative table-min-height",4,"ngIf"],[1,"position-relative","table-min-height"],[3,"loading","displayedColumns","recentIds","vos",4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],[3,"loading","displayedColumns","recentIds","vos"],[3,"loading","displayedColumns","groups","recentIds",4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],[3,"loading","displayedColumns","groups","recentIds"],[3,"loading","displayedColumns","resources","recentIds","routingVo",4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],[3,"loading","displayedColumns","resources","recentIds","routingVo"],[3,"loading","displayedColumns","facilities","recentIds",4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],[3,"loading","displayedColumns","facilities","recentIds"]],template:function(i,s){i&1&&(p(0,"div",0)(1,"div",1),f(2,"mat-icon",2),m(3),h(4,"translate"),p(5,"span",3),h(6,"translate"),p(7,"mat-icon",4),m(8,"info_outline"),l()()(),u(9,Ue,1,0,"ng-template",null,5,j)(11,Ge,2,2,"div",6)(12,$e,2,2,"div",6)(13,Je,2,2,"div",6)(14,Xe,2,2,"div",6),l()),i&2&&(r(2),a("svgIcon",s.svgIcon),r(),I(" ",g(4,7,s.title)," "),r(2),D("matTooltip",g(6,9,s.roleTooltipInfo)),r(6),a("ngIf",s.primaryObject==="Vo"),r(),a("ngIf",s.primaryObject==="Group"),r(),a("ngIf",s.primaryObject==="Resource"),r(),a("ngIf",s.primaryObject==="Facility"))},dependencies:[R,O,L,ve,xe,Ce,Re,ye,fe,y],styles:[".dashboard-icon[_ngcontent-%COMP%]{vertical-align:middle;transform:scale(.8)}.card-title[_ngcontent-%COMP%]{font-size:1.4rem;flex-wrap:wrap}.cover-image[_ngcontent-%COMP%]{transform:scale(1.8);margin-left:.9rem;margin-right:.7rem}"]});let e=o;return e})();function tt(e,o){e&1&&f(0,"mat-spinner",3)}function it(e,o){e&1&&(p(0,"perun-web-apps-alert",4),m(1),h(2,"translate"),l()),e&2&&(r(),b(g(2,1,"USER_DETAIL.DASHBOARD.NO_RECENTLY_VIEWED")))}var nt=e=>[e];function ot(e,o){if(e&1&&(p(0,"div",7)(1,"a",8),S("auxclick",function(t){return t.preventDefault()}),p(2,"span",9),m(3),l(),f(4,"mat-icon",10),p(5,"p",11),m(6),l()()()),e&2){let n=o.$implicit;r(),F("",n.style," item-itself"),D("matTooltip",n.tooltip),a("perunWebAppsMiddleClickRouterLink",H(9,nt,n.url))("routerLink",n.url),r(2),b(n.type),r(),a("svgIcon",n.cssIcon),r(2),b(n.label)}}function rt(e,o){if(e&1&&(p(0,"div",5),u(1,ot,7,11,"div",6),l()),e&2){let n=d();r(),a("ngForOf",n.items)}}var Le=(()=>{let o=class o{constructor(t,i,s,_){this.vosManager=t,this.groupsManager=i,this.authResolver=s,this.facilitiesManager=_,this.items=[],this.vosIds=[],this.groupsIds=[],this.facilitiesIds=[],this.existingRecentIds=[],this.vos=[],this.groups=[],this.facilities=[]}ngOnInit(){this.loading=!0,this.recentItems=oe("recent");for(let t of this.recentItems)switch(t.type){case"Vo":{this.vosIds.push(t.id);break}case"RichGroup":case"Group":{this.groupsIds.push(t.id);break}case"Facility":{this.facilitiesIds.push(t.id);break}}this.vosIds.length===0&&this.vosIds.push(-1),this.groupsIds.length===0&&this.groupsIds.push(-1),this.facilitiesIds.length===0&&this.facilitiesIds.push(-1),this.getVos()}getVos(){this.authResolver.isAuthorized("getVosByIds_List<Integer>_policy",[])?this.vosManager.getVosByIds(this.vosIds).subscribe(t=>{this.vos=t,this.getGroups()}):this.getGroups()}getGroups(){this.authResolver.isAuthorized("getGroupsByIds_List<Integer>_policy",[])?this.groupsManager.getGroupsByIds(this.groupsIds).subscribe(t=>{this.groups=t,this.getFacilities()}):this.getFacilities()}getFacilities(){this.authResolver.isAuthorized("getFacilitiesByIds_List<Integer>_policy",[])?this.facilitiesManager.getFacilitiesByIds(this.facilitiesIds).subscribe(t=>{this.facilities=t,this.addRecentlyViewedToDashboard()}):this.addRecentlyViewedToDashboard()}addRecentlyViewedToDashboard(){for(let t of this.recentItems)switch(t.type){case"Vo":{let i=this.vos.filter(s=>s.id===t.id)[0];i&&this.items.push({cssIcon:"perun-vo",url:`/organizations/${i.id}`,label:i.name,tooltip:i.name,style:"vo-btn",type:"Organization"});break}case"RichGroup":case"Group":{let i=this.groups.filter(s=>s.id===t.id)[0];i&&this.items.push({cssIcon:"perun-group",url:`/organizations/${i.voId}/groups/${i.id}`,label:i.shortName,tooltip:`${t.voName} : ${i.name.replace(/:/g," : ")}`,style:"group-btn",type:"Group"});break}case"Facility":{let i=this.facilities.filter(s=>s.id===t.id)[0];i&&this.items.push({cssIcon:"perun-facility-white",url:`/facilities/${i.id}`,label:i.name,tooltip:i.name,style:"facility-btn",type:"Facility"});break}}this.loading=!1}};o.\u0275fac=function(i){return new(i||o)(c(Q),c(q),c(M),c($))},o.\u0275cmp=C({type:o,selectors:[["app-perun-web-apps-dashboard-recently-viewed-button-field"]],decls:3,vars:3,consts:[["class","ms-auto me-auto",4,"ngIf"],["alert_type","info",4,"ngIf"],["class","items-container",4,"ngIf"],[1,"ms-auto","me-auto"],["alert_type","info"],[1,"items-container"],["class","item-itself-container","mat-ripple","",4,"ngFor","ngForOf"],["mat-ripple","",1,"item-itself-container"],[3,"perunWebAppsMiddleClickRouterLink","routerLink","matTooltip","auxclick"],[1,"item-type"],[1,"item-pic","perun-icon",3,"svgIcon"],[1,"truncate"]],template:function(i,s){i&1&&u(0,tt,1,0,"mat-spinner",0)(1,it,3,3,"perun-web-apps-alert",1)(2,rt,2,1,"div",2),i&2&&(a("ngIf",s.loading),r(),a("ngIf",s.items.length===0&&!s.loading),r(),a("ngIf",s.items.length>0))},dependencies:[A,R,T,O,ae,L,Z,de,be,Ie,y],styles:[".items-container[_ngcontent-%COMP%]{display:grid;grid-gap:0;grid-template-columns:repeat(auto-fill,minmax(208px,1fr));margin:0 -8px}@media (max-width: 768px){.items-container[_ngcontent-%COMP%]{grid-template-columns:repeat(auto-fill,minmax(148px,1fr))}}.item-pic[_ngcontent-%COMP%]{color:currentColor;transform:scale(3);height:74px;margin-bottom:22px;align-self:center}.item-itself-container[_ngcontent-%COMP%]{margin:8px;transition:.25s}.item-itself-container[_ngcontent-%COMP%]:hover{box-shadow:0 0 25px 5px #00000054;transform:scale(1.02);border-radius:var(--bs-border-radius)}.item-itself[_ngcontent-%COMP%]{text-align:center;min-height:186px;height:100%;padding:20px;display:flex;flex-direction:column;font-size:1.25rem;word-wrap:break-word;overflow-wrap:break-word;word-break:break-word;text-decoration:none;border-radius:var(--bs-border-radius)}.item-itself[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{height:120px;margin-bottom:10px}@media (max-width: 768px){.item-itself[_ngcontent-%COMP%]{min-height:150px;padding:10px;word-wrap:break-word;overflow-wrap:break-word;word-break:break-word}.item-itself[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{height:80px;margin-bottom:10px}}.item-type[_ngcontent-%COMP%]{font-size:.75rem}.truncate[_ngcontent-%COMP%]{display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}"]});let e=o;return e})();function at(e,o){if(e&1){let n=V();p(0,"div")(1,"mat-checkbox",8),S("change",function(i){let _=N(n).$implicit,v=d();return k(i?v.changeRoleView(_):null)}),m(2),h(3,"translate"),l()()}if(e&2){let n=o.$implicit,t=d();r(),a("checked",t.isRoleShowed(n)),r(),b(g(3,2,"USER_DETAIL.DASHBOARD.CARD_TITLE_"+n))}}function pt(e,o){if(e&1){let n=V();p(0,"button",15),S("click",function(){N(n);let i=d(2);return k(i.rightSettingOpened=!0)}),p(1,"mat-icon"),m(2,"settings"),l()()}}var lt=()=>["/myProfile"];function ct(e,o){e&1&&(p(0,"div")(1,"div",16)(2,"div",17),m(3),h(4,"translate"),l(),p(5,"div",18),m(6),h(7,"translate"),l(),p(8,"div",19)(9,"button",20),m(10),h(11,"translate"),l()()()()),e&2&&(r(3),I(" ",g(4,4,"USER_DETAIL.DASHBOARD.NO_ASSIGNED_ROLES")," "),r(3),I(" ",g(7,6,"USER_DETAIL.DASHBOARD.NO_ASSIGNED_ROLES_PROFILE")," "),r(3),a("routerLink",x(10,lt)),r(),I(" ",g(11,8,"USER_DETAIL.DASHBOARD.GO_TO_USER_PROFILE")," "))}function dt(e,o){e&1&&(p(0,"span")(1,"div",3),m(2),h(3,"translate"),l(),f(4,"app-perun-web-apps-dashboard-recently-viewed-button-field"),l()),e&2&&(r(2),I(" ",g(3,1,"USER_DETAIL.DASHBOARD.RECENTLY_VIEWED")," "))}function mt(e,o){e&1&&(p(0,"div",23),m(1),h(2,"translate"),l()),e&2&&(r(),I(" ",g(2,1,"USER_DETAIL.DASHBOARD.MANAGEABLE_ENTITIES")," "))}function ut(e,o){if(e&1&&f(0,"app-perun-web-apps-dashboard-card",26),e&2){let n=d().$implicit,t=d(3);a("roleName",n)("role",t.roles[n])}}function ht(e,o){if(e&1&&(p(0,"div",24),u(1,ut,1,2,"app-perun-web-apps-dashboard-card",25),l()),e&2){let n=o.$implicit,t=d(3);r(),a("ngIf",t.isRoleShowed(n))}}function gt(e,o){if(e&1&&(p(0,"div"),u(1,dt,5,3,"span",14)(2,mt,3,3,"div",21),p(3,"div"),u(4,ht,2,1,"div",22),l()()),e&2){let n=d(2);r(),a("ngIf",n.recentlyViewedShow),r(),a("ngIf",n.rolesToHide.toString()!==n.roleNames.toString()),r(2),a("ngForOf",n.roleNames)}}function ft(e,o){if(e&1&&(p(0,"div",9)(1,"h1",10),f(2,"mat-icon",11),p(3,"span",12),m(4),h(5,"translate"),h(6,"userFullName"),l(),u(7,pt,3,0,"button",13),l(),u(8,ct,12,11,"div",14)(9,gt,5,3,"div",14),l()),e&2){let n=d();r(4),U("",g(5,5,"USER_DETAIL.DASHBOARD.TITLE")," ",g(6,7,n.user),""),r(3),a("ngIf",!n.hasOnlyNoRightsRoles),r(),a("ngIf",n.hasOnlyNoRightsRoles),r(),a("ngIf",!n.hasOnlyNoRightsRoles)}}var oi=(()=>{let o=class o{constructor(t,i,s,_,v,Ne,P,ke,Ve,Pe){this.userManager=t,this.storeService=i,this.sideMenuService=s,this.route=_,this.router=v,this.notificator=Ne,this.translateService=P,this.dialog=ke,this.apiRequestConfiguration=Ve,this.otherApplicationService=Pe,this.roles={},this.hasOnlyNoRightsRoles=!1,this.rightSettingOpened=!1,this.recentlyViewedShow=!0,this.rolesToHide=[],this.noRightsRoles=new Set(["SELF","MEMBERSHIP","SPONSORSHIP"]),this.allowedRoles=["VOADMIN","GROUPADMIN","FACILITYADMIN","SPONSOR","RESOURCEADMIN","TOPGROUPCREATOR","VOOBSERVER","GROUPOBSERVER","GROUPMEMBERSHIPMANAGER","FACILITYOBSERVER","RESOURCEOBSERVER","SERVICEACCOUNTCREATOR"],P.get("USER_DETAIL.DASHBOARD.MAIL_CHANGE_SUCCESS").subscribe(Be=>this.mailSuccessMessage=Be)}ngOnInit(){this.sideMenuService.setHomeItems([]),this.validatePreferredMailChange(),this.user=this.storeService.getPerunPrincipal()?.user,this.roles=this.storeService.getPerunPrincipal()?.roles??{};let t=Object.keys(this.roles);this.hasOnlyNoRightsRoles=t.every(i=>this.noRightsRoles.has(i)),this.roleNames=this.allowedRoles.filter(i=>t.includes(i)),this.getDashboardSettings()}recentlyViewedChanged(){localStorage.setItem("showRecentlyViewed",JSON.stringify(this.recentlyViewedShow))}changeRoleView(t){if(!this.isRoleShowed(t))this.rolesToHide=this.rolesToHide.filter(i=>i!==t);else{let i=[];for(let s of this.roleNames)this.isRoleShowed(s)||i.push(s),s===t&&i.push(s);this.rolesToHide=i}localStorage.setItem("rolesToHide",JSON.stringify(this.rolesToHide))}isRoleShowed(t){return!this.rolesToHide.includes(t)}validatePreferredMailChange(){let t=this.route.snapshot.queryParamMap,i=t.get("token"),s=t.get("u");i&&s&&(this.apiRequestConfiguration.dontHandleErrorForNext(),this.userManager.validatePreferredEmailChangeWithToken({token:i,u:Number.parseInt(s,10)}).subscribe({next:()=>{this.notificator.showSuccess(this.mailSuccessMessage),this.router.navigate([],{replaceUrl:!0,queryParamsHandling:"preserve"})},error:()=>{let _=re();_.width="600px",this.dialog.open(Se,_).afterClosed().subscribe(()=>{this.getDashboardSettings()})}}))}getDashboardSettings(){let t=JSON.parse(localStorage.getItem("showRecentlyViewed"));this.recentlyViewedShow=t===null?!0:t;let i=JSON.parse(localStorage.getItem("rolesToHide"));this.rolesToHide=i===null?[]:i}};o.\u0275fac=function(i){return new(i||o)(c(J),c(X),c(ge),c(G),c(W),c(me),c(K),c(ee),c(ue),c(he))},o.\u0275cmp=C({type:o,selectors:[["app-perun-web-apps-user-dashboard"]],hostVars:2,hostBindings:function(i,s){i&2&&B("router-component",s.true)},decls:16,vars:13,consts:[["hasBackdrop","true",1,"dashboard"],["mode","over","position","end",3,"opened","openedChange"],[1,"m-4","user-theme"],[1,"page-subtitle"],[3,"ngModel","ngModelChange","change"],[1,"text-bigger","mt-1","mb-1"],[4,"ngFor","ngForOf"],["class","container-fluid ps-xl-5 pe-xl-5 user-theme",4,"ngIf"],[3,"checked","change"],[1,"container-fluid","ps-xl-5","pe-xl-5","user-theme"],[1,"page-title","d-flex"],["svgIcon","perun-home-white",1,"home-image","perun-icon"],["data-cy","dashboard-welcome",1,"pt-1"],["class","ms-auto text-bigger","mat-stroked-button","",3,"click",4,"ngIf"],[4,"ngIf"],["mat-stroked-button","",1,"ms-auto","text-bigger",3,"click"],[1,"card","m-3","p-4"],[1,"text-align"],[1,"text-align","pt-3","mt-2"],[1,"mx-auto","pt-3"],["queryParamsHandling","merge","color","accent","mat-flat-button","",1,"ms-2","mt-2",3,"routerLink"],["class","page-subtitle my-4",4,"ngIf"],["class","mb-3",4,"ngFor","ngForOf"],[1,"page-subtitle","my-4"],[1,"mb-3"],[3,"roleName","role",4,"ngIf"],[3,"roleName","role"]],template:function(i,s){i&1&&(p(0,"mat-sidenav-container",0)(1,"mat-sidenav",1),S("openedChange",function(v){return s.rightSettingOpened=v}),p(2,"div",2)(3,"div",3),m(4),h(5,"translate"),l(),p(6,"div")(7,"mat-checkbox",4),S("ngModelChange",function(v){return s.recentlyViewedShow=v})("change",function(v){return v?s.recentlyViewedChanged():null}),m(8),h(9,"translate"),l()(),p(10,"div",5),m(11),h(12,"translate"),l(),u(13,at,4,4,"div",6),l()(),p(14,"mat-sidenav-content"),u(15,ft,10,9,"div",7),l()()),i&2&&(r(),a("opened",s.rightSettingOpened),r(3),b(g(5,7,"USER_DETAIL.DASHBOARD.DASHBOARD_SETTINGS")),r(3),a("ngModel",s.recentlyViewedShow),r(),b(g(9,9,"USER_DETAIL.DASHBOARD.SHOW_RECENTLY_VIEWED")),r(3),b(g(12,11,"USER_DETAIL.DASHBOARD.SHOW_ROLES")),r(2),a("ngForOf",s.roleNames),r(2),a("ngIf",s.user!==void 0))},dependencies:[A,R,T,ie,ne,O,le,ce,pe,te,se,Me,Le,y,_e],styles:[".dashboard-container[_ngcontent-%COMP%]{columns:300px 2;column-gap:1rem;margin:0}.dashboard-container[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{margin:0 1rem 1rem 0;display:inline-block;min-width:300px;width:100%}.home-image[_ngcontent-%COMP%]{transform:scale(1.4);margin-right:.7rem;margin-left:.6rem}.text-align[_ngcontent-%COMP%]{text-align:center;font-size:1.25rem}.text-bigger[_ngcontent-%COMP%]{font-size:1.1rem}.user-icon[_ngcontent-%COMP%]{vertical-align:top}.dashboard[_ngcontent-%COMP%]{position:relative;min-height:calc(100vh - 234px);margin-bottom:-60px!important;padding-bottom:50px;top:-10px!important;left:0;right:0}"]});let e=o;return e})();export{oi as a};
