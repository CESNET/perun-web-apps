import{a as jt,b as $t,c as Yt}from"./chunk-D5LERCYM.js";import{a as Ve}from"./chunk-ZAR33XM3.js";import{a as Ft,b as Ht,c as Wt,d as Gt,e as qt,f as zt,g as Kt,h as Xt,i as Qt,j as Zt}from"./chunk-A4Y5G7P5.js";import{$b as w,$g as ut,$h as St,$j as Rt,Aa as _,B as _e,Ba as R,Bb as Te,Bh as U,Ca as A,Cb as $e,Ce as rt,Da as Se,Dc as O,Dd as Ze,Ea as We,Ec as Re,F as ge,Fh as ht,Fj as Ct,Gd as Je,Gj as At,Hb as ze,Hh as _t,Ij as Et,Ja as W,Je as re,Jj as Tt,K as E,Ka as me,L as be,Lb as xe,Ld as et,Lf as at,Lj as xt,Na as d,Nb as De,O as S,Oa as u,P as I,Qc as Ye,Ra as L,Rg as pt,Sg as V,Ug as mt,Uj as Dt,Vb as Ke,Vg as dt,Vh as gt,Vj as wt,Wb as x,Wg as Ne,Wh as bt,Xf as st,Xh as vt,Y as a,Ya as N,Yb as we,Yf as lt,Yg as Be,Yj as yt,Z as p,Za as ne,Zi as It,Zj as Pe,_ as He,_a as Ie,_b as ye,_d as tt,_j as Mt,ac as Me,ag as ae,bh as ft,cb as Ge,ck as Lt,d as y,da as g,dd as oe,di as ke,ff as Le,ga as c,gi as ce,gk as Nt,ha as ve,hc as H,he as it,hg as G,hh as le,hk as Bt,i as de,ik as Ot,jh as P,jk as kt,ka as s,la as l,m as ue,ma as b,ng as se,nk as Vt,od as T,ok as Pt,pa as C,pg as k,pk as Ut,qa as h,qb as Ce,qd as Xe,ra as f,rd as Qe,rh as Oe,tb as Ae,ua as F,ub as Ee,ve as nt,wb as Fe,wc as B,we as ot,x as fe,y as he,yb as X,za as M,zb as qe,zg as ct}from"./chunk-GY4DRDO6.js";var Si=()=>({color:"black"}),ni=(()=>{let o=class o{constructor(e){this.sideMenuService=e}ngOnInit(){this.sideMenuService.setAdminItems([])}};o.\u0275fac=function(t){return new(t||o)(p(se))},o.\u0275cmp=E({type:o,selectors:[["app-admin-page"]],decls:7,vars:5,consts:[[1,"container-fluid","ps-xl-5","pe-xl-5","admin-theme"],[1,"page-title","d-flex"],["svgIcon","perun-perun-admin",1,"perun-icon","icon-scale",3,"ngStyle"]],template:function(t,r){t&1&&(s(0,"div",0),b(1,"perun-web-apps-back-button"),s(2,"h1",1),b(3,"mat-icon",2),_(4),d(5,"translate"),l(),b(6,"app-animated-router-outlet"),l()),t&2&&(a(3),c("ngStyle",W(4,Si)),a(),A(" ",u(5,2,"ADMIN.TITLE")," "))},dependencies:[ne,re,ce,le,x]});let i=o;return i})();var oi=(()=>{let o=class o{constructor(){this.items=[{cssIcon:"perun-attributes",url:"/admin/attributes",label:"MENU_ITEMS.ADMIN.ATTRIBUTES",style:"admin-btn"},{cssIcon:"perun-user",url:"/admin/users",label:"MENU_ITEMS.ADMIN.USERS",style:"admin-btn"},{cssIcon:"perun-owner-grey",url:"/admin/owners",label:"MENU_ITEMS.ADMIN.OWNERS",style:"admin-btn"},{cssIcon:"perun-service",url:"/admin/services",label:"MENU_ITEMS.ADMIN.SERVICES",style:"admin-btn"},{cssIcon:"perun-external-sources",url:"/admin/ext_sources",label:"MENU_ITEMS.ADMIN.EXT_SOURCES",style:"admin-btn"},{cssIcon:"perun-audit-log",url:"/admin/audit_log",label:"MENU_ITEMS.ADMIN.AUDIT_LOG",style:"admin-btn"},{cssIcon:"perun-consent-hubs",url:"/admin/consent_hubs",label:"MENU_ITEMS.ADMIN.CONSENT_HUBS",style:"admin-btn"},{cssIcon:"perun-searcher",url:"/admin/searcher",label:"MENU_ITEMS.ADMIN.SEARCHER",style:"admin-btn"},{cssIcon:"perun-blocked-logins",url:"/admin/blocked_logins",label:"MENU_ITEMS.ADMIN.BLOCKED_LOGINS",style:"admin-btn"}]}};o.\u0275fac=function(t){return new(t||o)},o.\u0275cmp=E({type:o,selectors:[["app-admin-overview"]],hostVars:2,hostBindings:function(t,r){t&2&&ve("router-component",r.true)},decls:2,vars:1,consts:[[3,"items"]],template:function(t,r){t&1&&(s(0,"div"),b(1,"perun-web-apps-menu-buttons-field",0),l()),t&2&&(a(),c("items",r.items))},dependencies:[Oe]});let i=o;return i})();function Ai(i,o){if(i&1){let n=C();s(0,"button",9),h("click",function(){S(n);let t=f();return I(t.onCreate())}),_(1),d(2,"translate"),l()}i&2&&(a(),A(" ",u(2,1,"ADMIN.ATTRIBUTES.CREATE")," "))}function Ei(i,o){if(i&1){let n=C();s(0,"button",10),h("click",function(){S(n);let t=f();return I(t.onImport())}),_(1),d(2,"translate"),l()}i&2&&(a(),A(" ",u(2,1,"ADMIN.ATTRIBUTES.IMPORT")," "))}function Ti(i,o){if(i&1){let n=C();s(0,"button",11),h("click",function(){S(n);let t=f();return I(t.onDelete())}),_(1),d(2,"translate"),l()}if(i&2){let n=f();c("disabled",n.loading||n.selected.selected.length===0),a(),A(" ",u(2,2,"ADMIN.ATTRIBUTES.DELETE")," ")}}function xi(i,o){i&1&&b(0,"perun-web-apps-loading-table")}function Di(i,o){if(i&1){let n=C();s(0,"app-attr-def-list",12),h("refreshEvent",function(){S(n);let t=f();return I(t.refreshTable())}),l()}if(i&2){let n=f();c("loading",n.loading)("definitions",n.attrDefinitions)("disableRouting",!n.authResolver.isPerunAdminOrObserver())("filterValue",n.filterValue)("selection",n.selected)("cachedSubject",n.cachedSubject)("tableId",n.tableId)}}var ri=(()=>{let o=class o{constructor(e,t,r){this.dialog=e,this.attributesManager=t,this.authResolver=r,this.attrDefinitions=[],this.selected=new H(!0,[],!0,(m,v)=>m.id===v.id),this.cachedSubject=new y(!0),this.filterValue="",this.tableId=Je}ngOnInit(){this.refreshTable()}onCreate(){let e=T();e.width="650px",this.dialog.open(At,e).afterClosed().subscribe(r=>{r&&this.refreshTable()})}onDelete(){let e=T();e.width="450px",e.data={attributes:this.selected.selected,theme:"admin-theme"},this.dialog.open(Ct,e).afterClosed().subscribe(r=>{r&&this.refreshTable()})}refreshTable(){this.loading=!0,this.attributesManager.getAllAttributeDefinitions().subscribe(e=>{this.attrDefinitions=e,this.selected.clear(),this.cachedSubject.next(!0),this.loading=!1})}applyFilter(e){this.filterValue=e,this.refreshTable()}onImport(){let e=T();e.width="700px",this.dialog.open(xt,e).afterClosed().subscribe(r=>{r===!0&&this.refreshTable()})}};o.\u0275fac=function(t){return new(t||o)(p(B),p(X),p(w))},o.\u0275cmp=E({type:o,selectors:[["app-admin-attributes"]],hostVars:2,hostBindings:function(t,r){t&2&&ve("router-component",r.true)},decls:13,vars:9,consts:[[1,"page-subtitle"],[3,"refresh"],["class","me-2 action-button","color","accent","data-cy","new-attr-definition-button","mat-flat-button","",3,"click",4,"ngIf"],["class","me-2 action-button","color","accent","mat-flat-button","",3,"click",4,"ngIf"],["color","warn","class","me-2","data-cy","delete-attr-definition-button","mat-flat-button","",3,"disabled","click",4,"ngIf"],[3,"placeholder","filter"],["spinner",""],[1,"position-relative","table-min-height"],[3,"loading","definitions","disableRouting","filterValue","selection","cachedSubject","tableId","refreshEvent",4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],["color","accent","data-cy","new-attr-definition-button","mat-flat-button","",1,"me-2","action-button",3,"click"],["color","accent","mat-flat-button","",1,"me-2","action-button",3,"click"],["color","warn","data-cy","delete-attr-definition-button","mat-flat-button","",1,"me-2",3,"disabled","click"],[3,"loading","definitions","disableRouting","filterValue","selection","cachedSubject","tableId","refreshEvent"]],template:function(t,r){if(t&1&&(s(0,"div")(1,"h1",0),_(2),d(3,"translate"),l(),s(4,"perun-web-apps-refresh-button",1),h("refresh",function(){return r.refreshTable()}),l(),g(5,Ai,3,3,"button",2)(6,Ei,3,3,"button",3)(7,Ti,3,4,"button",4),s(8,"perun-web-apps-debounce-filter",5),h("filter",function(v){return r.applyFilter(v)}),l(),g(9,xi,1,0,"ng-template",null,6,L),s(11,"div",7),g(12,Di,1,7,"app-attr-def-list",8),l()()),t&2){let m=M(10);a(2),R(u(3,7,"ADMIN.ATTRIBUTES.TITLE")),a(3),c("ngIf",r.authResolver.isPerunAdmin()),a(),c("ngIf",r.authResolver.isPerunAdmin()),a(),c("ngIf",r.authResolver.isPerunAdmin()),a(),c("placeholder","ADMIN.ATTRIBUTES.SEARCH"),a(4),c("perunWebAppsLoader",r.loading)("perunWebAppsLoaderIndicator",m)}},dependencies:[N,O,Pe,V,P,U,k,x]});let i=o;return i})();function Li(i,o){i&1&&b(0,"mat-spinner",3)}function Ni(i,o){if(i&1){let n=C();s(0,"button",15),h("click",function(){S(n);let t=f(3);return I(t.editUser())}),d(1,"translate"),s(2,"mat-icon"),_(3,"edit"),l()()}i&2&&F("matTooltip",u(1,1,"ADMIN_USER.EDIT"))}function Bi(i,o){if(i&1){let n=C();s(0,"button",16),h("click",function(){S(n);let t=f(3);return I(t.anonymizeUser())}),d(1,"translate"),s(2,"mat-icon"),_(3,"no_accounts"),l()()}i&2&&F("matTooltip",u(1,1,"ADMIN_USER.ANONYMIZE"))}function Oi(i,o){if(i&1){let n=C();s(0,"button",16),h("click",function(){S(n);let t=f(3);return I(t.deleteUser())}),d(1,"translate"),s(2,"mat-icon"),_(3,"delete_forever"),l()()}i&2&&F("matTooltip",u(1,1,"ADMIN_USER.DELETE"))}function ki(i,o){i&1&&(s(0,"mat-icon",17),d(1,"translate"),_(2," blur_off "),l()),i&2&&F("matTooltip",u(1,1,"USER_DETAIL.DASHBOARD.ANONYMIZED"))}function Vi(i,o){if(i&1&&(s(0,"span"),g(1,Ni,4,3,"button",12)(2,Bi,4,3,"button",13)(3,Oi,4,3,"button",13)(4,ki,3,3,"mat-icon",14),l()),i&2){let n=f(2);a(),c("ngIf",!n.anonymized),a(),c("ngIf",!n.anonymized&&!n.userDeletionForced),a(),c("ngIf",n.userDeletionForced),a(),c("ngIf",n.anonymized)}}var Pi=()=>({color:"black"}),Ui=i=>["/admin/users",i];function ji(i,o){if(i&1&&(s(0,"div",4),b(1,"mat-icon",5),d(2,"translate"),s(3,"div",6)(4,"div",7)(5,"a",8),_(6),d(7,"userFullName"),l(),s(8,"span",9),_(9),l(),g(10,Vi,5,4,"span",10),l(),s(11,"div"),_(12),d(13,"translate"),l(),s(14,"span",11),_(15),d(16,"translate"),d(17,"translate"),l()()()),i&2){let n=f();a(),F("matTooltip",u(2,12,"ADMIN_USER.ENTITY")),c("ngStyle",W(22,Pi))("svgIcon",n.svgIcon),a(4),c("routerLink",me(23,Ui,n.user.id)),a(),A(" ",u(7,14,n.user)," "),a(3),A(" \xA0#",n.user.id," "),a(),c("ngIf",n.authResolver.isPerunAdmin()),a(2),Se("",u(13,16,"ADMIN_USER.UUID"),": ",n.user.uuid,""),a(3),We(" ",u(16,18,"ADMIN_USER.ENTITY"),", ",u(17,20,"ADMIN_USER.USER_TYPE"),": ",n.getUserType()," ")}}var si=(()=>{let o=class o{constructor(e,t,r,m,v,D,$,Z,Ue,je){this.route=e,this.attributesService=t,this.usersService=r,this.sideMenuService=m,this.sideMenuItemService=v,this.dialog=D,this.authResolver=$,this.entityStorageService=Z,this.router=Ue,this.store=je,this.loading=!1,this.svgIcon="perun-user-dark"}ngOnInit(){this.loading=!0,this.userDeletionForced=this.store.getProperty("user_deletion_forced"),this.route.params.subscribe(e=>{let t=Number(e.userId);this.entityStorageService.setEntityAndPathParam({id:Number(t),beanName:"User"},ye.User),this.path=`/admin/users/${t}`,this.regex="/admin/users/\\d+",this.usersService.getUserById(t).subscribe({next:m=>{this.user=m,this.svgIcon=this.user.serviceUser?"perun-service-identity":"perun-user-dark";let v=this.sideMenuItemService.parseUser(m,this.path,this.regex);this.sideMenuService.setAdminItems([v]),this.loading=!1},error:()=>this.loading=!1}),this.attributesService.getAttribute("urn:perun:user:attribute-def:virt:anonymized",void 0,void 0,t).subscribe(m=>{this.anonymized=!!m.value})})}editUser(){let e=T();e.width="450px",e.data={theme:"admin-theme",user:this.user},this.dialog.open(Lt,e).afterClosed().subscribe(r=>{r&&this.usersService.getUserById(this.user.id).subscribe(m=>{this.user=m})})}getUserType(){return this.user.serviceUser?"Service":"Person"}anonymizeUser(){this.openDialog(ut)}deleteUser(){this.openDialog(ft)}openDialog(e){let t=T();t.width="550px",t.data={theme:"admin-theme",user:this.user},this.dialog.open(e,t).afterClosed().subscribe(m=>{m&&this.router.navigate(["/admin","users"],{queryParamsHandling:"merge"})})}};o.\u0275fac=function(t){return new(t||o)(p(Ce),p(X),p(De),p(se),p(ke),p(B),p(w),p(G),p(Ae),p(Me))},o.\u0275cmp=E({type:o,selectors:[["app-admin-user-detail-page"]],decls:5,vars:2,consts:[[1,"container-fluid","ps-xl-5","pe-xl-5","user-theme"],["class","me-auto ms-auto",4,"ngIf"],["class","d-flex page-title-headtitle",4,"ngIf"],[1,"me-auto","ms-auto"],[1,"d-flex","page-title-headtitle"],[1,"perun-icon","perun-icon-detail",3,"ngStyle","svgIcon","matTooltip"],[1,"page-title-block"],[1,"page-title-headline","d-flex","align-items-center"],["data-cy","user-name-link",1,"user-link",3,"routerLink"],[1,"text-muted"],[4,"ngIf"],[1,"mt-1","entity-info"],["mat-icon-button","","data-cy","edit-user-button",3,"matTooltip","click",4,"ngIf"],["mat-icon-button","",3,"matTooltip","click",4,"ngIf"],["class","mat-icon-war ms-2",3,"matTooltip",4,"ngIf"],["mat-icon-button","","data-cy","edit-user-button",3,"matTooltip","click"],["mat-icon-button","",3,"matTooltip","click"],[1,"mat-icon-war","ms-2",3,"matTooltip"]],template:function(t,r){t&1&&(s(0,"div",0),b(1,"perun-web-apps-back-button"),g(2,Li,1,0,"mat-spinner",1)(3,ji,18,25,"div",2),b(4,"app-animated-router-outlet"),l()),t&2&&(a(2),c("ngIf",r.loading),a(),c("ngIf",!r.loading&&r.user!==void 0))},dependencies:[N,ne,Ee,re,Re,Le,oe,ce,le,Ne,x,ct]});let i=o;return i})();function Fi(i,o){i&1&&b(0,"perun-web-apps-loading-table")}var Hi=()=>["id","name","type"];function Wi(i,o){if(i&1&&b(0,"app-ext-sources-list",7),i&2){let n=f();c("loading",n.loading)("extSources",n.extSources)("filterValue",n.filterValue)("displayedColumns",W(5,Hi))("tableId",n.tableId)}}var li=(()=>{let o=class o{constructor(e,t){this.extSourceService=e,this.authResolver=t,this.extSources=[],this.filterValue="",this.loading=!1,this.tableId=et}ngOnInit(){this.refreshTable()}applyFilter(e){this.filterValue=e}loadConfigExtSources(){this.loading=!0,this.extSourceService.loadExtSourcesDefinitions().subscribe(()=>{this.refreshTable()})}refreshTable(){this.loading=!0,this.extSourceService.getExtSources().subscribe(e=>{this.extSources=e,this.loading=!1})}};o.\u0275fac=function(t){return new(t||o)(p($e),p(w))},o.\u0275cmp=E({type:o,selectors:[["app-admin-ext-sources"]],decls:13,vars:9,consts:[[1,"page-subtitle"],[3,"click"],["mat-stroked-button","",1,"me-2",3,"click"],[3,"placeholder","filter"],["spinner",""],[1,"position-relative","table-min-height"],[3,"loading","extSources","filterValue","displayedColumns","tableId",4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],[3,"loading","extSources","filterValue","displayedColumns","tableId"]],template:function(t,r){if(t&1&&(s(0,"div")(1,"h1",0),_(2),d(3,"translate"),l(),s(4,"perun-web-apps-refresh-button",1),h("click",function(){return r.refreshTable()}),l(),s(5,"button",2),h("click",function(){return r.loadConfigExtSources()}),_(6),d(7,"translate"),l(),s(8,"perun-web-apps-debounce-filter",3),h("filter",function(v){return r.applyFilter(v)}),l(),g(9,Fi,1,0,"ng-template",null,4,L),s(11,"div",5),g(12,Wi,1,6,"app-ext-sources-list",6),l()()),t&2){let m=M(10);a(2),R(u(3,5,"ADMIN.EXT_SOURCES.TITLE")),a(4),A(" ",u(7,7,"ADMIN.EXT_SOURCES.LOAD")," "),a(2),c("placeholder","ADMIN.EXT_SOURCES.SEARCH"),a(4),c("perunWebAppsLoader",r.loading)("perunWebAppsLoaderIndicator",m)}},dependencies:[O,It,V,P,U,k,x]});let i=o;return i})();function Gi(i,o){i&1&&b(0,"mat-spinner",3)}function qi(i,o){if(i&1){let n=C();s(0,"button",18),h("click",function(){S(n);let t=f(2);return I(t.editService())}),d(1,"translate"),s(2,"mat-icon"),_(3,"edit"),l()()}i&2&&F("matTooltip",u(1,1,"SERVICE_DETAIL.EDIT"))}function $i(i,o){if(i&1){let n=C();s(0,"button",19),h("click",function(){S(n);let t=f(2);return I(t.removeService())}),d(1,"translate"),s(2,"mat-icon"),_(3,"delete_forever"),l()()}i&2&&F("matTooltip",u(1,1,"SERVICE_DETAIL.DELETE"))}function zi(i,o){if(i&1){let n=C();s(0,"button",20),h("click",function(){S(n);let t=f(2);return I(t.evaluateConsents())}),_(1),d(2,"translate"),l()}i&2&&(a(),A(" ",u(2,1,"SERVICE_DETAIL.EVALUATE_CONSENTS")," "))}var Ki=()=>({color:"black"}),ci=i=>["/admin/services",i];function Yi(i,o){if(i&1){let n=C();s(0,"div",4),b(1,"mat-icon",5),d(2,"translate"),s(3,"div",6)(4,"div",7)(5,"div",8)(6,"div",9)(7,"a",10),h("auxclick",function(t){return t.preventDefault()}),_(8),l(),s(9,"span",11),_(10),l(),g(11,qi,4,3,"button",12)(12,$i,4,3,"button",13),l(),s(13,"span",14),_(14),d(15,"translate"),l()()(),s(16,"div",15)(17,"mat-slide-toggle",16),h("toggleChange",function(){S(n);let t=f();return I(t.changeServiceStatus())}),_(18),d(19,"translate"),l(),s(20,"mat-slide-toggle",16),h("toggleChange",function(){S(n);let t=f();return I(t.propagationChange())}),_(21),d(22,"translate"),l(),g(23,zi,3,3,"button",17),l()()()}if(i&2){let n=f();a(),F("matTooltip",u(2,15,"SERVICE_DETAIL.ENTITY")),c("ngStyle",W(23,Ki)),a(6),c("perunWebAppsMiddleClickRouterLink",me(24,ci,n.service.id.toString()))("routerLink",me(26,ci,n.service.id)),a(),A(" ",n.service.name," "),a(2),A(" \xA0 #",n.service.id," "),a(),c("ngIf",n.authResolver.isPerunAdmin()),a(),c("ngIf",n.authResolver.isPerunAdmin()),a(2),Se(" ",u(15,17,"SERVICE_DETAIL.DESCRIPTION"),": ",n.service.description," "),a(3),c("checked",n.service.enabled),a(),A(" ",u(19,19,"SERVICE_DETAIL.ENABLE")," "),a(2),c("checked",n.service.useExpiredMembers),a(),A(" ",u(22,21,"SERVICE_DETAIL.PROPAGATE")," "),a(2),c("ngIf",n.authResolver.isPerunAdmin())}}var pi=(()=>{let o=class o{constructor(e,t,r,m,v,D,$,Z,Ue,je,vi){this.route=e,this.router=t,this.consentsManager=r,this.serviceManager=m,this.sideMenuService=v,this.sideMenuItemService=D,this.dialog=$,this.authResolver=Z,this.translate=Ue,this.notificator=je,this.entityStorageService=vi,this.loading=!1}ngOnInit(){this.loading=!0,this.route.params.subscribe(e=>{this.serviceId=Number(e.serviceId),this.entityStorageService.setEntityAndPathParam({id:this.serviceId,beanName:"Service"},ye.Service),this.refresh()})}editService(){let e=T();e.width="600px",e.data={theme:"service-theme",service:this.service},this.dialog.open(Dt,e).afterClosed().subscribe(r=>{r&&this.refresh()})}removeService(){let e=T();e.width="600px",e.data={theme:"service-theme",services:[this.service]},this.dialog.open(wt,e).afterClosed().subscribe(r=>{r&&this.router.navigate(["/admin/services"],{queryParamsHandling:"preserve"})})}changeServiceStatus(){this.service.enabled=!this.service.enabled,this.serviceManager.updateService({service:this.service}).subscribe(()=>{this.notificator.showSuccess(this.translate.instant("SERVICE_DETAIL.STATUS_CHANGE_SUCCESS"))},()=>this.service.enabled=!this.service.enabled)}propagationChange(){this.service.useExpiredMembers=!this.service.useExpiredMembers,this.serviceManager.updateService({service:this.service}).subscribe(()=>{this.notificator.showSuccess(this.translate.instant("SERVICE_DETAIL.PROPAGATION_CHANGE_SUCCESS"))},()=>this.service.useExpiredMembers=!this.service.useExpiredMembers)}evaluateConsents(){let e=T();e.width="500px",e.data={title:this.translate.instant("SERVICE_DETAIL.CONFIRM_DIALOG_TITLE"),theme:"service-theme",description:this.translate.instant("SERVICE_DETAIL.CONFIRM_DIALOG_DESCRIPTION"),items:[this.service.name],type:"confirmation",showAsk:!1},this.dialog.open(Be,e).afterClosed().subscribe(r=>{r&&this.consentsManager.evaluateConsentsForService(this.service.id).subscribe(()=>this.notificator.showSuccess(this.translate.instant("SERVICE_DETAIL.EVALUATION_FINISH")))})}refresh(){this.serviceManager.getServiceById(this.serviceId).subscribe(e=>{this.service=e;let t=this.sideMenuItemService.parseService(this.service);this.sideMenuService.setAdminItems([t]),this.loading=!1},()=>this.loading=!1)}};o.\u0275fac=function(t){return new(t||o)(p(Ce),p(Ae),p(Te),p(xe),p(se),p(ke),p(B),p(w),p(Ke),p(ae),p(G))},o.\u0275cmp=E({type:o,selectors:[["app-service-detail-page"]],decls:5,vars:2,consts:[[1,"container-fluid","ps-xl-5","pe-xl-5","service-theme"],["class","ms-auto me-auto",4,"ngIf"],["class","page-title-headtitle detail-layout",4,"ngIf"],[1,"ms-auto","me-auto"],[1,"page-title-headtitle","detail-layout"],["svgIcon","perun-service",1,"perun-icon","perun-icon-detail",3,"matTooltip","ngStyle"],[1,"wrap-container"],[1,"detail-info"],[1,"flex-column"],[1,"page-title-headline","d-flex","align-items-center"],["data-cy","service-name-link",1,"service-link",3,"perunWebAppsMiddleClickRouterLink","routerLink","auxclick"],[1,"text-muted"],["aria-label","Edit service","data-cy","service-edit-button","mat-icon-button","",3,"matTooltip","click",4,"ngIf"],["aria-label","Remove service","mat-icon-button","",3,"matTooltip","click",4,"ngIf"],[1,"mt-1","entity-info"],[1,"detail-actions"],["labelPosition","before",1,"mb-25",3,"checked","toggleChange"],["class","action-button evaluate-button","mat-stroked-button","",3,"click",4,"ngIf"],["aria-label","Edit service","data-cy","service-edit-button","mat-icon-button","",3,"matTooltip","click"],["aria-label","Remove service","mat-icon-button","",3,"matTooltip","click"],["mat-stroked-button","",1,"action-button","evaluate-button",3,"click"]],template:function(t,r){t&1&&(s(0,"div",0),b(1,"perun-web-apps-back-button"),g(2,Gi,1,0,"mat-spinner",1)(3,Yi,24,28,"div",2),b(4,"app-animated-router-outlet"),l()),t&2&&(a(2),c("ngIf",r.loading),a(),c("ngIf",!r.loading))},dependencies:[N,ne,Ee,re,O,Re,Le,oe,at,ce,le,dt,Ne,x],styles:[".detail-layout[_ngcontent-%COMP%]{display:flex;flex-direction:row;gap:1.2em}.detail-info[_ngcontent-%COMP%]{display:flex;flex-direction:row;margin-right:1.2em}.wrap-container[_ngcontent-%COMP%]{display:flex;flex-direction:row;flex-wrap:wrap;gap:.3em}.detail-actions[_ngcontent-%COMP%]{display:flex;flex-direction:column;border-left:1px solid rgba(0,0,0,.2);padding-left:.5em}.evaluate-button[_ngcontent-%COMP%]{width:fit-content}"],data:{animation:[_t]}});let i=o;return i})();var mi=(()=>{let o=class o{constructor(e){this.entityStorageService=e,this.navItems=[]}ngOnInit(){this.service=this.entityStorageService.getEntity(),this.initNavItems()}initNavItems(){this.navItems=[{cssIcon:"perun-attributes",url:`/admin/services/${this.service.id}/required-attributes`,label:"MENU_ITEMS.SERVICE.REQUIRED_ATTRIBUTES",style:"service-btn"},{cssIcon:"perun-service_destination",url:`/admin/services/${this.service.id}/destinations`,label:"MENU_ITEMS.SERVICE.DESTINATIONS",style:"service-btn"}]}};o.\u0275fac=function(t){return new(t||o)(p(G))},o.\u0275cmp=E({type:o,selectors:[["app-service-overview"]],decls:1,vars:1,consts:[[3,"items"]],template:function(t,r){t&1&&b(0,"perun-web-apps-menu-buttons-field",0),t&2&&c("items",r.navItems)},dependencies:[Oe]});let i=o;return i})();function Xi(i,o){if(i&1){let n=C();s(0,"button",8),h("click",function(){S(n);let t=f();return I(t.onAdd())}),_(1),d(2,"translate"),l()}i&2&&(a(),A(" ",u(2,1,"SERVICE_DETAIL.REQUIRED_ATTRIBUTES.ADD")," "))}function Qi(i,o){if(i&1){let n=C();s(0,"button",9),h("click",function(){S(n);let t=f();return I(t.onRemove())}),_(1),d(2,"translate"),l()}if(i&2){let n=f();c("disabled",n.loading||n.selection.selected.length===0),a(),A(" ",u(2,2,"SERVICE_DETAIL.REQUIRED_ATTRIBUTES.REMOVE")," ")}}function Zi(i,o){i&1&&b(0,"perun-web-apps-loading-table")}function Ji(i,o){if(i&1){let n=C();s(0,"app-attr-def-list",10),h("refreshEvent",function(){S(n);let t=f();return I(t.refreshTable())}),l()}if(i&2){let n=f();c("loading",n.loading)("definitions",n.attrDefinitions)("filterValue",n.filterValue)("selection",n.selection)("cachedSubject",n.cachedSubject)("disableRouting",!n.authResolver.isPerunAdmin())("tableId",n.tableId)}}var di=(()=>{let o=class o{constructor(e,t,r,m){this.attributeManager=e,this.dialog=t,this.authResolver=r,this.entityStorageService=m,this.loading=!1,this.filterValue="",this.selection=new H(!0,[],!0,(v,D)=>v.id===D.id),this.cachedSubject=new y(!0),this.attrDefinitions=[],this.tableId=it}ngOnInit(){this.loading=!0,this.service=this.entityStorageService.getEntity(),this.refreshTable()}refreshTable(){this.loading=!0,this.attributeManager.getRequiredAttributesDefinition(this.service.id).subscribe(e=>{this.selection.clear(),this.cachedSubject.next(!0),this.attrDefinitions=e,this.loading=!1})}onAdd(){let e=T();e.width="950px",e.data={serviceId:this.service.id,theme:"service-theme"},this.dialog.open(Mt,e).afterClosed().subscribe(r=>{r&&this.refreshTable()})}onRemove(){let e=T();e.width="650px",e.data={serviceId:this.service.id,attrDefinitions:this.selection.selected,theme:"service-theme"},this.dialog.open(Rt,e).afterClosed().subscribe(r=>{r&&this.refreshTable()})}applyFilter(e){this.filterValue=e,this.refreshTable()}};o.\u0275fac=function(t){return new(t||o)(p(X),p(B),p(w),p(G))},o.\u0275cmp=E({type:o,selectors:[["app-service-required-attributes"]],decls:12,vars:8,consts:[[1,"page-subtitle"],[3,"refresh"],["color","accent","class","me-2 action-button","mat-flat-button","",3,"click",4,"ngIf"],["class","me-2","color","warn","mat-flat-button","",3,"disabled","click",4,"ngIf"],[3,"placeholder","filter"],["spinner",""],[1,"position-relative","table-min-height"],[3,"loading","definitions","filterValue","selection","cachedSubject","disableRouting","tableId","refreshEvent",4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],["color","accent","mat-flat-button","",1,"me-2","action-button",3,"click"],["color","warn","mat-flat-button","",1,"me-2",3,"disabled","click"],[3,"loading","definitions","filterValue","selection","cachedSubject","disableRouting","tableId","refreshEvent"]],template:function(t,r){if(t&1&&(s(0,"div")(1,"h1",0),_(2),d(3,"translate"),l(),s(4,"perun-web-apps-refresh-button",1),h("refresh",function(){return r.refreshTable()}),l(),g(5,Xi,3,3,"button",2)(6,Qi,3,4,"button",3),s(7,"perun-web-apps-debounce-filter",4),h("filter",function(v){return r.applyFilter(v)}),l(),g(8,Zi,1,0,"ng-template",null,5,L),s(10,"div",6),g(11,Ji,1,7,"app-attr-def-list",7),l()()),t&2){let m=M(9);a(2),R(u(3,6,"SERVICE_DETAIL.REQUIRED_ATTRIBUTES.TITLE")),a(3),c("ngIf",r.authResolver.isPerunAdmin()),a(),c("ngIf",r.authResolver.isPerunAdmin()),a(),c("placeholder","SERVICE_DETAIL.REQUIRED_ATTRIBUTES.FILTER"),a(4),c("perunWebAppsLoader",r.loading)("perunWebAppsLoaderIndicator",m)}},dependencies:[N,O,Pe,V,P,U,k,x]});let i=o;return i})();function en(i,o){if(i&1){let n=C();s(0,"button",9),h("click",function(){S(n);let t=f();return I(t.onRemove())}),_(1),d(2,"translate"),l()}if(i&2){let n=f();c("disabled",n.loading||n.selection.selected.length===0),a(),A(" ",u(2,2,"SERVICE_DETAIL.DESTINATIONS.REMOVE")," ")}}function tn(i,o){if(i&1){let n=C();s(0,"button",10),h("click",function(){S(n);let t=f();return I(t.onAllow())}),_(1),d(2,"translate"),l()}if(i&2){let n=f();c("disabled",n.loading||n.selection.selected.length===0),a(),A(" ",u(2,2,"SERVICE_DETAIL.DESTINATIONS.ALLOW")," ")}}function nn(i,o){if(i&1){let n=C();s(0,"button",9),h("click",function(){S(n);let t=f();return I(t.onBlock())}),_(1),d(2,"translate"),l()}if(i&2){let n=f();c("disabled",n.loading||n.selection.selected.length===0),a(),A(" ",u(2,2,"SERVICE_DETAIL.DESTINATIONS.BLOCK")," ")}}function on(i,o){i&1&&b(0,"perun-web-apps-loading-table")}var rn=()=>["select","destinationId","facility","destination","type","status","propagationType"];function an(i,o){if(i&1&&b(0,"app-perun-web-apps-destination-list",11),i&2){let n=f();c("loading",n.loading)("destinations",n.destinations)("filterValue",n.filterValue)("selection",n.selection)("cachedSubject",n.cachedSubject)("displayedColumns",W(7,rn))("tableId",n.tableId)}}var ui=(()=>{let o=class o{constructor(e,t,r,m,v,D){this.serviceManager=e,this.notificator=t,this.translate=r,this.dialog=m,this.authResolver=v,this.entityStorageService=D,this.loading=!1,this.filterValue="",this.destinations=[],this.selection=new H(!0,[],!0,($,Z)=>$.id===Z.id),this.cachedSubject=new y(!0),this.tableId=tt}ngOnInit(){this.loading=!0,this.service=this.entityStorageService.getEntity(),this.refreshTable()}refreshTable(){this.loading=!0,this.serviceManager.getAllRichDestinationsForService(this.service.id).subscribe(e=>{this.selection.clear(),this.cachedSubject.next(!0),this.filterValue="",this.destinations=e,this.loading=!1})}onBlock(){this.loading=!0,this.blockServiceOnDestinations(this.selection.selected)}onAllow(){this.loading=!0,this.allowServiceOnDestinations(this.selection.selected)}onRemove(){let e=T();e.width="500px",e.data={destinations:this.selection.selected,theme:"admin-theme"},this.dialog.open(Tt,e).afterClosed().subscribe(r=>{r&&this.refreshTable()})}applyFilter(e){this.filterValue=e,this.refreshTable()}blockServiceOnDestinations(e){this.serviceManager.blockServicesOnDestinations({richDestinations:e}).subscribe({next:()=>{this.notificator.showSuccess(this.translate.instant("SERVICE_DETAIL.DESTINATIONS.BLOCK_SUCCESS")),this.refreshTable()},error:()=>this.loading=!1})}allowServiceOnDestinations(e){this.serviceManager.unblockServicesOnDestinations({richDestinations:e}).subscribe({next:()=>{this.notificator.showSuccess(this.translate.instant("SERVICE_DETAIL.DESTINATIONS.ALLOW_SUCCESS")),this.refreshTable()},error:()=>this.loading=!1})}};o.\u0275fac=function(t){return new(t||o)(p(xe),p(ae),p(we),p(B),p(w),p(G))},o.\u0275cmp=E({type:o,selectors:[["app-service-destinations"]],decls:13,vars:9,consts:[[1,"page-subtitle"],[3,"refresh"],["color","warn","class","me-2","mat-flat-button","",3,"disabled","click",4,"ngIf"],["class","me-2","color","accent","mat-flat-button","",3,"disabled","click",4,"ngIf"],["class","me-2","color","warn","mat-flat-button","",3,"disabled","click",4,"ngIf"],[3,"placeholder","filter"],["spinner",""],[1,"position-relative","table-min-height"],[3,"loading","destinations","filterValue","selection","cachedSubject","displayedColumns","tableId",4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],["color","warn","mat-flat-button","",1,"me-2",3,"disabled","click"],["color","accent","mat-flat-button","",1,"me-2",3,"disabled","click"],[3,"loading","destinations","filterValue","selection","cachedSubject","displayedColumns","tableId"]],template:function(t,r){if(t&1&&(s(0,"div")(1,"h1",0),_(2),d(3,"translate"),l(),s(4,"perun-web-apps-refresh-button",1),h("refresh",function(){return r.refreshTable()}),l(),g(5,en,3,4,"button",2)(6,tn,3,4,"button",3)(7,nn,3,4,"button",4),s(8,"perun-web-apps-debounce-filter",5),h("filter",function(v){return r.applyFilter(v)}),l(),g(9,on,1,0,"ng-template",null,6,L),s(11,"div",7),g(12,an,1,8,"app-perun-web-apps-destination-list",8),l()()),t&2){let m=M(10);a(2),R(u(3,7,"SERVICE_DETAIL.DESTINATIONS.TITLE")),a(3),c("ngIf",r.authResolver.isPerunAdmin()),a(),c("ngIf",r.authResolver.isPerunAdmin()),a(),c("ngIf",r.authResolver.isPerunAdmin()),a(),c("placeholder","SERVICE_DETAIL.DESTINATIONS.FILTER"),a(4),c("perunWebAppsLoader",r.loading)("perunWebAppsLoaderIndicator",m)}},dependencies:[N,O,Et,V,P,U,k,x]});let i=o;return i})();function sn(i,o){if(i&1){let n=C();s(0,"button",8),h("click",function(){S(n);let t=f();return I(t.addOwner())}),_(1),d(2,"translate"),l()}i&2&&(a(),A(" ",u(2,1,"ADMIN.OWNERS.ADD")," "))}function ln(i,o){if(i&1){let n=C();s(0,"button",9),h("click",function(){S(n);let t=f();return I(t.removeOwner())}),_(1),d(2,"translate"),l()}if(i&2){let n=f();c("disabled",n.loading||!n.selected.selected.length),a(),A(" ",u(2,2,"ADMIN.OWNERS.DELETE")," ")}}function cn(i,o){i&1&&b(0,"perun-web-apps-loading-table")}function pn(i,o){if(i&1&&b(0,"perun-web-apps-owners-list",10),i&2){let n=f();c("selection",n.selected)("cachedSubject",n.cachedSubject)("loading",n.loading)("filterValue",n.filterValue)("owners",n.owners)("tableId",n.tableId)}}var fi=(()=>{let o=class o{constructor(e,t,r){this.ownersManagerService=e,this.dialog=t,this.guiAuthResolver=r,this.owners=[],this.selected=new H(!0,[],!0,(m,v)=>m.id===v.id),this.cachedSubject=new y(!0),this.filterValue="",this.tableId=Ze}ngOnInit(){this.setAuth(),this.refreshTable()}setAuth(){this.removeAuth=this.guiAuthResolver.isAuthorized("deleteOwner_Owner_policy",[]),this.addAuth=this.guiAuthResolver.isAuthorized("createOwner_Owner_policy",[])}refreshTable(){this.loading=!0,this.ownersManagerService.getAllOwners().subscribe(e=>{this.owners=e,this.selected.clear(),this.cachedSubject.next(!0),this.loading=!1})}applyFilter(e){this.filterValue=e,this.refreshTable()}addOwner(){let e=T();e.width="400px",e.data={},this.dialog.open(Nt,e).afterClosed().subscribe(r=>{r&&this.refreshTable()})}removeOwner(){let e=T();e.width="400px",e.data=this.selected.selected,this.dialog.open(Bt,e).afterClosed().subscribe(r=>{r&&(this.selected.clear(),this.refreshTable())})}};o.\u0275fac=function(t){return new(t||o)(p(ze),p(B),p(w))},o.\u0275cmp=E({type:o,selectors:[["app-admin-owners"]],decls:12,vars:8,consts:[[1,"page-subtitle"],[3,"refresh"],["color","accent","class","me-2 action-button","mat-flat-button","",3,"click",4,"ngIf"],["class","me-2","color","warn","mat-flat-button","",3,"disabled","click",4,"ngIf"],[3,"placeholder","filter"],["spinner",""],[1,"position-relative","table-min-height"],[3,"selection","cachedSubject","loading","filterValue","owners","tableId",4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],["color","accent","mat-flat-button","",1,"me-2","action-button",3,"click"],["color","warn","mat-flat-button","",1,"me-2",3,"disabled","click"],[3,"selection","cachedSubject","loading","filterValue","owners","tableId"]],template:function(t,r){if(t&1&&(s(0,"div")(1,"h1",0),_(2),d(3,"translate"),l(),s(4,"perun-web-apps-refresh-button",1),h("refresh",function(){return r.refreshTable()}),l(),g(5,sn,3,3,"button",2)(6,ln,3,4,"button",3),s(7,"perun-web-apps-debounce-filter",4),h("filter",function(v){return r.applyFilter(v)}),l(),g(8,cn,1,0,"ng-template",null,5,L),s(10,"div",6),g(11,pn,1,6,"perun-web-apps-owners-list",7),l()()),t&2){let m=M(9);a(2),R(u(3,6,"ADMIN.OWNERS.TITLE")),a(3),c("ngIf",r.addAuth),a(),c("ngIf",r.removeAuth),a(),c("placeholder","ADMIN.OWNERS.FILTER"),a(4),c("perunWebAppsLoader",r.loading)("perunWebAppsLoaderIndicator",m)}},dependencies:[N,O,V,P,U,ht,k,x]});let i=o;return i})();function mn(i,o){i&1&&b(0,"perun-web-apps-loading-table")}function dn(i,o){if(i&1){let n=C();s(0,"app-audit-messages-list",7),h("queryChanged",function(t){S(n);let r=f();return I(r.nextPage.next(t))}),d(1,"async"),d(2,"async"),l()}if(i&2){let n=f();c("loading",u(1,4,n.loading$))("displayedColumns",n.displayedColumns)("auditMessages",u(2,6,n.messagesPage$))("tableId",n.tableId)}}var hi=(()=>{let o=class o{constructor(e){this.auditMessagesManagerService=e,this.tableId=nt,this.displayedColumns=["id","timestamp","name","actor","event.message","detail"],this.selectedEvents=[],this.eventOptions=[],this.eventOptionsForSearchSelect=[],this.nextPage=new y({}),this.messagesPage$=this.nextPage.pipe(he(t=>this.auditMessagesManagerService.getMessagesPage({query:{offset:t.offset,pageSize:t.pageSize,order:t.order,selectedEvents:this.selectedEvents}})),_e(t=>{this.auditMessages=t.data,setTimeout(()=>this.loadingSubject$.next(!1),200)}),fe({data:[],totalCount:0,offset:0,pageSize:0})),this.loadingSubject$=new y(!1),this.loading$=ue(this.loadingSubject$,this.nextPage.pipe(de(()=>!0)))}ngOnInit(){this.auditMessagesManagerService.findAllPossibleEvents().subscribe(e=>{this.eventOptions=e.sort(),this.eventOptionsForSearchSelect=this.eventOptions})}refreshTable(){this.nextPage.next(this.nextPage.value)}toggleEvent(e){this.selectedEvents.splice(0,this.selectedEvents.length,...e)}refreshOnClosed(){this.selectedEvents=[...this.selectedEvents];let e=this.eventOptions.filter(t=>!this.selectedEvents.includes(t));this.eventOptionsForSearchSelect=[...this.selectedEvents,...e],this.refreshTable()}};o.\u0275fac=function(t){return new(t||o)(p(qe))},o.\u0275cmp=E({type:o,selectors:[["app-admin-audit-log"]],decls:11,vars:9,consts:[[1,"page-subtitle"],[1,"align-elements"],[3,"refresh"],[3,"disableDeselectButton","auditLogs","auditLogsSelected","selectClosed"],["spinner",""],[1,"position-relative","w-100","table-min-height"],[3,"loading","displayedColumns","auditMessages","tableId","queryChanged",4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],[3,"loading","displayedColumns","auditMessages","tableId","queryChanged"]],template:function(t,r){if(t&1&&(s(0,"h1",0),_(1),d(2,"translate"),l(),s(3,"div",1)(4,"perun-web-apps-refresh-button",2),h("refresh",function(){return r.refreshTable()}),l(),s(5,"perun-web-apps-audit-log-search-select",3),h("auditLogsSelected",function(v){return r.toggleEvent(v)})("selectClosed",function(){return r.refreshOnClosed()}),l(),g(6,mn,1,0,"ng-template",null,4,L),s(8,"div",5),g(9,dn,3,8,"app-audit-messages-list",6),d(10,"async"),l()()),t&2){let m=M(7);a(),R(u(2,5,"ADMIN.AUDIT_LOG.TITLE")),a(4),c("disableDeselectButton",!1)("auditLogs",r.eventOptionsForSearchSelect),a(4),c("perunWebAppsLoader",u(10,7,r.loading$))("perunWebAppsLoaderIndicator",m)}},dependencies:[Ot,V,P,gt,k,Ie,x]});let i=o;return i})();function un(i,o){i&1&&(s(0,"perun-web-apps-alert",9),_(1),d(2,"translate"),l()),i&2&&(a(),A(" ",u(2,1,"ADMIN.CONSENT_HUBS.GLOBAL_DISABLED")," "))}function fn(i,o){if(i&1){let n=C();s(0,"button",10),h("click",function(){S(n);let t=f();return I(t.evaluateConsents())}),_(1),d(2,"translate"),l()}if(i&2){let n=f();c("disabled",!n.globalForceConsents||n.loading||n.selection.selected.length===0),a(),A(" ",u(2,2,"ADMIN.CONSENT_HUBS.EVALUATE_CONSENTS")," ")}}function hn(i,o){i&1&&b(0,"perun-web-apps-loading-table")}function _n(i,o){if(i&1&&b(0,"app-perun-web-apps-consent-hubs-list",11),i&2){let n=f();c("loading",n.loading)("consentHubs",n.consentHubs)("selection",n.selection)("cachedSubject",n.cachedSubject)("filterValue",n.filterValue)("tableId",n.tableId)}}var _i=(()=>{let o=class o{constructor(e,t,r,m,v,D){this.consentsManager=e,this.authResolver=t,this.notificator=r,this.translate=m,this.store=v,this.dialog=D,this.loading=!1,this.tableId=ot,this.selection=new H(!0,[],!0,($,Z)=>$.id===Z.id),this.filterValue="",this.consentHubs=[],this.cachedSubject=new y(!0)}ngOnInit(){this.globalForceConsents=this.store.getProperty("enforce_consents"),this.refreshTable()}applyFilter(e){this.filterValue=e,this.refreshTable()}refreshTable(){this.loading=!0,this.selection.clear(),this.cachedSubject.next(!0),this.consentsManager.getAllConsentHubs().subscribe(e=>{this.consentHubs=e,this.loading=!1})}evaluateConsents(){let e=T();e.width="500px",e.data={title:this.translate.instant("ADMIN.CONSENT_HUBS.CONFIRM_DIALOG_TITLE"),theme:"admin-theme",description:this.translate.instant("ADMIN.CONSENT_HUBS.CONFIRM_DIALOG_DESCRIPTION"),items:this.selection.selected.map(r=>r.name),type:"confirmation",showAsk:!1},this.dialog.open(Be,e).afterClosed().subscribe(r=>{r&&this.evaluateConsentsForConsentHubs()})}evaluateConsentsForConsentHubs(){this.loading=!0;let e=this.selection.selected.map(t=>t.id);this.consentsManager.evaluateConsentsForConsentHubs(e).subscribe({next:()=>{this.notificator.showSuccess(this.translate.instant("ADMIN.CONSENT_HUBS.EVALUATION_FINISH")),this.refreshTable()},error:()=>this.loading=!1})}};o.\u0275fac=function(t){return new(t||o)(p(Te),p(w),p(ae),p(we),p(Me),p(B))},o.\u0275cmp=E({type:o,selectors:[["app-perun-web-apps-admin-consent-hubs"]],decls:14,vars:12,consts:[[1,"page-subtitle"],["alert_type","warn",4,"ngIf"],[3,"refresh"],[3,"matTooltipDisabled","matTooltip"],["color","accent","class","action-button me-2","mat-flat-button","",3,"disabled","click",4,"ngIf"],[3,"placeholder","filter"],["spinner",""],[1,"position-relative","table-min-height"],[3,"loading","consentHubs","selection","cachedSubject","filterValue","tableId",4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],["alert_type","warn"],["color","accent","mat-flat-button","",1,"action-button","me-2",3,"disabled","click"],[3,"loading","consentHubs","selection","cachedSubject","filterValue","tableId"]],template:function(t,r){if(t&1&&(s(0,"div")(1,"h1",0),_(2),d(3,"translate"),l(),g(4,un,3,3,"perun-web-apps-alert",1),s(5,"perun-web-apps-refresh-button",2),h("refresh",function(){return r.refreshTable()}),l(),s(6,"span",3),d(7,"translate"),g(8,fn,3,4,"button",4),l(),s(9,"perun-web-apps-debounce-filter",5),h("filter",function(v){return r.applyFilter(v)}),l(),g(10,hn,1,0,"ng-template",null,6,L),s(12,"div",7),g(13,_n,1,6,"app-perun-web-apps-consent-hubs-list",8),l()()),t&2){let m=M(11);a(2),R(u(3,8,"ADMIN.CONSENT_HUBS.TITLE")),a(2),c("ngIf",!r.globalForceConsents),a(2),F("matTooltip",u(7,10,"ADMIN.CONSENT_HUBS.TOOLTIP")),c("matTooltipDisabled",r.globalForceConsents),a(2),c("ngIf",r.authResolver.isPerunAdmin()),a(),c("placeholder","ADMIN.CONSENT_HUBS.SEARCH"),a(4),c("perunWebAppsLoader",r.loading)("perunWebAppsLoaderIndicator",m)}},dependencies:[N,O,oe,kt,st,V,P,U,k,x]});let i=o;return i})();function gn(i,o){if(i&1){let n=C();s(0,"button",10),h("click",function(){S(n);let t=f();return I(t.block())}),_(1),d(2,"translate"),l()}i&2&&(a(),A(" ",u(2,1,"ADMIN.BLOCKED_LOGINS.BLOCK")," "))}function bn(i,o){if(i&1){let n=C();s(0,"button",11),h("click",function(){S(n);let t=f();return I(t.unblock())}),d(1,"async"),_(2),d(3,"translate"),l()}if(i&2){let n=f();c("disabled",u(1,2,n.loading$)||n.selection.selected.length===0),a(2),A(" ",u(3,4,"ADMIN.BLOCKED_LOGINS.UNBLOCK")," ")}}function vn(i,o){i&1&&b(0,"perun-web-apps-loading-table")}function Sn(i,o){if(i&1){let n=C();s(0,"perun-web-apps-logins-list",12),h("queryChanged",function(t){S(n);let r=f();return I(r.nextPage.next(t))})("downloadAll",function(t){S(n);let r=f();return I(r.downloadAll(t))}),d(1,"async"),d(2,"async"),l()}if(i&2){let n=f();c("loading",u(1,7,n.loading$))("blockedLogins",u(2,9,n.blockedLoginsPage$))("displayedColumns",n.displayedColumns)("selection",n.selection)("filter",n.searchString)("tableId",n.tableId)("cacheSubject",n.cacheSubject)}}var gi=(()=>{let o=class o{constructor(e,t,r,m,v){this.cd=e,this.dialog=t,this.attributesService=r,this.authResolver=m,this.userManager=v,this.tableId=rt,this.isAdmin=!1,this.selection=new H(!0,[],!0,(D,$)=>D.id===$.id),this.logins=[],this.namespaceOptions=[],this.filterOptions=[],this.selectedNamespaces=[],this.namespaces=new Ye,this.displayedColumns=["checkbox","login","namespace"],this.blockedLogins=[],this.nextPage=new y({}),this.blockedLoginsPage$=this.nextPage.pipe(he(D=>this.userManager.getBlockedLoginsPage({query:{order:D.order,pageSize:D.pageSize,offset:D.offset,sortColumn:D.sortColumn,searchString:D.searchString,namespaces:this.selectedNamespaces}})),_e(D=>{this.blockedLogins=D.data,this.selection.clear(),setTimeout(()=>this.loadingSubject$.next(!1),200)}),fe({data:[],totalCount:0,offset:0,pageSize:0})),this.loadingSubject$=new y(!1),this.cacheSubject=new y(!0),this.loading$=ue(this.loadingSubject$,this.nextPage.pipe(de(()=>!0)))}refreshTable(){this.cacheSubject.next(!0),this.nextPage.next(this.nextPage.value)}onSearchByString(e){this.searchString=e,this.cd.detectChanges()}ngOnInit(){this.namespaces.setValue(this.selectedNamespaces),this.isAdmin=this.authResolver.isPerunAdmin(),this.attributesService.getAllNamespaces().subscribe(e=>{this.namespaceOptions=e,this.filterOptions=[""].concat(e)})}block(){let e=T();e.width="450px",e.data={theme:"admin-theme",namespaceOptions:this.namespaceOptions},this.dialog.open(Pt,e).afterClosed().subscribe(r=>{r&&this.refreshTable()})}unblock(){let e=T();e.width="650px",e.data={logins:this.selection.selected,theme:"admin-theme"},this.dialog.open(Vt,e).afterClosed().subscribe(r=>{r&&this.refreshTable()})}toggleEvent(e){this.selectedNamespaces.splice(0,this.selectedNamespaces.length,...e.map(t=>t===""?null:t))}refreshOnClosed(){this.selectedNamespaces=[...this.selectedNamespaces],this.refreshTable()}downloadAll(e){let t=this.nextPage.getValue();this.userManager.getBlockedLoginsPage({query:{order:t.order,pageSize:e.length,offset:0,sortColumn:t.sortColumn,searchString:t.searchString,namespaces:this.selectedNamespaces}}).subscribe({next:r=>{Qe(Xe(r.data,this.displayedColumns,e.getDataForColumnFun),e.format)}})}};o.\u0275fac=function(t){return new(t||o)(p(He),p(B),p(X),p(w),p(De))},o.\u0275cmp=E({type:o,selectors:[["app-perun-web-apps-admin-blocked-logins"]],decls:16,vars:18,consts:[[1,"page-subtitle"],[1,"align-elements"],[3,"refresh"],["color","accent","class","me-2 action-button","data-cy","block-logins-button","mat-flat-button","",3,"click",4,"ngIf"],["class","me-2","color","warn","data-cy","unblock-logins-button","mat-flat-button","",3,"disabled","click",4,"ngIf"],[1,"pr-2","me-2","flex-grow-1",3,"namespaceOptions","multiple","disableAutoSelect","disableDeselectButton","customSelectPlaceholder","namespaceSelected","selectClosed"],[1,"search-field","flex-grow-1",3,"autoFocus","placeholder","filter"],["spinner",""],[1,"position-relative","table-min-height"],[3,"loading","blockedLogins","displayedColumns","selection","filter","tableId","cacheSubject","queryChanged","downloadAll",4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],["color","accent","data-cy","block-logins-button","mat-flat-button","",1,"me-2","action-button",3,"click"],["color","warn","data-cy","unblock-logins-button","mat-flat-button","",1,"me-2",3,"disabled","click"],[3,"loading","blockedLogins","displayedColumns","selection","filter","tableId","cacheSubject","queryChanged","downloadAll"]],template:function(t,r){if(t&1&&(s(0,"h1",0),_(1),d(2,"translate"),l(),s(3,"div",1)(4,"div")(5,"perun-web-apps-refresh-button",2),h("refresh",function(){return r.refreshTable()}),l(),g(6,gn,3,3,"button",3)(7,bn,4,6,"button",4),l(),s(8,"perun-web-apps-namespace-search-select",5),h("namespaceSelected",function(v){return r.toggleEvent(v)})("selectClosed",function(){return r.refreshOnClosed()}),d(9,"translate"),l(),s(10,"perun-web-apps-debounce-filter",6),h("filter",function(v){return r.onSearchByString(v)}),l()(),g(11,vn,1,0,"ng-template",null,7,L),s(13,"div",8),g(14,Sn,3,11,"perun-web-apps-logins-list",9),d(15,"async"),l()),t&2){let m=M(12);a(),R(u(2,12,"ADMIN.BLOCKED_LOGINS.TITLE")),a(5),c("ngIf",r.isAdmin),a(),c("ngIf",r.isAdmin),a(),c("namespaceOptions",r.filterOptions)("multiple",!0)("disableAutoSelect",!0)("disableDeselectButton",!1)("customSelectPlaceholder",u(9,14,"ADMIN.BLOCKED_LOGINS.FILTER_NAMESPACE")),a(2),c("autoFocus",!0)("placeholder","ADMIN.BLOCKED_LOGINS.SEARCH_PLACEHOLDER"),a(4),c("perunWebAppsLoader",u(15,16,r.loading$))("perunWebAppsLoaderIndicator",m)}},dependencies:[N,O,V,P,U,k,bt,vt,Ie,x]});let i=o;return i})();var In=[{path:"",component:ni,canActivateChild:[Ve],children:[{path:"",component:oi,data:{animation:"AdminOverviewPage"}},{path:"attributes",component:ri,data:{animation:"AdminAttributesPage"}},{path:"users",component:jt,data:{animation:"AdminUsersPage"}},{path:"owners",component:fi,data:{animation:"AdminOwnersPage"}},{path:"services",component:$t,data:{animation:"AdminServicesPage"}},{path:"audit_log",component:hi,data:{animation:"AdminAuditLogPage"}},{path:"ext_sources",component:li,data:{animation:"AdminExtSourcesPage"}},{path:"consent_hubs",component:_i,data:{animation:"AdminConsentHubsPage"}},{path:"searcher",component:Yt,data:{animation:"AdminSearcherPage"}},{path:"blocked_logins",component:gi,data:{animation:"AdminBlockedLoginsPage"}}]},{path:"users/:userId",component:si,canActivateChild:[Ve],children:[{path:"",component:Ft,data:{animation:"UserOverviewPage"}},{path:"accounts",component:Kt,data:{animation:"UserAccountsPage"}},{path:"assignments",component:Qt,data:{animation:"UserAssignmentsPage"}},{path:"attributes",component:Ht,data:{animation:"UserAttributesPage"}},{path:"identities",component:qt,data:{animation:"UserIdentitiesPage"}},{path:"identities/:identityId",component:yt,data:{animation:"UserIdentityDetailPage"}},{path:"roles",component:Wt,data:{animation:"UserRolesPage"}},{path:"service-identities",component:Gt,data:{animation:"UserServiceIdentities"}},{path:"associated-users",component:zt,data:{animation:"AssociatedUsersPage"}},{path:"bans",component:Xt,data:{animation:"UserBansPage"}}]},{path:"services/:serviceId",component:pi,canActivateChild:[Ve],children:[{path:"",component:mi,data:{animation:"ServiceOverviewPage"}},{path:"required-attributes",component:di,data:{animation:"ServiceRequiredAttributesPage"}},{path:"destinations",component:ui,data:{animation:"ServiceDestinationsPage"}}]}],bi=(()=>{let o=class o{};o.\u0275fac=function(t){return new(t||o)},o.\u0275mod=be({type:o}),o.\u0275inj=ge({imports:[Fe.forChild(In),Fe]});let i=o;return i})();var _s=(()=>{let o=class o{};o.\u0275fac=function(t){return new(t||o)},o.\u0275mod=be({type:o}),o.\u0275inj=ge({imports:[Ge,bi,Ut,lt,mt,St,pt,Zt]});let i=o;return i})();export{_s as a};
