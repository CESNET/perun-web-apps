import{a as Po,b as jo,c as Ho,d as Wo,e as Ko}from"./chunk-JWEHND2W.js";import{a as Oo,b as Vo}from"./chunk-ZZEKZC7N.js";import{a as Uo}from"./chunk-XMINPBSA.js";import{a as zo,b as $o,c as Yo}from"./chunk-HRKN6KTH.js";import{a as Lo,b as Bo,c as en,d as li,f as ko}from"./chunk-JYISBFUV.js";import{b as No}from"./chunk-UF2434UY.js";import{a as Fo,b as Go,c as qo}from"./chunk-GE72N2PZ.js";import{a as si,b as tn}from"./chunk-IHGBX2OY.js";import{$a as sn,$b as wi,$c as xn,$j as yo,Aa as P,Ad as qt,Ae as Fn,Af as _i,Ag as ti,Ai as mo,Aj as Eo,B as Cn,Ba as T,Bc as Y,Be as Gn,Bf as fi,Bi as Ki,Bj as Io,Ca as C,Cc as y,Cd as ae,Ce as jn,Cf as pn,Cj as Ao,Da as _,Dc as M,Dd as wn,Df as $n,Ed as Rn,Ef as Kn,Fd as xt,Fh as io,G as at,Gd as ki,H as se,Ha as ve,Hd as zt,Hh as no,Hi as uo,Ia as Te,Ic as me,Id as Pi,Ig as cn,Ih as oo,Ii as _o,Ja as Ee,K as Ot,Ka as R,Kd as Ln,Ki as fo,La as Ge,Lb as We,Lc as Bi,Ld as Fi,Li as ce,Lj as Yi,Ma as Pe,Mc as Ht,Md as Gi,Mi as ni,Mj as Qi,Na as d,Nh as ao,Nj as Xi,Oa as A,Oc as Wt,Od as _t,Of as j,Pa as f,Pc as be,Pd as Bn,Pe as Ze,Qa as rt,Qb as qe,Qc as It,Qd as le,Qe as et,Ra as Sn,Rb as ge,Rc as At,Re as tt,S as h,Sa as vn,Sb as ze,Sc as ct,Sd as On,Se as it,Sf as Xt,Si as dn,T as g,Ta as gt,Tb as xi,Tc as Dt,Td as Lt,Te as nt,Ti as ho,Ua as Ct,Ue as $t,Ui as go,V as Nt,Va as bt,Vc as In,Ve as Kt,Vi as oi,W as Ei,Wa as fe,Wb as Rt,Wc as Ke,We as Hn,Wf as Yn,Wh as ro,Wi as Co,Xa as Ie,Xc as An,Xe as Wn,Xf as ke,Xg as yt,Xj as Do,Ya as Et,Yb as Pt,Yc as Ye,Ye as qn,Yj as xo,Za as he,Zb as Mi,Zc as Dn,Ze as ln,Zf as Jt,Zg as ii,Zj as Mo,_ as bn,_a as De,_b as yi,_e as Mt,_i as bo,aa as o,ac as Ri,ad as Oi,ae as ui,ag as Qn,ak as Ji,bd as O,be as Nn,cb as l,cd as L,ck as wo,d as G,db as p,dd as Mn,de as ji,di as so,dj as So,dk as Ro,ea as m,eb as je,ec as pt,ed as dt,ee as Ve,eh as Jn,ei as lo,fa as D,fb as Ai,fd as mt,fe as re,fk as ai,g as un,gd as ut,ge as J,h as ft,hc as Li,hd as Qe,he as pe,hk as ri,ia as vt,ib as B,ic as Ft,id as Q,ie as $,if as zn,ik as Zi,jb as Di,jc as $e,jd as X,je as Z,jj as de,k as ht,ka as S,kd as H,ke as ee,kh as Zn,l as _n,la as Tt,lb as Tn,lc as Gt,ld as ue,le as te,lh as eo,lj as vo,mc as jt,me as ie,mf as V,mg as Xn,mi as po,nc as K,oa as mi,ob as kt,oc as xe,oi as ot,pb as He,pc as Me,pe as Un,pf as Yt,qa as E,qc as ye,qf as Qt,qg as qi,r as Bt,ra as I,rc as we,rf as Fe,sa as Ii,sb as En,sc as Re,sd as Ni,sf as st,t as Ti,ta as Ut,tb as x,tc as Le,td as Xe,tf as Wi,ua as Vt,uc as Be,ud as Je,ue as Hi,va as u,vc as Oe,ve as Vn,vg as zi,vh as to,w as fn,wa as r,wc as Ne,wd as Ui,wg as Zt,xa as a,xc as Ue,xd as N,xe as kn,xi as co,y as hn,ya as b,yc as Ce,yd as Vi,ye as Pn,yi as $i,yj as To,z as gn,za as k,zc as Ae,zd as yn,zg as ei}from"./chunk-SKATJHFB.js";import{a as vi}from"./chunk-TSRGIXR5.js";var Ga=()=>({color:"black"}),Jo=(()=>{class t{constructor(e){this.sideMenuService=e}ngOnInit(){this.sideMenuService.setAdminItems([])}static{this.\u0275fac=function(n){return new(n||t)(m(ri))}}static{this.\u0275cmp=D({type:t,selectors:[["app-admin-page"]],decls:7,vars:5,consts:[[1,"container-fluid","ps-xl-5","pe-xl-5","admin-theme"],[1,"page-title","d-flex"],["svgIcon","perun-perun-admin",1,"perun-icon","icon-scale",3,"ngStyle"]],template:function(n,i){n&1&&(r(0,"div",0),b(1,"perun-web-apps-back-button"),r(2,"h1",1),b(3,"mat-icon",2),d(4),l(5,"translate"),a(),b(6,"app-animated-router-outlet"),a()),n&2&&(o(3),u("ngStyle",he(4,Ga)),o(),f(" ",p(5,2,"ADMIN.TITLE")," "))},dependencies:[x,kt,Qe,ut,ai,ni,si,M,y],encapsulation:2})}}return t})();var Zo=(()=>{class t{constructor(){this.items=[{cssIcon:"perun-attributes",url:"/admin/attributes",label:"MENU_ITEMS.ADMIN.ATTRIBUTES",style:"admin-btn"},{cssIcon:"perun-user",url:"/admin/users",label:"MENU_ITEMS.ADMIN.USERS",style:"admin-btn"},{cssIcon:"perun-service",url:"/admin/services",label:"MENU_ITEMS.ADMIN.SERVICES",style:"admin-btn"},{cssIcon:"perun-external-sources",url:"/admin/ext_sources",label:"MENU_ITEMS.ADMIN.EXT_SOURCES",style:"admin-btn"},{cssIcon:"perun-audit-log",url:"/admin/audit_log",label:"MENU_ITEMS.ADMIN.AUDIT_LOG",style:"admin-btn"},{cssIcon:"perun-consent-hubs",url:"/admin/consent_hubs",label:"MENU_ITEMS.ADMIN.CONSENT_HUBS",style:"admin-btn"},{cssIcon:"perun-searcher",url:"/admin/searcher",label:"MENU_ITEMS.ADMIN.SEARCHER",style:"admin-btn"},{cssIcon:"perun-blocked-logins",url:"/admin/blocked_logins",label:"MENU_ITEMS.ADMIN.BLOCKED_LOGINS",style:"admin-btn"},{cssIcon:"perun-automated-tasks",url:"/admin/tasks",label:"MENU_ITEMS.ADMIN.TASKS",style:"admin-btn"}]}static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275cmp=D({type:t,selectors:[["app-admin-overview"]],hostVars:2,hostBindings:function(n,i){n&2&&Ge("router-component",i.true)},decls:2,vars:1,consts:[[3,"items"]],template:function(n,i){n&1&&(r(0,"div"),b(1,"perun-web-apps-menu-buttons-field",0),a()),n&2&&(o(),u("items",i.items))},dependencies:[x,oi],encapsulation:2})}}return t})();function ja(t,c){t&1&&b(0,"perun-web-apps-loading-dialog")}function Ha(t,c){t&1&&b(0,"th",15)}function Wa(t,c){if(t&1&&(r(0,"td",16),d(1),a()),t&2){let e=c.$implicit;o(),A(e.friendlyName)}}function qa(t,c){t&1&&b(0,"tr",17)}function za(t,c){t&1&&b(0,"tr",18)}function $a(t,c){if(t&1){let e=T();r(0,"div")(1,"h1",2),d(2),l(3,"translate"),a(),r(4,"div",3)(5,"div"),d(6),l(7,"translate"),a(),r(8,"div",4),d(9),l(10,"translate"),a(),r(11,"table",5),k(12,6),S(13,Ha,1,0,"th",7)(14,Wa,2,1,"td",8),P(),S(15,qa,1,0,"tr",9)(16,za,1,0,"tr",10),a(),r(17,"perun-web-apps-alert",11),d(18),l(19,"translate"),a()(),r(20,"div",12)(21,"button",13),C("click",function(){h(e);let i=_();return g(i.onCancel())}),d(22),l(23,"translate"),a(),r(24,"button",14),C("click",function(){h(e);let i=_();return g(i.onSubmit())}),d(25),l(26,"translate"),a()()()}if(t&2){let e=_();o(2),A(p(3,10,"DIALOGS.DELETE_ATTRIBUTE_DEFINITION.TITLE")),o(4),f(" ",p(7,12,"DIALOGS.DELETE_ATTRIBUTE_DEFINITION.TEXT_LINE1")," "),o(3),f(" ",p(10,14,"DIALOGS.DELETE_ATTRIBUTE_DEFINITION.TEXT_LINE2")," "),o(2),u("dataSource",e.dataSource),o(4),u("matHeaderRowDef",e.displayedColumns),o(),u("matRowDefColumns",e.displayedColumns),o(2),f(" ",p(19,16,"DIALOGS.DELETE_ATTRIBUTE_DEFINITION.WARNING")," "),o(4),f(" ",p(23,18,"DIALOGS.DELETE_ATTRIBUTE_DEFINITION.CANCEL")," "),o(2),u("disabled",e.loading),o(),f(" ",p(26,20,"DIALOGS.DELETE_ATTRIBUTE_DEFINITION.CONFIRM")," ")}}var ea=(()=>{class t{constructor(e,n,i,s,v){this.dialogRef=e,this.data=n,this.notificator=i,this.translate=s,this.attributesManager=v,this.displayedColumns=["name"],this.loading=!1}ngOnInit(){this.theme=this.data.theme,this.dataSource=new Ae(this.data.attributes)}onCancel(){this.dialogRef.close(!1)}onSubmit(){this.loading=!0;let e=[];for(let n of this.data.attributes)e.push(n.id);this.attributesManager.deleteAttributeDefinitions(e).subscribe(()=>{this.translate.get("DIALOGS.DELETE_ATTRIBUTE_DEFINITION.SUCCESS").subscribe(n=>{this.notificator.showSuccess(n),this.dialogRef.close(!0)})},()=>this.loading=!1)}static{this.\u0275fac=function(n){return new(n||t)(m(J),m(pe),m(j),m(Y),m(ae))}}static{this.\u0275cmp=D({type:t,selectors:[["app-delete-attribute-definition-dialog"]],decls:4,vars:5,consts:[["spinner",""],[4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],["mat-dialog-title",""],["mat-dialog-content",""],[1,"fw-bold"],["mat-table","",1,"w-100",3,"dataSource"],["matColumnDef","name"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["class","font-weight-bolder","mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["alert_type","warn",1,"mt-3"],["mat-dialog-actions","",1,"mt-3"],["mat-stroked-button","",1,"ms-auto",3,"click"],["color","warn","mat-flat-button","","data-cy","confirm-delete-attr-definition-button",1,"ms-2",3,"click","disabled"],["mat-header-cell",""],["mat-cell",""],["mat-header-row","",1,"font-weight-bolder"],["mat-row",""]],template:function(n,i){if(n&1&&(S(0,ja,1,0,"ng-template",null,0,B),r(2,"div"),S(3,$a,27,22,"div",1),a()),n&2){let s=R(1);o(2),Pe(Ie("",i.theme," position-relative")),o(),u("perunWebAppsLoader",i.loading)("perunWebAppsLoaderIndicator",s)}},dependencies:[x,L,O,ie,Z,te,ee,X,Q,ue,Ce,xe,ye,Be,we,Me,Oe,Re,Le,Ne,Ue,M,N,y],encapsulation:2})}}return t})();var on=(()=>{class t{transform(e){if(e===null)return null;let n=e;return n.substring(n.lastIndexOf(".")+1,n.length)}static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275pipe=vt({name:"attributeTypeClean",type:t,pure:!0})}}return t})();function Ya(t,c){t&1&&b(0,"perun-web-apps-loading-dialog")}function Qa(t,c){t&1&&(r(0,"mat-error"),d(1),l(2,"translate"),a()),t&2&&(o(),f(" ",p(2,1,"DIALOGS.NAME_SPACE_ERROR")," "))}function Xa(t,c){t&1&&(r(0,"mat-error"),d(1),l(2,"translate"),a()),t&2&&(o(),f(" ",p(2,1,"DIALOGS.CREATE_ATTRIBUTE_DEFINITION.ERROR_FIELD_EMPTY")," "))}function Ja(t,c){t&1&&(r(0,"mat-error"),d(1),l(2,"translate"),a()),t&2&&(o(),f(" ",p(2,1,"DIALOGS.NAME_SPACE_ERROR")," "))}function Za(t,c){t&1&&(r(0,"mat-error"),d(1),l(2,"translate"),a()),t&2&&(o(),f(" ",p(2,1,"DIALOGS.CREATE_ATTRIBUTE_DEFINITION.ERROR_FIELD_EMPTY")," "))}function er(t,c){t&1&&(r(0,"mat-error"),d(1),l(2,"translate"),a()),t&2&&(o(),f(" ",p(2,1,"DIALOGS.CREATE_ATTRIBUTE_DEFINITION.ERROR_FIELD_EMPTY")," "))}function tr(t,c){if(t&1&&(r(0,"mat-option",10),d(1),a()),t&2){let e=c.$implicit;u("value",e),o(),A(e)}}function ir(t,c){t&1&&(r(0,"mat-error"),d(1),l(2,"translate"),a()),t&2&&(o(),f(" ",p(2,1,"DIALOGS.CREATE_ATTRIBUTE_DEFINITION.ERROR_FIELD_EMPTY")," "))}function nr(t,c){if(t&1&&(r(0,"mat-option",10),d(1),a()),t&2){let e=c.$implicit;u("value",e),o(),f("",e," ")}}function or(t,c){t&1&&(r(0,"mat-error"),d(1),l(2,"translate"),a()),t&2&&(o(),f(" ",p(2,1,"DIALOGS.CREATE_ATTRIBUTE_DEFINITION.ERROR_FIELD_EMPTY")," "))}function ar(t,c){if(t&1&&(r(0,"mat-option",10),d(1),l(2,"attributeTypeClean"),a()),t&2){let e=c.$implicit;u("value",e),o(),f(" ",p(2,2,e)," ")}}function rr(t,c){t&1&&(r(0,"mat-error"),d(1),l(2,"translate"),a()),t&2&&(o(),f(" ",p(2,1,"DIALOGS.CREATE_ATTRIBUTE_DEFINITION.ERROR_FIELD_EMPTY")," "))}function sr(t,c){if(t&1){let e=T();r(0,"div")(1,"h1",3),d(2),l(3,"translate"),a(),r(4,"div",4)(5,"form",5)(6,"mat-form-field")(7,"mat-label"),d(8),l(9,"translate"),a(),b(10,"input",6),E(11,Qa,3,3,"mat-error"),E(12,Xa,3,3,"mat-error"),a(),r(13,"mat-form-field")(14,"mat-label"),d(15),l(16,"translate"),a(),b(17,"input",7),E(18,Ja,3,3,"mat-error"),E(19,Za,3,3,"mat-error"),a(),r(20,"mat-form-field")(21,"mat-label"),d(22),l(23,"translate"),a(),r(24,"textarea",8),d(25,"          "),a(),E(26,er,3,3,"mat-error"),a(),r(27,"mat-form-field")(28,"mat-label"),d(29),l(30,"translate"),a(),r(31,"mat-select",9),Ut(32,tr,2,2,"mat-option",10,Ii),a(),E(34,ir,3,3,"mat-error"),a(),r(35,"mat-form-field")(36,"mat-label"),d(37),l(38,"translate"),a(),r(39,"mat-select",11),Ut(40,nr,2,2,"mat-option",10,Ii),a(),E(42,or,3,3,"mat-error"),a(),r(43,"mat-form-field")(44,"mat-label"),d(45),l(46,"translate"),a(),r(47,"mat-select",12),Ut(48,ar,3,4,"mat-option",10,Ii),a(),E(50,rr,3,3,"mat-error"),a()(),b(51,"perun-web-apps-attribute-unique-checkbox",13),l(52,"async"),r(53,"perun-web-apps-attribute-critical-operations-checkboxes",14),C("readOperationChanged",function(i){h(e);let s=_();return g(s.finalReadOperations=i)})("readGlobalChanged",function(i){h(e);let s=_();return g(s.finalReadGlobal=i)})("writeOperationChanged",function(i){h(e);let s=_();return g(s.finalWriteOperations=i)})("writeGlobalChanged",function(i){h(e);let s=_();return g(s.finalWriteGlobal=i)}),a(),b(54,"perun-web-apps-attribute-rights-tab-group",15),a(),r(55,"div",16)(56,"button",17),C("click",function(){h(e);let i=_();return g(i.cancel())}),d(57),l(58,"translate"),a(),r(59,"button",18),C("click",function(){h(e);let i=_();return g(i.submit())}),d(60),l(61,"translate"),a()()()}if(t&2){let e=_();o(2),A(p(3,22,"DIALOGS.CREATE_ATTRIBUTE_DEFINITION.TITLE")),o(3),u("formGroup",e.attributeControl),o(3),A(p(9,24,"DIALOGS.CREATE_ATTRIBUTE_DEFINITION.FRIENDLY_NAME")),o(3),I(e.attributeControl.hasError("spaceName","friendlyName")?11:-1),o(),I(e.attributeControl.hasError("required","friendlyName")?12:-1),o(3),A(p(16,26,"DIALOGS.CREATE_ATTRIBUTE_DEFINITION.DISPLAY_NAME")),o(3),I(e.attributeControl.hasError("spaceName","displayName")?18:-1),o(),I(e.attributeControl.hasError("required","displayName")?19:-1),o(3),A(p(23,28,"DIALOGS.CREATE_ATTRIBUTE_DEFINITION.DESCRIPTION")),o(4),I(e.attributeControl.hasError("required","description")?26:-1),o(3),A(p(30,30,"DIALOGS.CREATE_ATTRIBUTE_DEFINITION.ENTITY")),o(3),Vt(e.entities),o(2),I(e.attributeControl.hasError("required","entity")?34:-1),o(3),A(p(38,32,"DIALOGS.CREATE_ATTRIBUTE_DEFINITION.DEFINITION")),o(3),Vt(e.definitionTypes),o(2),I(e.attributeControl.hasError("required","definitionType")?42:-1),o(3),A(p(46,34,"DIALOGS.CREATE_ATTRIBUTE_DEFINITION.VALUE_TYPE")),o(3),Vt(e.valueTypes),o(2),I(e.attributeControl.hasError("required","valueType")?50:-1),o(),u("attDef",p(52,36,e.attDef)),o(2),u("attDef",e.attDef),o(),u("collections",e.collections),o(3),f(" ",p(58,38,"DIALOGS.CREATE_ATTRIBUTE_DEFINITION.CANCEL")," "),o(2),u("disabled",e.loading||e.attributeControl.invalid),o(),f(" ",p(61,40,"DIALOGS.CREATE_ATTRIBUTE_DEFINITION.CONFIRM")," ")}}var ta=(()=>{class t{constructor(e,n,i,s,v,w,q){this.dialogRef=e,this.formBuilder=n,this.attributeService=i,this.attributeRightsService=s,this.notificator=v,this.translate=w,this.uniqueAttPipe=q,this.loading=!1,this.attributeControl=this.formBuilder.group({friendlyName:["",[ge.required,_i()]],displayName:["",[ge.required,_i()]],description:["",ge.required],entity:["",ge.required],definitionType:["",ge.required],valueType:["",ge.required]}),this.entities=["facility","resource","group","group_resource","host","member","member_group","member_resource","user","ues","user_facility","vo","entityless"],this.definitionTypes=["def","opt","virt","core"],this.valueTypes=["java.lang.String","java.lang.Integer","java.lang.Boolean","java.util.ArrayList","java.util.LinkedHashMap"],this.attDef=new G({id:0,beanName:"",namespace:"",unique:!1}),this.collections=[],this.finalReadGlobal=!1,this.finalWriteGlobal=!1,this.attributeControl.valueChanges.pipe(gn(200)).subscribe(_e=>{this.setAttribute(_e)})}submit(){this.loading=!0,this.attributeService.createAttributeDefinition({attribute:this.attDef.getValue()}).pipe(se(e=>(this.attDefCreated=e,Ti(ft(e.id),ft(this.collections)))),this.attributeRightsService.addAttributeId(),this.attributeRightsService.filterNullInPolicy(),se(e=>this.attributeService.setAttributePolicyCollections({policyCollections:e})),se(()=>this.attributeRightsService.updateAttributeAction(this.finalReadOperations,!1,this.finalReadGlobal,!1,this.attDefCreated.id,Lt.READ)),se(()=>this.attributeRightsService.updateAttributeAction(this.finalWriteOperations,!0,this.finalWriteGlobal,!1,this.attDefCreated.id,Lt.WRITE))).subscribe({next:()=>{this.notificator.showSuccess(this.translate.instant("DIALOGS.CREATE_ATTRIBUTE_DEFINITION.SUCCESS")),this.dialogRef.close(!0)},error:()=>this.loading=!1})}cancel(){this.dialogRef.close(!1)}setAttribute(e){let n={id:0,beanName:"",friendlyName:e.friendlyName,displayName:e.displayName,description:e.description,type:e.valueType,namespace:this.createNamespace(e.entity,e.definitionType)};n.unique=this.attDef.getValue().unique&&!this.uniqueAttPipe.transform(n),this.attDef.next(n)}createNamespace(e,n){return"urn:perun:"+e+":attribute-def:"+n}static{this.\u0275fac=function(n){return new(n||t)(m(J),m(Li),m(ae),m(Jt),m(j),m(Y),m(zi))}}static{this.\u0275cmp=D({type:t,selectors:[["app-create-attribute-definition-dialog"]],features:[Et([zi])],decls:4,vars:2,consts:[["spinner",""],[1,"admin-theme","position-relative"],[4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],["mat-dialog-title",""],["mat-dialog-content",""],[1,"dialog-container",3,"formGroup"],["matInput","","formControlName","friendlyName","data-cy","attribute-friendly-name-input","required",""],["matInput","","formControlName","displayName","data-cy","attribute-display-name-input","required",""],["matInput","","formControlName","description","cdkTextareaAutosize","","data-cy","attribute-description-input","required",""],["formControlName","entity","data-cy","attribute-entity-input","required",""],[3,"value"],["formControlName","definitionType","data-cy","attribute-definition-type-input","required",""],["formControlName","valueType","data-cy","attribute-value-type-input","required",""],[3,"attDef"],[3,"readOperationChanged","readGlobalChanged","writeOperationChanged","writeGlobalChanged","attDef"],[3,"collections"],["mat-dialog-actions",""],["mat-stroked-button","",1,"ms-auto",3,"click"],["color","accent","data-cy","create-attr-definition-button","mat-flat-button","",1,"ms-2",3,"click","disabled"]],template:function(n,i){if(n&1&&(S(0,Ya,1,0,"ng-template",null,0,B),r(2,"div",1),S(3,sr,62,42,"div",2),a()),n&2){let s=R(1);o(3),u("perunWebAppsLoader",i.loading)("perunWebAppsLoaderIndicator",s)}},dependencies:[x,L,O,Ye,Ke,ct,Dt,Je,Xe,Ni,xn,Dn,An,$e,Mi,qe,ze,xi,pt,wi,Ri,ie,Z,te,ee,ue,M,Yi,Xi,Qi,N,He,y,on],encapsulation:2})}}return t})();function lr(t,c){t&1&&b(0,"perun-web-apps-loading-dialog")}function pr(t,c){if(t&1){let e=T();r(0,"div")(1,"h1",3),d(2),l(3,"translate"),a(),r(4,"div",4)(5,"perun-web-apps-alert",5),d(6),l(7,"translate"),a(),r(8,"mat-form-field",6)(9,"mat-label"),d(10),l(11,"translate"),a(),r(12,"input",7),bt("ngModelChange",function(i){h(e);let s=_();return Ct(s.value,i)||(s.value=i),g(i)}),a()()(),r(13,"div",8)(14,"button",9),C("click",function(){h(e);let i=_();return g(i.dialogRef.close())}),d(15),l(16,"translate"),a(),r(17,"button",10),C("click",function(){h(e);let i=_();return g(i.create())}),d(18),l(19,"translate"),a()()()}if(t&2){let e=_();o(2),f(" ",p(3,7,"DIALOGS.IMPORT_ATTRIBUTE.TITLE")," "),o(4),f(" ",p(7,9,"DIALOGS.IMPORT_ATTRIBUTE.INFO")," "),o(4),A(p(11,11,"DIALOGS.IMPORT_ATTRIBUTE.HINT")),o(2),gt("ngModel",e.value),o(3),f(" ",p(16,13,"DIALOGS.IMPORT_ATTRIBUTE.CANCEL")," "),o(2),u("disabled",e.value.trim().length===0||e.loading),o(),f(" ",p(19,15,"DIALOGS.IMPORT_ATTRIBUTE.CREATE")," ")}}var ia=(()=>{class t{constructor(e,n,i,s,v){this.dialogRef=e,this.notificator=n,this.translate=i,this.attributesManager=s,this.attributesRightsService=v,this.value="",this.loading=!1}create(){this.loading=!0,this.attributeData=JSON.parse(this.value),this.attributesManager.createAttributeDefinition({attribute:this.attributeData.attributeDefinition}).pipe(se(e=>Ti(ft(e.id),ft(this.attributeData.attributeRights))),this.attributesRightsService.addAttributeId(),se(e=>this.attributesManager.setAttributePolicyCollections({policyCollections:e}))).subscribe(()=>{this.notificator.showSuccess(this.translate.instant("DIALOGS.IMPORT_ATTRIBUTE_DEFINITION.SUCCESS")),this.dialogRef.close(!0)},()=>this.loading=!1)}static{this.\u0275fac=function(n){return new(n||t)(m(J),m(j),m(Y),m(ae),m(Jt))}}static{this.\u0275cmp=D({type:t,selectors:[["app-attribute-import-dialog"]],decls:4,vars:2,consts:[["spinner",""],[1,"admin-theme","position-relative"],[4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],["mat-dialog-title",""],["mat-dialog-content",""],["alert_type","info"],[1,"w-100"],["matInput","","required","",3,"ngModelChange","ngModel"],["mat-dialog-actions",""],["mat-stroked-button","",1,"ms-auto",3,"click"],["color","accent","mat-flat-button","",1,"ms-2",3,"click","disabled"]],template:function(n,i){if(n&1&&(S(0,lr,1,0,"ng-template",null,0,B),r(2,"div",1),S(3,pr,20,17,"div",2),a()),n&2){let s=R(1);o(3),u("perunWebAppsLoader",i.loading)("perunWebAppsLoaderIndicator",s)}},dependencies:[x,L,O,Ye,Ke,ct,Je,Xe,Ft,qe,ze,pt,Pt,$e,ie,Z,te,ee,X,Q,ue,M,N,y],encapsulation:2})}}return t})();var cr=t=>({all:t}),dr=t=>({name:t});function mr(t,c){t&1&&b(0,"perun-web-apps-loading-table")}function ur(t,c){if(t&1){let e=T();r(0,"th",23)(1,"mat-checkbox",24),l(2,"masterCheckboxLabel"),l(3,"translate"),C("change",function(i){h(e);let s=_(3);return g(i?s.masterToggle():null)}),a()()}if(t&2){let e=_(),n=_(2);o(),u("aria-label",p(3,5,p(2,3,e.all)))("checked",n.selection.hasValue()&&e.all)("indeterminate",n.selection.hasValue()&&!e.all)}}function _r(t,c){if(t&1){let e=T();r(0,"td",25)(1,"mat-checkbox",26),l(2,"checkboxLabel"),l(3,"translate"),C("change",function(i){let s=h(e).$implicit,v=_(3);return g(i?v.toggleRow(s):null)})("click",function(i){return h(e),g(i.stopPropagation())}),a()()}if(t&2){let e=c.$implicit,n=_(3);o(),u("aria-label",je(3,4,p(2,2,n.selection.isSelected(e)),De(7,dr,e.key)))("checked",n.selection.isSelected(e))}}function fr(t,c){t&1&&(k(0,13),S(1,ur,4,7,"th",21)(2,_r,4,9,"td",22),P())}function hr(t,c){t&1&&(r(0,"th",27),d(1),l(2,"translate"),a()),t&2&&(o(),f(" ",p(2,1,"SHARED.COMPONENTS.ENTITYLESS_ATTRIBUTES_LIST.KEY")," "))}function gr(t,c){if(t&1){let e=T();r(0,"td",28)(1,"mat-form-field")(2,"input",29),C("ngModelChange",function(){let i=h(e).$implicit,s=_(2);return g(s.onValueChange(i))}),bt("ngModelChange",function(i){let s=h(e).$implicit;return Ct(s.key,i)||(s.key=i),g(i)}),a()()()}if(t&2){let e=c.$implicit;o(2),gt("ngModel",e.key)}}function Cr(t,c){t&1&&(r(0,"th",30),d(1),l(2,"translate"),a()),t&2&&(o(),f(" ",p(2,1,"SHARED.COMPONENTS.ENTITYLESS_ATTRIBUTES_LIST.VALUE")," "))}function br(t,c){if(t&1){let e=T();r(0,"td",28)(1,"perun-web-apps-attribute-value",31),C("sendEventToParent2",function(){let i=h(e).$implicit,s=_(2);return g(s.onValueChange(i))}),a()()}if(t&2){let e=c.$implicit;o(),u("attribute",e.value)}}function Sr(t,c){t&1&&b(0,"tr",32)}function vr(t,c){t&1&&b(0,"tr",33)}function Tr(t,c){if(t&1){let e=T();r(0,"div")(1,"div",10)(2,"perun-web-apps-table-wrapper",11),C("pageChanged",function(){h(e);let i=_();return g(i.pageChanged())}),r(3,"table",12),C("matSortChange",function(){h(e);let i=_();return g(i.pageChanged())}),E(4,fr,3,0,"ng-container",13),l(5,"isAllSelected"),k(6,14),S(7,hr,3,3,"th",15)(8,gr,3,1,"td",16),P(),k(9,17),S(10,Cr,3,3,"th",18)(11,br,2,1,"td",16),P(),S(12,Sr,1,0,"tr",19)(13,vr,1,0,"tr",20),a()()()()}if(t&2){let e,n=_();o(),u("hidden",n.dataSource.filteredData===0||n.records.length===0),o(),u("pageSizeOptions",n.pageSizeOptions)("dataLength",n.dataSource.filteredData.length)("hideExport",!0)("tableId",n.tableId),o(),u("dataSource",n.dataSource),o(),I((e=De(12,cr,je(5,9,n.dataSource,n.selection.selected.length)))?4:-1,e),o(8),u("matHeaderRowDef",n.displayedColumns),o(),u("matRowDefColumns",n.displayedColumns)}}function Er(t,c){t&1&&(r(0,"perun-web-apps-alert",9),d(1),l(2,"translate"),a()),t&2&&(o(),f(" ",p(2,1,"SHARED.COMPONENTS.ENTITYLESS_ATTRIBUTES_LIST.NO_KEYS_WARNING")," "))}var oa=(()=>{class t{constructor(e,n,i,s,v,w,q){this.dialogRef=e,this.data=n,this.notificator=i,this.translate=s,this.attributesManager=v,this.cd=w,this.tableCheckbox=q,this.switchView=new Tt,this.records=[],this.displayedColumns=["select","key","value"],this.dataSource=new Ae,this.selection=new K(!0,[],!0,(_e,Se)=>_e.key===Se.key),this.cachedSelection=new K(this.selection.isMultipleSelection(),[],!0,this.selection.compareWith),this.isAddButtonDisabled=!1,this.pageSizeOptions=Mt}ngOnInit(){this.loading=!0,this.attDef=this.data.attDef,this.refreshTable()}refreshTable(){this.loading=!0,this.attributesManager.getEntitylessAttributesWithKeys(`${this.attDef.namespace}:${this.attDef.friendlyName}`).subscribe(e=>{this.records=[];let n=Object.keys(e);for(let i of n)this.records.push({key:i,value:e[i]});this.dataSource=new Ae(this.records),this.setDataSource(),this.loading=!1})}setDataSource(){this.dataSource&&(this.dataSource.sort=this.sort,this.child&&(this.dataSource.paginator=this.child.paginator))}onSave(){this.updateMapAttributes();let e=0,n=this.selection.selected.length;for(let i of this.selection.selected)this.loading=!0,this.attributesManager.setEntitylessAttribute({key:i.key,attribute:i.value}).subscribe({next:()=>{e+=1,e===n&&this.translate.get("SHARED.COMPONENTS.ENTITYLESS_ATTRIBUTES_LIST.SAVE_SUCCESS").subscribe(s=>{this.notificator.showSuccess(s),this.refreshTable()})},error:()=>{this.refreshTable()}});this.selection.clear(),this.cachedSelection.clear(),this.isAddButtonDisabled=!1,this.cd.detectChanges()}onRemove(){this.loading=!0;let e=0,n=this.selection.selected.length;for(let i of this.selection.selected)this.attributesManager.removeEntitylessAttribute(i.key,i.value.id).subscribe(()=>{e+=1,e===n&&this.translate.get("SHARED.COMPONENTS.ENTITYLESS_ATTRIBUTES_LIST.REMOVE_SUCCESS").subscribe(s=>{this.notificator.showSuccess(s),this.refreshTable()})});this.selection.clear(),this.cachedSelection.clear(),this.isAddButtonDisabled=!1,this.cd.detectChanges()}onAdd(){let e={key:"",value:this.attDef};e.value.value=void 0,this.records.unshift(e),this.dataSource.data=this.records,this.setDataSource(),this.selection.clear(),this.cachedSelection.clear(),this.selection.select(e),this.cachedSelection.select(e),this.isAddButtonDisabled=!0,this.cd.detectChanges()}onCancel(){this.dialogRef.close(!1)}isAllSelected(){return this.tableCheckbox.isAllSelected(this.selection.selected.length,this.dataSource)}masterToggle(){this.tableCheckbox.masterToggle(this.isAllSelected(),this.selection,this.cachedSelection,"",this.dataSource,this.sort,this.child.paginator.pageSize,this.child.paginator.pageIndex,!1)}onValueChange(e){this.selection.select(e),this.cachedSelection.select(e)}updateMapAttributes(){for(let e of this.items.toArray())e.attribute.type==="java.util.LinkedHashMap"&&e.updateMapAttribute()}ngAfterViewInit(){this.setDataSource()}toggleRow(e){this.selection.toggle(e),this.cachedSelection.toggle(e)}pageChanged(){this.dataSource.paginator&&this.tableCheckbox.selectCachedDataOnPage(this.dataSource,this.selection,this.cachedSelection,this.selection.compareWith)}static{this.\u0275fac=function(n){return new(n||t)(m(J),m(pe),m(j),m(Y),m(ae),m(Di),m(Xt))}}static{this.\u0275cmp=D({type:t,selectors:[["app-entityless-attribute-keys-list"]],viewQuery:function(n,i){if(n&1&&(ve(ot,5),ve(be,5),ve(dn,5)),n&2){let s;Te(s=Ee())&&(i.child=s.first),Te(s=Ee())&&(i.sort=s.first),Te(s=Ee())&&(i.items=s)}},inputs:{attDef:"attDef",tableId:"tableId"},outputs:{switchView:"switchView"},decls:20,vars:19,consts:[["spinner",""],["mat-dialog-title",""],["mat-dialog-actions","",1,"mt-3"],["mat-stroked-button","",3,"click"],["color","accent","mat-flat-button","",1,"ms-2",3,"click"],["color","accent","matTooltip","save or remove new attribute first","mat-flat-button","","matTooltipPosition","above",1,"ms-2",3,"click","disabled","matTooltipDisabled"],["color","warn","mat-flat-button","",1,"ms-2",3,"click","disabled"],["mat-dialog-content","",1,"mt-3"],[4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],["alert_type","warn",1,"mt-3"],[1,"card","mt-3",3,"hidden"],[3,"pageChanged","pageSizeOptions","dataLength","hideExport","tableId"],["mat-table","","matSort","","matSortActive","key","matSortDirection","asc","matSortDisableClear","",1,"w-100",3,"matSortChange","dataSource"],["matColumnDef","select"],["matColumnDef","key"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","value"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["class","dark-hover-list-item","mat-row","",4,"matRowDef","matRowDefColumns"],["class","align-checkbox","mat-header-cell","",4,"matHeaderCellDef"],["class","static-column-size align-checkbox","mat-cell","",4,"matCellDef"],["mat-header-cell","",1,"align-checkbox"],["color","primary",3,"change","aria-label","checked","indeterminate"],["mat-cell","",1,"static-column-size","align-checkbox"],["color","primary",3,"change","click","aria-label","checked"],["mat-header-cell","","mat-sort-header",""],["mat-cell",""],["matInput","","placeholder","New key",3,"ngModelChange","ngModel"],["mat-header-cell",""],[3,"sendEventToParent2","attribute"],["mat-header-row",""],["mat-row","",1,"dark-hover-list-item"]],template:function(n,i){if(n&1){let s=T();r(0,"h1",1),d(1),a(),r(2,"div",2)(3,"button",3),C("click",function(){return h(s),g(i.switchView.emit())}),d(4),l(5,"translate"),a(),r(6,"button",4),C("click",function(){return h(s),g(i.onSave())}),d(7),l(8,"translate"),a(),r(9,"button",5),C("click",function(){return h(s),g(i.onAdd())}),d(10),l(11,"translate"),a(),r(12,"button",6),C("click",function(){return h(s),g(i.onRemove())}),d(13),l(14,"translate"),a()(),r(15,"div",7),S(16,mr,1,0,"ng-template",null,0,B)(18,Tr,14,14,"div",8),E(19,Er,3,3,"perun-web-apps-alert",9),a()}if(n&2){let s=R(17);o(),A(i.attDef.namespace+":"+i.attDef.friendlyName),o(3),f(" ",p(5,11,"SHARED.COMPONENTS.ENTITYLESS_ATTRIBUTES_LIST.CANCEL")," "),o(3),f(" ",p(8,13,"SHARED.COMPONENTS.ENTITYLESS_ATTRIBUTES_LIST.SAVE")," "),o(2),u("disabled",i.isAddButtonDisabled)("matTooltipDisabled",!i.isAddButtonDisabled),o(),f(" ",p(11,15,"SHARED.COMPONENTS.ENTITYLESS_ATTRIBUTES_LIST.ADD")," "),o(2),u("disabled",i.loading||i.selection.selected.length===0),o(),f(" ",p(14,17,"SHARED.COMPONENTS.ENTITYLESS_ATTRIBUTES_LIST.REMOVE")," "),o(5),u("perunWebAppsLoader",i.loading)("perunWebAppsLoaderIndicator",s),o(),I(!i.loading&&i.records.length===0?19:-1)}},dependencies:[x,L,O,Ye,Ke,Je,Xe,jt,Gt,Ft,qe,ze,Pt,$e,ie,Z,te,ee,X,Q,ot,Ce,xe,ye,Be,we,Me,Oe,Re,Le,Ne,Ue,At,be,It,M,We,N,dn,H,Zt,y,ti,ei],styles:[".mat-mdc-cell[_ngcontent-%COMP%]{padding:8px 8px 8px 0}"]})}}return t})();var Ar=()=>["id","name","enabled","script"];function Dr(t,c){t&1&&b(0,"perun-web-apps-loading-dialog")}function xr(t,c){t&1&&(r(0,"mat-error"),d(1),l(2,"translate"),a()),t&2&&(o(),f(" ",p(2,1,"DIALOGS.NAME_SPACE_ERROR")," "))}function Mr(t,c){t&1&&(r(0,"mat-error"),d(1),l(2,"translate"),a()),t&2&&(o(),f(" ",p(2,1,"DIALOGS.EDIT_ATTRIBUTE_DEFINITION.ERROR_FIELD_EMPTY")," "))}function yr(t,c){t&1&&(r(0,"mat-error"),d(1),l(2,"translate"),a()),t&2&&(o(),f(" ",p(2,1,"DIALOGS.EDIT_ATTRIBUTE_DEFINITION.ERROR_FIELD_EMPTY")," "))}function wr(t,c){if(t&1){let e=T();r(0,"button",21),C("click",function(){h(e);let i=_(3);return g(i.switchShowKeys())}),d(1),l(2,"translate"),a()}t&2&&(o(),f(" ",p(2,1,"DIALOGS.EDIT_ATTRIBUTE_DEFINITION.SHOW_KEYS")," "))}function Rr(t,c){if(t&1){let e=T();r(0,"div")(1,"h1",3),d(2),l(3,"translate"),a(),r(4,"div",4)(5,"form",5)(6,"mat-form-field")(7,"mat-label"),d(8),l(9,"translate"),a(),b(10,"input",6),E(11,xr,3,3,"mat-error"),E(12,Mr,3,3,"mat-error"),a(),r(13,"mat-form-field")(14,"mat-label"),d(15),l(16,"translate"),a(),b(17,"textarea",7),E(18,yr,3,3,"mat-error"),a()(),r(19,"label",8),d(20),l(21,"translate"),a(),r(22,"div",9),d(23),r(24,"mat-icon",10),l(25,"translate"),C("click",function(){h(e);let i=_(2);return g(i.copyUrn())}),d(26,"content_copy"),a()(),b(27,"perun-web-apps-attribute-unique-checkbox",11),r(28,"perun-web-apps-attribute-critical-operations-checkboxes",12),C("readOperationChanged",function(i){h(e);let s=_(2);return g(s.finalReadOperations=i)})("readGlobalChanged",function(i){h(e);let s=_(2);return g(s.finalReadGlobal=i)})("writeOperationChanged",function(i){h(e);let s=_(2);return g(s.finalWriteOperations=i)})("writeGlobalChanged",function(i){h(e);let s=_(2);return g(s.finalWriteGlobal=i)}),a(),b(29,"perun-web-apps-attribute-rights-tab-group",13),l(30,"async"),r(31,"mat-accordion")(32,"mat-expansion-panel",14)(33,"mat-expansion-panel-header")(34,"mat-panel-title"),d(35),l(36,"translate"),a()(),b(37,"app-services-list",15),l(38,"async"),a()()(),r(39,"div",16),E(40,wr,3,3,"button",17),r(41,"button",18),C("click",function(){h(e);let i=_(2);return g(i.onCancel())}),d(42),l(43,"translate"),a(),r(44,"button",19),C("click",function(){h(e);let i=_(2);return g(i.onCopy())}),d(45),l(46,"translate"),a(),r(47,"button",20),C("click",function(){h(e);let i=_(2);return g(i.onSubmit())}),d(48),l(49,"translate"),a()()()}if(t&2){let e=_(2);o(2),A(p(3,29,"DIALOGS.EDIT_ATTRIBUTE_DEFINITION.TITLE")),o(3),u("formGroup",e.attributeControl),o(3),A(p(9,31,"DIALOGS.EDIT_ATTRIBUTE_DEFINITION.DISPLAY_NAME")),o(3),I(e.attributeControl.hasError("spaceName","name")?11:-1),o(),I(e.attributeControl.hasError("required","name")?12:-1),o(3),A(p(16,33,"DIALOGS.EDIT_ATTRIBUTE_DEFINITION.DESCRIPTION")),o(3),I(e.attributeControl.hasError("required","description")?18:-1),o(2),f(" ",p(21,35,"DIALOGS.EDIT_ATTRIBUTE_DEFINITION.URN")," "),o(3),f(" ",e.urn," "),o(),u("matTooltip",fe(p(25,37,"DIALOGS.EDIT_ATTRIBUTE_DEFINITION.URN_TOOLTIP"))),o(3),u("attDef",e.attDef),o(),u("attDef",e.attDef)("readOperation",e.initReadOperations)("readGlobal",e.initReadGlobal)("writeOperation",e.initWriteOperations)("writeGlobal",e.initWriteGlobal),o(),u("attDef",e.attDef)("collections",p(30,39,e.collections$)),o(6),f(" ",p(36,41,"DIALOGS.EDIT_ATTRIBUTE_DEFINITION.SERVICES")," "),o(2),u("loading",e.loading)("disableRouting",!0)("displayColumns",he(51,Ar))("services",p(38,43,e.services$)),o(3),I((e.attDef==null?null:e.attDef.entity)==="entityless"?40:-1),o(2),f(" ",p(43,45,"DIALOGS.EDIT_ATTRIBUTE_DEFINITION.CANCEL")," "),o(3),f(" ",p(46,47,"DIALOGS.EDIT_ATTRIBUTE_DEFINITION.COPY_FOR_IMPORT")," "),o(2),u("disabled",e.loading||e.attributeControl.invalid),o(),f(" ",p(49,49,"DIALOGS.EDIT_ATTRIBUTE_DEFINITION.CONFIRM")," ")}}function Lr(t,c){if(t&1){let e=T();r(0,"div")(1,"app-entityless-attribute-keys-list",22),C("switchView",function(){h(e);let i=_(2);return g(i.switchShowKeys())}),a()()}if(t&2){let e=_(2);o(),u("attDef",e.attDef)("tableId",e.tableId)}}function Br(t,c){if(t&1&&(r(0,"div"),E(1,Rr,50,52,"div"),E(2,Lr,2,2,"div"),a()),t&2){let e=_();o(),I(e.showKeys?-1:1),o(),I(e.showKeys?2:-1)}}var aa=(()=>{class t{constructor(e,n,i,s,v,w,q,_e,Se){this.dialogRef=e,this.data=n,this.notificator=i,this.translate=s,this.clipboard=v,this.attributesManager=w,this.serviceService=q,this.formBuilder=_e,this.attributeRightsService=Se,this.tableId=Zn,this.loading=!1,this.showKeys=!1,this.attDef=this.data.attDef,this.attributeControl=this.formBuilder.group({name:[this.attDef.displayName,[ge.required,_i()]],description:[this.attDef.description,ge.required]}),this.urn=`${this.attDef.namespace}:${this.attDef.friendlyName}`,this.collections$=new G([]),this.emptyCollections=[{id:-1,attributeId:this.data.attDef.id,action:Lt.READ,policies:[]}],this.services$=this.serviceService.getServicesByAttributeDefinition(this.attDef.id).pipe(at([]))}ngOnInit(){this.loading=!0,this.dialogRef.addPanelClass("mat-dialog-height-transition"),this.initUnique=this.attDef.unique,this.attributesManager.getAttributeRules(this.attDef.id).subscribe(e=>{this.collections$=new G(e.attributePolicyCollections),this.initReadOperations="READ"in e.criticalActions,this.initWriteOperations="WRITE"in e.criticalActions,this.initReadGlobal=e.criticalActions.READ||!1,this.initWriteGlobal=e.criticalActions.WRITE||!1,this.loading=!1})}onSubmit(){this.loading=!0,this.updateAttribute();let e=vi({},this.attDef);e.unique=this.initUnique,this.attributesManager.updateAttributeDefinition({attributeDefinition:e}).pipe(se(()=>ft(this.collections$.getValue())),this.attributeRightsService.filterNullInPolicy(),se(n=>this.attributesManager.setAttributePolicyCollections(n.length>0?{policyCollections:n}:{policyCollections:this.emptyCollections})),se(()=>this.attributeRightsService.updateAttributeAction(this.finalReadOperations,this.initReadOperations,this.finalReadGlobal,this.initReadGlobal,this.attDef.id,Lt.READ)),se(()=>this.attributeRightsService.updateAttributeAction(this.finalWriteOperations,this.initWriteOperations,this.finalWriteGlobal,this.initWriteGlobal,this.attDef.id,Lt.WRITE)),se(()=>this.initUnique===this.attDef.unique?ft(null):this.attDef.unique?this.attributesManager.convertAttributeToUnique(this.attDef.id):this.attributesManager.convertAttributeToNonunique(this.attDef.id))).subscribe({next:()=>{this.notificator.showSuccess(this.translate.instant("DIALOGS.EDIT_ATTRIBUTE_DEFINITION.SUCCESS")),this.dialogRef.close(!0)},error:n=>{this.attDef.unique=this.initUnique,this.loading=!1,console.error(n)}})}onCancel(){this.dialogRef.close(!1)}switchShowKeys(){this.showKeys=!this.showKeys,this.showKeys?this.dialogRef.updateSize("800px"):this.dialogRef.updateSize("700px")}copyUrn(){this.clipboard.copy(this.urn)?this.notificator.showSuccess(this.translate.instant("DIALOGS.EDIT_ATTRIBUTE_DEFINITION.COPIED")):this.notificator.showError(this.translate.instant("DIALOGS.EDIT_ATTRIBUTE_DEFINITION.COPY_FAILED"))}onCopy(){this.updateAttribute();let e={attributeDefinition:this.attDef,attributeRights:this.collections$.getValue()};this.clipboard.copy(JSON.stringify(e))?this.notificator.showSuccess(this.translate.instant("DIALOGS.EDIT_ATTRIBUTE_DEFINITION.COPIED")):this.notificator.showError(this.translate.instant("DIALOGS.EDIT_ATTRIBUTE_DEFINITION.COPY_FAILED"))}updateAttribute(){this.attDef.displayName=this.attributeControl.value.name,this.attDef.description=this.attributeControl.value.description}static{this.\u0275fac=function(n){return new(n||t)(m(J),m(pe),m(j),m(Y),m($i),m(ae),m(_t),m(Li),m(Jt))}}static{this.\u0275cmp=D({type:t,selectors:[["app-edit-attribute-definition-dialog"]],decls:4,vars:2,consts:[["spinner",""],[1,"admin-theme","position-relative"],[4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],["mat-dialog-title",""],["mat-dialog-content",""],[1,"fields-container",3,"formGroup"],["matInput","","data-cy","display-name-input","formControlName","name","required",""],["matInput","","formControlName","description","cdkTextareaAutosize","","required",""],[1,"urn-name"],[1,"urn-row"],["matSuffix","",1,"copy-urn",3,"click","matTooltip"],[3,"attDef"],[3,"readOperationChanged","readGlobalChanged","writeOperationChanged","writeGlobalChanged","attDef","readOperation","readGlobal","writeOperation","writeGlobal"],[3,"attDef","collections"],[1,"mt-4","mb-4"],[3,"loading","disableRouting","displayColumns","services"],["mat-dialog-actions",""],["mat-stroked-button",""],["mat-stroked-button","",1,"ms-auto",3,"click"],["mat-stroked-button","",1,"ms-2",3,"click"],["color","accent","mat-flat-button","",1,"ms-2",3,"click","disabled"],["mat-stroked-button","",3,"click"],[3,"switchView","attDef","tableId"]],template:function(n,i){if(n&1&&(S(0,Dr,1,0,"ng-template",null,0,B),r(2,"div",1),S(3,Br,3,2,"div",2),a()),n&2){let s=R(1);o(3),u("perunWebAppsLoader",i.loading)("perunWebAppsLoaderIndicator",s)}},dependencies:[x,L,O,Qe,ut,Ye,Ke,ct,Dt,In,Je,Xe,Ni,$e,Mi,qe,ze,xi,pt,wi,Ri,ie,Z,te,ee,ue,jn,Gn,kn,Pn,Fn,M,We,No,Qi,Yi,Xi,oa,N,He,y],styles:[".fields-container[_ngcontent-%COMP%]{display:flex;flex-direction:column}.urn-name[_ngcontent-%COMP%]{color:#0000008a;margin-bottom:0;font-size:small}.urn-row[_ngcontent-%COMP%]{display:flex;justify-content:space-between}.copy-urn[_ngcontent-%COMP%]{cursor:pointer}"],data:{animation:[Eo,Io,Ao]}})}}return t})();var bi=(()=>{class t{constructor(e){this.storeService=e,this.USER_CONSENT_RELATED_ATT_NAMESPACE=["urn:perun:user_facility:attribute-def","urn:perun:user:attribute-def","urn:perun:member:attribute-def","urn:perun:member_group:attribute-def","urn:perun:member_resource:attribute-def","urn:perun:ues:attribute-def"]}transform(e,n,i){return!this.storeService.getProperty("enforce_consents")||!i||!n?!1:this.USER_CONSENT_RELATED_ATT_NAMESPACE.reduce((v,w)=>v||e.startsWith(w),!1)}static{this.\u0275fac=function(n){return new(n||t)(m(Ve,16))}}static{this.\u0275pipe=vt({name:"consentRelatedAttribute",type:t,pure:!0})}}return t})();var ra=(()=>{class t{transform(e){if(e===null)return null;let n=e;return n.substring(n.lastIndexOf(":")+1,n.length)}static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275pipe=vt({name:"nameSpaceToDef",type:t,pure:!0})}}return t})();var Nr=t=>({all:t}),Ur=t=>({name:t});function Vr(t,c){if(t&1){let e=T();r(0,"mat-checkbox",22),l(1,"masterCheckboxLabel"),l(2,"translate"),C("change",function(i){h(e);let s=_(3);return g(i?s.masterToggle():null)}),a()}if(t&2){let e=_(2),n=_();u("aria-label",p(2,6,p(1,4,e.all)))("checked",n.selection.hasValue()&&e.all)("indeterminate",n.selection.hasValue()&&!e.all)("disabled",!n.isMasterCheckboxEnabled)}}function kr(t,c){if(t&1&&(r(0,"th",19)(1,"span",20),l(2,"translate"),E(3,Vr,3,8,"mat-checkbox",21),a()()),t&2){let e=_(2);o(),u("matTooltipDisabled",e.isMasterCheckboxEnabled)("matTooltip",p(2,3,"ADMIN.ATTRIBUTES.MASTER_CHECKBOX_TOOLTIP")),o(2),I(e.selection.isMultipleSelection()?3:-1)}}function Pr(t,c){if(t&1){let e=T();r(0,"td",23)(1,"mat-checkbox",24),l(2,"multiWordDataCy"),l(3,"checkboxLabel"),l(4,"translate"),l(5,"consentRelatedAttribute"),l(6,"translate"),l(7,"consentRelatedAttribute"),C("change",function(i){let s=h(e).$implicit,v=_(2);return g(i?v.toggleRow(s):null)})("click",function(i){return h(e),g(i.stopPropagation())}),a()()}if(t&2){let e=c.$implicit,n=_(2);o(),mi("data-cy",Ie("",p(2,7,e.displayName),"-checkbox")),u("aria-label",je(4,11,p(3,9,n.selection.isSelected(e)),De(24,Ur,e.displayName)))("checked",n.selection.isSelected(e))("disabled",Ai(5,14,e.namespace,n.serviceEnabled,n.consentRequired))("matTooltip",p(6,18,"ADMIN.ATTRIBUTES.CONSENT_RELATED_DISABLED"))("matTooltipDisabled",!Ai(7,20,e.namespace,n.serviceEnabled,n.consentRequired))}}function Fr(t,c){t&1&&(k(0,3),S(1,kr,4,5,"th",17)(2,Pr,8,26,"td",18),P())}function Gr(t,c){t&1&&(r(0,"th",25),d(1),l(2,"translate"),a()),t&2&&(o(),f(" ",p(2,1,"ADMIN.ATTRIBUTES.TABLE_ATTR_ID")," "))}function jr(t,c){if(t&1&&(r(0,"td",26),d(1),a()),t&2){let e=c.$implicit;o(),A(e.id)}}function Hr(t,c){t&1&&(r(0,"th",25),d(1),l(2,"translate"),a()),t&2&&(o(),f(" ",p(2,1,"ADMIN.ATTRIBUTES.TABLE_ATTR_FRIENDLY_NAME")," "))}function Wr(t,c){if(t&1&&(r(0,"td",27),l(1,"multiWordDataCy"),d(2),a()),t&2){let e=c.$implicit;mi("data-cy",Ie("",p(1,3,e.friendlyName),"-friendly-name")),o(2),f(" ",e.friendlyName," ")}}function qr(t,c){t&1&&(r(0,"th",25),d(1),l(2,"translate"),a()),t&2&&(o(),f(" ",p(2,1,"ADMIN.ATTRIBUTES.TABLE_ATTR_DISPLAY_NAME")," "))}function zr(t,c){if(t&1&&(r(0,"td",27),d(1),a()),t&2){let e=c.$implicit;o(),f(" ",e.displayName," ")}}function $r(t,c){t&1&&(r(0,"th",25),d(1),l(2,"translate"),a()),t&2&&(o(),f(" ",p(2,1,"ADMIN.ATTRIBUTES.TABLE_ATTR_ENTITY")," "))}function Kr(t,c){if(t&1&&(r(0,"td",27),d(1),a()),t&2){let e=c.$implicit;o(),A(e.entity)}}function Yr(t,c){t&1&&(r(0,"th",25),d(1),l(2,"translate"),a()),t&2&&(o(),f(" ",p(2,1,"ADMIN.ATTRIBUTES.TABLE_ATTR_DEF")," "))}function Qr(t,c){if(t&1&&(r(0,"td",27),d(1),l(2,"nameSpaceToDef"),a()),t&2){let e=c.$implicit;o(),A(p(2,1,e.namespace))}}function Xr(t,c){t&1&&(r(0,"th",25),d(1),l(2,"translate"),a()),t&2&&(o(),f(" ",p(2,1,"ADMIN.ATTRIBUTES.TABLE_ATTR_TYPE")," "))}function Jr(t,c){if(t&1&&(r(0,"td",27),d(1),l(2,"attributeTypeClean"),a()),t&2){let e=c.$implicit;o(),A(p(2,1,e.type))}}function Zr(t,c){t&1&&(r(0,"th",25),d(1),l(2,"translate"),a()),t&2&&(o(),f(" ",p(2,1,"ADMIN.ATTRIBUTES.TABLE_ATTR_UNIQUE")," "))}function es(t,c){if(t&1&&(r(0,"td",27),d(1),a()),t&2){let e=c.$implicit;o(),A(e.unique)}}function ts(t,c){t&1&&b(0,"tr",28)}function is(t,c){if(t&1){let e=T();r(0,"tr",29),C("click",function(){let i=h(e).$implicit,s=_();return g(s.onRowClick(i))}),a()}if(t&2){let e=_();Ge("cursor-pointer",!e.disableRouting)}}function ns(t,c){t&1&&(r(0,"perun-web-apps-alert",16),d(1),l(2,"translate"),a()),t&2&&(o(),f(" ",p(2,1,"ADMIN.ATTRIBUTES.NO_ATTRIBUTES")," "))}function os(t,c){t&1&&(r(0,"perun-web-apps-alert",16),d(1),l(2,"translate"),a()),t&2&&(o(),f(" ",p(2,1,"SHARED_LIB.UI.ALERTS.NO_FILTER_RESULTS_ALERT")," "))}var ci=(()=>{class t{constructor(e,n,i,s,v,w){this.dialog=e,this.authResolver=n,this.tableCheckbox=i,this.consentRelatedPipe=s,this.destroyRef=v,this.tableConfigService=w,this.selection=new K(!0,[]),this.disableRouting=!1,this.consentRequired=!1,this.serviceEnabled=!1,this.refreshEvent=new Tt,this.pageSizeOptions=Mt,this.isMasterCheckboxEnabled=!0,this.displayedColumns=["select","id","friendlyName","displayName","entity","namespace","type","unique"],this.unfilteredColumns=this.displayedColumns,this.canBeSelected=q=>!this.consentRelatedPipe.transform(q.namespace,this.serviceEnabled,this.consentRequired)}set displayColumns(e){this.unfilteredColumns=e,localStorage.getItem("showIds")!=="true"&&(e=e.filter(n=>n!=="id")),this.displayedColumns=e}set matSort(e){this.sort=e,this.setDataSource()}static getDataForColumn(e,n){switch(n){case"id":return e.id.toString();case"friendlyName":return e.friendlyName;case"displayName":return e.displayName;case"entity":return e.entity;case"namespace":if(e.namespace){let i=e.namespace;return i.substring(i.lastIndexOf(":")+1,i.length)}return"";case"type":if(e.type){let i=e.type;return i.substring(i.lastIndexOf(".")+1,i.length)}return"";case"unique":return e.unique?"true":"false";default:return""}}ngOnInit(){this.selection&&(this.cachedSelection=new K(this.selection.isMultipleSelection(),[],!0,this.selection.compareWith),this.cachedSubject?.pipe(yt(this.destroyRef)).subscribe(e=>{e&&this.cachedSelection.clear()})),this.watchForIdColumnChanges()}ngOnChanges(){this.dataSource=new Ae(this.definitions),this.setDataSource(),this.isMasterCheckboxEnabled=this.tableCheckbox.anySelectableRows(this.dataSource,this.canBeSelected)}ngAfterViewInit(){this.dataSource.paginator=this.child.paginator}exportAllData(e){st(Fe(this.dataSource.filteredData,this.displayedColumns,t.getDataForColumn),e)}exportDisplayedData(e){let n=this.dataSource.paginator.pageIndex*this.dataSource.paginator.pageSize,i=n+this.dataSource.paginator.pageSize;st(Fe(this.dataSource.sortData(this.dataSource.filteredData,this.dataSource.sort).slice(n,i),this.displayedColumns,t.getDataForColumn),e)}setDataSource(){this.dataSource&&(this.dataSource.filter=this.filterValue,this.dataSource.sort=this.sort,this.dataSource.filterPredicate=(e,n)=>Qt(e,n,this.displayedColumns,t.getDataForColumn),this.dataSource.sortData=(e,n)=>Yt(e,n,t.getDataForColumn),this.dataSource.paginator=this.child.paginator)}isAllSelected(){return this.tableCheckbox.isAllSelected(this.selection.selected.length,this.dataSource,this.canBeSelected)}masterToggle(){this.tableCheckbox.masterToggle(this.isAllSelected(),this.selection,this.cachedSelection,this.filterValue,this.dataSource,this.sort,this.child.paginator.pageSize,this.child.paginator.pageIndex,!0,this.canBeSelected)}onRowClick(e){if(!this.disableRouting){let n=V();n.width="700px",n.data={attDef:vi({},e)},this.dialog.open(aa,n).afterClosed().subscribe(s=>{s&&(this.selection.clear(),this.refreshEvent.emit())})}}toggleRow(e){this.selection.toggle(e),this.cachedSelection.toggle(e)}pageChanged(){this.cachedSelection&&(this.isMasterCheckboxEnabled=this.tableCheckbox.anySelectableRows(this.dataSource,this.canBeSelected),this.tableCheckbox.selectCachedDataOnPage(this.dataSource,this.selection,this.cachedSelection,this.selection.compareWith))}watchForIdColumnChanges(){this.tableConfigService.showIdsChanged.pipe(yt(this.destroyRef)).subscribe(e=>{e?this.displayedColumns=this.unfilteredColumns:this.displayedColumns=this.unfilteredColumns.filter(n=>n!=="id")}),localStorage.getItem("showIds")!=="true"&&(this.displayedColumns=this.displayedColumns.filter(e=>e!=="id"))}static{this.\u0275fac=function(n){return new(n||t)(m($),m(re),m(Xt),m(bi),m(Nt),m(ii))}}static{this.\u0275cmp=D({type:t,selectors:[["app-attr-def-list"]],viewQuery:function(n,i){if(n&1&&(ve(ot,7),ve(be,7)),n&2){let s;Te(s=Ee())&&(i.child=s.first),Te(s=Ee())&&(i.matSort=s.first)}},inputs:{definitions:"definitions",selection:"selection",cachedSubject:"cachedSubject",filterValue:"filterValue",tableId:"tableId",disableRouting:"disableRouting",consentRequired:"consentRequired",serviceEnabled:"serviceEnabled",loading:"loading",displayColumns:"displayColumns"},outputs:{refreshEvent:"refreshEvent"},features:[Et([bi]),Ei],decls:30,vars:16,consts:[[1,"card","mt-2",3,"hidden"],[3,"exportDisplayedData","exportAllData","pageChanged","pageSizeOptions","dataLength","tableId"],["mat-table","","matSort","","matSortActive","displayName","matSortDirection","asc","matSortDisableClear","",1,"w-100",3,"matSortChange","dataSource"],["matColumnDef","select"],["matColumnDef","id"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["class","static-column-size","mat-cell","",4,"matCellDef"],["matColumnDef","friendlyName"],["mat-cell","",4,"matCellDef"],["matColumnDef","displayName"],["matColumnDef","entity"],["matColumnDef","namespace"],["matColumnDef","type"],["matColumnDef","unique"],["mat-header-row","",4,"matHeaderRowDef"],["class","dark-hover-list-item","mat-row","",3,"cursor-pointer","click",4,"matRowDef","matRowDefColumns"],["alert_type","warn"],["class","align-checkbox","mat-header-cell","",4,"matHeaderCellDef"],["class","static-column-size align-checkbox","mat-cell","",4,"matCellDef"],["mat-header-cell","",1,"align-checkbox"],[3,"matTooltipDisabled","matTooltip"],["color","primary",3,"aria-label","checked","indeterminate","disabled"],["color","primary",3,"change","aria-label","checked","indeterminate","disabled"],["mat-cell","",1,"static-column-size","align-checkbox"],["matTooltipPosition","left","color","primary",3,"change","click","aria-label","checked","disabled","matTooltip","matTooltipDisabled"],["mat-header-cell","","mat-sort-header",""],["mat-cell","",1,"static-column-size"],["mat-cell",""],["mat-header-row",""],["mat-row","",1,"dark-hover-list-item",3,"click"]],template:function(n,i){if(n&1&&(r(0,"div",0)(1,"perun-web-apps-table-wrapper",1),C("exportDisplayedData",function(v){return i.exportDisplayedData(v)})("exportAllData",function(v){return i.exportAllData(v)})("pageChanged",function(){return i.pageChanged()}),r(2,"table",2),C("matSortChange",function(){return i.pageChanged()}),E(3,Fr,3,0,"ng-container",3),l(4,"isAllSelected"),k(5,4),S(6,Gr,3,3,"th",5)(7,jr,2,1,"td",6),P(),k(8,7),S(9,Hr,3,3,"th",5)(10,Wr,3,5,"td",8),P(),k(11,9),S(12,qr,3,3,"th",5)(13,zr,2,1,"td",8),P(),k(14,10),S(15,$r,3,3,"th",5)(16,Kr,2,1,"td",8),P(),k(17,11),S(18,Yr,3,3,"th",5)(19,Qr,3,3,"td",8),P(),k(20,12),S(21,Xr,3,3,"th",5)(22,Jr,3,3,"td",8),P(),k(23,13),S(24,Zr,3,3,"th",5)(25,es,2,1,"td",8),P(),S(26,ts,1,0,"tr",14)(27,is,1,2,"tr",15),a()()(),E(28,ns,3,3,"perun-web-apps-alert",16),E(29,os,3,3,"perun-web-apps-alert",16)),n&2){let s;u("hidden",i.dataSource.filteredData.length===0||i.definitions.length===0),o(),u("pageSizeOptions",i.pageSizeOptions)("dataLength",i.dataSource.filteredData.length)("tableId",i.tableId),o(),u("dataSource",i.dataSource),o(),I((s=De(14,Nr,Ai(4,10,i.dataSource,i.selection.selected.length,i.canBeSelected)))?3:-1,s),o(23),u("matHeaderRowDef",i.displayedColumns),o(),u("matRowDefColumns",i.displayedColumns),o(),I(!i.loading&&i.definitions.length===0?28:-1),o(),I(i.dataSource.filteredData.length===0&&i.definitions.length!==0?29:-1)}},dependencies:[x,jt,Gt,X,Q,ot,Ce,xe,ye,Be,we,Me,Oe,Re,Le,Ne,Ue,At,be,It,M,We,Zt,y,ei,bi,qi,ra,ti,on],styles:[".cursor-pointer[_ngcontent-%COMP%]{cursor:pointer}"]})}}return t})();function as(t,c){if(t&1){let e=T();r(0,"button",9),C("click",function(){h(e);let i=_();return g(i.onCreate())}),d(1),l(2,"translate"),a()}t&2&&(o(),f(" ",p(2,1,"ADMIN.ATTRIBUTES.CREATE")," "))}function rs(t,c){if(t&1){let e=T();r(0,"button",10),C("click",function(){h(e);let i=_();return g(i.onImport())}),d(1),l(2,"translate"),a()}t&2&&(o(),f(" ",p(2,1,"ADMIN.ATTRIBUTES.IMPORT")," "))}function ss(t,c){if(t&1){let e=T();r(0,"button",11),C("click",function(){h(e);let i=_();return g(i.onDelete())}),d(1),l(2,"translate"),a()}if(t&2){let e=_();u("disabled",e.loading||e.selected.selected.length===0),o(),f(" ",p(2,2,"ADMIN.ATTRIBUTES.DELETE")," ")}}function ls(t,c){t&1&&b(0,"perun-web-apps-loading-table")}function ps(t,c){if(t&1){let e=T();r(0,"app-attr-def-list",12),C("refreshEvent",function(){h(e);let i=_();return g(i.refreshTable())}),a()}if(t&2){let e=_();u("loading",e.loading)("definitions",e.attrDefinitions)("disableRouting",!e.authResolver.isPerunAdminOrObserver())("filterValue",e.filterValue)("selection",e.selected)("cachedSubject",e.cachedSubject)("tableId",e.tableId)}}var la=(()=>{class t{constructor(e,n,i){this.dialog=e,this.attributesManager=n,this.authResolver=i,this.attrDefinitions=[],this.selected=new K(!0,[],!0,(s,v)=>s.id===v.id),this.cachedSubject=new G(!0),this.filterValue="",this.tableId=Jn}ngOnInit(){this.refreshTable()}onCreate(){let e=V();e.width="650px",this.dialog.open(ta,e).afterClosed().subscribe(i=>{i&&this.refreshTable()})}onDelete(){let e=V();e.width="450px",e.data={attributes:this.selected.selected,theme:"admin-theme"},this.dialog.open(ea,e).afterClosed().subscribe(i=>{i&&this.refreshTable()})}refreshTable(){this.loading=!0,this.attributesManager.getAllAttributeDefinitions().subscribe(e=>{this.attrDefinitions=e,this.selected.clear(),this.cachedSubject.next(!0),this.loading=!1})}applyFilter(e){this.filterValue=e,this.refreshTable()}onImport(){let e=V();e.width="700px",this.dialog.open(ia,e).afterClosed().subscribe(i=>{i===!0&&this.refreshTable()})}static{this.\u0275fac=function(n){return new(n||t)(m($),m(ae),m(re))}}static{this.\u0275cmp=D({type:t,selectors:[["app-admin-attributes"]],hostVars:2,hostBindings:function(n,i){n&2&&Ge("router-component",i.true)},decls:13,vars:9,consts:[["spinner",""],[1,"page-subtitle"],[3,"refresh"],["color","accent","data-cy","new-attr-definition-button","mat-flat-button","",1,"me-2","action-button"],["color","accent","mat-flat-button","",1,"me-2","action-button"],["color","warn","data-cy","delete-attr-definition-button","mat-flat-button","",1,"me-2",3,"disabled"],[3,"filter","placeholder"],[1,"position-relative","table-min-height"],[3,"loading","definitions","disableRouting","filterValue","selection","cachedSubject","tableId","refreshEvent",4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],["color","accent","data-cy","new-attr-definition-button","mat-flat-button","",1,"me-2","action-button",3,"click"],["color","accent","mat-flat-button","",1,"me-2","action-button",3,"click"],["color","warn","data-cy","delete-attr-definition-button","mat-flat-button","",1,"me-2",3,"click","disabled"],[3,"refreshEvent","loading","definitions","disableRouting","filterValue","selection","cachedSubject","tableId"]],template:function(n,i){if(n&1){let s=T();r(0,"div")(1,"h1",1),d(2),l(3,"translate"),a(),r(4,"perun-web-apps-refresh-button",2),C("refresh",function(){return h(s),g(i.refreshTable())}),a(),E(5,as,3,3,"button",3),E(6,rs,3,3,"button",4),E(7,ss,3,4,"button",5),r(8,"perun-web-apps-debounce-filter",6),C("filter",function(w){return h(s),g(i.applyFilter(w))}),a(),S(9,ls,1,0,"ng-template",null,0,B),r(11,"div",7),S(12,ps,1,7,"app-attr-def-list",8),a()()}if(n&2){let s=R(10);o(2),A(p(3,7,"ADMIN.ATTRIBUTES.TITLE")),o(3),I(i.authResolver.isPerunAdmin()?5:-1),o(),I(i.authResolver.isPerunAdmin()?6:-1),o(),I(i.authResolver.isPerunAdmin()?7:-1),o(),u("placeholder","ADMIN.ATTRIBUTES.SEARCH"),o(4),u("perunWebAppsLoader",i.loading)("perunWebAppsLoaderIndicator",s)}},dependencies:[x,L,O,de,ce,M,ci,N,H,y],encapsulation:2})}}return t})();var ms=()=>({color:"black"}),us=t=>["/admin/users",t];function _s(t,c){t&1&&b(0,"mat-spinner",1)}function fs(t,c){if(t&1){let e=T();r(0,"button",12),l(1,"translate"),C("click",function(){h(e);let i=_(3);return g(i.editUser())}),r(2,"mat-icon"),d(3,"edit"),a()()}t&2&&u("matTooltip",fe(p(1,2,"ADMIN_USER.EDIT")))}function hs(t,c){if(t&1){let e=T();r(0,"button",13),l(1,"translate"),C("click",function(){h(e);let i=_(3);return g(i.anonymizeUser())}),r(2,"mat-icon"),d(3,"no_accounts"),a()()}t&2&&u("matTooltip",fe(p(1,2,"ADMIN_USER.ANONYMIZE")))}function gs(t,c){if(t&1){let e=T();r(0,"button",13),l(1,"translate"),C("click",function(){h(e);let i=_(3);return g(i.deleteUser())}),r(2,"mat-icon"),d(3,"delete_forever"),a()()}t&2&&u("matTooltip",fe(p(1,2,"ADMIN_USER.DELETE")))}function Cs(t,c){t&1&&(r(0,"mat-icon",11),l(1,"translate"),d(2," blur_off "),a()),t&2&&u("matTooltip",fe(p(1,2,"USER_DETAIL.DASHBOARD.ANONYMIZED")))}function bs(t,c){if(t&1&&(r(0,"span"),E(1,fs,4,4,"button",9),E(2,hs,4,4,"button",10),E(3,gs,4,4,"button",10),E(4,Cs,3,4,"mat-icon",11),a()),t&2){let e=_(2);o(),I(e.anonymized?-1:1),o(),I(!e.anonymized&&!e.userDeletionForced?2:-1),o(),I(e.userDeletionForced?3:-1),o(),I(e.anonymized?4:-1)}}function Ss(t,c){if(t&1&&(r(0,"div",2),b(1,"mat-icon",3),l(2,"translate"),r(3,"div",4)(4,"div",5)(5,"a",6),d(6),l(7,"userFullName"),a(),r(8,"span",7),d(9),a(),E(10,bs,5,4,"span"),a(),r(11,"div"),d(12),l(13,"translate"),a(),r(14,"span",8),d(15),l(16,"translate"),l(17,"translate"),a()()()),t&2){let e=_();o(),u("matTooltip",fe(p(2,13,"ADMIN_USER.ENTITY")))("ngStyle",he(23,ms))("svgIcon",e.svgIcon),o(4),u("routerLink",De(24,us,e.user.id)),o(),f(" ",p(7,15,e.user)," "),o(3),f(" \xA0#",e.user.id," "),o(),I(e.authResolver.isPerunAdmin()?10:-1),o(2),rt("",p(13,17,"ADMIN_USER.UUID"),": ",e.user.uuid),o(3),Sn(" ",p(16,19,"ADMIN_USER.ENTITY"),", ",p(17,21,"ADMIN_USER.USER_TYPE"),": ",e.getUserType()," ")}}var pa=(()=>{class t{constructor(e,n,i,s,v,w,q,_e,Se,di){this.route=e,this.attributesService=n,this.usersService=i,this.sideMenuService=s,this.sideMenuItemService=v,this.dialog=w,this.authResolver=q,this.entityStorageService=_e,this.router=Se,this.store=di,this.loading=!1,this.svgIcon="perun-user-dark"}ngOnInit(){this.loading=!0,this.userDeletionForced=this.store.getProperty("user_deletion_forced"),this.route.params.subscribe(e=>{let n=Number(e.userId);this.entityStorageService.setEntityAndPathParam({id:Number(n),beanName:"User"},ji.User),this.path=`/admin/users/${n}`,this.regex="/admin/users/\\d+",this.usersService.getUserById(n).subscribe({next:s=>{this.user=s,this.svgIcon=this.user.serviceUser?"perun-service-identity":"perun-user-dark";let v=this.sideMenuItemService.parseUser(s,this.path,this.regex);this.sideMenuService.setAdminItems([v]),this.loading=!1},error:()=>this.loading=!1}),this.attributesService.getAttribute("urn:perun:user:attribute-def:virt:anonymized",void 0,void 0,n).subscribe(s=>{this.anonymized=!!s.value})})}editUser(){let e=V();e.width="450px",e.data={theme:"admin-theme",user:this.user},this.dialog.open(Fo,e).afterClosed().subscribe(i=>{i&&this.usersService.getUserById(this.user.id).subscribe(s=>{this.user=s})})}getUserType(){return this.user.serviceUser?"Service":"Person"}anonymizeUser(){this.openDialog(uo)}deleteUser(){this.openDialog(_o)}openDialog(e){let n=V();n.width="550px",n.data={theme:"admin-theme",user:this.user},this.dialog.open(e,n).afterClosed().subscribe(s=>{s&&this.router.navigate(["/admin","users"],{queryParamsHandling:"merge"})})}static{this.\u0275fac=function(n){return new(n||t)(m(me),m(ae),m(le),m(ri),m(Zi),m($),m(re),m(ke),m(Bi),m(Ve))}}static{this.\u0275cmp=D({type:t,selectors:[["app-admin-user-detail-page"]],decls:5,vars:2,consts:[[1,"container-fluid","ps-xl-5","pe-xl-5","user-theme"],[1,"me-auto","ms-auto"],[1,"d-flex","page-title-headtitle"],[1,"perun-icon","perun-icon-detail",3,"ngStyle","svgIcon","matTooltip"],[1,"page-title-block"],[1,"page-title-headline","d-flex","align-items-center"],["data-cy","user-name-link",1,"user-link",3,"routerLink"],[1,"text-muted"],[1,"mt-1","entity-info"],["mat-icon-button","","data-cy","edit-user-button",3,"matTooltip"],["mat-icon-button","",3,"matTooltip"],[1,"mat-icon-war","ms-2",3,"matTooltip"],["mat-icon-button","","data-cy","edit-user-button",3,"click","matTooltip"],["mat-icon-button","",3,"click","matTooltip"]],template:function(n,i){n&1&&(r(0,"div",0),b(1,"perun-web-apps-back-button"),E(2,_s,1,0,"mat-spinner",1),E(3,Ss,18,26,"div",2),b(4,"app-animated-router-outlet"),a()),n&2&&(o(2),I(i.loading?2:-1),o(),I(!i.loading&&i.user!==void 0?3:-1))},dependencies:[x,kt,L,Oi,Qe,ut,ai,ni,Vi,si,Wt,Ht,mt,dt,M,We,y,yn],encapsulation:2})}}return t})();var ca=(()=>{class t{constructor(e,n){this.userService=e,this.route=n,this.items=[],this.isServiceUser=!1,this.displayedColumns=["name","value"]}ngOnInit(){this.route.params.subscribe(e=>{this.userService.getUserById(Number(e.userId)).subscribe(n=>{this.user=n,this.isServiceUser=n.serviceUser,this.setItems(`/admin/users/${this.user.id}`)})})}setItems(e){this.items=[],this.items.push({cssIcon:"perun-user",url:`${e}/accounts`,label:"MENU_ITEMS.USER.ACCOUNTS",style:"user-btn"},{cssIcon:"perun-facility-white",url:`${e}/assignments`,label:"MENU_ITEMS.USER.ASSIGNMENTS",style:"user-btn"},{cssIcon:"perun-identity",url:`${e}/identities`,label:"MENU_ITEMS.USER.IDENTITIES",style:"user-btn"},{cssIcon:"perun-applications",url:`${e}/applications`,label:"MENU_ITEMS.USER.APPLICATIONS",style:"user-btn"}),this.items.push({cssIcon:"perun-attributes",url:`${e}/attributes`,label:"MENU_ITEMS.USER.ATTRIBUTES",style:"user-btn"}),this.items.push({cssIcon:"perun-roles",url:`${e}/roles`,label:"MENU_ITEMS.USER.ROLES",style:"user-btn"}),this.isServiceUser?this.items.push({cssIcon:"perun-manager",url:`${e}/associated-users`,label:"MENU_ITEMS.USER.ASSOCIATED_USERS",style:"user-btn"}):this.items.push({cssIcon:"perun-service-identity",url:`${e}/service-identities`,label:"MENU_ITEMS.USER.SERVICE_IDENTITIES",style:"user-btn"}),this.items.push({cssIcon:"perun-ban",url:"bans",label:"MENU_ITEMS.USER.BANS",style:"user-btn"})}static{this.\u0275fac=function(n){return new(n||t)(m(le),m(me))}}static{this.\u0275cmp=D({type:t,selectors:[["app-user-overview"]],hostVars:2,hostBindings:function(n,i){n&2&&Ge("router-component",i.true)},decls:1,vars:1,consts:[[3,"items"]],template:function(n,i){n&1&&b(0,"perun-web-apps-menu-buttons-field",0),n&2&&u("items",i.items)},dependencies:[x,L,Qe,oi,Hi,Ce,M],styles:[".align-cards[_ngcontent-%COMP%]{margin:1rem 0;display:inline-block;vertical-align:top}"]})}}return t})();function vs(t,c){t&1&&(d(0),l(1,"translate")),t&2&&f(" ",p(1,1,"ADMIN_USER.ENTITY")," ")}function Ts(t,c){if(t&1&&b(0,"app-one-entity-attribute-page",5),t&2){let e=_();u("entityId",e.userId)("entity","user")}}function Es(t,c){t&1&&(d(0),l(1,"translate"),l(2,"translate")),t&2&&rt(" ",p(1,2,"ADMIN_USER.ENTITY")," - ",p(2,4,"FACILITY_DETAIL.ENTITY")," ")}function Is(t,c){if(t&1&&b(0,"app-two-entity-attribute-page",6),t&2){let e=_(2);u("firstEntity","user")("firstEntityId",e.userId)("secondEntity","facility")}}function As(t,c){t&1&&(r(0,"mat-tab"),S(1,Es,3,6,"ng-template",3)(2,Is,1,3,"ng-template",4),a())}var da=(()=>{class t{constructor(e,n,i){this.route=e,this.store=n,this.authResolver=i}ngOnInit(){this.route.parent.params.subscribe(e=>{this.userId=Number(e.userId),this.userId||(this.userId=this.store.getPerunPrincipal().userId);let n={id:this.userId,beanName:"User"};this.userFacilityAttAuth=this.authResolver.isAuthorized("getAssignedFacilities_User_policy",[n])})}static{this.\u0275fac=function(n){return new(n||t)(m(me),m(Ve),m(re))}}static{this.\u0275cmp=D({type:t,selectors:[["app-user-settings-attributes"]],hostVars:2,hostBindings:function(n,i){n&2&&Ge("router-component",i.true)},decls:8,vars:4,consts:[[1,"page-subtitle"],["mat-stretch-tabs","false"],[1,"mb-2"],["matTabLabel",""],["matTabContent",""],[3,"entityId","entity"],[3,"firstEntity","firstEntityId","secondEntity"]],template:function(n,i){n&1&&(r(0,"h1",0),d(1),l(2,"translate"),a(),r(3,"mat-tab-group",1)(4,"mat-tab",2),S(5,vs,2,3,"ng-template",3)(6,Ts,1,2,"ng-template",4),a(),E(7,As,3,0,"mat-tab"),a()),n&2&&(o(),A(p(2,2,"USER_DETAIL.SETTINGS.ATTRIBUTES.TITLE")),o(6),I(i.userFacilityAttAuth?7:-1))},dependencies:[x,en,li,nt,Ze,et,tt,it,M,y],encapsulation:2})}}return t})();var Ds=()=>["id","name","type"];function xs(t,c){t&1&&b(0,"perun-web-apps-loading-table")}function Ms(t,c){if(t&1&&b(0,"app-ext-sources-list",7),t&2){let e=_();u("loading",e.loading)("extSources",e.extSources)("filterValue",e.filterValue)("displayColumns",he(5,Ds))("tableId",e.tableId)}}var ma=(()=>{class t{constructor(e,n){this.extSourceService=e,this.authResolver=n,this.extSources=[],this.filterValue="",this.loading=!1,this.tableId=eo}ngOnInit(){this.refreshTable()}applyFilter(e){this.filterValue=e}loadConfigExtSources(){this.loading=!0,this.extSourceService.loadExtSourcesDefinitions().subscribe(()=>{this.refreshTable()})}refreshTable(){this.loading=!0,this.extSourceService.getExtSources().subscribe(e=>{this.extSources=e,this.loading=!1})}static{this.\u0275fac=function(n){return new(n||t)(m(ki),m(re))}}static{this.\u0275cmp=D({type:t,selectors:[["app-admin-ext-sources"]],decls:13,vars:9,consts:[["spinner",""],[1,"page-subtitle"],[3,"click"],["mat-stroked-button","",1,"me-2",3,"click"],[3,"filter","placeholder"],[1,"position-relative","table-min-height"],[3,"loading","extSources","filterValue","displayColumns","tableId",4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],[3,"loading","extSources","filterValue","displayColumns","tableId"]],template:function(n,i){if(n&1){let s=T();r(0,"div")(1,"h1",1),d(2),l(3,"translate"),a(),r(4,"perun-web-apps-refresh-button",2),C("click",function(){return h(s),g(i.refreshTable())}),a(),r(5,"button",3),C("click",function(){return h(s),g(i.loadConfigExtSources())}),d(6),l(7,"translate"),a(),r(8,"perun-web-apps-debounce-filter",4),C("filter",function(w){return h(s),g(i.applyFilter(w))}),a(),S(9,xs,1,0,"ng-template",null,0,B),r(11,"div",5),S(12,Ms,1,6,"app-ext-sources-list",6),a()()}if(n&2){let s=R(10);o(2),A(p(3,5,"ADMIN.EXT_SOURCES.TITLE")),o(4),f(" ",p(7,7,"ADMIN.EXT_SOURCES.LOAD")," "),o(2),u("placeholder","ADMIN.EXT_SOURCES.SEARCH"),o(4),u("perunWebAppsLoader",i.loading)("perunWebAppsLoaderIndicator",s)}},dependencies:[x,L,O,de,ce,M,Oo,N,H,y],encapsulation:2})}}return t})();function ys(t,c){t&1&&(d(0),l(1,"translate")),t&2&&f(" ",p(1,1,"USER_DETAIL.DASHBOARD.DIRECT_ROLES")," ")}function ws(t,c){if(t&1){let e=T();r(0,"app-perun-web-apps-roles-page",4),bt("currentlyOpenPanelChange",function(i){h(e);let s=_();return Ct(s.userBasedOpenPanel,i)||(s.userBasedOpenPanel=i),g(i)}),C("reload",function(){h(e);let i=_();return g(i.getData())})("startLoading",function(){h(e);let i=_();return g(i.outerLoading=!0)}),a()}if(t&2){let e=_();u("outerLoading",e.outerLoading)("roles",e.roles)("entityId",e.userId)("showDescription",e.showDescription)("entityType",e.entityType)("editable",!0),gt("currentlyOpenPanel",e.userBasedOpenPanel)}}function Rs(t,c){t&1&&(d(0),l(1,"translate")),t&2&&f(" ",p(1,1,"USER_DETAIL.DASHBOARD.AUTHORIZED_GROUP_BASED_ROLES")," ")}function Ls(t,c){if(t&1){let e=T();r(0,"app-perun-web-apps-roles-page",5),bt("currentlyOpenPanelChange",function(i){h(e);let s=_();return Ct(s.groupBasedOpenPanel,i)||(s.groupBasedOpenPanel=i),g(i)}),C("reload",function(){h(e);let i=_();return g(i.getData())})("startLoading",function(){h(e);let i=_();return g(i.outerLoading=!0)}),a()}if(t&2){let e=_();u("outerLoading",e.outerLoading)("roles",e.indirectRoles)("entityId",e.userId)("showDescription",e.showDescription)("entityType",e.entityType)("editable",!1)("complementaryObjectsWithAuthzGroups",e.rolesComplementaryObjectsWithAuthzGroups),gt("currentlyOpenPanel",e.groupBasedOpenPanel)}}var ua=(()=>{class t{constructor(e,n,i,s){this.authzResolverService=e,this.route=n,this.store=i,this.roleService=s,this.roles=new Map,this.indirectRoles=new Map,this.rolesComplementaryObjectsWithAuthzGroups=new Map,this.showDescription=!0,this.userBasedOpenPanel=null,this.groupBasedOpenPanel=null}ngOnInit(){this.outerLoading=!0,this.route.parent.params.subscribe(e=>{e.userId?(this.entityType="USER",this.userId=Number(e.userId)):(this.userId=this.store.getPerunPrincipal().userId,this.entityType="SELF"),this.getData()})}getData(){this.outerLoading=!0,this.roles.clear(),this.authzResolverService.getUserDirectRoles(this.userId).subscribe({next:e=>{let n=Object.keys(e).map(i=>i.toUpperCase());this.roles=this.roleService.prepareRoles(e,n),this.indirectRoles.clear(),this.authzResolverService.getUserRolesObtainedFromAuthorizedGroupMemberships(this.userId).subscribe({next:i=>{let s=Object.keys(i).map(v=>v.toUpperCase());this.indirectRoles=this.roleService.prepareRoles(i,s),this.rolesComplementaryObjectsWithAuthzGroups.clear(),this.authzResolverService.getRoleComplementaryObjectsWithAuthorizedGroups(this.userId).subscribe({next:v=>{this.rolesComplementaryObjectsWithAuthzGroups=this.roleService.prepareComplementaryObjects(Object.keys(v),v),this.outerLoading=!1},error:()=>this.outerLoading=!1})},error:()=>this.outerLoading=!1})},error:()=>this.outerLoading=!1})}static{this.\u0275fac=function(n){return new(n||t)(m(Rn),m(me),m(Ve),m(Qn))}}static{this.\u0275cmp=D({type:t,selectors:[["app-user-roles"]],hostVars:2,hostBindings:function(n,i){n&2&&Ge("router-component",i.true)},decls:10,vars:3,consts:[[1,"page-subtitle","d-flex"],["mat-stretch-tabs","false"],["matTabLabel",""],["matTabContent",""],[3,"currentlyOpenPanelChange","reload","startLoading","outerLoading","roles","entityId","showDescription","entityType","editable","currentlyOpenPanel"],[3,"currentlyOpenPanelChange","reload","startLoading","outerLoading","roles","entityId","showDescription","entityType","editable","complementaryObjectsWithAuthzGroups","currentlyOpenPanel"]],template:function(n,i){n&1&&(r(0,"h1",0),d(1),l(2,"translate"),a(),r(3,"mat-tab-group",1)(4,"mat-tab"),S(5,ys,2,3,"ng-template",2)(6,ws,1,7,"ng-template",3),a(),r(7,"mat-tab"),S(8,Rs,2,3,"ng-template",2)(9,Ls,1,8,"ng-template",3),a()()),n&2&&(o(),A(p(2,1,"ROLES.TITLE")))},dependencies:[x,Uo,nt,Ze,et,tt,it,M,y],encapsulation:2})}}return t})();function Bs(t,c){t&1&&b(0,"perun-web-apps-loading-dialog")}function Os(t,c){if(t&1){let e=T();r(0,"div")(1,"h1",3),d(2),l(3,"translate"),a(),r(4,"div",4)(5,"mat-form-field",5)(6,"mat-label"),d(7),l(8,"translate"),a(),b(9,"input",6),r(10,"mat-error"),d(11),l(12,"translate"),a()(),r(13,"perun-web-apps-ext-source-search-select",7),C("extSourceSelected",function(i){h(e);let s=_();return g(s.selectedExtSource=i)}),a()(),r(14,"div",8)(15,"button",9),C("click",function(){h(e);let i=_();return g(i.onCancel())}),d(16),l(17,"translate"),a(),r(18,"button",10),C("click",function(){h(e);let i=_();return g(i.onAdd())}),d(19),l(20,"translate"),a()()()}if(t&2){let e=_();o(2),A(p(3,8,"DIALOGS.ADD_USER_EXT_SOURCE.TITLE")),o(5),A(p(8,10,"DIALOGS.ADD_USER_EXT_SOURCE.LOGIN")),o(2),u("formControl",e.loginControl),o(2),f(" ",p(12,12,"DIALOGS.ADD_USER_EXT_SOURCE.EMPTY_LOGIN")," "),o(2),u("extSources",e.extSources),o(3),f(" ",p(17,14,"DIALOGS.ADD_USER_EXT_SOURCE.CANCEL")," "),o(2),u("disabled",e.loginControl.invalid||e.selectedExtSource===null||e.loading),o(),f(" ",p(20,16,"DIALOGS.ADD_USER_EXT_SOURCE.ADD")," ")}}var _a=(()=>{class t{constructor(e,n,i,s,v,w){this.dialogRef=e,this.data=n,this.extSourcesManagerService=i,this.usersManagerService=s,this.translate=v,this.notificator=w,this.loginControl=new Rt("",[ge.required,ge.pattern(".*[\\S]+.*")]),this.selectedExtSource=null,this.extSources=[],v.get("DIALOGS.ADD_USER_EXT_SOURCE.SUCCESS").subscribe(q=>this.successMessage=q)}ngOnInit(){this.loading=!0,this.loginControl.markAllAsTouched(),this.extSourcesManagerService.getExtSources().subscribe({next:e=>{this.extSources=e,this.loading=!1},error:()=>this.loading=!1})}onCancel(){this.dialogRef.close(!1)}onAdd(){this.loading=!0;let e={beanName:"",extSource:this.selectedExtSource,id:0,login:this.loginControl.value,userId:this.data.userId};this.usersManagerService.addUserExtSource({user:this.data.userId,userExtSource:e}).subscribe({next:()=>{this.loading=!1,this.notificator.showSuccess(this.successMessage),this.dialogRef.close(!0)},error:()=>this.loading=!1})}static{this.\u0275fac=function(n){return new(n||t)(m(J),m(pe),m(ki),m(le),m(Y),m(j))}}static{this.\u0275cmp=D({type:t,selectors:[["app-add-user-ext-source-dialog"]],decls:4,vars:2,consts:[["spinner",""],[1,"position-relative"],[4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],["mat-dialog-title",""],["mat-dialog-content","",1,"dialog-container","user-theme"],[1,"center-self","w-100"],["matInput","","required","",3,"formControl"],[3,"extSourceSelected","extSources"],["mat-dialog-actions",""],["mat-stroked-button","",1,"ms-auto",3,"click"],["color","accent","mat-flat-button","",1,"ms-2",3,"click","disabled"]],template:function(n,i){if(n&1&&(S(0,Bs,1,0,"ng-template",null,0,B),r(2,"div",1),S(3,Os,21,18,"div",2),a()),n&2){let s=R(1);o(3),u("perunWebAppsLoader",i.loading)("perunWebAppsLoaderIndicator",s)}},dependencies:[x,L,O,Ye,Ke,ct,Dt,Je,Xe,$e,qe,ze,pt,yi,ie,Z,te,ee,ue,M,Ro,N,y],styles:[".column-size[_ngcontent-%COMP%]{width:10rem!important;font-weight:700}.center-self[_ngcontent-%COMP%]{margin-top:auto;margin-bottom:auto}.pre-wrap[_ngcontent-%COMP%]{white-space:pre-wrap}"]})}}return t})();function Ns(t,c){if(t&1){let e=T();r(0,"button",8),C("click",function(){h(e);let i=_();return g(i.addIdentity())}),d(1),l(2,"translate"),a()}t&2&&(o(),f(" ",p(2,1,"USER_DETAIL.IDENTITIES.ADD")," "))}function Us(t,c){if(t&1){let e=T();r(0,"button",9),C("click",function(){h(e);let i=_();return g(i.removeIdentity())}),d(1),l(2,"translate"),a()}if(t&2){let e=_();u("disabled",e.loading||e.selection.selected.length===0),o(),f(" ",p(2,2,"USER_DETAIL.IDENTITIES.REMOVE")," ")}}function Vs(t,c){t&1&&b(0,"perun-web-apps-loading-table")}function ks(t,c){if(t&1&&b(0,"perun-web-apps-user-ext-sources-list",10),t&2){let e=_();u("loading",e.loading)("displayColumns",e.displayedColumns)("filterValue",e.filterValue)("selection",e.selection)("cachedSubject",e.cachedSubject)("tableId",e.tableId)("userExtSources",e.userExtSources)}}var fa=(()=>{class t{constructor(e,n,i,s,v,w){this.usersManagerService=e,this.storage=n,this.registrarManagerService=i,this.dialog=s,this.route=v,this.authResolver=w,this.userExtSources=[],this.selection=new K(!1,[],!0,(q,_e)=>q.userExtSource.id===_e.userExtSource.id),this.displayedColumns=["select","id","extSourceName","login","lastAccess"],this.tableId=ro,this.filterValue="",this.cachedSubject=new G(!0)}ngOnInit(){this.route.parent.params.subscribe(e=>{this.userId=Number(e.userId)}),this.refreshTable()}refreshTable(){this.loading=!0,this.selection.clear(),this.cachedSubject.next(!0),this.usersManagerService.getRichUserExtSources(this.userId).subscribe({next:e=>{this.userExtSources=e,this.loading=!1},error:()=>{this.loading=!1}})}addIdentity(){let e=V();e.width="1000px",e.data={userId:this.userId},this.dialog.open(_a,e).afterClosed().subscribe(i=>{i&&this.refreshTable()})}removeIdentity(){let e=V();e.width="450px",e.data={showSuccess:!0,theme:"user-theme",userId:this.userId,extSources:this.selection.selected},this.dialog.open(co,e).afterClosed().subscribe(i=>{i&&this.refreshTable()})}applyFilter(e){this.filterValue=e,this.refreshTable()}static{this.\u0275fac=function(n){return new(n||t)(m(le),m(Ve),m(Fi),m($),m(me),m(re))}}static{this.\u0275cmp=D({type:t,selectors:[["app-user-identities"]],decls:11,vars:8,consts:[["spinner",""],[1,"page-subtitle"],[3,"refresh"],["color","accent","mat-flat-button","",1,"me-2","action-button"],["color","warn","mat-flat-button","",1,"me-2",3,"disabled"],[3,"filter","placeholder"],[1,"position-relative","table-min-height"],[3,"loading","displayColumns","filterValue","selection","cachedSubject","tableId","userExtSources",4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],["color","accent","mat-flat-button","",1,"me-2","action-button",3,"click"],["color","warn","mat-flat-button","",1,"me-2",3,"click","disabled"],[3,"loading","displayColumns","filterValue","selection","cachedSubject","tableId","userExtSources"]],template:function(n,i){if(n&1){let s=T();r(0,"h1",1),d(1),l(2,"translate"),a(),r(3,"perun-web-apps-refresh-button",2),C("refresh",function(){return h(s),g(i.refreshTable())}),a(),E(4,Ns,3,3,"button",3),E(5,Us,3,4,"button",4),r(6,"perun-web-apps-debounce-filter",5),C("filter",function(w){return h(s),g(i.applyFilter(w))}),a(),S(7,Vs,1,0,"ng-template",null,0,B),r(9,"div",6),S(10,ks,1,7,"perun-web-apps-user-ext-sources-list",7),a()}if(n&2){let s=R(8);o(),A(p(2,6,"USER_DETAIL.IDENTITIES.TITLE")),o(3),I(i.authResolver.isPerunAdmin()?4:-1),o(),I(i.authResolver.isPerunAdmin()?5:-1),o(),u("placeholder","USER_DETAIL.IDENTITIES.FILTER_PLACEHOLDER"),o(4),u("perunWebAppsLoader",i.loading)("perunWebAppsLoaderIndicator",s)}},dependencies:[x,L,O,de,ce,M,Co,N,H,y],encapsulation:2})}}return t})();var Ps=["list"];function Fs(t,c){t&1&&b(0,"perun-web-apps-loading-table")}function Gs(t,c){if(t&1&&b(0,"perun-web-apps-attributes-list",10,1),t&2){let e=_();u("loading",e.loading)("selection",e.selection)("cachedSubject",e.cachedSubject)("attributes",e.attributes)("tableId",e.tableId)}}var ha=(()=>{class t{constructor(e,n,i,s){this.dialog=e,this.attributesManager=n,this.userService=i,this.route=s,this.loading=!1,this.selection=new K(!0,[],!0,(v,w)=>v.id===w.id),this.cachedSubject=new G(!0),this.tableId=to,this.attributes=[]}ngOnInit(){this.route.params.subscribe(e=>{let n=Number(e.identityId);this.userService.getUserExtSourceById(n).subscribe(i=>{this.userExtSource=i,this.refreshTable()})})}refreshTable(){this.loading=!0,this.attributesManager.getUserExtSourceAttributes(this.userExtSource.id).subscribe(e=>{this.attributes=zn(e),this.selection.clear(),this.cachedSubject.next(!0),this.loading=!1})}onAdd(){let e=V();e.width="1050px",e.data={entityId:this.userExtSource.id,entity:"ues",notEmptyAttributes:this.attributes,style:"user-theme"},this.dialog.open(Lo,e).afterClosed().subscribe(i=>{i==="saved"&&this.refreshTable()})}onSave(){this.list.updateMapAttributes();let e=V();e.width="450px",e.data={entityId:this.userExtSource.id,entity:"ues",attributes:this.selection.selected},this.dialog.open(mo,e).afterClosed().subscribe(i=>{i&&this.refreshTable()})}onRemove(){let e=V();e.width="450px",e.data={entityId:this.userExtSource.id,entity:"ues",attributes:this.selection.selected},this.dialog.open(Bo,e).afterClosed().subscribe(i=>{i&&this.refreshTable()})}static{this.\u0275fac=function(n){return new(n||t)(m($),m(ae),m(le),m(me))}}static{this.\u0275cmp=D({type:t,selectors:[["app-identity-detail"]],viewQuery:function(n,i){if(n&1&&ve(Ps,5),n&2){let s;Te(s=Ee())&&(i.list=s.first)}},decls:28,vars:32,consts:[["spinner",""],["list",""],[1,"page-subtitle"],[1,"mb-2"],[3,"refresh"],["color","accent","mat-flat-button","",1,"me-2",3,"click","disabled"],["color","accent","mat-flat-button","",1,"me-2",3,"click"],["color","warn","mat-flat-button","",1,"me-2",3,"click","disabled"],[1,"position-relative","table-min-height"],[3,"loading","selection","cachedSubject","attributes","tableId",4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],[3,"loading","selection","cachedSubject","attributes","tableId"]],template:function(n,i){if(n&1){let s=T();r(0,"div")(1,"h1",2),d(2),l(3,"translate"),a(),r(4,"div"),d(5),l(6,"translate"),a(),r(7,"div"),d(8),l(9,"translate"),a(),r(10,"div",3),d(11),l(12,"translate"),l(13,"date"),a(),r(14,"perun-web-apps-refresh-button",4),C("refresh",function(){return h(s),g(i.refreshTable())}),a(),r(15,"button",5),C("click",function(){return h(s),g(i.onSave())}),d(16),l(17,"translate"),a(),r(18,"button",6),C("click",function(){return h(s),g(i.onAdd())}),d(19),l(20,"translate"),a(),r(21,"button",7),C("click",function(){return h(s),g(i.onRemove())}),d(22),l(23,"translate"),a(),S(24,Fs,1,0,"ng-template",null,0,B),r(26,"div",8),S(27,Gs,2,5,"perun-web-apps-attributes-list",9),a()()}if(n&2){let s=R(25);o(2),rt(" ",p(3,15,"SHARED.IDENTITY_DETAIL.TITLE")," - ",i.userExtSource?i.userExtSource.extSource.name:""," "),o(3),rt(" ",p(6,17,"SHARED.IDENTITY_DETAIL.TYPE"),": ",i.userExtSource?i.userExtSource.extSource.type:""," "),o(3),rt(" ",p(9,19,"SHARED.IDENTITY_DETAIL.LOGIN"),": ",i.userExtSource?i.userExtSource.login:""," "),o(3),rt(" ",p(12,21,"SHARED.IDENTITY_DETAIL.LAST_ACCESS"),": ",i.userExtSource?je(13,23,i.userExtSource.lastAccess,"d.M.y H:mm:ss"):""," "),o(4),u("disabled",i.loading||i.selection.selected.length===0),o(),f(" ",p(17,26,"SHARED.IDENTITY_DETAIL.SAVE")," "),o(3),f(" ",p(20,28,"SHARED.IDENTITY_DETAIL.ADD")," "),o(2),u("disabled",i.loading||i.selection.selected.length===0),o(),f(" ",p(23,30,"SHARED.IDENTITY_DETAIL.REMOVE")," "),o(5),u("perunWebAppsLoader",i.loading)("perunWebAppsLoaderIndicator",s)}},dependencies:[x,L,O,ce,M,ho,N,H,En,y],encapsulation:2})}}return t})();var js=()=>({color:"black"}),ga=t=>["/admin/services",t];function Hs(t,c){t&1&&b(0,"mat-spinner",1)}function Ws(t,c){if(t&1){let e=T();r(0,"button",16),l(1,"translate"),C("click",function(){h(e);let i=_(2);return g(i.editService())}),r(2,"mat-icon"),d(3,"edit"),a()()}t&2&&u("matTooltip",fe(p(1,2,"SERVICE_DETAIL.EDIT")))}function qs(t,c){if(t&1){let e=T();r(0,"button",17),l(1,"translate"),C("click",function(){h(e);let i=_(2);return g(i.removeService())}),r(2,"mat-icon"),d(3,"delete_forever"),a()()}t&2&&u("matTooltip",fe(p(1,2,"SERVICE_DETAIL.DELETE")))}function zs(t,c){if(t&1){let e=T();r(0,"button",18),C("click",function(){h(e);let i=_(2);return g(i.evaluateConsents())}),d(1),l(2,"translate"),a()}t&2&&(o(),f(" ",p(2,1,"SERVICE_DETAIL.EVALUATE_CONSENTS")," "))}function $s(t,c){if(t&1){let e=T();r(0,"div",2),b(1,"mat-icon",3),l(2,"translate"),r(3,"div",4)(4,"div",5)(5,"div",6)(6,"div",7)(7,"a",8),C("auxclick",function(i){return h(e),g(i.preventDefault())}),d(8),a(),r(9,"span",9),d(10),a(),E(11,Ws,4,4,"button",10),E(12,qs,4,4,"button",11),a(),r(13,"span",12),d(14),l(15,"translate"),a()()(),r(16,"div",13)(17,"mat-slide-toggle",14),C("toggleChange",function(){h(e);let i=_();return g(i.changeServiceStatus())}),d(18),l(19,"translate"),a(),r(20,"mat-slide-toggle",14),C("toggleChange",function(){h(e);let i=_();return g(i.groupPropagationChange())}),d(21),l(22,"translate"),a(),r(23,"mat-slide-toggle",14),C("toggleChange",function(){h(e);let i=_();return g(i.voPropagationChange())}),d(24),l(25,"translate"),a(),r(26,"mat-slide-toggle",14),C("toggleChange",function(){h(e);let i=_();return g(i.bannedPropagationChange())}),d(27),l(28,"translate"),a(),E(29,zs,3,3,"button",15),a()()()}if(t&2){let e=_();o(),u("matTooltip",fe(p(2,20,"SERVICE_DETAIL.ENTITY")))("ngStyle",he(32,js)),o(6),u("perunWebAppsMiddleClickRouterLink",De(33,ga,e.service.id.toString()))("routerLink",De(35,ga,e.service.id)),o(),f(" ",e.service.name," "),o(2),f(" \xA0 #",e.service.id," "),o(),I(e.authResolver.isPerunAdmin()?11:-1),o(),I(e.authResolver.isPerunAdmin()?12:-1),o(2),rt(" ",p(15,22,"SERVICE_DETAIL.DESCRIPTION"),": ",e.service.description," "),o(3),u("checked",e.service.enabled),o(),f(" ",p(19,24,"SERVICE_DETAIL.ENABLE")," "),o(2),u("checked",e.service.useExpiredMembers),o(),f(" ",p(22,26,"SERVICE_DETAIL.PROPAGATE_GROUP")," "),o(2),u("checked",e.service.useExpiredVoMembers),o(),f(" ",p(25,28,"SERVICE_DETAIL.PROPAGATE_VO")," "),o(2),u("checked",e.service.useBannedMembers),o(),f(" ",p(28,30,"SERVICE_DETAIL.PROPAGATE_BANNED")," "),o(2),I(e.authResolver.isPerunAdmin()?29:-1)}}var ba=(()=>{class t{constructor(e,n,i,s,v,w,q,_e,Se,di,Fa){this.route=e,this.router=n,this.consentsManager=i,this.serviceManager=s,this.sideMenuService=v,this.sideMenuItemService=w,this.dialog=q,this.authResolver=_e,this.translate=Se,this.notificator=di,this.entityStorageService=Fa,this.loading=!1}ngOnInit(){this.loading=!0,this.route.params.subscribe(e=>{this.serviceId=Number(e.serviceId),this.entityStorageService.setEntityAndPathParam({id:this.serviceId,beanName:"Service"},ji.Service),this.refresh()})}editService(){let e=V();e.width="600px",e.data={theme:"service-theme",service:this.service},this.dialog.open(jo,e).afterClosed().subscribe(i=>{i&&this.refresh()})}removeService(){let e=V();e.width="600px",e.data={theme:"service-theme",services:[this.service]},this.dialog.open(Ho,e).afterClosed().subscribe(i=>{i&&this.router.navigate(["/admin/services"],{queryParamsHandling:"preserve"})})}changeServiceStatus(){this.service.enabled=!this.service.enabled,this.serviceManager.updateService({service:this.service}).subscribe(()=>{this.notificator.showSuccess(this.translate.instant("SERVICE_DETAIL.STATUS_CHANGE_SUCCESS"))},()=>this.service.enabled=!this.service.enabled)}groupPropagationChange(){this.service.useExpiredMembers=!this.service.useExpiredMembers,this.serviceManager.updateService({service:this.service}).subscribe({next:()=>{this.notificator.showSuccess(this.translate.instant("SERVICE_DETAIL.PROPAGATION_CHANGE_SUCCESS"))},error:()=>this.service.useExpiredMembers=!this.service.useExpiredMembers})}voPropagationChange(){this.service.useExpiredVoMembers=!this.service.useExpiredVoMembers,this.serviceManager.updateService({service:this.service}).subscribe({next:()=>{this.notificator.showSuccess(this.translate.instant("SERVICE_DETAIL.PROPAGATION_CHANGE_SUCCESS"))},error:()=>this.service.useExpiredVoMembers=!this.service.useExpiredVoMembers})}bannedPropagationChange(){this.service.useBannedMembers=!this.service.useBannedMembers,this.serviceManager.updateService({service:this.service}).subscribe({next:()=>{this.notificator.showSuccess(this.translate.instant("SERVICE_DETAIL.PROPAGATION_CHANGE_SUCCESS_BANNED"))},error:()=>this.service.useBannedMembers=!this.service.useBannedMembers})}evaluateConsents(){let e=V();e.width="500px",e.data={title:this.translate.instant("SERVICE_DETAIL.CONFIRM_DIALOG_TITLE"),theme:"service-theme",description:this.translate.instant("SERVICE_DETAIL.CONFIRM_DIALOG_DESCRIPTION"),items:[this.service.name],type:"confirmation",showAsk:!1},this.dialog.open(Ki,e).afterClosed().subscribe(i=>{i&&this.consentsManager.evaluateConsentsForService(this.service.id).subscribe(()=>this.notificator.showSuccess(this.translate.instant("SERVICE_DETAIL.EVALUATION_FINISH")))})}refresh(){this.serviceManager.getServiceById(this.serviceId).subscribe(e=>{this.service=e;let n=this.sideMenuItemService.parseService(this.service);this.sideMenuService.setAdminItems([n]),this.loading=!1},()=>this.loading=!1)}static{this.\u0275fac=function(n){return new(n||t)(m(me),m(Bi),m(xt),m(_t),m(ri),m(Zi),m($),m(re),m(Y),m(j),m(ke))}}static{this.\u0275cmp=D({type:t,selectors:[["app-service-detail-page"]],decls:5,vars:2,consts:[[1,"container-fluid","ps-xl-5","pe-xl-5","service-theme"],[1,"ms-auto","me-auto"],[1,"page-title-headtitle","detail-layout"],["svgIcon","perun-service",1,"perun-icon","perun-icon-detail",3,"matTooltip","ngStyle"],[1,"wrap-container"],[1,"detail-info"],[1,"flex-column"],[1,"page-title-headline","d-flex","align-items-center"],["data-cy","service-name-link",1,"service-link",3,"auxclick","perunWebAppsMiddleClickRouterLink","routerLink"],[1,"text-muted"],["aria-label","Edit service","data-cy","service-edit-button","mat-icon-button","",3,"matTooltip"],["aria-label","Remove service","mat-icon-button","",3,"matTooltip"],[1,"mt-1","entity-info"],[1,"detail-actions"],["labelPosition","before",1,"mb-25",3,"toggleChange","checked"],["mat-stroked-button","",1,"action-button","evaluate-button"],["aria-label","Edit service","data-cy","service-edit-button","mat-icon-button","",3,"click","matTooltip"],["aria-label","Remove service","mat-icon-button","",3,"click","matTooltip"],["mat-stroked-button","",1,"action-button","evaluate-button",3,"click"]],template:function(n,i){n&1&&(r(0,"div",0),b(1,"perun-web-apps-back-button"),E(2,Hs,1,0,"mat-spinner",1),E(3,$s,30,37,"div",2),b(4,"app-animated-router-outlet"),a()),n&2&&(o(2),I(i.loading?2:-1),o(),I(i.loading?-1:3))},dependencies:[x,kt,L,O,Oi,Qe,ut,Kt,$t,Ui,ai,ni,Vi,si,Wt,Ht,mt,dt,M,We,y],styles:[".detail-layout[_ngcontent-%COMP%]{display:flex;flex-direction:row;gap:1.2em}.detail-info[_ngcontent-%COMP%]{display:flex;flex-direction:row;margin-right:1.2em}.wrap-container[_ngcontent-%COMP%]{display:flex;flex-direction:row;flex-wrap:wrap;gap:.3em}.detail-actions[_ngcontent-%COMP%]{display:flex;flex-direction:column;border-left:1px solid rgba(0,0,0,.2);padding-left:.5em}.evaluate-button[_ngcontent-%COMP%]{width:fit-content}"],data:{animation:[To]}})}}return t})();var Sa=(()=>{class t{constructor(e){this.entityStorageService=e,this.navItems=[]}ngOnInit(){this.service=this.entityStorageService.getEntity(),this.initNavItems()}initNavItems(){this.navItems=[{cssIcon:"perun-attributes",url:`/admin/services/${this.service.id}/required-attributes`,label:"MENU_ITEMS.SERVICE.REQUIRED_ATTRIBUTES",style:"service-btn"},{cssIcon:"perun-service_destination",url:`/admin/services/${this.service.id}/destinations`,label:"MENU_ITEMS.SERVICE.DESTINATIONS",style:"service-btn"}]}static{this.\u0275fac=function(n){return new(n||t)(m(ke))}}static{this.\u0275cmp=D({type:t,selectors:[["app-service-overview"]],decls:1,vars:1,consts:[[3,"items"]],template:function(n,i){n&1&&b(0,"perun-web-apps-menu-buttons-field",0),n&2&&u("items",i.navItems)},dependencies:[x,oi],encapsulation:2})}}return t})();function Ks(t,c){t&1&&b(0,"perun-web-apps-loading-dialog")}function Ys(t,c){t&1&&(r(0,"perun-web-apps-alert",4),d(1),l(2,"translate"),a()),t&2&&(u("alert_type","warn"),o(),A(p(2,2,"DIALOGS.ADD_REQUIRED_ATTRIBUTES.ACTIVE_WARN")))}function Qs(t,c){if(t&1){let e=T();r(0,"div")(1,"h1",2),d(2),l(3,"translate"),a(),r(4,"div",3),E(5,Ys,3,4,"perun-web-apps-alert",4),l(6,"async"),r(7,"perun-web-apps-debounce-filter",5),C("filter",function(i){h(e);let s=_();return g(s.applyFilter(i))}),a(),b(8,"app-attr-def-list",6),l(9,"async"),l(10,"async"),a(),r(11,"div",7)(12,"button",8),C("click",function(){h(e);let i=_();return g(i.onCancel())}),d(13),l(14,"translate"),a(),r(15,"button",9),C("click",function(){h(e);let i=_();return g(i.onAdd())}),d(16),l(17,"translate"),a()()()}if(t&2){let e=_();o(2),A(p(3,13,"DIALOGS.ADD_REQUIRED_ATTRIBUTES.TITLE")),o(3),I(p(6,15,e.serviceEnabled$)?5:-1),o(2),u("placeholder","DIALOGS.ADD_REQUIRED_ATTRIBUTES.FILTER"),o(),u("selection",e.selection)("definitions",e.attrDefinitions)("disableRouting",!0)("filterValue",e.filterValue)("serviceEnabled",p(9,17,e.serviceEnabled$))("consentRequired",p(10,19,e.consentRequired$))("loading",e.loading),o(5),f(" ",p(14,21,"DIALOGS.ADD_REQUIRED_ATTRIBUTES.CANCEL")," "),o(2),u("disabled",e.selection.selected.length===0),o(),f(" ",p(17,23,"DIALOGS.ADD_REQUIRED_ATTRIBUTES.ADD")," ")}}var va=(()=>{class t{constructor(e,n,i,s,v,w,q,_e){this.dialogRef=e,this.data=n,this.serviceManager=i,this.attributesManager=s,this.facilitiesService=v,this.consentHubService=w,this.notificator=q,this.translate=_e,this.consentRequired$=this.facilitiesService.getAssignedFacilitiesByService(this.data.serviceId).pipe(hn(un),ht(Se=>Se.id),Cn(),_n(Se=>this.consentHubService.getConsentHubByFacility(Se)),fn((Se,di)=>Se||di.enforceConsents,!1),at(!0)),this.serviceEnabled$=this.serviceManager.getServiceById(this.data.serviceId).pipe(ht(Se=>Se.enabled),at(!0)),this.attrDefinitions=[],this.selection=new K(!0,[]),this.filterValue="",this.loading=!1}ngOnInit(){this.loading=!0,this.theme=this.data.theme,this.serviceId=this.data.serviceId,this.attributesManager.getAllAttributeDefinitions().subscribe(e=>{this.attrDefinitions=e,this.loading=!1})}onAdd(){this.loading=!0;let e=this.selection.selected.map(n=>n.id);this.serviceManager.addRequiredAttributes(this.serviceId,e).subscribe(()=>{this.notificator.showSuccess(this.translate.instant("DIALOGS.ADD_REQUIRED_ATTRIBUTES.SUCCESS")),this.dialogRef.close(!0),this.loading=!1},()=>this.loading=!1)}onCancel(){this.dialogRef.close(!1)}applyFilter(e){this.filterValue=e}static{this.\u0275fac=function(n){return new(n||t)(m(J),m(pe),m(_t),m(ae),m(zt),m(xt),m(j),m(Y))}}static{this.\u0275cmp=D({type:t,selectors:[["app-add-required-attributes"]],decls:4,vars:5,consts:[["spinner",""],[4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],["mat-dialog-title",""],["mat-dialog-content","",1,"dialog-container"],[3,"alert_type"],[3,"filter","placeholder"],[3,"selection","definitions","disableRouting","filterValue","serviceEnabled","consentRequired","loading"],["mat-dialog-actions",""],["mat-stroked-button","",1,"ms-auto",3,"click"],["color","accent","mat-flat-button","",1,"ms-2",3,"click","disabled"]],template:function(n,i){if(n&1&&(S(0,Ks,1,0,"ng-template",null,0,B),r(2,"div"),S(3,Qs,18,25,"div",1),a()),n&2){let s=R(1);o(2),Pe(Ie("",i.theme," position-relative")),o(),u("perunWebAppsLoader",i.loading)("perunWebAppsLoaderIndicator",s)}},dependencies:[x,L,O,ie,Z,te,ee,X,Q,ue,de,M,ci,N,He,y],encapsulation:2})}}return t})();function Xs(t,c){t&1&&b(0,"perun-web-apps-loading-dialog")}function Js(t,c){t&1&&b(0,"th",14)}function Zs(t,c){if(t&1&&(r(0,"td",15),d(1),a()),t&2){let e=c.$implicit;o(),A(e.friendlyName)}}function el(t,c){t&1&&b(0,"tr",16)}function tl(t,c){t&1&&b(0,"tr",17)}function il(t,c){if(t&1){let e=T();r(0,"div")(1,"h1",2),d(2),l(3,"translate"),a(),r(4,"div",3)(5,"p"),d(6),l(7,"translate"),a(),r(8,"div",4),d(9),l(10,"translate"),a(),r(11,"table",5),k(12,6),S(13,Js,1,0,"th",7)(14,Zs,2,1,"td",8),P(),S(15,el,1,0,"tr",9)(16,tl,1,0,"tr",10),a()(),r(17,"div",11)(18,"button",12),C("click",function(){h(e);let i=_();return g(i.onCancel())}),d(19),l(20,"translate"),a(),r(21,"button",13),C("click",function(){h(e);let i=_();return g(i.onConfirm())}),d(22),l(23,"translate"),a()()()}if(t&2){let e=_();o(2),A(p(3,9,"DIALOGS.REMOVE_REQUIRED_ATTRIBUTES.TITLE")),o(4),A(p(7,11,"DIALOGS.REMOVE_REQUIRED_ATTRIBUTES.DESCRIPTION")),o(3),f(" ",p(10,13,"DIALOGS.REMOVE_REQUIRED_ATTRIBUTES.ASK")," "),o(2),u("dataSource",e.dataSource),o(4),u("matHeaderRowDef",e.displayedColumns),o(),u("matRowDefColumns",e.displayedColumns),o(3),f(" ",p(20,15,"DIALOGS.REMOVE_REQUIRED_ATTRIBUTES.CANCEL")," "),o(2),u("disabled",e.loading),o(),f(" ",p(23,17,"DIALOGS.REMOVE_REQUIRED_ATTRIBUTES.REMOVE")," ")}}var Ta=(()=>{class t{constructor(e,n,i,s,v){this.dialogRef=e,this.data=n,this.serviceManager=i,this.notificator=s,this.translate=v,this.displayedColumns=["name"],this.loading=!1}ngOnInit(){this.theme=this.data.theme,this.serviceId=this.data.serviceId,this.dataSource=new Ae(this.data.attrDefinitions)}onConfirm(){this.loading=!0;let e=this.dataSource.data.map(n=>n.id);this.serviceManager.removeRequiredAttributes(this.serviceId,e).subscribe(()=>{this.notificator.showSuccess(this.translate.instant("DIALOGS.REMOVE_REQUIRED_ATTRIBUTES.SUCCESS")),this.dialogRef.close(!0),this.loading=!1},()=>this.loading=!1)}onCancel(){this.dialogRef.close(!1)}static{this.\u0275fac=function(n){return new(n||t)(m(J),m(pe),m(_t),m(j),m(Y))}}static{this.\u0275cmp=D({type:t,selectors:[["app-remove-required-attributes"]],decls:4,vars:5,consts:[["spinner",""],[4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],["mat-dialog-title",""],["mat-dialog-content",""],[1,"fw-bold"],["mat-table","",1,"w-100",3,"dataSource"],["matColumnDef","name"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["class","font-weight-bolder","mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["mat-dialog-actions",""],["mat-stroked-button","",1,"ms-auto",3,"click"],["color","warn","mat-flat-button","",1,"ms-2",3,"click","disabled"],["mat-header-cell",""],["mat-cell",""],["mat-header-row","",1,"font-weight-bolder"],["mat-row",""]],template:function(n,i){if(n&1&&(S(0,Xs,1,0,"ng-template",null,0,B),r(2,"div"),S(3,il,24,19,"div",1),a()),n&2){let s=R(1);o(2),Pe(Ie("",i.theme," position-relative")),o(),u("perunWebAppsLoader",i.loading)("perunWebAppsLoaderIndicator",s)}},dependencies:[x,L,O,ie,Z,te,ee,ue,Ce,xe,ye,Be,we,Me,Oe,Re,Le,Ne,Ue,M,N,y],encapsulation:2})}}return t})();function nl(t,c){if(t&1){let e=T();r(0,"button",8),C("click",function(){h(e);let i=_();return g(i.onAdd())}),d(1),l(2,"translate"),a()}t&2&&(o(),f(" ",p(2,1,"SERVICE_DETAIL.REQUIRED_ATTRIBUTES.ADD")," "))}function ol(t,c){if(t&1){let e=T();r(0,"button",9),C("click",function(){h(e);let i=_();return g(i.onRemove())}),d(1),l(2,"translate"),a()}if(t&2){let e=_();u("disabled",e.loading||e.selection.selected.length===0),o(),f(" ",p(2,2,"SERVICE_DETAIL.REQUIRED_ATTRIBUTES.REMOVE")," ")}}function al(t,c){t&1&&b(0,"perun-web-apps-loading-table")}function rl(t,c){if(t&1){let e=T();r(0,"app-attr-def-list",10),C("refreshEvent",function(){h(e);let i=_();return g(i.refreshTable())}),a()}if(t&2){let e=_();u("loading",e.loading)("definitions",e.attrDefinitions)("filterValue",e.filterValue)("selection",e.selection)("cachedSubject",e.cachedSubject)("disableRouting",!e.authResolver.isPerunAdmin())("tableId",e.tableId)}}var Ea=(()=>{class t{constructor(e,n,i,s){this.attributeManager=e,this.dialog=n,this.authResolver=i,this.entityStorageService=s,this.loading=!1,this.filterValue="",this.selection=new K(!0,[],!0,(v,w)=>v.id===w.id),this.cachedSubject=new G(!0),this.attrDefinitions=[],this.tableId=ao}ngOnInit(){this.loading=!0,this.service=this.entityStorageService.getEntity(),this.refreshTable()}refreshTable(){this.loading=!0,this.attributeManager.getRequiredAttributesDefinition(this.service.id).subscribe(e=>{this.selection.clear(),this.cachedSubject.next(!0),this.attrDefinitions=e,this.loading=!1})}onAdd(){let e=V();e.width="950px",e.data={serviceId:this.service.id,theme:"service-theme"},this.dialog.open(va,e).afterClosed().subscribe(i=>{i&&this.refreshTable()})}onRemove(){let e=V();e.width="650px",e.data={serviceId:this.service.id,attrDefinitions:this.selection.selected,theme:"service-theme"},this.dialog.open(Ta,e).afterClosed().subscribe(i=>{i&&this.refreshTable()})}applyFilter(e){this.filterValue=e,this.refreshTable()}static{this.\u0275fac=function(n){return new(n||t)(m(ae),m($),m(re),m(ke))}}static{this.\u0275cmp=D({type:t,selectors:[["app-service-required-attributes"]],decls:12,vars:8,consts:[["spinner",""],[1,"page-subtitle"],[3,"refresh"],["color","accent","mat-flat-button","",1,"me-2","action-button"],["color","warn","mat-flat-button","",1,"me-2",3,"disabled"],[3,"filter","placeholder"],[1,"position-relative","table-min-height"],[3,"loading","definitions","filterValue","selection","cachedSubject","disableRouting","tableId","refreshEvent",4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],["color","accent","mat-flat-button","",1,"me-2","action-button",3,"click"],["color","warn","mat-flat-button","",1,"me-2",3,"click","disabled"],[3,"refreshEvent","loading","definitions","filterValue","selection","cachedSubject","disableRouting","tableId"]],template:function(n,i){if(n&1){let s=T();r(0,"div")(1,"h1",1),d(2),l(3,"translate"),a(),r(4,"perun-web-apps-refresh-button",2),C("refresh",function(){return h(s),g(i.refreshTable())}),a(),E(5,nl,3,3,"button",3),E(6,ol,3,4,"button",4),r(7,"perun-web-apps-debounce-filter",5),C("filter",function(w){return h(s),g(i.applyFilter(w))}),a(),S(8,al,1,0,"ng-template",null,0,B),r(10,"div",6),S(11,rl,1,7,"app-attr-def-list",7),a()()}if(n&2){let s=R(9);o(2),A(p(3,6,"SERVICE_DETAIL.REQUIRED_ATTRIBUTES.TITLE")),o(3),I(i.authResolver.isPerunAdmin()?5:-1),o(),I(i.authResolver.isPerunAdmin()?6:-1),o(),u("placeholder","SERVICE_DETAIL.REQUIRED_ATTRIBUTES.FILTER"),o(4),u("perunWebAppsLoader",i.loading)("perunWebAppsLoaderIndicator",s)}},dependencies:[x,L,O,de,ce,M,ci,N,H,y],encapsulation:2})}}return t})();var sl=()=>["select","destinationId","facility","destination","type","status","propagationType"];function ll(t,c){if(t&1){let e=T();r(0,"button",8),C("click",function(){h(e);let i=_();return g(i.onRemove())}),d(1),l(2,"translate"),a()}if(t&2){let e=_();u("disabled",e.loading||e.selection.selected.length===0),o(),f(" ",p(2,2,"SERVICE_DETAIL.DESTINATIONS.REMOVE")," ")}}function pl(t,c){if(t&1){let e=T();r(0,"button",9),C("click",function(){h(e);let i=_();return g(i.onAllow())}),d(1),l(2,"translate"),a()}if(t&2){let e=_();u("disabled",e.loading||e.selection.selected.length===0),o(),f(" ",p(2,2,"SERVICE_DETAIL.DESTINATIONS.ALLOW")," ")}}function cl(t,c){if(t&1){let e=T();r(0,"button",8),C("click",function(){h(e);let i=_();return g(i.onBlock())}),d(1),l(2,"translate"),a()}if(t&2){let e=_();u("disabled",e.loading||e.selection.selected.length===0),o(),f(" ",p(2,2,"SERVICE_DETAIL.DESTINATIONS.BLOCK")," ")}}function dl(t,c){t&1&&b(0,"perun-web-apps-loading-table")}function ml(t,c){if(t&1&&b(0,"app-perun-web-apps-destination-list",10),t&2){let e=_();u("loading",e.loading)("destinations",e.destinations)("filterValue",e.filterValue)("selection",e.selection)("cachedSubject",e.cachedSubject)("displayColumns",he(7,sl))("tableId",e.tableId)}}var Ia=(()=>{class t{constructor(e,n,i,s,v,w){this.serviceManager=e,this.notificator=n,this.translate=i,this.dialog=s,this.authResolver=v,this.entityStorageService=w,this.loading=!1,this.filterValue="",this.destinations=[],this.selection=new K(!0,[],!0,(q,_e)=>q.id===_e.id),this.cachedSubject=new G(!0),this.tableId=io}ngOnInit(){this.loading=!0,this.service=this.entityStorageService.getEntity(),this.refreshTable()}refreshTable(){this.loading=!0,this.serviceManager.getAllRichDestinationsForService(this.service.id).subscribe(e=>{this.selection.clear(),this.cachedSubject.next(!0),this.filterValue="",this.destinations=e,this.loading=!1})}onBlock(){this.loading=!0,this.blockServiceOnDestinations(this.selection.selected)}onAllow(){this.loading=!0,this.allowServiceOnDestinations(this.selection.selected)}onRemove(){let e=V();e.width="500px",e.data={destinations:this.selection.selected,theme:"admin-theme"},this.dialog.open($o,e).afterClosed().subscribe(i=>{i&&this.refreshTable()})}applyFilter(e){this.filterValue=e,this.refreshTable()}blockServiceOnDestinations(e){this.serviceManager.blockServicesOnDestinations({richDestinations:e}).subscribe({next:()=>{this.notificator.showSuccess(this.translate.instant("SERVICE_DETAIL.DESTINATIONS.BLOCK_SUCCESS")),this.refreshTable()},error:()=>this.loading=!1})}allowServiceOnDestinations(e){this.serviceManager.unblockServicesOnDestinations({richDestinations:e}).subscribe({next:()=>{this.notificator.showSuccess(this.translate.instant("SERVICE_DETAIL.DESTINATIONS.ALLOW_SUCCESS")),this.refreshTable()},error:()=>this.loading=!1})}static{this.\u0275fac=function(n){return new(n||t)(m(_t),m(j),m(qt),m($),m(re),m(ke))}}static{this.\u0275cmp=D({type:t,selectors:[["app-service-destinations"]],decls:13,vars:9,consts:[["spinner",""],[1,"page-subtitle"],[3,"refresh"],["color","warn","mat-flat-button","",1,"me-2",3,"disabled"],["color","accent","mat-flat-button","",1,"me-2",3,"disabled"],[3,"filter","placeholder"],[1,"position-relative","table-min-height"],[3,"loading","destinations","filterValue","selection","cachedSubject","displayColumns","tableId",4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],["color","warn","mat-flat-button","",1,"me-2",3,"click","disabled"],["color","accent","mat-flat-button","",1,"me-2",3,"click","disabled"],[3,"loading","destinations","filterValue","selection","cachedSubject","displayColumns","tableId"]],template:function(n,i){if(n&1){let s=T();r(0,"div")(1,"h1",1),d(2),l(3,"translate"),a(),r(4,"perun-web-apps-refresh-button",2),C("refresh",function(){return h(s),g(i.refreshTable())}),a(),E(5,ll,3,4,"button",3),E(6,pl,3,4,"button",4),E(7,cl,3,4,"button",3),r(8,"perun-web-apps-debounce-filter",5),C("filter",function(w){return h(s),g(i.applyFilter(w))}),a(),S(9,dl,1,0,"ng-template",null,0,B),r(11,"div",6),S(12,ml,1,8,"app-perun-web-apps-destination-list",7),a()()}if(n&2){let s=R(10);o(2),A(p(3,7,"SERVICE_DETAIL.DESTINATIONS.TITLE")),o(3),I(i.authResolver.isPerunAdmin()?5:-1),o(),I(i.authResolver.isPerunAdmin()?6:-1),o(),I(i.authResolver.isPerunAdmin()?7:-1),o(),u("placeholder","SERVICE_DETAIL.DESTINATIONS.FILTER"),o(4),u("perunWebAppsLoader",i.loading)("perunWebAppsLoaderIndicator",s)}},dependencies:[x,L,O,de,ce,M,zo,N,H,y],encapsulation:2})}}return t})();var Aa=(t,c)=>["/organizations",t,"members",c],ul=()=>["id","recent","name","description","expiration","groupStatus"];function _l(t,c){t&1&&b(0,"perun-web-apps-loading-table")}function fl(t,c){if(t&1){let e=T();r(0,"perun-web-apps-vo-search-select",7),C("voSelected",function(i){h(e);let s=_(2);return g(s.loadMember(i))}),a()}if(t&2){let e=_(2);u("vos",e.vos)}}function hl(t,c){t&1&&(d(0),l(1,"translate")),t&2&&f(" ",p(1,1,"USER_DETAIL.ACCOUNTS.STATUS")," ")}function gl(t,c){t&1&&b(0,"mat-spinner",10)}function Cl(t,c){if(t&1){let e=T();r(0,"div")(1,"div",11)(2,"span",12),d(3),l(4,"translate"),a(),r(5,"a",13),C("auxclick",function(i){return h(e),g(i.preventDefault())}),d(6),a()(),r(7,"mat-card",14),b(8,"perun-web-apps-member-overview-membership",15),a(),r(9,"p",16),d(10),l(11,"translate"),a(),r(12,"perun-web-apps-groups-list",17),C("refreshTable",function(){h(e);let i=_(4);return g(i.loadMember(i.selectedVo))}),a()()}if(t&2){let e=_(4);o(3),f("",p(4,12,"USER_DETAIL.ACCOUNTS.MEMBER"),":"),o(2),u("perunWebAppsMiddleClickRouterLink",sn(16,Aa,e.selectedVo.id.toString(),e.member.id.toString()))("routerLink",sn(19,Aa,e.selectedVo.id,e.member.id)),o(),f("",e.member.id," "),o(2),u("member",e.member)("voId",e.selectedVo.id),o(2),A(p(11,14,"USER_DETAIL.ACCOUNTS.GROUPS")),o(2),u("loading",e.loading)("groups",e.groups)("memberId",e.member==null?null:e.member.id)("memberGroupStatus",e.member.groupStatus)("displayColumns",he(22,ul))}}function bl(t,c){if(t&1&&(E(0,gl,1,0,"mat-spinner",10),E(1,Cl,13,23,"div")),t&2){let e=_(3);I(e.loading?0:-1),o(),I(e.loading?-1:1)}}function Sl(t,c){t&1&&(d(0),l(1,"translate")),t&2&&f(" ",p(1,1,"USER_DETAIL.ACCOUNTS.MEMBER_ATT")," ")}function vl(t,c){t&1&&b(0,"mat-spinner",10)}function Tl(t,c){if(t&1&&b(0,"app-one-entity-attribute-page",18),t&2){let e=_(5);u("entity","member")("entityId",e.member.id)}}function El(t,c){if(t&1&&(E(0,vl,1,0,"mat-spinner",10),E(1,Tl,1,2,"app-one-entity-attribute-page",18)),t&2){let e=_(4);I(e.loading?0:-1),o(),I(e.loading?-1:1)}}function Il(t,c){t&1&&(r(0,"mat-tab"),S(1,Sl,2,3,"ng-template",8)(2,El,2,2,"ng-template",9),a())}function Al(t,c){t&1&&(d(0),l(1,"translate")),t&2&&f(" ",p(1,1,"USER_DETAIL.ACCOUNTS.MEMBER_GROUP_ATT")," ")}function Dl(t,c){t&1&&b(0,"mat-spinner",10)}function xl(t,c){if(t&1&&b(0,"app-two-entity-attribute-page",19),t&2){let e=_(5);u("firstEntity","member")("firstEntityId",e.member.id)("secondEntity","group")}}function Ml(t,c){if(t&1&&(E(0,Dl,1,0,"mat-spinner",10),E(1,xl,1,3,"app-two-entity-attribute-page",19)),t&2){let e=_(4);I(e.loading?0:-1),o(),I(e.loading?-1:1)}}function yl(t,c){t&1&&(r(0,"mat-tab"),S(1,Al,2,3,"ng-template",8)(2,Ml,2,2,"ng-template",9),a())}function wl(t,c){t&1&&(d(0),l(1,"translate")),t&2&&f(" ",p(1,1,"USER_DETAIL.ACCOUNTS.MEMBER_RESOURCE_ATT")," ")}function Rl(t,c){t&1&&b(0,"mat-spinner",10)}function Ll(t,c){if(t&1&&b(0,"app-two-entity-attribute-page",19),t&2){let e=_(4);u("firstEntity","member")("firstEntityId",e.member.id)("secondEntity","resource")}}function Bl(t,c){if(t&1&&(E(0,Rl,1,0,"mat-spinner",10),E(1,Ll,1,3,"app-two-entity-attribute-page",19)),t&2){let e=_(3);I(e.loading?0:-1),o(),I(e.loading?-1:1)}}function Ol(t,c){if(t&1&&(r(0,"mat-tab-group",5)(1,"mat-tab"),S(2,hl,2,3,"ng-template",8)(3,bl,2,2,"ng-template",9),a(),S(4,Il,3,0,"mat-tab",2)(5,yl,3,0,"mat-tab",2),r(6,"mat-tab"),S(7,wl,2,3,"ng-template",8)(8,Bl,2,2,"ng-template",9),a()()),t&2){let e=_(2),n=R(4);o(4),u("perunWebAppsLoader",e.loading)("perunWebAppsLoaderIndicator",n),o(),u("perunWebAppsLoader",e.loading)("perunWebAppsLoaderIndicator",n)}}function Nl(t,c){t&1&&(r(0,"perun-web-apps-alert",6),d(1),l(2,"translate"),a()),t&2&&(o(),A(p(2,1,"USER_DETAIL.ACCOUNTS.NO_VOS")))}function Ul(t,c){if(t&1&&(r(0,"div")(1,"div",3),E(2,fl,1,1,"perun-web-apps-vo-search-select",4),a(),E(3,Ol,9,4,"mat-tab-group",5),E(4,Nl,3,3,"perun-web-apps-alert",6),a()),t&2){let e=_();o(2),I(e.initLoading||e.vos.length===0?-1:2),o(),I(e.initLoading||e.vos.length===0?-1:3),o(),I(!e.initLoading&&e.vos.length===0?4:-1)}}var Da=(()=>{class t{constructor(e,n,i,s){this.route=e,this.usersService=n,this.membersService=i,this.groupService=s,this.initLoading=!1,this.loading=!1,this.vos=[],this.selectedVo=null,this.member=null,this.groups=[]}ngOnInit(){this.initLoading=!0,this.route.parent.params.subscribe(e=>{this.userId=Number(e.userId),this.usersService.getVosWhereUserIsMember(this.userId).subscribe({next:n=>{this.vos=n,this.vos.length&&this.loadMember(this.vos.sort(Wi)[0]),this.initLoading=!1},error:()=>this.initLoading=!1})})}loadMember(e){this.loading=!0,this.selectedVo=e,this.membersService.getMemberByUser(this.selectedVo.id,this.userId).subscribe({next:n=>{this.membersService.getRichMemberWithAttributes(n.id).subscribe({next:i=>{this.member=i,this.groupService.getMemberRichGroupsWithAttributesByNames(this.member.id,[ln.MEMBER_DEF_GROUP_EXPIRATION,ln.MEMBER_GROUP_STATUS]).subscribe({next:s=>{this.groups=s,this.loading=!1},error:()=>this.loading=!1})},error:()=>this.loading=!1})},error:()=>this.loading=!1})}static{this.\u0275fac=function(n){return new(n||t)(m(me),m(le),m(Ln),m(Pi))}}static{this.\u0275cmp=D({type:t,selectors:[["app-perun-web-apps-user-accounts"]],decls:6,vars:5,consts:[["spinner1",""],[1,"page-title"],[4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],[1,"d-flex"],[1,"w-50",3,"vos"],["mat-stretch-tabs","false"],["alert_type","warn"],[1,"w-50",3,"voSelected","vos"],["matTabLabel",""],["matTabContent",""],[1,"ms-auto","me-auto"],[1,"mt-4","mb-4"],[1,"subtitle","me-2"],[1,"member-link",3,"auxclick","perunWebAppsMiddleClickRouterLink","routerLink"],["appearance","outlined",1,"mat-elevation-z3","membership-card"],[3,"member","voId"],[1,"mt-4","subtitle"],[3,"refreshTable","loading","groups","memberId","memberGroupStatus","displayColumns"],[3,"entity","entityId"],[3,"firstEntity","firstEntityId","secondEntity"]],template:function(n,i){if(n&1&&(r(0,"h1",1),d(1),l(2,"translate"),a(),S(3,_l,1,0,"ng-template",null,0,B)(5,Ul,5,3,"div",2)),n&2){let s=R(4);o(),A(p(2,3,"USER_DETAIL.ACCOUNTS.TITLE")),o(4),u("perunWebAppsLoader",i.initLoading)("perunWebAppsLoaderIndicator",s)}},dependencies:[x,X,Q,Ui,en,li,nt,Ze,et,tt,it,Wt,Ht,Hi,Un,mt,dt,M,fo,vo,bo,N,H,y],styles:[".subtitle[_ngcontent-%COMP%]{font-size:1.2rem}.membership-card[_ngcontent-%COMP%]{max-width:400px}"]})}}return t})();var rn=(()=>{class t{transform(e){if(e)return e.split(".").pop()}static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275pipe=vt({name:"parseEventName",type:t,pure:!0})}}return t})();function Vl(t,c){t&1&&(d(0),l(1,"translate")),t&2&&f(" ",p(1,1,"DIALOGS.AUDIT_MESSAGE_DETAIL.OBJECTS")," ")}function kl(t,c){if(t&1&&b(0,"pre",10),t&2){let e=_();u("innerHTML",e.syntaxHighlight(e.eventData),bn)}}function Pl(t,c){t&1&&(d(0),l(1,"translate")),t&2&&f(" ",p(1,1,"DIALOGS.AUDIT_MESSAGE_DETAIL.MESSAGE")," ")}function Fl(t,c){if(t&1&&(r(0,"div",11),d(1),a()),t&2){let e=_();o(),A(e.message)}}var xa=(()=>{class t{constructor(e,n,i){this.dialogRef=e,this.data=n,this.clipboard=i,this.tabIndex=0,this.eventData={}}ngOnInit(){let e=this.data.message.event;this.actor=this.data.message.actor,this.createdAt=this.data.message.createdAt,e.message&&(this.message=e.message,delete e.message),e.name&&(this.title=e.name,delete e.name),this.eventData=e}tabChanged(e){this.tabIndex=e.index}copyObjects(){this.clipboard.copy(JSON.stringify(this.eventData,null,2))}copyMessage(){this.clipboard.copy(this.message)}syntaxHighlight(e){return typeof e!="string"&&(e=JSON.stringify(e,void 0,2)),e=e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),e.replace(/("(\\u[a-zA-Z0-9]{4}|\\[^u]|[^\\"])*"(\s*:)?|\b(true|false|null)\b|-?\d+(?:\.\d*)?(?:[eE][+-]?\d+)?)/g,function(n){let i="number";return n.startsWith('"')?n.endsWith(":")?i="key":i="string":/true|false/.test(n)?i="boolean":n.includes("null")&&(i="null"),'<span class="'+i+'">'+n+"</span>"})}onClose(){this.dialogRef.close()}static{this.\u0275fac=function(n){return new(n||t)(m(J),m(pe),m($i))}}static{this.\u0275cmp=D({type:t,selectors:[["app-audit-message-detail-dialog"]],decls:26,vars:19,consts:[[1,"admin-theme"],["mat-dialog-title",""],["mat-dialog-content",""],["mat-stretch-tabs","false",3,"selectedTabChange"],["matTabLabel",""],["matTabContent",""],["mat-dialog-actions",""],["mat-stroked-button","",1,"ms-auto",3,"click"],["mat-button","",3,"click"],["iconPositionEnd",""],[3,"innerHTML"],["data-cy","audit-message-text"]],template:function(n,i){n&1&&(r(0,"div",0)(1,"h1",1),d(2),l(3,"parseEventName"),l(4,"translate"),a(),r(5,"div",2)(6,"div"),d(7),l(8,"translate"),l(9,"translate"),a(),r(10,"mat-tab-group",3),C("selectedTabChange",function(v){return i.tabChanged(v)}),r(11,"mat-tab"),S(12,Vl,2,3,"ng-template",4)(13,kl,1,1,"ng-template",5),a(),r(14,"mat-tab"),S(15,Pl,2,3,"ng-template",4)(16,Fl,2,1,"ng-template",5),a()()(),r(17,"div",6)(18,"button",7),C("click",function(){return i.onClose()}),d(19),l(20,"translate"),a(),r(21,"button",8),C("click",function(){return i.tabIndex===0?i.copyObjects():i.copyMessage()}),d(22),l(23,"translate"),r(24,"mat-icon",9),d(25,"content_copy"),a()()()()),n&2&&(o(2),f(" ",p(4,9,p(3,7,i.title)??"DIALOGS.AUDIT_MESSAGE_DETAIL.TITLE")," "),o(5),vn(" ",p(8,11,"DIALOGS.AUDIT_MESSAGE_DETAIL.ACTOR"),": ",i.actor,", ",p(9,13,"DIALOGS.AUDIT_MESSAGE_DETAIL.CREATED_AT"),": ",i.createdAt," "),o(12),f(" ",p(20,15,"DIALOGS.AUDIT_MESSAGE_DETAIL.CLOSE")," "),o(3),f(" ",p(23,17,"DIALOGS.AUDIT_MESSAGE_DETAIL.COPY")," "))},dependencies:[x,L,O,Qe,ut,ie,Z,te,ee,nt,Ze,et,tt,it,M,y,rn],styles:[`.key{color:brown}.string{color:green}.number{color:#ff8c00}.boolean{color:#00f}.null{color:#f0f}
`],encapsulation:2})}}return t})();function Gl(t,c){t&1&&(r(0,"th",15),d(1),l(2,"translate"),a()),t&2&&(o(),f(" ",p(2,1,"AUDIT_MESSAGES_LIST.ID")," "))}function jl(t,c){if(t&1&&(r(0,"td",16),d(1),a()),t&2){let e=c.$implicit;o(),f(" ",e.id," ")}}function Hl(t,c){t&1&&(r(0,"th",15),d(1),l(2,"translate"),a()),t&2&&(o(),f(" ",p(2,1,"AUDIT_MESSAGES_LIST.TIMESTAMP")," "))}function Wl(t,c){if(t&1&&(r(0,"td",16),d(1),l(2,"parseDate"),a()),t&2){let e=c.$implicit;o(),f(" ",je(2,1,e.createdAt,!0)," ")}}function ql(t,c){t&1&&(r(0,"th",17),d(1),l(2,"translate"),a()),t&2&&(o(),A(p(2,1,"AUDIT_MESSAGES_LIST.EVENT_NAME")))}function zl(t,c){if(t&1&&(r(0,"td",16),d(1),l(2,"parseEventName"),a()),t&2){let e=c.$implicit;o(),f(" ",p(2,1,e.event.name)," ")}}function $l(t,c){t&1&&(r(0,"th",17),d(1),l(2,"translate"),a()),t&2&&(o(),A(p(2,1,"AUDIT_MESSAGES_LIST.ACTOR")))}function Kl(t,c){if(t&1&&(r(0,"td",16),d(1),a()),t&2){let e=c.$implicit;o(),f(" ",e.actor," ")}}function Yl(t,c){t&1&&(r(0,"th",17),d(1),l(2,"translate"),a()),t&2&&(o(),A(p(2,1,"AUDIT_MESSAGES_LIST.MESSAGE")))}function Ql(t,c){if(t&1&&(r(0,"td",16),d(1),a()),t&2){let e=c.$implicit;o(),f(" ",e.event.message," ")}}function Xl(t,c){t&1&&b(0,"th",17)}function Jl(t,c){if(t&1){let e=T();r(0,"td",16)(1,"button",18),C("click",function(){let i=h(e).$implicit,s=_();return g(s.viewDetails(i))}),d(2),l(3,"translate"),a()()}t&2&&(o(2),f(" ",p(3,1,"AUDIT_MESSAGES_LIST.VIEW_DETAIL")," "))}function Zl(t,c){t&1&&b(0,"tr",19)}function ep(t,c){t&1&&b(0,"tr",20)}function tp(t,c){if(t&1&&(r(0,"perun-web-apps-alert",14),d(1),l(2,"translate"),a()),t&2){let e=_();o(),f(" ",p(2,1,e.noMessagesAlert)," ")}}var Ma=(()=>{class t{constructor(e,n,i){this.dialog=e,this.tableConfigService=n,this.destroyRef=i,this.noMessagesAlert="SHARED_LIB.UI.ALERTS.NO_AUDIT_MESSAGES",this.loading$=new Tt,this.queryChanged=new Tt,this.downloadAll=new Tt,this.pageSizeOptions=Mt,this.displayedColumns=["id","timestamp","name","actor","event.message","detail"],this.unfilteredColumns=this.displayedColumns}set auditMessages(e){this.dataSource||this.dataSourceInit(e);let n=this.isPaginated(e);ui(this.dataSource)&&n?(this.dataSource.data=e.data,this.dataSource.count=e.totalCount):!ui(this.dataSource)&&!n&&(this.dataSource.data=e)}set displayColumns(e){this.unfilteredColumns=e,localStorage.getItem("showIds")!=="true"&&(e=e.filter(n=>n!=="id")),this.displayedColumns=e}static getExportDataForColumn(e,n){switch(n){case"id":return e.id.toString();case"timestamp":return Tn(e.createdAt,"d.M.y H.mm.ss","en");case"name":return e.event.name.split(".").pop();case"actor":return e.actor;case"event.message":return e.event.message;default:return""}}ngOnInit(){this.resetPagination?.subscribe(e=>{e&&this.tableWrapper.paginator.firstPage()}),this.watchForIdColumnChanges()}viewDetails(e){let n=V(),i=JSON.parse(JSON.stringify(e));n.minWidth="700px",n.maxWidth="1000px",n.data={message:i},this.dialog.open(xa,n)}exportDisplayedData(e){if(ui(this.dataSource))st(Fe(this.dataSource.data,this.displayedColumns,t.getExportDataForColumn),e);else{let n=this.dataSource.paginator.pageIndex*this.dataSource.paginator.pageSize,i=n+this.dataSource.paginator.pageSize;st(Fe(this.dataSource.sortData(this.dataSource.filteredData,this.dataSource.sort).slice(n,i),this.displayedColumns,t.getExportDataForColumn),e)}}isPaginated(e){return"data"in e}dataSourceInit(e){let n=this.isPaginated(e);this.dataSource=n?new Nn(e.data,e.totalCount,this.sort,this.tableWrapper.paginator):new Ae(e),ui(this.dataSource)?this.dataSource.pageQuery$.subscribe(i=>this.queryChanged.emit(i)):(this.dataSource.sort=this.sort,this.dataSource.paginator=this.tableWrapper.paginator,this.dataSource.filterPredicate=(i,s)=>Qt(i,s,this.displayedColumns,t.getExportDataForColumn,!0),this.dataSource.sortData=(i,s)=>Yt(i,s,t.getExportDataForColumn))}watchForIdColumnChanges(){this.tableConfigService.showIdsChanged.pipe(yt(this.destroyRef)).subscribe(e=>{e?this.displayedColumns=this.unfilteredColumns:this.displayedColumns=this.unfilteredColumns.filter(n=>n!=="id")}),localStorage.getItem("showIds")!=="true"&&(this.displayedColumns=this.displayedColumns.filter(e=>e!=="id"))}static{this.\u0275fac=function(n){return new(n||t)(m($),m(ii),m(Nt))}}static{this.\u0275cmp=D({type:t,selectors:[["app-audit-messages-list"]],viewQuery:function(n,i){if(n&1&&(ve(ot,7),ve(be,7)),n&2){let s;Te(s=Ee())&&(i.tableWrapper=s.first),Te(s=Ee())&&(i.sort=s.first)}},inputs:{tableId:"tableId",refresh:"refresh",loading:"loading",noMessagesAlert:"noMessagesAlert",resetPagination:"resetPagination",pageSizeOptions:"pageSizeOptions",auditMessages:"auditMessages",displayColumns:"displayColumns"},outputs:{loading$:"loading$",queryChanged:"queryChanged",downloadAll:"downloadAll"},features:[Et([{provide:Mn,useClass:Yn}])],decls:24,vars:8,consts:[[1,"card","mt-2",3,"hidden"],[3,"exportDisplayedData","dataLength","pageSizeOptions","tableId"],["mat-table","","matSort","","matSortActive","id","matSortDirection","desc","matSortDisableClear","",1,"w-100",3,"dataSource"],["matColumnDef","id"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["class","static-column-size","mat-cell","",4,"matCellDef"],["matColumnDef","timestamp"],["matColumnDef","name"],["mat-header-cell","",4,"matHeaderCellDef"],["matColumnDef","actor"],["matColumnDef","event.message"],["matColumnDef","detail"],["mat-header-row","",4,"matHeaderRowDef"],["class","dark-hover-list-item","mat-row","",4,"matRowDef","matRowDefColumns"],["alert_type","warn"],["mat-header-cell","","mat-sort-header",""],["mat-cell","",1,"static-column-size"],["mat-header-cell",""],["data-cy","audit-message-detail-button","color","accent","mat-flat-button","",3,"click"],["mat-header-row",""],["mat-row","",1,"dark-hover-list-item"]],template:function(n,i){n&1&&(r(0,"div",0)(1,"perun-web-apps-table-wrapper",1),C("exportDisplayedData",function(v){return i.exportDisplayedData(v)}),r(2,"table",2),k(3,3),S(4,Gl,3,3,"th",4)(5,jl,2,1,"td",5),P(),k(6,6),S(7,Hl,3,3,"th",4)(8,Wl,3,4,"td",5),P(),k(9,7),S(10,ql,3,3,"th",8)(11,zl,3,3,"td",5),P(),k(12,9),S(13,$l,3,3,"th",8)(14,Kl,2,1,"td",5),P(),k(15,10),S(16,Yl,3,3,"th",8)(17,Ql,2,1,"td",5),P(),k(18,11),S(19,Xl,1,0,"th",8)(20,Jl,4,3,"td",5),P(),S(21,Zl,1,0,"tr",12)(22,ep,1,0,"tr",13),a()()(),E(23,tp,3,3,"perun-web-apps-alert",14)),n&2&&(u("hidden",i.dataSource.filteredData.length===0),o(),u("dataLength",i.dataSource.count??i.dataSource.filteredData.length)("pageSizeOptions",i.pageSizeOptions)("tableId",i.tableId),o(),u("dataSource",i.dataSource),o(19),u("matHeaderRowDef",i.displayedColumns),o(),u("matRowDefColumns",i.displayedColumns),o(),I(!i.loading&&i.dataSource.filteredData.length===0?23:-1))},dependencies:[x,L,O,X,Q,ot,Ce,xe,ye,Be,we,Me,Oe,Re,Le,Ne,Ue,At,be,It,M,Xn,y,rn],encapsulation:2})}}return t})();function ip(t,c){t&1&&b(0,"perun-web-apps-loading-table")}function np(t,c){if(t&1){let e=T();r(0,"app-audit-messages-list",7),l(1,"async"),l(2,"async"),C("queryChanged",function(i){h(e);let s=_();return g(s.nextPage.next(i))}),a()}if(t&2){let e=_();u("loading",p(1,5,e.loading$))("resetPagination",e.resetPagination)("displayColumns",e.displayedColumns)("auditMessages",p(2,7,e.messagesPage$))("tableId",e.tableId)}}var ya=(()=>{class t{constructor(e){this.auditMessagesManagerService=e,this.tableId=so,this.displayedColumns=["id","timestamp","name","actor","event.message","detail"],this.selectedEvents=[],this.eventOptions=[],this.eventOptionsForSearchSelect=[],this.nextPage=new G({}),this.resetPagination=new G(!1),this.messagesPage$=this.nextPage.pipe(se(n=>this.auditMessagesManagerService.getMessagesPage({query:{offset:n.offset,pageSize:n.pageSize,order:n.order,selectedEvents:this.selectedEvents}})),Ot(n=>{this.auditMessages=n.data,setTimeout(()=>this.loadingSubject$.next(!1),200)}),at({data:[],totalCount:0,offset:0,pageSize:0})),this.loadingSubject$=new G(!1),this.loading$=Bt(this.loadingSubject$,this.nextPage.pipe(ht(()=>!0)))}ngOnInit(){this.auditMessagesManagerService.findAllPossibleEvents().subscribe(e=>{this.eventOptions=e.sort(),this.eventOptionsForSearchSelect=this.eventOptions})}refreshTable(){this.resetPagination.next(!0),this.nextPage.next(this.nextPage.value)}toggleEvent(e){this.selectedEvents.splice(0,this.selectedEvents.length,...e)}refreshOnClosed(){this.selectedEvents=[...this.selectedEvents];let e=this.eventOptions.filter(n=>!this.selectedEvents.includes(n));this.eventOptionsForSearchSelect=[...this.selectedEvents,...e],this.refreshTable()}static{this.\u0275fac=function(n){return new(n||t)(m(wn))}}static{this.\u0275cmp=D({type:t,selectors:[["app-admin-audit-log"]],decls:11,vars:9,consts:[["spinner",""],[1,"page-subtitle"],[1,"align-elements"],[3,"refresh"],[3,"auditLogsSelected","selectClosed","disableDeselectButton","auditLogs"],[1,"position-relative","w-100","table-min-height"],[3,"loading","resetPagination","displayColumns","auditMessages","tableId","queryChanged",4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],[3,"queryChanged","loading","resetPagination","displayColumns","auditMessages","tableId"]],template:function(n,i){if(n&1){let s=T();r(0,"h1",1),d(1),l(2,"translate"),a(),r(3,"div",2)(4,"perun-web-apps-refresh-button",3),C("refresh",function(){return h(s),g(i.refreshTable())}),a(),r(5,"perun-web-apps-audit-log-search-select",4),C("auditLogsSelected",function(w){return h(s),g(i.toggleEvent(w))})("selectClosed",function(){return h(s),g(i.refreshOnClosed())}),a(),S(6,ip,1,0,"ng-template",null,0,B),r(8,"div",5),S(9,np,3,9,"app-audit-messages-list",6),l(10,"async"),a()()}if(n&2){let s=R(7);o(),A(p(2,5,"ADMIN.AUDIT_LOG.TITLE")),o(4),u("disableDeselectButton",!1)("auditLogs",i.eventOptionsForSearchSelect),o(4),u("perunWebAppsLoader",p(10,7,i.loading$))("perunWebAppsLoaderIndicator",s)}},dependencies:[x,ce,M,xo,H,Ma,N,He,y],encapsulation:2})}}return t})();var wa=(()=>{class t{constructor(e,n){this.dialogRef=e,this.data=n}onCancel(){this.dialogRef.close(!1)}onSubmit(){this.dialogRef.close(!0)}static{this.\u0275fac=function(n){return new(n||t)(m(J),m(pe))}}static{this.\u0275cmp=D({type:t,selectors:[["app-perun-web-apps-edit-enforce-consents-dialog"]],decls:26,vars:26,consts:[["mat-dialog-title",""],["mat-dialog-content",""],[1,"mt-2","mb-2"],["alert_type","warn"],["mat-dialog-actions",""],["mat-stroked-button","",1,"ms-auto",3,"click"],["mat-flat-button","","color","accent",1,"ms-2",3,"click"]],template:function(n,i){n&1&&(r(0,"div")(1,"h1",0),d(2),l(3,"translate"),l(4,"translate"),a(),r(5,"div",1)(6,"p"),d(7),l(8,"translate"),l(9,"translate"),a(),b(10,"mat-divider"),r(11,"p",2),d(12),a(),b(13,"mat-divider"),r(14,"perun-web-apps-alert",3),d(15),l(16,"translate"),l(17,"translate"),a()(),r(18,"div",4)(19,"button",5),C("click",function(){return i.onCancel()}),d(20),l(21,"translate"),a(),r(22,"button",6),C("click",function(){return i.onSubmit()}),d(23),l(24,"translate"),l(25,"translate"),a()()()),n&2&&(Pe(i.data.theme),o(2),f(" ",i.data.enforceConsents?p(3,8,"DIALOGS.EDIT_ENFORCE_CONSENTS_FLAG.DISABLE_TITLE"):p(4,10,"DIALOGS.EDIT_ENFORCE_CONSENTS_FLAG.ENFORCE_TITLE")," "),o(5),f(" ",i.data.enforceConsents?p(8,12,"DIALOGS.EDIT_ENFORCE_CONSENTS_FLAG.DISABLE_DESCRIPTION"):p(9,14,"DIALOGS.EDIT_ENFORCE_CONSENTS_FLAG.ENFORCE_DESCRIPTION")," "),o(5),A(i.data.consentHubName),o(3),f(" ",i.data.enforceConsents?p(16,16,"DIALOGS.EDIT_ENFORCE_CONSENTS_FLAG.DISABLE_BOLD_DESCRIPTION"):p(17,18,"DIALOGS.EDIT_ENFORCE_CONSENTS_FLAG.ENFORCE_BOLD_DESCRIPTION")," "),o(5),f(" ",p(21,20,"DIALOGS.EDIT_ENFORCE_CONSENTS_FLAG.CANCEL_BUTTON")," "),o(3),f(" ",i.data.enforceConsents?p(24,22,"DIALOGS.EDIT_ENFORCE_CONSENTS_FLAG.DISABLE_BUTTON"):p(25,24,"DIALOGS.EDIT_ENFORCE_CONSENTS_FLAG.ENFORCE_BUTTON")," "))},dependencies:[x,L,O,ie,Z,te,ee,X,Q,Vn,M,y],encapsulation:2})}}return t})();var op=t=>({all:t}),ap=t=>({name:t}),rp=(t,c)=>c.id;function sp(t,c){if(t&1){let e=T();r(0,"th",16)(1,"mat-checkbox",17),l(2,"masterCheckboxLabel"),l(3,"translate"),C("change",function(i){h(e);let s=_(2);return g(i?s.masterToggle():null)}),a()()}if(t&2){let e=_(),n=_();o(),u("aria-label",p(3,5,p(2,3,e.all)))("checked",n.selection.hasValue()&&e.all)("indeterminate",n.selection.hasValue()&&!e.all)}}function lp(t,c){if(t&1){let e=T();r(0,"td",18)(1,"mat-checkbox",19),l(2,"checkboxLabel"),l(3,"translate"),C("change",function(i){let s=h(e).$implicit,v=_(2);return g(i?v.toggleRow(s):null)})("click",function(i){return h(e),g(i.stopPropagation())}),a()()}if(t&2){let e=c.$implicit,n=_(2);o(),u("aria-label",je(3,4,p(2,2,n.selection.isSelected(e)),De(7,ap,e.name)))("checked",n.selection.isSelected(e))}}function pp(t,c){t&1&&(k(0,3),S(1,sp,4,7,"th",14)(2,lp,4,9,"td",15),P())}function cp(t,c){t&1&&(r(0,"th",20),d(1),l(2,"translate"),a()),t&2&&(o(),f(" ",p(2,1,"SHARED.COMPONENTS.CONSENT_HUBS_LIST.ID")," "))}function dp(t,c){if(t&1&&(r(0,"td",21),d(1),a()),t&2){let e=c.$implicit;o(),A(e.id)}}function mp(t,c){t&1&&(r(0,"th",20),d(1),l(2,"translate"),a()),t&2&&(o(),f(" ",p(2,1,"SHARED.COMPONENTS.CONSENT_HUBS_LIST.NAME")," "))}function up(t,c){if(t&1&&(r(0,"td",22),l(1,"multiWordDataCy"),d(2),a()),t&2){let e=c.$implicit;mi("data-cy",Ie("",p(1,3,e.name),"-name-td")),o(2),f(" ",e.name," ")}}function _p(t,c){t&1&&(r(0,"th",20),d(1),l(2,"translate"),a()),t&2&&(o(),f(" ",p(2,1,"SHARED.COMPONENTS.CONSENT_HUBS_LIST.ENFORCE_CONSENTS")," "))}function fp(t,c){if(t&1){let e=T();r(0,"td",22)(1,"mat-slide-toggle",23),C("change",function(i){let s=h(e).$implicit,v=_();return g(v.changeEnforceFlag(s,i))}),a()()}if(t&2){let e=c.$implicit;o(),u("checked",e.enforceConsents)}}function hp(t,c){t&1&&(r(0,"th",20),d(1),l(2,"translate"),a()),t&2&&(o(),f(" ",p(2,1,"SHARED.COMPONENTS.CONSENT_HUBS_LIST.FACILITIES")," "))}function gp(t,c){if(t&1&&(r(0,"span"),d(1),r(2,"span",24),d(3),a(),b(4,"br"),a()),t&2){let e=c.$implicit;o(),f(" ",e.name," "),o(2),f(" #",e.id)}}function Cp(t,c){if(t&1&&(r(0,"td",22),Ut(1,gp,5,2,"span",null,rp),a()),t&2){let e=c.$implicit;o(),Vt(e.facilities)}}function bp(t,c){t&1&&b(0,"tr",25)}function Sp(t,c){t&1&&b(0,"tr",26)}function vp(t,c){t&1&&(r(0,"perun-web-apps-alert",13),d(1),l(2,"translate"),a()),t&2&&(o(),f(" ",p(2,1,"SHARED.COMPONENTS.CONSENT_HUBS_LIST.NO_CONSENT_HUBS")," "))}function Tp(t,c){t&1&&(r(0,"perun-web-apps-alert",13),d(1),l(2,"translate"),a()),t&2&&(o(),f(" ",p(2,1,"SHARED.COMPONENTS.CONSENT_HUBS_LIST.NO_FILTER_RESULTS")," "))}var Ra=(()=>{class t{constructor(e,n,i,s,v,w,q){this.tableCheckbox=e,this.dialog=n,this.notificator=i,this.translate=s,this.consentsManager=v,this.tableConfigService=w,this.destroyRef=q,this.filterValue="",this.selection=new K(!0,[]),this.exporting=!1,this.pageSizeOptions=Mt,this.displayedColumns=["select","id","name","enforceConsents","facilities"],this.unfilteredColumns=this.displayedColumns}set displayColumns(e){this.unfilteredColumns=e,localStorage.getItem("showIds")!=="true"&&(e=e.filter(n=>n!=="id")),this.displayedColumns=e}set matSort(e){this.sort=e,this.setDataSource()}static getDataForColumn(e,n){switch(n){case"id":return e.id.toString();case"name":return e.name;case"enforceConsents":return e.enforceConsents?"true":"false";case"facilities":{let i="";return e.facilities.forEach(s=>i+=s.name+" #"+String(s.id)+";"),i.slice(0,-1)}default:return""}}ngOnInit(){this.selection&&(this.cachedSelection=new K(this.selection.isMultipleSelection(),[],!0,this.selection.compareWith),this.cachedSubject?.pipe(yt(this.destroyRef)).subscribe(e=>{e&&this.cachedSelection.clear()})),this.watchForIdColumnChanges()}ngOnChanges(){this.dataSource=new Ae(this.consentHubs),this.setDataSource()}exportAllData(e){st(Fe(this.dataSource.filteredData,this.displayedColumns,t.getDataForColumn),e)}exportDisplayedData(e){let n=this.dataSource.paginator.pageIndex*this.dataSource.paginator.pageSize,i=n+this.dataSource.paginator.pageSize;st(Fe(this.dataSource.sortData(this.dataSource.filteredData,this.dataSource.sort).slice(n,i),this.displayedColumns,t.getDataForColumn),e)}isAllSelected(){return this.tableCheckbox.isAllSelected(this.selection.selected.length,this.dataSource)}masterToggle(){this.tableCheckbox.masterToggle(this.isAllSelected(),this.selection,this.cachedSelection,this.filterValue,this.dataSource,this.sort,this.child.paginator.pageSize,this.child.paginator.pageIndex,!1)}setDataSource(){this.dataSource&&(this.dataSource.filterPredicate=(e,n)=>Qt(e,n,this.displayedColumns,t.getDataForColumn),this.dataSource.sortData=(e,n)=>Yt(e,n,t.getDataForColumn),this.dataSource.sort=this.sort,this.dataSource.paginator=this.child.paginator,this.dataSource.filter=this.filterValue)}toggleRow(e){this.selection.toggle(e),this.cachedSelection.toggle(e)}pageChanged(){this.cachedSelection&&this.tableCheckbox.selectCachedDataOnPage(this.dataSource,this.selection,this.cachedSelection,this.selection.compareWith)}changeEnforceFlag(e,n){n.source.checked=e.enforceConsents;let i=V();i.width="550px",i.data={theme:"admin-theme",enforceConsents:e.enforceConsents,consentHubName:e.name},this.dialog.open(wa,i).afterClosed().subscribe(v=>{v&&(e.enforceConsents=!e.enforceConsents,this.consentsManager.updateConsentHub({consentHub:e}).subscribe(w=>{n.source.checked=w.enforceConsents,e.enforceConsents=w.enforceConsents,this.translate.get("SHARED.COMPONENTS.CONSENT_HUBS_LIST.CHANGE_ENFORCE_CONSENTS_SUCCESS").subscribe(q=>{this.notificator.showSuccess(q)})},()=>e.enforceConsents=!e.enforceConsents))})}watchForIdColumnChanges(){this.tableConfigService.showIdsChanged.pipe(yt(this.destroyRef)).subscribe(e=>{e?this.displayedColumns=this.unfilteredColumns:this.displayedColumns=this.unfilteredColumns.filter(n=>n!=="id")}),localStorage.getItem("showIds")!=="true"&&(this.displayedColumns=this.displayedColumns.filter(e=>e!=="id"))}static{this.\u0275fac=function(n){return new(n||t)(m(Xt),m($),m(j),m(Y),m(xt),m(ii),m(Nt))}}static{this.\u0275cmp=D({type:t,selectors:[["app-perun-web-apps-consent-hubs-list"]],viewQuery:function(n,i){if(n&1&&(ve(ot,7),ve(be,7)),n&2){let s;Te(s=Ee())&&(i.child=s.first),Te(s=Ee())&&(i.matSort=s.first)}},inputs:{consentHubs:"consentHubs",filterValue:"filterValue",tableId:"tableId",selection:"selection",cachedSubject:"cachedSubject",loading:"loading",displayColumns:"displayColumns"},features:[Ei],decls:21,vars:15,consts:[[1,"card","mt-2",3,"hidden"],[3,"exportDisplayedData","exportAllData","pageChanged","tableId","dataLength","pageSizeOptions"],["mat-table","","matSort","","matSortActive","id","matSortDirection","asc","matSortDisableClear","",1,"w-100",3,"matSortChange","dataSource"],["matColumnDef","select"],["matColumnDef","id"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["class","static-column-size","mat-cell","",4,"matCellDef"],["matColumnDef","name"],["mat-cell","",4,"matCellDef"],["matColumnDef","enforceConsents"],["matColumnDef","facilities"],["mat-header-row","",4,"matHeaderRowDef"],["class","dark-hover-list-item","mat-row","",4,"matRowDef","matRowDefColumns"],["alert_type","warn"],["mat-header-cell","","class","align-checkbox",4,"matHeaderCellDef"],["class","static-column-size align-checkbox","mat-cell","",4,"matCellDef"],["mat-header-cell","",1,"align-checkbox"],["color","primary",3,"change","aria-label","checked","indeterminate"],["mat-cell","",1,"static-column-size","align-checkbox"],["color","primary",3,"change","click","aria-label","checked"],["mat-header-cell","","mat-sort-header",""],["mat-cell","",1,"static-column-size"],["mat-cell",""],[3,"change","checked"],[1,"text-muted"],["mat-header-row",""],["mat-row","",1,"dark-hover-list-item"]],template:function(n,i){if(n&1&&(r(0,"div",0)(1,"perun-web-apps-table-wrapper",1),C("exportDisplayedData",function(v){return i.exportDisplayedData(v)})("exportAllData",function(v){return i.exportAllData(v)})("pageChanged",function(){return i.pageChanged()}),r(2,"table",2),C("matSortChange",function(){return i.pageChanged()}),E(3,pp,3,0,"ng-container",3),l(4,"isAllSelected"),k(5,4),S(6,cp,3,3,"th",5)(7,dp,2,1,"td",6),P(),k(8,7),S(9,mp,3,3,"th",5)(10,up,3,5,"td",8),P(),k(11,9),S(12,_p,3,3,"th",5)(13,fp,2,1,"td",8),P(),k(14,10),S(15,hp,3,3,"th",5)(16,Cp,3,0,"td",8),P(),S(17,bp,1,0,"tr",11)(18,Sp,1,0,"tr",12),a()()(),E(19,vp,3,3,"perun-web-apps-alert",13),E(20,Tp,3,3,"perun-web-apps-alert",13)),n&2){let s;u("hidden",i.consentHubs.length===0||i.dataSource.filteredData.length===0),o(),u("tableId",i.tableId)("dataLength",i.dataSource.filteredData.length)("pageSizeOptions",i.pageSizeOptions),o(),u("dataSource",i.dataSource),o(),I((s=De(13,op,je(4,10,i.dataSource,i.selection.selected.length)))?3:-1,s),o(14),u("matHeaderRowDef",i.displayedColumns),o(),u("matRowDefColumns",i.displayedColumns),o(),I(!i.loading&&i.consentHubs.length===0?19:-1),o(),I(i.dataSource.filteredData.length===0&&i.consentHubs.length!==0?20:-1)}},dependencies:[x,jt,Gt,Kt,$t,X,Q,ot,Ce,xe,ye,Be,we,Me,Oe,Re,Le,Ne,Ue,At,be,It,M,Zt,y,ei,ti,qi],encapsulation:2})}}return t})();function Ep(t,c){t&1&&(r(0,"perun-web-apps-alert",2),d(1),l(2,"translate"),a()),t&2&&(o(),f(" ",p(2,1,"ADMIN.CONSENT_HUBS.GLOBAL_DISABLED")," "))}function Ip(t,c){if(t&1){let e=T();r(0,"button",9),C("click",function(){h(e);let i=_();return g(i.evaluateConsents())}),d(1),l(2,"translate"),a()}if(t&2){let e=_();u("disabled",!e.globalForceConsents||e.loading||e.selection.selected.length===0),o(),f(" ",p(2,2,"ADMIN.CONSENT_HUBS.EVALUATE_CONSENTS")," ")}}function Ap(t,c){t&1&&b(0,"perun-web-apps-loading-table")}function Dp(t,c){if(t&1&&b(0,"app-perun-web-apps-consent-hubs-list",10),t&2){let e=_();u("loading",e.loading)("consentHubs",e.consentHubs)("selection",e.selection)("cachedSubject",e.cachedSubject)("filterValue",e.filterValue)("tableId",e.tableId)}}var La=(()=>{class t{constructor(e,n,i,s,v,w){this.consentsManager=e,this.authResolver=n,this.notificator=i,this.translate=s,this.store=v,this.dialog=w,this.loading=!1,this.tableId=lo,this.selection=new K(!0,[],!0,(q,_e)=>q.id===_e.id),this.filterValue="",this.consentHubs=[],this.cachedSubject=new G(!0)}ngOnInit(){this.globalForceConsents=this.store.getProperty("enforce_consents"),this.refreshTable()}applyFilter(e){this.filterValue=e,this.refreshTable()}refreshTable(){this.loading=!0,this.selection.clear(),this.cachedSubject.next(!0),this.consentsManager.getAllConsentHubs().subscribe(e=>{this.consentHubs=e,this.loading=!1})}evaluateConsents(){let e=V();e.width="500px",e.data={title:this.translate.instant("ADMIN.CONSENT_HUBS.CONFIRM_DIALOG_TITLE"),theme:"admin-theme",description:this.translate.instant("ADMIN.CONSENT_HUBS.CONFIRM_DIALOG_DESCRIPTION"),items:this.selection.selected.map(i=>i.name),type:"confirmation",showAsk:!1},this.dialog.open(Ki,e).afterClosed().subscribe(i=>{i&&this.evaluateConsentsForConsentHubs()})}evaluateConsentsForConsentHubs(){this.loading=!0;let e=this.selection.selected.map(n=>n.id);this.consentsManager.evaluateConsentsForConsentHubs(e).subscribe({next:()=>{this.notificator.showSuccess(this.translate.instant("ADMIN.CONSENT_HUBS.EVALUATION_FINISH")),this.refreshTable()},error:()=>this.loading=!1})}static{this.\u0275fac=function(n){return new(n||t)(m(xt),m(re),m(j),m(qt),m(Ve),m($))}}static{this.\u0275cmp=D({type:t,selectors:[["app-perun-web-apps-admin-consent-hubs"]],decls:14,vars:13,consts:[["spinner",""],[1,"page-subtitle"],["alert_type","warn"],[3,"refresh"],[3,"matTooltipDisabled","matTooltip"],["color","accent","mat-flat-button","",1,"action-button","me-2",3,"disabled"],[3,"filter","placeholder"],[1,"position-relative","table-min-height"],[3,"loading","consentHubs","selection","cachedSubject","filterValue","tableId",4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],["color","accent","mat-flat-button","",1,"action-button","me-2",3,"click","disabled"],[3,"loading","consentHubs","selection","cachedSubject","filterValue","tableId"]],template:function(n,i){if(n&1){let s=T();r(0,"div")(1,"h1",1),d(2),l(3,"translate"),a(),E(4,Ep,3,3,"perun-web-apps-alert",2),r(5,"perun-web-apps-refresh-button",3),C("refresh",function(){return h(s),g(i.refreshTable())}),a(),r(6,"span",4),l(7,"translate"),E(8,Ip,3,4,"button",5),a(),r(9,"perun-web-apps-debounce-filter",6),C("filter",function(w){return h(s),g(i.applyFilter(w))}),a(),S(10,Ap,1,0,"ng-template",null,0,B),r(12,"div",7),S(13,Dp,1,6,"app-perun-web-apps-consent-hubs-list",8),a()()}if(n&2){let s=R(11);o(2),A(p(3,9,"ADMIN.CONSENT_HUBS.TITLE")),o(2),I(i.globalForceConsents?-1:4),o(2),u("matTooltip",fe(p(7,11,"ADMIN.CONSENT_HUBS.TOOLTIP")))("matTooltipDisabled",i.globalForceConsents),o(2),I(i.authResolver.isPerunAdmin()?8:-1),o(),u("placeholder","ADMIN.CONSENT_HUBS.SEARCH"),o(4),u("perunWebAppsLoader",i.loading)("perunWebAppsLoaderIndicator",s)}},dependencies:[x,L,O,X,Q,de,ce,M,We,Ra,N,H,y],encapsulation:2})}}return t})();function xp(t,c){t&1&&(d(0),l(1,"translate")),t&2&&f(" ",p(1,1,"USER_DETAIL.BANS.VO")," ")}function Mp(t,c){if(t&1){let e=T();r(0,"perun-web-apps-ban-on-entity-list",8),C("updateBan",function(i){h(e);let s=_(2);return g(s.updateVoBan(i))}),a()}if(t&2){let e=_(2);u("loading",e.loading)("bans",e.voBans)("displayedColumns",e.displayedColumns)("filter",e.filter)("updatePolicy","updateBan_BanOnVo_policy")}}function yp(t,c){if(t&1){let e=T();r(0,"perun-web-apps-debounce-filter",5),C("filter",function(i){h(e);let s=_();return g(s.filter=i)}),a(),r(1,"div",6),S(2,Mp,1,5,"perun-web-apps-ban-on-entity-list",7),a()}if(t&2){let e=_(),n=R(14);u("placeholder","USER_DETAIL.BANS.FILTER"),o(2),u("perunWebAppsLoader",e.loading)("perunWebAppsLoaderIndicator",n)}}function wp(t,c){t&1&&(d(0),l(1,"translate")),t&2&&f(" ",p(1,1,"USER_DETAIL.BANS.RESOURCE")," ")}function Rp(t,c){if(t&1){let e=T();r(0,"perun-web-apps-ban-on-entity-list",8),C("updateBan",function(i){h(e);let s=_(2);return g(s.updateResourceBan(i))}),a()}if(t&2){let e=_(2);u("loading",e.loading)("bans",e.resourceBans)("displayedColumns",e.displayedColumns)("filter",e.filter)("updatePolicy","updateBan_BanOnResource_policy")}}function Lp(t,c){if(t&1){let e=T();r(0,"perun-web-apps-debounce-filter",5),C("filter",function(i){h(e);let s=_();return g(s.filter=i)}),a(),r(1,"div",6),S(2,Rp,1,5,"perun-web-apps-ban-on-entity-list",7),a()}if(t&2){let e=_(),n=R(14);u("placeholder","USER_DETAIL.BANS.FILTER"),o(2),u("perunWebAppsLoader",e.loading)("perunWebAppsLoaderIndicator",n)}}function Bp(t,c){t&1&&(d(0),l(1,"translate")),t&2&&f(" ",p(1,1,"USER_DETAIL.BANS.FACILITY")," ")}function Op(t,c){if(t&1){let e=T();r(0,"perun-web-apps-ban-on-entity-list",8),C("updateBan",function(i){h(e);let s=_(2);return g(s.updateFacilityBan(i))}),a()}if(t&2){let e=_(2);u("loading",e.loading)("bans",e.facilityBans)("displayedColumns",e.displayedColumns)("filter",e.filter)("updatePolicy","updateBan_BanOnFacility_policy")}}function Np(t,c){if(t&1){let e=T();r(0,"perun-web-apps-debounce-filter",5),C("filter",function(i){h(e);let s=_();return g(s.filter=i)}),a(),r(1,"div",6),S(2,Op,1,5,"perun-web-apps-ban-on-entity-list",7),a()}if(t&2){let e=_(),n=R(14);u("placeholder","USER_DETAIL.BANS.FILTER"),o(2),u("perunWebAppsLoader",e.loading)("perunWebAppsLoaderIndicator",n)}}function Up(t,c){t&1&&b(0,"perun-web-apps-loading-table")}var Ba=(()=>{class t{constructor(e,n,i,s,v){this.voService=e,this.resourceService=n,this.facilityService=i,this.entityService=s,this.dialog=v,this.loading=!1,this.voBans=[],this.resourceBans=[],this.facilityBans=[],this.filter="",this.displayedColumns=["banId","targetId","targetName","description","expiration","edit"]}ngOnInit(){this.loading=!0,this.user=this.entityService.getEntity(),this.refreshVoBans()}refreshVoBans(){this.loading=!0,this.voService.getEnrichedVoBansForUser(this.user.id).subscribe({next:e=>{this.voBans=e,this.loading=!1},error:()=>this.loading=!1})}refreshResourceBans(){this.loading=!0,this.resourceService.getEnrichedBansForUser(this.user.id).subscribe({next:e=>{this.resourceBans=e,this.loading=!1},error:()=>this.loading=!1})}refreshFacilityBans(){this.loading=!0,this.facilityService.getEnricheFacilitydBansForUser(this.user.id).subscribe({next:e=>{this.facilityBans=e,this.loading=!1},error:()=>this.loading=!1})}updateVoBan(e){this.dialog.open(Vo,this.getConfig(e)).afterClosed().subscribe(i=>{i&&this.refreshVoBans()})}updateResourceBan(e){this.dialog.open(ko,this.getConfig(e)).afterClosed().subscribe(i=>{i&&this.refreshResourceBans()})}updateFacilityBan(e){this.dialog.open(Yo,this.getConfig(e)).afterClosed().subscribe(i=>{i&&this.refreshFacilityBans()})}getConfig(e){let n=V();return n.width="600px",n.data={ban:e.ban,theme:"user-theme"},n}refresh(e){e.index===0?this.refreshVoBans():e.index===1?this.refreshResourceBans():this.refreshFacilityBans()}static{this.\u0275fac=function(n){return new(n||t)(m(On),m(Gi),m(zt),m(ke),m($))}}static{this.\u0275cmp=D({type:t,selectors:[["app-user-bans"]],decls:15,vars:3,consts:[["spinner",""],[1,"page-subtitle"],["mat-stretch-tabs","false",1,"mt-3",3,"selectedTabChange"],["matTabLabel",""],["matTabContent",""],[1,"mt-2","search-field",3,"filter","placeholder"],[1,"position-relative","table-min-height"],[3,"loading","bans","displayedColumns","filter","updatePolicy","updateBan",4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],[3,"updateBan","loading","bans","displayedColumns","filter","updatePolicy"]],template:function(n,i){if(n&1){let s=T();r(0,"h1",1),d(1),l(2,"translate"),a(),r(3,"mat-tab-group",2),C("selectedTabChange",function(w){return h(s),g(i.refresh(w))}),r(4,"mat-tab"),S(5,xp,2,3,"ng-template",3)(6,yp,3,3,"ng-template",4),a(),r(7,"mat-tab"),S(8,wp,2,3,"ng-template",3)(9,Lp,3,3,"ng-template",4),a(),r(10,"mat-tab"),S(11,Bp,2,3,"ng-template",3)(12,Np,3,3,"ng-template",4),a()(),S(13,Up,1,0,"ng-template",null,0,B)}n&2&&(o(),f(" ",p(2,1,"USER_DETAIL.BANS.TITLE"),`
`))},dependencies:[x,de,nt,Ze,et,tt,it,M,Do,N,H,y],encapsulation:2})}}return t})();function Vp(t,c){t&1&&b(0,"perun-web-apps-loading-dialog")}function kp(t,c){t&1&&b(0,"th",18)}function Pp(t,c){if(t&1&&(r(0,"td",19),d(1),a()),t&2){let e=c.$implicit;o(),A(e.id)}}function Fp(t,c){t&1&&b(0,"th",18)}function Gp(t,c){if(t&1&&(r(0,"td",20),d(1),a()),t&2){let e=c.$implicit;o(),f(" ",e.login," ")}}function jp(t,c){t&1&&b(0,"th",18)}function Hp(t,c){if(t&1&&(r(0,"td",19),d(1),l(2,"globalNamespace"),a()),t&2){let e=c.$implicit;Pe(e.namespace?"":"fst-italic"),o(),f(" ",p(2,3,e.namespace)," ")}}function Wp(t,c){t&1&&b(0,"tr",21)}function qp(t,c){t&1&&b(0,"tr",22)}function zp(t,c){if(t&1){let e=T();r(0,"div")(1,"h1",2),d(2),l(3,"translate"),a(),r(4,"div",3)(5,"p"),d(6),l(7,"translate"),a(),r(8,"div",4),d(9),l(10,"translate"),a(),r(11,"table",5),k(12,6),S(13,kp,1,0,"th",7)(14,Pp,2,1,"td",8),P(),k(15,9),S(16,Fp,1,0,"th",7)(17,Gp,2,1,"td",10),P(),k(18,11),S(19,jp,1,0,"th",7)(20,Hp,3,5,"td",12),P(),S(21,Wp,1,0,"tr",13)(22,qp,1,0,"tr",14),a()(),r(23,"div",15)(24,"button",16),C("click",function(){h(e);let i=_();return g(i.onCancel())}),d(25),l(26,"translate"),a(),r(27,"button",17),C("click",function(){h(e);let i=_();return g(i.onSubmit())}),d(28),l(29,"translate"),a()()()}if(t&2){let e=_();o(2),A(p(3,8,"DIALOGS.UNBLOCK_LOGINS.TITLE")),o(4),f(" ",p(7,10,"DIALOGS.UNBLOCK_LOGINS.DESCRIPTION")," "),o(3),f(" ",p(10,12,"DIALOGS.UNBLOCK_LOGINS.ASK")," "),o(2),u("dataSource",e.dataSource),o(10),u("matHeaderRowDef",e.displayedColumns),o(),u("matRowDefColumns",e.displayedColumns),o(3),f(" ",p(26,14,"DIALOGS.UNBLOCK_LOGINS.CANCEL")," "),o(3),f(" ",p(29,16,"DIALOGS.UNBLOCK_LOGINS.UNBLOCK")," ")}}var Oa=(()=>{class t{constructor(e,n,i,s,v){this.dialogRef=e,this.data=n,this.notificator=i,this.translate=s,this.usersService=v,this.displayedColumns=["login","namespace"]}ngOnInit(){this.theme=this.data.theme,this.dataSource=new Ae(this.data.logins)}onCancel(){this.dialogRef.close(!1)}onSubmit(){this.loading=!0,this.usersService.unblockLoginsByIdBodyParams({logins:this.data.logins.map(e=>e.id)}).subscribe({next:()=>{this.notificator.showInstantSuccess("ADMIN.BLOCKED_LOGINS.UNBLOCK_SUCCESS"),this.dialogRef.close(!0),this.loading=!1},error:()=>{this.loading=!1}})}static{this.\u0275fac=function(n){return new(n||t)(m(J),m(pe),m(j),m(Y),m(le))}}static{this.\u0275cmp=D({type:t,selectors:[["app-unblock-logins-dialog"]],features:[Et([cn])],decls:4,vars:5,consts:[["spinner",""],[4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],["mat-dialog-title",""],["mat-dialog-content",""],[1,"fw-bold"],["mat-table","",1,"w-100",3,"dataSource"],["matColumnDef","id"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","login"],["mat-cell","","class","trim-login",4,"matCellDef"],["matColumnDef","namespace"],["mat-cell","",3,"class",4,"matCellDef"],["class","fw-bolder","mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["mat-dialog-actions",""],["mat-stroked-button","",1,"ms-auto",3,"click"],["color","warn","mat-flat-button","","data-cy","unblock-button-dialog",1,"ms-2",3,"click"],["mat-header-cell",""],["mat-cell",""],["mat-cell","",1,"trim-login"],["mat-header-row","",1,"fw-bolder"],["mat-row",""]],template:function(n,i){if(n&1&&(S(0,Vp,1,0,"ng-template",null,0,B),r(2,"div"),S(3,zp,30,18,"div",1),a()),n&2){let s=R(1);o(2),Pe(Ie("",i.theme," position-relative")),o(),u("perunWebAppsLoader",i.loading)("perunWebAppsLoaderIndicator",s)}},dependencies:[x,L,O,ie,Z,te,ee,ue,Ce,xe,ye,Be,we,Me,Oe,Re,Le,Ne,Ue,M,N,y,cn],styles:[".trim-login[_ngcontent-%COMP%]{overflow:hidden;text-overflow:ellipsis;max-width:250px}"]})}}return t})();function $p(t,c){t&1&&b(0,"perun-web-apps-loading-dialog")}function Kp(t,c){if(t&1&&(r(0,"mat-radio-button",5),d(1),l(2,"translate"),a()),t&2){let e=_(2);u("value",!1)("checked",!e.isGlobal),o(),f(" ",p(2,3,"DIALOGS.BLOCK_LOGINS.SPECIFIC")," ")}}function Yp(t,c){if(t&1){let e=T();r(0,"perun-web-apps-namespace-search-select",12),C("namespaceSelected",function(i){h(e);let s=_(2);return g(s.selectedNamespace=i)}),a()}if(t&2){let e=_(2);u("namespaceOptions",e.data.namespaceOptions)("namespace",e.selectedNamespace)("disableAutoSelect",!0)("customFindPlaceholder","DIALOGS.BLOCK_LOGINS.FIND_PLACEHOLDER")}}function Qp(t,c){t&1&&(r(0,"mat-error"),d(1),l(2,"translate"),a()),t&2&&(o(),f(" ",p(2,1,"DIALOGS.BLOCK_LOGINS.LOGINS_ERROR")," "))}function Xp(t,c){if(t&1){let e=T();r(0,"div")(1,"h1",2),d(2),l(3,"translate"),a(),r(4,"div",3)(5,"mat-radio-group",4),bt("ngModelChange",function(i){h(e);let s=_();return Ct(s.isGlobal,i)||(s.isGlobal=i),g(i)}),r(6,"mat-radio-button",5),d(7),l(8,"translate"),a(),E(9,Kp,3,5,"mat-radio-button",5),a(),E(10,Yp,1,4,"perun-web-apps-namespace-search-select",6),r(11,"mat-form-field",7)(12,"mat-label"),d(13),l(14,"translate"),a(),b(15,"textarea",8),l(16,"translate"),E(17,Qp,3,3,"mat-error"),a()(),r(18,"div",9)(19,"button",10),C("click",function(){h(e);let i=_();return g(i.onCancel())}),d(20),l(21,"translate"),a(),r(22,"button",11),C("click",function(){h(e);let i=_();return g(i.onSubmit())}),d(23),l(24,"translate"),a()()()}if(t&2){let e=_();o(2),A(p(3,15,"DIALOGS.BLOCK_LOGINS.TITLE")),o(3),gt("ngModel",e.isGlobal),o(),u("value",!0)("checked",e.isGlobal),o(),f(" ",p(8,17,"DIALOGS.BLOCK_LOGINS.GLOBAL")," "),o(2),I(e.data.namespaceOptions.length>0?9:-1),o(),I(e.data.namespaceOptions.length>0&&!e.isGlobal?10:-1),o(3),A(p(14,19,"DIALOGS.BLOCK_LOGINS.INSERT_HERE")),o(2),u("placeholder",fe(p(16,21,"DIALOGS.BLOCK_LOGINS.PLACEHOLDER")))("formControl",e.blockLogins),o(2),I(e.blockLogins.hasError("required")?17:-1),o(3),f(" ",p(21,23,"DIALOGS.BULK_INVITE_MEMBERS.CANCEL")," "),o(2),u("disabled",e.loading||e.blockLogins.invalid||!e.isGlobal&&e.selectedNamespace===null),o(),f(" ",p(24,25,"DIALOGS.BLOCK_LOGINS.BLOCK")," ")}}var Na=(()=>{class t{constructor(e,n,i,s,v){this.dialogRef=e,this.data=n,this.store=i,this.usersService=s,this.notificator=v,this.loading=!1,this.blockLogins=new Rt("",ge.required),this.namespace=new Rt("",ge.required),this.isGlobal=!0,this.selectedNamespace=null}onCancel(){this.dialogRef.close(!1)}onSubmit(){this.loading=!0,this.usersService.blockLoginsBodyParams({logins:this.blockLogins.value.split(`
`).map(e=>e.trim()),namespace:this.isGlobal?null:this.selectedNamespace}).subscribe({next:()=>{this.notificator.showInstantSuccess("ADMIN.BLOCKED_LOGINS.BLOCK_SUCCESS"),this.dialogRef.close(!0),this.loading=!1},error:()=>{this.loading=!1}})}static{this.\u0275fac=function(n){return new(n||t)(m(J),m(pe),m(Ve),m(le),m(j))}}static{this.\u0275cmp=D({type:t,selectors:[["app-block-logins-dialog"]],decls:4,vars:5,consts:[["spinner",""],[4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],["mat-dialog-title",""],["mat-dialog-content","",1,"dialog-container"],[1,"d-flex","flex-column",3,"ngModelChange","ngModel"],["color","primary",1,"me-3",3,"value","checked"],[3,"namespaceOptions","namespace","disableAutoSelect","customFindPlaceholder"],[1,"pt-2","d-flex","flex-column"],["cols","50","data-cy","logins-input","required","","matInput","","rows","8",1,"md-textarea","form-control",3,"formControl","placeholder"],["mat-dialog-actions",""],["mat-stroked-button","",1,"ms-auto",3,"click"],["color","accent","data-cy","submit-blocked-logins-button","mat-flat-button","",1,"ms-2",3,"click","disabled"],[3,"namespaceSelected","namespaceOptions","namespace","disableAutoSelect","customFindPlaceholder"]],template:function(n,i){if(n&1&&(S(0,$p,1,0,"ng-template",null,0,B),r(2,"div"),S(3,Xp,25,27,"div",1),a()),n&2){let s=R(1);o(2),Pe(Ie("",i.data.theme," position-relative")),o(),u("perunWebAppsLoader",i.loading)("perunWebAppsLoaderIndicator",s)}},dependencies:[x,L,O,Ye,Ke,ct,Dt,Je,Xe,qn,Hn,Wn,$e,qe,ze,pt,yi,Ft,Pt,ie,Z,te,ee,ue,M,N,Ji,y],encapsulation:2})}}return t})();function Jp(t,c){if(t&1){let e=T();r(0,"button",10),C("click",function(){h(e);let i=_();return g(i.block())}),d(1),l(2,"translate"),a()}t&2&&(o(),f(" ",p(2,1,"ADMIN.BLOCKED_LOGINS.BLOCK")," "))}function Zp(t,c){if(t&1){let e=T();r(0,"button",11),l(1,"async"),C("click",function(){h(e);let i=_();return g(i.unblock())}),d(2),l(3,"translate"),a()}if(t&2){let e=_();u("disabled",p(1,2,e.loading$)||e.selection.selected.length===0),o(2),f(" ",p(3,4,"ADMIN.BLOCKED_LOGINS.UNBLOCK")," ")}}function ec(t,c){t&1&&b(0,"perun-web-apps-loading-table")}function tc(t,c){if(t&1){let e=T();r(0,"perun-web-apps-logins-list",12),l(1,"async"),l(2,"async"),C("queryChanged",function(i){h(e);let s=_();return g(s.nextPage.next(i))})("downloadAll",function(i){h(e);let s=_();return g(s.downloadAll(i))}),a()}if(t&2){let e=_();u("loading",p(1,8,e.loading$))("blockedLogins",p(2,10,e.blockedLoginsPage$))("displayedColumns",e.displayedColumns)("selection",e.selection)("filter",e.searchString)("tableId",e.tableId)("cacheSubject",e.cacheSubject)("resetPagination",e.resetPagination)}}var Ua=(()=>{class t{constructor(e,n,i,s,v){this.cd=e,this.dialog=n,this.attributesService=i,this.authResolver=s,this.userManager=v,this.tableId=po,this.isAdmin=!1,this.selection=new K(!0,[],!0,(w,q)=>w.id===q.id),this.logins=[],this.namespaceOptions=[],this.filterOptions=[],this.selectedNamespaces=[],this.namespaces=new Rt,this.displayedColumns=["checkbox","login","namespace"],this.blockedLogins=[],this.nextPage=new G({}),this.resetPagination=new G(!1),this.blockedLoginsPage$=this.nextPage.pipe(se(w=>this.userManager.getBlockedLoginsPage({query:{order:w.order,pageSize:w.pageSize,offset:w.offset,sortColumn:w.sortColumn,searchString:w.searchString,namespaces:this.selectedNamespaces}})),Ot(w=>{this.blockedLogins=w.data,this.selection.clear(),setTimeout(()=>this.loadingSubject$.next(!1),200)}),at({data:[],totalCount:0,offset:0,pageSize:0})),this.loadingSubject$=new G(!1),this.cacheSubject=new G(!0),this.loading$=Bt(this.loadingSubject$,this.nextPage.pipe(ht(()=>!0)))}refreshTable(){this.cacheSubject.next(!0),this.resetPagination.next(!0),this.nextPage.next(this.nextPage.value)}onSearchByString(e){this.searchString=e,this.cd.detectChanges()}ngOnInit(){this.namespaces.setValue(this.selectedNamespaces),this.isAdmin=this.authResolver.isPerunAdmin(),this.attributesService.getAllNamespaces().subscribe(e=>{this.namespaceOptions=e,this.filterOptions=[""].concat(e)})}block(){let e=V();e.width="450px",e.data={theme:"admin-theme",namespaceOptions:this.namespaceOptions},this.dialog.open(Na,e).afterClosed().subscribe(i=>{i&&this.refreshTable()})}unblock(){let e=V();e.width="650px",e.data={logins:this.selection.selected,theme:"admin-theme"},this.dialog.open(Oa,e).afterClosed().subscribe(i=>{i&&this.refreshTable()})}toggleEvent(e){this.selectedNamespaces.splice(0,this.selectedNamespaces.length,...e.map(n=>n===""?null:n))}refreshOnClosed(){this.selectedNamespaces=[...this.selectedNamespaces],this.refreshTable()}downloadAll(e){let n=this.nextPage.getValue();this.userManager.getBlockedLoginsPage({query:{order:n.order,pageSize:e.length,offset:0,sortColumn:n.sortColumn,searchString:n.searchString,namespaces:this.selectedNamespaces}}).subscribe({next:i=>{st(Fe(i.data,this.displayedColumns,e.getDataForColumnFun),e.format)}})}static{this.\u0275fac=function(n){return new(n||t)(m(Di),m($),m(ae),m(re),m(le))}}static{this.\u0275cmp=D({type:t,selectors:[["app-perun-web-apps-admin-blocked-logins"]],decls:16,vars:18,consts:[["spinner",""],[1,"page-subtitle"],[1,"align-elements"],[3,"refresh"],["color","accent","data-cy","block-logins-button","mat-flat-button","",1,"me-2","action-button"],["color","warn","data-cy","unblock-logins-button","mat-flat-button","",1,"me-2",3,"disabled"],[1,"pr-2","me-2","flex-grow-1",3,"namespaceSelected","selectClosed","namespaceOptions","multiple","disableAutoSelect","disableDeselectButton","customSelectPlaceholder"],[1,"search-field","flex-grow-1",3,"filter","autoFocus","placeholder"],[1,"position-relative","table-min-height"],[3,"loading","blockedLogins","displayedColumns","selection","filter","tableId","cacheSubject","resetPagination","queryChanged","downloadAll",4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],["color","accent","data-cy","block-logins-button","mat-flat-button","",1,"me-2","action-button",3,"click"],["color","warn","data-cy","unblock-logins-button","mat-flat-button","",1,"me-2",3,"click","disabled"],[3,"queryChanged","downloadAll","loading","blockedLogins","displayedColumns","selection","filter","tableId","cacheSubject","resetPagination"]],template:function(n,i){if(n&1){let s=T();r(0,"h1",1),d(1),l(2,"translate"),a(),r(3,"div",2)(4,"div")(5,"perun-web-apps-refresh-button",3),C("refresh",function(){return h(s),g(i.refreshTable())}),a(),E(6,Jp,3,3,"button",4),E(7,Zp,4,6,"button",5),a(),r(8,"perun-web-apps-namespace-search-select",6),l(9,"translate"),C("namespaceSelected",function(w){return h(s),g(i.toggleEvent(w))})("selectClosed",function(){return h(s),g(i.refreshOnClosed())}),a(),r(10,"perun-web-apps-debounce-filter",7),C("filter",function(w){return h(s),g(i.onSearchByString(w))}),a()(),S(11,ec,1,0,"ng-template",null,0,B),r(13,"div",8),S(14,tc,3,12,"perun-web-apps-logins-list",9),l(15,"async"),a()}if(n&2){let s=R(12);o(),A(p(2,12,"ADMIN.BLOCKED_LOGINS.TITLE")),o(5),I(i.isAdmin?6:-1),o(),I(i.isAdmin?7:-1),o(),u("namespaceOptions",i.filterOptions)("multiple",!0)("disableAutoSelect",!0)("disableDeselectButton",!1)("customSelectPlaceholder",p(9,14,"ADMIN.BLOCKED_LOGINS.FILTER_NAMESPACE")),o(2),u("autoFocus",!0)("placeholder","ADMIN.BLOCKED_LOGINS.SEARCH_PLACEHOLDER"),o(4),u("perunWebAppsLoader",p(15,16,i.loading$))("perunWebAppsLoaderIndicator",s)}},dependencies:[x,L,O,de,ce,M,Ji,yo,H,N,He,y],encapsulation:2})}}return t})();var ic=()=>["id","name","vo","description"];function nc(t,c){t&1&&b(0,"perun-web-apps-loading-table")}function oc(t,c){if(t&1){let e=T();r(0,"perun-web-apps-facility-search-select",7),C("facilitySelected",function(i){h(e);let s=_(2);return g(s.loadFacility(i))}),a()}if(t&2){let e=_(2);u("facilities",e.facilities)}}function ac(t,c){t&1&&(d(0),l(1,"translate")),t&2&&f(" ",p(1,1,"USER_DETAIL.ASSIGNMENTS.OVERVIEW")," ")}function rc(t,c){if(t&1&&b(0,"perun-web-apps-resources-list",13),t&2){let e=_(4);u("loading",e.loading)("resources",e.resources)("displayColumns",he(3,ic))}}function sc(t,c){if(t&1&&(r(0,"p",10),d(1),l(2,"translate"),a(),r(3,"div",11),S(4,rc,1,4,"perun-web-apps-resources-list",12),a()),t&2){let e=_(3),n=R(4);o(),A(p(2,3,"USER_DETAIL.ASSIGNMENTS.RESOURCES")),o(3),u("perunWebAppsLoader",e.loading)("perunWebAppsLoaderIndicator",n)}}function lc(t,c){t&1&&(d(0),l(1,"translate")),t&2&&f(" ",p(1,1,"USER_DETAIL.ASSIGNMENTS.USER_FACILITY_ATT")," ")}function pc(t,c){t&1&&b(0,"mat-spinner",14)}function cc(t,c){if(t&1&&b(0,"app-two-entity-attribute-page",15),t&2){let e=_(4);u("firstEntity","user")("firstEntityId",e.userId)("secondEntity","facility")("specificSecondEntity",e.selectedFacility)}}function dc(t,c){if(t&1&&(E(0,pc,1,0,"mat-spinner",14),E(1,cc,1,4,"app-two-entity-attribute-page",15)),t&2){let e=_(3);I(e.loading?0:-1),o(),I(e.loading?-1:1)}}function mc(t,c){t&1&&(d(0),l(1,"translate")),t&2&&f(" ",p(1,1,"USER_DETAIL.ASSIGNMENTS.MEMBER_RESOURCE_ATT")," ")}function uc(t,c){t&1&&b(0,"mat-spinner",14)}function _c(t,c){if(t&1&&b(0,"app-two-entity-attribute-page",16),t&2){let e=_(4);u("firstEntity","user")("firstEntityId",e.userId)("secondEntity","resource")("facilityId",e.selectedFacility.id)}}function fc(t,c){if(t&1&&(E(0,uc,1,0,"mat-spinner",14),E(1,_c,1,4,"app-two-entity-attribute-page",16)),t&2){let e=_(3);I(e.loading?0:-1),o(),I(e.loading?-1:1)}}function hc(t,c){t&1&&(r(0,"mat-tab-group",5)(1,"mat-tab"),S(2,ac,2,3,"ng-template",8)(3,sc,5,5,"ng-template",9),a(),r(4,"mat-tab"),S(5,lc,2,3,"ng-template",8)(6,dc,2,2,"ng-template",9),a(),r(7,"mat-tab"),S(8,mc,2,3,"ng-template",8)(9,fc,2,2,"ng-template",9),a()())}function gc(t,c){t&1&&(r(0,"perun-web-apps-alert",6),d(1),l(2,"translate"),a()),t&2&&(o(),A(p(2,1,"USER_DETAIL.ASSIGNMENTS.NO_FACILITIES")))}function Cc(t,c){if(t&1&&(r(0,"div")(1,"div",3),E(2,oc,1,1,"perun-web-apps-facility-search-select",4),a(),E(3,hc,10,0,"mat-tab-group",5),E(4,gc,3,3,"perun-web-apps-alert",6),a()),t&2){let e=_();o(2),I(e.initLoading||e.facilities.length===0?-1:2),o(),I(e.initLoading||e.facilities.length===0?-1:3),o(),I(!e.initLoading&&e.facilities.length===0?4:-1)}}var Va=(()=>{class t{constructor(e,n,i,s){this.route=e,this.facilityService=n,this.usersService=i,this.resourcesService=s,this.initLoading=!0,this.loading=!1,this.facilities=[],this.selectedFacility=null,this.member=null,this.resources=[]}ngOnInit(){this.initLoading=!0,this.route.parent.params.subscribe(e=>{this.userId=Number(e.userId),this.facilityService.getAssignedFacilitiesByUser(this.userId).subscribe({next:n=>{this.facilities=n,this.facilities.length&&this.loadFacility(this.facilities.sort(Wi)[0]),this.initLoading=!1},error:()=>this.initLoading=!1})})}loadFacility(e){this.loading=!0,this.selectedFacility=e,this.usersService.getAssociatedResourcesForUser(this.selectedFacility.id,this.userId).subscribe({next:n=>{this.resourcesService.getRichResourcesByIds(n.map(i=>i.id)).subscribe({next:i=>{this.resources=i,this.loading=!1},error:()=>this.loading=!1})},error:()=>this.loading=!1})}static{this.\u0275fac=function(n){return new(n||t)(m(me),m(zt),m(le),m(Gi))}}static{this.\u0275cmp=D({type:t,selectors:[["app-perun-web-apps-user-assignments"]],decls:6,vars:5,consts:[["spinner1",""],[1,"page-title"],[4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],[1,"d-flex"],[1,"w-50",3,"facilities"],["mat-stretch-tabs","false"],["alert_type","warn"],[1,"w-50",3,"facilitySelected","facilities"],["matTabLabel",""],["matTabContent",""],[1,"mt-4","subtitle"],[1,"position-relative","table-min-height"],[3,"loading","resources","displayColumns",4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],[3,"loading","resources","displayColumns"],[1,"ms-auto","me-auto"],[3,"firstEntity","firstEntityId","secondEntity","specificSecondEntity"],[3,"firstEntity","firstEntityId","secondEntity","facilityId"]],template:function(n,i){if(n&1&&(r(0,"h1",1),d(1),l(2,"translate"),a(),S(3,nc,1,0,"ng-template",null,0,B)(5,Cc,5,3,"div",2)),n&2){let s=R(4);o(),A(p(2,3,"USER_DETAIL.ASSIGNMENTS.TITLE")),o(4),u("perunWebAppsLoader",i.initLoading)("perunWebAppsLoaderIndicator",s)}},dependencies:[x,X,Q,li,nt,Ze,et,tt,it,mt,dt,M,So,N,go,H,y],styles:[".subtitle[_ngcontent-%COMP%]{font-size:1.2rem}"]})}}return t})();function bc(t,c){t&1&&b(0,"mat-spinner",6)}function Sc(t,c){if(t&1&&(r(0,"div",3),E(1,bc,1,0,"mat-spinner",6),a()),t&2){let e=_();o(),I(e.loading?1:-1)}}var ka=(()=>{class t{constructor(e,n,i,s){this.groupsManager=e,this.tasksManager=n,this.notificator=i,this.translate=s,this.loading=!0}ngOnInit(){this.loading=!0,this.groupsManager.isSuspendedGroupSynchronization().subscribe({next:e=>{this.groupSyncSuspended=e,this.tasksManager.isSuspendedTasksPropagation().subscribe({next:n=>{this.tasksPropSuspended=n,this.loading=!1},error:()=>{this.loading=!1}})},error:()=>{this.loading=!1}})}toggleGroupSuspension(){this.groupSyncSuspended=!this.groupSyncSuspended,this.groupSyncSuspended?this.groupsManager.suspendGroupSynchronization().subscribe({next:()=>{this.notificator.showSuccess(this.translate.instant("ADMIN.TASKS.SYNC_SUSPENDED_SUCCESS"))},error:()=>{this.groupSyncSuspended=!this.groupSyncSuspended}}):this.groupsManager.resumeGroupSynchronization().subscribe({next:()=>{this.notificator.showSuccess(this.translate.instant("ADMIN.TASKS.SYNC_RESUMED_SUCCESS"))},error:()=>{this.groupSyncSuspended=!this.groupSyncSuspended}})}toggleTaskSuspension(){this.tasksPropSuspended=!this.tasksPropSuspended,this.tasksPropSuspended?this.tasksManager.suspendTasksPropagation(!0).subscribe({next:()=>{this.notificator.showSuccess(this.translate.instant("ADMIN.TASKS.PROPAGATION_SUSPENDED_SUCCESS"))},error:()=>{this.tasksPropSuspended=!this.tasksPropSuspended}}):this.tasksManager.resumeTasksPropagation(!0).subscribe({next:()=>{this.notificator.showSuccess(this.translate.instant("ADMIN.TASKS.PROPAGATION_RESUMED_SUCCESS"))},error:()=>{this.tasksPropSuspended=!this.tasksPropSuspended}})}static{this.\u0275fac=function(n){return new(n||t)(m(Pi),m(Bn),m(j),m(Y))}}static{this.\u0275cmp=D({type:t,selectors:[["app-admin-tasks"]],decls:16,vars:17,consts:[[1,"page-subtitle"],["alert_type","info"],[1,"toggles"],[1,"spinner-container"],["labelPosition","before",1,"mb-2",3,"change","disabled","checked"],["labelPosition","before",3,"change","disabled","checked"],[1,"ms-auto","me-auto"]],template:function(n,i){n&1&&(r(0,"div")(1,"h1",0),d(2),l(3,"translate"),a(),r(4,"div")(5,"perun-web-apps-alert",1),d(6),l(7,"translate"),a()(),r(8,"div",2),E(9,Sc,2,1,"div",3),r(10,"mat-slide-toggle",4),C("change",function(){return i.toggleGroupSuspension()}),d(11),l(12,"translate"),a(),r(13,"mat-slide-toggle",5),C("change",function(){return i.toggleTaskSuspension()}),d(14),l(15,"translate"),a()()()),n&2&&(o(2),A(p(3,9,"ADMIN.TASKS.TITLE")),o(4),A(p(7,11,"ADMIN.TASKS.INFO")),o(3),I(i.loading?9:-1),o(),u("disabled",i.loading)("checked",i.groupSyncSuspended),o(),A(p(12,13,"ADMIN.TASKS.GROUP")),o(2),u("disabled",i.loading)("checked",i.tasksPropSuspended),o(),A(p(15,15,"ADMIN.TASKS.TASKS")))},dependencies:[x,Kt,$t,X,Q,mt,dt,M,y],styles:[".toggles[_ngcontent-%COMP%]{display:flex;flex-direction:column;padding-left:1em}"]})}}return t})();function vc(t,c){if(t&1){let e=T();r(0,"button",8),C("click",function(){h(e);let i=_();return g(i.showDetails())}),d(1),l(2,"translate"),a()}t&2&&(o(),f(" ",p(2,1,"MEMBER_DETAIL.APPLICATIONS.SHOW_ALL_DETAILS")," "))}function Tc(t,c){if(t&1){let e=T();r(0,"button",8),C("click",function(){h(e);let i=_();return g(i.showDetails())}),d(1),l(2,"translate"),a()}t&2&&(o(),f(" ",p(2,1,"MEMBER_DETAIL.APPLICATIONS.SHOW_LESS_DETAILS")," "))}function Ec(t,c){t&1&&b(0,"perun-web-apps-loading-table")}function Ic(t,c){if(t&1){let e=T();r(0,"perun-web-apps-applications-list",9),l(1,"async"),l(2,"async"),C("queryChanged",function(i){h(e);let s=_();return g(s.nextPage.next(i))})("downloadAll",function(i){h(e);let s=_();return g(s.downloadAll(i))}),a()}if(t&2){let e=_();u("loading",p(1,7,e.loading$))("tableId",e.showAllDetails?e.detailTableId:e.tableId)("user",e.user)("displayColumns",e.showAllDetails?e.detailedDisplayedColumns:e.displayedColumns)("applications",p(2,9,e.applicationsPage$))("filter",e.filterValue)("resetPagination",e.resetPagination)}}var Pa=(()=>{class t{constructor(e,n,i){this.entityStorageService=e,this.registrarService=n,this.translate=i,this.displayedColumns=["id","voName","groupName","createdAt","type","state","modifiedBy"],this.detailedDisplayedColumns=["id","createdAt","voId","voName","groupId","groupName","type","state","extSourceName","extSourceType","createdBy","modifiedBy","modifiedAt","fedInfo"],this.filterValue="",this.showAllDetails=!1,this.detailTableId=no,this.tableId=oo,this.dateFrom=new Date("1970-01-01"),this.currentStates=["NEW","VERIFIED"],this.applications=[],this.nextPage=new G({}),this.applicationsPage$=this.nextPage.pipe(se(s=>this.registrarService.getApplicationsPage({query:{pageSize:s.pageSize,offset:s.offset,order:s.order,sortColumn:pn(s.sortColumn),searchString:s.searchString,getDetails:this.showAllDetails,dateFrom:fi(this.dateFrom),dateTo:fi(new Date),userId:this.user.id,states:this.currentStates}})),Ot(s=>{this.applications=s.data,setTimeout(()=>this.loadingSubject$.next(!1),200)}),at({data:[],totalCount:0,offset:0,pageSize:0})),this.loadingSubject$=new G(!1),this.resetPagination=new G(!1),this.loading$=Bt(this.loadingSubject$,this.nextPage.pipe(ht(()=>!0)))}ngOnInit(){this.user=this.entityStorageService.getEntity()}applyFilter(e){this.filterValue=e,this.refreshTable()}showDetails(){this.showAllDetails=!this.showAllDetails}refreshTable(){this.resetPagination.next(!0),this.nextPage.next(this.nextPage.value)}statesChanged(e){this.currentStates=e,this.refreshTable()}downloadAll(e){let n=this.nextPage.getValue();this.registrarService.getApplicationsPage({query:{order:n.order,pageSize:e.length,offset:0,searchString:n.searchString,sortColumn:pn(n.sortColumn),getDetails:this.showAllDetails,dateFrom:fi(this.dateFrom),dateTo:fi(new Date),userId:this.user.id,states:this.currentStates}}).subscribe({next:i=>{Kn(Fe(i.data,this.showAllDetails?this.detailedDisplayedColumns:this.displayedColumns,$n),this.translate,e.format)}})}static{this.\u0275fac=function(n){return new(n||t)(m(ke),m(Fi),m(qt))}}static{this.\u0275cmp=D({type:t,selectors:[["app-user-applications"]],decls:14,vars:10,consts:[["spinner",""],[1,"page-subtitle"],[3,"refresh"],["mat-stroked-button","",1,"me-2"],[3,"filter","placeholder"],[3,"stateChanged"],[1,"position-relative","table-min-height"],[3,"loading","tableId","user","displayColumns","applications","filter","resetPagination","queryChanged","downloadAll",4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],["mat-stroked-button","",1,"me-2",3,"click"],[3,"queryChanged","downloadAll","loading","tableId","user","displayColumns","applications","filter","resetPagination"]],template:function(n,i){if(n&1){let s=T();r(0,"h1",1),d(1),l(2,"translate"),a(),r(3,"div")(4,"perun-web-apps-refresh-button",2),C("refresh",function(){return h(s),g(i.refreshTable())}),a(),E(5,vc,3,3,"button",3),E(6,Tc,3,3,"button",3),r(7,"perun-web-apps-debounce-filter",4),C("filter",function(w){return h(s),g(i.applyFilter(w))}),a(),r(8,"perun-web-apps-application-state-selector",5),C("stateChanged",function(w){return h(s),g(i.statesChanged(w))}),a()(),S(9,Ec,1,0,"ng-template",null,0,B),r(11,"div",6),S(12,Ic,3,11,"perun-web-apps-applications-list",7),l(13,"async"),a()}if(n&2){let s=R(10);o(),A(p(2,6,"MEMBER_DETAIL.APPLICATIONS.TITLE")),o(4),I(i.showAllDetails?-1:5),o(),I(i.showAllDetails?6:-1),o(),u("placeholder","MEMBER_DETAIL.APPLICATIONS.FILTER"),o(5),u("perunWebAppsLoader",p(13,8,i.loading$))("perunWebAppsLoaderIndicator",s)}},dependencies:[x,L,O,de,ce,M,Mo,H,wo,N,He,y],encapsulation:2})}}return t})();var Iv=[{path:"",component:Jo,canActivateChild:[tn],children:[{path:"",component:Zo,data:{animation:"AdminOverviewPage"}},{path:"attributes",component:la,data:{animation:"AdminAttributesPage"}},{path:"users",component:Po,data:{animation:"AdminUsersPage"}},{path:"services",component:Wo,data:{animation:"AdminServicesPage"}},{path:"audit_log",component:ya,data:{animation:"AdminAuditLogPage"}},{path:"ext_sources",component:ma,data:{animation:"AdminExtSourcesPage"}},{path:"consent_hubs",component:La,data:{animation:"AdminConsentHubsPage"}},{path:"searcher",component:Ko,data:{animation:"AdminSearcherPage"}},{path:"blocked_logins",component:Ua,data:{animation:"AdminBlockedLoginsPage"}},{path:"tasks",component:ka,data:{animation:"AdminTasksComponent"}}]},{path:"users/:userId",component:pa,canActivateChild:[tn],children:[{path:"",component:ca,data:{animation:"UserOverviewPage"}},{path:"accounts",component:Da,data:{animation:"UserAccountsPage"}},{path:"assignments",component:Va,data:{animation:"UserAssignmentsPage"}},{path:"attributes",component:da,data:{animation:"UserAttributesPage"}},{path:"identities",component:fa,data:{animation:"UserIdentitiesPage"}},{path:"identities/:identityId",component:ha,data:{animation:"UserIdentityDetailPage"}},{path:"roles",component:ua,data:{animation:"UserRolesPage"}},{path:"service-identities",component:Go,data:{animation:"UserServiceIdentities"}},{path:"associated-users",component:qo,data:{animation:"AssociatedUsersPage"}},{path:"bans",component:Ba,data:{animation:"UserBansPage"}},{path:"applications",component:Pa,data:{animation:"UserApplicationsPage"}}]},{path:"services/:serviceId",component:ba,canActivateChild:[tn],children:[{path:"",component:Sa,data:{animation:"ServiceOverviewPage"}},{path:"required-attributes",component:Ea,data:{animation:"ServiceRequiredAttributesPage"}},{path:"destinations",component:Ia,data:{animation:"ServiceDestinationsPage"}}]}];export{Iv as adminRoutes};
