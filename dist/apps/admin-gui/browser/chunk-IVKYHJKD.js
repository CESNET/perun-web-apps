import{a as na,b as aa,c as oa,d as ra,e as sa}from"./chunk-YDCB4HC6.js";import{a as Pn,b as Gn,c as $t,f as Hn,g as Un,h as Yn,i as Wn,j as zn,k as $n,l as Kn,m as Xn,n as Qn,o as Zn,p as Jn,q as ea}from"./chunk-NEMBOUU2.js";import"./chunk-D7YP42RJ.js";import{a as qt,b as ta,c as ia}from"./chunk-MVL5XGMZ.js";import{a as bt,c as zt,d as jn}from"./chunk-HMVCITBB.js";import{b as qn}from"./chunk-YAOCYKSX.js";import{a as Bn}from"./chunk-EIFLC2UB.js";import{a as Wt,b as Kt}from"./chunk-C3YVI7GE.js";import{$a as ai,$c as Ot,$e as en,Aa as Ce,Ad as ht,Ae as Ui,Ag as dn,Ba as v,Bc as ce,Be as Yi,Bi as It,Ca as _,Cc as R,Cd as Vt,Ce as Wi,Ci as yn,Da as d,Dc as M,De as zi,E as mi,Ee as $i,Fe as Ki,Fj as Rn,G as je,Ge as qi,Gh as hn,H as ui,Ha as Se,Hd as O,He as Xi,Hh as _n,I as fi,Ia as ve,Ic as rt,Ij as Mn,Ja as Ie,K as hi,Ka as F,Kd as Bi,La as Y,Lb as Ye,Lc as st,Ma as Z,Mc as Rt,Md as _t,Mi as Ae,N as _i,Na as p,Ni as Tn,Oa as T,Oc as Mt,Od as ue,Of as H,Pa as h,Pc as Ft,Pd as Te,Pe as Qi,Ph as gn,Q as gi,Qa as be,Qb as We,Qc as Di,Qd as Pi,Qe as Zi,Ra as Ii,Rb as Fe,Rc as Ri,Re as Bt,S as g,Sb as ze,Sc as lt,Se as Pt,Sf as sn,T as C,Ta as De,Tc as wt,Te as Gt,Tj as Fn,Ua as Re,Uh as Cn,Ui as Ht,Uj as wn,V as Ci,Va as Me,Vi as An,Vj as Ln,W as Tt,Wa as ye,Wc as ct,Wg as mn,Wi as Ut,Xa as fe,Xb as le,Xc as Lt,Xf as j,Xg as un,Ya as bi,Yb as Ei,Yc as pt,Yf as jt,Yh as Sn,Yj as On,Za as me,Zc as Mi,Ze as Ct,_ as At,_a as He,_b as $e,_e as Ji,_i as En,aa as a,ad as Fi,aj as xn,bd as L,cb as l,cd as w,ck as kn,d as oe,db as c,de as Gi,ea as u,eb as gt,ec as Dt,ed as dt,ee as Nt,fa as E,fd as mt,fe as B,ff as tn,gd as ke,ge as W,gf as nn,gk as Vn,hd as Ve,he as z,ib as V,ic as xi,id as Ne,ie as J,ik as Nn,ja as Si,jb as Ue,jc as Ke,jd as Be,je as ee,k as Ge,ka as A,kd as pe,ke as te,kj as de,la as Et,lc as we,ld as he,le as ie,mb as yi,mc as Le,me as ne,mf as k,mi as vn,nc as G,oa as vi,ob as Ti,oc as qe,od as wi,of as an,pb as xt,pc as Xe,pd as Li,pf as on,pi as oi,qa as I,qc as Qe,qd as Oi,qf as rn,qg as ln,r as di,ra as b,rc as Ze,rd as ki,rf as St,sa as ni,sb as Ai,sc as Je,sf as vt,ta as Ee,tb as x,tc as et,td as ut,ua as xe,uc as tt,ud as ft,ui as In,va as m,vc as it,vd as Vi,vi as bn,wa as r,wc as nt,wd as kt,wg as cn,wh as fn,xa as o,xc as at,xd as N,xe as ji,xj as Dn,ya as S,yc as ot,yd as Ni,ye as Hi,za as ge,zc as Oe,zd as Pe,zg as pn,zj as Yt}from"./chunk-353QRQI4.js";import"./chunk-TSRGIXR5.js";var Va=()=>({color:"black"}),la=t=>["/facilities",t];function Na(t,f){t&1&&S(0,"mat-spinner",1)}function Ba(t,f){if(t&1){let e=v();r(0,"button",10),l(1,"translate"),_("click",function(){g(e);let n=d(2);return C(n.editFacility())}),r(2,"mat-icon"),p(3,"edit"),o()()}t&2&&m("matTooltip",ye(c(1,2,"FACILITY_DETAIL.EDIT")))}function Pa(t,f){if(t&1){let e=v();r(0,"button",10),l(1,"translate"),_("click",function(){g(e);let n=d(2);return C(n.deleteFacility())}),r(2,"mat-icon"),p(3,"delete_forever"),o()()}t&2&&m("matTooltip",ye(c(1,2,"FACILITY_DETAIL.DELETE")))}function Ga(t,f){if(t&1){let e=v();r(0,"div")(1,"div",2),S(2,"mat-icon",3),l(3,"translate"),r(4,"div",4)(5,"div",5)(6,"a",6),_("auxclick",function(n){return g(e),C(n.preventDefault())}),p(7),o(),r(8,"span",7),p(9),o(),I(10,Ba,4,4,"button",8),I(11,Pa,4,4,"button",8),o(),r(12,"div"),p(13),l(14,"translate"),o(),r(15,"span",9),p(16),l(17,"translate"),l(18,"translate"),o()()(),S(19,"app-animated-router-outlet"),o()}if(t&2){let e=d();a(2),m("matTooltip",ye(c(3,14,"FACILITY_DETAIL.ENTITY")))("ngStyle",me(22,Va)),a(4),m("perunWebAppsMiddleClickRouterLink",He(23,la,e.facility.id.toString()))("routerLink",He(25,la,e.facility.id)),a(),T(e.facility.name),a(2),h(" \xA0#",e.facility.id," "),a(),b(e.editFacilityAuth?10:-1),a(),b(e.deleteAuth?11:-1),a(2),be("",c(14,16,"FACILITY_DETAIL.UUID"),": ",e.facility.uuid),a(3),Ii(" ",c(17,18,"FACILITY_DETAIL.ENTITY"),", ",c(18,20,"FACILITY_DETAIL.DESCRIPTION"),": ",e.facility.description," ")}}var pa=(()=>{class t extends Gn(){constructor(e,i,n,s,y,D,q,U,X){super(),this.dialog=e,this.facilityManager=i,this.route=n,this.sideMenuService=s,this.sideMenuItemService=y,this.guiAuthResolver=D,this.router=q,this.entityStorageService=U,this.reloadEntityDetail=X,this.editFacilityAuth=!1,this.deleteAuth=!1,this.loading=!1}ngOnInit(){this.reloadData(),this.reloadEntityDetail.entityDetailChange.pipe(fi(this.destroyed$)).subscribe(()=>{this.reloadData()})}reloadData(){this.loading=!0,this.route.params.subscribe(e=>{let i=Number(e.facilityId);this.facilityManager.getFacilityById(i).subscribe({next:n=>{this.facility=n,this.entityStorageService.setEntityAndPathParam({id:n.id,beanName:n.beanName},Gi.Facility),this.setMenuItems(),this.editFacilityAuth=this.guiAuthResolver.isAuthorized("updateFacility_Facility_policy",[this.facility]),this.deleteAuth=this.guiAuthResolver.isAuthorized("deleteFacility_Facility_Boolean_policy",[this.facility]),tn("facilities",this.facility),nn(this.facility),this.loading=!1},error:()=>this.loading=!1})})}setMenuItems(){let e=this.sideMenuItemService.parseFacility(this.facility);this.sideMenuService.setFacilityMenuItems([e])}editFacility(){let e=k();e.width="450px",e.data={theme:"facility-theme",facility:this.facility,dialogType:In.FACILITY},this.dialog.open(bn,e).afterClosed().subscribe(n=>{n&&this.facilityManager.getFacilityById(this.facility.id).subscribe(s=>{this.facility=s,this.setMenuItems()})})}deleteFacility(){let e=k();e.width="500px",e.data={theme:"facility-theme",facility:this.facility},this.dialog.open(na,e).afterClosed().subscribe(n=>{n&&this.router.navigate([""],{queryParamsHandling:"preserve"})})}static{this.\u0275fac=function(i){return new(i||t)(u(J),u(O),u(rt),u(Nn),u(Bn),u(B),u(st),u(j),u(Pn))}}static{this.\u0275cmp=E({type:t,selectors:[["app-facility-detail-page"]],features:[Si],decls:4,vars:2,consts:[[1,"container-fluid","ps-xl-5","pe-xl-5","facility-theme"],[1,"me-auto","ms-auto"],[1,"d-flex","page-title-headtitle"],["svgIcon","perun-facility-black",1,"perun-icon","perun-icon-detail",3,"matTooltip","ngStyle"],[1,"page-title-block"],[1,"page-title-headline","d-flex","align-items-center"],[1,"facility-link",3,"auxclick","perunWebAppsMiddleClickRouterLink","routerLink"],[1,"text-muted"],["mat-icon-button","",3,"matTooltip"],[1,"mt-1","entity-info"],["mat-icon-button","",3,"click","matTooltip"]],template:function(i,n){i&1&&(r(0,"div",0),S(1,"perun-web-apps-back-button"),I(2,Na,1,0,"mat-spinner",1),I(3,Ga,20,27,"div"),o()),i&2&&(a(2),b(n.loading?2:-1),a(),b(!n.loading&&n.facility!==void 0?3:-1))},dependencies:[x,Ti,w,Fi,Ve,ke,kt,Vn,Tn,Ni,Wt,Mt,Rt,mt,dt,M,Ye,R],encapsulation:2,data:{animation:[Yt]}})}}return t})();function ja(t,f){t&1&&S(0,"mat-spinner",0)}function Ha(t,f){if(t&1&&(r(0,"div"),S(1,"perun-web-apps-menu-buttons-field",1)(2,"perun-web-apps-expandable-tiles",2),o()),t&2){let e=d();a(),m("items",e.items),a(),m("items",e.settingItems)("title","MENU_ITEMS.FACILITY.SETTINGS")("sectionId","settings")}}var da=(()=>{class t{constructor(e,i,n,s){this.facilityManager=e,this.authResolver=i,this.entityStorageService=n,this.routePolicyService=s,this.items=[],this.settingItems=[],this.loading=!1}ngOnInit(){this.loading=!0,this.facility=this.entityStorageService.getEntity(),this.setItems(),this.setSettingsItems(),this.loading=!1}setItems(){this.items=[],this.routePolicyService.canNavigate("facilities-resources",this.facility)&&this.items.push({cssIcon:"perun-manage-facility",url:`/facilities/${this.facility.id}/resources`,label:"MENU_ITEMS.FACILITY.RESOURCES",style:"facility-btn"}),this.routePolicyService.canNavigate("facilities-allowed-users",this.facility)&&this.items.push({cssIcon:"perun-user",url:`/facilities/${this.facility.id}/allowed-users`,label:"MENU_ITEMS.FACILITY.ALLOWED_USERS",style:"facility-btn"}),this.routePolicyService.canNavigate("facilities-allowed-groups",this.facility)&&this.items.push({cssIcon:"perun-group",url:`/facilities/${this.facility.id}/allowed-groups`,label:"MENU_ITEMS.FACILITY.ALLOWED_GROUPS",style:"facility-btn"}),this.routePolicyService.canNavigate("facilities-services-status",this.facility)&&this.items.push({cssIcon:"perun-service-status",url:`/facilities/${this.facility.id}/services-status`,label:"MENU_ITEMS.FACILITY.SERVICES_STATUS",style:"facility-btn"}),this.routePolicyService.canNavigate("facilities-services-destinations",this.facility)&&this.items.push({cssIcon:"perun-service_destination",url:`/facilities/${this.facility.id}/services-destinations`,label:"MENU_ITEMS.FACILITY.SERVICES_DESTINATIONS",style:"facility-btn"}),this.routePolicyService.canNavigate("facilities-hosts",this.facility)&&this.items.push({cssIcon:"perun-hosts",url:`/facilities/${this.facility.id}/hosts`,label:"MENU_ITEMS.FACILITY.HOSTS",style:"facility-btn"}),this.routePolicyService.canNavigate("facilities-attributes",this.facility)&&this.items.push({cssIcon:"perun-attributes",url:`/facilities/${this.facility.id}/attributes`,label:"MENU_ITEMS.FACILITY.ATTRIBUTES",style:"facility-btn"})}setSettingsItems(){this.settingItems=[],this.routePolicyService.canNavigate("facilities-settings-managers",this.facility)&&this.settingItems.push({cssIcon:"perun-manager",url:`/facilities/${this.facility.id}/settings/managers`,label:"MENU_ITEMS.FACILITY.MANAGERS",style:"facility-btn"}),this.routePolicyService.canNavigate("facilities-settings-bans",this.facility)&&this.settingItems.push({cssIcon:"perun-ban",url:`/facilities/${this.facility.id}/settings/bans`,label:"MENU_ITEMS.FACILITY.BANS",style:"facility-btn"})}static{this.\u0275fac=function(i){return new(i||t)(u(O),u(B),u(j),u(jt))}}static{this.\u0275cmp=E({type:t,selectors:[["app-facility-overview"]],hostVars:2,hostBindings:function(i,n){i&2&&Y("router-component",n.true)},decls:2,vars:2,consts:[[1,"me-auto","ms-auto"],[3,"items"],[3,"items","title","sectionId"]],template:function(i,n){i&1&&(I(0,ja,1,0,"mat-spinner",0),I(1,Ha,3,4,"div")),i&2&&(b(n.loading?0:-1),a(),b(n.loading?-1:1))},dependencies:[x,Ut,kn,mt,dt],encapsulation:2})}}return t})();var ma=(()=>{class t{static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=E({type:t,selectors:[["app-facility-settings"]],hostVars:2,hostBindings:function(i,n){i&2&&Y("router-component",n.true)},decls:1,vars:0,template:function(i,n){i&1&&S(0,"app-animated-router-outlet")},dependencies:[x,Wt],encapsulation:2,data:{animation:[Yt]}})}}return t})();function Ua(t,f){t&1&&S(0,"mat-spinner",0)}function Ya(t,f){if(t&1&&(r(0,"div"),S(1,"perun-web-apps-menu-buttons-field",1),o()),t&2){let e=d();a(),m("items",e.items)}}var ua=(()=>{class t{constructor(e,i,n,s){this.facilityManager=e,this.authResolver=i,this.entityStorageService=n,this.routePolicyService=s,this.items=[],this.loading=!1}ngOnInit(){this.loading=!0,this.facility=this.entityStorageService.getEntity(),this.initItems(),this.loading=!1}initItems(){this.items=[],this.routePolicyService.canNavigate("facilities-settings-managers",this.facility)&&this.items.push({cssIcon:"perun-manager",url:`/facilities/${this.facility.id}/settings/managers`,label:"MENU_ITEMS.FACILITY.MANAGERS",style:"facility-btn"}),this.routePolicyService.canNavigate("facilities-settings-bans",this.facility)&&this.items.push({cssIcon:"perun-ban",url:`/facilities/${this.facility.id}/settings/bans`,label:"MENU_ITEMS.FACILITY.BANS",style:"facility-btn"})}static{this.\u0275fac=function(i){return new(i||t)(u(O),u(B),u(j),u(jt))}}static{this.\u0275cmp=E({type:t,selectors:[["app-facility-settings-overview"]],hostVars:2,hostBindings:function(i,n){i&2&&Y("router-component",n.true)},decls:2,vars:2,consts:[[1,"me-auto","ms-auto"],[3,"items"]],template:function(i,n){i&1&&(I(0,Ua,1,0,"mat-spinner",0),I(1,Ya,2,1,"div")),i&2&&(b(n.loading?0:-1),a(),b(n.loading?-1:1))},dependencies:[x,Ut,mt,dt],encapsulation:2})}}return t})();function za(t,f){t&1&&(p(0),l(1,"translate")),t&2&&h(" ",c(1,1,"FACILITY_DETAIL.ENTITY")," ")}function $a(t,f){if(t&1&&S(0,"app-one-entity-attribute-page",4),t&2){let e=d();m("entityId",e.facility.id)("entity","facility")}}function Ka(t,f){t&1&&(p(0),l(1,"translate"),l(2,"translate")),t&2&&be(" ",c(1,2,"FACILITY_DETAIL.ENTITY")," - ",c(2,4,"ADMIN_USER.ENTITY")," ")}function qa(t,f){if(t&1&&S(0,"app-two-entity-attribute-page",5),t&2){let e=d(2);m("firstEntity","facility")("firstEntityId",e.facility.id)("secondEntity","user")}}function Xa(t,f){t&1&&(r(0,"mat-tab"),A(1,Ka,3,6,"ng-template",2)(2,qa,1,3,"ng-template",3),o())}var fa=(()=>{class t{constructor(e,i){this.authResolver=e,this.entityStorageService=i}ngOnInit(){this.facility=this.entityStorageService.getEntity(),this.facilityUserAttAuth=this.authResolver.isAuthorized("getAssignedUsers_Facility_policy",[this.facility])}static{this.\u0275fac=function(i){return new(i||t)(u(B),u(j))}}static{this.\u0275cmp=E({type:t,selectors:[["app-facility-attributes"]],hostVars:2,hostBindings:function(i,n){i&2&&Y("router-component",n.true)},decls:9,vars:4,consts:[[1,"page-subtitle"],["mat-stretch-tabs","false"],["matTabLabel",""],["matTabContent",""],[3,"entityId","entity"],[3,"firstEntity","firstEntityId","secondEntity"]],template:function(i,n){i&1&&(r(0,"div")(1,"h1",0),p(2),l(3,"translate"),o(),r(4,"mat-tab-group",1)(5,"mat-tab"),A(6,za,2,3,"ng-template",2)(7,$a,1,2,"ng-template",3),o(),I(8,Xa,3,0,"mat-tab"),o()()),i&2&&(a(2),T(c(3,2,"FACILITY_DETAIL.SETTINGS.ATTRIBUTES.TITLE")),a(6),b(n.facilityUserAttAuth?8:-1))},dependencies:[x,zt,jn,Gt,Qi,Zi,Bt,Pt,M,R],encapsulation:2})}}return t})();var Qa=["FacilityAList"],Za=["ResourceAList"],Ja=["GroupAList"],eo=["MemberAList"];function to(t,f){if(t&1&&S(0,"perun-web-apps-attributes-list",9,0),t&2){let e=d();m("tableId",e.tableId)("attributes",e.facilityAttributes)("selection",e.selectionFacility)}}function io(t,f){if(t&1&&S(0,"perun-web-apps-attributes-list",9,1),t&2){let e=d(2);m("tableId",e.tableId)("attributes",e.resourceAttributes)("selection",e.selectionResource)}}function no(t,f){if(t&1){let e=v();r(0,"mat-tab",6)(1,"button",7),_("click",function(){g(e);let n=d();return C(n.onAddAttResource())}),p(2),l(3,"translate"),o(),r(4,"button",8),_("click",function(){g(e);let n=d();return C(n.onSaveResource())}),p(5),l(6,"translate"),o(),I(7,io,2,3,"perun-web-apps-attributes-list",9),o()}if(t&2){let e=d();m("label",e.resource.name+" (resource)"),a(2),h(" ",c(3,5,"SHARED_LIB.PERUN.SERVICES_CONFIGURATIONS.ADD")," "),a(2),m("disabled",e.selectionResource.selected.length===0),a(),h(" ",c(6,7,"SHARED_LIB.PERUN.SERVICES_CONFIGURATIONS.SAVE")," "),a(2),b(e.resourceAttributes?7:-1)}}function ao(t,f){if(t&1&&S(0,"perun-web-apps-attributes-list",9,2),t&2){let e=d(2);m("tableId",e.tableId)("attributes",e.groupAttributes)("selection",e.selectionGroup)}}function oo(t,f){if(t&1){let e=v();r(0,"mat-tab",6)(1,"button",7),_("click",function(){g(e);let n=d();return C(n.onAddAttGroup())}),p(2),l(3,"translate"),o(),r(4,"button",8),_("click",function(){g(e);let n=d();return C(n.onSaveGroup())}),p(5),l(6,"translate"),o(),I(7,ao,2,3,"perun-web-apps-attributes-list",9),o()}if(t&2){let e=d();m("label",e.group.name+" (group)"),a(2),h(" ",c(3,5,"SHARED_LIB.PERUN.SERVICES_CONFIGURATIONS.ADD")," "),a(2),m("disabled",e.selectionGroup.selected.length===0),a(),h(" ",c(6,7,"SHARED_LIB.PERUN.SERVICES_CONFIGURATIONS.SAVE")," "),a(2),b(e.groupAttributes?7:-1)}}function ro(t,f){if(t&1&&S(0,"perun-web-apps-attributes-list",9,3),t&2){let e=d(2);m("tableId",e.tableId)("attributes",e.memberAttributes)("selection",e.selectionMember)}}function so(t,f){if(t&1){let e=v();r(0,"mat-tab",6)(1,"button",7),_("click",function(){g(e);let n=d();return C(n.onAddAttMember())}),p(2),l(3,"translate"),o(),r(4,"button",8),_("click",function(){g(e);let n=d();return C(n.onSaveMember())}),p(5),l(6,"translate"),o(),I(7,ro,2,3,"perun-web-apps-attributes-list",9),o()}if(t&2){let e=d();m("label",e.member.user.firstName+" "+e.member.user.lastName+" (member)"),a(2),h(" ",c(3,5,"SHARED_LIB.PERUN.SERVICES_CONFIGURATIONS.ADD")," "),a(2),m("disabled",e.selectionMember.selected.length===0),a(),h(" ",c(6,7,"SHARED_LIB.PERUN.SERVICES_CONFIGURATIONS.SAVE")," "),a(2),b(e.memberAttributes?7:-1)}}var ha=(()=>{class t{constructor(e,i){this.attributesManager=e,this.dialog=i,this.selectionFacility=new G(!0,[]),this.selectionResource=new G(!0,[]),this.selectionGroup=new G(!0,[]),this.selectionMember=new G(!0,[]),this.showTab=0,this.tableId=fn}ngOnInit(){this.loadFacilityAttributes()}ngOnChanges(e){if(e.service){this.reloadAll();return}e.resource?e.resource.currentValue===void 0?(this.resourceAttributes=void 0,this.showTab=0):(this.showTab=1,this.loadResourceAttributes()):e.group?e.group.currentValue===void 0?(this.groupAttributes=void 0,this.showTab=1):(this.showTab=2,this.attributesManager.getGroupAttributes(this.group.id).subscribe(i=>this.groupAttributes=i)):e.member&&(e.member.currentValue===void 0?(this.memberAttributes=void 0,this.showTab=2):(this.showTab=3,this.attributesManager.getMemberAttributes(this.member.id).subscribe(i=>this.memberAttributes=i)))}onAddAttFacility(){let e=k();e.width="1050px",e.data={entityId:this.facility.id,entity:"facility",notEmptyAttributes:this.facilityAttributes,style:"facility-theme"},this.dialog.open(bt,e).afterClosed().subscribe(n=>{n==="saved"&&this.reloadAll()})}onSaveFacility(){this.facilityAlist.updateMapAttributes(),this.dialog.open(It,{width:"450px",data:{entityId:this.facility.id,entity:"facility",attributes:this.selectionFacility.selected}}).afterClosed().subscribe(i=>{i&&(this.selectionFacility.clear(),this.ngOnInit())})}onAddAttResource(){let e=k();e.width="1050px",e.data={entityId:this.resource.id,entity:"resource",notEmptyAttributes:this.resourceAttributes,style:"facility-theme"},this.dialog.open(bt,e).afterClosed().subscribe(n=>{n==="saved"&&this.reloadAll()})}onSaveResource(){this.resourceAList.updateMapAttributes(),this.dialog.open(It,{width:"450px",data:{entityId:this.resource.id,entity:"resource",attributes:this.selectionResource.selected}}).afterClosed().subscribe(i=>{i&&(this.selectionResource.clear(),this.ngOnInit())})}onAddAttGroup(){let e=k();e.width="1050px",e.data={entityId:this.group.id,entity:"group",notEmptyAttributes:this.groupAttributes,style:"facility-theme"},this.dialog.open(bt,e).afterClosed().subscribe(n=>{n==="saved"&&this.reloadAll()})}onSaveGroup(){this.groupAList.updateMapAttributes(),this.dialog.open(It,{width:"450px",data:{entityId:this.group.id,entity:"group",attributes:this.selectionGroup.selected}}).afterClosed().subscribe(i=>{i&&(this.selectionGroup.clear(),this.ngOnInit())})}onAddAttMember(){let e=k();e.width="1050px",e.data={entityId:this.member.id,entity:"member",notEmptyAttributes:this.memberAttributes,style:"facility-theme"},this.dialog.open(bt,e).afterClosed().subscribe(n=>{n==="saved"&&this.reloadAll()})}onSaveMember(){this.memberAList.updateMapAttributes(),this.dialog.open(It,{width:"450px",data:{entityId:this.member.id,entity:"member",attributes:this.selectionMember.selected}}).afterClosed().subscribe(i=>{i&&(this.selectionMember.clear(),this.ngOnInit())})}loadResourceAttributes(){this.service==="NOT_SELECTED"?this.attributesManager.getResourceAttributes(this.resource.id).subscribe(e=>this.resourceAttributes=e):this.service==="ALL"?this.attributesManager.getRequiredAttributesResource(this.resource.id).subscribe(e=>this.resourceAttributes=e):this.attributesManager.getRequiredAttributesResourceService(this.service.id,this.resource.id).subscribe(e=>this.resourceAttributes=e)}loadFacilityAttributes(){this.service==="NOT_SELECTED"?this.attributesManager.getFacilityAttributes(this.facility.id).subscribe(e=>this.facilityAttributes=e):this.service==="ALL"?this.attributesManager.getRequiredAttributesFacility(this.facility.id).subscribe(e=>this.facilityAttributes=e):this.attributesManager.getRequiredAttributesFacilityService(this.service.id,this.facility.id).subscribe(e=>this.facilityAttributes=e)}reloadAll(){this.loadFacilityAttributes(),this.resource!==void 0&&this.loadResourceAttributes()}static{this.\u0275fac=function(i){return new(i||t)(u(Vt),u(J))}}static{this.\u0275cmp=E({type:t,selectors:[["app-perun-web-apps-service-configurator"]],viewQuery:function(i,n){if(i&1&&(Se(Qa,5),Se(Za,5),Se(Ja,5),Se(eo,5)),i&2){let s;ve(s=Ie())&&(n.facilityAlist=s.first),ve(s=Ie())&&(n.resourceAList=s.first),ve(s=Ie())&&(n.groupAList=s.first),ve(s=Ie())&&(n.memberAList=s.first)}},inputs:{facility:"facility",service:"service",resource:"resource",group:"group",member:"member"},features:[Tt],decls:13,vars:14,consts:[["FacilityAList",""],["ResourceAList",""],["GroupAList",""],["MemberAList",""],[1,"min-height"],["mat-stretch-tabs","false",3,"selectedIndexChange","dynamicHeight","selectedIndex"],[3,"label"],["mat-flat-button","","color","accent",1,"me-2","mt-3",3,"click"],["mat-flat-button","","color","accent",1,"me-2","mt-3",3,"click","disabled"],[3,"tableId","attributes","selection"]],template:function(i,n){i&1&&(r(0,"div",4)(1,"mat-tab-group",5),Me("selectedIndexChange",function(y){return Re(n.showTab,y)||(n.showTab=y),y}),r(2,"mat-tab",6)(3,"button",7),_("click",function(){return n.onAddAttFacility()}),p(4),l(5,"translate"),o(),r(6,"button",8),_("click",function(){return n.onSaveFacility()}),p(7),l(8,"translate"),o(),I(9,to,2,3,"perun-web-apps-attributes-list",9),o(),I(10,no,8,9,"mat-tab",6),I(11,oo,8,9,"mat-tab",6),I(12,so,8,9,"mat-tab",6),o()()),i&2&&(a(),m("dynamicHeight",!0),De("selectedIndex",n.showTab),a(),m("label",n.facility.name+" (facility)"),a(2),h(" ",c(5,10,"SHARED_LIB.PERUN.SERVICES_CONFIGURATIONS.ADD")," "),a(2),m("disabled",n.selectionFacility.selected.length===0),a(),h(" ",c(8,12,"SHARED_LIB.PERUN.SERVICES_CONFIGURATIONS.SAVE")," "),a(2),b(n.facilityAttributes?9:-1),a(),b(n.resource?10:-1),a(),b(n.group?11:-1),a(),b(n.member?12:-1))},dependencies:[x,w,L,Gt,Bt,Pt,M,Ht,R],styles:[".min-height[_ngcontent-%COMP%]{min-height:500px}"]})}}return t})();var Xt=(t,f)=>f.id;function po(t,f){if(t&1){let e=v();r(0,"mat-option",8),_("onSelectionChange",function(){let n=g(e).$implicit,s=d(3);return C(s.onSelectedService(n))}),p(1),o()}if(t&2){let e=f.$implicit;m("value",e),a(),h(" ",e.name," ")}}function mo(t,f){if(t&1){let e=v();r(0,"mat-form-field",4)(1,"mat-label"),p(2),l(3,"translate"),o(),r(4,"input",6),_("keyup",function(n){g(e);let s=d(2);return C(s.updatedSerVal(n))}),o(),r(5,"mat-autocomplete",7,0)(7,"mat-option",8),_("onSelectionChange",function(){g(e);let n=d(2);return C(n.onSelectedService("NOT_SELECTED"))}),p(8),l(9,"translate"),o(),r(10,"mat-option",8),_("onSelectionChange",function(){g(e);let n=d(2);return C(n.onSelectedService("ALL"))}),p(11),l(12,"translate"),o(),Ee(13,po,2,2,"mat-option",9,Xt),l(15,"async"),o()()}if(t&2){let e=F(6),i=d(2);a(2),T(c(3,8,"FACILITY_DETAIL.SERVICE_CONFIG.SERVICE_SELECT")),a(2),m("formControl",i.serviceField)("matAutocomplete",e),a(),m("displayWith",i.serviceDisplayFn.bind(i)),a(2),m("value","NOT_SELECTED"),a(),h(" ",c(9,10,"FACILITY_DETAIL.SERVICE_CONFIG.NOT_SELECTED")," "),a(2),m("value","ALL"),a(),h(" ",c(12,12,"FACILITY_DETAIL.SERVICE_CONFIG.ALL")," "),a(2),xe(c(15,14,i.filteredServices))}}function uo(t,f){if(t&1){let e=v();r(0,"mat-option",8),_("onSelectionChange",function(){let n=g(e).$implicit,s=d(3);return C(s.onSelectedResource(n))}),p(1),o()}if(t&2){let e=f.$implicit;m("value",e),a(),h(" ",e.name," ")}}function fo(t,f){if(t&1){let e=v();r(0,"mat-form-field",4)(1,"mat-label"),p(2),l(3,"translate"),o(),r(4,"input",6),_("keyup",function(n){g(e);let s=d(2);return C(s.updatedResVal(n))}),o(),r(5,"mat-autocomplete",7,0),Ee(7,uo,2,2,"mat-option",9,Xt),l(9,"async"),o()()}if(t&2){let e=F(6),i=d(2);a(2),T(c(3,4,"FACILITY_DETAIL.SERVICE_CONFIG.RES_SELECT")),a(2),m("formControl",i.resourceField)("matAutocomplete",e),a(),m("displayWith",i.resourceDisplayFn.bind(i)),a(2),xe(c(9,6,i.filteredResources))}}function ho(t,f){if(t&1){let e=v();r(0,"mat-option",8),_("onSelectionChange",function(){let n=g(e).$implicit,s=d(3);return C(s.onSelectedGroup(n))}),p(1),o()}if(t&2){let e=f.$implicit;m("value",e),a(),h(" ",e.name," ")}}function _o(t,f){if(t&1){let e=v();r(0,"mat-form-field",4)(1,"mat-label"),p(2),l(3,"translate"),o(),r(4,"input",6),_("keyup",function(n){g(e);let s=d(2);return C(s.updatedGroupVal(n))}),o(),r(5,"mat-autocomplete",10,0),Ee(7,ho,2,2,"mat-option",9,Xt),l(9,"async"),o()()}if(t&2){let e=F(6),i=d(2);a(2),T(c(3,4,"FACILITY_DETAIL.SERVICE_CONFIG.GROUP_SELECT")),a(2),m("formControl",i.groupField)("matAutocomplete",e),a(),m("displayWith",i.groupDisplayFn.bind(i)),a(2),xe(c(9,6,i.filteredGroups))}}function go(t,f){if(t&1){let e=v();r(0,"mat-option",8),_("onSelectionChange",function(){let n=g(e).$implicit,s=d(3);return C(s.onSelectedMember(n))}),p(1),l(2,"userFullName"),o()}if(t&2){let e=f.$implicit;m("value",e),a(),h(" ",c(2,2,e.user)," ")}}function Co(t,f){if(t&1&&(r(0,"mat-form-field",4)(1,"mat-label"),p(2),l(3,"translate"),o(),S(4,"input",11),r(5,"mat-autocomplete",7,0),Ee(7,go,3,4,"mat-option",9,Xt),l(9,"async"),o()()),t&2){let e=F(6),i=d(2);a(2),T(c(3,4,"FACILITY_DETAIL.SERVICE_CONFIG.MEMBER_SELECT")),a(2),m("matAutocomplete",e)("formControl",i.memberField),a(),m("displayWith",i.memberDisplayFn.bind(i)),a(2),xe(c(9,6,i.filteredMembers))}}function So(t,f){if(t&1){let e=v();r(0,"div",2),I(1,mo,16,16,"mat-form-field",4),r(2,"mat-checkbox",5),_("change",function(n){g(e);let s=d();return C(s.onOfferAllServices(n))}),p(3),l(4,"translate"),o(),I(5,fo,10,8,"mat-form-field",4),I(6,_o,10,8,"mat-form-field",4),I(7,Co,10,8,"mat-form-field",4),o()}if(t&2){let e=d();a(),b(e.services!==void 0?1:-1),a(2),h(" ",c(4,5,"FACILITY_DETAIL.SERVICE_CONFIG.ALL_SERVICES")," "),a(2),b(e.resources!==void 0&&e.resources.length!==0?5:-1),a(),b(e.selectedResource!==void 0&&e.groups!==void 0&&e.groups.length!==0?6:-1),a(),b(e.selectedGroup!==void 0&&e.members!==void 0&&e.members.length!==0?7:-1)}}function vo(t,f){if(t&1&&S(0,"app-perun-web-apps-service-configurator",3),t&2){let e=d();m("facility",e.facility)("resource",e.selectedResource)("group",e.selectedGroup)("member",e.selectedMember)("service",e.selectedService)}}var Sa=(()=>{class t{constructor(e,i,n,s,y,D,q){this.facilityManager=e,this.resourceManager=i,this.serviceManager=n,this.membersManager=s,this.namePipe=y,this.translate=D,this.entityStorageService=q,this.serviceField=new le,this.resourceField=new le,this.groupField=new le,this.memberField=new le,this.allowedStatuses=["INVALID","VALID"],this.selectedService="NOT_SELECTED",this.attrNames=[],this.translate.get("FACILITY_DETAIL.SERVICE_CONFIG.ALL").subscribe(U=>this.serviceAllTranslation=U),this.translate.get("FACILITY_DETAIL.SERVICE_CONFIG.NOT_SELECTED").subscribe(U=>this.serviceNotSelectedTranslation=U)}ngOnInit(){this.facility=this.entityStorageService.getEntity(),this.facilityManager.getFacilityById(this.facility.id).subscribe(e=>{this.facility=e,this.facilityManager.getAssignedResourcesForFacility(e.id).subscribe(i=>this.resources=i),this.serviceManager.getAssignedServices(e.id).subscribe(i=>this.services=i)}),this.filteredServices=this.serviceField.valueChanges.pipe(je(""),Ge(e=>this._filterServices(e))),this.filteredResources=this.resourceField.valueChanges.pipe(je(""),Ge(e=>this._filterResources(e))),this.filteredGroups=this.groupField.valueChanges.pipe(je(""),Ge(e=>this._filterGroups(e))),this.filteredMembers=this.memberField.valueChanges.pipe(je(""),Ge(e=>this._filterMembers(e)))}onSelectedService(e){this.selectedService=e}onSelectedResource(e){this.selectedResource=e,this.selectedResource!==void 0?(this.resourceManager.getAssignedGroups(this.selectedResource.id).subscribe(i=>this.groups=i),this.selectedGroup=void 0,this.selectedMember=void 0):this.groups=void 0}onOfferAllServices(e){e.checked||this.serviceManager.getAssignedServices(this.facility.id).subscribe(i=>this.services=i)}onSelectedGroup(e){this.selectedGroup=e,this.selectedGroup!==void 0?(this.membersManager.getCompleteRichMembersForGroup(this.selectedGroup.id,!1,this.allowedStatuses,[],this.attrNames).subscribe(i=>this.members=i),this.selectedMember=void 0):this.members=void 0}onSelectedMember(e){this.selectedMember=e}serviceDisplayFn(e){if(e!==null)return e==="ALL"?this.serviceAllTranslation:e==="NOT_SELECTED"?this.serviceNotSelectedTranslation:typeof e!="string"?e.name:e}resourceDisplayFn(e){if(e!==null)return e.name}groupDisplayFn(e){if(e!==null)return e.name}memberDisplayFn(e){if(e!==null)return this.namePipe.transform(e.user)}updatedSerVal(e){e.target.value===""&&(this.selectedService="NOT_SELECTED")}updatedResVal(e){e.target.value===""&&(this.groups=void 0,this.members=void 0)}updatedGroupVal(e){e.target.value===""&&(this.members=void 0)}_filterServices(e){let i=e.toString().toLowerCase();return this.services.filter(n=>n.name.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").includes(i))}_filterResources(e){let i=e.toString().toLowerCase();return this.resources.filter(n=>n.name.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").includes(i))}_filterGroups(e){let i=e.toString().toLowerCase();return this.groups.filter(n=>n.name.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").includes(i))}_filterMembers(e){let i=e.toString().toLowerCase();return this.members.filter(n=>this.namePipe.transform(n.user).toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").includes(i))}static{this.\u0275fac=function(i){return new(i||t)(u(O),u(_t),u(ue),u(Bi),u(Pe),u(ce),u(j))}}static{this.\u0275cmp=E({type:t,selectors:[["app-facility-service-config"]],decls:6,vars:5,consts:[["auto","matAutocomplete"],[1,"page-subtitle"],[1,"col-12","col-lg-6","mb-2"],[3,"facility","resource","group","member","service"],[1,"w-100"],[3,"change"],["matInput","","type","text",3,"keyup","formControl","matAutocomplete"],["autoActiveFirstOption","",3,"displayWith"],[3,"onSelectionChange","value"],[3,"value"],["autoActiveFirstOption","",3,"displayWith","ngClass"],["matInput","","type","text",3,"matAutocomplete","formControl"]],template:function(i,n){i&1&&(r(0,"div")(1,"h1",1),p(2),l(3,"translate"),o(),I(4,So,8,7,"div",2),I(5,vo,1,5,"app-perun-web-apps-service-configurator",3),o()),i&2&&(a(2),T(c(3,3,"FACILITY_DETAIL.SERVICE_CONFIG.TITLE")),a(2),b(n.facility?4:-1),a(),b(n.facility?5:-1))},dependencies:[x,yi,pt,ct,lt,ft,ut,Ot,Lt,Le,we,Ke,We,ze,$e,Ln,Fn,wn,M,ha,xt,R,Pe],encapsulation:2})}}return t})();var Qt=(()=>{class t{constructor(e,i,n){this.facilityService=e,this.guiAuthResolver=i,this.entityStorageService=n,this.disableRouting=!1,this.disableSelf=!1,this.availableRoles=[],this.selected="user",this.type="Facility",this.theme="facility-theme"}ngOnInit(){this.facility=this.entityStorageService.getEntity(),this.guiAuthResolver.assignAvailableRoles(this.availableRoles,"Facility")}static{this.\u0275fac=function(i){return new(i||t)(u(O),u(B),u(j))}}static{this.\u0275cmp=E({type:t,selectors:[["app-perun-web-apps-facility-settings-managers"]],hostVars:2,hostBindings:function(i,n){i&2&&Y("router-component",n.true)},inputs:{disableRouting:"disableRouting",disableSelf:"disableSelf"},decls:1,vars:6,consts:[[3,"complementaryObject","availableRoles","complementaryObjectType","disableSelf","disableRouting","theme"]],template:function(i,n){i&1&&S(0,"app-managers-page",0),i&2&&m("complementaryObject",n.facility)("availableRoles",n.availableRoles)("complementaryObjectType",n.type)("disableSelf",n.disableSelf)("disableRouting",n.disableRouting)("theme",n.theme)},dependencies:[x,$t],encapsulation:2})}}return t})();var Io=(t,f)=>f.id;function bo(t,f){t&1&&S(0,"perun-web-apps-loading-dialog")}function yo(t,f){t&1&&(r(0,"mat-option",6),p(1),l(2,"translate"),o()),t&2&&(a(),T(c(2,1,"DIALOGS.ADD_SERVICE_DESTINATION.SELECTION_ALL")))}function To(t,f){t&1&&(r(0,"mat-option",7),p(1),l(2,"translate"),o()),t&2&&(a(),T(c(2,1,"DIALOGS.ADD_SERVICE_DESTINATION.NO_SERVICE")))}function Ao(t,f){if(t&1&&(r(0,"mat-option",8),p(1),o()),t&2){let e=f.$implicit;m("value",e),a(),h(" ",e.name," ")}}function Eo(t,f){t&1&&(r(0,"mat-error"),p(1),l(2,"translate"),o()),t&2&&(a(),h(" ",c(2,1,"DIALOGS.ADD_SERVICE_DESTINATION.CHOOSE_SERVICE")," "))}function xo(t,f){if(t&1&&(r(0,"mat-option",8),p(1),o()),t&2){let e=f.$implicit,i=d(2);m("value",e),a(),h(" ",i.getTypeForView(e)," ")}}function Do(t,f){t&1&&(r(0,"mat-error"),p(1),l(2,"translate"),o()),t&2&&(a(),h(" ",c(2,1,"DIALOGS.ADD_SERVICE_DESTINATION.REQUIRED_FIELD")," "))}function Ro(t,f){t&1&&(r(0,"mat-error"),p(1),l(2,"translate"),o()),t&2&&(a(),h(" ",c(2,1,"DIALOGS.ADD_SERVICE_DESTINATION.INVALID_DESTINATION")," "))}function Mo(t,f){if(t&1&&(r(0,"mat-form-field",11)(1,"mat-label"),p(2),o(),S(3,"input",17),I(4,Do,3,3,"mat-error"),I(5,Ro,3,3,"mat-error"),o()),t&2){let e=d(2);a(2),T(e.getTypeForView(e.selectedType)),a(),m("formControl",e.destinationControl),a(),b(e.selectedType==="host"&&!e.useFacilityHost&&e.destinationControl.hasError("required")?4:-1),a(),b(e.destinationControl.hasError("invalidDestination")?5:-1)}}function Fo(t,f){if(t&1){let e=v();r(0,"mat-checkbox",13),Me("ngModelChange",function(n){g(e);let s=d(2);return Re(s.useFacilityHost,n)||(s.useFacilityHost=n),C(n)}),p(1),l(2,"translate"),o()}if(t&2){let e=d(2);De("ngModel",e.useFacilityHost),a(),h(" ",c(2,2,"DIALOGS.ADD_SERVICE_DESTINATION.USE_FACILITY_HOST")," ")}}function wo(t,f){if(t&1&&(r(0,"mat-option",8),p(1),o()),t&2){let e=f.$implicit;m("value",e),a(),h(" ",e," ")}}function Lo(t,f){if(t&1){let e=v();r(0,"div")(1,"h1",2),p(2),l(3,"translate"),o(),r(4,"div",3)(5,"div",4),p(6),l(7,"translate"),o(),r(8,"mat-form-field")(9,"mat-label"),p(10),l(11,"translate"),o(),r(12,"mat-select",5),I(13,yo,3,3,"mat-option",6),I(14,To,3,3,"mat-option",7),Ee(15,Ao,2,2,"mat-option",8,Io),o(),I(17,Eo,3,3,"mat-error"),o(),r(18,"mat-checkbox",9),_("change",function(){g(e);let n=d();return C(n.getServices())}),Me("ngModelChange",function(n){g(e);let s=d();return Re(s.servicesOnFacility,n)||(s.servicesOnFacility=n),C(n)}),p(19),l(20,"translate"),o(),r(21,"mat-form-field")(22,"mat-label"),p(23),l(24,"translate"),o(),r(25,"mat-select",10),Me("ngModelChange",function(n){g(e);let s=d();return Re(s.selectedType,n)||(s.selectedType=n),C(n)}),_("selectionChange",function(){g(e);let n=d();return C(n.destinationControl.updateValueAndValidity())}),Ee(26,xo,2,2,"mat-option",8,ni),o()(),I(28,Mo,6,4,"mat-form-field",11),I(29,Fo,3,4,"mat-checkbox",12),r(30,"mat-form-field")(31,"mat-label"),p(32),l(33,"translate"),o(),r(34,"mat-select",13),Me("ngModelChange",function(n){g(e);let s=d();return Re(s.selectedPropagation,n)||(s.selectedPropagation=n),C(n)}),Ee(35,wo,2,2,"mat-option",8,ni),o()(),r(37,"div",4),p(38),l(39,"translate"),o()(),r(40,"div",14)(41,"button",15),_("click",function(){g(e);let n=d();return C(n.onCancel())}),p(42),l(43,"translate"),o(),r(44,"button",16),_("click",function(){g(e);let n=d();return C(n.onSubmit())}),p(45),l(46,"translate"),o()()()}if(t&2){let e=d();a(2),T(c(3,19,"DIALOGS.ADD_SERVICE_DESTINATION.TITLE")),a(4),T(c(7,21,"DIALOGS.ADD_SERVICE_DESTINATION.DESCRIPTION")),a(4),T(c(11,23,"DIALOGS.ADD_SERVICE_DESTINATION.SERVICE")),a(2),m("formControl",e.serviceControl),a(),b(e.services.length!==0?13:-1),a(),b(e.services.length===0?14:-1),a(),xe(e.services),a(2),b(e.serviceControl.value===void 0?17:-1),a(),De("ngModel",e.servicesOnFacility),a(),h(" ",c(20,25,"DIALOGS.ADD_SERVICE_DESTINATION.IS_SERVICES_ONLY_ON_FACILITY")," "),a(4),T(c(24,27,"DIALOGS.ADD_SERVICE_DESTINATION.TYPE")),a(2),De("ngModel",e.selectedType),a(),xe(e.types),a(2),b(e.selectedType==="host"&&e.useFacilityHost?-1:28),a(),b(e.selectedType==="host"?29:-1),a(3),T(c(33,29,"DIALOGS.ADD_SERVICE_DESTINATION.PROPAGATION")),a(2),De("ngModel",e.selectedPropagation),a(),xe(e.propagations),a(3),h(" ",c(39,31,"DIALOGS.ADD_SERVICE_DESTINATION.PROPAGATION_TYPE_"+e.selectedPropagation)," "),a(4),h(" ",c(43,33,"DIALOGS.ADD_SERVICE_DESTINATION.CANCEL")," "),a(2),m("disabled",e.loading||e.invalidDestination()||e.serviceControl.invalid||e.serviceControl.value==="noService"),a(),h(" ",c(46,35,"DIALOGS.ADD_SERVICE_DESTINATION.ADD")," ")}}var va=(()=>{class t{constructor(e,i,n,s){this.dialogRef=e,this.data=i,this.facilitiesManager=n,this.servicesManager=s,this.services=[],this.types=["host","user@host","user@host:port","user@host-windows","host-windows-proxy","url","service-specific","s3","s3-json","url-json"],this.selectedType="host",this.propagations=["PARALLEL","DUMMY"],this.selectedPropagation="PARALLEL",this.useFacilityHost=!1,this.loading=!1,this.emailRegex=new RegExp(en),this.hostPattern=new RegExp("^(?!:\\/\\/)(?=.{1,255}$)((.{1,63}\\.){1,127}(?![0-9]*$)[a-z0-9-]+\\.?)$|^(25[0-5]|2[0-4]\\d|[0-1]?\\d?\\d)(\\.(25[0-5]|2[0-4]\\d|[0-1]?\\d?\\d)){3}$"),this.urlPattern=new RegExp("^(https?|ftp|file)://[-a-zA-Z0-9+&@#/%?=~_|!:,.;()*$']*[-a-zA-Z0-9+&@#/%=~_|()*$']$"),this.userAtHostPattern=new RegExp("^[a-z_]([a-z0-9_-]{0,31}|[a-z0-9_-]{0,30}\\$)@(?:(?!:\\/\\/)(?=.{1,255}$)((.{1,63}\\.){1,127}(?![0-9]*$)[a-z0-9-]+\\.?)$|(25[0-5]|2[0-4]\\d|[0-1]?\\d?\\d)(\\.(25[0-5]|2[0-4]\\d|[0-1]?\\d?\\d)){3}$)"),this.userAtHostPortPattern=new RegExp("^[a-z_]([a-z0-9_-]{0,31}|[a-z0-9_-]{0,30}\\$)@(?:(?!:\\/\\/)(?=.{1,255}$)((.{1,63}\\.){1,127}(?![0-9]*$)[a-z0-9-]+\\.?)|(25[0-5]|2[0-4]\\d|[0-1]?\\d?\\d)(\\.(25[0-5]|2[0-4]\\d|[0-1]?\\d?\\d)){3}):[0-9]+"),this.serviceSpecificPattern=new RegExp("^(?!-)[a-zA-Z0-9-_.:/]*$"),this.s3Pattern=new RegExp("^(https?://[-a-zA-Z0-9+&@#/%?=~_|!:,.;()*$']+)/([-a-zA-Z0-9+&@#%?=~_|!:,.;()*$'']+)$"),this.s3JsonPattern=this.s3Pattern,this.urlJsonPattern=this.urlPattern}ngOnInit(){this.serviceControl=new le(void 0,Fe.required),this.destinationControl=new le("",this.getDestinationValidator()),this.emailControl=new le("",[Fe.required,Fe.pattern(this.emailRegex)]),this.servicesOnFacility=!0,this.getServices()}onCancel(){this.dialogRef.close()}onSubmit(){this.loading=!0,this.serviceControl.value==="all"?this.useFacilityHost?this.servicesManager.addDestinationsDefinedByHostsOnFacilityWithListOfServiceAndFacility({services:this.services,facility:this.data.facility.id}).subscribe(()=>{this.dialogRef.close(!0)},()=>this.loading=!1):this.servicesManager.addDestinationToMultipleServices({services:this.services,facility:this.data.facility.id,destination:this.destinationControl.value,type:this.selectedType,propagationType:this.selectedPropagation}).subscribe(()=>{this.dialogRef.close(!0)},()=>this.loading=!1):this.useFacilityHost?this.servicesManager.addDestinationsDefinedByHostsOnFacilityWithServiceAndFacility(this.serviceControl.value.id,this.data.facility.id).subscribe(()=>{this.dialogRef.close(!0)},()=>this.loading=!1):this.servicesManager.addDestination(this.serviceControl.value.id,this.data.facility.id,this.destinationControl.value,this.selectedType,this.selectedPropagation).subscribe(()=>{this.dialogRef.close(!0)},()=>this.loading=!1)}getServices(){this.loading=!0,this.servicesOnFacility?this.data.configServices.length!==0?this.services=this.data.configServices:this.servicesManager.getAssignedServices(this.data.facility.id).subscribe(e=>{this.services=e},()=>this.loading=!1):this.servicesManager.getServices().subscribe(e=>{this.services=e},()=>this.loading=!1),this.loading=!1,this.serviceControl.setValue(void 0)}getTypeForView(e){return e==="service-specific"?"Service Specific":e}invalidDestination(){return this.selectedType==="host"&&this.useFacilityHost?!1:this.destinationControl.invalid}getDestinationValidator(){return e=>{if(!e.value)return null;let i;switch(this.selectedType){case"host":case"host-windows-proxy":i=this.hostPattern;break;case"url":i=this.urlPattern;break;case"user@host":case"user@host-windows":i=this.userAtHostPattern;break;case"user@host:port":i=this.userAtHostPortPattern;break;case"service-specific":i=this.serviceSpecificPattern;break;case"s3":i=this.s3Pattern;break;case"s3-json":i=this.s3JsonPattern;break;case"url-json":i=this.urlJsonPattern;break;default:return null}return i.test(e.value)?null:{invalidDestination:{value:e.value}}}}static{this.\u0275fac=function(i){return new(i||t)(u(W),u(z),u(O),u(ue))}}static{this.\u0275cmp=E({type:t,selectors:[["app-perun-web-apps-add-services-destination-dialog"]],decls:4,vars:5,consts:[["spinner",""],[4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],["mat-dialog-title",""],["mat-dialog-content","",1,"dialog-container"],[1,"font-italic"],["required","",3,"formControl"],["value","all"],["value","noService"],[3,"value"],[3,"change","ngModelChange","ngModel"],[3,"ngModelChange","selectionChange","ngModel"],[1,"w-100"],[3,"ngModel"],[3,"ngModelChange","ngModel"],["mat-dialog-actions",""],["mat-stroked-button","",1,"ms-auto",3,"click"],["color","accent","mat-flat-button","",1,"ms-2",3,"click","disabled"],["matInput","","required","",3,"formControl"]],template:function(i,n){if(i&1&&(A(0,bo,1,0,"ng-template",null,0,V),r(2,"div"),A(3,Lo,47,37,"div",1),o()),i&2){let s=F(1);a(2),Z(fe("",n.data.theme," position-relative")),a(),m("perunWebAppsLoader",n.loading)("perunWebAppsLoaderIndicator",s)}},dependencies:[x,w,L,pt,ct,lt,wt,ft,ut,Ot,Mi,Lt,Le,we,Ke,We,ze,Dt,$e,xi,Ei,ne,ee,ie,te,he,M,N,R],encapsulation:2,data:{animation:[Dn]}})}}return t})();function Oo(t,f){t&1&&(r(0,"perun-web-apps-alert",2),p(1),l(2,"translate"),o()),t&2&&(a(),h(" ",c(2,1,"FACILITY_DETAIL.SERVICES_DESTINATIONS.DESTINATIONS_INFO")," "))}function ko(t,f){if(t&1){let e=v();r(0,"button",10),_("click",function(){g(e);let n=d();return C(n.addDestination())}),p(1),l(2,"translate"),o()}t&2&&(a(),h(" ",c(2,1,"FACILITY_DETAIL.SERVICES_DESTINATIONS.ADD")," "))}function Vo(t,f){if(t&1){let e=v();r(0,"button",11),_("click",function(){g(e);let n=d();return C(n.removeDestination())}),p(1),l(2,"translate"),o()}if(t&2){let e=d();m("disabled",e.loading||e.selected.selected.length===0),a(),h(" ",c(2,2,"FACILITY_DETAIL.SERVICES_DESTINATIONS.REMOVE")," ")}}function No(t,f){if(t&1){let e=v();r(0,"button",12),_("click",function(){g(e);let n=d();return C(n.onAllow())}),r(1,"mat-icon"),p(2," check_circle_outline "),o(),p(3),l(4,"translate"),o()}if(t&2){let e=d();m("disabled",e.loading||e.selected.selected.length===0||e.allSelectedAllowed()),a(3),h(" ",c(4,2,"FACILITY_DETAIL.SERVICES_DESTINATIONS.ALLOW")," ")}}function Bo(t,f){if(t&1){let e=v();r(0,"button",12),_("click",function(){g(e);let n=d();return C(n.onBlock())}),r(1,"mat-icon"),p(2," block "),o(),p(3),l(4,"translate"),o()}if(t&2){let e=d();m("disabled",e.loading||e.selected.selected.length===0||e.allSelectedBlocked()),a(3),h(" ",c(4,2,"FACILITY_DETAIL.SERVICES_DESTINATIONS.BLOCK")," ")}}function Po(t,f){t&1&&S(0,"perun-web-apps-loading-table")}function Go(t,f){if(t&1&&S(0,"app-perun-web-apps-destination-list",13),t&2){let e=d();m("filterValue",e.filterValue)("loading",e.loading)("selection",e.selected)("cachedSubject",e.cachedSubject)("destinations",e.destinations)("services",e.configServicesIds)("displayedColumns",e.displayedColumns)("tableId",e.tableId)}}var Zt=(()=>{class t{static{this.id="FacilityServicesDestinationsComponent"}constructor(e,i,n,s,y,D,q){this.dialog=e,this.servicesManager=i,this.translate=n,this.notificator=s,this.authResolver=y,this.serviceManager=D,this.entityStorageService=q,this.displayedColumns=["select","destinationId","service","destination","type","status","propagationType","lastSuccessfulPropagation","lastAttemptedPropagation"],this.configServices=[],this.configServicesIds=new Set,this.title="FACILITY_DETAIL.SERVICES_DESTINATIONS.TITLE",this.destinationEmitter=new Et,this.destinations=[],this.selected=new G(!0,[],!0,(U,X)=>U.id===X.id&&U.facility?.id===X.facility?.id&&U.service?.id===X.service?.id),this.cachedSubject=new oe(!0),this.filterValue="",this.tableId=hn}ngOnInit(){this.loading=!0,this.facility=this.entityStorageService.getEntity(),this.setAuthRights(),this.refreshTable()}refreshTable(){this.loading=!0,this.servicesManager.getAllRichDestinationsForFacility(this.facility.id).subscribe(e=>{this.destinations=e,this.destinationEmitter.emit(this.destinations),this.selected.clear(),this.cachedSubject.next(!0),this.setAuthRights(),this.loading=!1})}setAuthRights(){this.addAuth=this.authResolver.isAuthorized("addDestination_Service_Facility_Destination_policy",[this.facility]),this.removeAuth=this.authResolver.isAuthorized("removeDestination_Service_Facility_Destination_policy",[this.facility]),this.allowAuth=this.authResolver.isAuthorized("unblockServiceOnDestination_Service_int_policy",[this.facility]),this.blockAuth=this.authResolver.isAuthorized("blockServiceOnDestination_Service_int_policy",[this.facility]),this.displayedColumns=this.removeAuth?this.displayedColumns:this.displayedColumns.filter(e=>e!=="select")}addDestination(){let e=k();e.width="600px",e.data={facility:this.facility,theme:"facility-theme",configServices:this.configServices},this.dialog.open(va,e).afterClosed().subscribe(n=>{n&&(this.refreshTable(),this.notificator.showSuccess(this.translate.instant("FACILITY_DETAIL.SERVICES_DESTINATIONS.ADD_SUCCESS")))})}removeDestination(){let e=k();e.width="600px",e.data={destinations:this.selected.selected,theme:"facility-theme"},this.dialog.open(ta,e).afterClosed().subscribe(n=>{n&&this.refreshTable()})}blockServicesOnDestinations(e){this.serviceManager.blockServicesOnDestinations({richDestinations:e}).subscribe({next:()=>{this.notificator.showSuccess(this.translate.instant("FACILITY_DETAIL.SERVICES_DESTINATIONS.BLOCK_SUCCESS")),this.refreshTable()},error:()=>this.loading=!1})}onBlock(){this.loading=!0,this.blockServicesOnDestinations(this.selected.selected)}allowServicesOnDestinations(e){this.serviceManager.unblockServicesOnDestinations({richDestinations:e}).subscribe({next:()=>{this.notificator.showSuccess(this.translate.instant("FACILITY_DETAIL.SERVICES_DESTINATIONS.ALLOW_SUCCESS")),this.refreshTable()},error:()=>this.loading=!1})}onAllow(){this.loading=!0,this.allowServicesOnDestinations(this.selected.selected)}applyFilter(e){this.filterValue=e,this.refreshTable()}allSelectedAllowed(){return this.selected.selected.reduce((e,i)=>e&&!i.blocked,!0)}allSelectedBlocked(){return this.selected.selected.reduce((e,i)=>e&&i.blocked,!0)}static{this.\u0275fac=function(i){return new(i||t)(u(J),u(ue),u(ht),u(H),u(B),u(ue),u(j))}}static{this.\u0275cmp=E({type:t,selectors:[["app-perun-web-apps-facility-services-destinations"]],hostVars:2,hostBindings:function(i,n){i&2&&Y("router-component",n.true)},inputs:{displayedColumns:"displayedColumns",configServices:"configServices",configServicesIds:"configServicesIds",title:"title",loading:"loading"},outputs:{destinationEmitter:"destinationEmitter"},decls:15,vars:11,consts:[["spinner",""],[1,"page-subtitle"],["alert_type","info"],[3,"refresh"],["color","accent","mat-flat-button","",1,"me-2","action-button"],["color","warn","mat-flat-button","",1,"me-2",3,"disabled"],["mat-stroked-button","",1,"me-2",3,"disabled"],[3,"filter","placeholder"],[1,"position-relative","table-min-height"],[3,"filterValue","loading","selection","cachedSubject","destinations","services","displayedColumns","tableId",4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],["color","accent","mat-flat-button","",1,"me-2","action-button",3,"click"],["color","warn","mat-flat-button","",1,"me-2",3,"click","disabled"],["mat-stroked-button","",1,"me-2",3,"click","disabled"],[3,"filterValue","loading","selection","cachedSubject","destinations","services","displayedColumns","tableId"]],template:function(i,n){if(i&1){let s=v();r(0,"div")(1,"h1",1),p(2),l(3,"translate"),o(),I(4,Oo,3,3,"perun-web-apps-alert",2),r(5,"perun-web-apps-refresh-button",3),_("refresh",function(){return g(s),C(n.refreshTable())}),o(),I(6,ko,3,3,"button",4),I(7,Vo,3,4,"button",5),I(8,No,5,4,"button",6),I(9,Bo,5,4,"button",6),r(10,"perun-web-apps-debounce-filter",7),_("filter",function(D){return g(s),C(n.applyFilter(D))}),o(),A(11,Po,1,0,"ng-template",null,0,V),r(13,"div",8),A(14,Go,1,8,"app-perun-web-apps-destination-list",9),o()()}if(i&2){let s=F(12);a(2),T(c(3,9,n.title)),a(2),b(n.title.includes("CONFIG")?4:-1),a(2),b(n.addAuth?6:-1),a(),b(n.removeAuth?7:-1),a(),b(n.allowAuth?8:-1),a(),b(n.blockAuth?9:-1),a(),m("placeholder","FACILITY_DETAIL.SERVICES_DESTINATIONS.FILTER"),a(4),m("perunWebAppsLoader",n.loading)("perunWebAppsLoaderIndicator",s)}},dependencies:[x,w,L,Ve,ke,Be,Ne,de,Ae,M,qt,N,pe,R],encapsulation:2})}}return t})();function jo(t,f){t&1&&S(0,"perun-web-apps-loading-dialog")}function Ho(t,f){t&1&&(r(0,"mat-error"),p(1),l(2,"translate"),o()),t&2&&(a(),h(" ",c(2,1,"DIALOGS.ADD_HOST.EMPTY_MESSAGE")," "))}function Uo(t,f){if(t&1&&(r(0,"mat-error"),p(1),l(2,"translate"),o()),t&2){let e=d(2);a(),be(" ",c(2,2,"DIALOGS.ADD_HOST.INVALID_HOST")," ",e.hostsCtrl.getError("invalidHost").value," ")}}function Yo(t,f){if(t&1){let e=v();r(0,"div")(1,"h1",2),p(2),l(3,"translate"),o(),r(4,"div",3)(5,"mat-form-field",4)(6,"mat-label"),p(7),l(8,"translate"),o(),r(9,"textarea",5),p(10,"        "),o(),I(11,Ho,3,3,"mat-error"),I(12,Uo,3,4,"mat-error"),o(),r(13,"perun-web-apps-alert",6),p(14),l(15,"translate"),o()(),r(16,"div",7)(17,"button",8),_("click",function(){g(e);let n=d();return C(n.onCancel())}),p(18),l(19,"translate"),o(),r(20,"button",9),_("click",function(){g(e);let n=d();return C(n.onAdd())}),p(21),l(22,"translate"),o()()()}if(t&2){let e=d();a(2),T(c(3,9,"DIALOGS.ADD_HOST.TITLE")),a(5),T(c(8,11,"DIALOGS.ADD_HOST.SUBTITLE")),a(2),m("formControl",e.hostsCtrl),a(2),b(e.hostsCtrl.hasError("required")?11:-1),a(),b(e.hostsCtrl.hasError("invalidHost")?12:-1),a(2),T(c(15,13,"DIALOGS.ADD_HOST.HINT")),a(4),h(" ",c(19,15,"DIALOGS.ADD_HOST.CANCEL")," "),a(2),m("disabled",e.hostsCtrl.invalid||e.loading),a(),h(" ",c(22,17,"DIALOGS.ADD_HOST.ADD")," ")}}var Ia=(()=>{class t{constructor(e,i,n,s,y){this.dialogRef=e,this.data=i,this.facilitiesManager=n,this.notificator=s,this.translate=y,this.loading=!1,this.hostPattern=new RegExp("^(?!:\\/\\/)(?=.{1,255}$)((.{1,63}\\.){1,127}(?![0-9]*$)[a-z0-9-]+\\.?)$|^(25[0-5]|2[0-4]\\d|[0-1]?\\d?\\d)(\\.(25[0-5]|2[0-4]\\d|[0-1]?\\d?\\d)){3}$")}static parseRange(e){let[i,n]=e.split("-"),s=parseInt(i.substring(1,i.length),10),y=parseInt(n.substring(0,n.length),10);return[s,y]}ngOnInit(){this.theme=this.data.theme,this.hostsCtrl=new le("",[Fe.required,this.hostsNameValidator()]),this.hostsCtrl.markAllAsTouched()}onAdd(){this.loading=!0;let e=this.hostsCtrl.value.split(`
`),i=[];for(let n of e)i=i.concat(this.parseHostName(n));this.facilitiesManager.addHosts(this.data.facilityId,i).subscribe(()=>{this.notificator.showSuccess(this.translate.instant("DIALOGS.ADD_HOST.SUCCESS")),this.dialogRef.close(!0)},()=>this.loading=!1)}onCancel(){this.dialogRef.close(!1)}hostsNameValidator(){return e=>{let i=[],n=e.value.split(`
`);for(let s of n)i=i.concat(this.parseHostName(s));for(let s of i)if(!this.hostPattern.test(s))return{invalidHost:{value:s}};return null}}parseHostName(e){let i=new RegExp("[[0-9]+-[0-9]+]","g"),n=e.split(i),s=e.match(i);if(s==null)return e===""?[]:[e];let y=[];for(let D=0;D<n.length-1;D++){let[q,U]=t.parseRange(s[D]),X=[];for(let ae=q;ae<=U;ae++)X=X.concat(n[D].concat(ae.toString()));y=y.concat([X])}return y=y.concat([[n[n.length-1]]]),this.joinHostNames(y,0)}joinHostNames(e,i){if(i===e.length-1)return e[i];let n=this.joinHostNames(e,i+1),s=[];for(let y of e[i])for(let D of n)s.push(y.concat(D));return s}static{this.\u0275fac=function(i){return new(i||t)(u(W),u(z),u(O),u(H),u(ce))}}static{this.\u0275cmp=E({type:t,selectors:[["app-add-host-dialog"]],decls:4,vars:5,consts:[["spinner",""],[4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],["mat-dialog-title",""],["mat-dialog-content","",1,"dialog-container"],["subscriptSizing","dynamic"],["id","facilityAddHost","name","facilityAddHost","required","","matInput","","perunWebAppsAutoFocus","","rows","8",3,"formControl"],["alert_type","info"],["mat-dialog-actions",""],["mat-stroked-button","",1,"ms-auto",3,"click"],["color","accent","mat-flat-button","",1,"ms-2",3,"click","disabled"]],template:function(i,n){if(i&1&&(A(0,jo,1,0,"ng-template",null,0,V),r(2,"div"),A(3,Yo,23,19,"div",1),o()),i&2){let s=F(1);a(2),Z(fe("",n.theme," position-relative")),a(),m("perunWebAppsLoader",n.loading)("perunWebAppsLoaderIndicator",s)}},dependencies:[x,w,L,pt,ct,lt,wt,ft,ut,Ke,We,ze,Dt,$e,ne,ee,ie,te,Be,Ne,he,M,N,Vi,R],encapsulation:2})}}return t})();function Wo(t,f){t&1&&S(0,"perun-web-apps-loading-dialog")}function zo(t,f){t&1&&S(0,"th",14)}function $o(t,f){if(t&1&&(r(0,"td",15),p(1),o()),t&2){let e=f.$implicit;a(),T(e.hostname)}}function Ko(t,f){t&1&&S(0,"tr",16)}function qo(t,f){t&1&&S(0,"tr",17)}function Xo(t,f){if(t&1){let e=v();r(0,"div")(1,"h1",2),p(2),l(3,"translate"),o(),r(4,"div",3)(5,"p"),p(6),l(7,"translate"),o(),r(8,"div",4),p(9),l(10,"translate"),o(),r(11,"table",5),ge(12,6),A(13,zo,1,0,"th",7)(14,$o,2,1,"td",8),Ce(),A(15,Ko,1,0,"tr",9)(16,qo,1,0,"tr",10),o()(),r(17,"div",11)(18,"button",12),_("click",function(){g(e);let n=d();return C(n.onCancel())}),p(19),l(20,"translate"),o(),r(21,"button",13),_("click",function(){g(e);let n=d();return C(n.onConfirm())}),p(22),l(23,"translate"),o()()()}if(t&2){let e=d();a(2),T(c(3,9,"DIALOGS.REMOVE_HOST.TITLE")),a(4),T(c(7,11,"DIALOGS.REMOVE_HOST.DESCRIPTION")),a(3),h(" ",c(10,13,"DIALOGS.REMOVE_HOST.ASK")," "),a(2),m("dataSource",e.dataSource),a(4),m("matHeaderRowDef",e.displayedColumns),a(),m("matRowDefColumns",e.displayedColumns),a(3),h(" ",c(20,15,"DIALOGS.REMOVE_HOST.CANCEL")," "),a(2),m("disabled",e.loading),a(),h(" ",c(23,17,"DIALOGS.REMOVE_HOST.CONFIRM")," ")}}var ya=(()=>{class t{constructor(e,i,n,s,y){this.dialogRef=e,this.data=i,this.facilitiesManager=n,this.notificator=s,this.translate=y,this.displayedColumns=["name"],this.loading=!1}ngOnInit(){this.theme=this.data.theme,this.hosts=this.data.hosts,this.dataSource=new Oe(this.data.hosts)}onConfirm(){this.loading=!0,this.facilitiesManager.removeHosts(this.data.facilityId,this.hosts.map(e=>e.id)).subscribe(()=>{this.notificator.showSuccess(this.translate.instant("DIALOGS.REMOVE_HOST.SUCCESS")),this.dialogRef.close(!0)},()=>this.loading=!1)}onCancel(){this.dialogRef.close(!1)}static{this.\u0275fac=function(i){return new(i||t)(u(W),u(z),u(O),u(H),u(ce))}}static{this.\u0275cmp=E({type:t,selectors:[["app-remove-host-dialog"]],decls:4,vars:5,consts:[["spinner",""],[4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],["mat-dialog-title",""],["mat-dialog-content",""],[1,"fw-bold"],["mat-table","",1,"w-100",3,"dataSource"],["matColumnDef","name"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["class","font-weight-bolder","mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["mat-dialog-actions",""],["mat-stroked-button","",1,"ms-auto",3,"click"],["color","warn","mat-flat-button","",1,"ms-2",3,"click","disabled"],["mat-header-cell",""],["mat-cell",""],["mat-header-row","",1,"font-weight-bolder"],["mat-row",""]],template:function(i,n){if(i&1&&(A(0,Wo,1,0,"ng-template",null,0,V),r(2,"div"),A(3,Xo,24,19,"div",1),o()),i&2){let s=F(1);a(2),Z(fe("",n.theme," position-relative")),a(),m("perunWebAppsLoader",n.loading)("perunWebAppsLoaderIndicator",s)}},dependencies:[x,w,L,ne,ee,ie,te,he,ot,qe,Qe,tt,Ze,Xe,it,Je,et,nt,at,M,N,R],encapsulation:2})}}return t})();var Qo=t=>({all:t}),Zo=t=>({name:t}),Ta=(t,f)=>["/facilities",t,"hosts",f];function Jo(t,f){if(t&1){let e=v();r(0,"th",14)(1,"mat-checkbox",15),l(2,"masterCheckboxLabel"),l(3,"translate"),_("change",function(n){g(e);let s=d(2);return C(n?s.masterToggle():null)}),o()()}if(t&2){let e=d(),i=d();a(),m("aria-label",c(3,5,c(2,3,e.all)))("checked",i.selection.hasValue()&&e.all)("indeterminate",i.selection.hasValue()&&!e.all)}}function er(t,f){if(t&1){let e=v();r(0,"td",16)(1,"mat-checkbox",17),l(2,"checkboxLabel"),l(3,"translate"),_("change",function(n){let s=g(e).$implicit,y=d(2);return C(n?y.toggleRow(s):null)})("click",function(n){return g(e),C(n.stopPropagation())}),o()()}if(t&2){let e=f.$implicit,i=d(2);a(),m("aria-label",gt(3,4,c(2,2,i.selection.isSelected(e)),He(7,Zo,e.hostname)))("checked",i.selection.isSelected(e))}}function tr(t,f){t&1&&(ge(0,3),A(1,Jo,4,7,"th",12)(2,er,4,9,"td",13),Ce())}function ir(t,f){t&1&&(r(0,"th",18),p(1),l(2,"translate"),o()),t&2&&(a(),h(" ",c(2,1,"SHARED.COMPONENTS.HOSTS_LIST.TABLE_HOST_ID")," "))}function nr(t,f){if(t&1&&(r(0,"td",19),p(1),o()),t&2){let e=f.$implicit;a(),T(e.id)}}function ar(t,f){t&1&&(r(0,"th",18),p(1),l(2,"translate"),o()),t&2&&(a(),h(" ",c(2,1,"SHARED.COMPONENTS.HOSTS_LIST.TABLE_HOST_NAME")," "))}function or(t,f){if(t&1&&(r(0,"td",20),l(1,"multiWordDataCy"),p(2),o()),t&2){let e=f.$implicit;vi("data-cy",c(1,2,e.hostname)),a(2),h(" ",e.hostname," ")}}function rr(t,f){t&1&&S(0,"tr",21)}function sr(t,f){if(t&1&&S(0,"tr",22),t&2){let e=f.$implicit,i=d();Y("cursor-pointer",!i.disableRouting),m("perunWebAppsMiddleClickRouterLink",i.disableRouting?null:ai(4,Ta,i.facilityId.toString(),e.id.toString()))("routerLink",i.disableRouting?null:ai(7,Ta,i.facilityId,e.id))}}function lr(t,f){t&1&&(r(0,"perun-web-apps-alert",11),p(1),l(2,"translate"),o()),t&2&&(a(),h(" ",c(2,1,"SHARED_LIB.UI.ALERTS.NO_FILTER_RESULTS_ALERT")," "))}function cr(t,f){t&1&&(r(0,"perun-web-apps-alert",11),p(1),l(2,"translate"),o()),t&2&&(a(),h(" ",c(2,1,"SHARED.COMPONENTS.HOSTS_LIST.NO_HOST_WARNING")," "))}var Jt=(()=>{class t{constructor(e,i,n){this.authResolver=e,this.tableCheckbox=i,this.destroyRef=n,this.hosts=[],this.selection=new G(!0,[]),this.disableRouting=!1,this.displayedColumns=["select","id","name"],this.pageSizeOptions=Ji}set matSort(e){this.sort=e,this.setDataSource()}static getDataForColumn(e,i){switch(i){case"id":return e.id.toString();case"name":return e.hostname;default:return""}}ngOnInit(){this.selection&&(this.cachedSelection=new G(this.selection.isMultipleSelection(),[],!0,this.selection.compareWith),this.cachedSubject?.pipe(mn(this.destroyRef)).subscribe(e=>{e&&this.cachedSelection.clear()}))}ngOnChanges(){localStorage.getItem("showIds")!=="true"&&(this.displayedColumns=this.displayedColumns.filter(e=>e!=="id")),this.dataSource=new Oe(this.hosts),this.setDataSource(),this.dataSource.filter=this.filterValue}exportAllData(e){vt(St(this.dataSource.filteredData,this.displayedColumns,t.getDataForColumn),e)}exportDisplayedData(e){let i=this.dataSource.paginator.pageIndex*this.dataSource.paginator.pageSize,n=i+this.dataSource.paginator.pageSize;vt(St(this.dataSource.sortData(this.dataSource.filteredData,this.dataSource.sort).slice(i,n),this.displayedColumns,t.getDataForColumn),e)}setDataSource(){this.dataSource&&(this.dataSource.sort=this.sort,this.dataSource.filterPredicate=(e,i)=>rn(e,i,this.displayedColumns,t.getDataForColumn),this.dataSource.sortData=(e,i)=>on(e,i,t.getDataForColumn),this.dataSource.paginator=this.child.paginator)}isAllSelected(){return this.tableCheckbox.isAllSelected(this.selection.selected.length,this.dataSource)}masterToggle(){this.tableCheckbox.masterToggle(this.isAllSelected(),this.selection,this.cachedSelection,this.filterValue,this.dataSource,this.sort,this.child.paginator.pageSize,this.child.paginator.pageIndex,!1)}toggleRow(e){this.selection.toggle(e),this.cachedSelection.toggle(e)}pageChanged(){this.cachedSelection&&this.tableCheckbox.selectCachedDataOnPage(this.dataSource,this.selection,this.cachedSelection,this.selection.compareWith)}ngAfterViewInit(){this.dataSource.paginator=this.child.paginator}static{this.\u0275fac=function(i){return new(i||t)(u(B),u(sn),u(Ci))}}static{this.\u0275cmp=E({type:t,selectors:[["app-hosts-list"]],viewQuery:function(i,n){if(i&1&&(Se(oi,7),Se(Ft,7)),i&2){let s;ve(s=Ie())&&(n.child=s.first),ve(s=Ie())&&(n.matSort=s.first)}},inputs:{hosts:"hosts",selection:"selection",cachedSubject:"cachedSubject",filterValue:"filterValue",tableId:"tableId",facilityId:"facilityId",disableRouting:"disableRouting",displayedColumns:"displayedColumns",loading:"loading"},features:[Tt],decls:15,vars:15,consts:[[1,"card","mt-3",3,"hidden"],[3,"exportDisplayedData","exportAllData","pageChanged","pageSizeOptions","dataLength","tableId"],["mat-table","","matSort","","matSortActive","id","matSortDirection","asc","matSortDisableClear","",1,"w-100",3,"matSortChange","dataSource"],["matColumnDef","select"],["matColumnDef","id"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["class","static-column-size","mat-cell","",4,"matCellDef"],["matColumnDef","name"],["mat-cell","",4,"matCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["class","dark-hover-list-item","mat-row","",3,"cursor-pointer","perunWebAppsMiddleClickRouterLink","routerLink",4,"matRowDef","matRowDefColumns"],["alert_type","warn"],["class","align-checkbox","mat-header-cell","",4,"matHeaderCellDef"],["class","static-column-size align-checkbox","mat-cell","",4,"matCellDef"],["mat-header-cell","",1,"align-checkbox"],["color","primary",3,"change","aria-label","checked","indeterminate"],["mat-cell","",1,"static-column-size","align-checkbox"],["color","primary",3,"change","click","aria-label","checked"],["mat-header-cell","","mat-sort-header",""],["mat-cell","",1,"static-column-size"],["mat-cell",""],["mat-header-row",""],["mat-row","",1,"dark-hover-list-item",3,"perunWebAppsMiddleClickRouterLink","routerLink"]],template:function(i,n){if(i&1&&(r(0,"div",0)(1,"perun-web-apps-table-wrapper",1),_("exportDisplayedData",function(y){return n.exportDisplayedData(y)})("exportAllData",function(y){return n.exportAllData(y)})("pageChanged",function(){return n.pageChanged()}),r(2,"table",2),_("matSortChange",function(){return n.pageChanged()}),I(3,tr,3,0,"ng-container",3),l(4,"isAllSelected"),ge(5,4),A(6,ir,3,3,"th",5)(7,nr,2,1,"td",6),Ce(),ge(8,7),A(9,ar,3,3,"th",5)(10,or,3,4,"td",8),Ce(),A(11,rr,1,0,"tr",9)(12,sr,1,10,"tr",10),o()()(),I(13,lr,3,3,"perun-web-apps-alert",11),I(14,cr,3,3,"perun-web-apps-alert",11)),i&2){let s;m("hidden",n.dataSource.filteredData.length===0||n.hosts.length===0),a(),m("pageSizeOptions",n.pageSizeOptions)("dataLength",n.dataSource.filteredData.length)("tableId",n.tableId),a(),m("dataSource",n.dataSource),a(),b((s=He(13,Qo,gt(4,10,n.dataSource,n.selection.selected.length)))?3:-1,s),a(8),m("matHeaderRowDef",n.displayedColumns),a(),m("matRowDefColumns",n.displayedColumns),a(),b(n.dataSource.filteredData.length===0&&n.hosts.length!==0?13:-1),a(),b(!n.loading&&n.hosts.length===0?14:-1)}},dependencies:[x,Le,we,Be,Ne,kt,oi,Mt,Rt,ot,qe,Qe,tt,Ze,Xe,it,Je,et,nt,at,Ri,Ft,Di,M,cn,R,dn,pn,ln],styles:[".disable-outline[_ngcontent-%COMP%]{outline:none!important}.cursor-pointer[_ngcontent-%COMP%]{cursor:pointer}"]})}}return t})();function pr(t,f){if(t&1){let e=v();r(0,"button",8),_("click",function(){g(e);let n=d();return C(n.addHost())}),p(1),l(2,"translate"),o()}t&2&&(a(),h(" ",c(2,1,"FACILITY_DETAIL.HOSTS.ADD")," "))}function dr(t,f){if(t&1){let e=v();r(0,"button",9),_("click",function(){g(e);let n=d();return C(n.removeHost())}),p(1),l(2,"translate"),o()}if(t&2){let e=d();m("disabled",e.loading||e.selected.selected.length===0),a(),h(" ",c(2,2,"FACILITY_DETAIL.HOSTS.REMOVE")," ")}}function mr(t,f){t&1&&S(0,"perun-web-apps-loading-table")}function ur(t,f){if(t&1&&S(0,"app-hosts-list",10),t&2){let e=d();m("disableRouting",!e.routeAuth||e.disableRouting)("loading",e.loading)("filterValue",e.filterValue)("hosts",e.hosts)("selection",e.selected)("cachedSubject",e.cachedSubject)("displayedColumns",e.displayedColumns)("facilityId",e.facility.id)("tableId",e.tableId)}}var ei=(()=>{class t{constructor(e,i,n,s){this.dialog=e,this.facilitiesManager=i,this.authResolver=n,this.entityStorageService=s,this.disableRouting=!1,this.hostEmitter=new Et,this.hosts=[],this.selected=new G(!0,[],!0,(y,D)=>y.id===D.id),this.cachedSubject=new oe(!0),this.filterValue="",this.tableId=_n,this.displayedColumns=["id","name"]}ngOnInit(){this.loading=!0,this.facility=this.entityStorageService.getEntity(),this.setAuthRights(),this.refreshTable()}refreshTable(){this.loading=!0,this.facilitiesManager.getHosts(this.facility.id).subscribe(e=>{this.hosts=e,this.hostEmitter.emit(this.hosts),this.selected.clear(),this.cachedSubject.next(!0),this.setAuthRights(),this.loading=!1})}setAuthRights(){this.addAuth=this.authResolver.isAuthorized("addHosts_Facility_List<String>_policy",[this.facility]),this.removeAuth=this.authResolver.isAuthorized("removeHosts_List<Host>_Facility_policy",[this.facility]),this.displayedColumns=this.removeAuth?["select","id","name"]:["id","name"],this.hosts.length!==0&&(this.routeAuth=this.authResolver.isAuthorized("getHostById_int_policy",[this.facility,this.hosts[0]]))}addHost(){let e=k();e.width="600px",e.data={facilityId:this.facility.id,theme:"facility-theme"},this.dialog.open(Ia,e).afterClosed().subscribe(n=>{n&&this.refreshTable()})}removeHost(){let e=k();e.width="600px",e.data={facilityId:this.facility.id,theme:"facility-theme",hosts:this.selected.selected},this.dialog.open(ya,e).afterClosed().subscribe(n=>{n&&this.refreshTable()})}applyFilter(e){this.filterValue=e,this.refreshTable()}static{this.\u0275fac=function(i){return new(i||t)(u(J),u(O),u(B),u(j))}}static{this.\u0275cmp=E({type:t,selectors:[["app-facility-hosts"]],inputs:{disableRouting:"disableRouting"},outputs:{hostEmitter:"hostEmitter"},decls:12,vars:8,consts:[["spinner",""],[1,"page-subtitle"],[3,"refresh"],["color","accent","mat-flat-button","",1,"me-2","action-button"],["color","warn","mat-flat-button","",1,"me-2",3,"disabled"],[3,"filter","placeholder"],[1,"position-relative","table-min-height"],[3,"disableRouting","loading","filterValue","hosts","selection","cachedSubject","displayedColumns","facilityId","tableId",4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],["color","accent","mat-flat-button","",1,"me-2","action-button",3,"click"],["color","warn","mat-flat-button","",1,"me-2",3,"click","disabled"],[3,"disableRouting","loading","filterValue","hosts","selection","cachedSubject","displayedColumns","facilityId","tableId"]],template:function(i,n){if(i&1){let s=v();r(0,"div")(1,"h1",1),p(2),l(3,"translate"),o(),r(4,"perun-web-apps-refresh-button",2),_("refresh",function(){return g(s),C(n.refreshTable())}),o(),I(5,pr,3,3,"button",3),I(6,dr,3,4,"button",4),r(7,"perun-web-apps-debounce-filter",5),_("filter",function(D){return g(s),C(n.applyFilter(D))}),o(),A(8,mr,1,0,"ng-template",null,0,V),r(10,"div",6),A(11,ur,1,9,"app-hosts-list",7),o()()}if(i&2){let s=F(9);a(2),T(c(3,6,"FACILITY_DETAIL.HOSTS.TITLE")),a(3),b(n.addAuth?5:-1),a(),b(n.removeAuth?6:-1),a(),m("placeholder","FACILITY_DETAIL.HOSTS.FILTER"),a(4),m("perunWebAppsLoader",n.loading)("perunWebAppsLoaderIndicator",s)}},dependencies:[x,w,L,de,Ae,M,N,Jt,pe,R],encapsulation:2})}}return t})();var Aa=(()=>{class t{constructor(e,i){this.facilityManager=e,this.route=i,this.host={beanName:"",id:0}}ngOnInit(){this.route.params.subscribe(e=>{this.hostId=Number(e.hostId),this.facilityManager.getHostById(this.hostId).subscribe(i=>{this.host=i})})}static{this.\u0275fac=function(i){return new(i||t)(u(O),u(rt))}}static{this.\u0275cmp=E({type:t,selectors:[["app-facility-hosts-detail"]],decls:5,vars:6,consts:[[1,"page-subtitle"],[3,"entityId","entity"]],template:function(i,n){i&1&&(r(0,"div")(1,"h1",0),p(2),l(3,"translate"),o(),S(4,"app-one-entity-attribute-page",1),o()),i&2&&(a(2),be(" ",c(3,4,"FACILITY_DETAIL.HOSTS.HOSTS_DETAIL.TITLE")," ",n.host.hostname," "),a(2),m("entityId",n.hostId)("entity","host"))},dependencies:[x,zt,M,R],encapsulation:2})}}return t})();function fr(t,f){t&1&&S(0,"perun-web-apps-loading-dialog")}function hr(t,f){t&1&&(r(0,"th",16),p(1),l(2,"translate"),o()),t&2&&(a(),h(" ",c(2,1,"DIALOGS.DELETE_TASK_RESULT.RESULT_ID")," "))}function _r(t,f){if(t&1&&(r(0,"td",17),p(1),o()),t&2){let e=f.$implicit;a(),T(e.id)}}function gr(t,f){t&1&&(r(0,"th",16),p(1),l(2,"translate"),o()),t&2&&(a(),h(" ",c(2,1,"DIALOGS.DELETE_TASK_RESULT.DESTINATION")," "))}function Cr(t,f){if(t&1&&(r(0,"td",17),p(1),o()),t&2){let e=f.$implicit;a(),T(e.destination.destination)}}function Sr(t,f){t&1&&(r(0,"th",16),p(1),l(2,"translate"),o()),t&2&&(a(),h(" ",c(2,1,"DIALOGS.DELETE_TASK_RESULT.TIME")," "))}function vr(t,f){if(t&1&&(r(0,"td",17),p(1),l(2,"date"),o()),t&2){let e=f.$implicit;a(),h(" ",gt(2,1,e.timestamp,"d.M.y H:mm:ss")," ")}}function Ir(t,f){t&1&&S(0,"tr",18)}function br(t,f){t&1&&S(0,"tr",19)}function yr(t,f){if(t&1){let e=v();r(0,"div")(1,"h1",2),p(2),l(3,"translate"),o(),r(4,"div",3)(5,"p"),p(6),l(7,"translate"),o(),r(8,"div",4),p(9),l(10,"translate"),o(),r(11,"table",5),ge(12,6),A(13,hr,3,3,"th",7)(14,_r,2,1,"td",8),Ce(),ge(15,9),A(16,gr,3,3,"th",7)(17,Cr,2,1,"td",8),Ce(),ge(18,10),A(19,Sr,3,3,"th",7)(20,vr,3,4,"td",8),Ce(),A(21,Ir,1,0,"tr",11)(22,br,1,0,"tr",12),o()(),r(23,"div",13)(24,"button",14),_("click",function(){g(e);let n=d();return C(n.onCancel())}),p(25),l(26,"translate"),o(),r(27,"button",15),_("click",function(){g(e);let n=d();return C(n.onDelete())}),p(28),l(29,"translate"),o()()()}if(t&2){let e=d();a(2),T(c(3,9,"DIALOGS.DELETE_TASK_RESULT.TITLE")),a(4),T(c(7,11,"DIALOGS.DELETE_TASK_RESULT.DESCRIPTION")),a(3),h(" ",c(10,13,"DIALOGS.DELETE_TASK_RESULT.ASK")," "),a(2),m("dataSource",e.dataSource),a(10),m("matHeaderRowDef",e.displayedColumns),a(),m("matRowDefColumns",e.displayedColumns),a(3),h(" ",c(26,15,"DIALOGS.DELETE_TASK_RESULT.CANCEL")," "),a(2),m("disabled",e.loading),a(),h(" ",c(29,17,"DIALOGS.DELETE_TASK_RESULT.REMOVE")," ")}}var ti=(()=>{class t{constructor(e,i,n,s,y){this.dialogRef=e,this.data=i,this.taskManager=n,this.notificator=s,this.translate=y,this.loading=!1,this.dataSource=new Oe(this.data.taskResults),this.displayedColumns=["id","destination","time"]}ngOnInit(){this.theme=this.data.theme,this.taskResults=this.data.taskResults}onDelete(){this.loading=!0;let e=this.taskResults.map(i=>i.id);this.taskManager.deleteTaskResultsByIds(e).subscribe({next:()=>{this.dialogRef.close(!0),this.loading=!1,this.notificator.showSuccess(this.translate.instant("DIALOGS.DELETE_TASK_RESULT.SUCCESS"))},error:()=>this.loading=!1})}onCancel(){this.dialogRef.close(!1)}static{this.\u0275fac=function(i){return new(i||t)(u(W),u(z),u(Te),u(H),u(ht))}}static{this.\u0275cmp=E({type:t,selectors:[["app-delete-task-result-dialog"]],decls:4,vars:5,consts:[["spinner",""],[4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],["mat-dialog-title",""],["mat-dialog-content",""],[1,"fw-bold"],["mat-table","",1,"w-100",3,"dataSource"],["matColumnDef","id"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","destination"],["matColumnDef","time"],["class","font-weight-bolder","mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["mat-dialog-actions",""],["mat-stroked-button","",1,"ms-auto",3,"click"],["color","warn","mat-flat-button","",1,"ms-2",3,"click","disabled"],["mat-header-cell",""],["mat-cell",""],["mat-header-row","",1,"font-weight-bolder"],["mat-row",""]],template:function(i,n){if(i&1&&(A(0,fr,1,0,"ng-template",null,0,V),r(2,"div"),A(3,yr,30,19,"div",1),o()),i&2){let s=F(1);a(2),Z(fe("",n.theme," position-relative")),a(),m("perunWebAppsLoader",n.loading)("perunWebAppsLoaderIndicator",s)}},dependencies:[x,w,L,ne,ee,ie,te,he,ot,qe,Qe,tt,Ze,Xe,it,Je,et,nt,at,M,N,Ai,R],encapsulation:2})}}return t})();function Tr(t,f){t&1&&S(0,"perun-web-apps-loading-dialog")}function Ar(t,f){if(t&1){let e=v();r(0,"mat-checkbox",12),l(1,"translate"),_("change",function(n){g(e);let s=d(2);return C(s.change(n))}),p(2),l(3,"translate"),o()}if(t&2){let e=d(2);m("matTooltip",ye(c(1,6,"DIALOGS.REMOVE_SERVICE_FROM_FACILITY.CHECKBOXES_DISABLED")))("checked",e.taskChecked)("disabled",e.checkboxesDisabled)("matTooltipDisabled",!e.checkboxesDisabled),a(2),h(" ",c(3,8,"DIALOGS.REMOVE_SERVICE_FROM_FACILITY.CHECKBOX_TASK_AND_TASK_RESULTS")," ")}}function Er(t,f){if(t&1){let e=v();r(0,"mat-checkbox",13),l(1,"translate"),_("change",function(n){g(e);let s=d(2);return C(s.change(n))}),p(2),l(3,"translate"),o()}if(t&2){let e=d(2);m("matTooltip",ye(c(1,6,"DIALOGS.REMOVE_SERVICE_FROM_FACILITY.CHECKBOXES_DISABLED")))("checked",e.taskResultsChecked)("disabled",e.checkboxesDisabled)("matTooltipDisabled",!e.checkboxesDisabled),a(2),h(" ",c(3,8,"DIALOGS.REMOVE_SERVICE_FROM_FACILITY.CHECKBOX_TASK_RESULTS")," ")}}function xr(t,f){if(t&1){let e=v();r(0,"div")(1,"h1",2),p(2),l(3,"translate"),o(),r(4,"div",3)(5,"p"),p(6),l(7,"translate"),o(),r(8,"div"),I(9,Ar,4,10,"mat-checkbox",4),I(10,Er,4,10,"mat-checkbox",5),r(11,"mat-checkbox",6),l(12,"translate"),_("change",function(n){g(e);let s=d();return C(s.change(n))}),p(13),l(14,"translate"),o()(),r(15,"p"),p(16),l(17,"translate"),o(),r(18,"div",7),p(19),l(20,"translate"),o(),r(21,"perun-web-apps-resources-list",8),_("allSelected",function(n){g(e);let s=d();return C(s.disableCheckboxes(n))}),o()(),r(22,"div",9)(23,"button",10),_("click",function(){g(e);let n=d();return C(n.cancel())}),p(24),l(25,"translate"),o(),r(26,"button",11),_("click",function(){g(e);let n=d();return C(n.remove())}),p(27),l(28,"translate"),o()()()}if(t&2){let e=d();a(2),T(c(3,22,"DIALOGS.REMOVE_SERVICE_FROM_FACILITY.TITLE")),a(4),T(c(7,24,"DIALOGS.REMOVE_SERVICE_FROM_FACILITY.CHECKBOXES_DESCRIPTION")),a(3),b(e.taskId!==null?9:-1),a(),b(e.taskId!==null?10:-1),a(),m("matTooltip",ye(c(12,26,"DIALOGS.REMOVE_SERVICE_FROM_FACILITY.CHECKBOXES_DISABLED")))("disabled",e.checkboxesDisabled)("matTooltipDisabled",!e.checkboxesDisabled)("checked",e.destinationChecked),a(2),h(" ",c(14,28,"DIALOGS.REMOVE_SERVICE_FROM_FACILITY.CHECKBOX_DESTINATION")," "),a(3),T(c(17,30,"DIALOGS.REMOVE_SERVICE_FROM_FACILITY.DESCRIPTION")),a(3),h(" ",c(20,32,"DIALOGS.REMOVE_SERVICE_FROM_FACILITY.ASK")," "),a(2),m("loading",e.loading)("displayedColumns",e.displayedColumns)("disableRouting",!0)("resources",e.resources)("selection",e.selected)("cachedSubject",e.cachedSubject)("tableId",e.tableId),a(3),h(" ",c(25,34,"DIALOGS.REMOVE_SERVICE_FROM_FACILITY.CANCEL")," "),a(2),m("disabled",e.loading||e.selected.selected.length===0),a(),h(" ",c(28,36,"DIALOGS.REMOVE_SERVICE_FROM_FACILITY.REMOVE")," ")}}var Ea=(()=>{class t{constructor(e,i,n,s,y,D,q,U){this.dialogRef=e,this.data=i,this.resourcesManager=n,this.tasksManager=s,this.serviceManager=y,this.translate=D,this.notificator=q,this.cd=U,this.loading=!1,this.resources=[],this.displayedColumns=["select","id","vo","name"],this.checkboxesDisabled=!1,this.taskChecked=!0,this.taskResultsChecked=!0,this.destinationChecked=!0,this.tableId=Sn,this.dataSource=new Oe(this.data.resource),this.selected=new G(!0,[...this.dataSource.data],!0,(X,ae)=>X.id===ae.id),this.cachedSubject=new oe(!0)}ngOnInit(){this.theme=this.data.theme,this.taskId=this.data.taskId,this.serviceId=this.data.serviceId,this.facilityId=this.data.facilityId,this.resources=this.data.resource}remove(){this.loading=!0,this.taskResultsChecked&&!this.taskChecked&&this.taskId!==null&&this.tasksManager.getTaskResultsForGUIByTask(this.taskId).subscribe(e=>{this.tasksManager.deleteTaskResultsByIds(e.map(i=>i.id)).subscribe()}),this.taskChecked&&this.taskId!==null&&this.tasksManager.deleteTask({task:this.taskId}).subscribe(),this.destinationChecked&&this.serviceManager.getRichDestinations(this.serviceId,this.facilityId).subscribe(e=>{this.serviceManager.removeDestinationsByRichDestinations({richDestinations:e}).subscribe()}),this.resourcesManager.removeServiceForResources(this.selected.selected.map(e=>e.id),this.serviceId).subscribe({next:()=>{this.notificator.showSuccess(this.translate.instant("DIALOGS.REMOVE_SERVICE_FROM_FACILITY.SUCCESS")),this.dialogRef.close(!0)},error:()=>this.loading=!1})}cancel(){this.dialogRef.close(!1)}disableCheckboxes(e){e&&this.checkboxesDisabled&&this.changeCheckboxes(!0),!e&&!this.checkboxesDisabled&&this.changeCheckboxes(!1)}changeCheckboxes(e){this.checkboxesDisabled=!e,this.taskChecked=e,this.taskResultsChecked=e,this.destinationChecked=e,this.cd.detectChanges()}change(e){switch(e.source.id){case"task":{this.taskChecked=e.checked;break}case"taskResults":{this.taskResultsChecked=e.checked;break}case"destination":{this.destinationChecked=e.checked;break}default:break}}static{this.\u0275fac=function(i){return new(i||t)(u(W),u(z),u(_t),u(Te),u(ue),u(ht),u(H),u(Ue))}}static{this.\u0275cmp=E({type:t,selectors:[["app-delete-service-from-facility"]],decls:4,vars:5,consts:[["spinner",""],[4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],["mat-dialog-title",""],["mat-dialog-content",""],["color","warn","id","task",1,"right-space",3,"checked","disabled","matTooltipDisabled","matTooltip"],["color","warn","id","taskResults",1,"right-space",3,"checked","disabled","matTooltipDisabled","matTooltip"],["color","warn","id","destination",3,"change","disabled","matTooltipDisabled","checked","matTooltip"],[1,"fw-bold"],[3,"allSelected","loading","displayedColumns","disableRouting","resources","selection","cachedSubject","tableId"],["mat-dialog-actions",""],["mat-stroked-button","",1,"ms-auto",3,"click"],["color","warn","mat-flat-button","",1,"ms-2",3,"click","disabled"],["color","warn","id","task",1,"right-space",3,"change","checked","disabled","matTooltipDisabled","matTooltip"],["color","warn","id","taskResults",1,"right-space",3,"change","checked","disabled","matTooltipDisabled","matTooltip"]],template:function(i,n){if(i&1&&(A(0,Tr,1,0,"ng-template",null,0,V),r(2,"div"),A(3,xr,29,38,"div",1),o()),i&2){let s=F(1);a(2),Z(fe("",n.theme," position-relative")),a(),m("perunWebAppsLoader",n.loading)("perunWebAppsLoaderIndicator",s)}},dependencies:[x,w,L,Le,we,ne,ee,ie,te,he,M,Ye,N,An,R],styles:[".right-space[_ngcontent-%COMP%]{margin-right:40px}"]})}}return t})();function Dr(t,f){t&1&&S(0,"perun-web-apps-loading-dialog")}function Rr(t,f){if(t&1){let e=v();r(0,"div")(1,"h1",2),p(2),l(3,"translate"),o(),r(4,"div",3)(5,"div",4),p(6),l(7,"translate"),o()(),r(8,"div",5)(9,"button",6),_("click",function(){g(e);let n=d();return C(n.cancel())}),p(10),l(11,"translate"),o(),r(12,"button",7),_("click",function(){g(e);let n=d();return C(n.remove())}),p(13),l(14,"translate"),o()()()}if(t&2){let e=d();a(2),T(c(3,5,"DIALOGS.DELETE_TASK.TITLE")),a(4),h(" ",c(7,7,"DIALOGS.DELETE_TASK.DESCRIPTION")," "),a(4),h(" ",c(11,9,"DIALOGS.DELETE_TASK.CANCEL")," "),a(2),m("disabled",e.loading),a(),h(" ",c(14,11,"DIALOGS.DELETE_TASK.DELETE")," ")}}var xa=(()=>{class t{constructor(e,i,n,s,y){this.dialogRef=e,this.data=i,this.tasksManager=n,this.translate=s,this.notificator=y,this.loading=!1}ngOnInit(){this.theme=this.data.theme,this.taskId=this.data.taskId}remove(){this.loading=!0,this.tasksManager.deleteTask({task:this.taskId}).subscribe(()=>{this.translate.get("DIALOGS.DELETE_TASK.SUCCESS").subscribe(e=>{this.notificator.showSuccess(e),this.dialogRef.close(!0)})},()=>this.loading=!1)}cancel(){this.dialogRef.close(!1)}static{this.\u0275fac=function(i){return new(i||t)(u(W),u(z),u(Te),u(ce),u(H))}}static{this.\u0275cmp=E({type:t,selectors:[["app-delete-task-dialog"]],decls:4,vars:5,consts:[["spinner",""],[4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],["mat-dialog-title",""],["mat-dialog-content",""],[1,"fw-bold"],["mat-dialog-actions",""],["mat-stroked-button","",1,"ms-auto",3,"click"],["color","warn","mat-flat-button","",1,"ms-2",3,"click","disabled"]],template:function(i,n){if(i&1&&(A(0,Dr,1,0,"ng-template",null,0,V),r(2,"div"),A(3,Rr,15,13,"div",1),o()),i&2){let s=F(1);a(2),Z(fe("",n.theme," position-relative")),a(),m("perunWebAppsLoader",n.loading)("perunWebAppsLoaderIndicator",s)}},dependencies:[x,w,L,ne,ee,ie,te,he,M,N,R],encapsulation:2})}}return t})();function Mr(t,f){if(t&1){let e=v();r(0,"button",12),_("click",function(){g(e);let n=d();return C(n.forcePropagation())}),p(1),l(2,"translate"),o()}if(t&2){let e=d();m("disabled",e.selected.selected.length===0||e.disableForcePropagationButton||e.loading),a(),h(" ",c(2,2,"FACILITY_DETAIL.SERVICES_STATUS.FORCE_PROPAGATION")," ")}}function Fr(t,f){if(t&1){let e=v();r(0,"button",12),_("click",function(){g(e);let n=d();return C(n.allow())}),p(1),l(2,"translate"),o()}if(t&2){let e=d();m("disabled",e.selected.selected.length===0||e.disableAllowButton||e.loading),a(),h(" ",c(2,2,"FACILITY_DETAIL.SERVICES_STATUS.ALLOW")," ")}}function wr(t,f){if(t&1){let e=v();r(0,"button",13),_("click",function(){g(e);let n=d();return C(n.block())}),p(1),l(2,"translate"),o()}if(t&2){let e=d();m("disabled",e.selected.selected.length===0||e.disableBlockButton||e.loading),a(),h(" ",c(2,2,"FACILITY_DETAIL.SERVICES_STATUS.BLOCK")," ")}}function Lr(t,f){if(t&1&&(r(0,"button",6),l(1,"translate"),p(2),l(3,"translate"),o()),t&2){let e=d(),i=F(10);m("matTooltip",ye(c(1,6,"DIALOGS.REMOVE_SERVICE_FROM_FACILITY.CHECKBOXES_DISABLED")))("disabled",e.selected.selected.length===0||e.disableRemoveButton||e.loading)("matMenuTriggerFor",i)("matTooltipDisabled",!e.disableRemoveButton),a(2),h(" ",c(3,8,"FACILITY_DETAIL.SERVICES_STATUS.REMOVE")," ")}}function Or(t,f){if(t&1){let e=v();r(0,"button",8),_("click",function(){g(e);let n=d();return C(n.removeTaskResults())}),p(1),l(2,"translate"),o()}t&2&&(a(),h(" ",c(2,1,"FACILITY_DETAIL.SERVICES_STATUS.REMOVE_TASK_RESULTS")," "))}function kr(t,f){t&1&&S(0,"perun-web-apps-loading-table")}function Vr(t,f){if(t&1){let e=v();r(0,"perun-web-apps-services-status-list",14),_("selectionChange",function(){g(e);let n=d();return C(n.selectionChanged())}),o()}if(t&2){let e=d();m("disableRouting",!e.routeAuth)("loading",e.loading)("filterValue",e.filterValue)("servicesStatus",e.servicesStates)("selection",e.selected)("cachedSubject",e.cachedSubject)("tableId",e.tableId)}}var Da=(()=>{class t{constructor(e,i,n,s,y,D,q,U,X){this.tasksManager=e,this.servicesManager=i,this.notificator=n,this.translate=s,this.authResolver=y,this.facilityManager=D,this.resourcesManager=q,this.dialog=U,this.entityStorageService=X,this.servicesStates=[],this.selected=new G(!0,[],!0,(ae,_e)=>ae.service.id===_e.service.id),this.cachedSubject=new oe(!0),this.filterValue="",this.tableId=gn,this.disableAllowButton=!0,this.disableBlockButton=!0,this.disableRemoveButton=!0,this.disableForcePropagationButton=!1}ngOnInit(){this.loading=!0,this.facility=this.entityStorageService.getEntity(),this.setAuthRights(),this.refreshTable()}forcePropagation(){let e=this.selected.selected.map(i=>i.service.id);this.servicesManager.forceServicePropagationBulk(e,this.facility.id).subscribe({next:()=>{this.notificator.showInstantSuccess("FACILITY_DETAIL.SERVICES_STATUS.SUCCESS_FORCE_PROPAGATION"),this.loading=!1,this.refreshTable()},error:()=>{this.loading=!1}})}allow(){let e=this.selected.selected.map(i=>i.service.id);this.servicesManager.unblockServicesOnFacility(e,this.facility.id).subscribe({next:()=>{this.notificator.showInstantSuccess("FACILITY_DETAIL.SERVICES_STATUS.SUCCESS_ALLOW"),this.refreshTable()},error:()=>{this.loading=!1}})}block(){let e=this.selected.selected.map(i=>i.service.id);this.servicesManager.blockServicesOnFacility(e,this.facility.id).subscribe({next:()=>{this.notificator.showInstantSuccess("FACILITY_DETAIL.SERVICES_STATUS.SUCCESS_BLOCK"),this.refreshTable()},error:()=>{this.loading=!1}})}removeTaskResults(){this.loading=!0,this.tasksManager.getTaskResultsForGUIByTask(this.selected.selected[0].task.id).subscribe(e=>{let i=k();i.width="600px",i.data={theme:"facility-theme",taskResults:e},this.loading=!1,this.dialog.open(ti,i)})}removeServiceFromFacility(){this.loading=!0,this.facilityManager.getAssignedResourcesByAssignedServiceForFacility(this.selected.selected[0].facility.id,this.selected.selected[0].service.id).subscribe({next:e=>{let i=k();i.width="600px",this.taskId=this.taskIsNull?null:this.selected.selected[0].task.id,e.length===0?(i.data={theme:"facility-theme",taskId:this.taskId},this.loading=!1,this.dialog.open(xa,i).afterClosed().subscribe(s=>{s&&(this.disableRemoveButton=!0,this.refreshTable())})):this.resourcesManager.getRichResourcesByIds(e.map(n=>n.id)).subscribe(n=>{i.data={theme:"facility-theme",taskId:this.taskId,serviceId:this.selected.selected[0].service.id,facilityId:this.selected.selected[0].facility.id,resource:n},this.loading=!1,this.dialog.open(Ea,i).afterClosed().subscribe(y=>{y&&(this.disableRemoveButton=!0,this.refreshTable())})})},error:()=>this.loading=!1})}refreshTable(){this.loading=!0,this.tasksManager.getFacilityServicesState(this.facility.id).subscribe(e=>{this.servicesStates=e,this.selected.clear(),this.cachedSubject.next(!0),this.setAuthRights(),this.loading=!1})}setAuthRights(){this.propagationAuth=this.authResolver.isAuthorized("forceServicePropagation_Facility_Service_policy",[this.facility]),this.blockAuth=this.authResolver.isAuthorized("blockServiceOnFacility_Service_Facility_policy",[this.facility]),this.allowAuth=this.authResolver.isAuthorized("unblockServiceOnFacility_Service_Facility_policy",[this.facility]),this.deleteAuth=this.authResolver.isAuthorized("deleteTask_Task_policy",[this.facility]),this.routeAuth=this.authResolver.isAuthorized("getTaskResultsByTask_int_policy",[this.facility])}applyFilter(e){this.filterValue=e,this.refreshTable()}selectionChanged(){this.disableBlockButton=!1,this.disableAllowButton=!1,this.disableRemoveButton=this.selected.selected.length!==1,this.disableForcePropagationButton=!1,this.disableRemoveButton||(this.taskIsNull=this.selected.selected[0].task===null);for(let e of this.selected.selected)e.blockedOnFacility?(this.disableBlockButton=!0,this.disableForcePropagationButton=!0):this.disableAllowButton=!0}static{this.\u0275fac=function(i){return new(i||t)(u(Te),u(ue),u(H),u(ce),u(B),u(O),u(_t),u(J),u(j))}}static{this.\u0275cmp=E({type:t,selectors:[["app-facility-service-status"]],decls:20,vars:14,consts:[["menu","matMenu"],["spinner",""],[1,"page-subtitle"],[3,"refresh"],["color","accent","mat-flat-button","",1,"me-2",3,"disabled"],["color","warn","mat-flat-button","",1,"me-2",3,"disabled"],["mat-flat-button","","color","warn",1,"me-2","dropdown-toggle",3,"disabled","matMenuTriggerFor","matTooltipDisabled","matTooltip"],["mat-menu-item",""],["mat-menu-item","",3,"click"],[3,"filter","placeholder"],[1,"position-relative","table-min-height"],[3,"disableRouting","loading","filterValue","servicesStatus","selection","cachedSubject","tableId","selectionChange",4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],["color","accent","mat-flat-button","",1,"me-2",3,"click","disabled"],["color","warn","mat-flat-button","",1,"me-2",3,"click","disabled"],[3,"selectionChange","disableRouting","loading","filterValue","servicesStatus","selection","cachedSubject","tableId"]],template:function(i,n){if(i&1){let s=v();r(0,"div")(1,"h1",2),p(2),l(3,"translate"),o(),r(4,"perun-web-apps-refresh-button",3),_("refresh",function(){return g(s),C(n.refreshTable())}),o(),I(5,Mr,3,4,"button",4),I(6,Fr,3,4,"button",4),I(7,wr,3,4,"button",5),I(8,Lr,4,10,"button",6),r(9,"mat-menu",null,0),I(11,Or,3,3,"button",7),r(12,"button",8),_("click",function(){return g(s),C(n.removeServiceFromFacility())}),p(13),l(14,"translate"),o()(),r(15,"perun-web-apps-debounce-filter",9),_("filter",function(D){return g(s),C(n.applyFilter(D))}),o(),A(16,kr,1,0,"ng-template",null,1,V),r(18,"div",10),A(19,Vr,1,7,"perun-web-apps-services-status-list",11),o()()}if(i&2){let s=F(17);a(2),T(c(3,10,"FACILITY_DETAIL.SERVICES_STATUS.TITLE")),a(3),b(n.propagationAuth?5:-1),a(),b(n.allowAuth?6:-1),a(),b(n.blockAuth?7:-1),a(),b(n.deleteAuth?8:-1),a(3),b(n.taskIsNull?-1:11),a(2),h(" ",c(14,12,"FACILITY_DETAIL.SERVICES_STATUS.REMOVE_SERVICE_FROM_FACILITY")," "),a(2),m("placeholder","SHARED_LIB.PERUN.COMPONENTS.SERVICES_STATUS_LIST.TABLE_SEARCH"),a(4),m("perunWebAppsLoader",n.loading)("perunWebAppsLoaderIndicator",s)}},dependencies:[x,w,L,de,Ae,ki,Li,wi,Oi,M,Ye,En,N,pe,R],encapsulation:2})}}return t})();function Nr(t,f){if(t&1){let e=v();r(0,"button",8),_("click",function(){g(e);let n=d();return C(n.removeTaskResult())}),p(1),l(2,"translate"),o()}if(t&2){let e=d();m("disabled",e.loading||e.selection.selected.length===0),a(),h(" ",c(2,2,"FACILITY_DETAIL.TASK_RESULTS.REMOVE")," ")}}function Br(t,f){t&1&&S(0,"perun-web-apps-loading-table")}function Pr(t,f){if(t&1&&S(0,"perun-web-apps-task-results-list",9),t&2){let e=d();m("tableId",e.tableId)("loading",e.loading)("displayedColumns",e.displayedColumns)("filterValue",e.filterValue)("selection",e.selection)("cachedSubject",e.cachedSubject)("taskResults",e.taskResults)}}var Ra=(()=>{class t{constructor(e,i,n,s,y){this.route=e,this.taskManager=i,this.authResolver=n,this.dialog=s,this.entityStorageService=y,this.loading=!1,this.filterValue="",this.selection=new G(!0,[],!0,(D,q)=>D.id===q.id),this.task={id:0},this.taskResults=[],this.cachedSubject=new oe(!0),this.tableId=Cn,this.displayedColumns=["select","id","destination","type","service","status","time","returnCode","standardMessage","errorMessage"],this.removeAuth=!1}ngOnInit(){this.loading=!0,this.facility=this.entityStorageService.getEntity(),this.removeAuth=this.authResolver.isAuthorized("deleteTask_Task_policy",[this.facility]),this.removeAuth||(this.displayedColumns=["id","destination","type","service","status","time","returnCode","standardMessage","errorMessage"]),this.route.params.subscribe(e=>{this.taskId=Number(e.taskId),this.taskManager.getTaskById(this.taskId).subscribe(i=>{this.task=i,this.refreshTable()})})}refreshTable(){this.loading=!0,this.taskManager.getTaskResultsForGUIByTask(this.taskId).subscribe(e=>{this.selection.clear(),this.cachedSubject.next(!0),this.taskResults=e,this.loading=!1})}removeTaskResult(){let e=k();e.width="600px",e.data={theme:"facility-theme",taskResults:this.selection.selected},this.dialog.open(ti,e).afterClosed().subscribe(n=>{n&&this.refreshTable()})}applyFilter(e){this.filterValue=e,this.refreshTable()}static{this.\u0275fac=function(i){return new(i||t)(u(rt),u(Te),u(B),u(J),u(j))}}static{this.\u0275cmp=E({type:t,selectors:[["app-facility-task-results"]],decls:12,vars:9,consts:[["spinner",""],[1,"page-subtitle"],[1,"text-muted"],[3,"refresh"],["color","warn","mat-flat-button","",1,"me-2",3,"disabled"],[3,"filter","placeholder"],[1,"position-relative","table-min-height"],[3,"tableId","loading","displayedColumns","filterValue","selection","cachedSubject","taskResults",4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],["color","warn","mat-flat-button","",1,"me-2",3,"click","disabled"],[3,"tableId","loading","displayedColumns","filterValue","selection","cachedSubject","taskResults"]],template:function(i,n){if(i&1){let s=v();r(0,"h1",1),p(1),l(2,"translate"),r(3,"span",2),p(4),o()(),r(5,"perun-web-apps-refresh-button",3),_("refresh",function(){return g(s),C(n.refreshTable())}),o(),I(6,Nr,3,4,"button",4),r(7,"perun-web-apps-debounce-filter",5),_("filter",function(D){return g(s),C(n.applyFilter(D))}),o(),A(8,Br,1,0,"ng-template",null,0,V),r(10,"div",6),A(11,Pr,1,7,"perun-web-apps-task-results-list",7),o()}if(i&2){let s=F(9);a(),be(" ",c(2,7,"FACILITY_DETAIL.TASK_RESULTS.TITLE")," - ",n.task.service?n.task.service.name:""," "),a(3),h(" \xA0#",n.task.id," "),a(2),b(n.removeAuth?6:-1),a(),m("placeholder","FACILITY_DETAIL.TASK_RESULTS.FILTER"),a(4),m("perunWebAppsLoader",n.loading)("perunWebAppsLoaderIndicator",s)}},dependencies:[x,w,L,de,Ae,M,xn,N,pe,R],encapsulation:2})}}return t})();var Ma=(()=>{class t{constructor(e,i){this.dialogRef=e,this.data=i,this.theme=""}ngOnInit(){this.theme=this.data.theme}onCancel(){this.dialogRef.close(!1)}onSkip(){this.dialogRef.close(!0)}static{this.\u0275fac=function(i){return new(i||t)(u(W),u(z))}}static{this.\u0275cmp=E({type:t,selectors:[["app-no-service-dialog"]],decls:14,vars:14,consts:[["mat-dialog-title",""],["mat-dialog-content",""],["matDialogActions",""],["mat-stroked-button","",1,"ms-auto","me-2",3,"click"],["color","accent","mat-flat-button","",3,"click"]],template:function(i,n){i&1&&(r(0,"div")(1,"h1",0),p(2),l(3,"translate"),o(),r(4,"div",1),p(5),l(6,"translate"),o(),r(7,"div",2)(8,"button",3),_("click",function(){return n.onCancel()}),p(9),l(10,"translate"),o(),r(11,"button",4),_("click",function(){return n.onSkip()}),p(12),l(13,"translate"),o()()()),i&2&&(Z(n.theme),a(2),T(c(3,6,"DIALOGS.NO_SERVICE.TITLE")),a(3),h(" ",c(6,8,"DIALOGS.NO_SERVICE.INFO")," "),a(4),h(" ",c(10,10,"DIALOGS.NO_SERVICE.CANCEL")," "),a(3),h(" ",c(13,12,"DIALOGS.NO_SERVICE.SKIP")," "))},dependencies:[x,w,L,ne,ee,ie,te,M,R],encapsulation:2})}}return t})();var Fa=(()=>{class t{constructor(e,i){this.dialogRef=e,this.data=i,this.theme=""}ngOnInit(){this.theme=this.data.theme}onCancel(){this.dialogRef.close(!1)}onSkip(){this.dialogRef.close(!0)}static{this.\u0275fac=function(i){return new(i||t)(u(W),u(z))}}static{this.\u0275cmp=E({type:t,selectors:[["app-config-unsaved-dialog"]],decls:14,vars:14,consts:[["mat-dialog-title",""],["mat-dialog-content",""],["matDialogActions",""],["mat-stroked-button","",1,"ms-auto","me-2",3,"click"],["color","accent","mat-flat-button","",3,"click"]],template:function(i,n){i&1&&(r(0,"div")(1,"h1",0),p(2),l(3,"translate"),o(),r(4,"div",1),p(5),l(6,"translate"),o(),r(7,"div",2)(8,"button",3),_("click",function(){return n.onCancel()}),p(9),l(10,"translate"),o(),r(11,"button",4),_("click",function(){return n.onSkip()}),p(12),l(13,"translate"),o()()()),i&2&&(Z(n.theme),a(2),T(c(3,6,"DIALOGS.CONFIG_UNSAVED.TITLE")),a(3),h(" ",c(6,8,"DIALOGS.CONFIG_UNSAVED.INFO")," "),a(4),h(" ",c(10,10,"DIALOGS.CONFIG_UNSAVED.CANCEL")," "),a(3),h(" ",c(13,12,"DIALOGS.CONFIG_UNSAVED.SKIP")," "))},dependencies:[x,w,L,ne,ee,ie,te,M,R],encapsulation:2})}}return t})();function Gr(t,f){if(t&1&&(r(0,"div",1),S(1,"i",3),l(2,"translate"),o()),t&2){let e=d();a(),m("innerHTML",c(2,1,e.info),At)}}function jr(t,f){if(t&1){let e=v();r(0,"button",8),_("click",function(){g(e);let n=d(2);return C(n.onKeep())}),p(1),l(2,"translate"),o()}t&2&&(a(),h(" ",c(2,1,"DIALOGS.CANCEL_CONFIG.KEEP")," "))}function Hr(t,f){if(t&1){let e=v();r(0,"div",2)(1,"button",4),_("click",function(){g(e);let n=d();return C(n.onCancel())}),p(2),l(3,"translate"),o(),r(4,"button",5),_("click",function(){g(e);let n=d();return C(n.onDelete())}),r(5,"mat-icon",6),p(6," warning "),o(),p(7),l(8,"translate"),o(),I(9,jr,3,3,"button",7),o()}if(t&2){let e=d();a(2),h(" ",c(3,3,"DIALOGS.CANCEL_CONFIG.CANCEL")," "),a(5),h(" ",c(8,5,"DIALOGS.CANCEL_CONFIG.DELETE")," "),a(2),b(e.lastStep?-1:9)}}var wa=(()=>{class t{constructor(e,i,n,s,y){this.dialogRef=e,this.data=i,this.facilityService=n,this.notificator=s,this.translate=y,this.theme="",this.title="",this.info="",this.loading=!1}ngOnInit(){this.theme=this.data.theme,this.lastStep=this.data.lastStep,this.lastStep?(this.title="DIALOGS.CANCEL_CONFIG.TITLE_COMPLETE",this.info="DIALOGS.CANCEL_CONFIG.INFO_COMPLETE"):(this.title="DIALOGS.CANCEL_CONFIG.TITLE_INCOMPLETE",this.info="DIALOGS.CANCEL_CONFIG.INFO_INCOMPLETE")}onCancel(){this.dialogRef.close(!1)}onDelete(){this.loading=!0,this.facilityService.deleteFacility(this.data.facilityId,!0).subscribe(()=>{this.notificator.showSuccess(this.translate.instant("DIALOGS.CANCEL_CONFIG.SUCCESS")),this.dialogRef.close(!0),this.loading=!1},()=>this.loading=!1)}onKeep(){this.dialogRef.close(!0)}static{this.\u0275fac=function(i){return new(i||t)(u(W),u(z),u(O),u(H),u(ce))}}static{this.\u0275cmp=E({type:t,selectors:[["app-cancel-configuration-dialog"]],decls:6,vars:7,consts:[["mat-dialog-title",""],["mat-dialog-content",""],["matDialogActions",""],[3,"innerHTML"],["mat-stroked-button","",1,"me-2",3,"click"],["color","warn","mat-flat-button","",1,"ms-auto","me-2",3,"click"],["iconPositionEnd",""],["color","accent","mat-flat-button",""],["color","accent","mat-flat-button","",3,"click"]],template:function(i,n){i&1&&(r(0,"div")(1,"h1",0),p(2),l(3,"translate"),o(),I(4,Gr,3,3,"div",1),I(5,Hr,10,7,"div",2),o()),i&2&&(Z(n.theme),a(2),T(c(3,5,n.title)),a(2),b(n.loading?-1:4),a(),b(n.loading?-1:5))},dependencies:[x,w,L,Ve,ke,ne,ee,ie,te,M,R],encapsulation:2})}}return t})();var Ur=["stepper"],Yr=()=>["select","id","name","enabled","description"],Wr=()=>["select","destinationId","service","warn","destination","type","propagationType"],zr=()=>["id","name","enabled","script","description"],$r=()=>["id","displayName","value","description"],Kr=()=>["id","vo","name","description"],qr=()=>["id","name","email","logins","organization"],Xr=()=>["id","name"],Qr=()=>["destinationId","service","warn","destination","type","propagationType"];function Zr(t,f){t&1&&S(0,"perun-web-apps-loading-table")}function Jr(t,f){t&1&&(p(0),l(1,"translate")),t&2&&T(c(1,1,"FACILITY_CONFIGURATION.HOSTS"))}function es(t,f){if(t&1){let e=v();r(0,"app-facility-hosts",15),_("hostEmitter",function(n){g(e);let s=d();return C(s.hosts=n)}),o()}t&2&&m("disableRouting",!0)}function ts(t,f){t&1&&(p(0),l(1,"translate")),t&2&&T(c(1,1,"FACILITY_CONFIGURATION.SERVICES"))}function is(t,f){if(t&1){let e=v();r(0,"h1",16),p(1),l(2,"translate"),o(),r(3,"perun-web-apps-alert",17),p(4),l(5,"translate"),o(),r(6,"div",18)(7,"perun-web-apps-debounce-filter",19),_("filter",function(n){g(e);let s=d();return C(s.applyFilter(n))}),o()(),r(8,"app-services-list",20),_("selectionChanged",function(){g(e);let n=d();return C(n.singleServiceSelected())}),o()}if(t&2){let e=d();a(),T(c(2,10,"FACILITY_CONFIGURATION.SERVICES")),a(3),h(" ",c(5,12,"FACILITY_CONFIGURATION.SERVICES_INFO")," "),a(3),m("placeholder","FACILITY_CONFIGURATION.SERVICES_FILTER"),a(),m("loading",e.processing)("disableRouting",!0)("displayedColumns",me(14,Yr))("selection",e.selection)("cachedSubject",e.cachedSubject)("filterValue",e.filterValue)("services",e.services)}}function ns(t,f){t&1&&(p(0),l(1,"translate")),t&2&&T(c(1,1,"FACILITY_CONFIGURATION.SERVICE_CONFIG"))}function as(t,f){if(t&1){let e=v();r(0,"perun-web-apps-service-search-select",26),_("serviceSelected",function(n){g(e);let s=d(2);return C(s.filterAttributes(n))}),o()}if(t&2){let e=d(2);m("disableAutoSelect",!0)("services",e.selection.selected)("multiple",!0)("theme","facility-theme")}}function os(t,f){if(t&1&&S(0,"perun-web-apps-attributes-list",27),t&2){let e=d(2);m("loading",e.processing)("emptyListText","FACILITY_CONFIGURATION.EMPTY_REQ_ATT")("attributes",e.filteredAttributes)("selection",e.attSelection)("cachedSubject",e.cachedSubject)}}function rs(t,f){if(t&1){let e=v();r(0,"h1",16),p(1),l(2,"translate"),o(),r(3,"perun-web-apps-alert",17),p(4),l(5,"translate"),o(),r(6,"div",18)(7,"button",21),_("click",function(){g(e);let n=d();return C(n.onRemoveAttributes())}),p(8),l(9,"translate"),o(),r(10,"button",22),_("click",function(){g(e);let n=d();return C(n.onSaveAttributes())}),p(11),l(12,"translate"),o(),I(13,as,1,4,"perun-web-apps-service-search-select",23),o(),r(14,"div",24),A(15,os,1,5,"perun-web-apps-attributes-list",25),o()}if(t&2){let e=d(),i=F(5),n=F(7);a(),T(c(2,9,"FACILITY_CONFIGURATION.SERVICE_CONFIG")),a(3),h(" ",c(5,11,"FACILITY_CONFIGURATION.ATT_INFO")," "),a(3),m("disabled",e.processing||e.attSelection.selected.length===0),a(),h(" ",c(9,13,"FACILITY_CONFIGURATION.REMOVE")," "),a(2),m("disabled",e.processing||e.attSelection.selected.length===0),a(),h(" ",c(12,15,"FACILITY_CONFIGURATION.SAVE")," "),a(2),b(i.selectedIndex===e.ATTRIBUTES_IDX?13:-1),a(2),m("perunWebAppsLoader",e.processing)("perunWebAppsLoaderIndicator",n)}}function ss(t,f){t&1&&(p(0),l(1,"translate")),t&2&&T(c(1,1,"FACILITY_CONFIGURATION.DESTINATION_CONFIG"))}function ls(t,f){if(t&1){let e=v();r(0,"app-perun-web-apps-facility-services-destinations",28),_("destinationEmitter",function(n){g(e);let s=d();return C(s.destinations=n)}),o()}if(t&2){let e=d();m("configServicesIds",e.serviceIds)("displayedColumns",me(5,Wr))("configServices",e.selection.selected)("loading",e.processing)("title","FACILITY_CONFIGURATION.DESTINATION_CONFIG")}}function cs(t,f){t&1&&(p(0),l(1,"translate")),t&2&&T(c(1,1,"FACILITY_CONFIGURATION.MANAGERS"))}function ps(t,f){t&1&&S(0,"app-perun-web-apps-facility-settings-managers",29),t&2&&m("disableRouting",!0)("disableSelf",!0)}function ds(t,f){t&1&&(p(0),l(1,"translate")),t&2&&T(c(1,1,"FACILITY_CONFIGURATION.SUMMARY"))}function ms(t,f){if(t&1&&S(0,"app-hosts-list",43),t&2){let e=d(3);m("loading",e.processing)("disableRouting",!0)("displayedColumns",me(4,Xr))("hosts",e.hosts)}}function us(t,f){if(t&1&&S(0,"app-perun-web-apps-destination-list",44),t&2){let e=d(3);m("loading",e.processing)("destinations",e.destinations)("displayedColumns",me(4,Qr))("services",e.serviceIds)}}function fs(t,f){if(t&1){let e=v();r(0,"mat-accordion")(1,"mat-expansion-panel",31)(2,"mat-expansion-panel-header")(3,"mat-panel-title"),S(4,"mat-icon",32),p(5),l(6,"translate"),o()(),r(7,"h1",16),p(8),l(9,"translate"),o(),r(10,"div",24),A(11,ms,1,5,"app-hosts-list",33),o()(),r(12,"mat-expansion-panel",31)(13,"mat-expansion-panel-header")(14,"mat-panel-title"),S(15,"mat-icon",34),p(16),l(17,"translate"),o()(),r(18,"h1",16),p(19),l(20,"translate"),o(),S(21,"app-services-list",35),o(),r(22,"mat-expansion-panel",36),_("opened",function(){g(e);let n=d(2);return C(n.getNonEmptyAttributes())}),r(23,"mat-expansion-panel-header")(24,"mat-panel-title"),S(25,"mat-icon",32),p(26),l(27,"translate"),o()(),r(28,"h1",16),p(29),l(30,"translate"),o(),S(31,"perun-web-apps-attributes-list",37),o(),r(32,"mat-expansion-panel",38),Me("expandedChange",function(n){g(e);let s=d(2);return Re(s.destinationServiceMissing,n)||(s.destinationServiceMissing=n),C(n)}),r(33,"mat-expansion-panel-header")(34,"mat-panel-title"),S(35,"mat-icon",39),p(36),l(37,"translate"),o()(),r(38,"h1",16),p(39),l(40,"translate"),o(),r(41,"div",24),A(42,us,1,5,"app-perun-web-apps-destination-list",40),o()(),r(43,"mat-expansion-panel")(44,"mat-expansion-panel-header")(45,"mat-panel-title"),S(46,"mat-icon",41),p(47),l(48,"translate"),o()(),S(49,"app-managers-page",42),o()()}if(t&2){let e=d(2),i=F(7);m("@.disabled",!0),a(),m("disabled",e.hosts.length===0),a(),Y("cursor-default",e.hosts.length===0),a(3),h(" ",c(6,42,"FACILITY_CONFIGURATION.HOSTS")," "),a(3),T(c(9,44,"FACILITY_CONFIGURATION.HOSTS")),a(3),m("perunWebAppsLoader",e.processing)("perunWebAppsLoaderIndicator",i),a(),m("disabled",e.selection.selected.length===0),a(),Y("cursor-default",e.selection.selected.length===0),a(3),h(" ",c(17,46,"FACILITY_CONFIGURATION.SERVICES")," "),a(3),T(c(20,48,"FACILITY_CONFIGURATION.SERVICES")),a(2),m("loading",e.processing)("disableRouting",!0)("displayedColumns",me(60,zr))("services",e.selection.selected),a(),m("disabled",e.selection.selected.length===0),a(),Y("cursor-default",e.selection.selected.length===0),a(3),h(" ",c(27,50,"FACILITY_CONFIGURATION.SERVICE_CONFIG")," "),a(3),T(c(30,52,"FACILITY_CONFIGURATION.ATTS")),a(2),m("loading",e.processing)("displayedColumns",me(61,$r))("attributes",e.filteredAttributes)("emptyListText","FACILITY_CONFIGURATION.EMPTY_REQ_ATT"),a(),De("expanded",e.destinationServiceMissing),m("disabled",e.selection.selected.length===0&&e.destinations.length===0),a(),Y("cursor-default",e.selection.selected.length===0&&e.destinations.length===0),a(3),h(" ",c(37,54,"FACILITY_CONFIGURATION.DESTINATION_CONFIG")," "),a(3),T(c(40,56,"FACILITY_CONFIGURATION.DESTINATION")),a(3),m("perunWebAppsLoader",e.processing)("perunWebAppsLoaderIndicator",i),a(5),h(" ",c(48,58,"FACILITY_CONFIGURATION.MANAGERS")," "),a(2),m("complementaryObject",e.facility)("configMode",!0)("disableRouting",!0)("availableRoles",e.availableRoles)("complementaryObjectType","Facility")("displayedGroupColumns",me(62,Kr))("displayedUserColumns",me(63,qr))}}function hs(t,f){if(t&1&&(r(0,"perun-web-apps-alert",17),S(1,"i",30),l(2,"translate"),o(),I(3,fs,50,64,"mat-accordion")),t&2){d();let e=F(5);a(),m("innerHTML",c(2,2,"FACILITY_CONFIGURATION.SUMMARY_INFO"),At),a(2),b(e.selectedIndex===e.steps.length-1?3:-1)}}function _s(t,f){if(t&1){let e=v();r(0,"button",45),_("click",function(){g(e);let n=d();return C(n.back())}),p(1),l(2,"translate"),o()}t&2&&(a(),h(" ",c(2,1,"FACILITY_CONFIGURATION.BACK")," "))}function gs(t,f){if(t&1){let e=v();r(0,"button",46),_("click",function(){g(e);let n=d();return C(n.next())}),p(1),l(2,"translate"),o()}if(t&2){d();let e=F(5);Y("me-2",e!==void 0&&e.selectedIndex!==0)("ms-auto",!(e!==void 0&&e.selectedIndex!==0)),a(),h(" ",c(2,5,"FACILITY_CONFIGURATION.NEXT")," ")}}function Cs(t,f){if(t&1){let e=v();r(0,"button",47),_("click",function(){g(e);let n=d();return C(n.onFinish())}),p(1),l(2,"translate"),o()}t&2&&(a(),h(" ",c(2,1,"FACILITY_CONFIGURATION.FINISH")," "))}var La=(()=>{class t{constructor(e,i,n,s,y,D,q,U,X,ae){this.attributesManager=e,this.serviceManager=i,this.facilityService=n,this.cd=s,this.dialog=y,this.notificator=D,this.translate=q,this.router=U,this.guiAuthResolver=X,this.entityStorageService=ae,this.processing=!1,this.filteredAttributes=[],this.attSelection=new G(!0,[],!0,(_e,ii)=>_e.id===ii.id),this.cachedSubject=new oe(!0),this.services=[],this.serviceIds=new Set,this.selection=new G(!0,[],!0,(_e,ii)=>_e.id===ii.id),this.hosts=[],this.destinations=[],this.destinationServiceMissing=!1,this.availableRoles=[],this.filterValue="",this.ATTRIBUTES_IDX=2,this.serviceControl=new le(!1,Fe.requiredTrue),this.attributesControl=new le(!0,Fe.requiredTrue),this.allowNavigate=!1,this.attributes=[],this.attributeIds=new Set,this.attributesPerService=new Map,this.servicesPerPackage=new Map,this.saveMsg="",this.removeMsg="",this.BEFORE_OPTIONAL_IDX=1,this.DESTINATIONS_IDX=3,this.AFTER_OPTIONAL_IDX=4,this.translate.get("FACILITY_CONFIGURATION.ATT_SAVED").subscribe(_e=>this.saveMsg=_e),this.translate.get("FACILITY_CONFIGURATION.ATT_REMOVED").subscribe(_e=>this.removeMsg=_e)}ngOnInit(){this.facility=this.entityStorageService.getEntity(),this.guiAuthResolver.assignAvailableRoles(this.availableRoles,"Facility"),this.serviceManager.getServices().subscribe(e=>{this.services=e})}ngAfterViewInit(){this.cd.detectChanges(),this.attSelection.changed.subscribe(()=>{this.attributesControl.setValue(this.attSelection.selected.length===0)})}onCancel(){let e=k();e.width="550px",e.data={facilityId:this.facility.id,lastStep:this.stepper.selectedIndex===this.stepper.steps.length-1,theme:"facility-theme"},this.dialog.open(wa,e).afterClosed().subscribe(n=>{n&&(this.allowNavigate=!0,sessionStorage.removeItem("newFacilityId"),this.router.navigate(["facilities"],{queryParamsHandling:"merge"}))})}singleServiceSelected(){this.setServiceControl(),this.processing}back(){this.stepper.selectedIndex<=this.BEFORE_OPTIONAL_IDX&&this.setServiceControl(),this.stepper.selectedIndex===this.AFTER_OPTIONAL_IDX&&this.selection.selected.length===0?this.stepper.selectedIndex=this.BEFORE_OPTIONAL_IDX:this.stepper.previous()}onSaveAttributes(){return new Promise((e,i)=>{this.processing=!0,this.attributesManager.setFacilityAttributes({facility:this.facility.id,attributes:this.attSelection.selected}).subscribe({next:()=>{this.notificator.showSuccess(this.saveMsg),this.attSelection.clear(),this.cachedSubject.next(!0),this.processing=!1,e()},error:n=>{this.processing=!1,i(n)}})})}next(){this.checkDestinationDependency(this.stepper.selectedIndex),this.stepper.selectedIndex===this.BEFORE_OPTIONAL_IDX?this.selection.selected.length===0?this.openSkipDialog():(this.getRequiredAttributes(),this.stepper.next()):this.stepper.selectedIndex===this.ATTRIBUTES_IDX?this.attSelection.selected.length!==0?this.openUnsavedAttsDialog():this.stepper.next():this.stepper.next()}onFinish(){this.allowNavigate=!0,sessionStorage.removeItem("newFacilityId"),this.router.navigate(["facilities",this.facility.id],{queryParamsHandling:"merge"})}onRemoveAttributes(){this.processing=!0;let e=this.attSelection.selected.map(i=>i.id);this.attributesManager.removeFacilityAttributes(this.facility.id,e).subscribe({next:()=>{this.notificator.showSuccess(this.removeMsg),this.attSelection.clear(),this.cachedSubject.next(!0),this.getRequiredAttributes(),this.processing=!1},error:()=>this.processing=!1})}filterAttributes(e){if(e===void 0||e.length===0){this.filteredAttributes=this.attributes;return}let i=new Set;for(let n of e)this.attributesPerService.get(n.id).forEach(s=>i.add(s));this.filteredAttributes=[];for(let n of this.attributes)i.has(n.id)&&this.filteredAttributes.push(n);this.attSelection.clear(),this.cachedSubject.next(!0)}getNonEmptyAttributes(){this.filteredAttributes=this.attributes.filter(e=>{if(e.value&&(!Array.isArray(e.value)||e.value.length!==0))return e})}navigationStep(e){this.checkDestinationDependency(e.previouslySelectedIndex),e.selectedIndex===this.ATTRIBUTES_IDX?this.getRequiredAttributes():e.selectedIndex===this.DESTINATIONS_IDX?this.processing=!1:e.selectedIndex<=this.BEFORE_OPTIONAL_IDX&&this.setServiceControl()}applyFilter(e){this.filterValue=e,this.selection.clear(),this.cachedSubject.next(!0)}canDeactivate(){return this.allowNavigate||this.onCancel(),this.allowNavigate}getServiceRequiredAttributes(e,i){i!==e.length&&this.attributesManager.getRequiredAttributesDefinition(e[i].id).subscribe(n=>{n=n.filter(s=>this.attributeIds.has(s.id)),this.attributesPerService.set(e[i].id,n.map(s=>s.id)),this.getServiceRequiredAttributes(e,i+1)})}setServiceControl(){this.serviceControl.setValue(this.selection.selected.length!==0)}openSkipDialog(){let e=k();e.width="400px",e.data={theme:"facility-theme"},this.dialog.open(Ma,e).afterClosed().subscribe(n=>{n&&(this.serviceControl.setValue(!0),this.stepper.selectedIndex=this.AFTER_OPTIONAL_IDX)})}getRequiredAttributes(){this.processing=!0,this.attributesManager.getRequiredAttributesFacilityServices(this.selection.selected.map(e=>e.id),this.facility.id).subscribe(e=>{this.attSelection.clear(),this.attributes=e.filter(i=>!an(i)),this.filteredAttributes=this.attributes,this.attributes.forEach(i=>this.attributeIds.add(i.id)),this.getServiceRequiredAttributes(this.selection.selected,0),this.processing=!1})}openUnsavedAttsDialog(){let e=k();e.width="400px",e.data={theme:"facility-theme"},this.dialog.open(Fa,e).afterClosed().subscribe(n=>{n&&this.onSaveAttributes().then(()=>{this.stepper.next()},()=>this.getRequiredAttributes())})}checkDestinationDependency(e){(e===this.BEFORE_OPTIONAL_IDX||e===this.DESTINATIONS_IDX)&&(this.serviceIds=new Set([...this.selection.selected.map(i=>i.id)]),this.destinationServicePresent())}destinationServicePresent(){for(let e of this.destinations)if(!this.serviceIds.has(e.service.id)){this.destinationServiceMissing=!0;return}this.destinationServiceMissing=!1}static{this.\u0275fac=function(i){return new(i||t)(u(Vt),u(ue),u(O),u(Ue),u(J),u(H),u(ce),u(st),u(B),u(j))}}static{this.\u0275cmp=E({type:t,selectors:[["app-facility-configuration-page"]],viewQuery:function(i,n){if(i&1&&Se(Ur,5),i&2){let s;ve(s=Ie())&&(n.stepper=s.first)}},decls:33,vars:15,consts:[["stepper",""],["spinner",""],[1,"facility-theme"],[1,"page-title"],[3,"selectionChange","linear"],["matStepLabel",""],["matStepContent",""],[3,"stepControl"],["optional","true",3,"editable","stepControl"],[3,"editable","optional"],[1,"actions"],["mat-stroked-button","",3,"click"],["mat-stroked-button","",1,"ms-auto","me-2"],["color","accent","mat-flat-button","",3,"me-2","ms-auto"],["color","accent","mat-flat-button","",1,"me-2"],[3,"hostEmitter","disableRouting"],[1,"page-subtitle"],["alert_type","info"],[1,"filters"],[1,"filter",3,"filter","placeholder"],[3,"selectionChanged","loading","disableRouting","displayedColumns","selection","cachedSubject","filterValue","services"],["color","warn","mat-flat-button","",1,"me-2",3,"click","disabled"],["color","accent","mat-flat-button","",1,"me-2",3,"click","disabled"],[1,"service-search-select",3,"disableAutoSelect","services","multiple","theme"],[1,"position-relative","table-min-height"],[3,"loading","emptyListText","attributes","selection","cachedSubject",4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],[1,"service-search-select",3,"serviceSelected","disableAutoSelect","services","multiple","theme"],[3,"loading","emptyListText","attributes","selection","cachedSubject"],[3,"destinationEmitter","configServicesIds","displayedColumns","configServices","loading","title"],[3,"disableRouting","disableSelf"],[3,"innerHTML"],[3,"disabled"],["svgIcon","perun-hosts",1,"me-2"],[3,"loading","disableRouting","displayedColumns","hosts",4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],["svgIcon","perun-service",1,"me-2"],[3,"loading","disableRouting","displayedColumns","services"],[3,"opened","disabled"],[3,"loading","displayedColumns","attributes","emptyListText"],[3,"expandedChange","expanded","disabled"],["svgIcon","perun-service_destination",1,"me-2"],[3,"loading","destinations","displayedColumns","services",4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],["svgIcon","perun-manager",1,"me-2"],[3,"complementaryObject","configMode","disableRouting","availableRoles","complementaryObjectType","displayedGroupColumns","displayedUserColumns"],[3,"loading","disableRouting","displayedColumns","hosts"],[3,"loading","destinations","displayedColumns","services"],["mat-stroked-button","",1,"ms-auto","me-2",3,"click"],["color","accent","mat-flat-button","",3,"click"],["color","accent","mat-flat-button","",1,"me-2",3,"click"]],template:function(i,n){if(i&1){let s=v();r(0,"div",2)(1,"div",3),p(2),l(3,"translate"),o(),r(4,"mat-stepper",4,0),_("selectionChange",function(D){return g(s),C(n.navigationStep(D))}),A(6,Zr,1,0,"ng-template",null,1,V),r(8,"mat-step"),A(9,Jr,2,3,"ng-template",5)(10,es,1,1,"ng-template",6),o(),r(11,"mat-step",7),A(12,ts,2,3,"ng-template",5)(13,is,9,15,"ng-template",6),o(),r(14,"mat-step",8),A(15,ns,2,3,"ng-template",5)(16,rs,16,17,"ng-template",6),o(),r(17,"mat-step",9),A(18,ss,2,3,"ng-template",5)(19,ls,1,6,"ng-template",6),o(),r(20,"mat-step"),A(21,cs,2,3,"ng-template",5)(22,ps,1,2,"ng-template",6),o(),r(23,"mat-step"),A(24,ds,2,3,"ng-template",5)(25,hs,4,4,"ng-template",6),o()(),r(26,"div",10)(27,"button",11),_("click",function(){return g(s),C(n.onCancel())}),p(28),l(29,"translate"),o(),I(30,_s,3,3,"button",12),I(31,gs,3,7,"button",13),I(32,Cs,3,3,"button",14),o()()}if(i&2){let s=F(5);a(2),h(" ",c(3,11,"FACILITY_CONFIGURATION.TITLE")," "),a(2),m("linear",!0),a(7),m("stepControl",n.serviceControl),a(3),m("editable",n.selection.selected.length!==0)("stepControl",n.attributesControl),a(3),m("editable",n.selection.selected.length!==0||n.destinations.length!==0)("optional",n.destinations.length===0),a(11),h(" ",c(29,13,"FACILITY_CONFIGURATION.CANCEL")," "),a(2),b(s!==void 0&&s.selectedIndex!==0?30:-1),a(),b(s!==void 0&&s.selectedIndex!==s.steps.length-1?31:-1),a(),b(s!==void 0&&s.selectedIndex===s.steps.length-1?32:-1)}},dependencies:[x,w,L,Ve,ke,Be,Ne,de,$t,Wi,Yi,ji,Hi,Ui,Xi,Ki,zi,qi,$i,M,pe,ei,qn,Mn,Ht,Zt,Qt,Jt,qt,N,R],styles:[".icon-scale[_ngcontent-%COMP%]{transform:scale(1.7);margin-left:.5rem;margin-top:-.6rem;margin-right:.9rem}.filters[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;align-items:baseline}.package-search-select[_ngcontent-%COMP%]{width:650px}.service-search-select[_ngcontent-%COMP%]{width:400px}.filter[_ngcontent-%COMP%]{width:350px;margin-right:20px}.actions[_ngcontent-%COMP%]{background-color:#fff;display:flex;padding:20px}.cursor-default[_ngcontent-%COMP%]{cursor:default}"]})}}return t})();var pi=(()=>{class t{constructor(e){this.router=e}canActivate(e){return e.parent.params.facilityId===sessionStorage.getItem("newFacilityId")?!0:(this.router.navigate(["/home"],{queryParamsHandling:"merge"}),!1)}canDeactivate(e){return e.canDeactivate()}static{this.\u0275fac=function(i){return new(i||t)(gi(st))}}static{this.\u0275prov=_i({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();var Ss=()=>["id","name"];function vs(t,f){t&1&&S(0,"perun-web-apps-loading-table")}function Is(t,f){if(t&1){let e=v();r(0,"perun-web-apps-users-list",5),l(1,"async"),l(2,"async"),_("queryChanged",function(n){g(e);let s=d();return C(s.nextPage.next(n))})("downloadAll",function(n){g(e);let s=d();return C(s.downloadAll(n))}),o()}if(t&2){let e=d();m("loading",c(1,9,e.loading$))("disableRouting",!0)("users",c(2,11,e.usersPage$))("displayColumns",e.displayedColumns)("sortableColumns",me(13,Ss))("selection",e.selection)("filter",e.searchString)("facilityId",e.data.entityId)("tableId",e.tableId)}}var Oa=(()=>{class t{constructor(e,i,n,s,y,D,q,U,X){this.data=e,this.dialogRef=i,this.store=n,this.facilityService=s,this.notificator=y,this.dialog=D,this.cd=q,this.usersManager=U,this.authResolver=X,this.selection=new G(!1,[],!0,(ae,_e)=>ae.id===_e.id),this.attrNames=[Ct.USER_DEF_PREFERRED_MAIL].concat(this.store.getLoginAttributeNames()),this.displayedColumns=["select","id","name","email","logins"],this.tableId=vn,this.searchString="",this.nextPage=new oe({}),this.routeAuth=!1,this.usersPage$=this.nextPage.pipe(ui(ae=>this.usersManager.getUsersPage({attrNames:this.attrNames,query:{order:ae.order,pageSize:ae.pageSize,offset:ae.offset,sortColumn:ae.sortColumn,searchString:ae.searchString,facilityId:this.data.entityId}}).pipe(mi(()=>this.cd.detectChanges()))),hi(()=>{this.selection.clear(),setTimeout(()=>this.loadingSubject$.next(!1),200)}),je({data:[],totalCount:0,offset:0,pageSize:0})),this.loadingSubject$=new oe(!1),this.loading$=di(this.loadingSubject$,this.nextPage.pipe(Ge(()=>!0)))}ngOnInit(){this.selection.changed.subscribe(e=>{this.ban=this.data.bans.find(i=>i.userId===e.source.selected[0]?.id)}),this.routeAuth=this.authResolver.isPerunAdminOrObserver()}cancel(){this.dialogRef.close(!1)}submitBan(e){this.ban?this.updateBan(e):this.banUser(e)}setFilter(e){this.searchString=e,this.selection.clear(),this.cd.detectChanges()}downloadAll(e){let i=this.nextPage.getValue(),n=k();n.width="500px";let s=this.dialog.open(un,n),y=this.usersManager.getUsersPage({attrNames:this.attrNames,query:{order:i.order,pageSize:e.length,offset:0,sortColumn:i.sortColumn,searchString:i.searchString,facilityId:this.data.entityId}}).subscribe({next:D=>{s.close(),vt(St(D.data,this.displayedColumns,e.getDataForColumnFun),e.format)},error:D=>{this.notificator.showRPCError(D),s.close()}});s.afterClosed().subscribe(()=>{y&&y.unsubscribe()})}banUser(e){this.facilityService.setFacilityBan({banOnFacility:{userId:this.selection.selected[0].id,facilityId:this.data.entityId,description:e.description,validityTo:e.validity,id:0,beanName:"BanOnVo"}}).subscribe({next:()=>{this.notificator.showSuccess("DIALOGS.ADD_BAN.SUCCESS_USER"),this.dialogRef.close(!0)}})}updateBan(e){this.facilityService.updateFacilityBan({banOnFacility:{id:this.ban.id,beanName:"BanOnFacility",facilityId:this.ban.facilityId,userId:this.ban.userId,description:e.description,validityTo:e.validity}}).subscribe({next:()=>{this.notificator.showSuccess("DIALOGS.UPDATE_BAN.SUCCESS"),this.dialogRef.close(!0)}})}static{this.\u0275fac=function(i){return new(i||t)(u(z),u(W),u(Nt),u(O),u(H),u(J),u(Ue),u(Pi),u(B))}}static{this.\u0275cmp=E({type:t,selectors:[["app-add-facility-ban-dialog"]],decls:8,vars:10,consts:[["spinner",""],[3,"add","cancelled","disabled","theme","ban"],[3,"filter","placeholder"],[1,"position-relative","table-min-height"],[3,"loading","disableRouting","users","displayColumns","sortableColumns","selection","filter","facilityId","tableId","queryChanged","downloadAll",4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],[3,"queryChanged","downloadAll","loading","disableRouting","users","displayColumns","sortableColumns","selection","filter","facilityId","tableId"]],template:function(i,n){if(i&1){let s=v();r(0,"app-add-ban-dialog",1),l(1,"async"),_("add",function(D){return g(s),C(n.submitBan(D))})("cancelled",function(){return g(s),C(n.cancel())}),r(2,"perun-web-apps-debounce-filter",2),_("filter",function(D){return g(s),C(n.setFilter(D))}),o(),A(3,vs,1,0,"ng-template",null,0,V),r(5,"div",3),A(6,Is,3,14,"perun-web-apps-users-list",4),l(7,"async"),o()()}if(i&2){let s=F(4);m("disabled",c(1,6,n.loading$)||n.selection.selected.length===0)("theme",n.data.theme)("ban",n.ban),a(2),m("placeholder","DIALOGS.ADD_BAN.FILTER"),a(4),m("perunWebAppsLoader",c(7,8,n.loading$))("perunWebAppsLoaderIndicator",s)}},dependencies:[x,de,Jn,Rn,N,pe,xt],encapsulation:2})}}return t})();function bs(t,f){if(t&1){let e=v();r(0,"button",8),_("click",function(){g(e);let n=d();return C(n.add())}),p(1),l(2,"translate"),o()}t&2&&(a(),h(" ",c(2,1,"FACILITY_DETAIL.SETTINGS.BANS.ADD")," "))}function ys(t,f){if(t&1){let e=v();r(0,"button",9),_("click",function(){g(e);let n=d();return C(n.remove())}),p(1),l(2,"translate"),o()}if(t&2){let e=d();m("disabled",e.loading||e.selection.selected.length===0),a(),h(" ",c(2,2,"FACILITY_DETAIL.SETTINGS.BANS.REMOVE")," ")}}function Ts(t,f){if(t&1){let e=v();r(0,"perun-web-apps-ban-on-entity-list",10),_("updateBan",function(n){g(e);let s=d();return C(s.update(n))}),o()}if(t&2){let e=d();m("loading",e.loading)("bans",e.bans)("selection",e.selection)("cachedSubject",e.cachedSubject)("displayedColumns",e.displayedColumns)("filter",e.filter)("updatePolicy","updateBan_BanOnFacility_policy")}}function As(t,f){t&1&&S(0,"perun-web-apps-loading-table")}var ka=(()=>{class t{constructor(e,i,n,s,y,D,q){this.facilityService=e,this.entityService=i,this.authResolver=n,this.dialog=s,this.notificator=y,this.store=D,this.userName=q,this.loading=!1,this.bans=[],this.removeAuth=!1,this.filter="",this.selection=new G(!1,[],!0,(U,X)=>U.ban.id===X.ban.id),this.cachedSubject=new oe(!0),this.attrNames=[Ct.MEMBER_DEF_MAIL,Ct.USER_DEF_PREFERRED_MAIL].concat(this.store.getLoginAttributeNames()),this.displayedColumns=["select","banId","subjectId","subjectName","description","expiration","edit"]}ngOnInit(){this.loading=!0,this.facility=this.entityService.getEntity(),this.addAuth=this.authResolver.isAuthorized("setBan_BanOnFacility_policy",[this.facility]),this.removeAuth=this.authResolver.isAuthorized("removeBan_int_policy",[this.facility]),this.refresh()}refresh(){this.loading=!0,this.facilityService.getEnrichedBansForFacility(this.facility.id,this.attrNames).subscribe({next:e=>{this.bans=e,this.selection.clear(),this.cachedSubject.next(!0),this.loading=!1},error:()=>this.loading=!1})}add(){let e=k();e.width="850px",e.data={entityId:this.facility.id,theme:"facility-theme",bans:this.bans.map(n=>n.ban)},this.dialog.open(Oa,e).afterClosed().subscribe(n=>{n&&this.refresh()})}remove(){let e=k();e.width="550px",e.data={theme:"facility-theme",title:"DIALOGS.REMOVE_BAN.TITLE",description:"DIALOGS.REMOVE_BAN.DESCRIPTION",items:[this.userName.transform(this.selection.selected[0].user)],type:"remove",showAsk:!0},this.dialog.open(yn,e).afterClosed().subscribe(n=>{n&&(this.loading=!0,this.facilityService.removeFacilityBanById(this.selection.selected[0].ban.id).subscribe(()=>{this.notificator.showSuccess("DIALOGS.REMOVE_BAN.SUCCESS"),this.refresh()}))})}update(e){let i=k();i.width="600px",i.data={ban:e.ban,theme:"facility-theme"},this.dialog.open(ia,i).afterClosed().subscribe(s=>{s&&this.refresh()})}applyFilter(e){this.filter=e,this.refresh()}static{this.\u0275fac=function(i){return new(i||t)(u(O),u(j),u(B),u(J),u(H),u(Nt),u(Pe))}}static{this.\u0275cmp=E({type:t,selectors:[["app-facility-settings-bans"]],features:[bi([Pe])],decls:11,vars:8,consts:[["spinner",""],[1,"page-subtitle"],[3,"click"],["color","accent","mat-flat-button","",1,"me-2","action-button"],["color","warn","mat-flat-button","",1,"me-2",3,"disabled"],[1,"mt-2","search-field",3,"filter","placeholder"],[1,"position-relative","table-min-height"],[3,"loading","bans","selection","cachedSubject","displayedColumns","filter","updatePolicy","updateBan",4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],["color","accent","mat-flat-button","",1,"me-2","action-button",3,"click"],["color","warn","mat-flat-button","",1,"me-2",3,"click","disabled"],[3,"updateBan","loading","bans","selection","cachedSubject","displayedColumns","filter","updatePolicy"]],template:function(i,n){if(i&1){let s=v();r(0,"h1",1),p(1),l(2,"translate"),o(),r(3,"perun-web-apps-refresh-button",2),_("click",function(){return g(s),C(n.refresh())}),o(),I(4,bs,3,3,"button",3),I(5,ys,3,4,"button",4),r(6,"perun-web-apps-debounce-filter",5),_("filter",function(D){return g(s),C(n.applyFilter(D))}),o(),r(7,"div",6),A(8,Ts,1,7,"perun-web-apps-ban-on-entity-list",7),o(),A(9,As,1,0,"ng-template",null,0,V)}if(i&2){let s=F(10);a(),h(" ",c(2,6,"FACILITY_DETAIL.SETTINGS.BANS.TITLE"),`
`),a(3),b(n.addAuth?4:-1),a(),b(n.removeAuth?5:-1),a(),m("placeholder","FACILITY_DETAIL.SETTINGS.BANS.FILTER"),a(2),m("perunWebAppsLoader",n.loading)("perunWebAppsLoaderIndicator",s)}},dependencies:[x,w,L,de,Ae,M,On,N,pe,R],encapsulation:2})}}return t})();var dh=[{path:"",component:aa,canActivate:[Kt]},{path:":facilityId",component:pa,canActivateChild:[Kt],children:[{path:"",component:da,data:{animation:"FacilityOverviewPage"}},{path:"attributes",component:fa,data:{animation:"FacilityAttributesPage"}},{path:"resources",component:oa,data:{animation:"FacilityResourcesPage"}},{path:"allowed-users",component:sa,data:{animation:"FacilityAllowedUsersPage"}},{path:"allowed-groups",component:ra,data:{animation:"FacilityAllowedGroupsPage"}},{path:"services-status",component:Da,data:{animation:"FacilityServiceStatusPage"}},{path:"services-status/:taskId",component:Ra,data:{animation:"FacilityTaskResultsPage"}},{path:"service-config",component:Sa,data:{animation:"FacilityServiceConfigPage"}},{path:"services-destinations",component:Zt,data:{animation:"FacilityServicesDestinationsPage"}},{path:"hosts",component:ei,data:{animation:"FacilityHostsPage"}},{path:"hosts/:hostId",component:Aa,data:{animation:"FacilityHostsDetailPage"}},{path:"settings",component:ma,children:[{path:"",component:ua,data:{animation:"FacilitySettingsOverviewPage"}},{path:"managers",component:Qt,data:{animation:"FacilitySettingsManagersPage"}},{path:"bans",component:ka,data:{animation:"FacilitySettingsBansPage"}}]},{path:"configuration",component:La,canActivate:[pi],canDeactivate:[pi]}]},{path:":facilityId/resources/:resourceId",component:Hn,canActivateChild:[Kt],children:[{path:"",component:Un,data:{animation:"ResourceOverviewPage"}},{path:"attributes",component:$n,data:{animation:"ResourceAttributesPage"}},{path:"groups",component:Yn,data:{animation:"ResourceGroupsComponent"}},{path:"services",component:Xn,data:{animation:"ResourceAssignedServicesComponent"}},{path:"members",component:Qn,data:{animation:"ResourceAssignedMembersComponent"}},{path:"tags",component:Zn,data:{animation:"ResourceTagsComponent"}},{path:"settings",component:Wn,children:[{path:"",component:zn,data:{animation:"ResourceSettingsOverviewPage"}},{path:"managers",component:Kn,data:{animation:"ResourceSettingsManagersPage"}},{path:"bans",component:ea,data:{animation:"ResourceSettingsBansPage"}}]}]}];export{dh as facilitiesRoutes};
