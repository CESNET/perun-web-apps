import{a as er}from"./chunk-HP6ABCKO.js";import{a as Ja}from"./chunk-7LAQI6ZP.js";import{a as Je}from"./chunk-CPCVLOXF.js";import{$a as ke,$b as qe,$c as Pi,$e as Fi,$g as Da,$h as Ki,Aa as Q,Ac as et,Ad as Xt,Ae as $o,Ah as Na,Ba as Z,Bd as Mt,Be as Yo,Bf as pn,Bg as zi,Bh as Ba,Ca as I,Cc as Se,Ce as Xo,Cf as mn,Cg as qi,Ch as Va,Da as C,Dc as O,Dd as Tt,De as Ko,Df as So,Dh as Fa,Ea as c,Ec as L,Ee as Ni,Ef as na,Ei as za,Fd as bn,Ff as oa,Fg as ba,Fi as qa,G as Nt,Ge as Bi,Gf as aa,Gh as $i,Gi as $a,H as ui,He as Vi,Hf as ji,Ia as Be,If as ra,Ig as Vn,Ja as Ve,Jc as Fo,Jd as De,Je as An,Jg as Ea,K as Ai,Ka as Fe,Kd as En,Ke as Mn,Kh as Yi,La as y,Ld as Qe,Le as xn,Li as Ya,Ma as Ee,Mb as ne,Mc as fi,Md as tt,Me as Dn,Mh as jn,Mi as Xa,N as To,Na as H,Nc as ko,Nd as Si,Oa as m,Og as Ia,Oh as Wn,Pa as E,Pc as Uo,Pg as Ta,Q as _o,Qa as h,Qc as Ht,Qd as Wo,Qe as Qo,Qf as q,Qg as Aa,Qi as zn,Ra as ot,Rb as ze,Rc as Li,Rd as In,Re as Zo,Rf as xt,S as f,Sa as Mo,Sb as he,Sc as yi,Se as Rn,Sh as Hn,T as g,Ta as xo,Tb as se,Tc as Pe,Td as Vt,Te as On,Ti as Ka,Ua as J,Ub as _i,Uc as rt,Ue as Ln,Uf as Wi,Uh as ka,Ui as Qa,V as we,Va as ee,Vb as Po,Vc as vn,Vd as Tn,Ve as ii,Vi as Za,W as Jt,Wa as te,Wb as Go,Wc as wi,We as ni,Wf as sa,Wg as Ma,Wh as Ua,Xa as w,Xb as Te,Xc as Re,Xe as oi,Xg as xa,Xh as ye,Ya as W,Yb as hi,Yc as We,Yd as vi,Ye as ai,Za as fn,Zb as Ue,Zc as Oe,Zd as ho,Ze as ri,Zf as He,Zg as Ne,_ as kt,_a as ue,_b as Di,_c as $e,_d as an,_e as k,_g as Fn,_h as Xi,aa as o,ab as Mi,ac as Ri,ad as Ye,ae as fo,af as Kt,ag as la,ah as mi,ai as ja,bb as Do,bc as Oi,bd as ti,bf as go,bg as si,bh as Ra,c as ci,ca as pt,cb as Ro,cc as No,cd as G,cf as rn,cg as pa,d as ge,db as l,dc as Bo,dd as P,dg as ma,dh as Oa,eb as p,ec as Vo,ef as Jo,eh as bi,fb as Me,fc as It,fd as gi,fe as Le,fg as Gn,ga as _,gb as nn,gd as Ci,ge as pe,h as Zt,ha as x,hc as on,hd as st,he as U,ib as Oo,ic as Sn,id as lt,ie as j,if as Co,ih as La,ii as Wa,jb as B,jc as je,jd as ve,je as Ae,k as Dt,ka as ei,kb as yt,kc as le,kd as be,ke as $,kf as ea,kg as da,kh as kn,ld as Ge,le as Y,lf as yn,lg as ca,ma as T,mb as xi,mc as wt,md as oe,me as X,mg as ua,nb as gn,nc as Pt,ne as K,nf as F,ng as _a,oa as pi,ob as Lo,oc as _e,of as wn,og as Nn,pa as Rt,pb as yo,pc as mt,pd as zt,pg as ha,ph as ya,qa as Ao,qb as at,qc as dt,qd as qt,qf as ki,qg as Bn,qh as vo,r as Wt,ra as v,rb as wo,rc as ct,rd as $t,rf as Pn,rg as fa,rh as wa,ri as bo,sa as b,sb as At,sc as ut,sd as Yt,sf as Ot,sg as ga,sh as Un,si as Ha,ta as Ce,tb as Cn,tc as _t,tf as Et,tg as Ca,ua as de,ub as D,uc as ht,ud as Xe,uf as ta,ug as Sa,va as ce,vc as ft,vd as Ke,vg as va,wa as u,wc as gt,we as Gi,wf as sn,wh as Gt,xa as a,xc as Ct,xd as jo,xe as Ho,xf as ln,xh as Ze,y as hn,ya as r,yc as St,yd as V,ye as zo,yf as Ui,yg as Hi,yh as Pa,za as A,zc as vt,ze as qo,zf as ia,zh as Ga}from"./chunk-6NXECROM.js";var tr=(()=>{class t{constructor(e,n,i,s,S){this.dialogRef=e,this.data=n,this.notificator=i,this.voService=s,this.translate=S,this.force=!1,this.displayedColumns=["name"],this.relations=[],S.get("DIALOGS.REMOVE_VO.SUCCESS").subscribe(M=>this.successMessage=M)}ngOnInit(){this.theme=this.data.theme,this.dataSource=new et(this.data.vos),this.relations.push(this.translate.instant("DIALOGS.REMOVE_VO.GROUP_RELATION")),this.relations.push(this.translate.instant("DIALOGS.REMOVE_VO.MEMBER_RELATION")),this.relations.push(this.translate.instant("DIALOGS.REMOVE_VO.RESOURCE_RELATION"))}onCancel(){this.dialogRef.close(!1)}onDelete(){this.loading=!0,this.voService.deleteVo(this.data.vos[0].id,this.force).subscribe(()=>{this.notificator.showSuccess(this.successMessage),this.loading=!1,this.dialogRef.close(!0)},()=>this.loading=!1)}onSubmit(e){this.force=e.force,e.deleted?this.onDelete():this.onCancel()}static{this.\u0275fac=function(n){return new(n||t)(_(U),_(j),_(q),_(Vt),_(Se))}}static{this.\u0275cmp=x({type:t,selectors:[["app-remove-vo-dialog"]],decls:2,vars:6,consts:[[3,"deleted","entityNames","entityType","loading","relations"]],template:function(n,i){n&1&&(a(0,"div")(1,"perun-web-apps-delete-entity-dialog",0),C("deleted",function(S){return i.onSubmit(S)}),r()()),n&2&&(H(i.theme),o(),u("entityNames",i.dataSource)("entityType","organizations")("loading",i.loading)("relations",i.relations))},dependencies:[D,Un],styles:[".foo[_ngcontent-%COMP%]{margin-top:20px}"]})}}return t})();function Gr(t,d){t&1&&A(0,"perun-web-apps-loading-dialog")}function Nr(t,d){t&1&&(a(0,"mat-error"),m(1),l(2,"translate"),r()),t&2&&(o(),h(" ",p(2,1,"DIALOGS.NAME_SPACE_ERROR")," "))}function Br(t,d){t&1&&(a(0,"mat-error"),m(1),l(2,"translate"),r()),t&2&&(o(),h(" ",p(2,1,"DIALOGS.CREATE_VO.FILL_FULL_NAME")," "))}function Vr(t,d){t&1&&(a(0,"mat-error"),m(1),l(2,"translate"),r()),t&2&&(o(),h(" ",p(2,1,"DIALOGS.NAME_SPACE_ERROR")," "))}function Fr(t,d){t&1&&(a(0,"mat-error"),m(1),l(2,"translate"),r()),t&2&&(o(),h(" ",p(2,1,"DIALOGS.CREATE_VO.FILL_SHORT_NAME")," "))}function kr(t,d){if(t&1){let e=I();a(0,"div")(1,"h1",2),m(2),l(3,"translate"),r(),a(4,"div",3)(5,"mat-form-field")(6,"mat-label"),m(7),l(8,"translate"),r(),A(9,"input",4),v(10,Nr,3,3,"mat-error"),v(11,Br,3,3,"mat-error"),r(),a(12,"mat-form-field")(13,"mat-label"),m(14),l(15,"translate"),r(),A(16,"input",5),v(17,Vr,3,3,"mat-error"),v(18,Fr,3,3,"mat-error"),r()(),a(19,"div",6)(20,"button",7),C("click",function(){f(e);let i=c();return g(i.onCancel())}),m(21),l(22,"translate"),r(),a(23,"div",8),l(24,"translate"),a(25,"button",9),C("click",function(){f(e);let i=c();return g(i.onSubmit())}),m(26),l(27,"translate"),r()()()()}if(t&2){let e=c();o(2),E(p(3,15,"DIALOGS.CREATE_VO.TITLE")),o(5),E(p(8,17,"DIALOGS.CREATE_VO.FULL_NAME")),o(2),u("formControl",e.fullNameCtrl),o(),b(e.fullNameCtrl.errors!=null&&e.fullNameCtrl.errors.spaceName?10:-1),o(),b(e.fullNameCtrl.errors!=null&&e.fullNameCtrl.errors.spaceName?-1:11),o(3),E(p(15,19,"DIALOGS.CREATE_VO.SHORT_NAME")),o(2),u("formControl",e.shortNameCtrl),o(),b(e.shortNameCtrl.errors!=null&&e.shortNameCtrl.errors.spaceName?17:-1),o(),b(e.shortNameCtrl.errors!=null&&e.shortNameCtrl.errors.spaceName?-1:18),o(3),h(" ",p(22,21,"DIALOGS.CREATE_VO.CANCEL")," "),o(2),u("matTooltip",w(p(24,23,"DIALOGS.CREATE_VO.TOOLTIP")))("matTooltipDisabled",e.shortNameCtrl.valid&&e.fullNameCtrl.valid),o(2),u("disabled",e.shortNameCtrl.invalid||e.fullNameCtrl.invalid),o(),h(" ",p(27,25,"DIALOGS.CREATE_VO.CREATE")," ")}}var ir=(()=>{class t{constructor(e,n,i,s,S,M){this.dialogRef=e,this.data=n,this.notificator=i,this.voService=s,this.translate=S,this.router=M,S.get("DIALOGS.CREATE_VO.SUCCESS").subscribe(R=>this.successMessage=R)}ngOnInit(){this.theme=this.data.theme,this.shortNameCtrl=new Te("",[he.required,he.pattern("^[\\w.-]+$"),he.maxLength(33),pn()]),this.fullNameCtrl=new Te("",[he.required,he.pattern(".*[\\S]+.*"),he.maxLength(129),pn()])}onCancel(){this.dialogRef.close(!1)}onSubmit(){this.loading=!0,this.voService.createVoWithName(this.fullNameCtrl.value,this.shortNameCtrl.value).subscribe({next:e=>{this.notificator.showSuccess(this.successMessage),this.loading=!1,this.router.navigate(["/organizations",e.id],{queryParamsHandling:"preserve"}),this.dialogRef.close(!0)},error:()=>this.loading=!1})}static{this.\u0275fac=function(n){return new(n||t)(_(U),_(j),_(q),_(Vt),_(Se),_(fi))}}static{this.\u0275cmp=x({type:t,selectors:[["app-create-vo-dialog"]],decls:4,vars:5,consts:[["spinner",""],[4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],["mat-dialog-title",""],["mat-dialog-content","",1,"dialog-container"],["matInput","","data-cy","vo-name-input","required","",3,"formControl"],["matInput","","data-cy","vo-shortname-input","required","",3,"formControl"],["mat-dialog-actions",""],["mat-stroked-button","",1,"ms-auto",3,"click"],["matTooltipPosition","above",3,"matTooltip","matTooltipDisabled"],["color","accent","data-cy","create-vo-button","mat-flat-button","",1,"ms-2",3,"click","disabled"]],template:function(n,i){if(n&1&&(T(0,Gr,1,0,"ng-template",null,0,B),a(2,"div"),T(3,kr,28,27,"div",1),r()),n&2){let s=y(1);o(2),H(W("",i.theme," position-relative")),o(),u("perunWebAppsLoader",i.loading)("perunWebAppsLoaderIndicator",s)}},dependencies:[D,P,G,Oe,Re,Pe,rt,Ke,Xe,le,ze,se,It,qe,K,$,X,Y,oe,L,ne,V,O],styles:[".mat-mdc-dialog-content[_ngcontent-%COMP%]{height:auto}@media (min-width: 421px) and (max-width: 755px){.mat-mdc-dialog-content[_ngcontent-%COMP%]{height:150px}}@media (max-width: 420px){.mat-mdc-dialog-content[_ngcontent-%COMP%]{height:175px}}"]})}}return t})();var Ur=()=>({color:"black"});function jr(t,d){if(t&1){let e=I();a(0,"button",11),C("click",function(){f(e);let i=c();return g(i.onRemoveVo())}),m(1),l(2,"translate"),r()}if(t&2){let e=c();u("disabled",e.selection.selected.length===0),o(),h(" ",p(2,2,"VO_MANAGEMENT.REMOVE_VO")," ")}}function Wr(t,d){t&1&&A(0,"perun-web-apps-loading-table")}function Hr(t,d){if(t&1&&A(0,"perun-web-apps-vos-list",12),t&2){let e=c();u("loading",e.loading)("displayColumns",e.displayedColumns)("filterValue",e.filterValue)("recentIds",e.recentIds)("cachedSubject",e.cachedSubject)("selection",e.selection)("vos",e.vos)}}var bg=(()=>{class t{static{this.id="VoSelectPageComponent"}constructor(e,n,i,s,S,M,R,N){this.sideMenuService=e,this.voService=n,this.guiAuthResolver=i,this.dialog=s,this.notificator=S,this.apiRequest=M,this.cacheHelperService=R,this.destroyRef=N,this.vos=[],this.recentIds=[],this.filterValue="",this.selection=new _e(!0,[],!0,(re,xe)=>re.vo.id===xe.vo.id),this.cachedSubject=new ge(!0)}ngOnInit(){this.loading=!0,this.selection=new _e(!1,[]),this.createAuth=this.guiAuthResolver.isAuthorized("createVo_Vo_policy",[]),this.deleteAuth=this.guiAuthResolver.isAuthorized("deleteVo_Vo_policy",[]),this.displayedColumns=this.deleteAuth?["checkbox","id","hierarchy","recent","shortName","name"]:["id","recent","hierarchy","shortName","name"],this.refreshTable(),this.cacheHelperService.refreshComponentCachedData().pipe(Ne(this.destroyRef)).subscribe(e=>{e===t.id&&this.refreshTable()})}ngAfterViewChecked(){this.sideMenuService.setAccessMenuItems([])}refreshTable(){this.loading=!0,this.selection.clear(),this.cachedSubject.next(!0),this.apiRequest.dontHandleErrorForNext(),this.voService.getMyEnrichedVos().subscribe({next:e=>{this.vos=e,this.recentIds=Jo("vos"),this.loading=!1},error:e=>{e.name==="PrivilegeException"?(this.vos=[],this.loading=!1):this.notificator.showRPCError(e)}})}applyFilter(e){this.filterValue=e,this.refreshTable()}onCreateVo(){let e=F();e.width="610px",e.data={theme:"vo-theme"},this.dialog.open(ir,e).afterClosed().subscribe(i=>{i&&(this.loading=!0,this.refreshTable())})}onRemoveVo(){let e=F();e.width="500px",e.data={theme:"vo-theme",vos:[this.selection.selected[0].vo]},this.dialog.open(tr,e).afterClosed().subscribe(i=>{i&&this.refreshTable()})}static{this.\u0275fac=function(n){return new(n||t)(_(Za),_(Vt),_(pe),_(Ae),_(q),_(xt),_(Je),_(we))}}static{this.\u0275cmp=x({type:t,selectors:[["app-vo-select-page"]],hostVars:2,hostBindings:function(n,i){n&2&&Ee("router-component",i.true)},decls:18,vars:20,consts:[["spinner",""],[1,"container-fluid","ps-xl-5","pe-xl-5","vo-theme"],[1,"page-title","d-flex"],["svgIcon","perun-vo-black",1,"perun-icon","icon-scale",3,"ngStyle"],[3,"refresh"],["matTooltipPosition","below",3,"matTooltipDisabled","matTooltip"],["data-cy","new-vo-button","color","accent","mat-flat-button","",1,"me-2","action-button",3,"click","disabled"],["color","warn","mat-flat-button","",1,"me-2",3,"disabled"],[3,"filter","autoFocus","placeholder","linkGlobalSearch"],[1,"position-relative","table-min-height"],[3,"loading","displayColumns","filterValue","recentIds","cachedSubject","selection","vos",4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],["color","warn","mat-flat-button","",1,"me-2",3,"click","disabled"],[3,"loading","displayColumns","filterValue","recentIds","cachedSubject","selection","vos"]],template:function(n,i){if(n&1){let s=I();a(0,"div",1),A(1,"perun-web-apps-back-button"),a(2,"h1",2),A(3,"mat-icon",3),m(4),l(5,"translate"),r(),a(6,"perun-web-apps-refresh-button",4),C("refresh",function(){return f(s),g(i.refreshTable())}),r(),a(7,"span",5),l(8,"translate"),a(9,"button",6),C("click",function(){return f(s),g(i.onCreateVo())}),m(10),l(11,"translate"),r()(),v(12,jr,3,4,"button",7),a(13,"perun-web-apps-debounce-filter",8),C("filter",function(M){return f(s),g(i.applyFilter(M))}),r(),T(14,Wr,1,0,"ng-template",null,0,B),a(16,"div",9),T(17,Hr,1,7,"perun-web-apps-vos-list",10),r()()}if(n&2){let s=y(15);o(3),u("ngStyle",ue(19,Ur)),o(),h(" ",p(5,13,"VO_MANAGEMENT.TITLE")," "),o(3),u("matTooltip",w(p(8,15,"VO_MANAGEMENT.CREATE_DISABLED")))("matTooltipDisabled",i.createAuth),o(2),u("disabled",!i.createAuth),o(),h(" ",p(11,17,"VO_MANAGEMENT.CREATE_VO")," "),o(2),b(i.deleteAuth?12:-1),o(),u("autoFocus",!0)("placeholder","VO_MANAGEMENT.FILTER_PLACEHOLDER")("linkGlobalSearch",!0),o(4),u("perunWebAppsLoader",i.loading)("perunWebAppsLoaderIndicator",s)}},dependencies:[D,yo,P,G,lt,st,Ka,Ra,Ze,Pa,ye,V,L,ne,Ge,O],styles:[".icon-scale[_ngcontent-%COMP%]{transform:scale(1.7);margin-left:.5rem;margin-top:-.4rem;margin-right:.9rem}"]})}}return t})();function zr(t,d){if(t&1&&(a(0,"mat-option",4),m(1),l(2,"groupRole"),r()),t&2){let e=d.$implicit,n=c();H(n.theme),u("value",e),o(),E(p(2,4,e))}}function qr(t,d){if(t&1&&(a(0,"mat-option",4),m(1),l(2,"groupRoleType"),r()),t&2){let e=d.$implicit,n=c();H(n.theme),u("value",e),o(),E(p(2,4,e))}}var Qi=(()=>{class t{constructor(){this.theme="",this.filterRoles=new pt,this.filterRoleTypes=new pt,this.roles=new Te([]),this.roleTypes=new Te([]),this.rolesList=[Tn.GROUPADMIN,Tn.GROUPOBSERVER,Tn.GROUPMEMBERSHIPMANAGER],this.roleTypesList=[ho.DIRECT,ho.INDIRECT]}changeRoleTypes(){this.filterRoleTypes.emit(this.roleTypes.value)}changeRoles(){this.filterRoles.emit(this.roles.value)}static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275cmp=x({type:t,selectors:[["app-group-roles-filter"]],inputs:{theme:"theme"},outputs:{filterRoles:"filterRoles",filterRoleTypes:"filterRoleTypes"},decls:22,vars:20,consts:[[1,"me-2"],["multiple","",3,"selectionChange","formControl"],[3,"class","value"],[1,"filter-field","me-2"],[3,"value"]],template:function(n,i){n&1&&(a(0,"mat-form-field",0)(1,"mat-label"),m(2),l(3,"translate"),r(),a(4,"mat-select",1),C("selectionChange",function(){return i.changeRoles()}),a(5,"mat-select-trigger"),m(6),l(7,"selectedRoleFilterValues"),l(8,"groupRole"),r(),de(9,zr,3,6,"mat-option",2,Ce),r()(),a(11,"mat-form-field",3)(12,"mat-label"),m(13),l(14,"translate"),r(),a(15,"mat-select",1),C("selectionChange",function(){return i.changeRoleTypes()}),a(16,"mat-select-trigger"),m(17),l(18,"selectedRoleFilterValues"),l(19,"groupRoleType"),r(),de(20,qr,3,6,"mat-option",2,Ce),r()()),n&2&&(o(2),E(p(3,6,"SHARED.COMPONENTS.GROUP_ROLES_FILTER.FILTER_ROLES")),o(2),u("formControl",i.roles),o(2),h(" ",p(8,11,Me(7,8,i.roles.value,i.rolesList.length))," "),o(3),ce(i.rolesList),o(4),E(p(14,13,"SHARED.COMPONENTS.GROUP_ROLES_FILTER.FILTER_ROLE_TYPES")),o(2),u("formControl",i.roleTypes),o(2),h(" ",p(19,18,Me(18,15,i.roleTypes.value,i.roleTypesList.length))," "),o(3),ce(i.roleTypesList))},dependencies:[D,Oe,Re,Pe,Ye,$e,Pi,We,le,se,qe,L,O,Aa,Ia,Ta],styles:[".filter-field[_ngcontent-%COMP%]{max-width:250px!important;width:100%!important;min-width:initial!important}"]})}}return t})();function $r(t,d){t&1&&A(0,"perun-web-apps-loading-dialog")}function Yr(t,d){t&1&&(a(0,"mat-error"),m(1),l(2,"translate"),r()),t&2&&(o(),h(" ",p(2,1,"DIALOGS.NAME_SPACE_ERROR")," "))}function Xr(t,d){if(t&1&&(a(0,"mat-error"),m(1),l(2,"translate"),r()),t&2){let e=c(2);o(),h(" ",e.invalidNameMessage.length?e.invalidNameMessage:p(2,1,"DIALOGS.CREATE_GROUP.FILL_VALUE")," ")}}function Kr(t,d){if(t&1){let e=I();a(0,"mat-checkbox",12),te("ngModelChange",function(i){f(e);let s=c(2);return ee(s.asSubgroup,i)||(s.asSubgroup=i),g(i)}),C("click",function(){f(e);let i=c(2);return g(i.loadVoGroups())}),m(1),l(2,"translate"),r()}if(t&2){let e=c(2);J("ngModel",e.asSubgroup),u("labelPosition","before"),o(),h(" ",p(2,3,"DIALOGS.CREATE_GROUP.AS_SUBGROUP")," ")}}function Qr(t,d){if(t&1){let e=I();a(0,"perun-web-apps-group-search-select",13),C("groupSelected",function(i){f(e);let s=c(2);return g(s.selectedParent=i)}),r()}if(t&2){let e=c(2);u("disableAutoSelect",!0)("groups",e.voGroups)}}function Zr(t,d){if(t&1){let e=I();a(0,"div")(1,"h1",2),m(2),r(),a(3,"div",3)(4,"mat-form-field")(5,"mat-label"),m(6),l(7,"translate"),r(),A(8,"input",4),v(9,Yr,3,3,"mat-error"),v(10,Xr,3,3,"mat-error"),r(),a(11,"mat-form-field",5)(12,"mat-label"),m(13),l(14,"translate"),r(),a(15,"textarea",6),m(16,"        "),r()(),v(17,Kr,3,5,"mat-checkbox",7),v(18,Qr,1,2,"perun-web-apps-group-search-select",8),r(),a(19,"div",9)(20,"button",10),C("click",function(){f(e);let i=c();return g(i.onCancel())}),m(21),l(22,"translate"),r(),a(23,"button",11),C("click",function(){f(e);let i=c();return g(i.onSubmit())}),m(24),l(25,"translate"),r()()()}if(t&2){let e=c();o(2),E(e.title),o(4),E(p(7,12,"DIALOGS.CREATE_GROUP.NAME")),o(2),u("formControl",e.nameControl),o(),b(e.nameControl.errors!=null&&e.nameControl.errors.spaceName?9:-1),o(),b(e.nameControl.errors!=null&&e.nameControl.errors.spaceName?-1:10),o(3),E(p(14,14,"DIALOGS.CREATE_GROUP.DESCRIPTION")),o(2),u("formControl",e.descriptionControl),o(2),b(e.isNotSubGroup?17:-1),o(),b(e.asSubgroup?18:-1),o(3),h(" ",p(22,16,"DIALOGS.CREATE_GROUP.CANCEL")," "),o(2),u("disabled",e.nameControl.invalid||e.descriptionControl.invalid||e.asSubgroup&&e.selectedParent===null||e.loading),o(),h(" ",p(25,18,"DIALOGS.CREATE_GROUP.CREATE")," ")}}var qn=(()=>{class t{constructor(e,n,i,s,S,M){this.dialogRef=e,this.data=n,this.groupService=i,this.translate=s,this.notificator=S,this.store=M,this.asSubgroup=!1,this.invalidNameMessage=this.store.getProperty("group_name_error_message"),this.voGroups=[],this.secondaryRegex=this.store.getProperty("group_name_secondary_regex"),this.nameFunction=R=>R.name,this.isNotSubGroup=this.data.parentGroup===null,this.isNotSubGroup?s.get("DIALOGS.CREATE_GROUP.TITLE").subscribe(R=>this.title=R):s.get("DIALOGS.CREATE_GROUP.TITLE_SUB_GROUP").subscribe(R=>{this.title=R+this.data.parentGroup.name}),s.get("DIALOGS.CREATE_GROUP.SUCCESS").subscribe(R=>this.successMessage=R),s.get("DIALOGS.CREATE_GROUP.SUCCESS_SUBGROUP").subscribe(R=>this.successSubGroupMessage=R)}ngOnInit(){this.theme=this.data.theme,this.invalidNameMessage=this.invalidNameMessage&&this.secondaryRegex?this.invalidNameMessage:"",this.nameControl=new Te("",[he.required,he.pattern(this.secondaryRegex?this.secondaryRegex:""),he.pattern(".*[\\S]+.*"),pn()]),this.descriptionControl=new Te(""),this.selectedParent=null}onCancel(){this.dialogRef.close(!1)}onSubmit(){if(this.loading=!0,this.isNotSubGroup&&!this.asSubgroup)this.groupService.createGroupWithVoNameDescription(this.data.voId,this.nameControl.value,this.descriptionControl.value).subscribe({next:()=>{this.notificator.showSuccess(this.successMessage),this.loading=!1,this.dialogRef.close(!0)},error:()=>this.loading=!1});else{let e=this.asSubgroup?this.selectedParent.id:this.data.parentGroup.id;this.groupService.createGroupWithParentGroupNameDescription(e,this.nameControl.value,this.descriptionControl.value).subscribe({next:()=>{this.notificator.showSuccess(this.successSubGroupMessage),this.loading=!1,this.dialogRef.close(!0)},error:()=>this.loading=!1})}}loadVoGroups(){this.groupService.getAllGroups(this.data.voId).subscribe(e=>{this.voGroups=e.filter(n=>n.name!=="members")})}static{this.\u0275fac=function(n){return new(n||t)(_(U),_(j),_(De),_(Se),_(q),_(Le))}}static{this.\u0275cmp=x({type:t,selectors:[["app-create-group-dialog"]],decls:4,vars:5,consts:[["spinner",""],[4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],["mat-dialog-title",""],["mat-dialog-content","",1,"dialog-container"],["matInput","","data-cy","group-name","required","",3,"formControl"],[1,"mt-4"],["matInput","","data-cy","group-description",3,"formControl"],[3,"ngModel","labelPosition"],[1,"long-input",3,"disableAutoSelect","groups"],["mat-dialog-actions",""],["mat-stroked-button","",1,"ms-auto",3,"click"],["color","accent","data-cy","create-group-button-dialog","mat-flat-button","",1,"ms-2",3,"click","disabled"],[3,"ngModelChange","click","ngModel","labelPosition"],[1,"long-input",3,"groupSelected","disableAutoSelect","groups"]],template:function(n,i){if(n&1&&(T(0,$r,1,0,"ng-template",null,0,B),a(2,"div"),T(3,Zr,26,20,"div",1),r()),n&2){let s=y(1);o(2),H(W("",i.theme," position-relative")),o(),u("perunWebAppsLoader",i.loading)("perunWebAppsLoaderIndicator",s)}},dependencies:[D,P,G,Oe,Re,Pe,rt,Ke,Xe,Pt,wt,le,ze,se,It,qe,je,Ue,K,$,X,Y,oe,L,V,Wn,O],encapsulation:2})}}return t})();var $n=(()=>{class t{constructor(e,n,i,s,S){this.dialogRef=e,this.data=n,this.notificator=i,this.translate=s,this.groupService=S,this.displayedColumns=["name"],this.loading=!1,this.relations=[],this.force=!1,this.lastVoAdminGroupIds=[],this.lastFacAdminGroupIds=[]}ngOnInit(){this.loading=!0,this.theme=this.data.theme,this.dataSource=new et(this.data.groups),this.relations=["DIALOGS.DELETE_GROUP.SUBGROUP_RELATION","DIALOGS.DELETE_GROUP.MEMBER_RELATION","DIALOGS.DELETE_GROUP.RESOURCE_RELATION","DIALOGS.DELETE_GROUP.ROLE_RELATION","DIALOGS.DELETE_GROUP.OTHER_GROUP_RELATION","DIALOGS.DELETE_GROUP.ATTRIBUTE_RELATION","DIALOGS.DELETE_GROUP.SUBGROUP_OTHER_RELATION"].map(e=>this.translate.instant(e)),this.groupService.isGroupLastAdminInSomeVo(this.data.groups.map(e=>e.id)).subscribe({next:e=>{this.lastVoAdminGroupIds=e.map(n=>n.id),this.groupService.isGroupLastAdminInSomeFacility(this.data.groups.map(n=>n.id)).subscribe({next:n=>{this.lastFacAdminGroupIds=n.map(i=>i.id),this.loading=!1},error:()=>{this.loading=!1}})},error:()=>{this.loading=!1}})}onCancel(){this.dialogRef.close(!1)}onDelete(){this.loading=!0;let e=this.data.groups.map(n=>n.id);this.groupService.deleteGroups({groups:e,forceDelete:this.force}).subscribe({next:()=>{this.translate.get("DIALOGS.DELETE_GROUP.SUCCESS").subscribe({next:n=>{this.notificator.showSuccess(n),this.dialogRef.close(!0)},error:()=>this.loading=!1})},error:()=>this.loading=!1})}onSubmit(e){this.force=e.force,e.deleted?this.onDelete():this.onCancel()}static{this.\u0275fac=function(n){return new(n||t)(_(U),_(j),_(q),_(Se),_(De))}}static{this.\u0275cmp=x({type:t,selectors:[["app-delete-group-dialog"]],decls:2,vars:8,consts:[[3,"deleted","entityNames","entityType","loading","relations","lastGroupsVo","lastGroupsFac"]],template:function(n,i){n&1&&(a(0,"div")(1,"perun-web-apps-delete-entity-dialog",0),C("deleted",function(S){return i.onSubmit(S)}),r()()),n&2&&(H(i.theme),o(),u("entityNames",i.dataSource)("entityType","groups")("loading",i.loading)("relations",i.relations)("lastGroupsVo",i.lastVoAdminGroupIds)("lastGroupsFac",i.lastFacAdminGroupIds))},dependencies:[D,Un],encapsulation:2})}}return t})();var Jr=(t,d)=>d.id;function es(t,d){t&1&&A(0,"perun-web-apps-loading-dialog")}function ts(t,d){t&1&&(a(0,"mat-radio-button",6),m(1),l(2,"translate"),r()),t&2&&(o(),h(" ",p(2,1,"DIALOGS.MOVE_GROUP.NO_GROUP")," "))}function is(t,d){t&1&&(a(0,"mat-radio-button",7),m(1),l(2,"translate"),r()),t&2&&(o(),h(" ",p(2,1,"DIALOGS.MOVE_GROUP.TO_GROUP")," "))}function ns(t,d){t&1&&(a(0,"perun-web-apps-alert",8),m(1),l(2,"translate"),r()),t&2&&(o(),h(" ",p(2,1,"DIALOGS.MOVE_GROUP.CANNOT_MOVE")," "))}function os(t,d){if(t&1){let e=I();a(0,"mat-option",17),C("click",function(){let i=f(e).$implicit,s=c(3);return g(s.selectedGroup=i)}),a(1,"span"),m(2),r()()}if(t&2){let e=d.$implicit;u("value",e),o(2),E(e.name)}}function as(t,d){if(t&1){let e=I();a(0,"mat-form-field",9)(1,"mat-label"),m(2),l(3,"translate"),r(),a(4,"input",14),C("change",function(){f(e);let i=c(2);return g(i.selectedGroup=null)}),r(),a(5,"mat-autocomplete",15,1),de(7,os,3,2,"mat-option",16,Jr),l(9,"async"),r()()}if(t&2){let e=y(6),n=c(2);u("@openClose",n.moveOption==="toGroup"?"open":"closed"),o(2),E(p(3,5,"DIALOGS.MOVE_GROUP.GROUP_SELECT")),o(2),u("formControl",n.otherGroupsCtrl)("matAutocomplete",e),o(),u("displayWith",n.displayFn),o(2),ce(p(9,7,n.filteredGroups))}}function rs(t,d){if(t&1){let e=I();a(0,"div")(1,"h1",3),m(2),l(3,"translate"),r(),a(4,"div",4)(5,"p"),m(6),l(7,"translate"),r(),a(8,"mat-radio-group",5),te("ngModelChange",function(i){f(e);let s=c();return ee(s.moveOption,i)||(s.moveOption=i),g(i)}),v(9,ts,3,3,"mat-radio-button",6),v(10,is,3,3,"mat-radio-button",7),r(),v(11,ns,3,3,"perun-web-apps-alert",8),v(12,as,10,9,"mat-form-field",9),r(),a(13,"div",10)(14,"button",11),C("click",function(){f(e);let i=c();return g(i.close())}),m(15),l(16,"translate"),r(),a(17,"span",12),l(18,"translate"),a(19,"button",13),C("click",function(){f(e);let i=c();return g(i.confirm())}),m(20),l(21,"translate"),r()()()()}if(t&2){let e=c();o(2),ot("",p(3,15,"DIALOGS.MOVE_GROUP.TITLE"),"",e.data.group.name),o(4),h(" ",p(7,17,"DIALOGS.MOVE_GROUP.INFO")," "),o(2),J("ngModel",e.moveOption),o(),b(e.toRootOptionDisabled?-1:9),o(),b(e.toGroupOptionDisabled?-1:10),o(),b(e.toRootOptionDisabled&&e.toGroupOptionDisabled?11:-1),o(),b(e.toGroupOptionDisabled?-1:12),o(3),h(" ",p(16,19,"DIALOGS.MOVE_GROUP.CANCEL")," "),o(2),u("matTooltip",w(p(18,21,"DIALOGS.MOVE_GROUP.DISABLED_HINT")))("matTooltipDisabled",e.selectedGroup!==null||e.moveOption==="toRoot")("matTooltipPosition","above"),o(2),u("disabled",(e.otherGroupsCtrl.invalid||e.selectedGroup===null)&&e.moveOption!=="toRoot"||e.loading),o(),h(" ",p(21,23,"DIALOGS.MOVE_GROUP.CONFIRM")," ")}}var Xn=(()=>{class t{constructor(e,n,i,s,S,M,R){this.dialogRef=e,this.data=n,this.groupService=i,this.notificator=s,this.translate=S,this.apiRequest=M,this.authResolver=R,this.toRootOptionDisabled=!1,this.toGroupOptionDisabled=!1,this.otherGroups=[],this.otherGroupsCtrl=new hi(null,[he.required.bind(this)]),this.loading=!1,this.selectedGroup=null,this.translate.get("DIALOGS.MOVE_GROUP.SUCCESS").subscribe(N=>this.successMessage=N),this.translate.get("DIALOGS.MOVE_GROUP.ERROR").subscribe(N=>this.errorMessage=N)}ngOnInit(){this.loading=!0,this.groupService.getAllGroups(this.data.group.voId).subscribe(e=>{this.otherGroups=e.filter(n=>n.id!==this.data.group.id&&n.name!=="members"&&this.canMove(n)),this.otherGroups.length===0&&(this.toGroupOptionDisabled=!0),(this.data.group.parentGroupId===null||!this.authResolver.isAuthorized("destination_null-moveGroup_Group_Group_policy",[this.data.group]))&&(this.toRootOptionDisabled=!0,this.moveOption="toGroup"),this.filteredGroups=this.otherGroupsCtrl.valueChanges.pipe(Nt(""),Dt(n=>n?this._filterGroups(n):this.otherGroups.slice())),this.loading=!1},()=>this.loading=!1)}displayFn(e){return e&&e.name}canMove(e){return this.authResolver.isAuthorized("moveGroup_Group_Group_policy",[e,this.data.group])&&this.authResolver.isAuthorized("moveGroup_Group_Group_policy",[this.data.group,e])}close(){this.dialogRef.close()}confirm(){this.loading=!0,this.apiRequest.dontHandleErrorForNext(),this.groupService.moveGroupWithDestinationGroupMovingGroup(this.data.group.id,this.otherGroupsCtrl.value?this.otherGroupsCtrl.value.id:void 0).subscribe(()=>{this.notificator.showSuccess(this.successMessage),this.dialogRef.close(!0)},e=>{this.notificator.showRPCError(e,this.errorMessage),this.dialogRef.close(!1)})}_filterGroups(e){if(typeof e=="object")return[];let n=e.toLowerCase();return e?this.otherGroups.filter(i=>i.name.toLowerCase().includes(n)):this.otherGroups}static{this.\u0275fac=function(n){return new(n||t)(_(U),_(j),_(De),_(q),_(Se),_(xt),_(pe))}}static{this.\u0275cmp=x({type:t,selectors:[["app-move-group-dialog"]],decls:4,vars:5,consts:[["spinner",""],["groupSelectAutocomplete","matAutocomplete"],[4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],["mat-dialog-title",""],["mat-dialog-content",""],[3,"ngModelChange","ngModel"],["color","primary","value","toRoot",1,"move-options"],["color","primary","value","toGroup"],["alert_type","warn"],[1,"w-100","mt-2"],["mat-dialog-actions",""],["mat-stroked-button","",1,"ms-auto",3,"click"],[3,"matTooltipDisabled","matTooltipPosition","matTooltip"],["color","accent","mat-flat-button","",1,"ms-2",3,"click","disabled"],["matInput","","required","",3,"change","formControl","matAutocomplete"],[3,"displayWith"],[3,"value"],[3,"click","value"]],template:function(n,i){if(n&1&&(T(0,es,1,0,"ng-template",null,0,B),a(2,"div"),T(3,rs,22,25,"div",2),r()),n&2){let s=y(1);o(2),H(W("",i.data.theme," position-relative")),o(),u("perunWebAppsLoader",i.loading)("perunWebAppsLoaderIndicator",s)}},dependencies:[D,P,G,Oe,Re,Pe,Ke,Xe,ri,oi,ai,le,ze,se,It,qe,je,Ue,$a,za,We,qa,K,$,X,Y,be,ve,oe,L,ne,V,at,O],styles:[".move-options[_ngcontent-%COMP%]{display:flex;flex-direction:column;margin:15px 0}"],data:{animation:[Wa]}})}}return t})();var ss=["toggle"],ls=t=>({removeAuth:t}),ps=()=>["nameWithId","description","menu"];function ms(t,d){if(t&1){let e=I();a(0,"button",11),C("click",function(){f(e);let i=c();return g(i.onCreateGroup())}),m(1),l(2,"translate"),r()}t&2&&(o(),h(" ",p(2,1,"VO_DETAIL.GROUPS.CREATE_GROUP")," "))}function ds(t,d){if(t&1){let e=I();a(0,"span",5),l(1,"translate"),a(2,"button",12),l(3,"async"),C("click",function(){f(e);let i=c();return g(i.deleteGroup())}),m(4),l(5,"translate"),r()()}if(t&2){let e=d,n=c();u("matTooltip",w(p(1,5,"VO_DETAIL.GROUPS.DELETE_PERMISSION_HINT")))("matTooltipDisabled",e.removeAuth),o(2),u("disabled",p(3,7,n.loading$)||n.selected.selected.length===0||!e.removeAuth),o(2),h(" ",p(5,9,"VO_DETAIL.GROUPS.DELETE_GROUP")," ")}}function cs(t,d){if(t&1){let e=I();a(0,"perun-web-apps-groups-tree",14),l(1,"async"),C("moveGroup",function(i){f(e);let s=c(2);return g(s.onMoveGroup(i))})("refreshTable",function(){f(e);let i=c(2);return g(i.refresh())}),r()}if(t&2){let e=c(2);u("loading",p(1,8,e.loading$))("displayedColumns",ue(10,ps))("expandAll",e.filtering)("disableRouting",!e.routeAuth)("groups",e.groups)("selection",e.selected)("filterValue",e.filterValue)("vo",e.vo)}}function us(t,d){if(t&1&&(a(0,"div"),T(1,cs,2,11,"perun-web-apps-groups-tree",13),l(2,"async"),r()),t&2){let e=c(),n=y(22);o(),u("perunWebAppsLoader",p(2,2,e.loading$))("perunWebAppsLoaderIndicator",n)}}function _s(t,d){if(t&1){let e=I();a(0,"perun-web-apps-groups-list",16),l(1,"async"),l(2,"async"),C("groupMoved",function(i){f(e);let s=c(2);return g(s.onMoveGroup(i))})("queryChanged",function(i){f(e);let s=c(2);return g(s.nextPage.next(i))})("refreshTable",function(){f(e);let i=c(2);return g(i.refresh())})("downloadAll",function(i){f(e);let s=c(2);return g(s.downloadAll(i))}),r()}if(t&2){let e=c(2);u("loading",p(1,9,e.loading$))("disableMembers",!0)("displayColumns",e.displayedColumns)("disableRouting",!e.routeAuth)("groups",p(2,11,e.groupPage$))("selection",e.selected)("filter",e.filterValue)("cacheSubject",e.cacheSubject)("resetPagination",e.resetPagination)}}function hs(t,d){if(t&1&&(a(0,"div"),T(1,_s,3,13,"perun-web-apps-groups-list",15),l(2,"async"),r()),t&2){let e=c(),n=y(22);o(),u("perunWebAppsLoader",p(2,2,e.loading$))("perunWebAppsLoaderIndicator",n)}}function fs(t,d){t&1&&A(0,"perun-web-apps-loading-table")}var uC=(()=>{class t{static{this.id="VoGroupsComponent"}constructor(e,n,i,s,S,M,R){this.dialog=e,this.groupService=n,this.authResolver=i,this.entityStorageService=s,this.groupUtils=S,this.cacheHelperService=M,this.destroyRef=R,this.groups=[],this.nextPage=new ge({}),this.groupPage$=this.nextPage.pipe(ui(N=>this.groupService.getGroupsPage({vo:this.vo.id,attrNames:this.attrNames,query:{order:N.order,pageSize:N.pageSize,offset:N.offset,searchString:N.searchString,sortColumn:N.sortColumn,roles:this.selectedRoles,types:this.selectedRoleTypes}})),Ai(N=>{this.groups=N.data,this.setAuthRights(),this.selected.clear(),setTimeout(()=>this.loadingSubject$.next(!1),200)}),Nt({data:[],totalCount:0,offset:0,pageSize:0})),this.showGroupList=!1,this.selected=new _e(!0,[],!0,(N,re)=>N.id===re.id),this.loadingSubject$=new ge(!1),this.loading$=Wt(this.loadingSubject$,this.nextPage.pipe(Dt(()=>!0))),this.filtering=!1,this.filterValue="",this.displayedColumns=["select","id","name","description","menu"],this.selectedRoles=[],this.selectedRoleTypes=[],this.removeAuth$=this.selected.changed.pipe(Dt(N=>N.source.selected.reduce((re,xe)=>re&&this.authResolver.isAuthorized("deleteGroup_Group_boolean_policy",[this.vo,xe]),!0)),Nt(!0)),this.cacheSubject=new ge(!0),this.resetPagination=new ge(!1),this.attrNames=[k.GROUP_SYNC_ENABLED,k.GROUP_LAST_SYNC_STATE,k.GROUP_LAST_SYNC_TIMESTAMP,k.GROUP_STRUCTURE_SYNC_ENABLED,k.GROUP_LAST_STRUCTURE_SYNC_STATE,k.GROUP_LAST_STRUCTURE_SYNC_TIMESTAMP]}onCreateGroup(){let e=F();e.width="450px",e.data={voId:this.vo.id,parentGroup:null,theme:"vo-theme"},this.dialog.open(qn,e).afterClosed().subscribe(i=>{i&&this.refresh()})}ngOnInit(){this.vo=this.entityStorageService.getEntity(),this.setAuthRights(),localStorage.getItem("preferedValue")==="list"?(this.toggle.toggle(),this.showGroupList=!0):this.refresh(),this.toggle.change.subscribe(()=>{let e=this.toggle.checked?"list":"tree";localStorage.setItem("preferedValue",e),this.refresh()}),this.cacheHelperService.refreshComponentCachedData().pipe(Ne(this.destroyRef)).subscribe(e=>{e===t.id&&this.refresh()})}setAuthRights(){this.createAuth=this.authResolver.isAuthorized("createGroup_Vo_Group_policy",[this.vo]),this.groups.length!==0&&(this.routeAuth=this.authResolver.isAuthorized("getGroupById_int_policy",[this.vo,this.groups[0]]))}deleteGroup(){let e=F();e.width="450px",e.data={voId:this.vo.id,groups:this.selected.selected,theme:"vo-theme"},this.dialog.open($n,e).afterClosed().subscribe(i=>{i&&this.refresh()})}labelToggle(){this.showGroupList=!this.showGroupList,this.refresh()}removeAllGroups(){this.selected.clear()}onMoveGroup(e){let n=F();n.width="550px",n.data={group:e,theme:"vo-theme"},this.dialog.open(Xn,n).afterClosed().subscribe(s=>{s&&this.refresh()})}loadAllGroups(){this.groupService.getAllRichGroupsWithAttributesByNames(this.vo.id,this.attrNames,this.selectedRoles,this.selectedRoleTypes).subscribe(e=>{this.groups=e,this.cacheSubject.next(!0),this.selected.clear(),this.setAuthRights(),this.loadingSubject$.next(!1)})}applyFilter(e){this.filterValue=e,this.filtering=e!==""}applyRoles(e){this.selectedRoles=e,this.refresh()}applyRoleTypes(e){this.selectedRoleTypes=e,this.refresh()}refresh(){this.loadingSubject$.next(!0),this.showGroupList?(this.resetPagination.next(!0),this.cacheSubject.next(!0),this.nextPage.next(this.nextPage.value)):this.loadAllGroups()}downloadAll(e){let n=this.nextPage.getValue(),i=(s,S)=>this.groupUtils.getDataForColumn(s,S);this.groupService.getGroupsPage({vo:this.vo.id,attrNames:this.attrNames,query:{order:n.order,pageSize:e.length,offset:0,searchString:n.searchString,sortColumn:n.sortColumn,roles:this.selectedRoles,types:this.selectedRoleTypes}}).subscribe({next:s=>{Et(Ot(s.data,this.displayedColumns,i),e.format)}})}static{this.\u0275fac=function(n){return new(n||t)(_(Ae),_(De),_(pe),_(He),_(la),_(Je),_(we))}}static{this.\u0275cmp=x({type:t,selectors:[["app-vo-groups"]],viewQuery:function(n,i){if(n&1&&Be(ss,7),n&2){let s;Ve(s=Fe())&&(i.toggle=s.first)}},hostVars:2,hostBindings:function(n,i){n&2&&Ee("router-component",i.true)},decls:23,vars:20,consts:[["toggle",""],["spinner",""],[1,"page-subtitle"],[3,"refresh"],["color","accent","data-cy","create-group-button","mat-flat-button","",1,"me-2","action-button"],[3,"matTooltipDisabled","matTooltip"],[3,"filterRoles","filterRoleTypes","theme"],[3,"filter","placeholder"],[1,"slide-label",3,"click"],[1,"me-1",3,"change","ngModelChange","ngModel"],[1,"mt-3","position-relative","table-min-height"],["color","accent","data-cy","create-group-button","mat-flat-button","",1,"me-2","action-button",3,"click"],["color","warn","data-cy","delete-group-button","mat-flat-button","",1,"me-2",3,"click","disabled"],["theme","vo-theme",3,"loading","displayedColumns","expandAll","disableRouting","groups","selection","filterValue","vo","moveGroup","refreshTable",4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],["theme","vo-theme",3,"moveGroup","refreshTable","loading","displayedColumns","expandAll","disableRouting","groups","selection","filterValue","vo"],["theme","vo-theme",3,"loading","disableMembers","displayColumns","disableRouting","groups","selection","filter","cacheSubject","resetPagination","groupMoved","queryChanged","refreshTable","downloadAll",4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],["theme","vo-theme",3,"groupMoved","queryChanged","refreshTable","downloadAll","loading","disableMembers","displayColumns","disableRouting","groups","selection","filter","cacheSubject","resetPagination"]],template:function(n,i){if(n&1){let s=I();a(0,"div")(1,"h1",2),m(2),l(3,"translate"),r(),a(4,"perun-web-apps-refresh-button",3),C("refresh",function(){return f(s),g(i.refresh())}),r(),v(5,ms,3,3,"button",4),v(6,ds,6,11,"span",5),l(7,"async"),a(8,"app-group-roles-filter",6),C("filterRoles",function(M){return f(s),g(i.applyRoles(M))})("filterRoleTypes",function(M){return f(s),g(i.applyRoleTypes(M))}),r(),a(9,"perun-web-apps-debounce-filter",7),C("filter",function(M){return f(s),g(i.applyFilter(M))}),r(),a(10,"label",8),C("click",function(){return f(s),g(i.labelToggle())}),m(11),l(12,"translate"),r(),a(13,"mat-slide-toggle",9,0),C("change",function(){return f(s),g(i.removeAllGroups())}),te("ngModelChange",function(M){return f(s),ee(i.showGroupList,M)||(i.showGroupList=M),g(M)}),r(),a(15,"label",8),C("click",function(){return f(s),g(i.labelToggle())}),m(16),l(17,"translate"),r(),a(18,"div",10),v(19,us,3,4,"div"),v(20,hs,3,4,"div"),r()(),T(21,fs,1,0,"ng-template",null,1,B)}if(n&2){let s;o(2),E(p(3,10,"VO_DETAIL.GROUPS.TITLE")),o(3),b(i.createAuth?5:-1),o(),b((s=ke(18,ls,p(7,12,i.removeAuth$)))?6:-1,s),o(2),u("theme","vo-theme"),o(),u("placeholder","VO_DETAIL.GROUPS.FILTER"),o(2),h("",p(12,14,"VO_DETAIL.GROUPS.TREE_VIEW")," "),o(2),J("ngModel",i.showGroupList),o(3),h("",p(17,16,"VO_DETAIL.GROUPS.LIST_VIEW")," "),o(3),b(i.showGroupList?-1:19),o(),b(i.showGroupList?20:-1)}},dependencies:[D,P,G,ni,ii,je,se,Ue,le,ye,Ze,Qi,L,ne,Yi,Gt,V,Ge,at,O],styles:[".slide-label[_ngcontent-%COMP%]{display:inline;cursor:pointer}"],changeDetection:0})}}return t})();function gs(t,d){t&1&&A(0,"perun-web-apps-loading-dialog")}function Cs(t,d){t&1&&A(0,"th",15)}function Ss(t,d){if(t&1&&(a(0,"td",16),m(1),r()),t&2){let e=d.$implicit;o(),E(e.id)}}function vs(t,d){t&1&&A(0,"th",15)}function bs(t,d){if(t&1&&(a(0,"td",16),m(1),l(2,"userFullName"),r()),t&2){let e=d.$implicit;o(),E(p(2,1,e.user))}}function Es(t,d){t&1&&A(0,"tr",17)}function Is(t,d){t&1&&A(0,"tr",18)}function Ts(t,d){if(t&1){let e=I();a(0,"div")(1,"h1",2),m(2),l(3,"translate"),r(),a(4,"div",3)(5,"p"),m(6),l(7,"translate"),r(),a(8,"div",4),m(9),l(10,"translate"),r(),a(11,"table",5),Q(12,6),T(13,Cs,1,0,"th",7)(14,Ss,2,1,"td",8),Z(),Q(15,9),T(16,vs,1,0,"th",7)(17,bs,3,3,"td",8),Z(),T(18,Es,1,0,"tr",10)(19,Is,1,0,"tr",11),r()(),a(20,"div",12)(21,"button",13),C("click",function(){f(e);let i=c();return g(i.onCancel())}),m(22),l(23,"translate"),r(),a(24,"button",14),C("click",function(){f(e);let i=c();return g(i.onSubmit())}),m(25),l(26,"translate"),r()()()}if(t&2){let e=c();o(2),E(p(3,8,"DIALOGS.REMOVE_MEMBERS.TITLE")),o(4),h(" ",p(7,10,e.data.groupId?"DIALOGS.REMOVE_MEMBERS.DESCRIPTION_GROUP":"DIALOGS.REMOVE_MEMBERS.DESCRIPTION")," "),o(3),h(" ",p(10,12,"DIALOGS.REMOVE_MEMBERS.ASK")," "),o(2),u("dataSource",e.dataSource),o(7),u("matHeaderRowDef",e.displayedColumns),o(),u("matRowDefColumns",e.displayedColumns),o(3),h(" ",p(23,14,"DIALOGS.REMOVE_MEMBERS.CANCEL")," "),o(3),h(" ",p(26,16,e.data.groupId?"DIALOGS.REMOVE_MEMBERS.REMOVE_GROUP":"DIALOGS.REMOVE_MEMBERS.REMOVE")," ")}}var Qn=(()=>{class t{constructor(e,n,i,s,S,M){this.dialogRef=e,this.data=n,this.membersService=i,this.groupService=s,this.notificator=S,this.translate=M,this.displayedColumns=["id","name"]}ngOnInit(){this.theme=this.data.theme,this.dataSource=new et(this.data.members)}onCancel(){this.dialogRef.close(!1)}onSubmit(){this.loading=!0,this.data.groupId?this.groupService.removeMembersBodyParams({group:this.data.groupId,members:this.data.members.map(e=>e.id)}).subscribe({next:()=>this.onSuccess(),error:()=>this.onError()}):this.membersService.deleteMembersBodyParams({members:this.data.members.map(e=>e.id)}).subscribe({next:()=>this.onSuccess(),error:()=>this.onError()})}onSuccess(){let e=this.data.groupId?this.translate.instant("DIALOGS.REMOVE_MEMBERS.SUCCESS_GROUP"):this.translate.instant("DIALOGS.REMOVE_MEMBERS.SUCCESS");this.notificator.showSuccess(e),this.dialogRef.close(!0),this.loading=!1}onError(){this.loading=!1}static{this.\u0275fac=function(n){return new(n||t)(_(U),_(j),_(Qe),_(De),_(q),_(Se))}}static{this.\u0275cmp=x({type:t,selectors:[["app-remove-members-dialog"]],decls:4,vars:5,consts:[["spinner",""],[4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],["mat-dialog-title",""],["mat-dialog-content",""],[1,"fw-bold"],["mat-table","",1,"w-100",3,"dataSource"],["matColumnDef","id"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","name"],["class","font-weight-bolder","mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["mat-dialog-actions",""],["mat-stroked-button","",1,"ms-auto",3,"click"],["color","warn","data-cy","remove-members-dialog","mat-flat-button","",1,"ms-2",3,"click"],["mat-header-cell",""],["mat-cell",""],["mat-header-row","",1,"font-weight-bolder"],["mat-row",""]],template:function(n,i){if(n&1&&(T(0,gs,1,0,"ng-template",null,0,B),a(2,"div"),T(3,Ts,27,18,"div",1),r()),n&2){let s=y(1);o(2),H(W("",i.theme," position-relative")),o(),u("perunWebAppsLoader",i.loading)("perunWebAppsLoaderIndicator",s)}},dependencies:[D,P,G,K,$,X,Y,oe,vt,mt,ct,ft,ut,dt,gt,_t,ht,Ct,St,L,V,O,Xt],encapsulation:2})}}return t})();function As(t,d){t&1&&A(0,"perun-web-apps-loading-dialog")}function Ms(t,d){t&1&&(a(0,"div",4),m(1),l(2,"translate"),r()),t&2&&(o(),h(" ",p(2,1,"DIALOGS.INVITE_MEMBER.DESCRIPTION_VO")," "))}function xs(t,d){t&1&&(a(0,"div",4),m(1),l(2,"translate"),r()),t&2&&(o(),h(" ",p(2,1,"DIALOGS.INVITE_MEMBER.DESCRIPTION_GROUP")," "))}function Ds(t,d){t&1&&(a(0,"mat-error"),m(1),l(2,"translate"),r()),t&2&&(o(),h(" ",p(2,1,"DIALOGS.INVITE_MEMBER.NAME_ERROR")," "))}function Rs(t,d){t&1&&(a(0,"mat-error"),m(1),l(2,"translate"),r()),t&2&&(o(),h(" ",p(2,1,"DIALOGS.INVITE_MEMBER.EMAIL_ERROR")," "))}function Os(t,d){if(t&1&&(a(0,"mat-option",8),m(1),l(2,"uppercase"),l(3,"translate"),r()),t&2){let e=d.$implicit;u("value",w(e)),o(),E(p(3,5,p(2,3,"SHARED_LIB.LANGUAGES."+e)))}}function Ls(t,d){if(t&1){let e=I();a(0,"div")(1,"h1",2),m(2),l(3,"translate"),r(),a(4,"div",3),v(5,Ms,3,3,"div",4),v(6,xs,3,3,"div",4),a(7,"mat-form-field",5)(8,"mat-label"),m(9),l(10,"translate"),r(),A(11,"input",6),v(12,Ds,3,3,"mat-error"),r(),a(13,"mat-form-field",5)(14,"mat-label"),m(15),l(16,"translate"),r(),A(17,"textarea",6),v(18,Rs,3,3,"mat-error"),r(),a(19,"mat-form-field",5)(20,"mat-label"),m(21),l(22,"translate"),r(),a(23,"mat-select",7),te("valueChange",function(i){f(e);let s=c();return ee(s.currentLanguage,i)||(s.currentLanguage=i),g(i)}),de(24,Os,4,7,"mat-option",8,Ce),r()()(),a(26,"div",9)(27,"button",10),C("click",function(){f(e);let i=c();return g(i.onCancel())}),m(28),l(29,"translate"),r(),a(30,"button",11),C("click",function(){f(e);let i=c();return g(i.onSubmit())}),m(31),l(32,"translate"),r()()()}if(t&2){let e=c();o(2),E(p(3,14,"DIALOGS.INVITE_MEMBER.TITLE")),o(3),b(e.data.groupId?-1:5),o(),b(e.data.groupId?6:-1),o(3),E(p(10,16,"DIALOGS.INVITE_MEMBER.NAME")),o(2),u("formControl",e.name),o(),b(e.name.invalid?12:-1),o(3),E(p(16,18,"DIALOGS.INVITE_MEMBER.EMAIL")),o(2),u("formControl",e.emailForm),o(),b(e.emailForm.invalid?18:-1),o(3),E(p(22,20,"DIALOGS.INVITE_MEMBER.LANGUAGE")),o(2),J("value",e.currentLanguage),o(),ce(e.languages),o(4),h(" ",p(29,22,"DIALOGS.INVITE_MEMBER.CANCEL")," "),o(2),u("disabled",e.emailForm.invalid||e.name.invalid||e.loading),o(),h(" ",p(32,24,"DIALOGS.INVITE_MEMBER.INVITE")," ")}}var Zn=(()=>{class t{constructor(e,n,i,s,S,M){this.dialogRef=e,this.data=n,this.registrarManager=i,this.notificator=s,this.translate=S,this.store=M,this.emailForm=new Te("",[he.required,he.pattern(Kt).bind(this)]),this.languages=["en"],this.currentLanguage="en",this.name=new Te("",he.required),this.loading=!1}ngOnInit(){this.languages=this.store.getProperty("supported_languages"),this.theme=this.data.theme}onCancel(){this.dialogRef.close(!1)}onSubmit(){this.emailForm.invalid||this.name.invalid||(this.data.voId&&!this.data.groupId?(this.loading=!0,this.registrarManager.sendInvitation(this.emailForm.value,this.currentLanguage,this.data.voId,this.name.value).subscribe({next:()=>{this.translate.get("DIALOGS.INVITE_MEMBER.SUCCESS").subscribe(e=>{this.notificator.showSuccess(e),this.dialogRef.close(!0)})},error:()=>this.loading=!1})):(this.loading=!0,this.registrarManager.sendInvitationForGroup(this.emailForm.value,this.currentLanguage,this.data.voId,this.data.groupId,this.name.value).subscribe({next:()=>{this.translate.get("DIALOGS.INVITE_MEMBER.SUCCESS").subscribe(e=>{this.notificator.showSuccess(e),this.dialogRef.close(!0)})},error:()=>this.loading=!1})))}static{this.\u0275fac=function(n){return new(n||t)(_(U),_(j),_(tt),_(q),_(Se),_(Le))}}static{this.\u0275cmp=x({type:t,selectors:[["app-invite-member-dialog"]],decls:4,vars:5,consts:[["spinner",""],[4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],["mat-dialog-title",""],["mat-dialog-content",""],[1,"font-italic"],[1,"w-100"],["matInput","","required","",3,"formControl"],[3,"valueChange","value"],[3,"value"],["mat-dialog-actions",""],["mat-stroked-button","",1,"ms-auto",3,"click"],["color","accent","mat-flat-button","",1,"ms-2",3,"click","disabled"]],template:function(n,i){if(n&1&&(T(0,As,1,0,"ng-template",null,0,B),a(2,"div"),T(3,Ls,33,26,"div",1),r()),n&2){let s=y(1);o(2),H(W("",i.theme," position-relative")),o(),u("perunWebAppsLoader",i.loading)("perunWebAppsLoaderIndicator",s)}},dependencies:[D,P,G,Oe,Re,Pe,rt,Ke,Xe,Ye,$e,We,le,ze,se,It,qe,K,$,X,Y,oe,L,V,At,O],encapsulation:2})}}return t})();var Zi=(()=>{class t{constructor(e,n){this.notificator=e,this.translate=n}setDialogRef(e){this.dialogRef=e}setType(e){this.entityType=e}getType(){return this.entityType}createCandidate(e){return{userExtSource:e.userExtSource,additionalUserExtSources:e.additionalUserExtSources,attributes:e.attributes,firstName:e.firstName,lastName:e.lastName,middleName:e.middleName,titleBefore:e.titleBefore,titleAfter:e.titleAfter,id:e.id}}getFormattedGroup(e){return{id:e.id,beanName:e.beanName,name:e.name,voId:e.voId}}success(e){this.notificator.showSuccess(this.translate.instant(e)),this.dialogRef.close(!0)}getCandidateWithError(e,n){if(String(n.type)==="MfaPrivilegeException")return null;{let i=n.message.split(":").splice(1).join();return{candidate:e,errorName:n.name,errorMsg:i}}}convertToMemberCandidates(e){return e.map(n=>({member:n.member,candidate:n.candidate,richUser:n.richUser}))}static{this.\u0275fac=function(n){return new(n||t)(_o(q),_o(Se))}}static{this.\u0275prov=To({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();var cn=(()=>{class t{transform(e){return e?.member?.sourceGroupId&&e?.member?.membershipType==="DIRECT"?"Member of Group":e?.member?.sourceGroupId&&e?.member?.membershipType==="INDIRECT"?"Indirect member of Group":e.member?"Member of VO":""}static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275pipe=ei({name:"memberType",type:t,pure:!0})}}return t})();var un=(()=>{class t{constructor(e){this.addMemberService=e}transform(e,n){return e.member?this.addMemberService.getType()==="vo"?!0:e.member?.sourceGroupId&&e.member?.membershipType==="DIRECT":n}static{this.\u0275fac=function(n){return new(n||t)(_(Zi,16))}}static{this.\u0275pipe=ei({name:"disabledCandidate",type:t,pure:!0})}}return t})();var Ps=t=>({all:t}),Gs=t=>({name:t});function Ns(t,d){if(t&1){let e=I();a(0,"th",18)(1,"span",19),l(2,"translate"),a(3,"mat-checkbox",20),l(4,"masterCheckboxLabel"),l(5,"translate"),C("change",function(i){f(e);let s=c(2);return g(i?s.masterToggle():null)}),r()()()}if(t&2){let e=c(),n=c();o(),u("matTooltipDisabled",n.isMasterCheckboxEnabled)("matTooltip",p(2,6,"MEMBERS_CANDIDATES_LIST.MASTER_CHECKBOX_TOOLTIP")),o(2),pi("aria-label",p(5,10,p(4,8,e.all))),u("checked",n.selection.hasValue()&&e.all)("indeterminate",n.selection.hasValue()&&!e.all)("disabled",!n.isMasterCheckboxEnabled)}}function Bs(t,d){if(t&1){let e=I();a(0,"td",21)(1,"div",22),l(2,"disabledCandidateTooltip"),l(3,"translate"),l(4,"disabledCandidate"),a(5,"mat-checkbox",23),l(6,"translate"),l(7,"lowercase"),l(8,"checkboxLabel"),l(9,"userFullName"),l(10,"translate"),l(11,"disabledCandidate"),C("change",function(i){let s=f(e).$implicit,S=c(2);return g(i?S.itemSelectionToggle(s):null)})("click",function(i){return f(e),g(i.stopPropagation())}),r()()()}if(t&2){let e=d.$implicit,n=c(2);o(),u("matTooltip",p(3,9,p(2,7,e)))("matTooltipDisabled",!Me(4,11,e,n.blockManualAdding)),o(4),Rt("data-cy",W("",p(7,16,p(6,14,e.richUser?e.richUser.firstName:e.candidate.firstName)),"-checkbox")),pi("aria-label",Me(10,22,p(8,18,n.selection.isSelected(e)),ke(28,Gs,p(9,20,e.richUser??e.candidate)))),u("checked",n.selection.isSelected(e))("disabled",Me(11,25,e,n.blockManualAdding))}}function Vs(t,d){t&1&&(Q(0,3),T(1,Ns,6,12,"th",16)(2,Bs,12,30,"td",17),Z())}function Fs(t,d){t&1&&(a(0,"th",24),m(1),l(2,"translate"),r()),t&2&&(o(),h(" ",p(2,1,"MEMBERS_CANDIDATES_LIST.STATUS")," "))}function ks(t,d){if(t&1&&(a(0,"i",27),l(1,"memberStatusIconColor"),m(2),l(3,"memberStatusIcon"),r()),t&2){let e=c().$implicit;H(W("material-icons ",p(1,6,e.member))),u("matTooltip",w(e.member.status)),o(2),h(" ",p(3,8,e.member.status)," ")}}function Us(t,d){if(t&1&&(a(0,"td",25),v(1,ks,4,10,"i",26),r()),t&2){let e=d.$implicit;o(),b(e.member?1:-1)}}function js(t,d){t&1&&(a(0,"th",24),m(1),l(2,"translate"),r()),t&2&&(o(),h(" ",p(2,1,"MEMBERS_CANDIDATES_LIST.NAME")," "))}function Ws(t,d){if(t&1&&(a(0,"td",25),m(1),l(2,"userFullName"),l(3,"userFullName"),r()),t&2){let e=d.$implicit;o(),h(" ",e.richUser?p(2,1,e.richUser):p(3,3,e.candidate)," ")}}function Hs(t,d){t&1&&(a(0,"th",24),m(1),l(2,"translate"),r()),t&2&&(o(),h(" ",p(2,1,"MEMBERS_CANDIDATES_LIST.ORGANIZATION")," "))}function zs(t,d){if(t&1&&(a(0,"td",25),m(1),l(2,"userVo"),r()),t&2){let e=d.$implicit,n=c();o(),h(" ",e.richUser?p(2,1,e.richUser):n.getOrganization(e.candidate)," ")}}function qs(t,d){t&1&&(a(0,"th",24),m(1),l(2,"translate"),r()),t&2&&(o(),h(" ",p(2,1,"MEMBERS_CANDIDATES_LIST.EMAIL")," "))}function $s(t,d){if(t&1&&(a(0,"td",25),m(1),r()),t&2){let e=d.$implicit,n=c();o(),h(" ",n.getEmail(e)," ")}}function Ys(t,d){t&1&&(a(0,"th",24),m(1),l(2,"translate"),r()),t&2&&(o(),h(" ",p(2,1,"MEMBERS_CANDIDATES_LIST.LOGINS")," "))}function Xs(t,d){if(t&1&&(a(0,"td",25),m(1),r()),t&2){let e=d.$implicit,n=c();o(),h(" ",n.getLogins(e)," ")}}function Ks(t,d){t&1&&(a(0,"th",24),m(1),l(2,"translate"),r()),t&2&&(o(),h(" ",p(2,1,"MEMBERS_CANDIDATES_LIST.ALREADY_MEMBER")," "))}function Qs(t,d){if(t&1&&(a(0,"td",25),m(1),l(2,"memberType"),r()),t&2){let e=d.$implicit;o(),h(" ",p(2,1,e)," ")}}function Zs(t,d){t&1&&A(0,"th",24)}function Js(t,d){if(t&1&&(a(0,"td",25),m(1),r()),t&2){let e=d.$implicit;o(),h(" ",e.richUser?"Local":"External identity"," ")}}function el(t,d){t&1&&A(0,"tr",28)}function tl(t,d){t&1&&A(0,"tr",29)}function il(t,d){t&1&&(a(0,"perun-web-apps-alert",15),m(1),l(2,"translate"),r()),t&2&&(o(),h(" ",p(2,1,"DIALOGS.ADD_MEMBERS.NO_USERS_FOUND")," "))}var or=(()=>{class t{constructor(e,n,i,s){this.memberTypePipe=e,this.disabledCandidatePipe=n,this.tableCheckbox=i,this.destroyRef=s,this.blockManualAdding=!1,this.displayedColumns=["checkbox","status","fullName","voExtSource","email","logins","alreadyMember","local"],this.dataSource=new et([]),this.pageSizeOptions=Fi,this.firstSearchDone=!1,this.isMasterCheckboxEnabled=!0,this.tableId="app-members-candidates-list",this.canBeSelected=S=>!this.disabledCandidatePipe.transform(S,this.blockManualAdding),this.getDataForColumnFun=(S,M)=>this.getDataForColumn(S,M),this.getExportDataForColumnFun=(S,M)=>this.getExportDataForColumn(S,M)}set matSort(e){this.sort=e,this.setDataSource()}ngOnInit(){this.selection&&(this.cachedSelection=new _e(this.selection.isMultipleSelection(),[],!0,this.selection.compareWith),this.cachedSubject?.pipe(Ne(this.destroyRef)).subscribe(e=>{e&&this.cachedSelection.clear()}))}ngAfterViewInit(){this.dataSource.paginator=this.child.paginator}ngOnChanges(){this.members!==void 0&&this.members!==null&&(this.firstSearchDone=!0,this.dataSource=new et(this.members),this.setDataSource()),this.dataSource.paginator&&(this.isMasterCheckboxEnabled=this.tableCheckbox.anySelectableRows(this.dataSource,this.canBeSelected))}getDataForColumn(e,n){switch(n){case"status":return e.member?e.member.status??"":"";case"fullName":{let i=e.richUser?e.richUser:e.candidate;return i.lastName?i.lastName:i.firstName??""}case"voExtSource":return e.richUser?Co(e.richUser):yn(e.candidate);case"email":return e.richUser||e.member?go(e.richUser):this.getEmail(e);case"logins":return this.getLogins(e);case"alreadyMember":return this.memberTypePipe.transform(e);case"local":return e.richUser?"Local":"External identity";default:return e[n]}}getExportDataForColumn(e,n){switch(n){case"status":return e.member?e.member.status??"":"";case"fullName":{let i=e.richUser?e.richUser:e.candidate;return rn(i)}case"voExtSource":return e.richUser?Co(e.richUser):yn(e.candidate);case"email":return e.richUser||e.member?go(e.richUser):this.getEmail(e);case"logins":return this.getLogins(e);case"alreadyMember":return this.memberTypePipe.transform(e);case"local":return e.richUser?"Local":"External identity";default:return e[n]}}exportAllData(e){Et(Ot(this.dataSource.filteredData,this.displayedColumns,this.getExportDataForColumnFun),e)}exportDisplayedData(e){let n=this.dataSource.paginator.pageIndex*this.dataSource.paginator.pageSize,i=n+this.dataSource.paginator.pageSize;Et(Ot(this.dataSource.sortData(this.dataSource.filteredData,this.dataSource.sort).slice(n,i),this.displayedColumns,this.getExportDataForColumnFun),e)}setDataSource(){this.dataSource&&(this.dataSource.sort=this.sort,this.dataSource.filterPredicate=(e,n)=>Pn(e,n,this.displayedColumns,this.getDataForColumnFun),this.dataSource.sortData=(e,n)=>ki(e,n,this.getDataForColumnFun),this.dataSource.paginator=this.child.paginator)}getEmail(e){let n;if(e.richUser){for(let i of e.richUser.userAttributes)if(i.namespace+":"+i.friendlyName=="urn:perun:user:attribute-def:def:preferredMail"){n=i;break}return n?.value!=null?n.value.replace(","," "):""}else return ea(e.candidate)}getOrganization(e){return yn(e)}getLogins(e){if(e.richUser)return this.getLoginsForRichUser(e.richUser);{let n=this.getLoginsForCandidate(e.candidate);return(n==null||n==="")&&(n=e.candidate.userExtSource.login),n}}getLoginsForRichUser(e){let n="";for(let i of e.userAttributes)if(i.friendlyName.startsWith("login-namespace")&&i.value!=null){n.length>0&&(n+=", ");let s=i.friendlyName.substring(16);n+=s+": "+i.value}return n}getLoginsForCandidate(e){let i="";for(let s in e.attributes)if(Object.prototype.hasOwnProperty.call(e.attributes,s)&&s.includes("urn:perun:user:attribute-def:def:login-namespace:")&&e.attributes[s]!=null){i.length>0&&(i+=", ");let S=s.substring(49);i+=S+": "+e.attributes[s]}return i}itemSelectionToggle(e){this.selection.toggle(e),this.cachedSelection.toggle(e)}isAllSelected(){return this.tableCheckbox.isAllSelected(this.selection.selected.length,this.dataSource,this.canBeSelected)}masterToggle(){this.tableCheckbox.masterToggle(this.isAllSelected(),this.selection,this.cachedSelection,"",this.dataSource,this.sort,this.child.paginator.pageSize,this.child.paginator.pageIndex,!0,this.canBeSelected)}pageChanged(){this.cachedSelection&&this.dataSource.paginator&&(this.isMasterCheckboxEnabled=this.tableCheckbox.anySelectableRows(this.dataSource,this.canBeSelected),this.tableCheckbox.selectCachedDataOnPage(this.dataSource,this.selection,this.cachedSelection,this.selection.compareWith))}static{this.\u0275fac=function(n){return new(n||t)(_(cn),_(un),_(Wi),_(we))}}static{this.\u0275cmp=x({type:t,selectors:[["app-members-candidates-list"]],viewQuery:function(n,i){if(n&1&&(Be(mi,7),Be(Ht,7)),n&2){let s;Ve(s=Fe())&&(i.child=s.first),Ve(s=Fe())&&(i.matSort=s.first)}},inputs:{members:"members",selection:"selection",cachedSubject:"cachedSubject",blockManualAdding:"blockManualAdding",loading:"loading"},features:[fn([cn,un]),Jt],decls:29,vars:15,consts:[[1,"card","mt-2",3,"hidden"],[3,"exportDisplayedData","exportAllData","pageChanged","tableId","dataLength","pageSizeOptions"],["mat-table","","matSort","","matSortActive","fullName","matSortDirection","asc","matSortDisableClear","",1,"w-100",3,"matSortChange","dataSource"],["matColumnDef","checkbox"],["matColumnDef","status"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","fullName"],["matColumnDef","voExtSource"],["matColumnDef","email"],["matColumnDef","logins"],["matColumnDef","alreadyMember"],["matColumnDef","local"],["mat-header-row","",4,"matHeaderRowDef"],["class","dark-hover-list-item","mat-row","",4,"matRowDef","matRowDefColumns"],["alert_type","warn"],["mat-header-cell","","class","align-checkbox",4,"matHeaderCellDef"],["class","static-column-size align-checkbox","mat-cell","",4,"matCellDef"],["mat-header-cell","",1,"align-checkbox"],[3,"matTooltipDisabled","matTooltip"],["color","primary",3,"change","aria-label","checked","indeterminate","disabled"],["mat-cell","",1,"static-column-size","align-checkbox"],["matTooltipPosition","above",3,"matTooltip","matTooltipDisabled"],["color","primary",3,"change","click","aria-label","checked","disabled"],["mat-header-cell","","mat-sort-header",""],["mat-cell",""],["matTooltipPosition","above",3,"class","matTooltip"],["matTooltipPosition","above",3,"matTooltip"],["mat-header-row",""],["mat-row","",1,"dark-hover-list-item"]],template:function(n,i){if(n&1&&(a(0,"div",0)(1,"perun-web-apps-table-wrapper",1),C("exportDisplayedData",function(S){return i.exportDisplayedData(S)})("exportAllData",function(S){return i.exportAllData(S)})("pageChanged",function(){return i.pageChanged()}),a(2,"table",2),C("matSortChange",function(){return i.pageChanged()}),v(3,Vs,3,0,"ng-container",3),l(4,"isAllSelected"),Q(5,4),T(6,Fs,3,3,"th",5)(7,Us,2,1,"td",6),Z(),Q(8,7),T(9,js,3,3,"th",5)(10,Ws,4,5,"td",6),Z(),Q(11,8),T(12,Hs,3,3,"th",5)(13,zs,3,3,"td",6),Z(),Q(14,9),T(15,qs,3,3,"th",5)(16,$s,2,1,"td",6),Z(),Q(17,10),T(18,Ys,3,3,"th",5)(19,Xs,2,1,"td",6),Z(),Q(20,11),T(21,Ks,3,3,"th",5)(22,Qs,3,3,"td",6),Z(),Q(23,12),T(24,Zs,1,0,"th",5)(25,Js,2,1,"td",6),Z(),T(26,el,1,0,"tr",13)(27,tl,1,0,"tr",14),r()()(),v(28,il,3,3,"perun-web-apps-alert",15)),n&2){let s;u("hidden",i.dataSource.data.length===0),o(),u("tableId",i.tableId)("dataLength",i.dataSource.filteredData.length)("pageSizeOptions",i.pageSizeOptions),o(),u("dataSource",i.dataSource),o(),b((s=ke(13,Ps,nn(4,9,i.dataSource,i.selection.selected.length,i.canBeSelected)))?3:-1,s),o(23),u("matHeaderRowDef",i.displayedColumns),o(),u("matRowDefColumns",i.displayedColumns),o(),b(!i.loading&&i.dataSource.data.length===0&&i.members!==void 0?28:-1)}},dependencies:[D,Pt,wt,be,ve,mi,vt,mt,ct,ft,ut,dt,gt,_t,ht,Ct,St,yi,Ht,Li,L,ne,wo,Hi,ca,O,zi,da,Xt,va,qi,un,ha,cn],encapsulation:2})}}return t})();var ar=()=>["userName","error"];function nl(t,d){t&1&&A(0,"perun-web-apps-loading-dialog")}function ol(t,d){t&1&&A(0,"perun-web-apps-loading-table")}function al(t,d){if(t&1&&A(0,"app-members-candidates-list",16),t&2){let e=c(3);u("loading",e.members===null)("members",e.members)("selection",e.selection)("cachedSubject",e.cachedSubject)("blockManualAdding",e.manualAddingBlocked)}}function rl(t,d){if(t&1&&(a(0,"button",12),m(1),l(2,"translate"),r()),t&2){c();let e=y(17),n=c(2);u("disabled",n.selection.selected.length===0||!n.inviteAuth||!n.showInvite)("matMenuTriggerFor",e),o(),h(" ",p(2,3,"DIALOGS.ADD_MEMBERS.INVITE")," ")}}function sl(t,d){if(t&1){let e=I();a(0,"button",17),C("click",function(){let i=f(e).$implicit,s=c(3);return g(s.invite.emit(i))}),m(1),l(2,"translate"),l(3,"uppercase"),l(4,"translate"),l(5,"translate"),r()}if(t&2){let e=d.$implicit;o(),Mo(" ",p(2,3,"DIALOGS.ADD_MEMBERS.INVITE_IN_LANGUAGE")," ",p(4,7,p(3,5,"SHARED_LIB.LANGUAGES."+e))," ",p(5,9,"DIALOGS.ADD_MEMBERS.LANGUAGE")," ")}}function ll(t,d){if(t&1){let e=I();a(0,"div")(1,"div",5)(2,"perun-web-apps-debounce-filter",6),l(3,"translate"),l(4,"translate"),C("filter",function(i){f(e);let s=c(2);return g(s.applyFilter(i))}),r(),T(5,ol,1,0,"ng-template",null,1,B),a(7,"div",7),T(8,al,1,5,"app-members-candidates-list",8),r()(),a(9,"div",9)(10,"button",10),C("click",function(){f(e);let i=c(2);return g(i.cancelled.emit(!1))}),m(11),l(12,"translate"),r(),a(13,"span",11),l(14,"translate"),v(15,rl,3,5,"button",12),a(16,"mat-menu",null,2),de(18,sl,6,11,"button",13,Ce),r()(),a(20,"span",14),l(21,"translate"),a(22,"button",15),C("click",function(){f(e);let i=c(2);return g(i.add.emit())}),m(23),l(24,"translate"),r()()()()}if(t&2){let e=y(6),n=c(2);o(2),u("error",w(p(3,19,"DIALOGS.ADD_MEMBERS.EMPTY_SEARCH_MESSAGE")))("placeholder",w(p(4,21,"DIALOGS.ADD_MEMBERS.DESCRIPTION")))("autoFocus",!0)("control",n.searchCtrl),o(6),u("perunWebAppsLoader",n.members===null)("perunWebAppsLoaderIndicator",e),o(3),h(" ",p(12,23,"DIALOGS.ADD_MEMBERS.CANCEL")," "),o(2),u("matTooltip",w(p(14,25,n.showInvite?"DIALOGS.ADD_MEMBERS.ADD_MEMBER_PERMISSION_TOOLTIP":"DIALOGS.ADD_MEMBERS.INVITE_MEMBER_DISABLED")))("matTooltipPosition","below")("matTooltipDisabled",n.selection.selected.length<=0||n.showInvite&&n.inviteAuth),o(2),b(n.inviteAuth?15:-1),o(3),ce(n.languages),o(2),u("matTooltip",w(p(21,27,"DIALOGS.ADD_MEMBERS.ADD_MEMBER_PERMISSION_TOOLTIP")))("matTooltipDisabled",n.selection.selected.length===0||n.addAuth),o(2),u("disabled",n.selection.selected.length===0||!n.addAuth),o(),h(" ",p(24,29,"DIALOGS.ADD_MEMBERS.CREATE")," ")}}function pl(t,d){t&1&&(a(0,"th",26),m(1),l(2,"translate"),r()),t&2&&(o(),h(" ",p(2,1,"DIALOGS.ADD_MEMBERS.NAME_COLUMN")," "))}function ml(t,d){if(t&1&&(a(0,"td",27),m(1),l(2,"userFullName"),r()),t&2){let e=d.$implicit;o(),h(" ",p(2,1,e.candidate.candidate??e.candidate.richUser)," ")}}function dl(t,d){t&1&&(a(0,"th",26),m(1),l(2,"translate"),r()),t&2&&(o(),h(" ",p(2,1,"DIALOGS.ADD_MEMBERS.ERROR_COLUMN")," "))}function cl(t,d){if(t&1&&(a(0,"td",27),m(1),a(2,"div",28),m(3),r()()),t&2){let e=d.$implicit;o(),h(" ",e.errorMsg," "),o(2),h(" ",e.errorName," ")}}function ul(t,d){t&1&&A(0,"tr",29)}function _l(t,d){t&1&&A(0,"tr",30)}function hl(t,d){if(t&1){let e=I();a(0,"div",9)(1,"button",10),C("click",function(){f(e);let i=c(3);return g(i.cancelled.emit(!0))}),m(2),l(3,"translate"),r()()}t&2&&(o(2),h(" ",p(3,1,"DIALOGS.ADD_MEMBERS.CLOSE")," "))}function fl(t,d){if(t&1&&(a(0,"div")(1,"div",5)(2,"perun-web-apps-alert",18),m(3),l(4,"translate"),r(),a(5,"table",19),Q(6,20),T(7,pl,3,3,"th",21)(8,ml,3,3,"td",22),Z(),Q(9,23),T(10,dl,3,3,"th",21)(11,cl,4,2,"td",22),Z(),T(12,ul,1,0,"tr",24)(13,_l,1,0,"tr",25),r()(),v(14,hl,4,3,"div",9),r()),t&2){let e=c(2);o(2),u("alert_type","error"),o(),E(p(4,6,"DIALOGS.ADD_MEMBERS.FAILED_DESC")),o(2),u("dataSource",e.failedCandidateDataSource),o(7),u("matHeaderRowDef",ue(8,ar)),o(),u("matRowDefColumns",ue(9,ar)),o(),b(e.loading?-1:14)}}function gl(t,d){if(t&1&&(a(0,"div")(1,"h1",4),m(2),l(3,"translate"),r(),v(4,ll,25,31,"div"),v(5,fl,15,10,"div"),r()),t&2){let e=c();o(2),E(p(3,3,"DIALOGS.ADD_MEMBERS.TITLE")),o(2),b(e.failed.length===0?4:-1),o(),b(e.failed.length!==0?5:-1)}}var Jn=(()=>{class t{constructor(){this.loading=!1,this.manualAddingBlocked=!1,this.inviteAuth=!0,this.addAuth=!0,this.showInvite=!1,this.members=[],this.selection=new _e(!0,[],!0,(e,n)=>e.richUser?.id===n.richUser?.id),this.cachedSubject=new ge(!0),this.add=new pt,this.cancelled=new pt,this.search=new pt,this.invite=new pt,this.searchCtrl=new hi("",[he.required,he.pattern(".*[\\S]+.*")])}ngOnInit(){this.failedCandidateDataSource=new et(this.failed)}applyFilter(e){this.search.emit(e),this.selection.clear(),this.cachedSubject.next(!0)}static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275cmp=x({type:t,selectors:[["app-add-member-dialog"]],inputs:{loading:"loading",theme:"theme",languages:"languages",manualAddingBlocked:"manualAddingBlocked",inviteAuth:"inviteAuth",addAuth:"addAuth",showInvite:"showInvite",members:"members",failed:"failed",selection:"selection",cachedSubject:"cachedSubject"},outputs:{add:"add",cancelled:"cancelled",search:"search",invite:"invite"},decls:4,vars:5,consts:[["spinner1",""],["searchSpinner",""],["menu","matMenu"],[4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],["mat-dialog-title",""],["mat-dialog-content",""],["data-cy","search-members",3,"filter","error","placeholder","autoFocus","control"],[1,"position-relative","mt-3","table-min-height"],[3,"loading","members","selection","cachedSubject","blockManualAdding",4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],["mat-dialog-actions",""],["mat-stroked-button","",1,"ms-auto",3,"click"],[3,"matTooltip","matTooltipPosition","matTooltipDisabled"],["color","accent","mat-flat-button","",1,"ms-2","dropdown-toggle",3,"disabled","matMenuTriggerFor"],["mat-menu-item",""],["matTooltipPosition","above",3,"matTooltip","matTooltipDisabled"],["mat-flat-button","","color","accent","data-cy","add-button",1,"ms-2",3,"click","disabled"],[3,"loading","members","selection","cachedSubject","blockManualAdding"],["mat-menu-item","",3,"click"],[1,"mb-2",3,"alert_type"],["mat-table","",1,"w-100",3,"dataSource"],["matColumnDef","userName"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","error"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["mat-header-cell",""],["mat-cell",""],[1,"text-muted"],["mat-header-row",""],["mat-row",""]],template:function(n,i){if(n&1&&(T(0,nl,1,0,"ng-template",null,0,B),a(2,"div"),T(3,gl,6,5,"div",3),r()),n&2){let s=y(1);o(2),H(W("",i.theme," position-relative")),o(),u("perunWebAppsLoader",i.members&&i.loading)("perunWebAppsLoaderIndicator",s)}},dependencies:[D,P,G,K,$,X,Y,be,ve,oe,ye,Yt,qt,zt,$t,vt,mt,ct,ft,ut,dt,gt,_t,ht,Ct,St,L,ne,V,or,Ge,At,O,Xt],styles:[".adjust-width[_ngcontent-%COMP%]{width:270px}.error-row[_ngcontent-%COMP%]{display:flex;flex-direction:row;flex-wrap:wrap;width:100%;padding:1em 0}.error-column[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:center;align-items:flex-start;width:50%}.divider[_ngcontent-%COMP%]{border-bottom:1px solid rgba(0,0,0,.12)}"]})}}return t})();var rr=(()=>{class t{constructor(e,n,i,s,S,M,R,N,re){this.data=e,this.dialogRef=n,this.membersManagerService=i,this.voService=s,this.registrarManager=S,this.store=M,this.requestService=R,this.addMemberService=N,this.notificator=re,this.loading=!1,this.showInvite=!1,this.searcher=new ci,this.members=this.searcher.pipe(ui(xe=>Wt(Zt(null),this.voService.getCompleteCandidatesForVo(this.data.voId,this.attrNames,xe))),Nt(void 0)),this.failed=[],this.selection=new _e(!0,[],!0,(xe,Bt)=>xe.richUser?.id===Bt.richUser?.id&&xe.member?.id===Bt.member?.id),this.cachedSubject=new ge(!0),this.attrNames=[k.USER_DEF_ORGANIZATION,k.USER_DEF_PREFERRED_MAIL].concat(this.store.getLoginAttributeNames()),this.languages=this.store.getProperty("supported_languages"),this.addMemberService.setDialogRef(this.dialogRef),this.addMemberService.setType("vo")}ngOnInit(){this.registrarManager.invitationFormExists(this.data.voId).subscribe(e=>{this.showInvite=e})}add(){this.loading=!0,this.membersManagerService.addMemberCandidates({candidates:this.addMemberService.convertToMemberCandidates(this.selection.selected),vo:this.data.voId}).subscribe({next:()=>{this.addMemberService.success("DIALOGS.ADD_MEMBERS.SUCCESS_ADD")},error:e=>{this.loading=!1,this.notificator.showRPCError(e)}})}invite(e){this.loading=!0,this.registrarManager.inviteMemberCandidates({candidates:this.addMemberService.convertToMemberCandidates(this.selection.selected),vo:this.data.voId,lang:e}).subscribe({next:()=>{this.addMemberService.success("DIALOGS.ADD_MEMBERS.SUCCESS_INVITE")},error:n=>{this.loading=!1,this.notificator.showRPCError(n)}})}cancel(e){this.dialogRef.close(e)}static{this.\u0275fac=function(n){return new(n||t)(_(j),_(U),_(Qe),_(Vt),_(tt),_(Le),_(xt),_(Zi),_(q))}}static{this.\u0275cmp=x({type:t,selectors:[["app-vo-add-member-dialog"]],decls:2,vars:10,consts:[[3,"add","cancelled","invite","search","loading","showInvite","languages","failed","members","selection","cachedSubject","theme"]],template:function(n,i){n&1&&(a(0,"app-add-member-dialog",0),l(1,"async"),C("add",function(){return i.add()})("cancelled",function(S){return i.cancel(S)})("invite",function(S){return i.invite(S)})("search",function(S){return i.searcher.next(S)}),r()),n&2&&u("loading",i.loading)("showInvite",i.showInvite)("languages",i.languages)("failed",i.failed)("members",p(1,8,i.members))("selection",i.selection)("cachedSubject",i.cachedSubject)("theme","vo-theme")},dependencies:[D,Jn,at],encapsulation:2})}}return t})();function Cl(t,d){t&1&&A(0,"perun-web-apps-loading-dialog")}function Sl(t,d){t&1&&(a(0,"div",7),m(1),l(2,"translate"),r()),t&2&&(o(),h(" ",p(2,1,"DIALOGS.BULK_INVITE_MEMBERS.DESCRIPTION_VO")," "))}function vl(t,d){t&1&&(a(0,"div",7),m(1),l(2,"translate"),r()),t&2&&(o(),h(" ",p(2,1,"DIALOGS.BULK_INVITE_MEMBERS.DESCRIPTION_GROUP")," "))}function bl(t,d){if(t&1&&(a(0,"mat-option",10),m(1),l(2,"uppercase"),l(3,"translate"),r()),t&2){let e=d.$implicit;u("value",w(e)),o(),h(" ",p(3,5,p(2,3,"SHARED_LIB.LANGUAGES."+e))," ")}}function El(t,d){t&1&&(a(0,"mat-error"),m(1),l(2,"translate"),r()),t&2&&(o(),h(" ",p(2,1,"DIALOGS.BULK_INVITE_MEMBERS.NAMES_ERROR")," "))}function Il(t,d){if(t&1&&(a(0,"mat-error"),m(1),l(2,"translate"),r()),t&2){let e=c(3);o(),ot(" ",p(2,2,"DIALOGS.BULK_INVITE_MEMBERS.ERROR_FORMAT"),": ",e.invitedMembers.getError("invalidFormat").value," ")}}function Tl(t,d){if(t&1&&(a(0,"mat-error"),m(1),l(2,"translate"),r()),t&2){let e=c(3);o(),ot(" ",p(2,2,"DIALOGS.BULK_INVITE_MEMBERS.ERROR_EMAIL"),": ",e.invitedMembers.getError("invalidEmail").value," ")}}function Al(t,d){if(t&1){let e=I();a(0,"div"),v(1,Sl,3,3,"div",7),v(2,vl,3,3,"div",7),a(3,"mat-form-field",8)(4,"mat-label"),m(5),l(6,"translate"),r(),a(7,"mat-select",9),te("valueChange",function(i){f(e);let s=c(2);return ee(s.currentLanguage,i)||(s.currentLanguage=i),g(i)}),de(8,bl,4,7,"mat-option",10,Ce),r()(),A(10,"p",11),l(11,"translate"),a(12,"mat-form-field",12)(13,"mat-label"),m(14),l(15,"translate"),r(),a(16,"textarea",13),l(17,"translate"),m(18,"            "),r(),v(19,El,3,3,"mat-error"),v(20,Il,3,4,"mat-error"),v(21,Tl,3,4,"mat-error"),r()()}if(t&2){let e=c(2);o(),b(e.data.groupId?-1:1),o(),b(e.data.groupId?2:-1),o(3),E(p(6,12,"DIALOGS.BULK_INVITE_MEMBERS.LANGUAGE")),o(2),J("value",e.currentLanguage),o(),ce(e.languages),o(2),u("innerHTML",p(11,14,"DIALOGS.BULK_INVITE_MEMBERS.HINT"),kt),o(4),E(p(15,16,"DIALOGS.BULK_INVITE_MEMBERS.INSERT_HERE")),o(2),u("placeholder",w(p(17,18,"DIALOGS.BULK_INVITE_MEMBERS.PLACEHOLDER")))("formControl",e.invitedMembers),o(3),b(e.invitedMembers.hasError("required")?19:-1),o(),b(e.invitedMembers.hasError("invalidFormat")?20:-1),o(),b(e.invitedMembers.hasError("invalidEmail")?21:-1)}}function Ml(t,d){t&1&&(a(0,"perun-web-apps-alert",14),m(1),l(2,"translate"),r()),t&2&&(u("alert_type","success"),o(),h(" ",p(2,2,"DIALOGS.BULK_INVITE_MEMBERS.SUCCESS")," "))}function xl(t,d){t&1&&(a(0,"perun-web-apps-alert",14),m(1),l(2,"translate"),r()),t&2&&(u("alert_type","warn"),o(),h(" ",p(2,2,"DIALOGS.BULK_INVITE_MEMBERS.FINISHED_WITH_ERRORS")," "))}function Dl(t,d){if(t&1&&(a(0,"div"),v(1,Ml,3,4,"perun-web-apps-alert",14),v(2,xl,3,4,"perun-web-apps-alert",14),r()),t&2){let e=c(2);o(),b(e.finishedWithErrors?-1:1),o(),b(e.finishedWithErrors?2:-1)}}function Rl(t,d){if(t&1){let e=I();a(0,"button",15),C("click",function(){f(e);let i=c(2);return g(i.onSubmit())}),m(1),l(2,"translate"),r()}if(t&2){let e=c(2);u("disabled",e.loading||e.invitedMembers.invalid),o(),h(" ",p(2,2,"DIALOGS.BULK_INVITE_MEMBERS.INVITE")," ")}}function Ol(t,d){if(t&1){let e=I();a(0,"button",15),C("click",function(){f(e);let i=c(2);return g(i.downloadCsv())}),m(1),l(2,"translate"),r()}if(t&2){let e=c(2);u("disabled",!e.resultData),o(),h(" ",p(2,2,"DIALOGS.BULK_INVITE_MEMBERS.DOWNLOAD_CSV")," ")}}function Ll(t,d){if(t&1){let e=I();a(0,"div")(1,"h1",2),m(2),l(3,"translate"),r(),a(4,"div",3),v(5,Al,22,20,"div"),r(),v(6,Dl,3,2,"div"),a(7,"div",4)(8,"button",5),C("click",function(){f(e);let i=c();return g(i.onCancel())}),m(9),l(10,"translate"),r(),v(11,Rl,3,4,"button",6),v(12,Ol,3,4,"button",6),r()()}if(t&2){let e=c();o(2),E(p(3,6,"DIALOGS.BULK_INVITE_MEMBERS.TITLE")),o(3),b(e.state==="input"?5:-1),o(),b(e.state==="results"?6:-1),o(3),h(" ",p(10,8,"DIALOGS.BULK_INVITE_MEMBERS.CANCEL")," "),o(2),b(e.state==="input"?11:-1),o(),b(e.state==="results"?12:-1)}}var eo=(()=>{class t{constructor(e,n,i,s){this.dialogRef=e,this.data=n,this.store=i,this.registrarManager=s,this.invitedMembers=new Te("",[he.required,this.userInputValidator()]),this.languages=this.store.getProperty("supported_languages"),this.currentLanguage="en",this.loading=!1,this.state="input"}static didSomeInviteFail(e){for(let n in e)if(e[n]!=="OK")return!0;return!1}onCancel(){this.dialogRef.close(!1)}onSubmit(){this.loading=!0;let e=this.invitedMembers.value.split(`
`),n=[];for(let s of e)n.push(this.parseMemberLine(s));let i={invitationData:n,voId:this.data.voId,language:this.currentLanguage};this.data.groupId!==void 0&&(i.groupId=this.data.groupId),this.registrarManager.sendInvitationsFromCsv(i).subscribe({next:s=>{this.state="results",this.finishedWithErrors=t.didSomeInviteFail(s),this.resultData=s,this.loading=!1},error:()=>{this.loading=!1}})}downloadCsv(){Et(this.generateOutputData(this.resultData),"csv","member-invites")}generateOutputData(e){let n=[];for(let i in e)n.push({email:i,status:e[i]});return n}parseMemberLine(e){let n=e.trim();if(n==="")return"";let i=n.split(";");if(i.length>2||i.length===0)return"format";if(!i[0].trim().match(Kt))return"email";let s="";for(let S of i)s+=S.trim()+";";return s.slice(0,-1)}userInputValidator(){return e=>{let n=e.value.split(`
`);for(let i of n){let s=this.parseMemberLine(i),S=i;if(i.length>25&&(S=i.substring(0,25)+"..."),s==="format")return{invalidFormat:{value:S}};if(s==="email")return{invalidEmail:{value:S}}}return null}}static{this.\u0275fac=function(n){return new(n||t)(_(U),_(j),_(Le),_(tt))}}static{this.\u0275cmp=x({type:t,selectors:[["app-bulk-invite-members-dialog"]],decls:4,vars:5,consts:[["spinner",""],[4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],["mat-dialog-title",""],["mat-dialog-content","",1,"dialog-container"],["mat-dialog-actions",""],["mat-stroked-button","",1,"ms-auto",3,"click"],["color","accent","mat-flat-button","",1,"ms-2",3,"disabled"],[1,"font-italic"],[1,"w-100","pt-2"],[3,"valueChange","value"],[3,"value"],[3,"innerHTML"],[1,"pt-2","flex-container"],["cols","50","required","","matInput","","rows","8",1,"md-textarea","form-control",3,"formControl","placeholder"],[3,"alert_type"],["color","accent","mat-flat-button","",1,"ms-2",3,"click","disabled"]],template:function(n,i){if(n&1&&(T(0,Cl,1,0,"ng-template",null,0,B),a(2,"div"),T(3,Ll,13,10,"div",1),r()),n&2){let s=y(1);o(2),H(W("",i.data.theme," position-relative")),o(),u("perunWebAppsLoader",i.loading)("perunWebAppsLoaderIndicator",s)}},dependencies:[D,P,G,Oe,Re,Pe,rt,Ke,Xe,Ye,$e,We,le,ze,se,It,qe,K,$,X,Y,be,ve,oe,L,V,At,O],styles:[".flex-container[_ngcontent-%COMP%]{display:flex;flex-direction:column}"]})}}return t})();function wl(t,d){if(t&1){let e=I();a(0,"button",19),C("click",function(){f(e);let i=c();return g(i.onAddMember())}),m(1),l(2,"translate"),r()}if(t&2){let e=c();u("disabled",e.blockManualMemberAdding),o(),h(" ",p(2,2,"VO_DETAIL.MEMBERS.ADD_MEMBER")," ")}}function Pl(t,d){if(t&1&&(a(0,"button",9),m(1),l(2,"translate"),r()),t&2){let e=c(),n=y(13);u("disabled",e.blockManualMemberAdding||e.inviteDisabled)("matMenuTriggerFor",n),o(),h(" ",p(2,3,"VO_DETAIL.MEMBERS.INVITE")," ")}}function Gl(t,d){if(t&1){let e=I();a(0,"button",20),C("click",function(){f(e);let i=c();return g(i.onInviteMember())}),m(1),l(2,"translate"),r()}t&2&&(o(),h(" ",p(2,1,"VO_DETAIL.MEMBERS.INVITE_ONE")," "))}function Nl(t,d){if(t&1){let e=I();a(0,"button",20),C("click",function(){f(e);let i=c();return g(i.onBulkInvite())}),m(1),l(2,"translate"),r()}t&2&&(o(),h(" ",p(2,1,"VO_DETAIL.MEMBERS.INVITE_BULK")," "))}function Bl(t,d){if(t&1){let e=I();a(0,"button",21),C("click",function(){f(e);let i=c();return g(i.copyInvitationLink())}),a(1,"mat-icon"),m(2,"file_copy"),r(),a(3,"span",22),m(4),l(5,"translate"),r()()}if(t&2){let e=c();u("disabled",e.copyInvitationDisabled),o(4),h(" ",p(5,2,"VO_DETAIL.MEMBERS.COPY_INVITATION_LINK")," ")}}function Vl(t,d){if(t&1){let e=I();a(0,"button",23),l(1,"async"),C("click",function(){f(e);let i=c();return g(i.onRemoveMembers())}),m(2),l(3,"translate"),r()}if(t&2){let e=c();u("disabled",p(1,2,e.loading$)||e.selection.isEmpty()),o(2),h(" ",p(3,4,"VO_DETAIL.MEMBERS.REMOVE_MEMBERS")," ")}}function Fl(t,d){if(t&1&&(a(0,"mat-option",15),m(1),l(2,"memberStatus"),r()),t&2){let e=d.$implicit;u("value",e),o(),E(p(2,2,e))}}function kl(t,d){t&1&&A(0,"perun-web-apps-loading-table")}function Ul(t,d){if(t&1){let e=I();a(0,"perun-web-apps-members-list",24),l(1,"async"),l(2,"async"),C("queryChanged",function(i){f(e);let s=c();return g(s.nextPage.next(i))})("refreshTable",function(){f(e);let i=c();return g(i.refreshTable())})("downloadAll",function(i){f(e);let s=c();return g(s.downloadAll(i))}),r()}if(t&2){let e=c();u("loading",p(1,9,e.loading$))("displayedColumns",e.displayedColumns)("disableRouting",!e.routeAuth)("members",p(2,11,e.membersPage$))("selection",e.selection)("filter",e.searchString)("voId",e.vo.id)("cacheSubject",e.cacheSubject)("resetPagination",e.resetPagination)}}var ob=(()=>{class t{static{this.id="VoMembersComponent"}constructor(e,n,i,s,S,M,R,N,re,xe,Bt,di,Ti,mo){this.registrarService=e,this.notificator=n,this.dialog=i,this.authzService=s,this.storeService=S,this.attributesManager=M,this.apiRequest=R,this.entityStorageService=N,this.cd=re,this.cacheHelperService=xe,this.clipboard=Bt,this.membersService=di,this.membersListService=Ti,this.destroyRef=mo,this.selection=new _e(!0,[],!0,(co,uo)=>co.id===uo.id),this.attrNames=[k.MEMBER_DEF_ORGANIZATION,k.MEMBER_DEF_MAIL,k.USER_DEF_ORGANIZATION,k.USER_DEF_PREFERRED_MAIL,k.MEMBER_DEF_EXPIRATION,k.MEMBER_LIFECYCLE_ALTERABLE],this.statuses=new Te([""]),this.statusList=["VALID","INVALID","EXPIRED","DISABLED"],this.selectedStatuses=[],this.displayedColumns=["checkbox","id","fullName","status","organization","email","logins"],this.searchString="",this.updateTable=!1,this.inviteDisabled=!0,this.copyInvitationDisabled=!0,this.nextPage=new ge({}),this.loadingSubject$=new ge(!1),this.cacheSubject=new ge(!0),this.resetPagination=new ge(!1),this.loading$=Wt(this.loadingSubject$,this.nextPage.pipe(Dt(()=>!0)))}ngAfterViewInit(){this.cd.detectChanges()}ngOnInit(){this.statuses.setValue(this.selectedStatuses),this.attrNames=this.attrNames.concat(this.storeService.getLoginAttributeNames()),this.vo=this.entityStorageService.getEntity(),this.membersPage$=this.membersListService.nextPageHandler(this.nextPage,this.membersService,this.vo.id,this.attrNames,this.statuses,null,null,this.selection,this.loadingSubject$).pipe(Ai(e=>{this.setAuthRights(e.data)})),this.isManualAddingBlocked(this.vo.id),this.cacheHelperService.refreshComponentCachedData().pipe(Ne(this.destroyRef)).subscribe(e=>{e===t.id&&this.refreshTable()})}setAuthRights(e){this.addAuth=this.authzService.isAuthorized("createMember_Vo_User_List<Group>_policy",[this.vo])&&this.authzService.isAuthorized("createMember_Vo_Candidate_List<Group>_policy",[this.vo]),this.removeAuth=this.authzService.isAuthorized("deleteMembers_List<Member>_policy",[this.vo]),this.displayedColumns=this.removeAuth?this.displayedColumns:["id","fullName","status","organization","email","logins"],e!==null&&e.length!==0&&(this.routeAuth=this.authzService.isAuthorized("getMemberById_int_policy",[this.vo,e[0]])),this.inviteAuth=this.authzService.isAuthorized("vo-sendInvitation_Vo_Group_String_String_String_policy",[this.vo]),this.copyInviteLinkAuth=this.authzService.isAuthorized("vo-getApplicationById_int_policy",[this.vo]),this.inviteAuth&&this.registrarService.isInvitationEnabled(this.vo.id,null).subscribe(n=>{this.inviteDisabled=!n}),this.copyInviteLinkAuth&&this.registrarService.isLinkInvitationEnabled(this.vo.id,null).subscribe(n=>{this.copyInvitationDisabled=!n})}onSearchByString(e){this.searchString=e,this.refreshTable()}onAddMember(){let e=F();e.width="1000px",e.data={voId:this.vo.id},this.dialog.open(rr,e).afterClosed().subscribe(i=>{i&&this.refreshTable()})}onRemoveMembers(){let e=F();e.width="450px",e.data={members:this.selection.selected,theme:"vo-theme"},this.dialog.open(Qn,e).afterClosed().subscribe(i=>{i&&this.refreshTable()})}onInviteMember(){let e=F();e.width="650px",e.data={voId:this.vo.id,theme:"vo-theme"},this.dialog.open(Zn,e)}onBulkInvite(){let e=F();e.width="650px",e.data={voId:this.vo.id,theme:"vo-theme"},this.dialog.open(eo,e)}copyInvitationLink(){(this.invitationLink?Zt(this.invitationLink):this.registrarService.buildInviteURL(this.vo.id).pipe(hn(n=>(this.invitationLink=n,Zt(this.invitationLink))))).subscribe(n=>{this.clipboard.copy(n),this.notificator.showSuccess("VO_DETAIL.MEMBERS.COPY_INVITATION_LINK_SUCCESS")})}displaySelectedStatuses(){if(this.selectedStatuses.length===this.statusList.length)return"ALL";let e=this.statuses.value;return e?`${e[0]}  ${e.length>1?"(+"+(e.length-1).toString()+" "+(e.length===2?"other)":"others)"):""}`:""}isManualAddingBlocked(e){return new Promise(n=>{this.apiRequest.dontHandleErrorForNext(),this.attributesManager.getVoAttributeByName(e,"urn:perun:vo:attribute-def:def:blockManualMemberAdding").subscribe({next:i=>{this.blockManualMemberAdding=i.value!==null,n()},error:i=>{i.name!=="PrivilegeException"&&this.notificator.showError(i.name),n()}})})}changeStatuses(){this.selectedStatuses=this.statuses.value,this.refreshTable()}refreshTable(){this.cacheSubject.next(!0),this.resetPagination.next(!0),this.nextPage.next(this.nextPage.value)}downloadAll(e){let n=this.nextPage.getValue(),i=F();i.width="500px";let s=this.dialog.open(Fn,i),S=this.membersService.getMembersPage({vo:this.vo.id,attrNames:this.attrNames,query:{order:n.order,pageSize:e.length,offset:0,sortColumn:this.membersListService.getSortColumn(n.sortColumn),searchString:n.searchString,statuses:this.statuses.value}}).subscribe({next:M=>{s.close(),Et(Ot(M.data,this.displayedColumns,e.getDataForColumnFun),e.format)},error:M=>{this.notificator.showRPCError(M),s.close()}});s.afterClosed().subscribe(()=>{S&&S.unsubscribe()})}static{this.\u0275fac=function(n){return new(n||t)(_(tt),_(q),_(Ae),_(pe),_(Le),_(Tt),_(xt),_(He),_(yt),_(Je),_(kn),_(Qe),_(Gn),_(we))}}static{this.\u0275cmp=x({type:t,selectors:[["app-vo-members"]],hostVars:2,hostBindings:function(n,i){n&2&&Ee("router-component",i.true)},decls:36,vars:38,consts:[["menu","matMenu"],["spinner",""],[1,"vo-theme"],[1,"page-subtitle"],[1,"align-elements"],[3,"click"],[3,"matTooltipDisabled","matTooltip"],["color","accent","data-cy","add-members","mat-flat-button","",1,"me-2","action-button",3,"disabled"],[3,"matTooltipDisabled","matTooltipPosition","matTooltip"],["color","accent","mat-flat-button","",1,"me-2","dropdown-toggle",3,"disabled","matMenuTriggerFor"],["mat-menu-item","",1,"action-button"],["mat-stroked-button","",1,"me-2",3,"disabled"],["color","warn","data-cy","remove-members","mat-flat-button","",1,"me-2",3,"disabled"],[1,"me-2","fix-select"],["multiple","",3,"closed","formControl"],[1,"vo-theme",3,"value"],[1,"mt-2","search-field",3,"filter","placeholder"],[1,"position-relative","table-min-height"],[3,"loading","displayedColumns","disableRouting","members","selection","filter","voId","cacheSubject","resetPagination","queryChanged","refreshTable","downloadAll",4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],["color","accent","data-cy","add-members","mat-flat-button","",1,"me-2","action-button",3,"click","disabled"],["mat-menu-item","",1,"action-button",3,"click"],["mat-stroked-button","",1,"me-2",3,"click","disabled"],[1,"ms-1"],["color","warn","data-cy","remove-members","mat-flat-button","",1,"me-2",3,"click","disabled"],[3,"queryChanged","refreshTable","downloadAll","loading","displayedColumns","disableRouting","members","selection","filter","voId","cacheSubject","resetPagination"]],template:function(n,i){if(n&1){let s=I();a(0,"div",2)(1,"h1",3),m(2),l(3,"translate"),r(),a(4,"div",4)(5,"perun-web-apps-refresh-button",5),C("click",function(){return f(s),g(i.refreshTable())}),r(),a(6,"div",6),l(7,"translate"),v(8,wl,3,4,"button",7),r(),a(9,"span",8),l(10,"translate"),v(11,Pl,3,5,"button",9),a(12,"mat-menu",null,0),v(14,Gl,3,3,"button",10),v(15,Nl,3,3,"button",10),r()(),a(16,"span",8),l(17,"translate"),v(18,Bl,6,4,"button",11),r(),v(19,Vl,4,6,"button",12),a(20,"mat-form-field",13)(21,"mat-label"),m(22),l(23,"translate"),r(),a(24,"mat-select",14),C("closed",function(){return f(s),g(i.changeStatuses())}),a(25,"mat-select-trigger"),m(26),l(27,"memberStatus"),r(),de(28,Fl,3,4,"mat-option",15,Ce),r()(),a(30,"perun-web-apps-debounce-filter",16),C("filter",function(M){return f(s),g(i.onSearchByString(M))}),r()(),T(31,kl,1,0,"ng-template",null,1,B),a(33,"div",17),T(34,Ul,3,13,"perun-web-apps-members-list",18),l(35,"async"),r()()}if(n&2){let s=y(32);o(2),E(p(3,24,"VO_DETAIL.MEMBERS.TITLE")),o(4),u("matTooltip",w(p(7,26,"VO_DETAIL.MEMBERS.ADD_MEMBER_DISABLED")))("matTooltipDisabled",!i.blockManualMemberAdding),o(2),b(i.addAuth?8:-1),o(),u("matTooltip",w(p(10,28,"VO_DETAIL.MEMBERS.INVITE_DISABLED")))("matTooltipDisabled",!i.inviteDisabled)("matTooltipPosition","above"),o(2),b(i.inviteAuth?11:-1),o(3),b(i.inviteAuth?14:-1),o(),b(i.inviteAuth?15:-1),o(),u("matTooltip",w(p(17,30,"VO_DETAIL.MEMBERS.COPY_INVITATION_LINK_DISABLED")))("matTooltipDisabled",!i.copyInvitationDisabled)("matTooltipPosition","above"),o(2),b(i.copyInviteLinkAuth?18:-1),o(),b(i.removeAuth?19:-1),o(3),E(p(23,32,"VO_DETAIL.MEMBERS.FILTER_STATUS")),o(2),u("formControl",i.statuses),o(2),h(" ",p(27,34,i.displaySelectedStatuses())," "),o(2),ce(i.statusList),o(2),u("placeholder","VO_DETAIL.MEMBERS.SEARCH_DESCRIPTION"),o(4),u("perunWebAppsLoader",p(35,36,i.loading$))("perunWebAppsLoaderIndicator",s)}},dependencies:[D,P,G,lt,st,Oe,Re,Pe,Ye,$e,Pi,We,le,se,qe,ye,Ze,Xi,Yt,qt,zt,$t,L,ne,V,Ge,at,Bn,O],styles:[".search-field[_ngcontent-%COMP%]{width:325px}.fix-select[_ngcontent-%COMP%]{margin-top:8px}"]})}}return t})();var jl=()=>["select","id","name","description"];function Wl(t,d){t&1&&A(0,"perun-web-apps-loading-dialog")}function Hl(t,d){if(t&1){let e=I();a(0,"div")(1,"h1",2),m(2),l(3,"translate"),r(),a(4,"div",3)(5,"perun-web-apps-debounce-filter",4),C("filter",function(i){f(e);let s=c();return g(s.applyFilter(i))}),r(),A(6,"perun-web-apps-groups-list",5),r(),a(7,"div",6)(8,"button",7),C("click",function(){f(e);let i=c();return g(i.onCancel())}),m(9),l(10,"translate"),r(),a(11,"button",8),C("click",function(){f(e);let i=c();return g(i.onAdd())}),m(12),l(13,"translate"),r()()()}if(t&2){let e=c();o(2),E(p(3,14,"DIALOGS.ADD_MEMBER_GROUP.TITLE")),o(3),u("placeholder","DIALOGS.ADD_MEMBER_GROUP.FILTER"),o(),u("loading",e.loading)("disableGroups",!0)("disableMembers",!0)("displayColumns",ue(20,jl))("groupsToDisableCheckbox",e.membersGroups)("disableRouting",!0)("groups",e.groups)("filter",e.filterValue)("selection",e.selection),o(3),h(" ",p(10,16,"DIALOGS.ADD_MEMBER_GROUP.CANCEL")," "),o(2),u("disabled",e.loading||e.selection.selected.length===0),o(),h(" ",p(13,18,"DIALOGS.ADD_MEMBER_GROUP.ADD")," ")}}var sr=(()=>{class t{constructor(e,n,i,s,S,M,R){this.dialogRef=e,this.data=n,this.groupManager=i,this.memberManager=s,this.notificator=S,this.translate=M,this.authResolver=R,this.loading=!1,this.groups=[],this.selection=new _e(!0,[],!0,(N,re)=>N.id===re.id),this.attrNames=[k.GROUP_SYNC_ENABLED,k.GROUP_LAST_SYNC_STATE,k.GROUP_LAST_SYNC_TIMESTAMP,k.GROUP_STRUCTURE_SYNC_ENABLED,k.GROUP_LAST_STRUCTURE_SYNC_STATE,k.GROUP_LAST_STRUCTURE_SYNC_TIMESTAMP],this.filterValue=""}ngOnInit(){this.theme=this.data.theme,this.membersGroups=this.data.membersGroups,this.loading=!0,this.memberManager.getMemberById(this.data.memberId).subscribe(e=>{this.member=e,this.groupManager.getAllRichGroupsWithAttributesByNames(this.member.voId,this.attrNames).subscribe(n=>{this.groups=n.filter(i=>this.authResolver.isAuthorized("addMember_Group_Member_policy",[i])),this.loading=!1},()=>this.loading=!1)})}onAdd(){let e=this.selection.selected.map(n=>n.id);this.loading=!0,this.groupManager.addMember(e,this.member.id).subscribe(()=>{this.notificator.showSuccess(this.translate.instant("DIALOGS.ADD_MEMBER_GROUP.SUCCESS")),this.dialogRef.close(!0)},()=>this.loading=!1)}onCancel(){this.dialogRef.close(!1)}applyFilter(e){this.filterValue=e}static{this.\u0275fac=function(n){return new(n||t)(_(U),_(j),_(De),_(Qe),_(q),_(Se),_(pe))}}static{this.\u0275cmp=x({type:t,selectors:[["app-add-member-group-dialog"]],decls:4,vars:5,consts:[["spinner",""],[4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],["mat-dialog-title",""],["mat-dialog-content","",1,"dialog-container"],[3,"filter","placeholder"],[3,"loading","disableGroups","disableMembers","displayColumns","groupsToDisableCheckbox","disableRouting","groups","filter","selection"],["mat-dialog-actions",""],["mat-stroked-button","",1,"ms-auto",3,"click"],["color","accent","mat-flat-button","",1,"ms-2",3,"click","disabled"]],template:function(n,i){if(n&1&&(T(0,Wl,1,0,"ng-template",null,0,B),a(2,"div"),T(3,Hl,14,21,"div",1),r()),n&2){let s=y(1);o(2),H(W("",i.theme," position-relative")),o(),u("perunWebAppsLoader",i.loading)("perunWebAppsLoaderIndicator",s)}},dependencies:[D,P,G,K,$,X,Y,oe,ye,L,Gt,V,O],encapsulation:2})}}return t})();function zl(t,d){t&1&&A(0,"perun-web-apps-loading-dialog")}function ql(t,d){t&1&&A(0,"th",14)}function $l(t,d){if(t&1&&(a(0,"td",15),m(1),r()),t&2){let e=d.$implicit;o(),E(e.name)}}function Yl(t,d){t&1&&A(0,"tr",16)}function Xl(t,d){t&1&&A(0,"tr",17)}function Kl(t,d){if(t&1){let e=I();a(0,"div")(1,"h1",2),m(2),l(3,"translate"),r(),a(4,"div",3)(5,"p"),m(6),l(7,"translate"),r(),a(8,"div",4),m(9),l(10,"translate"),r(),a(11,"table",5),Q(12,6),T(13,ql,1,0,"th",7)(14,$l,2,1,"td",8),Z(),T(15,Yl,1,0,"tr",9)(16,Xl,1,0,"tr",10),r()(),a(17,"div",11)(18,"button",12),C("click",function(){f(e);let i=c();return g(i.onCancel())}),m(19),l(20,"translate"),r(),a(21,"button",13),C("click",function(){f(e);let i=c();return g(i.onRemove())}),m(22),l(23,"translate"),r()()()}if(t&2){let e=c();o(2),E(p(3,9,"DIALOGS.REMOVE_MEMBER_GROUP.TITLE")),o(4),E(p(7,11,"DIALOGS.REMOVE_MEMBER_GROUP.DESCRIPTION")),o(3),h(" ",p(10,13,"DIALOGS.REMOVE_MEMBER_GROUP.ASK")," "),o(2),u("dataSource",e.dataSource),o(4),u("matHeaderRowDef",e.displayedColumns),o(),u("matRowDefColumns",e.displayedColumns),o(3),h(" ",p(20,15,"DIALOGS.REMOVE_MEMBER_GROUP.CANCEL")," "),o(2),u("disabled",e.loading),o(),h(" ",p(23,17,"DIALOGS.REMOVE_MEMBER_GROUP.REMOVE")," ")}}var lr=(()=>{class t{constructor(e,n,i,s,S){this.dialogRef=e,this.data=n,this.groupManager=i,this.notificator=s,this.translate=S,this.displayedColumns=["name"],this.loading=!1}ngOnInit(){this.theme=this.data.theme,this.dataSource=new et(this.data.groups)}onRemove(){this.loading=!0;let e=this.dataSource.data.map(n=>n.id);this.groupManager.removeMember(e,this.data.memberId).subscribe(()=>{this.notificator.showSuccess(this.translate.instant("DIALOGS.REMOVE_MEMBER_GROUP.SUCCESS")),this.dialogRef.close(!0)},()=>this.loading=!1)}onCancel(){this.dialogRef.close(!1)}static{this.\u0275fac=function(n){return new(n||t)(_(U),_(j),_(De),_(q),_(Se))}}static{this.\u0275cmp=x({type:t,selectors:[["app-remove-member-group-dialog"]],decls:4,vars:5,consts:[["spinner",""],[4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],["mat-dialog-title",""],["mat-dialog-content","",1,"dialog-container"],[1,"fw-bold"],["mat-table","",1,"w-100",3,"dataSource"],["matColumnDef","name"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["class","font-weight-bolder","mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["mat-dialog-actions",""],["mat-stroked-button","",1,"ms-auto",3,"click"],["color","warn","mat-flat-button","",1,"ms-2",3,"click","disabled"],["mat-header-cell",""],["mat-cell",""],["mat-header-row","",1,"font-weight-bolder"],["mat-row",""]],template:function(n,i){if(n&1&&(T(0,zl,1,0,"ng-template",null,0,B),a(2,"div"),T(3,Kl,24,19,"div",1),r()),n&2){let s=y(1);o(2),H(W("",i.theme," position-relative")),o(),u("perunWebAppsLoader",i.loading)("perunWebAppsLoaderIndicator",s)}},dependencies:[D,P,G,K,$,X,Y,oe,vt,mt,ct,ft,ut,dt,gt,_t,ht,Ct,St,L,V,O],encapsulation:2})}}return t})();var Ql=["toggle"],Zl=["list"],Jl=t=>({removeAuth:t}),ep=()=>["nameWithId","description","expiration","status"],tp=()=>["select","id","name","description","expiration","groupStatus"];function ip(t,d){if(t&1){let e=I();a(0,"button",14),C("click",function(){f(e);let i=c();return g(i.addGroup())}),m(1),l(2,"translate"),r()}t&2&&(o(),h(" ",p(2,1,"MEMBER_DETAIL.GROUPS.ADD")," "))}function np(t,d){if(t&1){let e=I();a(0,"span",6),l(1,"translate"),a(2,"button",15),C("click",function(){f(e);let i=c();return g(i.removeGroup())}),m(3),l(4,"translate"),r()()}if(t&2){let e=d,n=c();u("matTooltip",w(p(1,5,"MEMBER_DETAIL.GROUPS.REMOVE_PERMISSION_HINT")))("matTooltipDisabled",e.removeAuth),o(2),u("disabled",n.selection.selected.length===0||!e.removeAuth),o(),h(" ",p(4,7,"MEMBER_DETAIL.GROUPS.REMOVE")," ")}}function op(t,d){t&1&&A(0,"perun-web-apps-loading-table")}function ap(t,d){if(t&1){let e=I();a(0,"perun-web-apps-groups-tree",17),C("refreshTable",function(){f(e);let i=c(2);return g(i.refreshTable())})("changeExpiration",function(i){f(e);let s=c(2);return g(s.changeExpiration(i))}),r()}if(t&2){let e=c(2);u("loading",e.loading)("expandAll",e.filtering)("disableRouting",!e.routeAuth)("groups",e.groups)("selection",e.selection)("filterValue",e.filterValue)("displayedColumns",ue(7,ep))}}function rp(t,d){if(t&1&&(a(0,"div"),T(1,ap,1,8,"perun-web-apps-groups-tree",16),r()),t&2){let e=c(),n=y(18);o(),u("perunWebAppsLoader",e.loading)("perunWebAppsLoaderIndicator",n)}}function sp(t,d){if(t&1){let e=I();a(0,"perun-web-apps-groups-list",18,2),C("refreshTable",function(){f(e);let i=c();return g(i.refreshTable())}),r()}if(t&2){let e=c();u("loading",e.loading)("displayColumns",ue(9,tp))("memberId",e.member.id)("disableRouting",!e.routeAuth)("groups",e.groups)("filter",e.filterValue)("memberGroupStatus",e.member==null?null:e.member.groupStatus)("selection",e.selection)("cacheSubject",e.cacheSubject)}}var dE=(()=>{class t{static{this.id="MemberGroupsComponent"}constructor(e,n,i,s,S,M,R,N){this.groupsService=e,this.route=n,this.dialog=i,this.authResolver=s,this.memberService=S,this.entityService=M,this.cacheHelperService=R,this.destroyRef=N,this.groups=[],this.filterValue="",this.filtering=!1,this.showGroupList=!1,this.selection=new _e(!0,[],!0,(re,xe)=>re.id===xe.id),this.selectedRoles=[],this.selectedRoleTypes=[],this.removeAuth$=this.selection.changed.pipe(Dt(re=>re.source.selected.reduce((xe,Bt)=>xe&&this.authResolver.isAuthorized("removeMember_Member_List<Group>_policy",[Bt]),!0)),Nt(!0)),this.cacheSubject=new ge(!0)}ngOnInit(){this.loading=!0,this.member=this.entityService.getEntity(),this.groupsService.getAllGroups(this.member.voId).subscribe(e=>{this.allGroups=e,this.addAuth=this.allGroups.reduce((n,i)=>n||this.authResolver.isAuthorized("addMember_Group_Member_policy",[i]),!1),this.refreshTable(),localStorage.getItem("preferedValue")==="list"&&(this.toggle.toggle(),this.showGroupList=!0),this.toggle.change.subscribe(()=>{let n=this.toggle.checked?"list":"tree";localStorage.setItem("preferedValue",n),this.refreshTable()})}),this.cacheHelperService.refreshComponentCachedData().pipe(Ne(this.destroyRef)).subscribe(e=>{e===t.id&&this.refreshTable()})}refreshTable(){this.loading=!0,this.groupsService.getMemberRichGroupsWithAttributesByNames(this.member.id,[k.MEMBER_DEF_GROUP_EXPIRATION,k.MEMBER_GROUP_STATUS,k.MEMBER_GROUP_STATUS_INDIRECT],this.selectedRoles,this.selectedRoleTypes).subscribe({next:e=>{this.cacheSubject.next(!0),this.selection.clear(),this.groups=e,this.groups.length!==0&&(this.routeAuth=this.authResolver.isAuthorized("getGroupById_int_policy",[{id:this.member.voId,beanName:"Vo"},this.groups[0]])),this.loading=!1},error:()=>this.loading=!1})}changeExpiration(e){this.list.changeExpiration(e)}addGroup(){let e=F();e.width="850px",e.data={memberId:this.member.id,membersGroups:new Set(this.groups.map(i=>i.id)),theme:"member-theme"},this.dialog.open(sr,e).afterClosed().subscribe(i=>{i&&this.refreshTable()})}removeGroup(){let e=F();e.width="650px",e.data={memberId:this.member.id,groups:this.selection.selected,theme:"member-theme"},this.dialog.open(lr,e).afterClosed().subscribe(i=>{i&&this.refreshTable()})}applyFilter(e){this.filterValue=e,this.filtering=e!=="",this.selection.clear()}applyRoles(e){this.selectedRoles=e,this.selection.clear(),this.refreshTable()}applyRoleTypes(e){this.selectedRoleTypes=e,this.selection.clear(),this.refreshTable()}labelToggle(){this.cacheSubject.next(!0),this.selection.clear(),this.showGroupList=!this.showGroupList,this.refreshTable()}static{this.\u0275fac=function(n){return new(n||t)(_(De),_(Fo),_(Ae),_(pe),_(Qe),_(He),_(Je),_(we))}}static{this.\u0275cmp=x({type:t,selectors:[["app-member-groups"]],viewQuery:function(n,i){if(n&1&&(Be(Ql,7),Be(Zl,5)),n&2){let s;Ve(s=Fe())&&(i.toggle=s.first),Ve(s=Fe())&&(i.list=s.first)}},hostVars:2,hostBindings:function(n,i){n&2&&Ee("router-component",i.true)},decls:23,vars:23,consts:[["toggle",""],["spinner",""],["list",""],[1,"page-subtitle"],[3,"refresh"],["color","accent","mat-flat-button","",1,"me-2","action-button"],[3,"matTooltipDisabled","matTooltip"],[3,"filterRoles","filterRoleTypes","hidden","theme"],[3,"filter","placeholder"],[1,"slide-label",3,"click"],[1,"me-1",3,"change","ngModelChange","ngModel"],[1,"position-relative","table-min-height"],[3,"hidden"],[3,"loading","displayColumns","memberId","disableRouting","groups","filter","memberGroupStatus","selection","cacheSubject","refreshTable",4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],["color","accent","mat-flat-button","",1,"me-2","action-button",3,"click"],["color","warn","mat-flat-button","",1,"me-2",3,"click","disabled"],["theme","member-theme",3,"loading","expandAll","disableRouting","groups","selection","filterValue","displayedColumns","refreshTable","changeExpiration",4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],["theme","member-theme",3,"refreshTable","changeExpiration","loading","expandAll","disableRouting","groups","selection","filterValue","displayedColumns"],[3,"refreshTable","loading","displayColumns","memberId","disableRouting","groups","filter","memberGroupStatus","selection","cacheSubject"]],template:function(n,i){if(n&1){let s=I();a(0,"h1",3),m(1),l(2,"translate"),r(),a(3,"perun-web-apps-refresh-button",4),C("refresh",function(){return f(s),g(i.refreshTable())}),r(),v(4,ip,3,3,"button",5),v(5,np,5,9,"span",6),l(6,"async"),a(7,"app-group-roles-filter",7),C("filterRoles",function(M){return f(s),g(i.applyRoles(M))})("filterRoleTypes",function(M){return f(s),g(i.applyRoleTypes(M))}),r(),a(8,"perun-web-apps-debounce-filter",8),C("filter",function(M){return f(s),g(i.applyFilter(M))}),r(),a(9,"label",9),C("click",function(){return f(s),g(i.labelToggle())}),m(10),l(11,"translate"),r(),a(12,"mat-slide-toggle",10,0),C("change",function(){return f(s),g(i.selection.clear())}),te("ngModelChange",function(M){return f(s),ee(i.showGroupList,M)||(i.showGroupList=M),g(M)}),r(),a(14,"label",9),C("click",function(){return f(s),g(i.labelToggle())}),m(15),l(16,"translate"),r(),T(17,op,1,0,"ng-template",null,1,B),a(19,"div",11),v(20,rp,2,2,"div"),a(21,"div",12),T(22,sp,2,10,"perun-web-apps-groups-list",13),r()()}if(n&2){let s,S=y(18);o(),E(p(2,13,"MEMBER_DETAIL.GROUPS.TITLE")),o(3),b(i.addAuth?4:-1),o(),b((s=ke(21,Jl,p(6,15,i.removeAuth$)))?5:-1,s),o(2),u("hidden",!0)("theme","member-theme"),o(),u("placeholder","MEMBER_DETAIL.GROUPS.FILTER"),o(2),h(" ",p(11,17,"MEMBER_DETAIL.GROUPS.TREE_VIEW"),`
`),o(2),J("ngModel",i.showGroupList),o(3),h(" ",p(16,19,"MEMBER_DETAIL.GROUPS.LIST_VIEW"),`
`),o(5),b(i.showGroupList?-1:20),o(),u("hidden",!i.showGroupList),o(),u("perunWebAppsLoader",i.loading)("perunWebAppsLoaderIndicator",S)}},dependencies:[D,P,G,ni,ii,je,se,Ue,le,ye,Ze,Qi,L,ne,Gt,Yi,V,Ge,at,O],styles:[".slide-label[_ngcontent-%COMP%]{display:inline;cursor:pointer}"]})}}return t})();var lp=["toggle"],pp=t=>({removeAuth:t}),mp=()=>["nameWithId","description","menu"],dp=()=>["select","id","name","description","menu"],cp=()=>["id","name","description","menu"];function up(t,d){if(t&1){let e=I();a(0,"button",12),C("click",function(){f(e);let i=c();return g(i.onCreateGroup())}),m(1),l(2,"translate"),r()}t&2&&(o(),h(" ",p(2,1,"GROUP_DETAIL.SUBGROUPS.CREATE_GROUP")," "))}function _p(t,d){if(t&1){let e=I();a(0,"button",14),C("click",function(){f(e);let i=c(2);return g(i.deleteGroup())}),m(1),l(2,"translate"),r()}if(t&2){let e=c(),n=c();u("disabled",n.loading||n.selected.selected.length===0||!e.removeAuth),o(),h(" ",p(2,2,"GROUP_DETAIL.SUBGROUPS.DELETE_GROUP")," ")}}function hp(t,d){if(t&1&&(a(0,"span",5),l(1,"translate"),v(2,_p,3,4,"button",13),r()),t&2){let e=c();u("matTooltip",w(p(1,4,"GROUP_DETAIL.SUBGROUPS.DELETE_PERMISSION_HINT")))("matTooltipDisabled",e.loading||e.selected.selected.length===0||d.removeAuth),o(2),b(e.deleteAuth?2:-1)}}function fp(t,d){t&1&&A(0,"perun-web-apps-loading-table")}function gp(t,d){if(t&1){let e=I();a(0,"perun-web-apps-groups-tree",17),C("moveGroup",function(i){f(e);let s=c(2);return g(s.onMoveGroup(i))})("refreshTable",function(){f(e);let i=c(2);return g(i.refreshTable())}),r()}if(t&2){let e=c(2);u("loading",e.loading)("disableRouting",!e.routeAuth)("expandAll",e.filtering)("groups",e.groups)("displayedColumns",ue(8,mp))("hideCheckbox",!e.deleteAuth)("filterValue",e.filterValue)("selection",e.selected)}}function Cp(t,d){if(t&1){let e=I();a(0,"perun-web-apps-groups-list",18),C("groupMoved",function(i){f(e);let s=c(2);return g(s.onMoveGroup(i))})("refreshTable",function(){f(e);let i=c(2);return g(i.refreshTable())}),r()}if(t&2){let e=c(2);u("loading",e.loading)("disableMembers",!0)("disableRouting",!e.routeAuth)("displayColumns",e.deleteAuth?ue(8,dp):ue(9,cp))("groups",e.groups)("selection",e.selected)("filter",e.filterValue)("cacheSubject",e.cacheSubject)}}function Sp(t,d){if(t&1&&(a(0,"div"),v(1,gp,1,9,"perun-web-apps-groups-tree",15),v(2,Cp,1,10,"perun-web-apps-groups-list",16),r()),t&2){let e=c();o(),b(e.showGroupList?-1:1),o(),b(e.showGroupList?2:-1)}}var kE=(()=>{class t{static{this.id="GroupSubgroupsComponent"}constructor(e,n,i,s,S,M,R){this.dialog=e,this.groupService=n,this.guiAuthResolver=i,this.entityStorageService=s,this.cacheHelperService=S,this.destroyRef=M,this.cd=R,this.groups=[],this.selected=new _e(!0,[],!0,(N,re)=>N.id===re.id),this.selectedRoles=[],this.selectedRoleTypes=[],this.showGroupList=!1,this.filtering=!1,this.filterValue="",this.removeAuth$=this.selected.changed.pipe(Dt(N=>N.source.selected.reduce((re,xe)=>re&&this.guiAuthResolver.isAuthorized("deleteGroup_Group_boolean_policy",[xe]),!0)),Nt(!0)),this.cacheSubject=new ge(!0)}onCreateGroup(){let e=F();e.width="450px",e.data={parentGroup:this.group,theme:"group-theme"},this.dialog.open(qn,e).afterClosed().subscribe(i=>{i&&(this.loading=!0,this.refreshTable())})}ngOnInit(){localStorage.getItem("preferedValue")==="list"&&(this.toggle.toggle(),this.selected.clear(),this.showGroupList=!0),this.toggle.change.subscribe(()=>{let e=this.toggle.checked?"list":"tree";localStorage.setItem("preferedValue",e)}),this.group=this.entityStorageService.getEntity(),this.setAuthRights(),this.refreshTable(),this.cacheHelperService.refreshComponentCachedData().pipe(Ne(this.destroyRef)).subscribe(e=>{e===t.id&&this.refreshTable()})}setAuthRights(){this.createAuth=this.guiAuthResolver.isAuthorized("createGroup_Group_Group_policy",[this.group]),this.deleteAuth=this.guiAuthResolver.isAuthorized("deleteGroups_List<Group>_boolean_policy",[this.group]),this.groups.length!==0&&(this.routeAuth=this.guiAuthResolver.isAuthorized("getGroupById_int_policy",[this.groups[0]]))}deleteGroup(){let e=F();e.width="450px",e.data={voId:this.group.id,groups:this.selected.selected,theme:"group-theme"},this.dialog.open($n,e).afterClosed().subscribe(i=>{i&&this.refreshTable()})}labelToggle(){this.showGroupList=!this.showGroupList,this.refreshTable()}refreshTable(){this.loading=!0,this.groupService.getAllRichSubGroupsWithGroupAttributesByNames(this.group.id,[k.GROUP_DEF_MAIL_FOOTER,k.GROUP_SYNC_ENABLED,k.GROUP_LAST_SYNC_STATE,k.GROUP_LAST_SYNC_TIMESTAMP,k.GROUP_STRUCTURE_SYNC_ENABLED,k.GROUP_LAST_STRUCTURE_SYNC_STATE,k.GROUP_LAST_STRUCTURE_SYNC_TIMESTAMP],this.selectedRoles,this.selectedRoleTypes).subscribe(e=>{this.groups=e,this.cacheSubject.next(!0),this.selected.clear(),this.setAuthRights(),this.loading=!1})}applyFilter(e){this.filterValue=e,this.filtering=e!=="",this.selected.clear()}applyRoles(e){this.selectedRoles=e,this.refreshTable()}applyRoleTypes(e){this.selectedRoleTypes=e,this.refreshTable()}onMoveGroup(e){let n=F();n.width="550px",n.data={group:e,theme:"group-theme"},this.dialog.open(Xn,n).afterClosed().subscribe(s=>{s&&this.refreshTable()})}static{this.\u0275fac=function(n){return new(n||t)(_(Ae),_(De),_(pe),_(He),_(Je),_(we),_(yt))}}static{this.\u0275cmp=x({type:t,selectors:[["app-group-subgroups"]],viewQuery:function(n,i){if(n&1&&Be(lp,7),n&2){let s;Ve(s=Fe())&&(i.toggle=s.first)}},hostVars:2,hostBindings:function(n,i){n&2&&Ee("router-component",i.true)},decls:22,vars:20,consts:[["toggle",""],["spinner",""],[1,"page-subtitle"],[3,"refresh"],["color","accent","data-cy","new-subgroup-button","mat-flat-button","",1,"me-2","action-button"],[3,"matTooltipDisabled","matTooltip"],[3,"filterRoles","filterRoleTypes","theme"],[3,"filter","placeholder"],[1,"slide-label",3,"click"],["labelPosition","before",1,"me-1",3,"change","ngModelChange","ngModel"],[1,"position-relative","mt-3","table-min-height"],[4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],["color","accent","data-cy","new-subgroup-button","mat-flat-button","",1,"me-2","action-button",3,"click"],["color","warn","data-cy","delete-group-button","mat-flat-button","",1,"me-2",3,"disabled"],["color","warn","data-cy","delete-group-button","mat-flat-button","",1,"me-2",3,"click","disabled"],[3,"loading","disableRouting","expandAll","groups","displayedColumns","hideCheckbox","filterValue","selection"],[3,"loading","disableMembers","disableRouting","displayColumns","groups","selection","filter","cacheSubject"],[3,"moveGroup","refreshTable","loading","disableRouting","expandAll","groups","displayedColumns","hideCheckbox","filterValue","selection"],[3,"groupMoved","refreshTable","loading","disableMembers","disableRouting","displayColumns","groups","selection","filter","cacheSubject"]],template:function(n,i){if(n&1){let s=I();a(0,"div")(1,"h1",2),m(2),l(3,"translate"),r(),a(4,"perun-web-apps-refresh-button",3),C("refresh",function(){return f(s),g(i.refreshTable())}),r(),v(5,up,3,3,"button",4),v(6,hp,3,6,"span",5),l(7,"async"),a(8,"app-group-roles-filter",6),C("filterRoles",function(M){return f(s),g(i.applyRoles(M))})("filterRoleTypes",function(M){return f(s),g(i.applyRoleTypes(M))}),r(),a(9,"perun-web-apps-debounce-filter",7),C("filter",function(M){return f(s),g(i.applyFilter(M))}),r(),a(10,"label",8),C("click",function(){return f(s),g(i.labelToggle())}),m(11),l(12,"translate"),r(),a(13,"mat-slide-toggle",9,0),C("change",function(){return f(s),g(i.selected.clear())}),te("ngModelChange",function(M){return f(s),ee(i.showGroupList,M)||(i.showGroupList=M),g(M)}),r(),a(15,"label",8),C("click",function(){return f(s),g(i.labelToggle())}),m(16),l(17,"translate"),r(),T(18,fp,1,0,"ng-template",null,1,B),a(20,"div",10),T(21,Sp,3,2,"div",11),r()()}if(n&2){let s,S=y(19);o(2),E(p(3,10,"GROUP_DETAIL.SUBGROUPS.TITLE")),o(3),b(i.createAuth?5:-1),o(),b((s=ke(18,pp,p(7,12,i.removeAuth$)))?6:-1,s),o(2),u("theme","group-theme"),o(),u("placeholder","GROUP_DETAIL.SUBGROUPS.FILTER"),o(2),h(" ",p(12,14,"GROUP_DETAIL.SUBGROUPS.TREE_VIEW")," "),o(2),J("ngModel",i.showGroupList),o(3),h(" ",p(17,16,"GROUP_DETAIL.SUBGROUPS.LIST_VIEW")," "),o(5),u("perunWebAppsLoader",i.loading)("perunWebAppsLoaderIndicator",S)}},dependencies:[D,P,G,ni,ii,je,se,Ue,le,ye,Ze,Qi,L,ne,Gt,Yi,V,Ge,at,O],styles:[".slide-label[_ngcontent-%COMP%]{display:inline;cursor:pointer}"]})}}return t})();function vp(t,d){t&1&&A(0,"perun-web-apps-loading-dialog")}function bp(t,d){if(t&1){let e=I();a(0,"button",14),C("click",function(){f(e);let i=c(2);return g(i.default())}),m(1),l(2,"translate"),r()}t&2&&(o(),h(" ",p(2,1,"DIALOGS.APPLICATIONS_LIST_COLUMNS_CHANGE.SET_TO_DEFAULT")," "))}function Ep(t,d){if(t&1&&(a(0,"button",8),m(1),l(2,"translate"),r()),t&2){c();let e=y(11);u("matMenuTriggerFor",e),o(),h(" ",p(2,2,"DIALOGS.APPLICATIONS_LIST_COLUMNS_CHANGE.SET_TO")," ")}}function Ip(t,d){if(t&1){let e=I();a(0,"div")(1,"h1",3),m(2),l(3,"translate"),r(),a(4,"div",4)(5,"div",5),A(6,"perun-web-apps-string-search-select",6),l(7,"translate"),v(8,bp,3,3,"button",7),v(9,Ep,3,4,"button",8),a(10,"mat-menu",null,1)(12,"button",9),C("click",function(){f(e);let i=c();return g(i.default())}),m(13),l(14,"translate"),r(),a(15,"button",9),C("click",function(){f(e);let i=c();return g(i.template())}),m(16),l(17,"translate"),r()()(),a(18,"perun-web-apps-alert",10),m(19),l(20,"translate"),r()(),a(21,"div",11)(22,"button",12),C("click",function(){f(e);let i=c();return g(i.cancel())}),m(23),l(24,"translate"),r(),a(25,"button",13),C("click",function(){f(e);let i=c();return g(i.confirm())}),m(26),l(27,"translate"),r()()()}if(t&2){let e=c();o(2),E(p(3,13,"DIALOGS.APPLICATIONS_LIST_COLUMNS_CHANGE.TITLE")),o(4),u("values",e.columnOptions)("preselectedValues",e.selectedColumns)("selectPlaceholder",p(7,15,"DIALOGS.APPLICATIONS_LIST_COLUMNS_CHANGE.FILTER_COLUMNS"))("mainTextFunction",e.columnTranslation),o(2),b(e.templateAttribute?-1:8),o(),b(e.templateAttribute?9:-1),o(4),h(" ",p(14,17,"DIALOGS.APPLICATIONS_LIST_COLUMNS_CHANGE.DEFAULT")," "),o(3),h(" ",p(17,19,"DIALOGS.APPLICATIONS_LIST_COLUMNS_CHANGE.VO_SETTINGS")," "),o(3),h(" ",p(20,21,"DIALOGS.APPLICATIONS_LIST_COLUMNS_CHANGE.WARN")," "),o(4),h(" ",p(24,23,"DIALOGS.APPLICATIONS_LIST_COLUMNS_CHANGE.CANCEL")," "),o(2),u("disabled",e.loading),o(),h(" ",p(27,25,"DIALOGS.APPLICATIONS_LIST_COLUMNS_CHANGE.CONFIRM")," ")}}var to=(()=>{class t{constructor(e,n,i,s,S,M){this.dialogRef=e,this.attributesManager=n,this.data=i,this.translate=s,this.notificator=S,this.columnNamePipe=M,this.loading=!1,this.simpleColumns=["createdAt","type","state","createdBy","modifiedBy"],this.columnOptions=["createdAt","type","state","createdBy","modifiedBy"],this.selectedColumns=[],this.fedAttributeDefs=[],this.columnTranslation=R=>this.columnNamePipe.transform(this.friendlyToDisplayAttrName(R))}ngOnInit(){this.theme=this.data.theme,this.loading=!0,this.data.groupId?this.attributesManager.getIdpAttributeDefinitions().subscribe(e=>{this.processFedAttributes(e),this.attributesManager.getVoAttributeByName(this.data.voId,"urn:perun:vo:attribute-def:def:applicationViewPreferences").subscribe(n=>{n.value!==null&&(this.templateAttribute=n),this.attributesManager.getGroupAttributeByName(this.data.groupId,"urn:perun:group:attribute-def:def:applicationViewPreferences").subscribe(i=>{this.processCurrentSettings(i),this.loading=!1})})}):this.attributesManager.getIdpAttributeDefinitions().subscribe(e=>{this.processFedAttributes(e),this.attributesManager.getVoAttributeByName(this.data.voId,"urn:perun:vo:attribute-def:def:applicationViewPreferences").subscribe(n=>{this.processCurrentSettings(n)}),this.loading=!1})}confirm(){this.selectedColumns===null||this.selectedColumns.length===0||ia(this.selectedColumns,this.simpleColumns)?this.attribute.value=[]:this.attribute.value=[...this.selectedColumns],this.data.groupId?this.changeGroupAttribute():this.changeVoAttribute()}cancel(){this.dialogRef.close(!1)}default(){this.selectedColumns=[...this.simpleColumns]}template(){this.selectedColumns=this.templateAttribute.value}friendlyToDisplayAttrName(e){return this.fedAttributeDefs.find(n=>n.friendlyName===e)?.displayName||e}changeVoAttribute(){this.loading=!0,this.attributesManager.setVoAttribute({vo:this.data.voId,attribute:this.attribute}).subscribe({next:()=>{this.loading=!1,this.dialogRef.close(!0),this.notificator.showSuccess(this.translate.instant("DIALOGS.APPLICATIONS_LIST_COLUMNS_CHANGE.SUCCESS"))},error:()=>{this.loading=!1}})}changeGroupAttribute(){this.loading=!0,this.attributesManager.setGroupAttribute({group:this.data.groupId,attribute:this.attribute}).subscribe({next:()=>{this.loading=!1,this.dialogRef.close(!0),this.notificator.showSuccess(this.translate.instant("DIALOGS.APPLICATIONS_LIST_COLUMNS_CHANGE.SUCCESS"))},error:()=>{this.loading=!1}})}processFedAttributes(e){e=e.sort((n,i)=>n.friendlyName.localeCompare(i.friendlyName)),this.fedAttributeDefs=e,e.forEach(n=>{this.columnOptions.push(n.friendlyName)}),this.columnOptions=[...this.columnOptions]}processCurrentSettings(e){this.attribute=e;let n=e.value;n!==null&&n.length>0?this.selectedColumns=[...n]:this.selectedColumns=[...this.simpleColumns]}static{this.\u0275fac=function(n){return new(n||t)(_(U),_(Tt),_(j),_(Mt),_(q),_(Vn))}}static{this.\u0275cmp=x({type:t,selectors:[["app-applications-list-columns-change-dialog"]],features:[fn([Vn])],decls:4,vars:5,consts:[["spinner",""],["menu","matMenu"],[4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],["mat-dialog-title",""],["mat-dialog-content",""],[1,"d-flex","flex-row","align-items-baseline","justify-content-between"],[3,"values","preselectedValues","selectPlaceholder","mainTextFunction"],["mat-stroked-button",""],["mat-stroked-button","",1,"dropdown-toggle","ml-auto",3,"matMenuTriggerFor"],["mat-menu-item","",3,"click"],["alert_type","warn"],["mat-dialog-actions",""],["mat-stroked-button","",1,"ms-auto",3,"click"],["color","accent","mat-flat-button","",3,"click","disabled"],["mat-stroked-button","",3,"click"]],template:function(n,i){if(n&1&&(T(0,vp,1,0,"ng-template",null,0,B),a(2,"div"),T(3,Ip,28,27,"div",2),r()),n&2){let s=y(1);o(2),H(W("",i.theme," position-relative")),o(),u("perunWebAppsLoader",i.loading)("perunWebAppsLoaderIndicator",s)}},dependencies:[D,P,G,K,$,X,Y,be,ve,oe,Yt,qt,zt,$t,L,Xa,V,O],encapsulation:2})}}return t})();var Tp=t=>({count:t});function Ap(t,d){t&1&&A(0,"perun-web-apps-loading-dialog")}function Mp(t,d){t&1&&(a(0,"perun-web-apps-alert",4),m(1),l(2,"translate"),r()),t&2&&(o(),h(" ",p(2,1,"DIALOGS.RE_SEND_NOTIFICATION.EMPTY_TYPES_ALERT")," "))}function xp(t,d){if(t&1&&(a(0,"mat-option",12),m(1),l(2,"translate"),r()),t&2){let e=d.$implicit;u("value",e),o(),h(" ",p(2,2,"DIALOGS.RE_SEND_NOTIFICATION.NOTIFICATION_TYPE."+e)," ")}}function Dp(t,d){if(t&1){let e=I();a(0,"div"),m(1),l(2,"translate"),a(3,"mat-form-field",10)(4,"textarea",13),te("ngModelChange",function(i){f(e);let s=c(3);return ee(s.reason,i)||(s.reason=i),g(i)}),r()()()}if(t&2){let e=c(3);o(),h(" ",p(2,2,"DIALOGS.RE_SEND_NOTIFICATION.REASON"),": "),o(3),J("ngModel",e.reason)}}function Rp(t,d){if(t&1){let e=I();a(0,"div"),v(1,Mp,3,3,"perun-web-apps-alert",4),m(2),l(3,"translate"),a(4,"mat-form-field",10)(5,"mat-select",11),te("valueChange",function(i){f(e);let s=c(2);return ee(s.mailType,i)||(s.mailType=i),g(i)}),de(6,xp,3,4,"mat-option",12,Ce),r()(),v(8,Dp,5,4,"div"),r()}if(t&2){let e=c(2);o(),b(!e.loading&&e.displayedMailTypes.length===0?1:-1),o(),h(" ",p(3,4,"DIALOGS.RE_SEND_NOTIFICATION.SELECT"),": "),o(3),J("value",e.mailType),o(),ce(e.displayedMailTypes),o(2),b(e.mailType==="APP_REJECTED_USER"?8:-1)}}function Op(t,d){if(t&1){let e=I();a(0,"button",14),C("click",function(){f(e);let i=c(2);return g(i.onConfirm())}),m(1),l(2,"translate"),r()}if(t&2){let e=c(2);o(),h(" ",p(2,1,e.data.confirmButtonLabel)," ")}}function Lp(t,d){if(t&1){let e=I();a(0,"span",9),l(1,"translate"),a(2,"span",9),l(3,"translate"),l(4,"appMatchMailType"),a(5,"button",15),l(6,"appMatchMailType"),C("click",function(){f(e);let i=c(2);return g(i.onConfirm())}),m(7),l(8,"translate"),r()()()}if(t&2){let e=c(2);u("matTooltip",p(1,6,"DIALOGS.RE_SEND_NOTIFICATION.EMPTY_TYPES_TOOLTIP"))("matTooltipDisabled",e.loading||e.displayedMailTypes.length>0),o(2),u("matTooltip",p(3,8,"DIALOGS.RE_SEND_NOTIFICATION.MISSING_TYPE_TOOLTIP"))("matTooltipDisabled",e.displayedMailTypes.length===0||nn(4,10,e.data.selectedApplications,e.appMails,e.mailType)),o(3),u("disabled",e.loading||e.displayedMailTypes.length===0||!nn(6,14,e.data.selectedApplications,e.appMails,e.mailType)),o(2),h(" ",p(8,18,e.data.confirmButtonLabel)," ")}}function yp(t,d){if(t&1){let e=I();a(0,"div")(1,"h1",2),m(2),l(3,"translate"),r(),a(4,"div",3),v(5,Rp,9,6,"div"),a(6,"perun-web-apps-alert",4),m(7),l(8,"translate"),r(),A(9,"perun-web-apps-applications-list",5),r(),a(10,"div",6)(11,"button",7),C("click",function(){f(e);let i=c();return g(i.onCancel())}),m(12),l(13,"translate"),r(),v(14,Op,3,3,"button",8),v(15,Lp,9,20,"span",9),r()()}if(t&2){let e=c();o(2),E(p(3,11,e.data.title)),o(3),b(e.data.action==="RESEND"?5:-1),o(2),h(" ",Me(8,13,e.data.description,ke(18,Tp,e.data.selectedApplications.length))," "),o(2),u("displayColumns",e.data.displayedColumns)("fedColumnsFriendly",e.data.fedColumnsFriendly)("fedAttrs",e.data.fedAttrs)("applications",e.data.selectedApplications)("disableRouting",!0),o(3),h(" ",p(13,16,"VO_DETAIL.APPLICATION.DIALOG.CANCEL")," "),o(2),b(e.data.action!=="RESEND"?14:-1),o(),b(e.data.action==="RESEND"?15:-1)}}var pr=(()=>{class t{constructor(e,n,i){this.dialogRef=e,this.data=n,this.registrarManager=i,this.loading=!1,this.mailType="APP_CREATED_USER",this.reason="",this.availableMailTypes=[vi.APP_CREATED_USER,vi.APPROVABLE_GROUP_APP_USER,vi.APP_CREATED_VO_ADMIN,vi.MAIL_VALIDATION,vi.APP_APPROVED_USER,vi.APP_REJECTED_USER,vi.APP_ERROR_VO_ADMIN],this.displayedMailTypes=[],this.appMails=[]}ngOnInit(){this.data.action==="RESEND"&&(this.loading=!0,this.data.groupId?this.registrarManager.getApplicationMailsForGroup(this.data.groupId).subscribe({next:e=>{e.map(n=>{n.send&&this.availableMailTypes.includes(n.mailType)&&(this.appMails.push(n),this.displayedMailTypes.includes(n.mailType)||this.displayedMailTypes.push(n.mailType))}),this.displayedMailTypes.length>0&&(this.mailType=this.displayedMailTypes.sort()[0]),this.loading=!1},error:()=>{this.loading=!1}}):this.registrarManager.getApplicationMailsForVo(this.data.voId).subscribe({next:e=>{e.map(n=>{n.send&&this.availableMailTypes.includes(n.mailType)&&(this.appMails.push(n),this.displayedMailTypes.includes(n.mailType)||this.displayedMailTypes.push(n.mailType))}),this.displayedMailTypes.length>0&&(this.mailType=this.displayedMailTypes.sort()[0]),this.loading=!1},error:()=>{this.loading=!1}}))}onConfirm(){this.data.action==="RESEND"?this.dialogRef.close({type:this.mailType,reason:this.reason}):this.dialogRef.close(!0)}onCancel(){this.dialogRef.close(!1)}static{this.\u0275fac=function(n){return new(n||t)(_(U),_(j),_(tt))}}static{this.\u0275cmp=x({type:t,selectors:[["app-applications-bulk-operation-dialog"]],decls:4,vars:4,consts:[["spinner",""],[4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],["mat-dialog-title",""],["mat-dialog-content",""],["alert_type","warn"],[3,"displayColumns","fedColumnsFriendly","fedAttrs","applications","disableRouting"],["mat-dialog-actions",""],["mat-stroked-button","",1,"ms-auto","me-2",3,"click"],["color","accent","mat-flat-button","",1,"me-2"],[3,"matTooltip","matTooltipDisabled"],[1,"w-100"],["disableOptionCentering","",3,"valueChange","value"],[3,"value"],["matInput","",3,"ngModelChange","ngModel"],["color","accent","mat-flat-button","",1,"me-2",3,"click"],["color","accent","mat-flat-button","",1,"me-2",3,"click","disabled"]],template:function(n,i){if(n&1&&(T(0,Ap,1,0,"ng-template",null,0,B),a(2,"div"),T(3,yp,16,20,"div",1),r()),n&2){let s=y(1);o(2),H(i.data.theme),o(),u("perunWebAppsLoader",i.loading)("perunWebAppsLoaderIndicator",s)}},dependencies:[D,P,G,Oe,Re,Ke,Xe,Ye,$e,We,je,ze,se,Ue,le,K,$,X,Y,be,ve,oe,L,ne,zn,V,O,Ma],encapsulation:2})}}return t})();function wp(t,d){t&1&&A(0,"perun-web-apps-loading-dialog")}function Pp(t,d){t&1&&(a(0,"div")(1,"div"),m(2),l(3,"translate"),r()()),t&2&&(o(2),h(" ",p(3,1,"DIALOGS.APP_APPROVE_ANYWAY.NOT_ELIGIBLE")," "))}function Gp(t,d){t&1&&(a(0,"div")(1,"div"),m(2),l(3,"translate"),r()()),t&2&&(o(2),h(" ",p(3,1,"DIALOGS.APP_APPROVE_ANYWAY.NOT_ELIGIBLE_EINFRACZ")," "))}function Np(t,d){if(t&1&&(a(0,"div")(1,"div"),m(2),r()()),t&2){let e=c(2);o(2),h(" ",e.err.message," ")}}function Bp(t,d){t&1&&(a(0,"div"),m(1),l(2,"translate"),r()),t&2&&(o(),h(" ",p(2,1,"DIALOGS.APP_APPROVE_ANYWAY.APPROVE_ANYWAY")," "))}function Vp(t,d){if(t&1){let e=I();a(0,"button",8),C("click",function(){f(e);let i=c(2);return g(i.onSubmit())}),m(1),l(2,"translate"),r()}t&2&&(o(),h(" ",p(2,1,"DIALOGS.APP_APPROVE_ANYWAY.SUBMIT")," "))}function Fp(t,d){if(t&1){let e=I();a(0,"div")(1,"h1",2),m(2),l(3,"translate"),r(),a(4,"div",3)(5,"div"),m(6),l(7,"translate"),r(),a(8,"perun-web-apps-alert",4),v(9,Pp,4,3,"div")(10,Gp,4,3,"div")(11,Np,3,1,"div"),r(),v(12,Bp,3,3,"div"),r(),a(13,"div",5)(14,"button",6),C("click",function(){f(e);let i=c();return g(i.onCancel())}),m(15),l(16,"translate"),r(),v(17,Vp,3,3,"button",7),r()()}if(t&2){let e=c();H(e.theme),o(2),E(p(3,8,"DIALOGS.APP_APPROVE_ANYWAY.TITLE")),o(4),h(" ",p(7,10,"DIALOGS.APP_APPROVE_ANYWAY.TEXT")," "),o(3),b(e.err.reason==="NOT_ELIGIBLE"?9:e.err.reason==="NOT_ELIGIBLE_EINFRACZ"?10:11),o(3),b(e.err.soft?12:-1),o(3),h(" ",p(16,12,"DIALOGS.APP_APPROVE_ANYWAY.CANCEL")," "),o(2),b(e.err.soft?17:-1)}}var mr=(()=>{class t{constructor(e,n,i,s,S){this.dialogRef=e,this.data=n,this.translate=i,this.registrarManager=s,this.notificator=S,this.loading=!1}ngOnInit(){this.err=this.data.err,this.theme=this.data.theme,this.application=this.data.application}onCancel(){this.dialogRef.close(!1)}onSubmit(){this.loading=!0,this.registrarManager.approveApplication(this.application.id).subscribe({next:()=>{this.translate.get("VO_DETAIL.APPLICATION.APPLICATION_DETAIL.APPROVE_MESSAGE").subscribe(e=>{this.notificator.showSuccess(e),this.dialogRef.close(!0)})},error:()=>this.loading=!1})}static{this.\u0275fac=function(n){return new(n||t)(_(U),_(j),_(Se),_(tt),_(q))}}static{this.\u0275cmp=x({type:t,selectors:[["app-application-approve-anyway-dialog"]],decls:3,vars:2,consts:[["spinner",""],[3,"class",4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],["mat-dialog-title",""],["mat-dialog-content",""],["alert_type","warn"],["mat-dialog-actions",""],["mat-stroked-button","",1,"ms-auto",3,"click"],["mat-flat-button","","color","accent",1,"ms-2"],["mat-flat-button","","color","accent",1,"ms-2",3,"click"]],template:function(n,i){if(n&1&&T(0,wp,1,0,"ng-template",null,0,B)(2,Fp,18,14,"div",1),n&2){let s=y(1);o(2),u("perunWebAppsLoader",i.loading)("perunWebAppsLoaderIndicator",s)}},dependencies:[D,P,G,K,$,X,Y,be,ve,oe,L,V,O],encapsulation:2})}}return t})();var kp=t=>({all:t}),Up=()=>({name:""});function jp(t,d){if(t&1){let e=I();a(0,"mat-checkbox",18),l(1,"masterCheckboxLabel"),l(2,"translate"),C("change",function(i){f(e);let s=c(3);return g(i?s.masterToggle():null)}),r()}if(t&2){let e=c(2),n=c();pi("aria-label",p(2,5,p(1,3,e.all))),u("checked",n.selection.hasValue()&&e.all)("indeterminate",n.selection.hasValue()&&!e.all)}}function Wp(t,d){if(t&1&&(a(0,"th",16),v(1,jp,3,7,"mat-checkbox",17),r()),t&2){let e=c(2);o(),b(e.selection.isMultipleSelection()?1:-1)}}function Hp(t,d){if(t&1){let e=I();a(0,"td",19)(1,"mat-checkbox",20),l(2,"checkboxLabel"),l(3,"translate"),C("change",function(i){let s=f(e).$implicit,S=c(2);return g(i?S.toggleRow(s):null)})("click",function(i){return f(e),g(i.stopPropagation())}),r()()}if(t&2){let e=d.$implicit,n=c(2);o(),pi("aria-label",Me(3,4,p(2,2,n.selection.isSelected(e)),ue(7,Up))),u("checked",n.selection.isSelected(e))}}function zp(t,d){t&1&&(Q(0,3),T(1,Wp,2,1,"th",14)(2,Hp,4,8,"td",15),Z())}function qp(t,d){t&1&&(a(0,"th",21),m(1),l(2,"translate"),r()),t&2&&(o(),h(" ",p(2,1,"APPLICATIONS_LIST.ID")," "))}function $p(t,d){if(t&1&&(a(0,"td",22),m(1),r()),t&2){let e=d.$implicit;o(),h(" ",e[0].id," ")}}function Yp(t,d){t&1&&(a(0,"th",23),m(1),l(2,"translate"),r()),t&2&&(o(),E(p(2,1,"APPLICATIONS_LIST.GROUP_ID")))}function Xp(t,d){if(t&1&&(a(0,"td",22),m(1),r()),t&2){let e=d.$implicit;o(),h(" ",e[0].group?e[0].group.id:""," ")}}function Kp(t,d){t&1&&(a(0,"th",23),m(1),l(2,"translate"),r()),t&2&&(o(),E(p(2,1,"APPLICATIONS_LIST.GROUP_NAME")))}function Qp(t,d){if(t&1&&(a(0,"td",22),m(1),r()),t&2){let e=d.$implicit;o(),h(" ",e[0].group?e[0].group.name:""," ")}}function Zp(t,d){t&1&&(a(0,"th",21),m(1),l(2,"translate"),r()),t&2&&(o(),h(" ",p(2,1,"APPLICATIONS_LIST.CREATED_DATE")," "))}function Jp(t,d){if(t&1&&(a(0,"td",22),m(1),l(2,"date"),r()),t&2){let e=d.$implicit;o(),h(" ",Me(2,1,e[0].createdAt,"d.M.y")," ")}}function em(t,d){t&1&&(a(0,"th",21),m(1),l(2,"translate"),r()),t&2&&(o(),h(" ",p(2,1,"APPLICATIONS_LIST.CREATED_BY")," "))}function tm(t,d){if(t&1&&(a(0,"td",22),m(1),r()),t&2){let e=d.$implicit;Rt("data-cy",W("",e[0].createdBy,"-createdBy")),o(),h(" ",e[0].createdBy.slice(e[0].createdBy.lastIndexOf("=")+1,e[0].createdBy.length)," ")}}function im(t,d){t&1&&(a(0,"th",21),m(1),l(2,"translate"),r()),t&2&&(o(),h(" ",p(2,1,"APPLICATIONS_LIST.ERROR")," "))}function nm(t,d){if(t&1&&(a(0,"td",22),m(1),r()),t&2){let e=d.$implicit;o(),E(e[1].name)}}function om(t,d){t&1&&A(0,"tr",24)}function am(t,d){if(t&1){let e=I();a(0,"tr",26),C("click",function(){let i=f(e).$implicit,s=c(2);return g(s.openExceptionDetail(i))}),r()}}function rm(t,d){if(t&1&&(a(0,"div"),T(1,am,1,0,"tr",25),r()),t&2){let e=c();o(),u("matRowDefColumns",e.displayedColumns)}}function sm(t,d){t&1&&A(0,"tr",28)}function lm(t,d){if(t&1&&(a(0,"div"),T(1,sm,1,0,"tr",27),r()),t&2){let e=c();o(),u("matRowDefColumns",e.displayedColumns)}}var dr=(()=>{class t{constructor(e,n,i,s,S){this.authResolver=e,this.dialog=n,this.tableCheckbox=i,this.tableConfigService=s,this.destroyRef=S,this.selectedApplicationResults=new pt,this.updated=new pt,this.selection=new _e(!0,[],!0,([M,R],[N,re])=>M.id===N.id&&R.errorId===re.errorId),this.cachedSelection=new _e(this.selection.isMultipleSelection(),[],!0,this.selection.compareWith),this.pageSizeOptions=Fi,this.clickable=!0,this.displayedColumns=[],this.unfilteredColumns=[],this.tableId="app-application-operation-error-list"}set displayColumns(e){this.unfilteredColumns=e,localStorage.getItem("showIds")!=="true"&&(e=e.filter(n=>n!=="id")),this.displayedColumns=e}set matSort(e){this.sort=e}static getSortDataForColumn(e,n){let i=e[0],s=e[1];switch(n){case"id":return i.id.toString();case"groupId":return i.group?.id.toString()??"";case"groupName":return i.group?.name??"";case"createdAt":return i.createdAt;case"createdBy":return i.user?i.user.lastName?i.user.lastName:i.user.firstName??"":i.createdBy.slice(i.createdBy.lastIndexOf("=")+1,i.createdBy.length);case"error":return s.name;default:return""}}ngOnInit(){this.clickable=this.displayedColumns.includes("error"),this.updateDatasource(),this.selection.changed.subscribe(e=>{this.selectedApplicationResults.emit(e.source.selected)}),this.watchForIdColumnChanges()}updateDatasource(){this.dataSource=new et(this.appErrorPairs),this.dataSource.sort=this.sort,this.dataSource.paginator=this.child.paginator,this.dataSource.sortData=(e,n)=>ki(e,n,t.getSortDataForColumn.bind(this))}isAllSelected(){return this.tableCheckbox.isAllSelected(this.selection.selected.length,this.dataSource)}masterToggle(){this.tableCheckbox.masterToggle(this.isAllSelected(),this.selection,this.cachedSelection,"",this.dataSource,this.sort,this.child.paginator.pageSize,this.child.paginator.pageIndex,!1)}openExceptionDetail(e){let[n,i]=e;if(i.name==="CantBeApprovedException"){let s=F();s.width="600px",s.data={err:i,theme:this.theme,application:n},this.dialog.open(mr,s).afterClosed().subscribe(M=>{M&&(this.appErrorPairs=this.appErrorPairs.filter(([,R])=>R!==i),this.updateDatasource(),this.updated.emit(!0))})}else this.dialog.open(La,{width:"550px",data:{title:i.name,description:i.message,type:"success"},autoFocus:!1})}getExportDataForColumn(e,n){let[i,s]=e;switch(n){case"id":return i.id.toString();case"groupId":return i.group?.id.toString()??"";case"groupName":return i.group?.name??"";case"createdBy":return i.createdBy;case"createdAt":return i.createdAt;case"error":return s.name;default:return aa(i.fedInfo,n)}}exportDisplayedData(e){let n=this.dataSource.paginator.pageIndex*this.dataSource.paginator.pageSize,i=n+this.dataSource.paginator.pageSize;Et(Ot(this.dataSource.sortData(this.dataSource.filteredData,this.dataSource.sort).slice(n,i),this.displayedColumns,(s,S)=>this.getExportDataForColumn(s,S)),e)}exportAllData(e){Et(Ot(this.dataSource.filteredData,this.displayedColumns,(n,i)=>this.getExportDataForColumn(n,i)),e)}toggleRow(e){this.selection.toggle(e),this.cachedSelection.toggle(e)}pageChanged(){this.tableCheckbox.selectCachedDataOnPage(this.dataSource,this.selection,this.cachedSelection,this.selection.compareWith)}watchForIdColumnChanges(){this.tableConfigService.showIdsChanged.pipe(Ne(this.destroyRef)).subscribe(e=>{e?this.displayedColumns=this.unfilteredColumns:this.displayedColumns=this.unfilteredColumns.filter(n=>n!=="id")}),localStorage.getItem("showIds")!=="true"&&(this.displayedColumns=this.displayedColumns.filter(e=>e!=="id"))}static{this.\u0275fac=function(n){return new(n||t)(_(pe),_(Ae),_(Wi),_(Da),_(we))}}static{this.\u0275cmp=x({type:t,selectors:[["app-application-operation-error-list"]],viewQuery:function(n,i){if(n&1&&(Be(mi,7),Be(Ht,7)),n&2){let s;Ve(s=Fe())&&(i.child=s.first),Ve(s=Fe())&&(i.matSort=s.first)}},inputs:{appErrorPairs:"appErrorPairs",theme:"theme",displayColumns:"displayColumns"},outputs:{selectedApplicationResults:"selectedApplicationResults",updated:"updated"},decls:26,vars:13,consts:[[1,"card","mt-3"],[3,"exportDisplayedData","exportAllData","pageChanged","pageSizeOptions","dataLength","tableId"],["mat-table","","matSort","","matSortActive","createdAt","matSortDirection","desc","matSortDisableClear","",1,"w-100",3,"matSortChange","dataSource"],["matColumnDef","checkbox"],["matColumnDef","id"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","groupId"],["mat-header-cell","",4,"matHeaderCellDef"],["matColumnDef","groupName"],["matColumnDef","createdAt"],["matColumnDef","createdBy"],["matColumnDef","error"],["mat-header-row","",4,"matHeaderRowDef"],["mat-header-cell","","class","align-checkbox",4,"matHeaderCellDef"],["class","static-column-size align-checkbox","mat-cell","",4,"matCellDef"],["mat-header-cell","",1,"align-checkbox"],["color","primary",3,"aria-label","checked","indeterminate"],["color","primary",3,"change","aria-label","checked","indeterminate"],["mat-cell","",1,"static-column-size","align-checkbox"],["color","primary",3,"change","click","aria-label","checked"],["mat-header-cell","","mat-sort-header",""],["mat-cell",""],["mat-header-cell",""],["mat-header-row",""],["class","cursor-pointer dark-hover-list-item","mat-row","",3,"click",4,"matRowDef","matRowDefColumns"],["mat-row","",1,"cursor-pointer","dark-hover-list-item",3,"click"],["class","dark-hover-list-item","mat-row","",4,"matRowDef","matRowDefColumns"],["mat-row","",1,"dark-hover-list-item"]],template:function(n,i){if(n&1&&(a(0,"div",0)(1,"perun-web-apps-table-wrapper",1),C("exportDisplayedData",function(S){return i.exportDisplayedData(S)})("exportAllData",function(S){return i.exportAllData(S)})("pageChanged",function(){return i.pageChanged()}),a(2,"table",2),C("matSortChange",function(){return i.pageChanged()}),v(3,zp,3,0,"ng-container",3),l(4,"isAllSelected"),Q(5,4),T(6,qp,3,3,"th",5)(7,$p,2,1,"td",6),Z(),Q(8,7),T(9,Yp,3,3,"th",8)(10,Xp,2,1,"td",6),Z(),Q(11,9),T(12,Kp,3,3,"th",8)(13,Qp,2,1,"td",6),Z(),Q(14,10),T(15,Zp,3,3,"th",5)(16,Jp,3,4,"td",6),Z(),Q(17,11),T(18,em,3,3,"th",5)(19,tm,2,3,"td",6),Z(),Q(20,12),T(21,im,3,3,"th",5)(22,nm,2,1,"td",6),Z(),T(23,om,1,0,"tr",13),v(24,rm,2,1,"div"),v(25,lm,2,1,"div"),r()()()),n&2){let s;o(),u("pageSizeOptions",i.pageSizeOptions)("dataLength",i.dataSource.data.length)("tableId",i.tableId),o(),u("dataSource",i.dataSource),o(),b((s=ke(11,kp,Me(4,8,i.dataSource,i.selection.selected.length)))?3:-1,s),o(20),u("matHeaderRowDef",i.displayedColumns),o(),b(i.clickable?24:-1),o(),b(i.clickable?-1:25)}},dependencies:[D,Pt,wt,mi,vt,mt,ct,ft,ut,dt,gt,_t,ht,Ct,St,yi,Ht,Li,L,Cn,Hi,O,qi,zi],styles:[".cursor-pointer[_ngcontent-%COMP%]{cursor:pointer}"]})}}return t})();var io=t=>({count:t});function pm(t,d){if(t&1&&(a(0,"h3"),m(1),l(2,"translate"),r()),t&2){let e=c();o(),h(" ",Me(2,1,"VO_DETAIL.APPLICATION.ERROR."+e.data.action+"_SINGULAR",ke(4,io,e.applicationFailures.length))," ")}}function mm(t,d){if(t&1&&(a(0,"h3"),m(1),l(2,"translate"),r()),t&2){let e=c();o(),h(" ",Me(2,1,"VO_DETAIL.APPLICATION.ERROR."+e.data.action,ke(4,io,e.applicationFailures.length))," ")}}function dm(t,d){t&1&&(a(0,"perun-web-apps-alert",3),A(1,"i",5),l(2,"translate"),r()),t&2&&(o(),u("innerHTML",p(2,1,"VO_DETAIL.APPLICATION.ERROR.CANT_BE_APPROVED"),kt))}var cr=(()=>{class t{constructor(e,n,i){this.dialogRef=e,this.dialog=n,this.data=i,this.displaySuccess=!1,this.selectedApplicationResults=[],this.cantBeApprovedPresent=!1,this.updated=!1}ngOnInit(){this.applicationFailures=this.data.applicationsResults.filter(([,e])=>e!==null),this.applicationSuccesses=this.data.applicationsResults.filter(([,e])=>e===null),this.displayedColumns=this.data.displayedColumns,this.displayedColumnsSuccess=this.displayedColumns.filter(e=>e!=="error"),this.cantBeApprovedPresent=this.data.applicationsResults.some(e=>e[1].name==="CantBeApprovedException")}onClose(){this.dialogRef.close(this.updated)}onSelectedApplicationResultsChange(e){this.selectedApplicationResults=e}reportBugs(){let e=F();e.width="550px",e.data=this.selectedApplicationResults.length!==1?{bulkIdErrorPairs:this.selectedApplicationResults.map(([n,i])=>[n.id,i]),bulkCall:this.applicationFailures[0][1].call,bulkMessage:"Failed to "+this.data.action.toLowerCase()+" "+this.selectedApplicationResults.length.toString()+" applications with these errors:"}:{error:this.selectedApplicationResults[0][1]},e.autoFocus=!1,this.dialog.open(Oa,e)}static{this.\u0275fac=function(n){return new(n||t)(_(U),_(Ae),_(j))}}static{this.\u0275cmp=x({type:t,selectors:[["app-applications-bulk-operation-failure-dialog"]],decls:20,vars:25,consts:[["mat-dialog-title","",1,"mb-2"],[1,"font-italic","text-muted"],["mat-dialog-content",""],["alert_type","info"],["alert_type","error"],[3,"innerHTML"],[3,"selectedApplicationResults","updated","appErrorPairs","displayColumns","theme"],["mat-dialog-actions","",1,"mb-3","mx-2","flex-row"],["color","primary","mat-flat-button","",1,"me-2","ms-auto",3,"click","disabled"],["mat-stroked-button","",1,"ms-2",3,"click"]],template:function(n,i){n&1&&(a(0,"div")(1,"div",0),v(2,pm,3,6,"h3")(3,mm,3,6,"h3"),a(4,"div",1),m(5),l(6,"translate"),l(7,"translate"),r()(),a(8,"div",2),v(9,dm,3,3,"perun-web-apps-alert",3),a(10,"perun-web-apps-alert",4),A(11,"div",5),l(12,"translate"),r(),a(13,"app-application-operation-error-list",6),C("selectedApplicationResults",function(S){return i.onSelectedApplicationResultsChange(S)})("updated",function(S){return i.updated=S}),r()(),a(14,"div",7)(15,"button",8),C("click",function(){return i.reportBugs()}),m(16),l(17,"translate"),r(),a(18,"button",9),C("click",function(){return i.onClose()}),m(19,"Close"),r()()()),n&2&&(H(i.data.theme),o(2),b(i.applicationFailures.length===1?2:3),o(3),h(" ",i.applicationSuccesses.length===1?Me(6,11,"VO_DETAIL.APPLICATION.SUCCESS."+i.data.action+"_SINGULAR",ke(21,io,i.applicationSuccesses.length)):Me(7,14,"VO_DETAIL.APPLICATION.SUCCESS."+i.data.action,ke(23,io,i.applicationSuccesses.length))," "),o(4),b(i.cantBeApprovedPresent?9:-1),o(2),u("innerHTML",p(12,17,"VO_DETAIL.APPLICATION.ERROR."+i.data.action+"_DESCRIPTION"),kt),o(2),u("appErrorPairs",i.applicationFailures)("displayColumns",i.displayedColumns)("theme",i.data.theme),o(2),u("disabled",i.selectedApplicationResults.length===0),o(),h(" ",p(17,19,"SHARED_LIB.PERUN.COMPONENTS.BUG_REPORT.BULK_TITLE")," "))},dependencies:[D,P,G,K,$,X,Y,be,ve,L,dr,O],encapsulation:2})}}return t})();var cm=()=>[];function um(t,d){if(t&1){let e=I();a(0,"button",16),l(1,"async"),C("click",function(){f(e);let i=c();return g(i.onApprove())}),m(2),l(3,"translate"),r()}if(t&2){let e=c();u("disabled",p(1,2,e.loading$)||!e.canPerformAction.approve),o(2),h(" ",p(3,4,"VO_DETAIL.APPLICATION.APPLICATION_DETAIL.APPROVE")," ")}}function _m(t,d){if(t&1){let e=I();a(0,"button",17),l(1,"async"),C("click",function(){f(e);let i=c();return g(i.onReject())}),m(2),l(3,"translate"),r()}if(t&2){let e=c();u("disabled",p(1,2,e.loading$)||!e.canPerformAction.reject),o(2),h(" ",p(3,4,"VO_DETAIL.APPLICATION.APPLICATION_DETAIL.REJECT")," ")}}function hm(t,d){if(t&1){let e=I();a(0,"button",17),l(1,"async"),C("click",function(){f(e);let i=c();return g(i.onDelete())}),m(2),l(3,"translate"),r()}if(t&2){let e=c();u("disabled",p(1,2,e.loading$)||!e.canPerformAction.delete),o(2),h(" ",p(3,4,"VO_DETAIL.APPLICATION.APPLICATION_DETAIL.DELETE")," ")}}function fm(t,d){if(t&1){let e=I();a(0,"button",18),l(1,"async"),C("click",function(){f(e);let i=c();return g(i.onResend())}),a(2,"i",19),m(3," mail_outline "),r(),m(4),l(5,"translate"),r()}if(t&2){let e=c();u("disabled",p(1,2,e.loading$)||!e.canPerformAction.resend),o(4),h(" ",p(5,4,"VO_DETAIL.APPLICATION.APPLICATION_DETAIL.SEND_NOTIFICATION")," ")}}function gm(t,d){if(t&1){let e=I();a(0,"button",18),C("click",function(){f(e);let i=c();return g(i.viewChanged())}),a(1,"mat-icon"),m(2,"settings"),r()()}if(t&2){let e=c();u("disabled",e.showAllDetails)}}function Cm(t,d){if(t&1){let e=I();a(0,"mat-slide-toggle",12),C("change",function(){f(e);let i=c();return g(i.toggleIncludeGroups())}),m(1),l(2,"translate"),r()}if(t&2){let e=c();u("checked",e.showGroupApps),o(),h(" ",p(2,2,"VO_DETAIL.APPLICATION.SHOW_GROUP_APPLICATIONS")," ")}}function Sm(t,d){if(t&1){let e=I();a(0,"mat-slide-toggle",12),C("change",function(){f(e);let i=c();return g(i.toggleIncludeSubGroups())}),m(1),l(2,"translate"),r()}if(t&2){let e=c();u("checked",e.showSubgroupApps),o(),h(" ",p(2,2,"VO_DETAIL.APPLICATION.SHOW_SUBGROUP_APPLICATIONS")," ")}}function vm(t,d){t&1&&A(0,"perun-web-apps-loading-table")}function bm(t,d){if(t&1){let e=I();a(0,"perun-web-apps-applications-list",20),l(1,"async"),l(2,"async"),C("downloadAll",function(i){f(e);let s=c();return g(s.downloadAll(i))})("queryChanged",function(i){f(e);let s=c();return g(s.nextPage.next(i))}),r()}if(t&2){let e=c();u("loading",p(1,10,e.loading$))("displayColumns",e.currentColumns)("fedColumnsFriendly",e.showAllDetails?ue(14,cm):e.configuredFedColumns)("fedAttrs",e.fedAttrs)("applications",p(2,12,e.applicationsPage$))("filter",e.filterValue)("selection",e.selected)("group",e.group)("cacheSubject",e.cacheSubject)("resetPagination",e.resetPagination)}}var Ji=(()=>{class t{constructor(e,n,i,s,S){this.registrarService=e,this.notificator=n,this.translate=i,this.dialog=s,this.cd=S,this.changeView=new pt,this.refresh=!1,this.tooltipMessages={approve:"",reject:"",delete:"",resend:"",columnSettings:""},this.canPerformAction={approve:!1,reject:!1,delete:!1,resend:!1},this.currentStates=["NEW","VERIFIED"],this.filterValue="",this.startDate=new Te(this.yearAgo()),this.endDate=new Te(new Date),this.showAllDetails=!1,this.showGroupApps=!1,this.showSubgroupApps=!1,this.prependColumns=["checkbox","id"],this.groupPrependColumns=["groupId","groupName"],this.simpleColumns=["createdAt","type","state","createdBy","modifiedBy"],this.bulkOperationFailureColumns=["checkbox","id","createdAt","createdBy","error"],this.bulkOperationFailureGroupColumns=["checkbox","id","groupId","groupName","createdAt","createdBy","error"],this.detailedColumns=["createdAt","type","state","extSourceName","extSourceType","user","createdBy","modifiedBy","modifiedAt","fedInfo"],this.currentColumns=[],this.configuredColumns=[],this.configuredFedColumns=[],this.applications=[],this.nextPage=new ge({}),this.applicationsPage$=this.nextPage.pipe(ui(M=>this.registrarService.getApplicationsPage({vo:this.group?this.group.voId:this.vo.id,query:{pageSize:M.pageSize,offset:M.offset,order:M.order,sortColumn:So(M.sortColumn),searchString:M.searchString,includeGroupApplications:this.showGroupApps,includeSubGroupApplications:this.showSubgroupApps,getDetails:this.showAllDetails,states:this.currentStates,dateFrom:mn(this.startDate.value),dateTo:mn(this.endDate.value),groupId:this.group?.id}})),Ai(M=>{this.applications=M.data,this.selected.clear(),setTimeout(()=>this.loadingSubject$.next(!1),200)}),Nt({data:[],totalCount:0,offset:0,pageSize:0})),this.selected=new _e(!0,[],!0,(M,R)=>M.id===R.id),this.loadingSubject$=new ge(!1),this.cacheSubject=new ge(!0),this.resetPagination=new ge(!1),this.loading$=Wt(this.loadingSubject$,this.nextPage.pipe(Dt(()=>!0))),this.callMap=new Map([["APPROVE","/registrarManager/approveApplications"],["REJECT","/registrarManager/rejectApplications"],["DELETE","/registrarManager/deleteApplications"]])}set viewPreferences(e){e?.value?.length>0?(this.configuredColumns=e.value,this.configuredFedColumns=this.configuredColumns.filter(n=>this.fedAttrs.some(i=>i.friendlyName===n))):(this.configuredColumns=[],this.configuredFedColumns=[]),this.authRights.columnSettings=e?.writable,this.currentColumns=this.setColumns()}ngOnInit(){this.showGroupApps=!!this.group,this.selected.changed.subscribe(()=>this.onSelectedApplicationsChange()),this.onSelectedApplicationsChange(),this.startDate.valueChanges.subscribe(()=>this.refreshTable()),this.endDate.valueChanges.subscribe(()=>this.refreshTable())}refreshTable(){this.resetPagination.next(!0),this.cacheSubject.next(!0),this.nextPage.next(this.nextPage.value)}applyFilter(e){this.filterValue=e,this.refreshTable()}onApprove(){this.openDialog("VO_DETAIL.APPLICATION.DIALOG.APPROVE.TITLE","VO_DETAIL.APPLICATION.DIALOG.APPROVE.DESCRIPTION","VO_DETAIL.APPLICATION.APPLICATION_DETAIL.APPROVE","APPROVE",this.selected.selected,this.currentColumns).afterClosed().subscribe(n=>{n&&(this.loadingSubject$.next(!0),this.registrarService.approveApplications(this.selected.selected.map(i=>i.id)).subscribe({next:i=>{i.some(s=>s.error!==null)?this.errorsInBulkOperation(i,this.selected.selected,"APPROVE"):this.notificator.showInstantSuccess("VO_DETAIL.APPLICATION.SUCCESS.APPROVE_NOTIFICATION"),this.refreshTable()},error:i=>{this.notificator.showRPCError(i),this.refreshTable()}}))})}onReject(){this.openDialog("VO_DETAIL.APPLICATION.DIALOG.REJECT.TITLE","VO_DETAIL.APPLICATION.DIALOG.REJECT.DESCRIPTION","VO_DETAIL.APPLICATION.APPLICATION_DETAIL.REJECT","REJECT",this.selected.selected,this.currentColumns).afterClosed().subscribe(n=>{n&&(this.loadingSubject$.next(!0),this.registrarService.rejectApplications(this.selected.selected.map(i=>i.id)).subscribe({next:i=>{i.some(s=>s.error!==null)?this.errorsInBulkOperation(i,this.selected.selected,"REJECT"):this.notificator.showInstantSuccess("VO_DETAIL.APPLICATION.SUCCESS.REJECT_NOTIFICATION"),this.refreshTable()},error:i=>{this.notificator.showRPCError(i),this.refreshTable()}}))})}onDelete(){this.openDialog("VO_DETAIL.APPLICATION.DIALOG.DELETE.TITLE","VO_DETAIL.APPLICATION.DIALOG.DELETE.DESCRIPTION","VO_DETAIL.APPLICATION.APPLICATION_DETAIL.DELETE","DELETE",this.selected.selected,this.currentColumns).afterClosed().subscribe(n=>{n&&(this.loadingSubject$.next(!0),this.registrarService.deleteApplications(this.selected.selected.map(i=>i.id)).subscribe({next:i=>{i.some(s=>s.error!==null)?this.errorsInBulkOperation(i,this.selected.selected,"DELETE"):this.notificator.showInstantSuccess("VO_DETAIL.APPLICATION.SUCCESS.DELETE_NOTIFICATION"),this.refreshTable()},error:i=>{this.notificator.showRPCError(i),this.refreshTable()}}))})}onResend(){this.openDialog("VO_DETAIL.APPLICATION.DIALOG.RESEND.TITLE","VO_DETAIL.APPLICATION.DIALOG.RESEND.DESCRIPTION","VO_DETAIL.APPLICATION.APPLICATION_DETAIL.SEND_NOTIFICATION","RESEND",this.selected.selected,this.currentColumns).afterClosed().subscribe(n=>{n&&(this.loadingSubject$.next(!0),this.registrarService.sendMessages({ids:this.selected.selected.map(i=>i.id),mailType:n.type,reason:n.reason}).subscribe({next:()=>{this.notificator.showInstantSuccess("VO_DETAIL.APPLICATION.SUCCESS.RESEND"),this.refreshTable()},error:()=>{this.loadingSubject$.next(!1)}}))})}statesChanged(e){this.currentStates=e,this.refreshTable()}viewChanged(){this.changeView.emit()}toggleDetailedView(){this.showAllDetails=!this.showAllDetails,this.currentColumns=this.setColumns(),this.tooltipMessages.columnSettings=this.translate.instant(this.showAllDetails?"VO_DETAIL.APPLICATION.COLUMNS_TOOLTIP":"VO_DETAIL.APPLICATION.SET_COLUMN_SETTINGS")}toggleIncludeGroups(){this.showGroupApps=!this.showGroupApps,this.currentColumns=this.setColumns(),this.refreshTable()}toggleIncludeSubGroups(){this.showSubgroupApps=!this.showSubgroupApps,this.currentColumns=this.setColumns(),this.refreshTable()}onSelectedApplicationsChange(){let e=this.getSelectedState();this.setCanPerform(e),this.setButtonsTooltips(e),this.cd.detectChanges()}downloadAll(e){let n=this.nextPage.getValue();this.registrarService.getApplicationsPage({vo:this.vo?this.vo.id:this.group.voId,query:{order:n.order,pageSize:e.length,offset:0,searchString:n.searchString,sortColumn:So(n.sortColumn),includeGroupApplications:this.showGroupApps,getDetails:this.showAllDetails,states:this.currentStates,dateFrom:mn(this.startDate.value),dateTo:mn(this.endDate.value),groupId:this.group?.id}}).subscribe({next:i=>{oa(Ot(i.data,this.currentColumns,na),this.translate,e.format)}})}errorsInBulkOperation(e,n,i){let s=new Map;e.forEach(N=>{s.set(N.applicationId,N.error)});let S=n.map(N=>[N,this.addCallToException(s.get(N.id),this.callMap.get(i))]),M=n.some(N=>N.group!==null),R=F();R.width="1300px",R.data={theme:this.theme,action:i,applicationsResults:S,displayedColumns:M?this.bulkOperationFailureGroupColumns:this.bulkOperationFailureColumns},this.notificator.showInstantError("VO_DETAIL.APPLICATION.ERROR."+i+"_NOTIFICATION",null,"","VO_DETAIL.APPLICATION.SHOW",()=>{this.dialog.open(cr,R).afterClosed().subscribe(re=>{re&&this.refreshTable()})})}addCallToException(e,n){if(e==null)return null;let i=e;return i.call=n,i}getSelectedState(){if(this.selected.selected.length===0)return null;let e=this.selected.selected[0].state;for(let n of this.selected.selected)if(n.state!==e){e=null;break}return e}setCanPerform(e){this.canPerformAction.approve=e==="NEW"||e==="VERIFIED",this.canPerformAction.reject=e==="NEW"||e==="VERIFIED",this.canPerformAction.delete=e==="NEW"||e==="REJECTED",this.canPerformAction.resend=!!e}setButtonsTooltips(e){if(e)this.tooltipMessages.approve=this.translate.instant(`VO_DETAIL.APPLICATION.TOOLTIPS.APPROVE.${e}`),this.tooltipMessages.reject=this.translate.instant(`VO_DETAIL.APPLICATION.TOOLTIPS.REJECT.${e}`),this.tooltipMessages.delete=this.translate.instant(`VO_DETAIL.APPLICATION.TOOLTIPS.DELETE.${e}`),this.tooltipMessages.resend=this.translate.instant(`VO_DETAIL.APPLICATION.TOOLTIPS.SEND_NOTIFICATION.${e}`);else{let n=this.translate.instant(this.selected.selected.length?"VO_DETAIL.APPLICATION.TOOLTIPS.MULTIPLE_STATUSES_SELECTED":"VO_DETAIL.APPLICATION.TOOLTIPS.NO_APPLICATION_SELECTED");this.tooltipMessages.approve=n,this.tooltipMessages.reject=n,this.tooltipMessages.delete=n,this.tooltipMessages.resend=n}this.tooltipMessages.columnSettings=this.translate.instant(this.showAllDetails?"VO_DETAIL.APPLICATION.COLUMNS_TOOLTIP":"VO_DETAIL.APPLICATION.SET_COLUMN_SETTINGS")}openDialog(e,n,i,s,S,M){let R=M.filter(re=>re!=="checkbox"&&re!=="state"),N=F();return N.width="1300px",N.data={theme:this.theme,title:e,description:n,confirmButtonLabel:i,action:s,selectedApplications:S,displayedColumns:R,allowGroupMailType:!!this.group,fedColumnsFriendly:this.configuredFedColumns,fedAttrs:this.fedAttrs,voId:this.vo?.id,groupId:this.group?.id},this.dialog.open(pr,N)}setColumns(){let e=this.prependColumns;return this.showGroupApps&&(e=this.prependColumns.concat(this.groupPrependColumns)),this.showAllDetails?e.concat(this.detailedColumns):this.configuredColumns.length>0?e.concat(this.configuredColumns):e.concat(this.simpleColumns)}yearAgo(){let e=new Date;return e.setDate(e.getDate()-365),e}static{this.\u0275fac=function(n){return new(n||t)(_(tt),_(q),_(Mt),_(Ae),_(yt))}}static{this.\u0275cmp=x({type:t,selectors:[["app-application-actions"]],inputs:{theme:"theme",vo:"vo",group:"group",authRights:"authRights",tableId:"tableId",detailTableId:"detailTableId",fedAttrs:"fedAttrs",viewPreferences:"viewPreferences"},outputs:{changeView:"changeView"},decls:33,vars:34,consts:[["spinner",""],[1,"page-subtitle"],[1,"action-row"],[3,"refresh"],[3,"matTooltip"],["color","accent","mat-flat-button","",3,"disabled"],["color","warn","mat-flat-button","",3,"disabled"],["mat-stroked-button","",3,"disabled"],[3,"stateChanged"],[3,"filter","placeholder"],[3,"endDate","startDate"],["matTooltipPosition","above",3,"matTooltip"],[3,"change","checked"],[3,"checked"],[1,"position-relative","table-min-height"],[3,"loading","displayColumns","fedColumnsFriendly","fedAttrs","applications","filter","selection","group","cacheSubject","resetPagination","downloadAll","queryChanged",4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],["color","accent","mat-flat-button","",3,"click","disabled"],["color","warn","mat-flat-button","",3,"click","disabled"],["mat-stroked-button","",3,"click","disabled"],[1,"material-icons"],[3,"downloadAll","queryChanged","loading","displayColumns","fedColumnsFriendly","fedAttrs","applications","filter","selection","group","cacheSubject","resetPagination"]],template:function(n,i){if(n&1){let s=I();a(0,"h1",1),m(1),l(2,"translate"),r(),a(3,"div",2)(4,"perun-web-apps-refresh-button",3),C("refresh",function(){return f(s),g(i.refreshTable())}),r(),a(5,"span",4),l(6,"async"),v(7,um,4,6,"button",5),r(),a(8,"span",4),l(9,"async"),v(10,_m,4,6,"button",6),r(),a(11,"span",4),l(12,"async"),v(13,hm,4,6,"button",6),r(),a(14,"span",4),l(15,"async"),v(16,fm,6,6,"button",7),r(),a(17,"perun-web-apps-application-state-selector",8),C("stateChanged",function(M){return f(s),g(i.statesChanged(M))}),r(),a(18,"perun-web-apps-debounce-filter",9),C("filter",function(M){return f(s),g(i.applyFilter(M))}),r(),A(19,"perun-web-apps-date-range",10),a(20,"span",11),v(21,gm,3,1,"button",7),r()(),a(22,"div",2)(23,"mat-slide-toggle",12),C("change",function(){return f(s),g(i.toggleDetailedView())}),m(24),l(25,"translate"),r(),v(26,Cm,3,4,"mat-slide-toggle",13),v(27,Sm,3,4,"mat-slide-toggle",13),r(),T(28,vm,1,0,"ng-template",null,0,B),a(30,"div",14),T(31,bm,3,15,"perun-web-apps-applications-list",15),l(32,"async"),r()}if(n&2){let s=y(29);o(),E(p(2,20,"VO_DETAIL.APPLICATION.TITLE")),o(4),u("matTooltip",p(6,22,i.loading$)&&!i.canPerformAction.approve?i.tooltipMessages.approve:""),o(2),b(i.authRights.approve?7:-1),o(),u("matTooltip",p(9,24,i.loading$)||!i.canPerformAction.reject?i.tooltipMessages.reject:""),o(2),b(i.authRights.reject?10:-1),o(),u("matTooltip",p(12,26,i.loading$)||!i.canPerformAction.delete?i.tooltipMessages.delete:""),o(2),b(i.authRights.delete?13:-1),o(),u("matTooltip",p(15,28,i.loading$)||!i.canPerformAction.resend?i.tooltipMessages.resend:""),o(2),b(i.authRights.resend?16:-1),o(2),u("placeholder","VO_DETAIL.APPLICATION.FILTER"),o(),u("endDate",i.endDate)("startDate",i.startDate),o(),u("matTooltip",i.tooltipMessages.columnSettings),o(),b(i.authRights.columnSettings?21:-1),o(2),u("checked",i.showAllDetails),o(),h(" ",p(25,30,"VO_DETAIL.APPLICATION.SHOW_ALL_DETAILS")," "),o(2),b(i.vo?26:-1),o(),b(i.group?27:-1),o(4),u("perunWebAppsLoader",p(32,32,i.loading$))("perunWebAppsLoaderIndicator",s)}},dependencies:[D,P,G,lt,st,ni,ii,ye,Ze,L,ne,Ya,ka,Ge,zn,V,at,O],styles:[".action-row[_ngcontent-%COMP%]{display:flex;flex-direction:row;flex-wrap:wrap;align-items:center;gap:.5rem;margin-top:1rem;margin-bottom:1rem}"]})}}return t})();var lA=(()=>{class t{static{this.id="VoApplicationsComponent"}constructor(e,n,i,s,S,M){this.entityStorageService=e,this.attributeService=n,this.dialog=i,this.authResolver=s,this.cacheHelperService=S,this.destroyRef=M,this.authRights={approve:!1,reject:!1,delete:!1,resend:!1,columnSettings:!1},this.fedAttrs=[]}ngOnInit(){this.vo=this.entityStorageService.getEntity(),this.setAuthRights(),this.attributeService.getIdpAttributeDefinitions().subscribe(e=>{e.forEach(n=>{this.fedAttrs.includes(n)||this.fedAttrs.push(n),this.viewPreferences$=this.attributeService.getVoAttributeByName(this.vo.id,"urn:perun:vo:attribute-def:def:applicationViewPreferences")})}),this.cacheHelperService.refreshComponentCachedData().pipe(Ne(this.destroyRef)).subscribe(e=>{e===t.id&&this.applicationActions.refreshTable()})}setColumns(){let e=F();e.width="650px",e.data={columns:[],voId:this.vo.id,theme:"vo-theme"},this.dialog.open(to,e).afterClosed().subscribe(i=>{i&&(this.viewPreferences$=this.attributeService.getVoAttributeByName(this.vo.id,"urn:perun:vo:attribute-def:def:applicationViewPreferences"))})}setAuthRights(){this.authRights.approve=this.authResolver.isAuthorized("vo-approveApplicationInternal_int_policy",[this.vo]),this.authRights.reject=this.authResolver.isAuthorized("vo-rejectApplication_int_String_policy",[this.vo]),this.authRights.delete=this.authResolver.isAuthorized("vo-deleteApplication_Application_policy",[this.vo]),this.authRights.resend=this.authResolver.isAuthorized("vo-sendMessage_Application_MailType_String_policy",[this.vo])}static{this.\u0275fac=function(n){return new(n||t)(_(He),_(Tt),_(Ae),_(pe),_(Je),_(we))}}static{this.\u0275cmp=x({type:t,selectors:[["app-vo-applications"]],viewQuery:function(n,i){if(n&1&&Be(Ji,5),n&2){let s;Ve(s=Fe())&&(i.applicationActions=s.first)}},hostVars:2,hostBindings:function(n,i){n&2&&Ee("router-component",i.true)},decls:2,vars:7,consts:[[3,"changeView","theme","vo","authRights","fedAttrs","viewPreferences"]],template:function(n,i){n&1&&(a(0,"app-application-actions",0),l(1,"async"),C("changeView",function(){return i.setColumns()}),r()),n&2&&u("theme","vo-theme")("vo",i.vo)("authRights",i.authRights)("fedAttrs",i.fedAttrs)("viewPreferences",p(1,5,i.viewPreferences$))},dependencies:[D,Ji,at],encapsulation:2})}}return t})();var EA=(()=>{class t{static{this.id="GroupApplicationsComponent"}constructor(e,n,i,s,S,M){this.entityStorageService=e,this.attributeService=n,this.dialog=i,this.authResolver=s,this.cacheHelperService=S,this.destroyRef=M,this.authRights={approve:!1,reject:!1,delete:!1,resend:!1,columnSettings:!1},this.fedAttrs=[]}ngOnInit(){this.group=this.entityStorageService.getEntity(),this.setAuthRights(),this.attributeService.getIdpAttributeDefinitions().subscribe(e=>{e.forEach(n=>{this.fedAttrs.includes(n)||this.fedAttrs.push(n),this.viewPreferences$=this.attributeService.getGroupAttributeByName(this.group.id,"urn:perun:group:attribute-def:def:applicationViewPreferences")})}),this.cacheHelperService.refreshComponentCachedData().pipe(Ne(this.destroyRef)).subscribe(e=>{e===t.id&&this.applicationActions.refreshTable()})}setColumns(){let e=F();e.width="650px",e.data={columns:[],groupId:this.group.id,voId:this.group.voId,theme:"group-theme"},this.dialog.open(to,e).afterClosed().subscribe(i=>{i&&(this.viewPreferences$=this.attributeService.getGroupAttributeByName(this.group.id,"urn:perun:group:attribute-def:def:applicationViewPreferences"))})}setAuthRights(){this.authRights.approve=this.authResolver.isAuthorized("group-approveApplicationInternal_int_policy",[this.group]),this.authRights.reject=this.authResolver.isAuthorized("group-rejectApplication_int_String_policy",[this.group]),this.authRights.delete=this.authResolver.isAuthorized("group-deleteApplication_Application_policy",[this.group]),this.authRights.resend=this.authResolver.isAuthorized("group-sendMessage_Application_MailType_String_policy",[this.group])}static{this.\u0275fac=function(n){return new(n||t)(_(He),_(Tt),_(Ae),_(pe),_(Je),_(we))}}static{this.\u0275cmp=x({type:t,selectors:[["app-group-applications"]],viewQuery:function(n,i){if(n&1&&Be(Ji,5),n&2){let s;Ve(s=Fe())&&(i.applicationActions=s.first)}},hostVars:2,hostBindings:function(n,i){n&2&&Ee("router-component",i.true)},decls:2,vars:7,consts:[[3,"changeView","theme","group","authRights","fedAttrs","viewPreferences"]],template:function(n,i){n&1&&(a(0,"app-application-actions",0),l(1,"async"),C("changeView",function(){return i.setColumns()}),r()),n&2&&u("theme","group-theme")("group",i.group)("authRights",i.authRights)("fedAttrs",i.fedAttrs)("viewPreferences",p(1,5,i.viewPreferences$))},dependencies:[D,Ji,at],encapsulation:2})}}return t})();var ur=(()=>{class t{constructor(e,n,i,s,S,M,R,N,re,xe,Bt){this.data=e,this.dialogRef=n,this.membersManagerService=i,this.voService=s,this.registrarManager=S,this.groupService=M,this.store=R,this.guiAuthResolver=N,this.requestService=re,this.addMemberService=xe,this.notificator=Bt,this.loading=!1,this.searcher=new ci,this.members=this.searcher.pipe(ui(di=>Wt(Zt(null),this.voService.getCompleteCandidatesForGroup(this.data.group.id,this.attrNames,di))),Nt(void 0)),this.failed=[],this.selection=new _e(!0,[],!0,(di,Ti)=>di.richUser?.id===Ti.richUser?.id&&di.member?.id===Ti.member?.id),this.cachedSubject=new ge(!0),this.attrNames=[k.USER_DEF_ORGANIZATION,k.USER_DEF_PREFERRED_MAIL].concat(this.store.getLoginAttributeNames()),this.languages=this.store.getProperty("supported_languages"),this.addMemberService.setDialogRef(this.dialogRef),this.addMemberService.setType("group")}ngOnInit(){this.inviteAuth=this.guiAuthResolver.isAuthorized("group-sendInvitation_Vo_Group_User_policy",[this.data.group]),this.selection.changed.subscribe(e=>{e.source.selected.every(n=>n.member)?this.addAuth=!0:this.addAuth=this.guiAuthResolver.isAuthorized("createMember_Vo_User_List<Group>_policy",[this.data.group])&&this.guiAuthResolver.isAuthorized("createMember_Vo_Candidate_List<Group>_policy",[this.data.group])}),this.registrarManager.invitationFormExists(this.data.group.voId,this.data.group.id).subscribe(e=>{this.showInvite=e})}add(){this.loading=!0,this.membersManagerService.addMemberCandidates({candidates:this.addMemberService.convertToMemberCandidates(this.selection.selected),vo:this.data.group.voId,group:this.data.group.id}).subscribe({next:()=>{this.addMemberService.success("DIALOGS.ADD_MEMBERS.SUCCESS_ADD")},error:e=>{this.loading=!1,this.notificator.showRPCError(e)}})}invite(e){this.loading=!0,this.registrarManager.inviteMemberCandidates({candidates:this.addMemberService.convertToMemberCandidates(this.selection.selected),vo:this.data.group.voId,lang:e,group:this.data.group.id}).subscribe({next:()=>{this.addMemberService.success("DIALOGS.ADD_MEMBERS.SUCCESS_INVITE")},error:n=>{this.loading=!1,this.notificator.showRPCError(n)}})}cancel(e){this.dialogRef.close(e)}static{this.\u0275fac=function(n){return new(n||t)(_(j),_(U),_(Qe),_(Vt),_(tt),_(De),_(Le),_(pe),_(xt),_(Zi),_(q))}}static{this.\u0275cmp=x({type:t,selectors:[["app-group-add-member-dialog"]],decls:2,vars:13,consts:[[3,"add","cancelled","invite","search","showInvite","loading","languages","manualAddingBlocked","addAuth","inviteAuth","failed","members","selection","cachedSubject","theme"]],template:function(n,i){n&1&&(a(0,"app-add-member-dialog",0),l(1,"async"),C("add",function(){return i.add()})("cancelled",function(S){return i.cancel(S)})("invite",function(S){return i.invite(S)})("search",function(S){return i.searcher.next(S)}),r()),n&2&&u("showInvite",i.showInvite)("loading",i.loading)("languages",i.languages)("manualAddingBlocked",i.data.manualAddingBlocked)("addAuth",i.addAuth)("inviteAuth",i.inviteAuth)("failed",i.failed)("members",p(1,11,i.members))("selection",i.selection)("cachedSubject",i.cachedSubject)("theme","group-theme")},dependencies:[D,Jn,at],encapsulation:2})}}return t})();var Em=()=>["select","id","name","description"];function Im(t,d){t&1&&A(0,"perun-web-apps-loading-dialog")}function Tm(t,d){if(t&1){let e=I();a(0,"div")(1,"h1",2),m(2),l(3,"translate"),r(),a(4,"div",3)(5,"mat-radio-group",4),te("ngModelChange",function(i){f(e);let s=c();return ee(s.copyType,i)||(s.copyType=i),g(i)}),a(6,"span",5),l(7,"translate"),a(8,"mat-radio-button",6),m(9),l(10,"translate"),r()(),a(11,"mat-radio-button",7),m(12),l(13,"translate"),r()(),a(14,"perun-web-apps-alert",8),m(15),l(16,"translate"),r(),a(17,"h5",9),m(18),l(19,"translate"),r(),a(20,"perun-web-apps-debounce-filter",10),C("filter",function(i){f(e);let s=c();return g(s.applyFilter(i))}),r(),A(21,"perun-web-apps-groups-list",11),r(),a(22,"div",12)(23,"button",13),C("click",function(){f(e);let i=c();return g(i.onCancel())}),m(24),l(25,"translate"),r(),a(26,"button",14),C("click",function(){f(e);let i=c();return g(i.onSubmit())}),m(27),l(28,"translate"),r()()()}if(t&2){let e=c();o(2),E(p(3,20,"DIALOGS.COPY_MEMBERS.TITLE")),o(3),J("ngModel",e.copyType),o(),u("matTooltip",w(p(7,22,"DIALOGS.COPY_MEMBERS.DISABLED_COPY_SELECTION")))("matTooltipDisabled",e.data.members.length>0),o(2),u("disabled",e.data.members.length===0),o(),h(" ",p(10,24,"DIALOGS.COPY_MEMBERS.COPY_SELECTION")," "),o(3),h(" ",p(13,26,"DIALOGS.COPY_MEMBERS.COPY_ALL")," "),o(3),h(" ",p(16,28,"DIALOGS.COPY_MEMBERS.ATTRIBUTES_WARN")," "),o(3),E(p(19,30,"DIALOGS.COPY_MEMBERS.SELECT_GROUPS")),o(2),u("placeholder","SHARED_LIB.PERUN.COMPONENTS.RESOURCES_LIST.TABLE_SEARCH"),o(),u("loading",e.loading)("groups",e.assignableGroups)("selection",e.selection)("disableRouting",!0)("displayColumns",ue(36,Em))("filter",e.filterValue),o(3),h(" ",p(25,32,"DIALOGS.COPY_MEMBERS.CANCEL")," "),o(2),u("disabled",e.loading||e.selection.isEmpty()),o(),h(" ",p(28,34,"DIALOGS.COPY_MEMBERS.COPY")," ")}}var _r=(()=>{class t{constructor(e,n,i,s,S,M){this.dialogRef=e,this.data=n,this.groupsService=i,this.guiAuthResolver=s,this.translate=S,this.notificator=M,this.loading=!1,this.copyType="all",this.filterValue="",this.assignableGroups=[],this.selection=new _e(!0,[],!0,(R,N)=>R.id===N.id),this.groupAttrNames=[k.GROUP_SYNC_ENABLED,k.GROUP_BLOCK_MANUAL_MEMBER_ADDING]}ngOnInit(){this.loading=!0,this.data.members.length>0&&(this.copyType="selection"),this.groupsService.getAllRichGroupsWithAttributesByNames(this.data.voId,this.groupAttrNames).subscribe(e=>{this.assignableGroups=this.filterAssignableGroups(e),this.loading=!1})}onCancel(){this.dialogRef.close()}onSubmit(){this.loading=!0;let e=this.copyType==="selection"?this.data.members.map(n=>n.id):[];this.groupsService.copyMembers(this.data.groupId,this.selection.selected.map(n=>n.id),e).subscribe({next:()=>{this.notificator.showSuccess(this.translate.instant("DIALOGS.COPY_MEMBERS.SUCCESS")),this.dialogRef.close(!0)},error:()=>{this.notificator.showError(this.translate.instant("DIALOGS.COPY_MEMBERS.ERROR")),this.loading=!1}})}applyFilter(e){this.filterValue=e,this.selection.clear()}filterAssignableGroups(e){let n=[];for(let i of e)i.name!=="members"&&i.id!==this.data.groupId&&!(Ui(i)||ln(i.attributes,k.GROUP_BLOCK_MANUAL_MEMBER_ADDING))&&this.guiAuthResolver.isAuthorized("dest-copyMembers_Group_List<Group>_List<Member>_boolean_policy",[i])&&n.push(i);return n}static{this.\u0275fac=function(n){return new(n||t)(_(U),_(j),_(De),_(pe),_(Mt),_(q))}}static{this.\u0275cmp=x({type:t,selectors:[["app-copy-members-dialog"]],decls:4,vars:5,consts:[["spinner",""],[4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],["mat-dialog-title",""],["mat-dialog-content","",1,"dialog-container"],[1,"flex-container",3,"ngModelChange","ngModel"],["matTooltipPosition","above",3,"matTooltip","matTooltipDisabled"],["value","selection",3,"disabled"],["value","all"],["alert_type","warn",1,"mt-4"],[1,"mt-4"],[3,"filter","placeholder"],[3,"loading","groups","selection","disableRouting","displayColumns","filter"],["mat-dialog-actions",""],["mat-stroked-button","",1,"ms-auto",3,"click"],["color","accent","mat-flat-button","",1,"ms-2",3,"click","disabled"]],template:function(n,i){if(n&1&&(T(0,Im,1,0,"ng-template",null,0,B),a(2,"div"),T(3,Tm,29,37,"div",1),r()),n&2){let s=y(1);o(2),H(W("",i.data.theme," position-relative")),o(),u("perunWebAppsLoader",i.loading)("perunWebAppsLoaderIndicator",s)}},dependencies:[D,P,G,ri,oi,ai,je,se,Ue,le,K,$,X,Y,be,ve,oe,ye,L,ne,Gt,V,O],styles:[".flex-container[_ngcontent-%COMP%]{display:flex;flex-direction:column}"]})}}return t})();function Mm(t,d){t&1&&A(0,"perun-web-apps-loading-dialog")}function xm(t,d){t&1&&(a(0,"mat-error"),m(1),l(2,"translate"),r()),t&2&&(o(),h(" ",p(2,1,"DIALOGS.INVITE_PREAPPROVED_MEMBER.NAME_ERROR")," "))}function Dm(t,d){t&1&&(a(0,"mat-error"),m(1),l(2,"translate"),r()),t&2&&(o(),h(" ",p(2,1,"DIALOGS.INVITE_PREAPPROVED_MEMBER.EMAIL_ERROR")," "))}function Rm(t,d){if(t&1&&(a(0,"mat-option",14),m(1),l(2,"uppercase"),l(3,"translate"),r()),t&2){let e=d.$implicit;u("value",w(e)),o(),E(p(3,5,p(2,3,"SHARED_LIB.LANGUAGES."+e)))}}function Om(t,d){if(t&1){let e=I();a(0,"div")(1,"h1",3),m(2),l(3,"translate"),r(),a(4,"div",4)(5,"div",5),m(6),l(7,"translate"),r(),a(8,"mat-form-field",6)(9,"mat-label"),m(10),l(11,"translate"),r(),A(12,"input",7),v(13,xm,3,3,"mat-error"),r(),a(14,"mat-form-field",6)(15,"mat-label"),m(16),l(17,"translate"),r(),A(18,"textarea",7),v(19,Dm,3,3,"mat-error"),r(),a(20,"mat-form-field",8),C("click",function(){f(e);let i=y(27);return g(i.open())}),a(21,"mat-label"),m(22),l(23,"translate"),r(),A(24,"input",9)(25,"mat-datepicker-toggle",10)(26,"mat-datepicker",11,1),r(),a(28,"mat-form-field",6)(29,"mat-label"),m(30),l(31,"translate"),r(),A(32,"input",12),l(33,"translate"),r(),a(34,"mat-form-field",6)(35,"mat-label"),m(36),l(37,"translate"),r(),a(38,"mat-select",13),te("valueChange",function(i){f(e);let s=c();return ee(s.currentLanguage,i)||(s.currentLanguage=i),g(i)}),de(39,Rm,4,7,"mat-option",14,Ce),r()()(),a(41,"div",15)(42,"button",16),C("click",function(){f(e);let i=c();return g(i.onCancel())}),m(43),l(44,"translate"),r(),a(45,"span",17),l(46,"translate"),a(47,"button",18),C("click",function(){f(e);let i=c();return g(i.onSubmit())}),m(48),l(49,"translate"),r()()()()}if(t&2){let e=y(27),n=c();o(2),E(p(3,28,"DIALOGS.INVITE_PREAPPROVED_MEMBER.TITLE")),o(4),h(" ",p(7,30,"DIALOGS.INVITE_PREAPPROVED_MEMBER.DESCRIPTION")," "),o(4),E(p(11,32,"DIALOGS.INVITE_PREAPPROVED_MEMBER.NAME")),o(2),u("formControl",n.name),o(),b(n.name.invalid?13:-1),o(3),E(p(17,34,"DIALOGS.INVITE_PREAPPROVED_MEMBER.EMAIL")),o(2),u("formControl",n.emailForm),o(),b(n.emailForm.invalid?19:-1),o(3),E(p(23,36,"DIALOGS.INVITE_PREAPPROVED_MEMBER.EXPIRE_DATE")),o(2),u("min",n.minDate)("max",n.maxDate)("formControl",n.expirationControl)("matDatepicker",e),o(),u("for",e)("disabled",!1),o(),u("disabled",!1),o(4),E(p(31,38,"DIALOGS.INVITE_PREAPPROVED_MEMBER.REDIRECT_URL")),o(2),u("placeholder",w(p(33,40,"DIALOGS.INVITE_PREAPPROVED_MEMBER.REDIRECT_URL_PLACEHOLDER")))("formControl",n.url),o(4),E(p(37,42,"DIALOGS.INVITE_PREAPPROVED_MEMBER.LANGUAGE")),o(2),J("value",n.currentLanguage),o(),ce(n.languages),o(4),h(" ",p(44,44,"DIALOGS.INVITE_PREAPPROVED_MEMBER.CANCEL")," "),o(2),u("matTooltip",w(p(46,46,"DIALOGS.INVITE_PREAPPROVED_MEMBER.DISABLED_TOOLTIP")))("matTooltipDisabled",!(n.emailForm.invalid||n.name.invalid||n.loading)),o(2),u("disabled",n.emailForm.invalid||n.name.invalid||n.loading),o(),h(" ",p(49,48,"DIALOGS.INVITE_PREAPPROVED_MEMBER.INVITE")," ")}}var hr=(()=>{class t{constructor(e,n,i,s,S,M){this.dialogRef=e,this.data=n,this.invitationsManager=i,this.notificator=s,this.translate=S,this.store=M,this.emailForm=new Te("",[he.required,he.pattern(Kt).bind(this)]),this.languages=["en"],this.currentLanguage="en",this.name=new Te("",he.required),this.loading=!1,this.expirationControl=new Te(null),this.url=new Te(null)}ngOnInit(){this.languages=this.store.getProperty("supported_languages"),this.theme=this.data.theme,this.minDate=new Date,this.minDate.setDate(this.minDate.getDate()+1),this.maxDate=new Date,this.maxDate.setFullYear(this.maxDate.getFullYear()+1);let e=new Date;e.setMonth(e.getMonth()+1),this.expirationControl.setValue(e)}onCancel(){this.dialogRef.close(!1)}onSubmit(){this.emailForm.invalid||this.name.invalid||(this.loading=!0,this.invitationsManager.inviteToGroup(this.data.voId,this.data.groupId,this.name.value,this.emailForm.value,this.currentLanguage,xi(this.expirationControl.value,"yyyy-MM-dd","en-GB"),this.url.value).subscribe({next:()=>{this.translate.get("DIALOGS.INVITE_PREAPPROVED_MEMBER.SUCCESS").subscribe(e=>{this.notificator.showSuccess(e),this.dialogRef.close(!0)})},error:()=>this.loading=!1}))}static{this.\u0275fac=function(n){return new(n||t)(_(U),_(j),_(En),_(q),_(Se),_(Le))}}static{this.\u0275cmp=x({type:t,selectors:[["app-invite-preapproved-member-dialog"]],decls:4,vars:5,consts:[["spinner",""],["picker",""],[4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],["mat-dialog-title",""],["mat-dialog-content",""],[1,"font-italic"],[1,"w-100"],["matInput","","required","",3,"formControl"],["color","primary",1,"cursor-pointer","w-100",3,"click"],["readonly","","matInput","",1,"disable",3,"min","max","formControl","matDatepicker"],["matSuffix","",3,"for","disabled"],[3,"disabled"],["matInput","",3,"placeholder","formControl"],[3,"valueChange","value"],[3,"value"],["mat-dialog-actions",""],["mat-stroked-button","",1,"ms-auto",3,"click"],[3,"matTooltipDisabled","matTooltip"],["color","accent","mat-flat-button","",1,"ms-2",3,"click","disabled"]],template:function(n,i){if(n&1&&(T(0,Mm,1,0,"ng-template",null,0,B),a(2,"div"),T(3,Om,50,50,"div",2),r()),n&2){let s=y(1);o(2),H(W("",i.theme," position-relative")),o(),u("perunWebAppsLoader",i.loading)("perunWebAppsLoaderIndicator",s)}},dependencies:[D,P,G,Oe,Re,Pe,rt,wi,Ke,Xe,Ye,$e,We,le,ze,se,It,qe,Dn,An,Mn,xn,K,$,X,Y,oe,L,ne,V,At,O],encapsulation:2})}}return t})();function Lm(t,d){t&1&&A(0,"perun-web-apps-loading-dialog")}function ym(t,d){if(t&1&&(a(0,"mat-option",17),m(1),l(2,"uppercase"),l(3,"translate"),r()),t&2){let e=d.$implicit;u("value",w(e)),o(),h(" ",p(3,5,p(2,3,"SHARED_LIB.LANGUAGES."+e))," ")}}function wm(t,d){t&1&&(a(0,"mat-error"),m(1),l(2,"translate"),r()),t&2&&(o(),h(" ",p(2,1,"DIALOGS.BULK_INVITE_PREAPPROVED_MEMBERS.NAMES_ERROR")," "))}function Pm(t,d){if(t&1&&(a(0,"mat-error"),m(1),l(2,"translate"),r()),t&2){let e=c(3);o(),ot(" ",p(2,2,"DIALOGS.BULK_INVITE_PREAPPROVED_MEMBERS.ERROR_FORMAT"),": ",e.invitedMembers.getError("invalidFormat").value," ")}}function Gm(t,d){if(t&1&&(a(0,"mat-error"),m(1),l(2,"translate"),r()),t&2){let e=c(3);o(),ot(" ",p(2,2,"DIALOGS.BULK_INVITE_PREAPPROVED_MEMBERS.ERROR_EMAIL"),": ",e.invitedMembers.getError("invalidEmail").value," ")}}function Nm(t,d){if(t&1&&(a(0,"mat-error"),m(1),l(2,"translate"),r()),t&2){let e=c(3);o(),ot(" ",p(2,2,"DIALOGS.BULK_INVITE_PREAPPROVED_MEMBERS.ERROR_NAME"),": ",e.invitedMembers.getError("invalidName").value," ")}}function Bm(t,d){if(t&1){let e=I();a(0,"div")(1,"div",8),m(2),l(3,"translate"),r(),a(4,"mat-form-field",9),C("click",function(){f(e);let i=y(11);return g(i.open())}),a(5,"mat-label"),m(6),l(7,"translate"),r(),A(8,"input",10)(9,"mat-datepicker-toggle",11)(10,"mat-datepicker",12,1),r(),a(12,"mat-form-field",13),A(13,"input",14),l(14,"translate"),r(),a(15,"mat-form-field",15)(16,"mat-label"),m(17),l(18,"translate"),r(),a(19,"mat-select",16),te("valueChange",function(i){f(e);let s=c(2);return ee(s.currentLanguage,i)||(s.currentLanguage=i),g(i)}),de(20,ym,4,7,"mat-option",17,Ce),r()(),A(22,"p",18),l(23,"translate"),a(24,"mat-form-field",19)(25,"mat-label"),m(26),l(27,"translate"),r(),a(28,"textarea",20),l(29,"translate"),m(30,"            "),r(),v(31,wm,3,3,"mat-error"),v(32,Pm,3,4,"mat-error"),v(33,Gm,3,4,"mat-error"),v(34,Nm,3,4,"mat-error"),r()()}if(t&2){let e=y(11),n=c(2);o(2),h(" ",p(3,23,"DIALOGS.BULK_INVITE_PREAPPROVED_MEMBERS.DESCRIPTION")," "),o(4),E(p(7,25,"DIALOGS.CHANGE_EXPIRATION.DATE_LABEL")),o(2),u("min",n.minDate)("max",null)("formControl",n.expirationControl)("matDatepicker",e),o(),u("for",e)("disabled",!1),o(),u("disabled",!1),o(3),u("placeholder",w(p(14,27,"DIALOGS.BULK_INVITE_PREAPPROVED_MEMBERS.REDIRECT_URL")))("formControl",n.url),o(4),E(p(18,29,"DIALOGS.BULK_INVITE_PREAPPROVED_MEMBERS.LANGUAGE")),o(2),J("value",n.currentLanguage),o(),ce(n.languages),o(2),u("innerHTML",p(23,31,"DIALOGS.BULK_INVITE_PREAPPROVED_MEMBERS.HINT"),kt),o(4),E(p(27,33,"DIALOGS.BULK_INVITE_PREAPPROVED_MEMBERS.INSERT_HERE")),o(2),u("placeholder",w(p(29,35,"DIALOGS.BULK_INVITE_PREAPPROVED_MEMBERS.PLACEHOLDER")))("formControl",n.invitedMembers),o(3),b(n.invitedMembers.hasError("required")?31:-1),o(),b(n.invitedMembers.hasError("invalidFormat")?32:-1),o(),b(n.invitedMembers.hasError("invalidEmail")?33:-1),o(),b(n.invitedMembers.hasError("invalidName")?34:-1)}}function Vm(t,d){t&1&&(a(0,"perun-web-apps-alert",21),m(1),l(2,"translate"),r()),t&2&&(u("alert_type","success"),o(),h(" ",p(2,2,"DIALOGS.BULK_INVITE_PREAPPROVED_MEMBERS.SUCCESS")," "))}function Fm(t,d){t&1&&(a(0,"perun-web-apps-alert",21),m(1),l(2,"translate"),r()),t&2&&(u("alert_type","warn"),o(),h(" ",p(2,2,"DIALOGS.BULK_INVITE_PREAPPROVED_MEMBERS.FINISHED_WITH_ERRORS")," "))}function km(t,d){if(t&1&&(a(0,"div"),v(1,Vm,3,4,"perun-web-apps-alert",21),v(2,Fm,3,4,"perun-web-apps-alert",21),r()),t&2){let e=c(2);o(),b(e.finishedWithErrors?-1:1),o(),b(e.finishedWithErrors?2:-1)}}function Um(t,d){if(t&1){let e=I();a(0,"button",22),C("click",function(){f(e);let i=c(2);return g(i.onSubmit())}),m(1),l(2,"translate"),r()}if(t&2){let e=c(2);u("disabled",e.loading||e.invitedMembers.invalid),o(),h(" ",p(2,2,"DIALOGS.BULK_INVITE_PREAPPROVED_MEMBERS.INVITE")," ")}}function jm(t,d){if(t&1){let e=I();a(0,"button",22),C("click",function(){f(e);let i=c(2);return g(i.downloadCsv())}),m(1),l(2,"translate"),r()}if(t&2){let e=c(2);u("disabled",!e.resultData),o(),h(" ",p(2,2,"DIALOGS.BULK_INVITE_PREAPPROVED_MEMBERS.DOWNLOAD_CSV")," ")}}function Wm(t,d){if(t&1){let e=I();a(0,"div")(1,"h1",3),m(2),l(3,"translate"),r(),a(4,"div",4),v(5,Bm,35,37,"div"),r(),v(6,km,3,2,"div"),a(7,"div",5)(8,"button",6),C("click",function(){f(e);let i=c();return g(i.onCancel())}),m(9),l(10,"translate"),r(),v(11,Um,3,4,"button",7),v(12,jm,3,4,"button",7),r()()}if(t&2){let e=c();o(2),E(p(3,6,"DIALOGS.BULK_INVITE_PREAPPROVED_MEMBERS.TITLE")),o(3),b(e.state==="input"?5:-1),o(),b(e.state==="results"?6:-1),o(3),h(" ",p(10,8,"DIALOGS.BULK_INVITE_PREAPPROVED_MEMBERS.CANCEL")," "),o(2),b(e.state==="input"?11:-1),o(),b(e.state==="results"?12:-1)}}var fr=(()=>{class t{constructor(e,n,i,s){this.dialogRef=e,this.data=n,this.store=i,this.invitationsManager=s,this.invitedMembers=new Te("",[he.required,this.userInputValidator()]),this.languages=this.store.getProperty("supported_languages"),this.currentLanguage="en",this.loading=!1,this.state="input",this.expirationControl=new Te(null),this.url=new Te(null)}static didSomeInviteFail(e){for(let n in e)if(e[n]!=="OK")return!0;return!1}ngOnInit(){this.minDate=new Date,this.minDate.setDate(this.minDate.getDate()+1);let e=new Date;e.setMonth(e.getMonth()+1),this.expirationControl.setValue(e)}onCancel(){this.dialogRef.close(!1)}onSubmit(){this.loading=!0;let e=this.invitedMembers.value.split(`
`),n=[];for(let s of e)n.push(this.parseMemberLine(s));let i={invitationData:n,vo:this.data.voId,group:this.data.groupId,expiration:xi(this.expirationControl.value,"yyyy-MM-dd","en-GB"),language:this.currentLanguage,redirectUrl:this.url.value};this.invitationsManager.inviteToGroupFromCsv(i).subscribe({next:s=>{this.state="results",this.finishedWithErrors=t.didSomeInviteFail(s),this.resultData=s,this.loading=!1},error:()=>{this.loading=!1}})}downloadCsv(){Et(this.generateOutputData(this.resultData),"csv","member-invites")}generateOutputData(e){let n=[];for(let i in e)n.push({email:i,status:e[i]});return n}parseMemberLine(e){let n=e.trim();if(n==="")return"";let i=n.split(";");if(i.length!==2)return"format";if(!i[0].trim().match(Kt))return"email";if(i[1].trim().length===0)return"name";let s="";for(let S of i)s+=S.trim()+";";return s.slice(0,-1)}userInputValidator(){return e=>{let n=e.value.split(`
`);for(let i of n){let s=this.parseMemberLine(i),S=i;if(i.length>25&&(S=i.substring(0,25)+"..."),s==="format")return{invalidFormat:{value:S}};if(s==="email")return{invalidEmail:{value:S}};if(s==="name")return{invalidName:{value:S}}}return null}}static{this.\u0275fac=function(n){return new(n||t)(_(U),_(j),_(Le),_(En))}}static{this.\u0275cmp=x({type:t,selectors:[["app-bulk-invite-preapproved-members-dialog"]],decls:4,vars:5,consts:[["spinner",""],["picker",""],[4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],["mat-dialog-title",""],["mat-dialog-content","",1,"dialog-container"],["mat-dialog-actions",""],["mat-stroked-button","",1,"ms-auto",3,"click"],["color","accent","mat-flat-button","",1,"ms-2",3,"disabled"],[1,"font-italic"],["color","primary",1,"cursor-pointer","w-100",3,"click"],["readonly","","matInput","",1,"disable",3,"min","max","formControl","matDatepicker"],["matSuffix","",3,"for","disabled"],[3,"disabled"],[1,"w-100"],["matInput","",3,"placeholder","formControl"],[1,"w-100","pt-2"],[3,"valueChange","value"],[3,"value"],[3,"innerHTML"],[1,"pt-2","flex-container"],["cols","50","required","","matInput","","rows","8",1,"md-textarea","form-control",3,"formControl","placeholder"],[3,"alert_type"],["color","accent","mat-flat-button","",1,"ms-2",3,"click","disabled"]],template:function(n,i){if(n&1&&(T(0,Lm,1,0,"ng-template",null,0,B),a(2,"div"),T(3,Wm,13,10,"div",2),r()),n&2){let s=y(1);o(2),H(W("",i.data.theme," position-relative")),o(),u("perunWebAppsLoader",i.loading)("perunWebAppsLoaderIndicator",s)}},dependencies:[D,P,G,Oe,Re,Pe,rt,wi,Ke,Xe,Ye,$e,We,le,ze,se,It,qe,Dn,An,Mn,xn,K,$,X,Y,be,ve,oe,L,V,At,O],styles:[".flex-container[_ngcontent-%COMP%]{display:flex;flex-direction:column}"]})}}return t})();function Hm(t,d){t&1&&(a(0,"perun-web-apps-alert",3),m(1),l(2,"translate"),r()),t&2&&(o(),h(" ",p(2,1,"GROUP_DETAIL.MEMBERS.ACTIONS_DISABLED")," "))}function zm(t,d){if(t&1){let e=I();a(0,"button",19),l(1,"groupMembersActionButtonDisabled"),C("click",function(){f(e);let i=c();return g(i.onAddMember())}),m(2),l(3,"translate"),r()}if(t&2){let e=c();u("disabled",Me(1,2,e.group,"add")),o(2),h(" ",p(3,5,"GROUP_DETAIL.MEMBERS.ADD_MEMBER")," ")}}function qm(t,d){if(t&1&&(a(0,"button",8),l(1,"groupMembersActionButtonDisabled"),m(2),l(3,"translate"),r()),t&2){let e=c(),n=y(18);u("disabled",p(1,3,e.group)||e.inviteDisabled&&e.preApprovedInviteDisabled)("matMenuTriggerFor",n),o(2),h(" ",p(3,5,"GROUP_DETAIL.MEMBERS.INVITE")," ")}}function $m(t,d){if(t&1){let e=I();a(0,"button",20),l(1,"groupMembersActionButtonDisabled"),C("click",function(){f(e);let i=c();return g(i.onInviteMember())}),m(2),l(3,"translate"),r()}if(t&2){let e=c();u("disabled",p(1,2,e.group)||e.inviteDisabled),o(2),h(" ",p(3,4,"GROUP_DETAIL.MEMBERS.INVITE_ONE")," ")}}function Ym(t,d){if(t&1){let e=I();a(0,"button",20),l(1,"groupMembersActionButtonDisabled"),C("click",function(){f(e);let i=c();return g(i.onInvitePreapprovedMember())}),m(2),l(3,"translate"),r()}if(t&2){let e=c();u("disabled",p(1,2,e.group)||e.preApprovedInviteDisabled),o(2),h(" ",p(3,4,"GROUP_DETAIL.MEMBERS.INVITE_ONE_PREAPPROVED")," ")}}function Xm(t,d){if(t&1){let e=I();a(0,"button",20),l(1,"groupMembersActionButtonDisabled"),C("click",function(){f(e);let i=c();return g(i.onBulkInvite())}),m(2),l(3,"translate"),r()}if(t&2){let e=c();u("disabled",p(1,2,e.group)||e.inviteDisabled),o(2),h(" ",p(3,4,"GROUP_DETAIL.MEMBERS.INVITE_BULK")," ")}}function Km(t,d){if(t&1){let e=I();a(0,"button",20),l(1,"groupMembersActionButtonDisabled"),C("click",function(){f(e);let i=c();return g(i.onBulkPreapprovedInvite())}),m(2),l(3,"translate"),r()}if(t&2){let e=c();u("disabled",p(1,2,e.group)||e.preApprovedInviteDisabled),o(2),h(" ",p(3,4,"GROUP_DETAIL.MEMBERS.INVITE_BULK_PREAPPROVED")," ")}}function Qm(t,d){if(t&1){let e=I();a(0,"button",21),l(1,"groupMembersActionButtonDisabled"),C("click",function(){f(e);let i=c();return g(i.copyInvitationLink())}),a(2,"mat-icon"),m(3,"file_copy"),r(),a(4,"span",22),m(5),l(6,"translate"),r()()}if(t&2){let e=c();u("disabled",p(1,2,e.group)||e.copyInvitationDisabled),o(5),h(" ",p(6,4,"GROUP_DETAIL.MEMBERS.COPY_INVITATION_LINK")," ")}}function Zm(t,d){if(t&1){let e=I();a(0,"button",23),C("click",function(){f(e);let i=c();return g(i.onCopyMembers())}),m(1),l(2,"translate"),r()}if(t&2){let e=c();u("disabled",e.copyDisabled),o(),h(" ",p(2,2,"GROUP_DETAIL.MEMBERS.COPY_MEMBERS")," ")}}function Jm(t,d){if(t&1){let e=I();a(0,"button",24),l(1,"async"),l(2,"groupMembersActionButtonDisabled"),C("click",function(){f(e);let i=c();return g(i.onRemoveMembers())}),m(3),l(4,"translate"),r()}if(t&2){let e=c();u("disabled",p(1,2,e.loading$)||e.selection.isEmpty()||p(2,4,e.group)),o(3),h(" ",p(4,6,"GROUP_DETAIL.MEMBERS.REMOVE_MEMBERS")," ")}}function ed(t,d){if(t&1&&(a(0,"mat-option",15),m(1),l(2,"memberStatus"),r()),t&2){let e=d.$implicit;u("value",e),o(),E(p(2,2,e))}}function td(t,d){if(t&1&&(a(0,"mat-option",15),m(1),l(2,"memberStatus"),r()),t&2){let e=d.$implicit;u("value",e),o(),E(p(2,2,e))}}function id(t,d){t&1&&A(0,"perun-web-apps-loading-table")}function nd(t,d){if(t&1){let e=I();a(0,"perun-web-apps-members-list",25),l(1,"async"),l(2,"async"),C("queryChanged",function(i){f(e);let s=c();return g(s.nextPage.next(i))})("refreshTable",function(){f(e);let i=c();return g(i.refreshTable())})("downloadAll",function(i){f(e);let s=c();return g(s.downloadAll(i))}),r()}if(t&2){let e=c();u("loading",p(1,10,e.loading$))("displayColumns",e.displayedColumns)("groupId",e.group.id)("voId",e.group.voId)("isMembersGroup",e.group.name==="members")("members",p(2,12,e.membersPage$))("selection",e.selection)("filter",e.searchString)("cacheSubject",e.cacheSubject)("resetPagination",e.cacheSubject)}}var U2=(()=>{class t{static{this.id="GroupMembersComponent"}constructor(e,n,i,s,S,M,R,N,re,xe,Bt,di,Ti,mo){this.groupService=e,this.registrarService=n,this.dialog=i,this.guiAuthResolver=s,this.storeService=S,this.attributesManager=M,this.apiRequest=R,this.notificator=N,this.entityStorageService=re,this.cacheHelperService=xe,this.clipboard=Bt,this.membersService=di,this.membersListService=Ti,this.destroyRef=mo,this.selection=new _e(!0,[],!0,(co,uo)=>co.id===uo.id),this.synchEnabled=!1,this.searchString="",this.updateTable=!1,this.memberAttrNames=[k.MEMBER_DEF_ORGANIZATION,k.MEMBER_DEF_MAIL,k.USER_DEF_ORGANIZATION,k.USER_DEF_PREFERRED_MAIL,k.MEMBER_DEF_EXPIRATION,k.MEMBER_DEF_GROUP_EXPIRATION,k.MEMBER_LIFECYCLE_ALTERABLE],this.inviteDisabled=!0,this.preApprovedInviteDisabled=!0,this.copyInvitationDisabled=!0,this.copyDisabled=!1,this.displayedColumns=["checkbox","id","type","fullName","status","groupStatus","organization","email","logins"],this.statuses=new Te([""]),this.statusList=["VALID","INVALID","EXPIRED","DISABLED"],this.selectedStatuses=["VALID","INVALID"],this.groupStatuses=new Te([""]),this.groupStatusList=["VALID","EXPIRED"],this.selectedGroupStatuses=["VALID"],this.nextPage=new ge({}),this.loadingSubject$=new ge(!1),this.cacheSubject=new ge(!0),this.resetPagination=new ge(!1),this.loading$=Wt(this.loadingSubject$,this.nextPage.pipe(Dt(()=>!0))),this.groupAttrNames=[k.GROUP_SYNC_ENABLED,k.GROUP_LAST_SYNC_STATE,k.GROUP_LAST_SYNC_TIMESTAMP,k.GROUP_STRUCTURE_SYNC_ENABLED,k.GROUP_LAST_STRUCTURE_SYNC_STATE,k.GROUP_LAST_STRUCTURE_SYNC_TIMESTAMP,k.GROUP_BLOCK_MANUAL_MEMBER_ADDING]}ngOnInit(){this.statuses.setValue(this.selectedStatuses),this.groupStatuses.setValue(this.selectedGroupStatuses),this.memberAttrNames=this.memberAttrNames.concat(this.storeService.getLoginAttributeNames()),this.group=this.entityStorageService.getEntity(),this.membersPage$=this.membersListService.nextPageHandler(this.nextPage,this.membersService,this.group.voId,this.memberAttrNames,this.statuses,this.group.id,this.groupStatuses,this.selection,this.loadingSubject$),this.setAuthRights(),this.isManualAddingBlocked(this.group.voId).then(()=>this.loadPage(this.group.id)),this.isCopyMembersDisabled(),this.cacheHelperService.refreshComponentCachedData().pipe(Ne(this.destroyRef)).subscribe(e=>{e===t.id&&this.refreshTable()})}loadPage(e){this.groupService.getRichGroupByIdWithAttributesByNames(e,this.groupAttrNames).subscribe(n=>{this.group=n,this.synchEnabled=Ui(this.group)})}setAuthRights(){this.addAuth=this.guiAuthResolver.isAuthorized("addMembers_Group_List<Member>_policy",[this.group]),this.removeAuth=this.guiAuthResolver.isAuthorized("removeMembers_Group_List<Member>_policy",[this.group]),this.displayedColumns=this.removeAuth?this.displayedColumns:["id","type","fullName","status","groupStatus","organization","email","logins"],this.inviteAuth=this.guiAuthResolver.isAuthorized("group-sendInvitation_Vo_Group_String_String_String_policy",[this.group]),this.copyInviteLinkAuth=this.guiAuthResolver.isAuthorized("group-getApplicationById_int_policy",[this.group]),this.preApprovedInviteAuth=this.guiAuthResolver.isAuthorized("inviteToGroup_Vo_Group_String_String_String_LocalDate_String_policy",[this.group]),this.copyAuth=this.guiAuthResolver.isAuthorized("source-copyMembers_Group_List<Group>_List<Member>_boolean_policy",[this.group]),this.inviteAuth&&this.registrarService.isInvitationEnabled(this.group.voId,this.group.id).subscribe(e=>{this.inviteDisabled=!e}),this.copyInviteLinkAuth&&this.registrarService.isLinkInvitationEnabled(this.group.voId,this.group.id).subscribe(e=>{this.copyInvitationDisabled=!e}),this.preApprovedInviteAuth&&this.registrarService.isPreApprovedInvitationEnabled(this.group.voId,this.group.id).subscribe(e=>{this.preApprovedInviteDisabled=!e})}onSearchByString(e){this.searchString=e,this.refreshTable()}onAddMember(){let e=F();e.width="1000px",e.data={group:this.group,manualAddingBlocked:this.blockManualMemberAdding},this.dialog.open(ur,e).afterClosed().subscribe(i=>{i&&this.refreshTable()})}onRemoveMembers(){let e=F();e.width="450px",e.data={groupId:this.group.id,members:this.selection.selected,theme:"group-theme"},this.dialog.open(Qn,e).afterClosed().subscribe(i=>{i&&this.refreshTable()})}onInviteMember(){let e=F();e.width="650px",e.data={voId:this.group.voId,groupId:this.group.id,theme:"group-theme"},this.dialog.open(Zn,e)}onInvitePreapprovedMember(){let e=F();e.width="650px",e.data={voId:this.group.voId,groupId:this.group.id,theme:"group-theme"},this.dialog.open(hr,e)}onBulkInvite(){let e=F();e.width="650px",e.data={voId:this.group.voId,groupId:this.group.id,theme:"group-theme"},this.dialog.open(eo,e)}onBulkPreapprovedInvite(){let e=F();e.width="650px",e.data={voId:this.group.voId,groupId:this.group.id,theme:"group-theme"},this.dialog.open(fr,e)}copyInvitationLink(){(this.invitationLink?Zt(this.invitationLink):this.registrarService.buildInviteURL(this.group.voId,this.group.id).pipe(hn(n=>(this.invitationLink=n,Zt(this.invitationLink))))).subscribe(n=>{this.clipboard.copy(n),this.notificator.showSuccess("GROUP_DETAIL.MEMBERS.COPY_INVITATION_LINK_SUCCESS")})}onCopyMembers(){let e=F();e.width="650px",e.data={voId:this.group.voId,groupId:this.group.id,theme:"group-theme",members:this.selection.selected},this.dialog.open(_r,e).afterClosed().subscribe(i=>{i&&this.selection.clear()})}displaySelectedStatuses(){if(this.selectedStatuses.length===this.statusList.length)return"ALL";let e=this.statuses.value;return e?`${e[0]}  ${e.length>1?"(+"+(e.length-1).toString()+" "+(e.length===2?"other)":"others)"):""}`:""}displaySelectedGroupStatuses(){return this.selectedGroupStatuses.length===this.groupStatusList.length?"ALL":`${this.groupStatuses.value[0]}`}isManualAddingBlocked(e){return new Promise(n=>{this.apiRequest.dontHandleErrorForNext(),this.attributesManager.getVoAttributeByName(e,"urn:perun:vo:attribute-def:def:blockManualMemberAdding").subscribe({next:i=>{this.blockManualMemberAdding=i.value!==null,n()},error:i=>{i.name!=="PrivilegeException"&&this.notificator.showError(i.name),n()}})})}isCopyMembersDisabled(){this.copyDisabled=!0,this.groupService.getGroupDirectMembersCount(this.group.id).subscribe({next:e=>{this.copyDisabled=e===0},error:()=>{this.copyDisabled=!0}})}changeVoStatuses(){this.selectedStatuses=this.statuses.value,this.refreshTable()}changeGroupStatuses(){this.selectedGroupStatuses=this.groupStatuses.value,this.refreshTable()}refreshTable(){this.resetPagination.next(!0),this.cacheSubject.next(!0),this.nextPage.next(this.nextPage.value),this.isCopyMembersDisabled()}downloadAll(e){let n=this.nextPage.getValue(),i=F();i.width="500px";let s=this.dialog.open(Fn,i),S=this.membersService.getMembersPage({vo:this.group.voId,attrNames:this.memberAttrNames,query:{order:n.order,pageSize:e.length,offset:0,sortColumn:this.membersListService.getSortColumn(n.sortColumn),searchString:n.searchString,groupId:this.group.id,statuses:this.statuses.value,groupStatuses:this.groupStatuses?.value}}).subscribe({next:M=>{s.close(),Et(Ot(M.data,this.displayedColumns,e.getDataForColumnFun),e.format)},error:M=>{this.notificator.showRPCError(M),s.close()}});s.afterClosed().subscribe(()=>{S&&S.unsubscribe()})}static{this.\u0275fac=function(n){return new(n||t)(_(De),_(tt),_(Ae),_(pe),_(Le),_(Tt),_(xt),_(q),_(He),_(Je),_(kn),_(Qe),_(Gn),_(we))}}static{this.\u0275cmp=x({type:t,selectors:[["app-group-members"]],hostVars:2,hostBindings:function(n,i){n&2&&Ee("router-component",i.true)},decls:68,vars:102,consts:[["menu","matMenu"],["spinner",""],[1,"page-subtitle"],["alert_type","warn"],[1,"align-elements"],[3,"click"],[3,"matTooltipDisabled","matTooltipPosition","matTooltip"],["color","accent","data-cy","add-members","mat-flat-button","",1,"me-2","action-button",3,"disabled"],["color","accent","mat-flat-button","",1,"me-2","dropdown-toggle",3,"disabled","matMenuTriggerFor"],["mat-menu-item","",1,"action-button",3,"disabled"],["mat-stroked-button","",1,"me-2",3,"disabled"],["color","accent","mat-flat-button","",1,"me-2",3,"disabled"],["color","warn","data-cy","remove-members","mat-flat-button","",1,"me-2",3,"disabled"],[1,"me-2","fix-select"],["multiple","",3,"closed","formControl"],[1,"group-theme",3,"value"],[1,"mt-2","search-field",3,"filter","placeholder"],[1,"position-relative","table-min-height"],[3,"loading","displayColumns","groupId","voId","isMembersGroup","members","selection","filter","cacheSubject","resetPagination","queryChanged","refreshTable","downloadAll",4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],["color","accent","data-cy","add-members","mat-flat-button","",1,"me-2","action-button",3,"click","disabled"],["mat-menu-item","",1,"action-button",3,"click","disabled"],["mat-stroked-button","",1,"me-2",3,"click","disabled"],[1,"ms-1"],["color","accent","mat-flat-button","",1,"me-2",3,"click","disabled"],["color","warn","data-cy","remove-members","mat-flat-button","",1,"me-2",3,"click","disabled"],[3,"queryChanged","refreshTable","downloadAll","loading","displayColumns","groupId","voId","isMembersGroup","members","selection","filter","cacheSubject","resetPagination"]],template:function(n,i){if(n&1){let s=I();a(0,"h1",2),m(1),l(2,"translate"),r(),v(3,Hm,3,3,"perun-web-apps-alert",3),a(4,"div",4)(5,"perun-web-apps-refresh-button",5),C("click",function(){return f(s),g(i.refreshTable())}),r(),a(6,"span",6),l(7,"groupMembersActionButtonDisabledTooltip"),l(8,"translate"),l(9,"groupMembersActionButtonDisabled"),v(10,zm,4,7,"button",7),r(),a(11,"span",6),l(12,"translate"),l(13,"groupMembersActionButtonDisabledTooltip"),l(14,"translate"),l(15,"groupMembersActionButtonDisabled"),v(16,qm,4,7,"button",8),a(17,"mat-menu",null,0)(19,"span",6),l(20,"translate"),v(21,$m,4,6,"button",9),r(),a(22,"span",6),l(23,"translate"),v(24,Ym,4,6,"button",9),r(),a(25,"span",6),l(26,"translate"),v(27,Xm,4,6,"button",9),r(),a(28,"span",6),l(29,"translate"),v(30,Km,4,6,"button",9),r()()(),a(31,"span",6),l(32,"translate"),v(33,Qm,7,6,"button",10),r(),a(34,"span",6),l(35,"translate"),v(36,Zm,3,4,"button",11),r(),a(37,"span",6),l(38,"groupMembersActionButtonDisabledTooltip"),l(39,"translate"),l(40,"groupMembersActionButtonDisabled"),v(41,Jm,5,8,"button",12),r(),a(42,"mat-form-field",13)(43,"mat-label"),m(44),l(45,"translate"),r(),a(46,"mat-select",14),C("closed",function(){return f(s),g(i.changeVoStatuses())}),a(47,"mat-select-trigger"),m(48),l(49,"memberStatus"),r(),de(50,ed,3,4,"mat-option",15,Ce),r()(),a(52,"mat-form-field",13)(53,"mat-label"),m(54),l(55,"translate"),r(),a(56,"mat-select",14),C("closed",function(){return f(s),g(i.changeGroupStatuses())}),a(57,"mat-select-trigger"),m(58),l(59,"memberStatus"),r(),de(60,td,3,4,"mat-option",15,Ce),r()(),a(62,"perun-web-apps-debounce-filter",16),C("filter",function(M){return f(s),g(i.onSearchByString(M))}),r()(),T(63,id,1,0,"ng-template",null,1,B),a(65,"div",17),T(66,nd,3,14,"perun-web-apps-members-list",18),l(67,"async"),r()}if(n&2){let s=y(64);o(),E(p(2,56,"GROUP_DETAIL.MEMBERS.TITLE")),o(2),b(i.synchEnabled?3:-1),o(3),u("matTooltip",w(p(8,61,Me(7,58,i.group,"add"))))("matTooltipDisabled",!Me(9,63,i.group,"add"))("matTooltipPosition","above"),o(4),b(i.addAuth?10:-1),o(),u("matTooltip",w(i.inviteDisabled&&i.preApprovedInviteDisabled?p(12,66,"GROUP_DETAIL.MEMBERS.INVITE_BUTTON_DISABLED"):p(14,70,p(13,68,i.group))))("matTooltipDisabled",!(p(15,72,i.group)||i.inviteDisabled&&i.preApprovedInviteDisabled))("matTooltipPosition","above"),o(5),b(i.inviteAuth?16:-1),o(3),u("matTooltip",w(p(20,74,"GROUP_DETAIL.MEMBERS.INVITE_DISABLED")))("matTooltipDisabled",!i.inviteDisabled)("matTooltipPosition","right"),o(2),b(i.inviteAuth?21:-1),o(),u("matTooltip",w(p(23,76,"GROUP_DETAIL.MEMBERS.PREAPPROVED_INVITE_DISABLED")))("matTooltipDisabled",!i.preApprovedInviteDisabled)("matTooltipPosition","right"),o(2),b(i.preApprovedInviteAuth?24:-1),o(),u("matTooltip",w(p(26,78,"GROUP_DETAIL.MEMBERS.INVITE_DISABLED")))("matTooltipDisabled",!i.inviteDisabled)("matTooltipPosition","right"),o(2),b(i.inviteAuth?27:-1),o(),u("matTooltip",w(p(29,80,"GROUP_DETAIL.MEMBERS.PREAPPROVED_INVITE_DISABLED")))("matTooltipDisabled",!i.preApprovedInviteDisabled)("matTooltipPosition","right"),o(2),b(i.preApprovedInviteAuth?30:-1),o(),u("matTooltip",w(p(32,82,"GROUP_DETAIL.MEMBERS.COPY_INVITATION_LINK_DISABLED")))("matTooltipDisabled",!i.copyInvitationDisabled)("matTooltipPosition","above"),o(2),b(i.copyInviteLinkAuth?33:-1),o(),u("matTooltip",w(p(35,84,"GROUP_DETAIL.MEMBERS.COPY_MEMBERS_DISABLED")))("matTooltipDisabled",!i.copyDisabled)("matTooltipPosition","above"),o(2),b(i.copyAuth?36:-1),o(),u("matTooltip",w(p(39,88,p(38,86,i.group))))("matTooltipDisabled",!p(40,90,i.group))("matTooltipPosition","above"),o(4),b(i.removeAuth?41:-1),o(3),E(p(45,92,"GROUP_DETAIL.MEMBERS.FILTER_STATUS")),o(2),u("formControl",i.statuses),o(2),h(" ",p(49,94,i.displaySelectedStatuses())," "),o(2),ce(i.statusList),o(4),E(p(55,96,"GROUP_DETAIL.MEMBERS.FILTER_GROUP_STATUS")),o(2),u("formControl",i.groupStatuses),o(2),h(" ",p(59,98,i.displaySelectedGroupStatuses())," "),o(2),ce(i.groupStatusList),o(2),u("placeholder","GROUP_DETAIL.MEMBERS.SEARCH_DESCRIPTION"),o(4),u("perunWebAppsLoader",p(67,100,i.loading$))("perunWebAppsLoaderIndicator",s)}},dependencies:[D,P,G,lt,st,Oe,Re,Pe,Ye,$e,Pi,We,le,se,qe,be,ve,ye,Ze,Xi,Yt,qt,zt,$t,L,ne,Ge,V,at,Bn,O,Ca,Sa],styles:[".search-field[_ngcontent-%COMP%]{width:325px}.fix-select[_ngcontent-%COMP%]{margin-top:8px}"]})}}return t})();var od=["list"],ad=["stepper"],rd=()=>["select","id","name","facility","tags","description"];function sd(t,d){t&1&&A(0,"perun-web-apps-loading-dialog")}function ld(t,d){t&1&&(m(0),l(1,"translate")),t&2&&E(p(1,1,"DIALOGS.ADD_GROUP_RESOURCES.RESOURCES"))}function pd(t,d){t&1&&(m(0),l(1,"translate")),t&2&&E(p(1,1,"DIALOGS.ADD_GROUP_RESOURCES.OPTIONS"))}function md(t,d){if(t&1){let e=I();a(0,"div",5)(1,"mat-stepper",7,1)(3,"mat-step",8),T(4,ld,2,3,"ng-template",9),a(5,"perun-web-apps-debounce-filter",10),l(6,"translate"),C("filter",function(i){f(e);let s=c(2);return g(s.applyFilter(i))}),r(),A(7,"perun-web-apps-resources-list",11,2),r(),a(9,"mat-step"),T(10,pd,2,3,"ng-template",9),a(11,"mat-slide-toggle",12),C("toggleChange",function(){f(e);let i=c(2);return g(i.changeSubgroupsMessage())}),te("ngModelChange",function(i){f(e);let s=c(2);return ee(s.autoAssignSubgroups,i)||(s.autoAssignSubgroups=i),g(i)}),m(12),l(13,"translate"),r(),a(14,"div",13),A(15,"i",14),r(),a(16,"mat-slide-toggle",12),C("toggleChange",function(){f(e);let i=c(2);return g(i.changeInactiveMessage())}),te("ngModelChange",function(i){f(e);let s=c(2);return ee(s.asActive,i)||(s.asActive=i),g(i)}),m(17),l(18,"translate"),r(),a(19,"div",13),m(20),r(),a(21,"mat-slide-toggle",12),C("toggleChange",function(){f(e);let i=c(2);return g(i.changeAsyncMessage())}),te("ngModelChange",function(i){f(e);let s=c(2);return ee(s.async,i)||(s.async=i),g(i)}),m(22),l(23,"translate"),r(),a(24,"div",13),m(25),r()()()()}if(t&2){let e=y(8),n=c(2);o(),u("linear",!0),o(2),u("completed",n.selection.selected.length!==0&&e!==void 0&&e.addAuth),o(2),u("placeholder",w(p(6,21,"DIALOGS.ADD_GROUP_RESOURCES.FILTER"))),o(2),u("loading",n.loading)("filterValue",n.filterValue)("groupToResource",n.data.group)("disableRouting",!0)("resources",n.resources)("selection",n.selection)("cachedSubject",n.cachedSubject)("displayColumns",ue(29,rd)),o(4),J("ngModel",n.autoAssignSubgroups),o(),h(" ",p(13,23,"DIALOGS.ADD_GROUP_RESOURCES.AUTO_SUBGROUPS")," "),o(3),u("innerHTML",n.autoAssignHint,kt),o(),J("ngModel",n.asActive),o(),h(" ",p(18,25,"DIALOGS.ADD_GROUP_RESOURCES.AS_ACTIVE")," "),o(3),h(" ",n.asActiveHint," "),o(),J("ngModel",n.async),o(),h(" ",p(23,27,"DIALOGS.ADD_GROUP_RESOURCES.ASYNC_OPT")," "),o(3),h(" ",n.asyncHint," ")}}function dd(t,d){if(t&1){let e=I();a(0,"button",20),C("click",function(){f(e);let i=c(3);return g(i.stepperPrevious())}),m(1),l(2,"translate"),r()}t&2&&(o(),h(" ",p(2,1,"DIALOGS.ADD_GROUP_RESOURCES.BACK")," "))}function cd(t,d){if(t&1){let e=I();a(0,"button",21),C("click",function(){f(e);let i=c(3);return g(i.stepperNext())}),m(1),l(2,"translate"),r()}if(t&2){let e=c(3);Ee("ms-2",e.stepper!==void 0&&e.stepper.selectedIndex!==0)("ms-auto",!(e.stepper!==void 0&&e.stepper.selectedIndex!==0)),u("disabled",e.selection.selected.length===0||e.list!==void 0&&!e.list.addAuth||e.loading),o(),h(" ",p(2,6,"DIALOGS.ADD_GROUP_RESOURCES.NEXT")," ")}}function ud(t,d){if(t&1){let e=I();a(0,"button",22),C("click",function(){f(e);let i=c(3);return g(i.onSubmit())}),m(1),l(2,"translate"),r()}if(t&2){let e=c(3);u("disabled",e.selection.selected.length===0||e.loading),o(),h(" ",p(2,2,"DIALOGS.ADD_GROUP_RESOURCES.ADD")," ")}}function _d(t,d){if(t&1){let e=I();a(0,"div",6)(1,"div")(2,"button",15),C("click",function(){f(e);let i=c(2);return g(i.onCancel())}),m(3),l(4,"translate"),r(),v(5,dd,3,3,"button",16),v(6,cd,3,8,"button",17),a(7,"span",18),l(8,"translate"),v(9,ud,3,4,"button",19),r()()()}if(t&2){let e=c(2);o(3),h(" ",p(4,7,"DIALOGS.ADD_GROUP_RESOURCES.CANCEL")," "),o(2),b(e.stepper!==void 0&&e.stepper.selectedIndex!==0?5:-1),o(),b(e.stepper!==void 0&&e.stepper.selectedIndex!==e.stepper._steps.length-1?6:-1),o(),u("matTooltip",w(p(8,9,"DIALOGS.ADD_GROUP_RESOURCES.ADD_PERMISSION_TOOLTIP")))("matTooltipDisabled",e.list===void 0||e.list.addAuth),o(2),b(e.stepper!==void 0&&e.stepper.selectedIndex===e.stepper._steps.length-1?9:-1)}}function hd(t,d){if(t&1&&(a(0,"div")(1,"h1",4),m(2),l(3,"translate"),r(),v(4,md,26,30,"div",5),v(5,_d,10,11,"div",6),r()),t&2){let e=c();o(2),E(p(3,3,"DIALOGS.ADD_GROUP_RESOURCES.TITLE")),o(2),b(e.resources?4:-1),o(),b(e.stepper!==void 0?5:-1)}}var gr=(()=>{class t{constructor(e,n,i,s,S,M,R){this.dialogRef=e,this.data=n,this.notificator=i,this.translate=s,this.resourcesManager=S,this.guiAuthResolver=M,this.cd=R,this.filterValue="",this.resources=null,this.selection=new _e(!0,[],!0,(N,re)=>N.id===re.id),this.cachedSubject=new ge(!0),this.theme="",this.async=!0,this.autoAssignSubgroups=!1,this.asActive=!0}ngOnInit(){this.theme=this.data.theme,this.loading=!0,this.autoAssignHint=this.translate.instant("DIALOGS.ADD_GROUP_RESOURCES.AUTO_SUBGROUPS_OFF_HINT"),this.asActiveHint=this.translate.instant("DIALOGS.ADD_GROUP_RESOURCES.ACTIVE_ON_HINT"),this.asyncHint=this.translate.instant("DIALOGS.ADD_GROUP_RESOURCES.ASYNC_ON_HINT"),this.resourcesManager.getRichResources(this.data.group.voId).subscribe({next:e=>{this.resourcesManager.getAssignedResourcesWithGroup(this.data.group.id).subscribe({next:n=>{this.resources=[];for(let i of e)n.findIndex(s=>s.id===i.id)===-1&&this.guiAuthResolver.isAuthorized("assignGroupToResources_Group_List<Resource>_policy",[this.data.group,i])&&this.resources.push(i);this.loading=!1,this.cd.detectChanges()},error:()=>this.loading=!1})},error:()=>this.loading=!1})}applyFilter(e){this.filterValue=e,this.selection.clear(),this.cachedSubject.next(!0)}onCancel(){this.dialogRef.close(!1)}onSubmit(){this.loading=!0;let e=this.selection.selected.map(n=>n.id);this.resourcesManager.assignGroupToResources(this.data.group.id,e,this.async,!this.asActive,this.autoAssignSubgroups).subscribe({next:()=>{this.translate.get("DIALOGS.ADD_GROUP_RESOURCES.SUCCESS").subscribe(n=>{this.notificator.showSuccess(n),this.dialogRef.close(!0)})},error:()=>this.loading=!1})}changeSubgroupsMessage(){this.autoAssignHint=this.autoAssignSubgroups?this.translate.instant("DIALOGS.ADD_GROUP_RESOURCES.AUTO_SUBGROUPS_OFF_HINT"):this.translate.instant("DIALOGS.ADD_GROUP_RESOURCES.AUTO_SUBGROUPS_ON_HINT")}changeInactiveMessage(){this.asActiveHint=this.asActive?this.translate.instant("DIALOGS.ADD_GROUP_RESOURCES.ACTIVE_OFF_HINT"):this.translate.instant("DIALOGS.ADD_GROUP_RESOURCES.ACTIVE_ON_HINT")}changeAsyncMessage(){this.asyncHint=this.async?this.translate.instant("DIALOGS.ADD_GROUP_RESOURCES.ASYNC_OFF_HINT"):this.translate.instant("DIALOGS.ADD_GROUP_RESOURCES.ASYNC_ON_HINT")}stepperPrevious(){this.stepper.previous()}stepperNext(){this.stepper.next()}static{this.\u0275fac=function(n){return new(n||t)(_(U),_(j),_(q),_(Se),_(Si),_(pe),_(yt))}}static{this.\u0275cmp=x({type:t,selectors:[["app-add-group-resource-dialog"]],viewQuery:function(n,i){if(n&1&&(Be(od,5),Be(ad,5)),n&2){let s;Ve(s=Fe())&&(i.list=s.first),Ve(s=Fe())&&(i.stepper=s.first)}},decls:4,vars:5,consts:[["spinner",""],["stepper",""],["list",""],[4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],["mat-dialog-title",""],["mat-dialog-content",""],["mat-dialog-actions","",1,"justify-content-end"],[3,"linear"],[3,"completed"],["matStepLabel",""],[3,"filter","placeholder"],[3,"loading","filterValue","groupToResource","disableRouting","resources","selection","cachedSubject","displayColumns"],["labelPosition","before",1,"mt-3","slide-text",3,"toggleChange","ngModelChange","ngModel"],[1,"text-muted","new-line","mt-2"],[3,"innerHTML"],["mat-stroked-button","",1,"me-2",3,"click"],["mat-stroked-button","",1,"ms-auto"],["color","accent","mat-flat-button","","type","button",1,"ms-auto",3,"ms-2","ms-auto","disabled"],[3,"matTooltipDisabled","matTooltip"],["color","accent","mat-flat-button","",1,"ms-2",3,"disabled"],["mat-stroked-button","",1,"ms-auto",3,"click"],["color","accent","mat-flat-button","","type","button",1,"ms-auto",3,"click","disabled"],["color","accent","mat-flat-button","",1,"ms-2",3,"click","disabled"]],template:function(n,i){if(n&1&&(T(0,sd,1,0,"ng-template",null,0,B),a(2,"div"),T(3,hd,6,5,"div",3),r()),n&2){let s=y(1);o(2),H(W("",i.theme," position-relative")),o(),u("perunWebAppsLoader",i.loading)("perunWebAppsLoaderIndicator",s)}},dependencies:[D,P,G,ni,ii,je,se,Ue,le,K,$,X,Y,oe,ye,L,ne,Vi,Ni,Bi,$i,V,O],encapsulation:2})}}return t})();function fd(t,d){t&1&&A(0,"perun-web-apps-loading-dialog")}function gd(t,d){t&1&&A(0,"th",14)}function Cd(t,d){if(t&1&&(a(0,"td",15),m(1),r()),t&2){let e=d.$implicit;o(),E(e.name)}}function Sd(t,d){t&1&&A(0,"tr",16)}function vd(t,d){t&1&&A(0,"tr",17)}function bd(t,d){if(t&1){let e=I();a(0,"div")(1,"h1",2),m(2),l(3,"translate"),r(),a(4,"div",3)(5,"p"),m(6),l(7,"translate"),r(),a(8,"div",4),m(9),l(10,"translate"),r(),a(11,"table",5),Q(12,6),T(13,gd,1,0,"th",7)(14,Cd,2,1,"td",8),Z(),T(15,Sd,1,0,"tr",9)(16,vd,1,0,"tr",10),r()(),a(17,"div",11)(18,"button",12),C("click",function(){f(e);let i=c();return g(i.onCancel())}),m(19),l(20,"translate"),r(),a(21,"button",13),C("click",function(){f(e);let i=c();return g(i.onSubmit())}),m(22),l(23,"translate"),r()()()}if(t&2){let e=c();o(2),E(p(3,9,"DIALOGS.REMOVE_RESOURCES.TITLE")),o(4),h(" ",p(7,11,"DIALOGS.REMOVE_RESOURCES.DESCRIPTION")," "),o(3),h(" ",p(10,13,"DIALOGS.REMOVE_RESOURCES.ASK")," "),o(2),u("dataSource",e.dataSource),o(4),u("matHeaderRowDef",e.displayedColumns),o(),u("matRowDefColumns",e.displayedColumns),o(3),h(" ",p(20,15,"DIALOGS.REMOVE_RESOURCES.CANCEL")," "),o(2),u("disabled",e.loading),o(),h(" ",p(23,17,"DIALOGS.REMOVE_RESOURCES.DELETE")," ")}}var Cr=(()=>{class t{constructor(e,n,i,s,S){this.dialogRef=e,this.data=n,this.notificator=i,this.translate=s,this.resourcesManager=S,this.displayedColumns=["name"]}ngOnInit(){this.dataSource=new et(this.data.resources)}onCancel(){this.dialogRef.close(!1)}onSubmit(){this.loading=!0;let e=this.data.resources.map(n=>n.id);this.resourcesManager.removeGroupFromResources(this.data.groupId,e).subscribe(()=>{this.translate.get("DIALOGS.REMOVE_RESOURCES.SUCCESS").subscribe(n=>{this.loading=!1,this.notificator.showSuccess(n),this.dialogRef.close(!0)})},()=>this.loading=!1)}static{this.\u0275fac=function(n){return new(n||t)(_(U),_(j),_(q),_(Se),_(Si))}}static{this.\u0275cmp=x({type:t,selectors:[["app-remove-group-resource-dialog"]],decls:4,vars:5,consts:[["spinner",""],[4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],["mat-dialog-title",""],["mat-dialog-content",""],[1,"fw-bold"],["mat-table","",1,"w-100",3,"dataSource"],["matColumnDef","name"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["class","font-weight-bolder","mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["mat-dialog-actions",""],["mat-stroked-button","",1,"ms-auto",3,"click"],["color","warn","mat-flat-button","",1,"ms-2",3,"click","disabled"],["mat-header-cell",""],["mat-cell",""],["mat-header-row","",1,"font-weight-bolder"],["mat-row",""]],template:function(n,i){if(n&1&&(T(0,fd,1,0,"ng-template",null,0,B),a(2,"div"),T(3,bd,24,19,"div",1),r()),n&2){let s=y(1);o(2),H(W("",i.data.theme," position-relative")),o(),u("perunWebAppsLoader",i.loading)("perunWebAppsLoaderIndicator",s)}},dependencies:[D,P,G,K,$,X,Y,oe,vt,mt,ct,ft,ut,dt,gt,_t,ht,Ct,St,L,V,O],encapsulation:2})}}return t})();var Ed=["list"],Id=()=>["select","id","indirectResourceAssigment","name","status","facility","tags","description"];function Td(t,d){if(t&1){let e=I();a(0,"button",9),C("click",function(){f(e);let i=c();return g(i.addResource())}),m(1),l(2,"translate"),r()}t&2&&(o(),h(" ",p(2,1,"GROUP_DETAIL.RESOURCES.ADD")," "))}function Ad(t,d){t&1&&A(0,"perun-web-apps-loading-table")}function Md(t,d){if(t&1){let e=I();a(0,"perun-web-apps-resources-list",11,1),C("refreshTable",function(){f(e);let i=c(2);return g(i.refreshTable())}),r()}if(t&2){let e=c(2);u("loading",e.loading)("disableRouting",!e.routingAuth)("filterValue",e.filterValue)("resources",e.resources)("routingVo",!0)("displayColumns",ue(11,Id))("selection",e.selected)("cachedSubject",e.cachedSubject)("groupId",e.group.id)("groupToResource",e.group)("resourcesToDisableCheckbox",e.resourcesToDisable)}}function xd(t,d){if(t&1&&(a(0,"div",8),T(1,Md,2,12,"perun-web-apps-resources-list",10),r()),t&2){let e=c(),n=y(13);o(),u("perunWebAppsLoader",e.loading)("perunWebAppsLoaderIndicator",n)}}var zx=(()=>{class t{static{this.id="GroupResourcesComponent"}constructor(e,n,i,s,S,M,R){this.resourcesManager=e,this.groupService=n,this.dialog=i,this.guiAuthResolver=s,this.entityStorageService=S,this.cacheHelperService=M,this.destroyRef=R,this.resources=[],this.selected=new _e(!0,[],!0,(N,re)=>N.id===re.id),this.cachedSubject=new ge(!0),this.filterValue="",this.addAuth=!1}ngOnInit(){this.group=this.entityStorageService.getEntity(),this.setAuthorization(),this.refreshTable(),this.cacheHelperService.refreshComponentCachedData().pipe(Ne(this.destroyRef)).subscribe(e=>{e===t.id&&this.refreshTable()})}setAuthorization(){this.resources!==null&&this.resources.length!==0&&(this.routingAuth=this.guiAuthResolver.isAuthorized("getResourceById_int_policy",[this.resources[0]])),this.addAuth=this.guiAuthResolver.isAuthorized("getResources_Vo_policy",[this.group])}refreshTable(){this.loading=!0,this.resourcesManager.getResourceAssignments(this.group.id).subscribe(e=>{this.resources=e.map(n=>{let i=n.enrichedResource.resource;return i.facility=n.facility,i.status=n.status,i.resourceTags=n.resourceTags,i.failureCause=n.failureCause,i.sourceGroupId=n.sourceGroupId,i}),this.selected.clear(),this.cachedSubject.next(!0),this.resourcesToDisable=new Set(this.resources.filter(n=>n.sourceGroupId!==null).map(n=>n.id)),this.setAuthorization(),this.loading=!1})}applyFilter(e){this.filterValue=e,this.refreshTable()}addResource(){let e=F();e.width="1000px",e.data={theme:"group-theme",group:this.group},this.dialog.open(gr,e).afterClosed().subscribe(i=>{i&&this.refreshTable()})}removeResource(){let e=F();e.width="450px",e.data={theme:"group-theme",resources:this.selected.selected,groupId:this.group.id},this.dialog.open(Cr,e).afterClosed().subscribe(i=>{i&&this.refreshTable()})}static{this.\u0275fac=function(n){return new(n||t)(_(Si),_(De),_(Ae),_(pe),_(He),_(Je),_(we))}}static{this.\u0275cmp=x({type:t,selectors:[["app-group-resources"]],viewQuery:function(n,i){if(n&1&&Be(Ed,5),n&2){let s;Ve(s=Fe())&&(i.list=s.first)}},hostVars:2,hostBindings:function(n,i){n&2&&Ee("router-component",i.true)},decls:15,vars:15,consts:[["spinner",""],["list",""],[1,"page-subtitle"],[3,"refresh"],["color","accent","mat-flat-button","",1,"me-2","action-button"],[3,"matTooltipDisabled","matTooltip"],["color","warn","mat-flat-button","",1,"me-2",3,"click","disabled"],[3,"filter","placeholder"],[1,"position-relative","table-min-height"],["color","accent","mat-flat-button","",1,"me-2","action-button",3,"click"],[3,"loading","disableRouting","filterValue","resources","routingVo","displayColumns","selection","cachedSubject","groupId","groupToResource","resourcesToDisableCheckbox","refreshTable",4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],[3,"refreshTable","loading","disableRouting","filterValue","resources","routingVo","displayColumns","selection","cachedSubject","groupId","groupToResource","resourcesToDisableCheckbox"]],template:function(n,i){if(n&1){let s=I();a(0,"div")(1,"h1",2),m(2),l(3,"translate"),r(),a(4,"perun-web-apps-refresh-button",3),C("refresh",function(){return f(s),g(i.refreshTable())}),r(),v(5,Td,3,3,"button",4),a(6,"span",5),l(7,"translate"),a(8,"button",6),C("click",function(){return f(s),g(i.removeResource())}),m(9),l(10,"translate"),r()(),a(11,"perun-web-apps-debounce-filter",7),C("filter",function(M){return f(s),g(i.applyFilter(M))}),r(),T(12,Ad,1,0,"ng-template",null,0,B),v(14,xd,2,2,"div",8),r()}n&2&&(o(2),E(p(3,9,"GROUP_DETAIL.RESOURCES.TITLE")),o(3),b(i.addAuth?5:-1),o(),u("matTooltip",w(p(7,11,"GROUP_DETAIL.RESOURCES.DELETE_PERMISSION_HINT")))("matTooltipDisabled",i.selected.selected.length===0||i.list!==void 0&&i.list.removeAuth),o(2),u("disabled",i.loading||i.selected.selected.length===0||i.list!==void 0&&!i.list.removeAuth),o(),h(" ",p(10,13,"GROUP_DETAIL.RESOURCES.DELETE")," "),o(2),u("placeholder","SHARED_LIB.PERUN.COMPONENTS.RESOURCES_LIST.TABLE_SEARCH"),o(3),b(i.resources?14:-1))},dependencies:[D,P,G,ye,Ze,L,ne,$i,V,Ge,O],encapsulation:2})}}return t})();function Dd(t,d){t&1&&A(0,"perun-web-apps-loading-dialog")}function Rd(t,d){t&1&&(a(0,"mat-error"),m(1),l(2,"translate"),r()),t&2&&(o(),E(p(2,1,"DIALOGS.UPDATE_APPLICATION_FORM.COMMA_ERROR")))}function Od(t,d){if(t&1){let e=I();a(0,"button",17),l(1,"translate"),C("click",function(){f(e);let i=c().$index,s=c(2);return g(s.removeModule(i))}),a(2,"mat-icon"),m(3,"remove_circle"),r()()}t&2&&u("matTooltip",p(1,1,"DIALOGS.UPDATE_APPLICATION_FORM.REMOVE_MODULE_TOOLTIP"))}function Ld(t,d){if(t&1&&(a(0,"div",4)(1,"mat-form-field",14)(2,"mat-label"),m(3),l(4,"translate"),r(),A(5,"input",15),v(6,Rd,3,3,"mat-error"),r(),v(7,Od,4,3,"button",16),r()),t&2){let e=d.$implicit,n=c(2);o(3),E(p(4,4,"DIALOGS.UPDATE_APPLICATION_FORM.MODULE_NAME")),o(2),u("formControl",e),o(),b(e.hasError("pattern")?6:-1),o(),b(n.formArray.length>1?7:-1)}}function yd(t,d){if(t&1){let e=I();a(0,"div")(1,"mat-form-field",7)(2,"mat-label"),m(3),l(4,"translate"),r(),a(5,"mat-select",8),te("valueChange",function(i){f(e);let s=c(2);return ee(s.embeddedState,i)||(s.embeddedState=i),g(i)}),a(6,"mat-option",9),m(7),l(8,"translate"),r(),a(9,"mat-option",10),m(10),l(11,"translate"),r()()()()}if(t&2){let e=c(2);o(3),h("",p(4,4,"DIALOGS.UPDATE_APPLICATION_FORM.EMBEDDED"),":"),o(2),J("value",e.embeddedState),o(2),E(p(8,6,"DIALOGS.UPDATE_APPLICATION_FORM.AUTOMATIC")),o(3),E(p(11,8,"DIALOGS.UPDATE_APPLICATION_FORM.MANUAL"))}}function wd(t,d){if(t&1){let e=I();a(0,"div")(1,"h1",2),m(2),l(3,"translate"),r(),a(4,"div",3),de(5,Ld,8,6,"div",4,Ao().trackByIndex,!0),a(7,"div",5)(8,"button",6),l(9,"translate"),C("click",function(){f(e);let i=c();return g(i.addModule())}),a(10,"mat-icon"),m(11,"add_circle"),r()()(),a(12,"mat-form-field",7)(13,"mat-label"),m(14),l(15,"translate"),r(),a(16,"mat-select",8),te("valueChange",function(i){f(e);let s=c();return ee(s.initialState,i)||(s.initialState=i),g(i)}),a(17,"mat-option",9),m(18),l(19,"translate"),r(),a(20,"mat-option",10),m(21),l(22,"translate"),r()()(),a(23,"mat-form-field",7)(24,"mat-label"),m(25),l(26,"translate"),r(),a(27,"mat-select",8),te("valueChange",function(i){f(e);let s=c();return ee(s.extensionState,i)||(s.extensionState=i),g(i)}),a(28,"mat-option",9),m(29),l(30,"translate"),r(),a(31,"mat-option",10),m(32),l(33,"translate"),r()()(),v(34,yd,12,10,"div"),r(),a(35,"div",11)(36,"button",12),C("click",function(){f(e);let i=c();return g(i.onCancel())}),m(37),l(38,"translate"),r(),a(39,"button",13),C("click",function(){f(e);let i=c();return g(i.submit())}),m(40),l(41,"translate"),r()()()}if(t&2){let e=c();o(2),E(p(3,14,"DIALOGS.UPDATE_APPLICATION_FORM.TITLE")),o(3),ce(e.formArray.controls),o(3),u("matTooltip",p(9,16,"DIALOGS.UPDATE_APPLICATION_FORM.ADD_MODULE_TOOLTIP")),o(6),h("",p(15,18,"DIALOGS.UPDATE_APPLICATION_FORM.INITIAL"),":"),o(2),J("value",e.initialState),o(2),E(p(19,20,"DIALOGS.UPDATE_APPLICATION_FORM.AUTOMATIC")),o(3),E(p(22,22,"DIALOGS.UPDATE_APPLICATION_FORM.MANUAL")),o(4),h("",p(26,24,"DIALOGS.UPDATE_APPLICATION_FORM.EXTENSION"),":"),o(2),J("value",e.extensionState),o(2),E(p(30,26,"DIALOGS.UPDATE_APPLICATION_FORM.AUTOMATIC")),o(3),E(p(33,28,"DIALOGS.UPDATE_APPLICATION_FORM.MANUAL")),o(2),b(e.entity==="group"&&e.autoRegistrationEnabled?34:-1),o(3),h(" ",p(38,30,"DIALOGS.UPDATE_APPLICATION_FORM.CANCEL_BUTTON")," "),o(2),u("disabled",e.formArray.invalid),o(),h(" ",p(41,32,"DIALOGS.UPDATE_APPLICATION_FORM.SUBMIT_BUTTON")," ")}}var no=(()=>{class t{constructor(e,n,i){this.dialogRef=e,this.data=n,this.registrarManager=i,this.loading=!1}ngOnInit(){this.theme=this.data.theme,this.applicationForm=this.data.applicationForm,this.formArray=new on([]);for(let e of this.applicationForm.moduleClassNames)this.addModule(e);this.formArray.length===0&&this.addModule(),this.initialState=this.applicationForm.automaticApproval?"auto":"manual",this.extensionState=this.applicationForm.automaticApprovalExtension?"auto":"manual",this.embeddedState=this.applicationForm.automaticApprovalEmbedded?"auto":"manual",this.entity=this.data.entity,this.autoRegistrationEnabled=this.data.autoRegistrationEnabled}addModule(e=""){let n=new Te(e,{validators:[he.pattern(/^[^,]*$/)],updateOn:"change"});n.markAsTouched(),this.formArray.push(n)}removeModule(e){this.formArray.removeAt(e)}trackByIndex(e){return e}onCancel(){this.dialogRef.close()}submit(){this.loading=!0;let e=this.formArray.controls.map(n=>n.value).filter(n=>n.trim()!=="");this.applicationForm.moduleClassNames=e,this.applicationForm.automaticApproval=this.initialState==="auto",this.applicationForm.automaticApprovalExtension=this.extensionState==="auto",this.applicationForm.automaticApprovalEmbedded=this.embeddedState==="auto",this.registrarManager.updateForm({form:this.applicationForm}).subscribe(n=>{this.dialogRef.close(n)},()=>this.loading=!1)}static{this.\u0275fac=function(n){return new(n||t)(_(U),_(j),_(tt))}}static{this.\u0275cmp=x({type:t,selectors:[["app-update-application-form-dialog"]],decls:4,vars:5,consts:[["spinner",""],[4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],["mat-dialog-title",""],["mat-dialog-content","",1,"dialog-container"],[1,"d-flex","flex-row","align-items-center"],[1,"d-flex","justify-content-center","mb-3"],["color","accent","mat-icon-button","",3,"click","matTooltip"],[1,"w-100"],["disableOptionCentering","",3,"valueChange","value"],["value","auto"],["value","manual"],["mat-dialog-actions",""],["mat-stroked-button","",1,"ms-auto",3,"click"],["color","accent","mat-flat-button","",1,"ms-2",3,"click","disabled"],[1,"w-100","mb-n2"],["matInput","",3,"formControl"],["color","warn","mat-icon-button","",3,"matTooltip"],["color","warn","mat-icon-button","",3,"click","matTooltip"]],template:function(n,i){if(n&1&&(T(0,Dd,1,0,"ng-template",null,0,B),a(2,"div"),T(3,wd,42,34,"div",1),r()),n&2){let s=y(1);o(2),H(W("",i.theme," position-relative")),o(),u("perunWebAppsLoader",i.loading)("perunWebAppsLoaderIndicator",s)}},dependencies:[D,P,G,ti,lt,st,Oe,Re,Pe,rt,Ke,Xe,Ye,$e,We,le,ze,se,qe,K,$,X,Y,oe,L,ne,V,O],encapsulation:2})}}return t})();function Pd(t,d){t&1&&A(0,"perun-web-apps-loading-dialog")}function Gd(t,d){if(t&1){let e=I();a(0,"div")(1,"h1",2),m(2),l(3,"translate"),r(),a(4,"div",3)(5,"div",4),m(6),l(7,"translate"),r(),m(8),l(9,"translate"),a(10,"perun-web-apps-vo-search-select",5),C("voSelected",function(i){f(e);let s=c();return g(s.voSelected(i))}),r(),m(11),l(12,"translate"),a(13,"perun-web-apps-group-search-select",6),C("groupSelected",function(i){f(e);let s=c();return g(s.selectedGroup=i)}),r()(),a(14,"div",7)(15,"button",8),C("click",function(){f(e);let i=c();return g(i.cancel())}),m(16),l(17,"translate"),r(),a(18,"button",9),C("click",function(){f(e);let i=c();return g(i.submit())}),m(19),l(20,"translate"),r()()()}if(t&2){let e=c();o(2),E(p(3,11,"DIALOGS.APPLICATION_FORM_COPY_ITEMS.TITLE")),o(4),h(" ",p(7,13,"DIALOGS.APPLICATION_FORM_COPY_ITEMS.DESCRIPTION")," "),o(2),h(" ",p(9,15,"DIALOGS.APPLICATION_FORM_COPY_ITEMS.SOURCE_VO"),": "),o(2),u("vos",e.vos),o(),h(" ",p(12,17,"DIALOGS.APPLICATION_FORM_COPY_ITEMS.SOURCE_GROUP"),": "),o(2),u("groups",e.groups)("firstSelectedGroup",e.selectedGroup)("disableAutoSelect",!0),o(3),h(" ",p(17,19,"DIALOGS.APPLICATION_FORM_COPY_ITEMS.CANCEL_BUTTON")," "),o(2),u("disabled",!e.selectedVo&&!e.selectedGroup||e.loading),o(),h(" ",p(20,21,"DIALOGS.APPLICATION_FORM_COPY_ITEMS.SUBMIT_BUTTON")," ")}}var oo=(()=>{class t{constructor(e,n,i,s,S,M,R,N,re){this.dialogRef=e,this.voService=n,this.groupService=i,this.translateService=s,this.registrarManager=S,this.notificatorService=M,this.apiRequest=R,this.cd=N,this.data=re,this.vos=[],this.groups=[],this.selectedGroup=null,this.loading=!1,this.nameFunction=xe=>xe.name,s.get("DIALOGS.APPLICATION_FORM_COPY_ITEMS.SUCCESS").subscribe(xe=>this.successMessage=xe),s.get("DIALOGS.APPLICATION_FORM_COPY_ITEMS.PRIVILEGE").subscribe(xe=>this.privilegeMessage=xe),s.get("DIALOGS.APPLICATION_FORM_COPY_ITEMS.NO_FORM").subscribe(xe=>this.noFormMessage=xe),s.get("DIALOGS.APPLICATION_FORM_COPY_ITEMS.NO_SUBMIT_BUTTON").subscribe(xe=>this.noSubmitButtonMessage=xe)}ngOnInit(){this.loading=!0,this.theme=this.data.theme,this.translateService.get("DIALOGS.APPLICATION_FORM_COPY_ITEMS.NO_GROUP_SELECTED").subscribe({next:e=>{this.fakeGroup={id:-1,name:e,voId:0,parentGroupId:0,shortName:"",description:"",beanName:"group"},this.selectedGroup=this.fakeGroup,this.voService.getMyVos().subscribe({next:n=>{this.vos=n,this.loading=!1,this.vos.length>0&&this.voSelected(this.vos.sort(ta)[0])},error:()=>{this.loading=!1}})},error:()=>{this.loading=!1}})}cancel(){this.dialogRef.close(!1)}submit(){this.apiRequest.dontHandleErrorForNext(),this.loading=!0,this.data.groupId?this.selectedGroup===this.fakeGroup?this.registrarManager.copyFormFromVoToGroup(this.selectedVo.id,this.data.groupId).subscribe({next:()=>{this.notificatorService.showSuccess(this.successMessage),this.dialogRef.close(!0)},error:e=>{e.name==="FormNotExistsException"&&this.notificatorService.showError(this.noFormMessage),e.name==="PrivilegeException"&&this.notificatorService.showError(this.privilegeMessage),this.loading=!1}}):this.registrarManager.copyFormFromGroupToGroup(this.selectedGroup.id,this.data.groupId).subscribe({next:()=>{this.notificatorService.showSuccess(this.successMessage),this.dialogRef.close(!0)},error:e=>{e.name==="FormNotExistsException"?this.notificatorService.showError(this.noFormMessage):e.name==="PrivilegeException"?this.notificatorService.showError(this.privilegeMessage):e.name==="MissingSubmitButtonException"?this.notificatorService.showError(e.name,e,e.message+" "+this.noSubmitButtonMessage):this.notificatorService.showRPCError(e),this.loading=!1}}):this.selectedGroup===this.fakeGroup?this.registrarManager.copyFormFromVoToVo(this.selectedVo.id,this.data.voId).subscribe({next:()=>{this.notificatorService.showSuccess(this.successMessage),this.dialogRef.close(!0)},error:e=>{e.name==="FormNotExistsException"&&this.notificatorService.showError(this.noFormMessage),e.name==="PrivilegeException"&&this.notificatorService.showError(this.privilegeMessage),this.loading=!1}}):this.registrarManager.copyFormFromGroupToVo(this.selectedGroup.id,this.data.voId).subscribe({next:()=>{this.notificatorService.showSuccess(this.successMessage),this.dialogRef.close(!0)},error:e=>{e.name==="FormNotExistsException"&&this.notificatorService.showError(this.noFormMessage),e.name==="PrivilegeException"&&this.notificatorService.showError(this.privilegeMessage),this.loading=!1}})}voSelected(e){this.selectedVo=e,this.cd.detectChanges(),this.getGroups()}getGroups(){this.selectedVo!==void 0?this.groupService.getAllGroups(this.selectedVo.id).subscribe(e=>{this.groups=[this.fakeGroup].concat(e)}):this.groups=[this.fakeGroup],this.selectedGroup=this.fakeGroup}static{this.\u0275fac=function(n){return new(n||t)(_(U),_(Vt),_(De),_(Mt),_(tt),_(q),_(xt),_(yt),_(j))}}static{this.\u0275cmp=x({type:t,selectors:[["app-application-form-copy-items-dialog"]],decls:4,vars:5,consts:[["spinner",""],[4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],["mat-dialog-title",""],["mat-dialog-content","",1,"dialog-container"],[1,"mb-2","font-italic"],[1,"long-input",3,"voSelected","vos"],[1,"long-input",3,"groupSelected","groups","firstSelectedGroup","disableAutoSelect"],["mat-dialog-actions",""],["mat-stroked-button","",1,"ms-auto",3,"click"],["color","accent","mat-flat-button","",1,"ms-2",3,"click","disabled"]],template:function(n,i){if(n&1&&(T(0,Pd,1,0,"ng-template",null,0,B),a(2,"div"),T(3,Gd,21,23,"div",1),r()),n&2){let s=y(1);o(2),H(W("",i.theme," position-relative")),o(),u("perunWebAppsLoader",i.loading)("perunWebAppsLoaderIndicator",s)}},dependencies:[D,P,G,K,$,X,Y,oe,L,Wn,jn,V,O],encapsulation:2})}}return t})();var en=(()=>{class t{constructor(e){this.translateService=e,this.returnData=""}transform(e){return this.translateService.get("VO_DETAIL.SETTINGS.APPLICATION_FORM.TYPES."+e).subscribe(n=>{this.returnData=n}),this.returnData}static{this.\u0275fac=function(n){return new(n||t)(_(Se,16))}}static{this.\u0275pipe=ei({name:"applicationFormItemType",type:t,pure:!0})}}return t})();function Nd(t,d){if(t&1&&(a(0,"mat-option",5),m(1),l(2,"applicationFormItemType"),r()),t&2){let e=d.$implicit;u("value",e),o(),h(" ",p(2,2,e)," ")}}function Bd(t,d){if(t&1&&(a(0,"mat-option",5),m(1),r()),t&2){let e=d.$implicit;u("value",e),o(),h(" ",e," ")}}var ao=(()=>{class t{constructor(e,n,i,s){this.dialogRef=e,this.data=n,this.translateService=i,this.store=s,this.languages=this.store.getProperty("supported_languages"),this.items=[],this.selectedWidget="HEADING",this.widgets=["HEADING","HTML_COMMENT","TEXTFIELD","VALIDATED_EMAIL","USERNAME","PASSWORD","SELECTIONBOX","TEXTAREA","COMBOBOX","CHECKBOX","SUBMIT_BUTTON","RADIO","TIMEZONE","AUTO_SUBMIT_BUTTON","EMBEDDED_GROUP_APPLICATION","LIST_INPUT_BOX","MAP_INPUT_BOX"]}ngOnInit(){this.translateService.get("DIALOGS.APPLICATION_FORM_ADD_ITEM.INSERT_TO_BEGINNING").subscribe(e=>{this.nameCtrl=new hi("",[he.required,he.pattern(".*[\\S]+.*"),he.maxLength(129)]),this.nameCtrl.markAllAsTouched(),this.items.push(e);for(let n of this.data.applicationFormItems)this.items.push(n.shortname),n.type===an.EMBEDDED_GROUP_APPLICATION&&(this.widgets=this.widgets.filter(i=>i!==an.EMBEDDED_GROUP_APPLICATION));this.selectedItem=e})}setInputWidgetHeight(e){return Math.ceil(e/80)+2.5}cancel(){this.dialogRef.close(void 0)}submit(){let e=this.createApplicationItem();this.dialogRef.close([this.data.applicationFormItems,e])}createApplicationItem(){let e=wn(this.languages);e.id=this.data.fakeId,e.shortname=this.nameCtrl.value,e.type=this.selectedWidget;for(let n=0;n<this.items.length;n++)if(this.selectedItem===this.items[n])return this.data.applicationFormItems.splice(n,0,e),e}static{this.\u0275fac=function(n){return new(n||t)(_(U),_(j),_(Se),_(Le))}}static{this.\u0275cmp=x({type:t,selectors:[["app-add-application-form-item-dialog"]],decls:36,vars:28,consts:[["mat-dialog-title",""],["mat-dialog-content","",1,"dialog-container"],["data-cy","item-short-name","matInput","","required","",3,"formControl"],["subscriptSizing","dynamic",1,"mb-4"],["disableOptionCentering","",3,"ngModelChange","ngModel"],[3,"value"],["mat-dialog-actions",""],["mat-stroked-button","",1,"ms-auto",3,"click"],["color","accent","data-cy","add-form-item-button-dialog","mat-flat-button","",1,"ms-2",3,"click","disabled"]],template:function(n,i){n&1&&(a(0,"h1",0),m(1),l(2,"translate"),r(),a(3,"div",1)(4,"mat-form-field")(5,"mat-label"),m(6),l(7,"translate"),r(),A(8,"input",2),a(9,"mat-error"),m(10),l(11,"translate"),r()(),a(12,"mat-form-field",3)(13,"mat-label"),m(14),l(15,"translate"),r(),a(16,"mat-select",4),te("ngModelChange",function(S){return ee(i.selectedWidget,S)||(i.selectedWidget=S),S}),de(17,Nd,3,4,"mat-option",5,Ce),r(),a(19,"mat-hint"),m(20),l(21,"translate"),r()(),a(22,"mat-form-field")(23,"mat-label"),m(24),l(25,"translate"),r(),a(26,"mat-select",4),te("ngModelChange",function(S){return ee(i.selectedItem,S)||(i.selectedItem=S),S}),de(27,Bd,2,2,"mat-option",5,Ce),r()()(),a(29,"div",6)(30,"button",7),C("click",function(){return i.cancel()}),m(31),l(32,"translate"),r(),a(33,"button",8),C("click",function(){return i.submit()}),m(34),l(35,"translate"),r()()),n&2&&(o(),E(p(2,12,"DIALOGS.APPLICATION_FORM_ADD_ITEM.TITLE")),o(5),h("",p(7,14,"DIALOGS.APPLICATION_FORM_ADD_ITEM.SHORT_NAME"),":"),o(2),u("formControl",i.nameCtrl),o(2),h(" ",p(11,16,"DIALOGS.APPLICATION_FORM_ADD_ITEM.FILL_NAME")," "),o(4),h("",p(15,18,"DIALOGS.APPLICATION_FORM_ADD_ITEM.INPUT_WIDGET"),":"),o(2),J("ngModel",i.selectedWidget),o(),ce(i.widgets),o(3),h(" ",p(21,20,"VO_DETAIL.SETTINGS.APPLICATION_FORM.WIDGET_DESCRIPTION."+i.selectedWidget)," "),o(4),h("",p(25,22,"DIALOGS.APPLICATION_FORM_ADD_ITEM.INSERT_AFTER"),":"),o(2),J("ngModel",i.selectedItem),o(),ce(i.items),o(4),h(" ",p(32,24,"DIALOGS.APPLICATION_FORM_ADD_ITEM.CANCEL")," "),o(2),u("disabled",i.nameCtrl.invalid),o(),h(" ",p(35,26,"DIALOGS.APPLICATION_FORM_ADD_ITEM.CREATE")," "))},dependencies:[D,P,G,Oe,Re,Pe,vn,rt,Ke,Xe,Ye,$e,We,le,ze,se,It,qe,je,Ue,K,$,X,Y,L,O,en],styles:["mat-form-field[_ngcontent-%COMP%]{margin-bottom:1rem}"]})}}return t})();var Sr=(()=>{class t{constructor(e){this.translateService=e}transform(e){switch(e){case"ALWAYS":case"NEVER":case"IF_PREFILLED":case"IF_EMPTY":return this.translateService.instant("VO_DETAIL.SETTINGS.APPLICATION_FORM.DISABLED."+e);default:return e}}static{this.\u0275fac=function(n){return new(n||t)(_(Se,16))}}static{this.\u0275pipe=ei({name:"applicationFormItemDisabled",type:t,pure:!0})}}return t})();var vr=(()=>{class t{constructor(e){this.translateService=e}transform(e){switch(e){case"ALWAYS":case"NEVER":case"IF_PREFILLED":case"IF_EMPTY":return this.translateService.instant("VO_DETAIL.SETTINGS.APPLICATION_FORM.HIDDEN."+e);default:return e}}static{this.\u0275fac=function(n){return new(n||t)(_(Se,16))}}static{this.\u0275pipe=ei({name:"applicationFormItemHidden",type:t,pure:!0})}}return t})();var Fd=()=>["TEXTFIELD","USERNAME","VALIDATED_EMAIL","PASSWORD","TEXTAREA","TIMEZONE","CHECKBOX","RADIO","COMBOBOX","SELECTIONBOX","LIST_INPUT_BOX","MAP_INPUT_BOX"],kd=()=>["TEXTFIELD","USERNAME","PASSWORD","TEXTAREA","CHECKBOX","RADIO","COMBOBOX","SELECTIONBOX","LIST_INPUT_BOX","MAP_INPUT_BOX"],Ud=t=>({type:t}),jd=(t,d,e,n,i,s,S,M,R,N,re,xe,Bt)=>[t,d,e,n,i,s,S,M,R,N,re,xe,Bt],Wd=()=>["HEADING","HTML_COMMENT"],Hd=()=>["TEXTFIELD","VALIDATED_EMAIL","USERNAME","PASSWORD","RADIO","TEXTAREA","COMBOBOX","CHECKBOX","TIMEZONE","SELECTIONBOX","EMBEDDED_GROUP_APPLICATION","LIST_INPUT_BOX","MAP_INPUT_BOX"],zd=()=>["SUBMIT_BUTTON","AUTO_SUBMIT_BUTTON"],qd=()=>["RADIO","COMBOBOX","CHECKBOX","SELECTIONBOX"],br=()=>["CHECKBOX"],$d=()=>({standalone:!0});function Yd(t,d){t&1&&A(0,"perun-web-apps-loading-dialog")}function Xd(t,d){if(t&1){let e=I();a(0,"mat-checkbox",22),l(1,"translate"),te("ngModelChange",function(i){f(e);let s=c(3);return ee(s.applicationFormItem.updatable,i)||(s.applicationFormItem.updatable=i),g(i)}),m(2),l(3,"translate"),r()}if(t&2){let e=c(3);u("matTooltip",w(p(1,4,"DIALOGS.APPLICATION_FORM_EDIT_ITEM.UPDATABLE_DESCRIPTION"))),J("ngModel",e.applicationFormItem.updatable),o(2),h(" ",p(3,6,"DIALOGS.APPLICATION_FORM_EDIT_ITEM.UPDATABLE")," ")}}function Kd(t,d){if(t&1&&(a(0,"perun-web-apps-alert",26),m(1),r()),t&2){let e=c(4);o(),h(" ",e.warningMessage," ")}}function Qd(t,d){if(t&1){let e=I();a(0,"div",9)(1,"perun-web-apps-selection-item-search-select",25),l(2,"translate"),C("itemSelected",function(i){f(e);let s=c(3);return s.applicationFormItem.perunSourceAttribute=i.value,g(s.loadWarning(s.itemType.SOURCE))}),r(),v(3,Kd,2,1,"perun-web-apps-alert",26),r()}if(t&2){let e=c(3);o(),u("attributes",e.sourceAttributes)("selectedAttribute",e.applicationFormItem.perunSourceAttribute)("hint",p(2,6,"DIALOGS.APPLICATION_FORM_EDIT_ITEM.SOURCE_ATTRIBUTE_DESCRIPTION"))("asGroup",!!e.data.group)("type",e.itemType.SOURCE),o(2),b(e.displayWarningForSourceAttr?3:-1)}}function Zd(t,d){if(t&1&&(a(0,"perun-web-apps-alert",26),m(1),r()),t&2){let e=c(4);o(),h(" ",e.warningMessage," ")}}function Jd(t,d){if(t&1){let e=I();a(0,"div",9)(1,"perun-web-apps-selection-item-search-select",27),l(2,"translate"),C("itemSelected",function(i){f(e);let s=c(3);return s.applicationFormItem.perunDestinationAttribute=i.value,g(s.loadWarning(s.itemType.DESTINATION))}),r(),v(3,Zd,2,1,"perun-web-apps-alert",26),r()}if(t&2){let e=c(3);o(),u("attributes",e.destinationAttributes)("selectedAttribute",e.applicationFormItem.perunDestinationAttribute)("hint",p(2,7,"DIALOGS.APPLICATION_FORM_EDIT_ITEM.DESTINATION_ATTRIBUTE_DESCRIPTION"))("asGroup",!!e.data.group)("type",e.itemType.DESTINATION)("required",e.isApplicationFormItemOfType(e.typesRequiringDestinationAttr)),o(2),b(e.displayWarningForDestinationAttr?3:-1)}}function ec(t,d){if(t&1){let e=I();a(0,"div",9)(1,"mat-form-field",9)(2,"mat-label"),m(3),l(4,"translate"),r(),a(5,"input",8),te("ngModelChange",function(i){f(e);let s=c(3);return ee(s.applicationFormItem.federationAttribute,i)||(s.applicationFormItem.federationAttribute=i),g(i)}),r()()()}if(t&2){let e=c(3);o(3),E(p(4,2,"DIALOGS.APPLICATION_FORM_EDIT_ITEM.FEDERATION_ATTRIBUTE_VALUE")),o(2),J("ngModel",e.applicationFormItem.federationAttribute)}}function tc(t,d){if(t&1){let e=I();a(0,"div")(1,"section",11)(2,"h6"),m(3),l(4,"translate"),r(),a(5,"mat-checkbox",22),l(6,"translate"),te("ngModelChange",function(i){f(e);let s=c(2);return ee(s.applicationFormItem.required,i)||(s.applicationFormItem.required=i),g(i)}),m(7),l(8,"translate"),r(),A(9,"br"),v(10,Xd,4,8,"mat-checkbox",23),r(),a(11,"section",11)(12,"h6"),m(13),l(14,"translate"),r(),v(15,Qd,4,8,"div",9),v(16,Jd,4,9,"div",9),a(17,"div",9)(18,"perun-web-apps-selection-item-search-select",24),l(19,"translate"),C("itemSelected",function(i){f(e);let s=c(2);return g(s.changeFederationAttribute(i))}),r(),v(20,ec,6,4,"div",9),r()()()}if(t&2){let e=c(2);o(3),E(p(4,14,"DIALOGS.APPLICATION_FORM_EDIT_ITEM.USER_ACTION")),o(2),u("matTooltip",w(p(6,16,"DIALOGS.APPLICATION_FORM_EDIT_ITEM.REQUIRED_DESCRIPTION"))),J("ngModel",e.applicationFormItem.required),o(2),h(" ",p(8,18,"DIALOGS.APPLICATION_FORM_EDIT_ITEM.REQUIRED")," "),o(3),b(e.typesWithUpdatable.indexOf(e.applicationFormItem.type)>-1?10:-1),o(3),E(p(14,20,"DIALOGS.APPLICATION_FORM_EDIT_ITEM.ATTRIBUTES")),o(2),b(e.sourceAttributes!==void 0?15:-1),o(),b(e.destinationAttributes!==void 0?16:-1),o(2),u("selectedAttribute",e.applicationFormItem.federationAttribute)("asGroup",!!e.data.group)("type",e.itemType.FEDERATION)("hint",p(19,22,"DIALOGS.APPLICATION_FORM_EDIT_ITEM.FEDERATION_ATTRIBUTE_DESCRIPTION")),o(2),b(e.federationAttributeDN===" -- custom value -- "?20:-1)}}function ic(t,d){if(t&1){let e=I();a(0,"div")(1,"section",11)(2,"h6"),m(3),l(4,"translate"),r(),a(5,"mat-form-field",7)(6,"mat-label"),m(7),l(8,"translate"),r(),a(9,"input",8),te("ngModelChange",function(i){f(e);let s=c(2);return ee(s.applicationFormItem.regex,i)||(s.applicationFormItem.regex=i),g(i)}),r(),a(10,"mat-hint"),m(11),l(12,"translate"),r()()()()}if(t&2){let e=c(2);o(3),E(p(4,4,"DIALOGS.APPLICATION_FORM_EDIT_ITEM.VALIDATION")),o(4),E(p(8,6,"DIALOGS.APPLICATION_FORM_EDIT_ITEM.REGEX")),o(2),J("ngModel",e.applicationFormItem.regex),o(2),E(p(12,8,"DIALOGS.APPLICATION_FORM_EDIT_ITEM.REGEX_DESCRIPTION"))}}function nc(t,d){if(t&1&&(a(0,"mat-option",14),m(1),l(2,"applicationFormItemDisabled"),r()),t&2){let e=d.$implicit;u("value",e),o(),h(" ",p(2,2,e)," ")}}function oc(t,d){if(t&1){let e=I();a(0,"perun-web-apps-app-form-item-search-select",28),l(1,"translate"),l(2,"translate"),C("itemSelected",function(i){f(e);let s=c(3);return g(s.disabledDependencyItem=i)}),r()}if(t&2){let e=c(3);u("item",e.disabledDependencyItem)("label",p(1,4,"DIALOGS.APPLICATION_FORM_EDIT_ITEM.DISABLED_DEPENDENCY"))("hint",p(2,6,"DIALOGS.APPLICATION_FORM_EDIT_ITEM.DISABLED_DEPENDENCY_DESCRIPTION"))("items",e.possibleDependencyItems)}}function ac(t,d){if(t&1){let e=I();a(0,"div")(1,"mat-form-field",7)(2,"mat-label"),m(3),l(4,"translate"),r(),a(5,"mat-select",13),te("valueChange",function(i){f(e);let s=c(2);return ee(s.applicationFormItem.disabled,i)||(s.applicationFormItem.disabled=i),g(i)}),de(6,nc,3,4,"mat-option",14,Ce),r(),a(8,"mat-hint"),m(9),l(10,"translate"),r()(),a(11,"div",9),v(12,oc,3,8,"perun-web-apps-app-form-item-search-select",15),r()()}if(t&2){let e=c(2);o(3),E(p(4,4,"DIALOGS.APPLICATION_FORM_EDIT_ITEM.DISABLED")),o(2),J("value",e.applicationFormItem.disabled),o(),ce(e.disabledValues),o(3),E(p(10,6,"DIALOGS.APPLICATION_FORM_EDIT_ITEM.DISABLED_DESCRIPTION")),o(3),b(e.disabledDependencyItem!==null?12:-1)}}function rc(t,d){if(t&1&&(a(0,"mat-option",14),m(1),l(2,"applicationFormItemHidden"),r()),t&2){let e=d.$implicit;u("value",e),o(),h(" ",p(2,2,e)," ")}}function sc(t,d){if(t&1){let e=I();a(0,"perun-web-apps-app-form-item-search-select",28),l(1,"translate"),l(2,"translate"),C("itemSelected",function(i){f(e);let s=c(2);return g(s.hiddenDependencyItem=i)}),r()}if(t&2){let e=c(2);u("item",e.hiddenDependencyItem)("label",p(1,4,"DIALOGS.APPLICATION_FORM_EDIT_ITEM.HIDDEN_DEPENDENCY"))("hint",p(2,6,"DIALOGS.APPLICATION_FORM_EDIT_ITEM.HIDDEN_DEPENDENCY_DESCRIPTION"))("items",e.possibleDependencyItems)}}function lc(t,d){if(t&1&&(a(0,"div"),A(1,"perun-web-apps-html-content-form-field",29),r()),t&2){let e=c().$implicit,n=c(2);o(),u("inputFormControl",n.inputFormGroup.controls[e+"-html-label"])("tagType","textarea")("label","DIALOGS.APPLICATION_FORM_EDIT_ITEM.CONTENT")("hint","DIALOGS.APPLICATION_FORM_EDIT_ITEM.CONTENT_DESCRIPTION")}}function pc(t,d){if(t&1&&(a(0,"mat-form-field",7)(1,"mat-label"),m(2),l(3,"translate"),r(),A(4,"textarea",30),a(5,"mat-hint"),m(6),l(7,"translate"),r()()),t&2){let e=c(2).$implicit;o(2),E(p(3,4,"DIALOGS.APPLICATION_FORM_EDIT_ITEM.LABEL")),o(2),u("formControlName",W("",e,"-plain-label")),o(2),E(p(7,6,"DIALOGS.APPLICATION_FORM_EDIT_ITEM.LABEL_DESCRIPTION"))}}function mc(t,d){t&1&&A(0,"mat-spinner",31),t&2&&u("diameter",18)}function dc(t,d){t&1&&(a(0,"mat-hint"),m(1),l(2,"translate"),r()),t&2&&(o(),E(p(2,1,"DIALOGS.APPLICATION_FORM_EDIT_ITEM.CHECKBOX_LABEL_DESCRIPTION")))}function cc(t,d){if(t&1&&(a(0,"mat-error"),m(1),r()),t&2){let e=c(3).$implicit,n=c(2);o(),h(" ",n.inputFormGroup.controls[e+"-html-label"].errors==null?null:n.inputFormGroup.controls[e+"-html-label"].errors.invalidHtmlContent," ")}}function uc(t,d){if(t&1&&(a(0,"div")(1,"mat-form-field",7)(2,"mat-label"),m(3),l(4,"translate"),r(),A(5,"textarea",30),v(6,mc,1,1,"mat-spinner",31),v(7,dc,3,3,"mat-hint"),v(8,cc,2,1,"mat-error"),r()()),t&2){let e=c(2).$implicit,n=c(2);o(3),E(p(4,6,"DIALOGS.APPLICATION_FORM_EDIT_ITEM.LABEL")),o(2),u("formControlName",W("",e,"-html-label")),o(),b(n.inputFormGroup.controls[e+"-html-label"]!=null&&n.inputFormGroup.controls[e+"-html-label"].pending?6:-1),o(),b(n.inputFormGroup.controls[e+"-html-label"]!=null&&n.inputFormGroup.controls[e+"-html-label"].pending?-1:7),o(),b(n.inputFormGroup.controls[e+"-html-label"]!=null&&n.inputFormGroup.controls[e+"-html-label"].invalid?8:-1)}}function _c(t,d){if(t&1&&(a(0,"div"),v(1,pc,8,8,"mat-form-field",7),v(2,uc,9,8,"div"),a(3,"mat-form-field",7)(4,"mat-label"),m(5),l(6,"translate"),r(),A(7,"textarea",30),a(8,"mat-hint"),m(9),l(10,"translate"),r()(),a(11,"mat-form-field",7)(12,"mat-label"),m(13),l(14,"translate"),r(),A(15,"textarea",30),a(16,"mat-hint"),m(17),l(18,"translate"),r()()()),t&2){let e=c().$implicit,n=c(2);o(),b(n.isApplicationFormItemOfType(ue(18,br))?-1:1),o(),b(n.isApplicationFormItemOfType(ue(19,br))?2:-1),o(3),E(p(6,10,"DIALOGS.APPLICATION_FORM_EDIT_ITEM.HELP")),o(2),u("formControlName",W("",e,"-plain-help")),o(2),E(p(10,12,"DIALOGS.APPLICATION_FORM_EDIT_ITEM.HELP_DESCRIPTION")),o(4),E(p(14,14,"DIALOGS.APPLICATION_FORM_EDIT_ITEM.ERROR")),o(2),u("formControlName",W("",e,"-plain-error-message")),o(2),E(p(18,16,"DIALOGS.APPLICATION_FORM_EDIT_ITEM.ERROR_DESCRIPTION"))}}function hc(t,d){if(t&1&&(a(0,"div")(1,"mat-form-field",7)(2,"mat-label"),m(3),l(4,"translate"),r(),A(5,"textarea",30),a(6,"mat-hint"),m(7),l(8,"translate"),r()()()),t&2){let e=c().$implicit;o(3),E(p(4,4,"DIALOGS.APPLICATION_FORM_EDIT_ITEM.LABEL")),o(2),u("formControlName",W("",e,"-plain-label")),o(2),E(p(8,6,"DIALOGS.APPLICATION_FORM_EDIT_ITEM.LABEL_BUTTON_DESCRIPTION"))}}function fc(t,d){t&1&&A(0,"mat-spinner",31),t&2&&u("diameter",18)}function gc(t,d){if(t&1&&(a(0,"mat-error",47),m(1),r()),t&2){let e=c().$implicit;o(),E(e[1].errors==null?null:e[1].errors.invalidHtmlContent)}}function Cc(t,d){if(t&1){let e=I();a(0,"div",38)(1,"div",41)(2,"mat-form-field",42)(3,"mat-label"),m(4),l(5,"translate"),r(),a(6,"input",43),te("ngModelChange",function(i){let s=f(e).$implicit;return ee(s[0],i)||(s[0]=i),g(i)}),r()(),a(7,"mat-form-field",44)(8,"mat-label"),m(9),l(10,"translate"),r(),A(11,"input",45),v(12,fc,1,1,"mat-spinner",31),r(),a(13,"button",46),l(14,"translate"),C("click",function(){let i=f(e).$implicit,s=c(2).$implicit,S=c(2);return g(S.removeOption(i,s))}),a(15,"mat-icon"),m(16,"remove_circle"),r()()(),a(17,"div"),v(18,gc,2,1,"mat-error",47),r()()}if(t&2){let e=d.$implicit;o(4),E(p(5,9,"DIALOGS.APPLICATION_FORM_EDIT_ITEM.VALUE")),o(2),J("ngModel",e[0]),u("ngModelOptions",ue(15,$d)),o(3),E(p(10,11,"DIALOGS.APPLICATION_FORM_EDIT_ITEM.LABEL")),o(2),u("formControl",e[1]),o(),b(e[1].pending?12:-1),o(),u("matTooltip",w(p(14,13,"DIALOGS.APPLICATION_FORM_EDIT_ITEM.REMOVE_OPTION"))),o(5),b(e[1].invalid?18:-1)}}function Sc(t,d){if(t&1){let e=I();a(0,"div",11)(1,"h6"),m(2,"Options"),r(),a(3,"perun-web-apps-alert",32),m(4),l(5,"translate"),r(),a(6,"div",33)(7,"button",34),C("click",function(){f(e);let i=c().$implicit,s=c(2);return g(s.sortOptionsAZ(i))}),a(8,"i",35),m(9,"arrow_downward"),r(),m(10),l(11,"translate"),r(),a(12,"button",36),C("click",function(){f(e);let i=c().$implicit,s=c(2);return g(s.sortOptionsZA(i))}),a(13,"i",35),m(14,"arrow_upward"),r(),m(15),l(16,"translate"),r()(),a(17,"div",37),de(18,Cc,19,16,"div",38,Ce),r(),a(20,"div",39)(21,"button",40),C("click",function(){f(e);let i=c().$implicit,s=c(2);return g(s.addOption(i))}),m(22),l(23,"translate"),r()()()}if(t&2){let e=c().$implicit,n=c(2);o(4),h(" ",p(5,4,"DIALOGS.APPLICATION_FORM_EDIT_ITEM.OPTIONS_DESCRIPTION")," "),o(6),h(" ",p(11,6,"DIALOGS.APPLICATION_FORM_EDIT_ITEM.SORT_BY_LABEL_AZ")," "),o(5),h(" ",p(16,8,"DIALOGS.APPLICATION_FORM_EDIT_ITEM.SORT_BY_LABEL_ZA")," "),o(3),ce(n.options[e]),o(4),h(" ",p(23,10,"DIALOGS.APPLICATION_FORM_EDIT_ITEM.ADD_OPTION")," ")}}function vc(t,d){if(t&1&&(a(0,"mat-tab",16),l(1,"uppercase"),l(2,"translate"),v(3,lc,2,4,"div"),v(4,_c,19,20,"div"),v(5,hc,9,8,"div"),v(6,Sc,24,12,"div",11),r()),t&2){let e=d.$implicit,n=c(2);u("label",w(p(2,9,p(1,7,"DIALOGS.APPLICATION_FORM_EDIT_ITEM.LANGUAGE_"+e))))("formGroup",n.inputFormGroup),o(3),b(n.isApplicationFormItemOfType(ue(11,Wd))?3:-1),o(),b(n.isApplicationFormItemOfType(ue(12,Hd))?4:-1),o(),b(n.isApplicationFormItemOfType(ue(13,zd))?5:-1),o(),b(n.isApplicationFormItemOfType(ue(14,qd))?6:-1)}}function bc(t,d){if(t&1){let e=I();a(0,"div",2)(1,"h1",3),m(2),l(3,"translate"),r(),a(4,"div",4)(5,"mat-tab-group",5)(6,"mat-tab",6),l(7,"translate"),a(8,"mat-form-field",7)(9,"mat-label"),m(10),l(11,"translate"),r(),a(12,"input",8),te("ngModelChange",function(i){f(e);let s=c();return ee(s.applicationFormItem.shortname,i)||(s.applicationFormItem.shortname=i),g(i)}),r(),a(13,"mat-hint"),m(14),l(15,"translate"),r()(),a(16,"mat-form-field",9)(17,"mat-label"),m(18),l(19,"translate"),r(),A(20,"input",10),l(21,"applicationFormItemType"),r(),a(22,"section",11)(23,"h6"),m(24),l(25,"translate"),r(),a(26,"mat-checkbox",12),l(27,"translate"),C("change",function(){f(e);let i=c();return g(i.onChangingType("INITIAL"))}),m(28),l(29,"translate"),r(),A(30,"br"),a(31,"mat-checkbox",12),l(32,"translate"),C("change",function(){f(e);let i=c();return g(i.onChangingType("EXTENSION"))}),m(33),l(34,"translate"),r()(),v(35,tc,21,24,"div"),v(36,ic,13,10,"div"),a(37,"section",11)(38,"h6"),m(39),l(40,"translate"),r(),v(41,ac,13,8,"div"),a(42,"mat-form-field",7)(43,"mat-label"),m(44),l(45,"translate"),r(),a(46,"mat-select",13),te("valueChange",function(i){f(e);let s=c();return ee(s.applicationFormItem.hidden,i)||(s.applicationFormItem.hidden=i),g(i)}),de(47,rc,3,4,"mat-option",14,Ce),r(),a(49,"mat-hint"),m(50),l(51,"translate"),r()(),a(52,"div",9),v(53,sc,3,8,"perun-web-apps-app-form-item-search-select",15),r()()(),de(54,vc,7,15,"mat-tab",16,Ce),r()(),a(56,"div",17)(57,"button",18),C("click",function(){f(e);let i=c();return g(i.cancel())}),m(58),l(59,"translate"),r(),a(60,"div",19),l(61,"translate"),a(62,"div",20),l(63,"translate"),a(64,"div",19),l(65,"translate"),a(66,"button",21),l(67,"disableSubmitOnAppItemEdit"),C("click",function(){f(e);let i=c();return g(i.submit())}),m(68),l(69,"translate"),r()()()()()()}if(t&2){let e=c();o(2),ot(" ",p(3,40,"DIALOGS.APPLICATION_FORM_EDIT_ITEM.TITLE")," : ",e.applicationFormItem.shortname," "),o(4),u("label",w(p(7,42,"DIALOGS.APPLICATION_FORM_EDIT_ITEM.BASIC_SETTINGS"))),o(4),E(p(11,44,"DIALOGS.APPLICATION_FORM_EDIT_ITEM.SHORT_NAME")),o(2),J("ngModel",e.applicationFormItem.shortname),o(2),E(p(15,46,"DIALOGS.APPLICATION_FORM_EDIT_ITEM.SHORT_NAME_DESCRIPTION")),o(4),h(" ",p(19,48,"DIALOGS.APPLICATION_FORM_EDIT_ITEM.INPUT_WIDGET")," "),o(2),u("value",w(p(21,50,e.applicationFormItem.type))),o(4),E(p(25,52,"DIALOGS.APPLICATION_FORM_EDIT_ITEM.DISPLAY_ON_APPLICATION")),o(2),u("matTooltip",w(p(27,54,"DIALOGS.APPLICATION_FORM_EDIT_ITEM.DISPLAY_ON_APPLICATION_INITIAL")))("ngModel",e.applicationFormItem.applicationTypes.includes("INITIAL")),o(2),h(" ",p(29,56,"DIALOGS.APPLICATION_FORM_EDIT_ITEM.INITIAL")," "),o(3),u("matTooltip",w(p(32,58,"DIALOGS.APPLICATION_FORM_EDIT_ITEM.DISPLAY_ON_APPLICATION_EXTENSION")))("ngModel",e.applicationFormItem.applicationTypes.includes("EXTENSION")),o(2),h(" ",p(34,60,"DIALOGS.APPLICATION_FORM_EDIT_ITEM.EXTENSION")," "),o(2),b(e.isApplicationFormItemOfType(ue(93,Fd))?35:-1),o(),b(e.isApplicationFormItemOfType(ue(94,kd))?36:-1),o(3),E(p(40,62,"DIALOGS.APPLICATION_FORM_EDIT_ITEM.INTERACTIVITY")),o(2),b(e.typesWithDisabled.indexOf(e.applicationFormItem.type)>-1?41:-1),o(3),E(p(45,64,"DIALOGS.APPLICATION_FORM_EDIT_ITEM.HIDDEN")),o(2),J("value",e.applicationFormItem.hidden),o(),ce(e.hiddenValues),o(3),E(p(51,66,"DIALOGS.APPLICATION_FORM_EDIT_ITEM.HIDDEN_DESCRIPTION")),o(3),b(e.hiddenDependencyItem!==null?53:-1),o(),ce(e.languages),o(4),h(" ",p(59,68,"DIALOGS.APPLICATION_FORM_EDIT_ITEM.CANCEL_BUTTON")," "),o(2),u("matTooltip",w(p(61,70,"DIALOGS.APPLICATION_FORM_EDIT_ITEM.SUBMIT_BUTTON_DISABLED_TOOLTIP")))("matTooltipDisabled",!e.applicationFormItem.required||e.applicationFormItem.perunSourceAttribute!==""||e.applicationFormItem.federationAttribute!==""||e.applicationFormItem.disabled!=="ALWAYS"&&e.applicationFormItem.hidden!=="ALWAYS"),o(2),u("matTooltip",w(p(63,72,"DIALOGS.APPLICATION_FORM_EDIT_ITEM.INVALID_HTML_CONTENT")))("matTooltipDisabled",!e.inputFormGroup.invalid&&!e.optionsFormArray.invalid)("matTooltipPosition","above"),o(2),u("matTooltip",w(Me(65,74,"DIALOGS.APPLICATION_FORM_EDIT_ITEM.SUBMIT_BUTTON_DISABLED_TOOLTIP_DESTINATION_MISSING",ke(95,Ud,e.applicationFormItem.type))))("matTooltipDisabled",!e.isApplicationFormItemOfType(e.typesRequiringDestinationAttr)||e.applicationFormItem.perunDestinationAttribute!==""&&e.applicationFormItem.perunDestinationAttribute!==null),o(2),u("disabled",Oo(67,77,Ro(97,jd,[e.inputFormGroup.invalid,e.inputFormGroup.pending,e.optionsFormArray.invalid,e.optionsFormArray.pending,e.loading,e.applicationFormItem.required,e.applicationFormItem.perunSourceAttribute,e.applicationFormItem.federationAttribute,e.applicationFormItem.disabled,e.applicationFormItem.hidden,e.applicationFormItem.type,e.applicationFormItem.perunDestinationAttribute,e.typesRequiringDestinationAttr]))),o(2),h(" ",p(69,91,"DIALOGS.APPLICATION_FORM_EDIT_ITEM.SUBMIT_BUTTON")," ")}}var tn=(()=>{class t{constructor(e,n,i,s,S,M,R){this.dialogRef=e,this.data=n,this.attributesManager=i,this.translate=s,this.store=S,this.cd=M,this.escapeService=R,this.federationAttributeDN="",this.itemType=bo,this.loading=!0,this.hiddenValues=["NEVER","ALWAYS","IF_EMPTY","IF_PREFILLED"],this.disabledValues=["NEVER","ALWAYS","IF_EMPTY","IF_PREFILLED"],this.possibleDependencyItems=[],this.inputFormGroup=null,this.optionsFormArray=new on([]),this.typesWithUpdatable=["VALIDATED_EMAIL","TEXTFIELD","TEXTAREA","CHECKBOX","RADIO","SELECTIONBOX","COMBOBOX","TIMEZONE"],this.typesWithDisabled=["USERNAME","PASSWORD","VALIDATED_EMAIL","TEXTFIELD","TEXTAREA","CHECKBOX","RADIO","SELECTIONBOX","COMBOBOX","LIST_INPUT_BOX","MAP_INPUT_BOX"],this.hiddenDependencyItem=null,this.disabledDependencyItem=null,this.warningMessage="",this.displayWarningForSourceAttr=!1,this.displayWarningForDestinationAttr=!1,this.languages=["en"],this.typesRequiringDestinationAttr=[an.PASSWORD],this.dependencyTypes=["PASSWORD","VALIDATED_EMAIL","TEXTFIELD","TEXTAREA","CHECKBOX","RADIO","SELECTIONBOX","COMBOBOX","USERNAME"]}ngOnInit(){this.languages=this.store.getProperty("supported_languages"),this.hiddenDependencyItem=this.data.allItems.find(e=>e.id===this.data.applicationFormItem.hiddenDependencyItemId),this.hiddenDependencyItem||(this.hiddenDependencyItem=Ki),this.disabledDependencyItem=this.data.allItems.find(e=>e.id===this.data.applicationFormItem.disabledDependencyItemId),this.disabledDependencyItem||(this.disabledDependencyItem=Ki),this.theme=this.data.theme,this.possibleDependencyItems=this.getPossibleDepItems(),this.applicationFormItem=wn(this.languages),this.copy(this.data.applicationFormItem,this.applicationFormItem),this.getOptions(),this.prepareFormControls(),this.loading=!0,this.attributesManager.getAllAttributeDefinitions().subscribe({next:e=>{let n=this.filterAttributesForWidget(e),i=this.findAttribute(e,this.applicationFormItem.perunSourceAttribute);this.sourceAttributes=i?n.concat(i):n;let s=this.findAttribute(e,this.applicationFormItem.perunDestinationAttribute);this.destinationAttributes=s?n.concat(s):n,this.loading=!1},error:()=>this.loading=!1}),this.applicationFormItem.perunDestinationAttribute===null&&(this.applicationFormItem.perunDestinationAttribute=""),this.applicationFormItem.perunSourceAttribute===null&&(this.applicationFormItem.perunSourceAttribute="")}loadWarning(e){this.warningMessage="";let n=this.data.allItems.find(s=>s.hiddenDependencyItemId===this.data.applicationFormItem.id),i=this.data.allItems.find(s=>s.disabledDependencyItemId===this.data.applicationFormItem.id);(n||i)&&(e===bo.SOURCE?this.displayWarningForSourceAttr=!0:this.displayWarningForDestinationAttr=!0,this.warningMessage=this.translate.instant("DIALOGS.APPLICATION_FORM_EDIT_ITEM.DEPENDENCY_WARNING_MESSAGE",n?{dependency:"hidden",shortname:n.shortname}:{dependency:"disabled",shortname:i.shortname}),this.cd.detectChanges())}cancel(){this.dialogRef.close()}submit(){this.applicationFormItem.hiddenDependencyItemId=this.hiddenDependencyItem===Ki?null:this.hiddenDependencyItem.id,this.applicationFormItem.disabledDependencyItemId=this.disabledDependencyItem===Ki?null:this.disabledDependencyItem.id;for(let e of this.languages)this.applicationFormItem.type==="HTML_COMMENT"||this.applicationFormItem.type==="HEADING"||this.applicationFormItem.type==="CHECKBOX"?this.applicationFormItem.i18n[e].label=this.inputFormGroup.get(`${e}-html-label`).value:this.applicationFormItem.i18n[e].label=this.inputFormGroup.get(`${e}-plain-label`).value,this.applicationFormItem.i18n[e].errorMessage=this.inputFormGroup.get(`${e}-plain-error-message`).value,this.applicationFormItem.i18n[e].help=this.inputFormGroup.get(`${e}-plain-help`).value;this.updateOptions(),this.copy(this.applicationFormItem,this.data.applicationFormItem),this.dialogRef.close(!0)}onChangingType(e){if(this.applicationFormItem.applicationTypes.includes(e)){let n=this.applicationFormItem.applicationTypes.indexOf(e);this.applicationFormItem.applicationTypes.splice(n,1)}else this.applicationFormItem.applicationTypes.push(e)}addOption(e){let n=new Te("",[],[this.escapeService.checkboxValidator()]);n.markAsTouched(),this.optionsFormArray.push(n),this.options[e].push(["",n])}removeOption(e,n){this.options[n]=this.options[n].filter(s=>!(s[0]===e[0]&&s[1].value===e[1].value));let i=[];for(let s of this.languages)i=i.concat(this.options[s].map(S=>S[1]));this.optionsFormArray=new on(i)}sortOptionsAZ(e){this.options[e]=this.options[e].sort((n,i)=>n[1].value>i[1].value?1:n[1].value<i[1].value?-1:0)}sortOptionsZA(e){this.options[e]=this.options[e].sort((n,i)=>n[1].value>i[1].value?-1:n[1].value<i[1].value?1:0)}isApplicationFormItemOfType(e){return e.includes(this.applicationFormItem.type)}changeFederationAttribute(e){this.applicationFormItem.federationAttribute=e.value,this.federationAttributeDN=e.displayName,this.cd.detectChanges()}copy(e,n){n.applicationTypes=[...e.applicationTypes],n.federationAttribute=e.federationAttribute,n.forDelete=e.forDelete;for(let i of this.languages)n.i18n[i].errorMessage=e.i18n[i].errorMessage,n.i18n[i].help=e.i18n[i].help,n.i18n[i].label=e.i18n[i].label,n.i18n[i].options=e.i18n[i].options;n.id=e.id,n.ordnum=e.ordnum,n.perunDestinationAttribute=e.perunDestinationAttribute,n.perunSourceAttribute=e.perunSourceAttribute,n.regex=e.regex,n.required=e.required,n.shortname=e.shortname,n.type=e.type,n.updatable=e.updatable,n.disabled=e.disabled,n.hidden=e.hidden,n.disabledDependencyItemId=e.disabledDependencyItemId,n.hiddenDependencyItemId=e.hiddenDependencyItemId}prepareFormControls(){let e={};for(let n of this.languages)(this.applicationFormItem.type==="HTML_COMMENT"||this.applicationFormItem.type==="HEADING")&&(e[`${n}-html-label`]=new Te(this.applicationFormItem.i18n[n].label),e[`${n}-html-label`].markAsTouched()),this.applicationFormItem.type==="CHECKBOX"&&(e[`${n}-html-label`]=new Te(this.applicationFormItem.i18n[n].label,[],[this.escapeService.checkboxValidator()]),e[`${n}-html-label`].markAsTouched()),e[`${n}-plain-error-message`]=new Te(this.applicationFormItem.i18n[n].errorMessage,[]),e[`${n}-plain-help`]=new Te(this.applicationFormItem.i18n[n].help,[]),e[`${n}-plain-label`]=new Te(this.applicationFormItem.i18n[n].label,[]),e[`${n}-plain-label`].markAsTouched(),e[`${n}-plain-error-message`].markAsTouched(),e[`${n}-plain-help`].markAsTouched();this.inputFormGroup=new Po(e)}getOptions(){this.options={};for(let e of this.languages)if(this.options[e]=[],this.applicationFormItem.i18n[e].options){let n=this.applicationFormItem.i18n[e].options.split("|");for(let i of n){let s=i.split("#"),S=new Te(s[1],[],[this.escapeService.checkboxValidator()]);S.markAsTouched(),this.optionsFormArray.push(S),this.options[e].push([s[0],S])}}}getPossibleDepItems(){return[Ki].concat(this.data.allItems.filter(e=>this.dependencyTypes.includes(e.type)).filter(e=>e.id!==this.data.applicationFormItem.id))}updateOption(e){let n="";if(this.options[e]??!1)for(let i of this.options[e])i[0]!==""&&i[1].value!==""&&(n===""?n=i[0]+"#"+i[1].value:n=n+"|"+i[0]+"#"+i[1].value);this.applicationFormItem.i18n[e].options=n}updateOptions(){for(let e of this.languages)this.updateOption(e)}findAttribute(e,n){return e.find(i=>n.includes(i.friendlyName))}filterAttributesForWidget(e){return this.applicationFormItem.type==="MAP_INPUT_BOX"?e.filter(n=>n.type.includes("LinkedHashMap")):this.applicationFormItem.type==="LIST_INPUT_BOX"?e.filter(n=>n.type.includes("ArrayList")):e.filter(n=>!n.type.includes("ArrayList")&&!n.type.includes("LinkedHashMap"))}static{this.\u0275fac=function(n){return new(n||t)(_(U),_(j),_(Tt),_(Mt),_(Le),_(yt),_(ma))}}static{this.\u0275cmp=x({type:t,selectors:[["app-edit-application-form-item-dialog"]],decls:4,vars:5,consts:[["spinner",""],["class","h-100 d-flex flex-column",4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],[1,"h-100","d-flex","flex-column"],["mat-dialog-title",""],["mat-dialog-content","",1,"dialog-container"],["color","primary","mat-stretch-tabs","false"],[3,"label"],["subscriptSizing","dynamic",1,"w-100"],["matInput","",3,"ngModelChange","ngModel"],[1,"w-100"],["matInput","","readonly","",3,"value"],[1,"mt-4"],["matTooltipPosition","after",3,"change","ngModel","matTooltip"],["disableOptionCentering","",3,"valueChange","value"],[3,"value"],[3,"item","label","hint","items"],[3,"label","formGroup"],["mat-dialog-actions","",1,"d-flex"],["mat-stroked-button","",1,"ms-auto","mt-auto",3,"click"],[3,"matTooltipDisabled","matTooltip"],[3,"matTooltipDisabled","matTooltipPosition","matTooltip"],["mat-flat-button","","color","accent","data-cy","edit-form-item-button-dialog",1,"ms-2","mt-auto",3,"click","disabled"],["matTooltipPosition","after",3,"ngModelChange","ngModel","matTooltip"],["matTooltipPosition","after",3,"ngModel","matTooltip"],[3,"itemSelected","selectedAttribute","asGroup","type","hint"],[3,"itemSelected","attributes","selectedAttribute","hint","asGroup","type"],["alert_type","warn"],[3,"itemSelected","attributes","selectedAttribute","hint","asGroup","type","required"],[3,"itemSelected","item","label","hint","items"],[3,"inputFormControl","tagType","label","hint"],["matInput","",3,"formControlName"],["matSuffix","",1,"input-spinner",3,"diameter"],["alert_type","info"],[1,"d-flex","mt-2","mb-2"],["mat-stroked-button","",1,"ms-auto","me-2",3,"click"],[1,"material-icons"],["mat-stroked-button","",1,"me-auto",3,"click"],[1,"d-flex","flex-column","justify-content-center"],[1,"mb-2"],[1,"d-flex","justify-content-center"],["color","accent","mat-flat-button","",1,"me-2",3,"click"],[1,"d-flex","flex-row","justify-content-center","align-items-center"],["subscriptSizing","dynamic",1,"mx-4"],["matInput","",3,"ngModelChange","ngModel","ngModelOptions"],["subscriptSizing","dynamic"],["matInput","",3,"formControl"],["color","warn","mat-icon-button","",3,"click","matTooltip"],[1,"ms-5","mt-1"]],template:function(n,i){if(n&1&&(T(0,Yd,1,0,"ng-template",null,0,B),a(2,"div"),T(3,bc,70,111,"div",1),r()),n&2){let s=y(1);o(2),H(W("",i.theme," h-100 position-relative")),o(),u("perunWebAppsLoader",i.loading)("perunWebAppsLoaderIndicator",s)}},dependencies:[D,P,G,ti,lt,st,Oe,Re,Pe,vn,rt,wi,Ke,Xe,Ye,$e,We,Pt,wt,le,ze,se,_i,qe,Ri,Oi,je,Ue,K,$,X,Y,be,ve,oe,Ln,Rn,On,Ci,gi,L,ne,ja,Ha,Qa,V,At,O,Sr,vr,en,xa],styles:[".mat-mdc-form-field-error-wrapper{word-break:break-word}.input-spinner[_ngcontent-%COMP%]{float:right;margin-left:5px}"]})}}return t})();function Ec(t,d){t&1&&(a(0,"div")(1,"div",6),m(2),l(3,"translate"),r(),a(4,"div"),m(5),l(6,"translate"),r(),a(7,"div",7),m(8),l(9,"translate"),r()()),t&2&&(o(2),h(" ",p(3,3,"DIALOGS.DELETE_APPLICATION_FORM_ITEM.INFO_1")," "),o(3),E(p(6,5,"DIALOGS.DELETE_APPLICATION_FORM_ITEM.INFO_2")),o(3),E(p(9,7,"DIALOGS.DELETE_APPLICATION_FORM_ITEM.INFO_3")))}function Ic(t,d){if(t&1&&(a(0,"perun-web-apps-alert",2),m(1),r()),t&2){let e=c();o(),h(" ",e.data.errorMessage," ")}}var Er=(()=>{class t{constructor(e,n){this.dialogRef=e,this.data=n,this.deletionDisabled=this.data.errorMessage?.length!==0}onCancel(){this.dialogRef.close(!1)}submit(){this.dialogRef.close(!0)}static{this.\u0275fac=function(n){return new(n||t)(_(U),_(j))}}static{this.\u0275cmp=x({type:t,selectors:[["app-delete-application-form-item-dialog"]],decls:13,vars:12,consts:[["mat-dialog-title",""],["mat-dialog-content","",1,"dialog-container"],["alert_type","error"],["mat-dialog-actions",""],["mat-stroked-button","",1,"ms-auto",3,"click"],["color","warn","data-cy","delete-application-form-item-dialog","mat-flat-button","",1,"ms-2",3,"click","disabled"],[1,"pb-2","fw-bold"],[1,"pb-4","pt-2"]],template:function(n,i){n&1&&(a(0,"h1",0),m(1),l(2,"translate"),r(),a(3,"div",1),v(4,Ec,10,9,"div"),v(5,Ic,2,1,"perun-web-apps-alert",2),r(),a(6,"div",3)(7,"button",4),C("click",function(){return i.onCancel()}),m(8),l(9,"translate"),r(),a(10,"button",5),C("click",function(){return i.submit()}),m(11),l(12,"translate"),r()()),n&2&&(o(),E(p(2,6,"DIALOGS.DELETE_APPLICATION_FORM_ITEM.TITLE")),o(3),b(i.deletionDisabled?-1:4),o(),b(i.deletionDisabled?5:-1),o(3),h(" ",p(9,8,"DIALOGS.DELETE_APPLICATION_FORM_ITEM.CANCEL_BUTTON")," "),o(2),u("disabled",i.deletionDisabled),o(),h(" ",p(12,10,"DIALOGS.DELETE_APPLICATION_FORM_ITEM.SUBMIT_BUTTON")," "))},dependencies:[D,P,G,K,$,X,Y,be,ve,L,O],encapsulation:2})}}return t})();var Tc=["table"],Ac=()=>["Example 1","Example 2"],Ir=t=>({id:0,beanName:"Attribute",namespace:"",value:t}),Mc=()=>({key1:"value 1",key2:"value 2"});function xc(t,d){t&1&&A(0,"th",21)}function Dc(t,d){if(t&1){let e=I();a(0,"td",22)(1,"button",23),l(2,"translate"),C("mousedown",function(){f(e);let i=c(2);return g(i.dragDisabled=!1)}),a(3,"mat-icon"),m(4,"drag_indicator"),r()()()}t&2&&(o(),u("matTooltip",w(p(2,2,"VO_DETAIL.SETTINGS.APPLICATION_FORM.DRAG"))))}function Rc(t,d){t&1&&(a(0,"th",21),m(1),l(2,"translate"),r()),t&2&&(o(),h(" ",p(2,1,"VO_DETAIL.SETTINGS.APPLICATION_FORM.SHORTNAME")," "))}function Oc(t,d){if(t&1&&(a(0,"td",22),l(1,"multiWordDataCy"),m(2),r()),t&2){let e=d.$implicit;Rt("data-cy",W("",p(1,4,e.shortname),"-shortname-td")),o(2),ot(" ",e.shortname,"",e.required?"*":""," ")}}function Lc(t,d){t&1&&(a(0,"th",21),m(1),l(2,"translate"),r()),t&2&&(o(),h(" ",p(2,1,"VO_DETAIL.SETTINGS.APPLICATION_FORM.TYPE")," "))}function yc(t,d){if(t&1&&(a(0,"td",22),m(1),l(2,"applicationFormItemType"),r()),t&2){let e=d.$implicit;o(),h(" ",p(2,1,e.type)," ")}}function wc(t,d){t&1&&(a(0,"th",24),m(1),l(2,"translate"),r()),t&2&&(o(),h(" ",p(2,1,"VO_DETAIL.SETTINGS.APPLICATION_FORM.DISABLED_HEADER")," "))}function Pc(t,d){if(t&1&&(a(0,"div")(1,"mat-icon",26),m(2,"lock "),r(),A(3,"br"),m(4),r()),t&2){let e=c().$implicit,n=c(2);o(),u("matTooltip",n.disabledTooltip(e)),o(3),h(" ",n.disabledHiddenDependency(e,e.disabled,e.disabledDependencyItemId)," ")}}function Gc(t,d){if(t&1&&(a(0,"td",25),v(1,Pc,5,2,"div"),r()),t&2){let e=d.$implicit;o(),b(e.disabled!=="NEVER"?1:-1)}}function Nc(t,d){t&1&&(a(0,"th",24),m(1),l(2,"translate"),r()),t&2&&(o(),h(" ",p(2,1,"VO_DETAIL.SETTINGS.APPLICATION_FORM.HIDDEN_HEADER")," "))}function Bc(t,d){if(t&1&&(a(0,"div")(1,"mat-icon",26),m(2,"visibility_off "),r(),A(3,"br"),m(4),r()),t&2){let e=c().$implicit,n=c(2);o(),u("matTooltip",n.hiddenTooltip(e)),o(3),h(" ",n.disabledHiddenDependency(e,e.hidden,e.hiddenDependencyItemId)," ")}}function Vc(t,d){if(t&1&&(a(0,"td",25),v(1,Bc,5,2,"div"),r()),t&2){let e=d.$implicit;o(),b(e.hidden!=="NEVER"?1:-1)}}function Fc(t,d){t&1&&(a(0,"th",21),m(1),l(2,"translate"),r()),t&2&&(o(),h(" ",p(2,1,"VO_DETAIL.SETTINGS.APPLICATION_FORM.PREVIEW")," "))}function kc(t,d){t&1&&(a(0,"div")(1,"form"),A(2,"input",27),r()())}function Uc(t,d){t&1&&(a(0,"div")(1,"form"),A(2,"input",28)(3,"br")(4,"input",27),r()())}function jc(t,d){if(t&1&&(a(0,"div"),A(1,"input",30),m(2),A(3,"br"),r()),t&2){let e=d.$implicit;o(2),h(" ",e)}}function Wc(t,d){if(t&1&&(a(0,"div")(1,"form"),de(2,jc,4,1,"div",null,Ce),A(4,"input",29),l(5,"translate"),r()()),t&2){let e=c().$implicit,n=c(2);o(2),ce(n.getLocalizedOptions(e)),o(2),u("value",w(p(5,2,"VO_DETAIL.SETTINGS.APPLICATION_FORM.CLEAR_SELECTION")))}}function Hc(t,d){if(t&1&&(a(0,"div"),A(1,"span",31),r()),t&2){let e=c().$implicit,n=c(2);o(),u("innerHTML",n.getLocalizedLabel(e),kt)}}function zc(t,d){if(t&1&&(a(0,"div"),A(1,"span",31),l(2,"sanitizeHtml"),r()),t&2){let e=c().$implicit,n=c(2);o(),u("innerHTML",p(2,1,n.getLocalizedLabel(e)),kt)}}function qc(t,d){if(t&1&&(a(0,"option"),m(1),r()),t&2){let e=d.$implicit;o(),h(" ",e," ")}}function $c(t,d){if(t&1&&(a(0,"div")(1,"select"),de(2,qc,2,1,"option",null,Ce),r()()),t&2){let e=c().$implicit,n=c(2);o(2),ce(n.getLocalizedOptions(e))}}function Yc(t,d){t&1&&(a(0,"div"),A(1,"textarea"),r())}function Xc(t,d){if(t&1&&(a(0,"option",33),m(1),r()),t&2){let e=d.$implicit;o(),h(" ",e," ")}}function Kc(t,d){t&1&&(a(0,"div")(1,"form"),A(2,"input",27),r()())}function Qc(t,d){if(t&1){let e=I();a(0,"div")(1,"select",32),te("ngModelChange",function(i){f(e);let s=c().$implicit,S=c(2);return ee(S.mapForCombobox[s.id],i)||(S.mapForCombobox[s.id]=i),g(i)}),de(2,Xc,2,1,"option",33,Ce),a(4,"option",34),m(5),l(6,"translate"),r()(),v(7,Kc,3,0,"div"),r()}if(t&2){let e=c().$implicit,n=c(2);o(),J("ngModel",n.mapForCombobox[e.id]),o(),ce(n.getLocalizedOptions(e)),o(3),h(" ",p(6,3,"VO_DETAIL.SETTINGS.APPLICATION_FORM.OTHER_VALUE")," "),o(2),b(n.mapForCombobox[e.id]==="true"?7:-1)}}function Zc(t,d){if(t&1&&(a(0,"div"),A(1,"input",35)(2,"span",31),r()),t&2){let e=d.$implicit;o(2),u("innerHTML",e,kt)}}function Jc(t,d){if(t&1&&(a(0,"div")(1,"form"),de(2,Zc,3,1,"div",null,Ce),r()()),t&2){let e=c().$implicit,n=c(2);o(2),ce(n.getLocalizedOptions(e))}}function e0(t,d){if(t&1&&(a(0,"div")(1,"button",36),m(2),r()()),t&2){let e=c().$implicit,n=c(2);o(2),h(" ",n.getLocalizedLabel(e)," ")}}function t0(t,d){t&1&&(a(0,"div")(1,"select",37)(2,"option",38),m(3),l(4,"translate"),r(),a(5,"option",39),m(6,"(GMT -12:00) Eniwetok, Kwajalein"),r(),a(7,"option",40),m(8,"(GMT -11:00) Midway Island, Samoa"),r(),a(9,"option",41),m(10,"(GMT -10:00) Hawaii"),r(),a(11,"option",42),m(12,"(GMT -9:30) Taiohae"),r(),a(13,"option",43),m(14,"(GMT -9:00) Alaska"),r(),a(15,"option",44),m(16,"(GMT -8:00) Pacific Time (US & Canada)"),r(),a(17,"option",45),m(18,"(GMT -7:00) Mountain Time (US & Canada)"),r(),a(19,"option",46),m(20," (GMT -6:00) Central Time (US & Canada), Mexico City "),r(),a(21,"option",47),m(22," (GMT -5:00) Eastern Time (US & Canada), Bogota, Lima "),r(),a(23,"option",48),m(24,"(GMT -4:30) Caracas"),r(),a(25,"option",49),m(26," (GMT -4:00) Atlantic Time (Canada), Caracas, La Paz "),r(),a(27,"option",50),m(28,"(GMT -3:30) Newfoundland"),r(),a(29,"option",51),m(30,"(GMT -3:00) Brazil, Buenos Aires, Georgetown"),r(),a(31,"option",52),m(32,"(GMT -2:00) Mid-Atlantic"),r(),a(33,"option",53),m(34,"(GMT -1:00) Azores, Cape Verde Islands"),r(),a(35,"option",54),m(36," (GMT) Western Europe Time, London, Lisbon, Casablanca "),r(),a(37,"option",55),m(38,"(GMT +1:00) Brussels, Copenhagen, Madrid, Paris"),r(),a(39,"option",56),m(40,"(GMT +2:00) Kaliningrad, South Africa"),r(),a(41,"option",57),m(42," (GMT +3:00) Baghdad, Riyadh, Moscow, St. Petersburg "),r(),a(43,"option",58),m(44,"(GMT +3:30) Tehran"),r(),a(45,"option",59),m(46,"(GMT +4:00) Abu Dhabi, Muscat, Baku, Tbilisi"),r(),a(47,"option",60),m(48,"(GMT +4:30) Kabul"),r(),a(49,"option",61),m(50," (GMT +5:00) Ekaterinburg, Islamabad, Karachi, Tashkent "),r(),a(51,"option",62),m(52,"(GMT +5:30) Bombay, Calcutta, Madras, New Delhi"),r(),a(53,"option",63),m(54,"(GMT +5:45) Kathmandu, Pokhara"),r(),a(55,"option",64),m(56,"(GMT +6:00) Almaty, Dhaka, Colombo"),r(),a(57,"option",65),m(58,"(GMT +6:30) Yangon, Mandalay"),r(),a(59,"option",66),m(60,"(GMT +7:00) Bangkok, Hanoi, Jakarta"),r(),a(61,"option",67),m(62,"(GMT +8:00) Beijing, Perth, Singapore, Hong Kong"),r(),a(63,"option",68),m(64,"(GMT +8:45) Eucla"),r(),a(65,"option",69),m(66," (GMT +9:00) Tokyo, Seoul, Osaka, Sapporo, Yakutsk "),r(),a(67,"option",70),m(68,"(GMT +9:30) Adelaide, Darwin"),r(),a(69,"option",71),m(70," (GMT +10:00) Eastern Australia, Guam, Vladivostok "),r(),a(71,"option",72),m(72,"(GMT +10:30) Lord Howe Island"),r(),a(73,"option",73),m(74," (GMT +11:00) Magadan, Solomon Islands, New Caledonia "),r(),a(75,"option",74),m(76,"(GMT +11:30) Norfolk Island"),r(),a(77,"option",75),m(78," (GMT +12:00) Auckland, Wellington, Fiji, Kamchatka "),r(),a(79,"option",76),m(80,"(GMT +12:45) Chatham Islands"),r(),a(81,"option",77),m(82,"(GMT +13:00) Apia, Nukualofa"),r(),a(83,"option",78),m(84,"(GMT +14:00) Line Islands, Tokelau"),r()()()),t&2&&(o(3),h(" ",p(4,1,"VO_DETAIL.SETTINGS.APPLICATION_FORM.NOT_SELECTED")," "))}function i0(t,d){if(t&1&&(a(0,"div")(1,"button",36),m(2),r()()),t&2){let e=c().$implicit,n=c(2);o(2),h(" ",n.getLocalizedLabel(e)," ")}}function n0(t,d){t&1&&(a(0,"div")(1,"form"),A(2,"input",35),m(3," example group1 "),A(4,"br")(5,"input",35),m(6," example group2 "),A(7,"br")(8,"input",35),m(9," example group3 "),r()())}function o0(t,d){t&1&&(a(0,"div"),A(1,"perun-web-apps-attribute-value-list",79),r()),t&2&&(o(),u("attribute",ke(2,Ir,ue(1,Ac))))}function a0(t,d){t&1&&(a(0,"div"),A(1,"perun-web-apps-attribute-value-map",79),r()),t&2&&(o(),u("attribute",ke(2,Ir,ue(1,Mc))))}function r0(t,d){if(t&1&&(a(0,"td",22),v(1,kc,3,0,"div"),v(2,Uc,5,0,"div"),v(3,Wc,6,4,"div"),v(4,Hc,2,1,"div"),v(5,zc,3,3,"div"),v(6,$c,4,0,"div"),v(7,Yc,2,0,"div"),v(8,Qc,8,5,"div"),v(9,Jc,4,0,"div"),v(10,e0,3,1,"div"),v(11,t0,85,3,"div"),v(12,i0,3,1,"div"),v(13,n0,10,0,"div"),v(14,o0,2,4,"div"),v(15,a0,2,4,"div"),r()),t&2){let e=d.$implicit;o(),b(e.type==="TEXTFIELD"||e.type==="VALIDATED_EMAIL"||e.type==="USERNAME"?1:-1),o(),b(e.type==="PASSWORD"?2:-1),o(),b(e.type==="RADIO"?3:-1),o(),b(e.type==="HEADING"?4:-1),o(),b(e.type==="HTML_COMMENT"?5:-1),o(),b(e.type==="SELECTIONBOX"?6:-1),o(),b(e.type==="TEXTAREA"?7:-1),o(),b(e.type==="COMBOBOX"?8:-1),o(),b(e.type==="CHECKBOX"?9:-1),o(),b(e.type==="SUBMIT_BUTTON"?10:-1),o(),b(e.type==="TIMEZONE"?11:-1),o(),b(e.type==="AUTO_SUBMIT_BUTTON"?12:-1),o(),b(e.type==="EMBEDDED_GROUP_APPLICATION"?13:-1),o(),b(e.type==="LIST_INPUT_BOX"?14:-1),o(),b(e.type==="MAP_INPUT_BOX"?15:-1)}}function s0(t,d){t&1&&A(0,"th",21)}function l0(t,d){if(t&1){let e=I();a(0,"button",82),l(1,"translate"),C("click",function(){f(e);let i=c(3);return g(i.openManagingGroups())}),a(2,"mat-icon"),m(3,"supervised_user_circle"),r()()}if(t&2){let e=c(3);u("matTooltip",w(p(1,3,"VO_DETAIL.SETTINGS.APPLICATION_FORM.MANAGE_GROUPS")))("disabled",!e.embeddedGroupsItemSaved)}}function p0(t,d){if(t&1&&(a(0,"td",22)(1,"span",80),l(2,"translate"),v(3,l0,4,5,"button",81),r()()),t&2){let e=d.$implicit,n=c(2);o(),u("matTooltip",w(p(2,4,"VO_DETAIL.SETTINGS.APPLICATION_FORM.MANAGE_GROUPS_DISABLED")))("matTooltipDisabled",n.embeddedGroupsItemSaved),o(2),b(e.type==="EMBEDDED_GROUP_APPLICATION"&&!e.forDelete?3:-1)}}function m0(t,d){t&1&&A(0,"th",21)}function d0(t,d){if(t&1){let e=I();a(0,"button",85),l(1,"translate"),C("click",function(){f(e);let i=c().$implicit,s=c(2);return g(s.edit(i))}),a(2,"mat-icon"),m(3,"edit"),r()()}t&2&&u("matTooltip",w(p(1,2,"VO_DETAIL.SETTINGS.APPLICATION_FORM.EDIT")))}function c0(t,d){t&1&&(a(0,"div",84),m(1),l(2,"translate"),r()),t&2&&(o(),h(" ",p(2,1,"VO_DETAIL.SETTINGS.APPLICATION_FORM.MARK_DELETE")," "))}function u0(t,d){if(t&1&&(a(0,"td",22),v(1,d0,4,4,"button",83),v(2,c0,3,3,"div",84),r()),t&2){let e=d.$implicit;o(),b(e.forDelete?-1:1),o(),b(e.forDelete?2:-1)}}function _0(t,d){t&1&&A(0,"th",21)}function h0(t,d){if(t&1){let e=I();a(0,"button",88),l(1,"multiWordDataCy"),l(2,"translate"),C("click",function(){f(e);let i=c().$implicit,s=c(2);return g(s.delete(i))}),a(3,"mat-icon"),m(4,"delete"),r()()}if(t&2){let e=c().$implicit;Rt("data-cy",W("",p(1,4,e.shortname),"-delete")),u("matTooltip",w(p(2,6,"VO_DETAIL.SETTINGS.APPLICATION_FORM.DELETE")))}}function f0(t,d){if(t&1){let e=I();a(0,"button",89),l(1,"translate"),C("click",function(){f(e);let i=c().$implicit,s=c(2);return g(s.restore(i))}),a(2,"mat-icon"),m(3,"settings_backup_restore"),r()()}t&2&&u("matTooltip",w(p(1,2,"VO_DETAIL.SETTINGS.APPLICATION_FORM.REVERT_DELETE")))}function g0(t,d){if(t&1&&(a(0,"td",22),v(1,h0,5,8,"button",86),v(2,f0,4,4,"button",87),r()),t&2){let e=d.$implicit;o(),b(e.forDelete?-1:1),o(),b(e.forDelete?2:-1)}}function C0(t,d){t&1&&A(0,"tr",90)}function S0(t,d){if(t&1&&A(0,"tr",91),t&2){let e=d.$implicit,n=c(2);Ee("make-green",e.id<=0)("make-red",e.forDelete)("make-yellow",n.itemsChanged.indexOf(e.id)!==-1&&!e.forDelete&&e.id>0),u("cdkDragData",e)}}function v0(t,d){if(t&1){let e=I();a(0,"div",1)(1,"div",3)(2,"div",4)(3,"table",5,0),C("cdkDropListDropped",function(i){f(e);let s=c();return g(s.drop(i))}),Q(5,6),T(6,xc,1,0,"th",7)(7,Dc,5,4,"td",8),Z(),Q(8,9),T(9,Rc,3,3,"th",7)(10,Oc,3,6,"td",8),Z(),Q(11,10),T(12,Lc,3,3,"th",7)(13,yc,3,3,"td",8),Z(),Q(14,11),T(15,wc,3,3,"th",12)(16,Gc,2,1,"td",13),Z(),Q(17,14),T(18,Nc,3,3,"th",12)(19,Vc,2,1,"td",13),Z(),Q(20,15),T(21,Fc,3,3,"th",7)(22,r0,16,15,"td",8),Z(),Q(23,16),T(24,s0,1,0,"th",7)(25,p0,4,6,"td",8),Z(),Q(26,17),T(27,m0,1,0,"th",7)(28,u0,3,2,"td",8),Z(),Q(29,18),T(30,_0,1,0,"th",7)(31,g0,3,2,"td",8),Z(),T(32,C0,1,0,"tr",19)(33,S0,1,7,"tr",20),r()()()()}if(t&2){let e=c();o(3),u("cdkDropListDisabled",e.dragDisabled)("dataSource",e.dataSource),o(29),u("matHeaderRowDef",e.displayedColumns),o(),u("matRowDefColumns",e.displayedColumns)}}function b0(t,d){t&1&&(a(0,"perun-web-apps-alert",2),m(1),l(2,"translate"),r()),t&2&&(o(),h(" ",p(2,1,"VO_DETAIL.SETTINGS.APPLICATION_FORM.NO_APPLICATION_FORM")," "))}var ro=(()=>{class t{constructor(e,n,i,s){this.dialog=e,this.notificator=n,this.router=i,this.translate=s,this.applicationFormItems=[],this.embeddedGroupsItemSaved=!1,this.displayedColumns=["drag","shortname","type","disabled","hidden","preview","managegroups","edit","delete"],this.applicationFormItemsChange=new pt,this.itemsChanged=[],this.dataSource=this.applicationFormItems,this.mapForCombobox=new Map,this.dragDisabled=!0}ngOnInit(){this.ifEmpty=this.translate.instant("VO_DETAIL.SETTINGS.APPLICATION_FORM.DISABLED_HIDDEN_ICON.IF_EMPTY"),this.ifPrefilled=this.translate.instant("VO_DETAIL.SETTINGS.APPLICATION_FORM.DISABLED_HIDDEN_ICON.IF_PREFILLED"),this.alwaysDisabled=this.translate.instant("VO_DETAIL.SETTINGS.APPLICATION_FORM.DISABLED_HIDDEN_ICON.ALWAYS_DISABLED_HINT"),this.alwaysHidden=this.translate.instant("VO_DETAIL.SETTINGS.APPLICATION_FORM.DISABLED_HIDDEN_ICON.ALWAYS_HIDDEN_HINT"),this.isDisabledIf=this.translate.instant("VO_DETAIL.SETTINGS.APPLICATION_FORM.DISABLED_HIDDEN_ICON.DISABLED_IF_HINT"),this.isHiddenIf=this.translate.instant("VO_DETAIL.SETTINGS.APPLICATION_FORM.DISABLED_HIDDEN_ICON.HIDDEN_IF_HINT"),this.isEmpty=this.translate.instant("VO_DETAIL.SETTINGS.APPLICATION_FORM.DISABLED_HIDDEN_ICON.IS_EMPTY_HINT"),this.isPrefilled=this.translate.instant("VO_DETAIL.SETTINGS.APPLICATION_FORM.DISABLED_HIDDEN_ICON.IS_PREFILLED_HINT")}ngOnChanges(){this.dataSource=this.applicationFormItems,this.refreshApplicationForm&&(this.itemsChanged=[])}disabledHiddenDependency(e,n,i){let s="";if(n==="IF_EMPTY"||n==="IF_PREFILLED"){let S=i===null?"":this.applicationFormItems.find(M=>M.id===i).shortname;s=n==="IF_EMPTY"?`(${this.ifEmpty} ${S})`:`(${this.ifPrefilled} ${S})`}return s}disabledTooltip(e){let n;switch(e.disabled){case"ALWAYS":return this.alwaysDisabled;case"IF_EMPTY":return n=e.disabledDependencyItemId===null?"":this.applicationFormItems.find(i=>i.id===e.disabledDependencyItemId).shortname,`${this.isDisabledIf} ${n} ${this.isEmpty}`;case"IF_PREFILLED":return n=e.disabledDependencyItemId===null?"":this.applicationFormItems.find(i=>i.id===e.disabledDependencyItemId).shortname,`${this.isDisabledIf} ${n} ${this.isPrefilled}`}}hiddenTooltip(e){let n;switch(e.hidden){case"ALWAYS":return this.alwaysHidden;case"IF_EMPTY":return n=e.hiddenDependencyItemId===null?"":this.applicationFormItems.find(i=>i.id===e.hiddenDependencyItemId).shortname,`${this.isHiddenIf} ${n} ${this.isEmpty}`;case"IF_PREFILLED":return n=e.hiddenDependencyItemId===null?"":this.applicationFormItems.find(i=>i.id===e.hiddenDependencyItemId).shortname,`${this.isHiddenIf} ${n} ${this.isPrefilled}`}}edit(e){let n=F();n.width="600px",n.height="600px",n.data={voId:this.applicationForm.vo.id,group:this.applicationForm.group,applicationFormItem:e,theme:this.theme,allItems:this.applicationFormItems},this.dialog.open(tn,n).afterClosed().subscribe(s=>{s&&(this.itemsChanged.push(e.id),this.applicationFormItemsChange.emit())})}delete(e){let n="",i=this.applicationFormItems.find(R=>R.hiddenDependencyItemId===e.id),s=this.applicationFormItems.find(R=>R.disabledDependencyItemId===e.id);(i||s)&&(n=this.translate.instant("DIALOGS.APPLICATION_FORM_EDIT_ITEM.DEPENDENCY_ERROR_MESSAGE",i?{dependency:"hidden",shortname:i.shortname}:{dependency:"disabled",shortname:s.shortname}));let S=F();S.width="500px",S.data={errorMessage:n},this.dialog.open(Er,S).afterClosed().subscribe(R=>{R&&(e.forDelete=!0,e.id===0&&(this.applicationFormItems.splice(this.applicationFormItems.indexOf(e),1),this.table.renderRows()),this.applicationFormItemsChange.emit())})}drop(e){this.dragDisabled=!0;let n=this.applicationFormItems.indexOf(e.item.data);Na(this.applicationFormItems,n,e.currentIndex),this.itemsChanged.push(this.applicationFormItems[e.currentIndex].id),this.applicationFormItemsChange.emit(),this.table.renderRows()}getLocalizedOptions(e){if(e.i18n[this.translate.getDefaultLang()]){let n=e.i18n[this.translate.getDefaultLang()].options;if(n!==null&&n!==""){let i=[];for(let s of n.split("|"))i.push(s.split("#")[1]);return i}}return[]}getLocalizedLabel(e){return e.i18n[this.translate.getDefaultLang()]?e.i18n[this.translate.getDefaultLang()].label:e.shortname}restore(e){e.forDelete=!1}openManagingGroups(){let e=this.applicationForm.group?["/organizations",this.applicationForm.vo.id,"groups",this.applicationForm.group.id,"settings","applicationForm","manageGroups"]:["/organizations",this.applicationForm.vo.id,"settings","applicationForm","manageGroups"];this.router.navigate(e,{queryParamsHandling:"preserve"})}static{this.\u0275fac=function(n){return new(n||t)(_(Ae),_(q),_(fi),_(Mt))}}static{this.\u0275cmp=x({type:t,selectors:[["app-application-form-list"]],viewQuery:function(n,i){if(n&1&&Be(Tc,5),n&2){let s;Ve(s=Fe())&&(i.table=s.first)}},inputs:{applicationForm:"applicationForm",applicationFormItems:"applicationFormItems",embeddedGroupsItemSaved:"embeddedGroupsItemSaved",theme:"theme",displayedColumns:"displayedColumns",refreshApplicationForm:"refreshApplicationForm",loading:"loading"},outputs:{applicationFormItemsChange:"applicationFormItemsChange"},features:[Jt],decls:2,vars:2,consts:[["table",""],[1,"card","mt-2"],["alert_type","warn"],[1,"card-body","table-theme"],[1,"overflow-auto"],["cdkDropList","","cdkDropListData","dataSource","mat-table","",1,"w-100",3,"cdkDropListDropped","cdkDropListDisabled","dataSource"],["matColumnDef","drag"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","shortname"],["matColumnDef","type"],["matColumnDef","disabled"],["class","center","mat-header-cell","",4,"matHeaderCellDef"],["class","center","mat-cell","",4,"matCellDef"],["matColumnDef","hidden"],["matColumnDef","preview"],["matColumnDef","managegroups"],["matColumnDef","edit"],["matColumnDef","delete"],["mat-header-row","",4,"matHeaderRowDef"],["cdkDrag","","mat-row","",3,"cdkDragData","make-green","make-red","make-yellow",4,"matRowDef","matRowDefColumns"],["mat-header-cell",""],["mat-cell",""],["mat-icon-button","",3,"mousedown","matTooltip"],["mat-header-cell","",1,"center"],["mat-cell","",1,"center"],[1,"pointer",3,"matTooltip"],["type","text"],["type","text",1,"mb-1"],["type","reset",3,"value"],["name","temp","type","radio"],[3,"innerHTML"],[3,"ngModelChange","ngModel"],["selected","","value","false"],["value","true"],["type","checkbox"],["color","accent","mat-flat-button",""],["id","timezone-offset","name","timezone_offset",1,"span5"],["selected","selected","value","-12:00"],["value","-12:00"],["value","-11:00"],["value","-10:00"],["value","-09:50"],["value","-09:00"],["value","-08:00"],["value","-07:00"],["value","-06:00"],["value","-05:00"],["value","-04:50"],["value","-04:00"],["value","-03:50"],["value","-03:00"],["value","-02:00"],["value","-01:00"],["value","+00:00"],["value","+01:00"],["value","+02:00"],["value","+03:00"],["value","+03:50"],["value","+04:00"],["value","+04:50"],["value","+05:00"],["value","+05:50"],["value","+05:75"],["value","+06:00"],["value","+06:50"],["value","+07:00"],["value","+08:00"],["value","+08:75"],["value","+09:00"],["value","+09:50"],["value","+10:00"],["value","+10:50"],["value","+11:00"],["value","+11:50"],["value","+12:00"],["value","+12:75"],["value","+13:00"],["value","+14:00"],[3,"attribute"],[1,"d-inline-block",3,"matTooltip","matTooltipDisabled"],["mat-icon-button","",3,"disabled","matTooltip"],["mat-icon-button","",3,"click","disabled","matTooltip"],["mat-icon-button","",1,"ms-auto",3,"matTooltip"],[1,"fw-bold"],["mat-icon-button","",1,"ms-auto",3,"click","matTooltip"],["color","warn","mat-icon-button","",3,"matTooltip"],["mat-icon-button","",3,"matTooltip"],["color","warn","mat-icon-button","",3,"click","matTooltip"],["mat-icon-button","",3,"click","matTooltip"],["mat-header-row",""],["cdkDrag","","mat-row","",3,"cdkDragData"]],template:function(n,i){n&1&&(v(0,v0,34,4,"div",1),v(1,b0,3,3,"perun-web-apps-alert",2)),n&2&&(b(i.applicationFormItems.length!==0?0:-1),o(),b(!i.loading&&i.applicationFormItems.length===0?1:-1))},dependencies:[D,P,G,ti,lt,st,je,Di,Bo,Vo,No,se,_i,Ue,Go,le,be,ve,vt,mt,ct,ft,ut,dt,gt,_t,ht,Ct,St,L,ne,Va,Ga,Ba,Fa,O,en,ga,fa],styles:[".cdk-drag-preview[_ngcontent-%COMP%]{box-sizing:border-box;border-radius:4px;box-shadow:0 5px 5px -3px #0003,0 8px 10px 1px #00000024,0 3px 14px 2px #0000001f}.cdk-drag-placeholder[_ngcontent-%COMP%]{opacity:0}.cdk-drag-animating[_ngcontent-%COMP%]{transition:transform .25s cubic-bezier(0,0,.2,1)}.cdk-drop-list-dragging[_ngcontent-%COMP%]   .mat-mdc-row[_ngcontent-%COMP%]:not(.cdk-drag-placeholder){transition:transform .25s cubic-bezier(0,0,.2,1)}.movable-row[_ngcontent-%COMP%]{cursor:move}.make-red[_ngcontent-%COMP%]{background-color:#ffcdd2}.make-green[_ngcontent-%COMP%]{background-color:#c8e6c9}.make-yellow[_ngcontent-%COMP%]{background-color:#fff9c4}.center[_ngcontent-%COMP%]{text-align:center}.pointer[_ngcontent-%COMP%]{cursor:pointer}"]})}}return t})();function E0(t,d){t&1&&A(0,"mat-spinner",2)}function I0(t,d){if(t&1){let e=I();a(0,"button",19),C("click",function(){f(e);let i=c(2);return g(i.settings())}),a(1,"i",20),m(2,"edit"),r(),a(3,"span",21),m(4),l(5,"translate"),r()()}t&2&&(o(4),h(" ",p(5,1,"VO_DETAIL.SETTINGS.APPLICATION_FORM.SETTINGS_BUTTON")," "))}function T0(t,d){if(t&1&&(a(0,"div",3)(1,"div")(2,"div",15),m(3),l(4,"translate"),r(),a(5,"div")(6,"span",15),m(7),l(8,"translate"),r(),m(9,": "),a(10,"mat-icon",16),m(11,"arrow_right_alt"),r(),m(12),l(13,"translate"),l(14,"translate"),a(15,"mat-icon",17),m(16,"restore"),r(),m(17),l(18,"translate"),l(19,"translate"),v(20,I0,6,3,"button",18),r()()()),t&2){let e=c();o(3),ot(" ",p(4,6,"VO_DETAIL.SETTINGS.APPLICATION_FORM.MODULE_NAMES"),": ",e.applicationForm.moduleClassNames," "),o(4),E(p(8,8,"VO_DETAIL.SETTINGS.APPLICATION_FORM.APPLICATION_TYPE")),o(5),h(" ",e.applicationForm.automaticApproval?p(13,10,"VO_DETAIL.SETTINGS.APPLICATION_FORM.AUTOMATIC"):p(14,12,"VO_DETAIL.SETTINGS.APPLICATION_FORM.MANUAL")," , "),o(5),h(" ",e.applicationForm.automaticApprovalExtension?p(18,14,"VO_DETAIL.SETTINGS.APPLICATION_FORM.AUTOMATIC"):p(19,16,"VO_DETAIL.SETTINGS.APPLICATION_FORM.MANUAL")," "),o(3),b(e.editAuth?20:-1)}}function A0(t,d){if(t&1){let e=I();a(0,"button",22),C("click",function(){f(e);let i=c();return g(i.add())}),m(1),l(2,"translate"),r()}if(t&2){let e=c();u("disabled",e.loadingTable),o(),h(" ",p(2,2,"VO_DETAIL.SETTINGS.APPLICATION_FORM.ADD_BUTTON")," ")}}function M0(t,d){if(t&1){let e=I();a(0,"button",23),C("click",function(){f(e);let i=c();return g(i.save())}),a(1,"i",11),m(2,"save"),r(),m(3),l(4,"translate"),r()}if(t&2){let e=c();u("disabled",!e.itemsChanged),o(3),h(" ",p(4,2,"VO_DETAIL.SETTINGS.APPLICATION_FORM.SAVE_BUTTON")," ")}}function x0(t,d){if(t&1){let e=I();a(0,"button",24),C("click",function(){f(e);let i=c();return g(i.copy())}),a(1,"i",20),m(2,"file_copy"),r(),a(3,"span",21),m(4),l(5,"translate"),r()()}t&2&&(o(4),h(" ",p(5,1,"VO_DETAIL.SETTINGS.APPLICATION_FORM.COPY_VO_BUTTON")," "))}function D0(t,d){t&1&&(a(0,"perun-web-apps-alert",12),m(1),l(2,"translate"),r()),t&2&&(o(),h(" ",p(2,1,"VO_DETAIL.SETTINGS.APPLICATION_FORM.DRAG_AND_DROP_INFO")," "))}function R0(t,d){t&1&&A(0,"perun-web-apps-loading-table")}function O0(t,d){if(t&1){let e=I();a(0,"app-application-form-list",25),C("applicationFormItemsChange",function(){f(e);let i=c();return g(i.changeItems())}),r()}if(t&2){let e=c();u("loading",e.loadingTable)("applicationForm",e.applicationForm)("applicationFormItems",e.applicationFormItems)("displayColumns",e.displayedColumns)("refreshApplicationForm",e.refreshApplicationForm)("embeddedGroupsItemSaved",e.embeddedGroupsItemSaved)("theme","vo-theme")}}var MO=(()=>{class t{static{this.id="VoSettingsApplicationFormComponent"}constructor(e,n,i,s,S,M,R){this.registrarManager=e,this.dialog=n,this.notificator=i,this.translate=s,this.router=S,this.authResolver=M,this.entityStorageService=R,this.loadingHeader=!1,this.loadingTable=!1,this.applicationFormItems=[],this.itemsChanged=!1,this.displayedColumns=[],this.refreshApplicationForm=!1,this.embeddedGroupsItemSaved=!1,this.idCounter=-1}ngOnInit(){this.loadingHeader=!0,this.loadingTable=!0,this.vo=this.entityStorageService.getEntity(),this.setAuthRights(),this.registrarManager.getVoApplicationForm(this.vo.id).subscribe(e=>{this.applicationForm=e,this.registrarManager.getFormItemsForVo(this.vo.id).subscribe(n=>{this.applicationFormItems=n,this.embeddedGroupsItemSaved=n.filter(i=>i.type==="EMBEDDED_GROUP_APPLICATION").length>0,this.loadingHeader=!1,this.loadingTable=!1})})}add(){let e=F();e.width="500px",e.data={applicationFormItems:this.applicationFormItems,fakeId:this.idCounter--},this.dialog.open(ao,e).afterClosed().subscribe(i=>{i&&(this.applicationFormItems=Object.assign([],i[0]),e=F(),e.width="600px",e.height="600px",e.data={voId:this.vo.id,applicationFormItem:i[1],theme:"vo-theme",allItems:this.applicationFormItems},this.dialog.open(tn,e),this.itemsChanged=!0)})}copy(){let e=F();e.width="500px",e.data={voId:this.vo.id,theme:"vo-theme"},this.dialog.open(oo,e).afterClosed().subscribe(i=>{i&&this.updateFormItems()})}settings(){let e=F();e.width="400px",e.data={entity:"vo",applicationForm:this.applicationForm,theme:"vo-theme"},this.dialog.open(no,e).afterClosed().subscribe(i=>{i&&(this.translate.get("VO_DETAIL.SETTINGS.APPLICATION_FORM.CHANGE_SETTINGS_SUCCESS").subscribe(s=>{this.notificator.showSuccess(s)}),this.applicationForm=i)})}preview(){this.router.navigate(["/organizations",this.vo.id,"settings","applicationForm","preview"],{queryParams:{applicationFormItems:JSON.stringify(this.applicationFormItems)},queryParamsHandling:"merge"})}updateFormItems(){this.loadingTable=!0,this.refreshApplicationForm=!0,this.registrarManager.getFormItemsForVo(this.vo.id).subscribe(e=>{this.applicationFormItems=e,this.itemsChanged=!1,this.embeddedGroupsItemSaved=e.filter(n=>n.type==="EMBEDDED_GROUP_APPLICATION").length>0,this.setAuthRights(),this.refreshApplicationForm=!1,this.loadingTable=!1})}changeItems(){this.itemsChanged=!0}save(){this.loadingTable=!0;let e=0;for(let n of this.applicationFormItems)n.ordnum=e,n.forDelete||e++;this.registrarManager.updateFormItemsForVo({vo:this.vo.id,items:this.applicationFormItems}).subscribe({next:()=>{this.translate.get("VO_DETAIL.SETTINGS.APPLICATION_FORM.CHANGE_APPLICATION_FORM_ITEMS_SUCCESS").subscribe(n=>{this.notificator.showSuccess(n)}),this.updateFormItems()},error:()=>this.loadingTable=!1})}clear(){this.applicationFormItems.forEach(e=>e.forDelete=!0),this.itemsChanged=!0}setAuthRights(){this.editAuth=this.authResolver.isAuthorized("vo-updateFormItems_ApplicationForm_List<ApplicationFormItem>_policy",[this.vo]),this.displayedColumns=this.editAuth?["drag","shortname","type","disabled","hidden","preview","managegroups","edit","delete"]:["shortname","type","disabled","hidden","preview","managegroups"]}static{this.\u0275fac=function(n){return new(n||t)(_(tt),_(Ae),_(q),_(Se),_(fi),_(pe),_(He))}}static{this.\u0275cmp=x({type:t,selectors:[["app-vo-settings-application-form"]],hostVars:2,hostBindings:function(n,i){n&2&&Ee("router-component",i.true)},decls:22,vars:14,consts:[["spinner",""],[1,"page-subtitle"],[1,"ms-auto","me-auto"],[1,"d-flex","w-75"],[1,"mb-2","mt-2"],[1,"w-100","d-flex"],[3,"refresh"],["color","accent","data-cy","add-form-item","mat-flat-button","",1,"me-2","action-button",3,"disabled"],["color","accent","data-cy","save-application-form","mat-flat-button","",1,"me-2",3,"disabled"],["mat-stroked-button","",1,"me-2","action-button"],["mat-stroked-button","",3,"click"],[1,"material-icons"],["alert_type","info"],[1,"position-relative","table-min-height"],[3,"loading","applicationForm","applicationFormItems","displayColumns","refreshApplicationForm","embeddedGroupsItemSaved","theme","applicationFormItemsChange",4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],[1,"fw-bold"],["matTooltip","Initial",1,"align-middle"],["matTooltip","Extension",1,"align-middle"],["mat-stroked-button","",1,"ms-3","action-button"],["mat-stroked-button","",1,"ms-3","action-button",3,"click"],[1,"material-icons","align-middle"],[1,"align-middle"],["color","accent","data-cy","add-form-item","mat-flat-button","",1,"me-2","action-button",3,"click","disabled"],["color","accent","data-cy","save-application-form","mat-flat-button","",1,"me-2",3,"click","disabled"],["mat-stroked-button","",1,"me-2","action-button",3,"click"],[3,"applicationFormItemsChange","loading","applicationForm","applicationFormItems","displayColumns","refreshApplicationForm","embeddedGroupsItemSaved","theme"]],template:function(n,i){if(n&1){let s=I();a(0,"h1",1),m(1),l(2,"translate"),r(),v(3,E0,1,0,"mat-spinner",2),a(4,"div"),v(5,T0,21,18,"div",3),A(6,"mat-divider",4),a(7,"div",5)(8,"perun-web-apps-refresh-button",6),C("refresh",function(){return f(s),g(i.updateFormItems())}),r(),v(9,A0,3,4,"button",7),v(10,M0,5,4,"button",8),v(11,x0,6,3,"button",9),a(12,"button",10),C("click",function(){return f(s),g(i.preview())}),a(13,"i",11),m(14,"search"),r(),m(15),l(16,"translate"),r()(),v(17,D0,3,3,"perun-web-apps-alert",12),T(18,R0,1,0,"ng-template",null,0,B),a(20,"div",13),T(21,O0,1,7,"app-application-form-list",14),r()()}if(n&2){let s=y(19);o(),h(" ",p(2,10,"VO_DETAIL.SETTINGS.APPLICATION_FORM.TITLE"),`
`),o(2),b(i.loadingHeader?3:-1),o(2),b(i.loadingHeader?-1:5),o(4),b(i.editAuth?9:-1),o(),b(i.editAuth?10:-1),o(),b(i.editAuth?11:-1),o(4),h(" ",p(16,12,"VO_DETAIL.SETTINGS.APPLICATION_FORM.PREVIEW_BUTTON")," "),o(2),b(i.editAuth?17:-1),o(4),u("perunWebAppsLoader",i.loadingTable)("perunWebAppsLoaderIndicator",s)}},dependencies:[D,P,G,lt,st,be,ve,Ze,Gi,Ci,gi,L,ne,ro,V,Ge,O],encapsulation:2})}}return t})();function L0(t,d){if(t&1){let e=I();a(0,"button",7),C("click",function(){f(e);let i=c();return g(i.deleteSelectedResources())}),m(1),l(2,"translate"),r()}if(t&2){let e=c();u("disabled",e.selected.selected.length===0||e.loading),o(),h(" ",p(2,2,"VO_DETAIL.RESOURCES.LIST.DELETE")," ")}}function y0(t,d){t&1&&A(0,"perun-web-apps-loading-table")}function w0(t,d){if(t&1&&A(0,"perun-web-apps-resources-list",8),t&2){let e=c();u("loading",e.loading)("disableRouting",!e.routeAuth)("filterValue",e.filterValue)("resources",e.resources)("routingVo",!0)("displayColumns",e.displayedColumns)("selection",e.selected)("cachedSubject",e.cachedSubject)}}var qO=(()=>{class t{static{this.id="VoResourcesPreviewComponent"}constructor(e,n,i,s,S,M){this.resourcesManager=e,this.dialog=n,this.authResolver=i,this.entityStorageService=s,this.cacheHelperService=S,this.destroyRef=M,this.resources=[],this.selected=new _e(!0,[],!0,(R,N)=>R.id===N.id),this.cachedSubject=new ge(!0),this.filterValue="",this.displayedColumns=[],this.routeAuth=!1}ngOnInit(){this.loading=!0,this.vo=this.entityStorageService.getEntity(),this.setAuthRights(),this.refreshTable(),this.cacheHelperService.refreshComponentCachedData().pipe(Ne(this.destroyRef)).subscribe(e=>{e===t.id&&this.refreshTable()})}setAuthRights(){this.removeAuth=this.authResolver.isAuthorized("deleteResource_Resource_policy",[this.vo]),this.resources.length!==0&&(this.routeAuth=this.authResolver.isAuthorized("getResourceById_int_policy",[this.vo,this.resources[0]])),this.displayedColumns=this.removeAuth?["select","id","name","facility","tags","description"]:["id","name","facility","tags","description"]}refreshTable(){this.loading=!0,this.resourcesManager.getRichResources(this.vo.id).subscribe(e=>{this.resources=e,this.selected.clear(),this.cachedSubject.next(!0),this.setAuthRights(),this.loading=!1})}applyFilter(e){this.filterValue=e,this.refreshTable()}deleteSelectedResources(){let e=F();e.width="450px",e.data={theme:"vo-theme",resources:this.selected.selected},this.dialog.open(Ja,e).afterClosed().subscribe(i=>{i&&this.refreshTable()})}static{this.\u0275fac=function(n){return new(n||t)(_(Si),_(Ae),_(pe),_(He),_(Je),_(we))}}static{this.\u0275cmp=x({type:t,selectors:[["app-vo-resources-preview"]],hostVars:2,hostBindings:function(n,i){n&2&&Ee("router-component",i.true)},decls:11,vars:7,consts:[["spinner",""],[1,"page-subtitle"],[3,"refresh"],["color","warn","mat-flat-button","",1,"me-2",3,"disabled"],[3,"filter","placeholder"],[1,"position-relative","table-min-height"],[3,"loading","disableRouting","filterValue","resources","routingVo","displayColumns","selection","cachedSubject",4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],["color","warn","mat-flat-button","",1,"me-2",3,"click","disabled"],[3,"loading","disableRouting","filterValue","resources","routingVo","displayColumns","selection","cachedSubject"]],template:function(n,i){if(n&1){let s=I();a(0,"div")(1,"h1",1),m(2),l(3,"translate"),r(),a(4,"perun-web-apps-refresh-button",2),C("refresh",function(){return f(s),g(i.refreshTable())}),r(),v(5,L0,3,4,"button",3),a(6,"perun-web-apps-debounce-filter",4),C("filter",function(M){return f(s),g(i.applyFilter(M))}),r(),T(7,y0,1,0,"ng-template",null,0,B),a(9,"div",5),T(10,w0,1,8,"perun-web-apps-resources-list",6),r()()}if(n&2){let s=y(8);o(2),E(p(3,5,"VO_DETAIL.RESOURCES.LIST.TITLE")),o(3),b(i.removeAuth?5:-1),o(),u("placeholder","SHARED_LIB.PERUN.COMPONENTS.RESOURCES_LIST.TABLE_SEARCH"),o(4),u("perunWebAppsLoader",i.loading)("perunWebAppsLoaderIndicator",s)}},dependencies:[D,P,G,ye,Ze,L,$i,V,Ge,O],encapsulation:2})}}return t})();var P0=(t,d,e)=>({redTableItem:t,greenTableItem:d,yellowTableItem:e});function G0(t,d){t&1&&A(0,"mat-spinner",0)}function N0(t,d){if(t&1&&(a(0,"div")(1,"i",6),m(2," error "),r(),m(3),l(4,"translate"),l(5,"translate"),r()),t&2){let e=c().$implicit,n=c(2);o(3),xo(" ",n.getErrorCountStates(e)," ",p(4,4,"VO_DETAIL.RESOURCES.STATES.FROM")," ",e.taskList.length," ",p(5,6,"VO_DETAIL.RESOURCES.STATES.TASKS_WITH_ERROR_STATE")," ")}}function B0(t,d){if(t&1&&(m(0),l(1,"translate"),l(2,"translate")),t&2){let e=c().$implicit;h(" ",e.taskList.length===0?p(1,1,"VO_DETAIL.RESOURCES.STATES.NO_SERVICES_ASSIGNED"):e.taskList.length+" "+p(2,3,"VO_DETAIL.RESOURCES.STATES.SERVICES_ASSIGNED")," ")}}function V0(t,d){t&1&&(a(0,"th",18),m(1),l(2,"translate"),r()),t&2&&(o(),h(" ",p(2,1,"VO_DETAIL.RESOURCES.STATES.TABLE_ID")," "))}function F0(t,d){if(t&1&&(a(0,"td",19),m(1),r()),t&2){let e=d.$implicit;o(),E(e.id)}}function k0(t,d){t&1&&(a(0,"th",18),m(1),l(2,"translate"),r()),t&2&&(o(),h(" ",p(2,1,"VO_DETAIL.RESOURCES.STATES.TABLE_SERVICE")," "))}function U0(t,d){if(t&1&&(a(0,"td",19),m(1),r()),t&2){let e=d.$implicit;o(),E(e.service.name)}}function j0(t,d){t&1&&(a(0,"th",18),m(1),l(2,"translate"),r()),t&2&&(o(),h(" ",p(2,1,"VO_DETAIL.RESOURCES.STATES.TABLE_STATUS")," "))}function W0(t,d){if(t&1&&(a(0,"td",19),m(1),r()),t&2){let e=d.$implicit;o(),E(e.status)}}function H0(t,d){t&1&&(a(0,"th",18),m(1),l(2,"translate"),r()),t&2&&(o(),h(" ",p(2,1,"VO_DETAIL.RESOURCES.STATES.TABLE_SCHEDULED")," "))}function z0(t,d){if(t&1&&(a(0,"div"),m(1),l(2,"date"),r()),t&2){let e=c().$implicit;o(),h(" ",Me(2,1,e.schedule,"d.M.y H:mm:ss")," ")}}function q0(t,d){t&1&&(m(0),l(1,"translate")),t&2&&h(" ",p(1,1,"VO_DETAIL.RESOURCES.STATES.NOT_YET")," ")}function $0(t,d){if(t&1&&(a(0,"td",19),v(1,z0,3,4,"div")(2,q0,2,3),r()),t&2){let e=d.$implicit;o(),b(e.schedule?1:2)}}function Y0(t,d){t&1&&(a(0,"th",18),m(1),l(2,"translate"),r()),t&2&&(o(),h(" ",p(2,1,"VO_DETAIL.RESOURCES.STATES.TABLE_STARTED")," "))}function X0(t,d){if(t&1&&(a(0,"div"),m(1),l(2,"date"),r()),t&2){let e=c().$implicit;o(),h(" ",Me(2,1,e.startTime,"d.M.y H:mm:ss")," ")}}function K0(t,d){t&1&&(m(0),l(1,"translate")),t&2&&h(" ",p(1,1,"VO_DETAIL.RESOURCES.STATES.NOT_YET")," ")}function Q0(t,d){if(t&1&&(a(0,"td",19),v(1,X0,3,4,"div")(2,K0,2,3),r()),t&2){let e=d.$implicit;o(),b(e.startTime?1:2)}}function Z0(t,d){t&1&&(a(0,"th",18),m(1),l(2,"translate"),r()),t&2&&(o(),h(" ",p(2,1,"VO_DETAIL.RESOURCES.STATES.TABLE_ENDED")," "))}function J0(t,d){if(t&1&&(a(0,"div"),m(1),l(2,"date"),r()),t&2){let e=c().$implicit;o(),h(" ",Me(2,1,e.endTime,"d.M.y H:mm:ss")," ")}}function eu(t,d){t&1&&(m(0),l(1,"translate")),t&2&&h(" ",p(1,1,"VO_DETAIL.RESOURCES.STATES.NOT_YET")," ")}function tu(t,d){if(t&1&&(a(0,"td",19),v(1,J0,3,4,"div")(2,eu,2,3),r()),t&2){let e=d.$implicit;o(),b(e.endTime?1:2)}}function iu(t,d){t&1&&A(0,"tr",20)}function nu(t,d){if(t&1&&A(0,"tr",21),t&2){let e=d.$implicit;u("ngClass",Do(1,P0,e.status==="ERROR"||e.status==="SENDERROR"||e.status==="GENERROR",e.status==="DONE",e.status==="WARNING"))}}function ou(t,d){if(t&1&&(a(0,"table",7),Q(1,8),T(2,V0,3,3,"th",9)(3,F0,2,1,"td",10),Z(),Q(4,11),T(5,k0,3,3,"th",9)(6,U0,2,1,"td",10),Z(),Q(7,12),T(8,j0,3,3,"th",9)(9,W0,2,1,"td",10),Z(),Q(10,13),T(11,H0,3,3,"th",9)(12,$0,3,1,"td",10),Z(),Q(13,14),T(14,Y0,3,3,"th",9)(15,Q0,3,1,"td",10),Z(),Q(16,15),T(17,Z0,3,3,"th",9)(18,tu,3,1,"td",10),Z(),T(19,iu,1,0,"tr",16)(20,nu,1,5,"tr",17),r()),t&2){let e=c(2).$implicit,n=c(2);u("dataSource",n.datasources[n.propagation.indexOf(e)]),o(19),u("matHeaderRowDef",n.displayedColumns),o(),u("matRowDefColumns",n.displayedColumns)}}function au(t,d){t&1&&(a(0,"div"),m(1),l(2,"translate"),r()),t&2&&(o(),h(" ",p(2,1,"VO_DETAIL.RESOURCES.STATES.NO_TASKS")," "))}function ru(t,d){if(t&1&&(A(0,"mat-divider"),v(1,ou,21,3,"table",7),v(2,au,3,3,"div")),t&2){let e=c().$implicit;o(),b(e.taskList.length!==0?1:-1),o(),b(e.taskList.length===0?2:-1)}}function su(t,d){if(t&1&&(a(0,"mat-expansion-panel")(1,"mat-expansion-panel-header")(2,"mat-panel-title"),A(3,"img",3),a(4,"div",4),m(5),r()(),a(6,"mat-panel-description"),v(7,N0,6,8,"div")(8,B0,3,5),r()(),T(9,ru,3,2,"ng-template",5),r()),t&2){let e=d.$implicit,n=c(2);o(5),h(" ",e.resource.name," "),o(2),b(n.getErrorCountStates(e)!==0?7:8)}}function lu(t,d){if(t&1&&(a(0,"div",1)(1,"mat-accordion",2),de(2,su,10,2,"mat-expansion-panel",null,Ce),r()()),t&2){let e=c();o(2),ce(e.propagation)}}var Tr=(()=>{class t{constructor(){this.propagation=[],this.loading=!1,this.datasources=[],this.displayedColumns=["id","service","status","scheduled","started","ended"]}getErrorCountStates(e){let n=0;for(let i of e.taskList)(i.status==="ERROR"||i.status==="GENERROR"||i.status==="SENDERROR")&&n++;return n}getDataSource(){this.datasources=[];for(let e of this.propagation)this.datasources.push(new et(e.taskList))}ngOnChanges(){this.getDataSource()}static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275cmp=x({type:t,selectors:[["app-state-tab"]],inputs:{propagation:"propagation",loading:"loading"},features:[Jt],decls:2,vars:2,consts:[[1,"ms-auto","me-auto"],[1,"p-2"],["multi","true","togglePosition","before",1,"headers-align"],["height","28","src","assets/img/PerunWebImages/resource-black.svg","width","28"],[1,"ms-2"],["matExpansionPanelContent",""],[1,"material-icons","red"],["mat-table","",1,"w-100",3,"dataSource"],["matColumnDef","id"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","service"],["matColumnDef","status"],["matColumnDef","scheduled"],["matColumnDef","started"],["matColumnDef","ended"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",3,"ngClass",4,"matRowDef","matRowDefColumns"],["mat-header-cell",""],["mat-cell",""],["mat-header-row",""],["mat-row","",3,"ngClass"]],template:function(n,i){n&1&&(v(0,G0,1,0,"mat-spinner",0),v(1,lu,4,0,"div",1)),n&2&&(b(i.loading?0:-1),o(),b(i.loading?-1:1))},dependencies:[D,gn,Ko,Xo,zo,qo,Yo,$o,Ho,Gi,vt,mt,ct,ft,ut,dt,gt,_t,ht,Ct,St,Ci,gi,L,Cn,O],styles:[".greenTableItem[_ngcontent-%COMP%]{background-color:#c4ffcb}.yellowTableItem[_ngcontent-%COMP%]{background-color:#fffde7}.redTableItem[_ngcontent-%COMP%]{background-color:#ffcdd2}.headers-align[_ngcontent-%COMP%]   .mat-expansion-panel-header-title[_ngcontent-%COMP%], .headers-align[_ngcontent-%COMP%]   .mat-expansion-panel-header-description[_ngcontent-%COMP%]{flex-basis:0}.headers-align[_ngcontent-%COMP%]   .mat-expansion-panel-header-description[_ngcontent-%COMP%]{margin-left:15%;justify-content:space-between;align-items:center}"]})}}return t})();function pu(t,d){if(t&1&&(m(0),l(1,"translate"),a(2,"span",5),m(3),r()),t&2){let e=c();h(" ",p(1,2,"VO_DETAIL.RESOURCES.STATES.ERROR_RESOURCES")," "),o(3),E(e.errorPropagation.length)}}function mu(t,d){t&1&&(a(0,"perun-web-apps-alert",6),m(1),l(2,"translate"),r()),t&2&&(o(),h(" ",p(2,1,"VO_DETAIL.RESOURCES.STATES.NO_RESOURCES_IN_ERROR")," "))}function du(t,d){if(t&1&&(v(0,mu,3,3,"perun-web-apps-alert",6),A(1,"app-state-tab",7)),t&2){let e=c();b(!e.loading&&e.errorPropagation.length===0?0:-1),o(),u("loading",e.loading)("propagation",e.errorPropagation)}}function cu(t,d){if(t&1&&(m(0),l(1,"translate"),a(2,"span",8),m(3),r()),t&2){let e=c();h(" ",p(1,2,"VO_DETAIL.RESOURCES.STATES.OK_RESOURCES")," "),o(3),E(e.okPropagation.length)}}function uu(t,d){t&1&&(a(0,"perun-web-apps-alert",6),m(1),l(2,"translate"),r()),t&2&&(o(),h(" ",p(2,1,"VO_DETAIL.RESOURCES.STATES.NO_RESOURCES_IN_OK")," "))}function _u(t,d){if(t&1&&(v(0,uu,3,3,"perun-web-apps-alert",6),A(1,"app-state-tab",7)),t&2){let e=c();b(!e.loading&&e.okPropagation.length===0?0:-1),o(),u("loading",e.loading)("propagation",e.okPropagation)}}var h3=(()=>{class t{static{this.id="VoResourcesStatesComponent"}constructor(e,n,i,s){this.taskService=e,this.entityStorageService=n,this.cacheHelperService=i,this.destroyRef=s,this.loading=!1,this.okPropagation=[],this.errorPropagation=[],this.resourceStates=[],this.selectedIndex=0}ngOnInit(){this.loading=!0,this.vo=this.entityStorageService.getEntity(),this.refreshTable(),this.cacheHelperService.refreshComponentCachedData().pipe(Ne(this.destroyRef)).subscribe(e=>{e===t.id&&this.refreshTable()})}refreshTable(){this.loading=!0,this.taskService.getAllResourcesState(this.vo.id).subscribe(e=>{this.resourceStates=e,this.okPropagation=[],this.errorPropagation=[];for(let n of e){let i=!0;for(let s of n.taskList)if(s.status==="ERROR"||s.status==="GENERROR"||s.status==="SENDERROR"){i=!1;break}i?this.okPropagation.push(n):this.errorPropagation.push(n)}this.loading=!1},()=>this.loading=!1)}static{this.\u0275fac=function(n){return new(n||t)(_(Wo),_(He),_(Je),_(we))}}static{this.\u0275cmp=x({type:t,selectors:[["app-vo-resources-states"]],hostVars:2,hostBindings:function(n,i){n&2&&Ee("router-component",i.true)},decls:11,vars:4,consts:[[1,"page-subtitle"],[3,"refresh"],["animationDuration","0ms","mat-stretch-tabs","false",1,"mt-3",3,"selectedIndexChange","selectedIndex"],["mat-tab-label",""],["matTabContent",""],[1,"badge","bg-danger","ms-2"],["alert_type","warn"],[3,"loading","propagation"],[1,"badge","bg-success","ms-2"]],template:function(n,i){n&1&&(a(0,"h1",0),m(1),l(2,"translate"),r(),a(3,"perun-web-apps-refresh-button",1),C("refresh",function(){return i.refreshTable()}),r(),a(4,"mat-tab-group",2),C("selectedIndexChange",function(S){return i.selectedIndex=S}),a(5,"mat-tab"),T(6,pu,4,4,"ng-template",3)(7,du,2,3,"ng-template",4),r(),a(8,"mat-tab"),T(9,cu,4,4,"ng-template",3)(10,_u,2,3,"ng-template",4),r()()),n&2&&(o(),E(p(2,2,"VO_DETAIL.RESOURCES.STATES.TITLE")),o(3),u("selectedIndex",i.selectedIndex))},dependencies:[D,be,ve,Ze,Ln,Qo,Zo,Rn,On,L,Tr,O],encapsulation:2})}}return t})();var hu=["autoRegToggle"],fu=()=>["drag","shortname","type","disabled","hidden","preview","managegroups","edit","delete"],gu=()=>["shortname","type","disabled","hidden","preview","managegroups"];function Cu(t,d){t&1&&A(0,"mat-spinner",2)}function Su(t,d){if(t&1&&(a(0,"span",19),m(1," , "),a(2,"mat-icon",21),m(3,"nat"),r(),m(4),l(5,"translate"),l(6,"translate"),r()),t&2){let e=c(3);o(4),h(" ",e.applicationForm.automaticApprovalEmbedded?p(5,1,"GROUP_DETAIL.SETTINGS.APPLICATION_FORM.AUTOMATIC"):p(6,3,"GROUP_DETAIL.SETTINGS.APPLICATION_FORM.MANUAL")," ")}}function vu(t,d){if(t&1){let e=I();a(0,"button",22),C("click",function(){f(e);let i=c(3);return g(i.settings())}),a(1,"i",23),m(2,"edit"),r(),a(3,"span",24),m(4),l(5,"translate"),r()()}t&2&&(o(4),h(" ",p(5,1,"GROUP_DETAIL.SETTINGS.APPLICATION_FORM.SETTINGS_BUTTON")," "))}function bu(t,d){t&1&&(a(0,"span")(1,"mat-icon",25),m(2,"info"),r(),m(3),l(4,"translate"),r()),t&2&&(o(3),h(" ",p(4,1,"GROUP_DETAIL.SETTINGS.APPLICATION_FORM.ALLOW_EMBEDDED")," "))}function Eu(t,d){if(t&1&&(a(0,"div",3)(1,"div")(2,"div",15),m(3),l(4,"translate"),r(),a(5,"div")(6,"span",15),m(7),l(8,"translate"),r(),m(9,": "),a(10,"mat-icon",16),m(11,"arrow_right_alt"),r(),m(12),l(13,"translate"),l(14,"translate"),a(15,"span",17)(16,"mat-icon",18),m(17,"restore"),r(),m(18),l(19,"translate"),l(20,"translate"),r(),v(21,Su,7,5,"span",19),v(22,vu,6,3,"button",20),r(),v(23,bu,5,3,"span"),r()()),t&2){let e=c(2);o(3),ot(" ",p(4,9,"GROUP_DETAIL.SETTINGS.APPLICATION_FORM.MODULE_NAMES"),": ",e.applicationForm.moduleClassNames," "),o(4),E(p(8,11,"GROUP_DETAIL.SETTINGS.APPLICATION_FORM.APPLICATION_TYPE")),o(5),h(" ",e.applicationForm.automaticApproval?p(13,13,"GROUP_DETAIL.SETTINGS.APPLICATION_FORM.AUTOMATIC"):p(14,15,"GROUP_DETAIL.SETTINGS.APPLICATION_FORM.MANUAL")," , "),o(3),u("ngClass",e.autoRegistrationEnabled?"":"me-2"),o(3),h(" ",e.applicationForm.automaticApprovalExtension?p(19,17,"GROUP_DETAIL.SETTINGS.APPLICATION_FORM.AUTOMATIC"):p(20,19,"GROUP_DETAIL.SETTINGS.APPLICATION_FORM.MANUAL")," "),o(3),b(e.autoRegistrationEnabled?21:-1),o(),b(e.editAuth?22:-1),o(),b(e.autoRegistrationEnabled?23:-1)}}function Iu(t,d){if(t&1){let e=I();a(0,"button",26),C("click",function(){f(e);let i=c(2);return g(i.add())}),m(1),l(2,"translate"),r()}if(t&2){let e=c(2);u("disabled",e.loadingTable),o(),h(" ",p(2,2,"GROUP_DETAIL.SETTINGS.APPLICATION_FORM.ADD_BUTTON")," ")}}function Tu(t,d){if(t&1){let e=I();a(0,"button",27),C("click",function(){f(e);let i=c(2);return g(i.save())}),a(1,"i",11),m(2,"save"),r(),m(3),l(4,"translate"),r()}if(t&2){let e=c(2);u("disabled",!e.itemsChanged),o(3),h(" ",p(4,2,"VO_DETAIL.SETTINGS.APPLICATION_FORM.SAVE_BUTTON")," ")}}function Au(t,d){if(t&1){let e=I();a(0,"button",28),C("click",function(){f(e);let i=c(2);return g(i.copy())}),a(1,"i",23),m(2,"file_copy"),r(),a(3,"span",24),m(4),l(5,"translate"),r()()}t&2&&(o(4),h(" ",p(5,1,"GROUP_DETAIL.SETTINGS.APPLICATION_FORM.COPY_GROUP_BUTTON")," "))}function Mu(t,d){t&1&&(a(0,"perun-web-apps-alert",12),m(1),l(2,"translate"),r()),t&2&&(o(),h(" ",p(2,1,"GROUP_DETAIL.SETTINGS.APPLICATION_FORM.DRAG_AND_DROP_INFO")," "))}function xu(t,d){t&1&&A(0,"perun-web-apps-loading-table")}function Du(t,d){if(t&1){let e=I();a(0,"app-application-form-list",29),C("applicationFormItemsChange",function(){f(e);let i=c(2);return g(i.changeItems())}),r()}if(t&2){let e=c(2);u("loading",e.loadingTable)("applicationForm",e.applicationForm)("applicationFormItems",e.applicationFormItems)("displayColumns",e.editAuth?ue(7,fu):ue(8,gu))("refreshApplicationForm",e.refreshApplicationForm)("embeddedGroupsItemSaved",e.embeddedGroupsItemSaved)("theme","group-theme")}}function Ru(t,d){if(t&1){let e=I();a(0,"div"),v(1,Eu,24,21,"div",3),A(2,"mat-divider",4),a(3,"div",5)(4,"perun-web-apps-refresh-button",6),C("refresh",function(){f(e);let i=c();return g(i.updateFormItems())}),r(),v(5,Iu,3,4,"button",7),v(6,Tu,5,4,"button",8),v(7,Au,6,3,"button",9),a(8,"button",10),C("click",function(){f(e);let i=c();return g(i.preview())}),a(9,"i",11),m(10,"search"),r(),m(11),l(12,"translate"),r()(),v(13,Mu,3,3,"perun-web-apps-alert",12),T(14,xu,1,0,"ng-template",null,0,B),a(16,"div",13),T(17,Du,1,9,"app-application-form-list",14),r()()}if(t&2){let e=y(15),n=c();o(),b(n.loadingHeader?-1:1),o(4),b(n.editAuth?5:-1),o(),b(n.editAuth?6:-1),o(),b(n.editAuth?7:-1),o(4),h(" ",p(12,8,"GROUP_DETAIL.SETTINGS.APPLICATION_FORM.PREVIEW_BUTTON")," "),o(2),b(n.editAuth?13:-1),o(4),u("perunWebAppsLoader",n.loadingTable)("perunWebAppsLoaderIndicator",e)}}function Ou(t,d){if(t&1){let e=I();a(0,"button",32),C("click",function(){f(e);let i=c(2);return g(i.createEmptyApplicationForm())}),m(1),l(2,"translate"),r()}t&2&&(o(),h(" ",p(2,1,"GROUP_DETAIL.SETTINGS.APPLICATION_FORM.CREATE_APPLICATION_FORM")," "))}function Lu(t,d){if(t&1&&(a(0,"div")(1,"perun-web-apps-alert",30),m(2),l(3,"translate"),r(),v(4,Ou,3,3,"button",31),r()),t&2){let e=c();o(2),E(p(3,2,"GROUP_DETAIL.SETTINGS.APPLICATION_FORM.NO_APPLICATION_FORM")),o(2),b(e.createEmptyForm?4:-1)}}var W3=(()=>{class t{static{this.id="GroupSettingsApplicationFormComponent"}constructor(e,n,i,s,S,M,R,N,re){this.registrarManager=e,this.dialog=n,this.notificator=i,this.translate=s,this.apiRequest=S,this.router=M,this.guiAuthResolver=R,this.attributesManager=N,this.entityStorageService=re,this.loadingHeader=!1,this.loadingTable=!1,this.applicationFormItems=[],this.noApplicationForm=!1,this.itemsChanged=!1,this.editAuth=!1,this.createEmptyForm=!1,this.refreshApplicationForm=!1,this.embeddedGroupsItemSaved=!1,this.idCounter=-1}ngOnInit(){this.loadingHeader=!0,this.loadingTable=!0,this.group=this.entityStorageService.getEntity(),this.setAuth(),this.apiRequest.dontHandleErrorForNext(),this.registrarManager.getGroupApplicationForm(this.group.id).subscribe({next:e=>{this.applicationForm=e,this.registrarManager.getFormItemsForGroup(this.group.id).subscribe({next:n=>{this.applicationFormItems=n,this.embeddedGroupsItemSaved=n.filter(i=>i.type==="EMBEDDED_GROUP_APPLICATION").length>0,this.attributesManager.getGroupAttributeByName(this.group.id,"urn:perun:group:attribute-def:virt:autoRegistrationEnabled").subscribe(i=>{this.autoRegistrationEnabled=!!i.value,this.loadingHeader=!1,this.loadingTable=!1})},error:()=>{this.loadingHeader=!1,this.loadingTable=!1}})},error:e=>{e.name==="FormNotExistsException"?(this.noApplicationForm=!0,this.loadingHeader=!1,this.loadingTable=!1):this.notificator.showRPCError(e)}})}setAuth(){this.editAuth=this.guiAuthResolver.isAuthorized("group-updateFormItems_ApplicationForm_List<ApplicationFormItem>_policy",[this.group]),this.createEmptyForm=this.guiAuthResolver.isAuthorized("createApplicationFormInGroup_Group_policy",[this.group])}add(){let e=F();e.width="500px",e.data={applicationFormItems:this.applicationFormItems,fakeId:this.idCounter--},this.dialog.open(ao,e).afterClosed().subscribe(i=>{i&&(this.applicationFormItems=Object.assign([],i[0]),e=F(),e.width="600px",e.height="600px",e.data={voId:this.group.voId,groupId:this.group.id,applicationFormItem:i[1],theme:"group-theme",allItems:this.applicationFormItems},this.dialog.open(tn,e),this.itemsChanged=!0)})}copy(){let e=F();e.width="500px",e.data={voId:this.group.voId,groupId:this.group.id,theme:"group-theme"},this.dialog.open(oo,e).afterClosed().subscribe(i=>{i&&this.updateFormItems()})}settings(){let e=F();e.width="400px",e.data={entity:"group",applicationForm:this.applicationForm,theme:"group-theme",autoRegistrationEnabled:this.autoRegistrationEnabled},this.dialog.open(no,e).afterClosed().subscribe(i=>{i&&(this.translate.get("GROUP_DETAIL.SETTINGS.APPLICATION_FORM.CHANGE_SETTINGS_SUCCESS").subscribe(s=>{this.notificator.showSuccess(s)}),this.applicationForm=i)})}preview(){this.router.navigate(["/organizations",this.group.voId,"groups",this.group.id,"settings","applicationForm","preview"],{queryParams:{applicationFormItems:JSON.stringify(this.applicationFormItems)},queryParamsHandling:"merge"})}updateFormItems(){this.loadingTable=!0,this.refreshApplicationForm=!0,this.registrarManager.getFormItemsForGroup(this.group.id).subscribe({next:e=>{this.applicationFormItems=e,this.embeddedGroupsItemSaved=e.filter(n=>n.type==="EMBEDDED_GROUP_APPLICATION").length>0,this.itemsChanged=!1,this.refreshApplicationForm=!1,this.loadingTable=!1},error:()=>this.loadingTable=!1})}changeItems(){this.itemsChanged=!0}createEmptyApplicationForm(){this.registrarManager.createApplicationFormInGroup(this.group.id).subscribe(()=>{this.noApplicationForm=!1,this.ngOnInit()})}save(){let e=0;for(let n of this.applicationFormItems)n.ordnum=e,n.forDelete||e++;this.registrarManager.updateFormItemsForGroup({group:this.group.id,items:this.applicationFormItems}).subscribe(()=>{this.translate.get("VO_DETAIL.SETTINGS.APPLICATION_FORM.CHANGE_APPLICATION_FORM_ITEMS_SUCCESS").subscribe(n=>{this.notificator.showSuccess(n)}),this.updateFormItems()})}clear(){this.applicationFormItems=[],this.itemsChanged=!0}static{this.\u0275fac=function(n){return new(n||t)(_(tt),_(Ae),_(q),_(Se),_(xt),_(fi),_(pe),_(Tt),_(He))}}static{this.\u0275cmp=x({type:t,selectors:[["app-group-settings-application-form"]],viewQuery:function(n,i){if(n&1&&Be(hu,5),n&2){let s;Ve(s=Fe())&&(i.autoRegToggle=s.first)}},hostVars:2,hostBindings:function(n,i){n&2&&Ee("router-component",i.true)},decls:6,vars:6,consts:[["spinner",""],[1,"page-subtitle"],[1,"ms-auto","me-auto"],[1,"d-flex","w-75"],[1,"mb-2","mt-2"],[1,"w-100","d-flex"],[3,"refresh"],["color","accent","data-cy","add-form-item","mat-flat-button","",1,"me-2","action-button",3,"disabled"],["color","accent","data-cy","save-application-form","mat-flat-button","",1,"me-2",3,"disabled"],["mat-stroked-button","",1,"me-2","action-button"],["mat-stroked-button","",3,"click"],[1,"material-icons"],["alert_type","info"],[1,"position-relative","table-min-height"],[3,"loading","applicationForm","applicationFormItems","displayColumns","refreshApplicationForm","embeddedGroupsItemSaved","theme","applicationFormItemsChange",4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],[1,"fw-bold"],["matTooltip","Initial",1,"align-middle"],[3,"ngClass"],["matTooltip","Extension",1,"align-middle"],[1,"me-2"],["mat-stroked-button","",1,"ms-2","action-button"],["matTooltip","Embedded",1,"align-middle"],["mat-stroked-button","",1,"ms-2","action-button",3,"click"],[1,"material-icons","align-middle"],[1,"align-middle"],[1,"align-bottom"],["color","accent","data-cy","add-form-item","mat-flat-button","",1,"me-2","action-button",3,"click","disabled"],["color","accent","data-cy","save-application-form","mat-flat-button","",1,"me-2",3,"click","disabled"],["mat-stroked-button","",1,"me-2","action-button",3,"click"],[3,"applicationFormItemsChange","loading","applicationForm","applicationFormItems","displayColumns","refreshApplicationForm","embeddedGroupsItemSaved","theme"],["alert_type","warn"],["data-cy","create-empty-form","mat-stroked-button",""],["data-cy","create-empty-form","mat-stroked-button","",3,"click"]],template:function(n,i){n&1&&(a(0,"h1",1),m(1),l(2,"translate"),r(),v(3,Cu,1,0,"mat-spinner",2),v(4,Ru,18,10,"div"),v(5,Lu,5,4,"div")),n&2&&(o(),h(" ",p(2,4,"GROUP_DETAIL.SETTINGS.APPLICATION_FORM.TITLE"),`
`),o(2),b(i.loadingHeader?3:-1),o(),b(i.noApplicationForm?-1:4),o(),b(!i.loadingTable&&i.noApplicationForm?5:-1))},dependencies:[D,gn,P,G,lt,st,be,ve,Ze,Gi,Ci,gi,L,ne,ro,V,Ge,O],encapsulation:2})}}return t})();var yu=()=>["select","id","name","description"];function wu(t,d){t&1&&A(0,"perun-web-apps-loading-dialog")}function Pu(t,d){if(t&1){let e=I();a(0,"perun-web-apps-vo-search-select",12),C("voSelected",function(i){f(e);let s=c(2);return g(s.getGroupsToInclude(i.id))}),r()}if(t&2){let e=c(2);u("vo",e.thisVo.vo)("vos",e.vosToSelect)}}function Gu(t,d){t&1&&A(0,"perun-web-apps-loading-table")}function Nu(t,d){if(t&1&&A(0,"perun-web-apps-groups-list",13),t&2){let e=c(2);u("loading",e.loading)("disableGroups",!0)("groups",e.groups)("selection",e.selection)("disableHeadCheckbox",!0)("disableRouting",!0)("displayColumns",ue(9,yu))("filter",e.filterValue)("relation",!0)}}function Bu(t,d){if(t&1){let e=I();a(0,"div")(1,"h1",3),m(2),l(3,"translate"),r(),v(4,Pu,1,2,"perun-web-apps-vo-search-select",4),a(5,"div",5)(6,"perun-web-apps-debounce-filter",6),C("filter",function(i){f(e);let s=c();return g(s.applyFilter(i))}),r(),T(7,Gu,1,0,"ng-template",null,1,B),a(9,"div",7),T(10,Nu,1,10,"perun-web-apps-groups-list",8),r()(),a(11,"div",9)(12,"button",10),C("click",function(){f(e);let i=c();return g(i.onCancel())}),m(13),l(14,"translate"),r(),a(15,"button",11),C("click",function(){f(e);let i=c();return g(i.onSubmit())}),m(16),l(17,"translate"),r()()()}if(t&2){let e=y(8),n=c();o(2),E(p(3,8,"DIALOGS.CREATE_RELATION.TITLE")),o(2),b(n.vosToSelect.length>1?4:-1),o(2),u("placeholder","GROUP_DETAIL.SETTINGS.RELATIONS.FILTER"),o(4),u("perunWebAppsLoader",n.loading)("perunWebAppsLoaderIndicator",e),o(3),h(" ",p(14,10,"DIALOGS.CREATE_RELATION.CANCEL")," "),o(2),u("disabled",n.loading||n.initLoading||n.selection.selected.length===0),o(),h(" ",p(17,12,"DIALOGS.CREATE_RELATION.CREATE")," ")}}var Ar=(()=>{class t{constructor(e,n,i,s,S,M,R){this.dialogRef=e,this.groupService=n,this.notificator=i,this.translate=s,this.guiAuthResolver=S,this.voService=M,this.data=R,this.selection=new _e(!1,[],!0,(N,re)=>N.id===re.id),this.groups=[],this.filterValue="",this.vosToSelect=[],s.get("DIALOGS.CREATE_RELATION.SUCCESS").subscribe(N=>this.successMessage=N)}ngOnInit(){this.initLoading=!0,this.groupService.getGroupUnions(this.data.group.id,!this.data.reverse).subscribe({next:e=>{e=e.concat(this.data.groups),this.groupsToNotInclude=e.map(n=>n.id),this.voService.getEnrichedVoById(this.data.voId).subscribe(n=>{this.thisVo=n,this.vosToSelect=n.memberVos.filter(i=>this.guiAuthResolver.isAuthorized("getAllAllowedGroupsToHierarchicalVo_Vo_policy",[i])),this.vosToSelect.push(n.vo),this.getGroupsToInclude(this.data.voId),this.initLoading=!1})},error:()=>this.initLoading=!1}),this.theme=this.data.theme}onCancel(){this.dialogRef.close(!1)}getGroupsToInclude(e){this.loading=!0,e===this.data.voId?this.groupService.getAllGroups(this.data.voId).subscribe({next:n=>{this.finishLoadingGroups(n)},error:()=>this.loading=!1}):this.groupService.getVoAllAllowedGroupsToHierarchicalVo(this.data.voId,e).subscribe({next:n=>{this.finishLoadingGroups(n)},error:()=>this.loading=!1})}onSubmit(){this.loading=!0,this.groupService.createGroupUnion(this.data.group.id,this.selection.selected[0].id).subscribe({next:()=>{this.notificator.showSuccess(this.successMessage),this.loading=!1,this.dialogRef.close(!0)},error:()=>this.loading=!1})}applyFilter(e){this.filterValue=e,this.selection.clear()}filterGroups(){this.groups.filter(e=>this.guiAuthResolver.isAuthorized("result-createGroupUnion_Group_Group_policy",[this.data.group])&&this.guiAuthResolver.isAuthorized("operand-createGroupUnion_Group_Group_policy",[e]))}finishLoadingGroups(e){this.groups=e.filter(n=>!this.groupsToNotInclude.includes(n.id)&&n.id!==this.data.group.id),this.filterGroups(),this.selection.clear(),this.loading=!1}static{this.\u0275fac=function(n){return new(n||t)(_(U),_(De),_(q),_(Se),_(pe),_(Vt),_(j))}}static{this.\u0275cmp=x({type:t,selectors:[["app-create-relation-dialog"]],decls:4,vars:5,consts:[["spinner",""],["tableSpinner",""],[4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],["mat-dialog-title",""],[3,"vo","vos"],["mat-dialog-content","",1,"dialog-container"],[3,"filter","placeholder"],[1,"position-relative","table-min-height"],[3,"loading","disableGroups","groups","selection","disableHeadCheckbox","disableRouting","displayColumns","filter","relation",4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],["mat-dialog-actions",""],["mat-stroked-button","",1,"ms-auto",3,"click"],["color","accent","mat-flat-button","",1,"ms-2",3,"click","disabled"],[3,"voSelected","vo","vos"],[3,"loading","disableGroups","groups","selection","disableHeadCheckbox","disableRouting","displayColumns","filter","relation"]],template:function(n,i){if(n&1&&(T(0,wu,1,0,"ng-template",null,0,B),a(2,"div"),T(3,Bu,18,14,"div",2),r()),n&2){let s=y(1);o(2),H(W("",i.theme," position-relative")),o(),u("perunWebAppsLoader",i.initLoading)("perunWebAppsLoaderIndicator",s)}},dependencies:[D,P,G,K,$,X,Y,oe,ye,L,Gt,jn,V,Ge,O],encapsulation:2})}}return t})();function Vu(t,d){t&1&&A(0,"perun-web-apps-loading-dialog")}function Fu(t,d){t&1&&A(0,"th",14)}function ku(t,d){if(t&1&&(a(0,"td",15),m(1),r()),t&2){let e=d.$implicit;o(),E(e.name)}}function Uu(t,d){t&1&&A(0,"tr",16)}function ju(t,d){t&1&&A(0,"tr",17)}function Wu(t,d){if(t&1){let e=I();a(0,"div")(1,"h1",2),m(2),l(3,"translate"),r(),a(4,"div",3)(5,"p"),m(6),l(7,"translate"),r(),a(8,"div",4),m(9),l(10,"translate"),r(),a(11,"table",5),Q(12,6),T(13,Fu,1,0,"th",7)(14,ku,2,1,"td",8),Z(),T(15,Uu,1,0,"tr",9)(16,ju,1,0,"tr",10),r()(),a(17,"div",11)(18,"button",12),C("click",function(){f(e);let i=c();return g(i.onCancel())}),m(19),l(20,"translate"),r(),a(21,"button",13),C("click",function(){f(e);let i=c();return g(i.onSubmit())}),m(22),l(23,"translate"),r()()()}if(t&2){let e=c();o(2),E(p(3,9,"DIALOGS.REMOVE_RELATION.TITLE")),o(4),h(" ",p(7,11,"DIALOGS.REMOVE_RELATION.DESCRIPTION")," "),o(3),h(" ",p(10,13,"DIALOGS.REMOVE_RELATION.ASK")," "),o(2),u("dataSource",e.dataSource),o(4),u("matHeaderRowDef",e.displayedColumns),o(),u("matRowDefColumns",e.displayedColumns),o(3),h(" ",p(20,15,"DIALOGS.REMOVE_RELATION.CANCEL")," "),o(2),u("disabled",e.loading),o(),h(" ",p(23,17,"DIALOGS.REMOVE_RELATION.DELETE")," ")}}var Mr=(()=>{class t{constructor(e,n,i,s,S){this.dialogRef=e,this.data=n,this.notificator=i,this.groupService=s,this.translate=S,this.displayedColumns=["name"],S.get("DIALOGS.REMOVE_RELATION.SUCCESS").subscribe(M=>this.successMessage=M)}ngOnInit(){this.theme=this.data.theme,this.dataSource=new et(this.data.groups)}onCancel(){this.dialogRef.close(!1)}onSubmit(){if(this.loading=!0,this.data.groups.length===1){let e=this.data.reverse?this.data.groups[0].id:this.data.groupId,n=this.data.reverse?this.data.groupId:this.data.groups[0].id;this.groupService.removeGroupUnion(e,n).subscribe(()=>{this.notificator.showSuccess(this.successMessage),this.loading=!1,this.dialogRef.close(!0)},()=>this.loading=!1)}else{let e=this.data.reverse?this.data.groups.shift().id:this.data.groupId,n=this.data.reverse?this.data.groupId:this.data.groups.shift().id;this.groupService.removeGroupUnion(e,n).subscribe(()=>{this.onSubmit(),this.dialogRef.close(!0)},()=>this.loading=!1)}}static{this.\u0275fac=function(n){return new(n||t)(_(U),_(j),_(q),_(De),_(Se))}}static{this.\u0275cmp=x({type:t,selectors:[["app-remove-relation-dialog"]],decls:4,vars:5,consts:[["spinner",""],[4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],["mat-dialog-title",""],["mat-dialog-content",""],[1,"fw-bold"],["mat-table","",1,"w-100",3,"dataSource"],["matColumnDef","name"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["class","font-weight-bolder","mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["mat-dialog-actions",""],["mat-stroked-button","",1,"ms-auto",3,"click"],["color","warn","mat-flat-button","",1,"ms-2",3,"click","disabled"],["mat-header-cell",""],["mat-cell",""],["mat-header-row","",1,"font-weight-bolder"],["mat-row",""]],template:function(n,i){if(n&1&&(T(0,Vu,1,0,"ng-template",null,0,B),a(2,"div"),T(3,Wu,24,19,"div",1),r()),n&2){let s=y(1);o(2),H(W("",i.theme," position-relative")),o(),u("perunWebAppsLoader",i.loading)("perunWebAppsLoaderIndicator",s)}},dependencies:[D,P,G,K,$,X,Y,oe,vt,mt,ct,ft,ut,dt,gt,_t,ht,Ct,St,L,V,O],encapsulation:2})}}return t})();var Hu=t=>({removeAuth:t}),zu=()=>["select","id","vo","name","description"];function qu(t,d){if(t&1){let e=I();a(0,"span",4),l(1,"translate"),a(2,"button",9),C("click",function(){f(e);let i=c();return g(i.onDelete())}),m(3),l(4,"translate"),r()()}if(t&2){let e=d,n=c();u("matTooltip",w(p(1,5,"GROUP_DETAIL.SETTINGS.RELATIONS.DELETE_TOOLTIP")))("matTooltipDisabled",n.loading||n.selection.selected.length===0||e.removeAuth),o(2),u("disabled",n.loading||n.selection.selected.length===0||!e.removeAuth||n.reverse),o(),h(" ",p(4,7,"GROUP_DETAIL.SETTINGS.RELATIONS.DELETE")," ")}}function $u(t,d){t&1&&A(0,"perun-web-apps-loading-table")}function Yu(t,d){if(t&1&&A(0,"perun-web-apps-groups-list",10),t&2){let e=c();u("loading",e.loading)("groups",e.groups)("parentGroup",e.group)("disableHeadCheckbox",!0)("selection",e.selection)("displayColumns",ue(8,zu))("filter",e.filterValue)("cacheSubject",e.cacheSubject)}}var HL=(()=>{class t{static{this.id="GroupSettingsRelationsComponent"}constructor(e,n,i,s,S,M){this.groupService=e,this.dialog=n,this.entityStorageService=i,this.authResolver=s,this.cacheHelperService=S,this.destroyRef=M,this.selection=new _e(!0,[],!0,(R,N)=>R.id===N.id),this.groups=[],this.reverse=!1,this.filterValue="",this.removeAuth$=this.selection.changed.pipe(Dt(R=>R.source.selected.reduce((N,re)=>N&&this.authResolver.isAuthorized("result-removeGroupUnion_Group_Group_policy",[{id:this.group.id,beanName:"Group",voId:this.group.voId}])&&this.authResolver.isAuthorized("operand-removeGroupUnion_Group_Group_policy",[re]),!0))),this.cacheSubject=new ge(!0)}ngOnInit(){this.group=this.entityStorageService.getEntity(),this.refreshTable(),this.cacheHelperService.refreshComponentCachedData().pipe(Ne(this.destroyRef)).subscribe(e=>{e===t.id&&this.refreshTable()})}onCreate(){let e=F();e.width="1050px",e.data={groups:this.groups,theme:"group-theme",group:this.group,voId:this.group.voId,reverse:this.reverse},this.dialog.open(Ar,e).afterClosed().subscribe(i=>{i&&this.refreshTable()})}onDelete(){let e=F();e.width="450px",e.data={groups:this.selection.selected,theme:"group-theme",groupId:this.group.id,reverse:this.reverse},this.dialog.open(Mr,e).afterClosed().subscribe(i=>{i&&this.refreshTable()})}refreshTable(){this.loading=!0,this.cacheSubject.next(!0),this.selection.clear(),this.groupService.getGroupUnions(this.group.id,this.reverse).subscribe({next:e=>{this.groups=e,this.loading=!1},error:()=>this.loading=!1})}applyFilter(e){this.filterValue=e,this.selection.clear()}showReverseUnions(){this.reverse=!this.reverse,this.refreshTable()}static{this.\u0275fac=function(n){return new(n||t)(_(De),_(Ae),_(He),_(pe),_(Je),_(we))}}static{this.\u0275cmp=x({type:t,selectors:[["app-group-settings-relations"]],hostVars:2,hostBindings:function(n,i){n&2&&Ee("router-component",i.true)},decls:18,vars:18,consts:[["spinner",""],[1,"page-subtitle"],[3,"refresh"],["color","accent","mat-flat-button","",1,"me-2","action-button",3,"click","disabled"],[3,"matTooltip","matTooltipDisabled"],[3,"filter","placeholder"],[3,"change"],[1,"position-relative","table-min-height"],[3,"loading","groups","parentGroup","disableHeadCheckbox","selection","displayColumns","filter","cacheSubject",4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],["color","warn","mat-flat-button","",1,"me-2",3,"click","disabled"],[3,"loading","groups","parentGroup","disableHeadCheckbox","selection","displayColumns","filter","cacheSubject"]],template:function(n,i){if(n&1){let s=I();a(0,"div")(1,"h1",1),m(2),l(3,"translate"),r(),a(4,"perun-web-apps-refresh-button",2),C("refresh",function(){return f(s),g(i.refreshTable())}),r(),a(5,"button",3),C("click",function(){return f(s),g(i.onCreate())}),m(6),l(7,"translate"),r(),v(8,qu,5,9,"span",4),l(9,"async"),a(10,"perun-web-apps-debounce-filter",5),C("filter",function(M){return f(s),g(i.applyFilter(M))}),r(),a(11,"mat-checkbox",6),C("change",function(){return f(s),g(i.showReverseUnions())}),m(12),l(13,"translate"),r(),T(14,$u,1,0,"ng-template",null,0,B),a(16,"div",7),T(17,Yu,1,9,"perun-web-apps-groups-list",8),r()()}if(n&2){let s,S=y(15);o(2),E(p(3,8,"GROUP_DETAIL.SETTINGS.RELATIONS.TITLE")),o(3),u("disabled",i.reverse),o(),h(" ",p(7,10,"GROUP_DETAIL.SETTINGS.RELATIONS.CREATE")," "),o(2),b((s=ke(16,Hu,p(9,12,i.removeAuth$)))?8:-1,s),o(2),u("placeholder","GROUP_DETAIL.SETTINGS.RELATIONS.FILTER"),o(2),E(p(13,14,"GROUP_DETAIL.SETTINGS.RELATIONS.REVERSE_UNIONS")),o(5),u("perunWebAppsLoader",i.loading)("perunWebAppsLoaderIndicator",S)}},dependencies:[D,P,G,Pt,wt,ye,Ze,L,ne,Gt,V,Ge,at,O],encapsulation:2})}}return t})();function Xu(t,d){if(t&1){let e=I();a(0,"div")(1,"perun-web-apps-user-search-select",5),C("userSelected",function(i){f(e);let s=c();return g(s.selectSponsor(i))}),r()()}if(t&2){let e=c();o(),u("disableAutoSelect",!0)("users",e.voSponsors)}}var Ei=(()=>{class t{constructor(e){this.guiAuthResolver=e,this.voSponsors=[],this.disableSelf=!1,this.customTitle="DIALOGS.CREATE_SPONSORED_MEMBER.SELECT_SPONSOR_DEFAULT",this.sponsorTypeSelected=new pt,this.sponsorSelected=new pt,this.sponsorType="self",this.isSponsor=!1,this.isPerunAdmin=!1,this.selectedSponsor=null,this.selfTooltip="DIALOGS.CREATE_SPONSORED_MEMBER.SELECT_SELF_DISABLED"}ngOnInit(){this.isSponsor=this.guiAuthResolver.principalHasRole(fo.SPONSOR,"Vo",this.voId)||this.guiAuthResolver.principalHasRole(fo.SPONSORNOCREATERIGHTS,"Vo",this.voId),this.isPerunAdmin=this.guiAuthResolver.isPerunAdmin(),this.isSelfEnabled()&&(this.selfTooltip="DIALOGS.CREATE_SPONSORED_MEMBER.SELECT_SELF_DISABLED_COPY"),this.updateSponsorType()}ngOnChanges(){this.updateSponsorType()}updateSponsorType(){this.sponsorType=this.isSelfEnabled()?"self":"other",this.emitSponsorType()}emitSponsorType(){this.sponsorType==="self"&&this.selectSponsor(null),this.sponsorTypeSelected.emit(this.sponsorType)}selectSponsor(e){this.selectedSponsor=e,this.sponsorSelected.emit(e)}isSelfEnabled(){return this.isSponsor&&!this.disableSelf}static{this.\u0275fac=function(n){return new(n||t)(_(pe))}}static{this.\u0275cmp=x({type:t,selectors:[["app-choose-sponsor"]],inputs:{voId:"voId",voSponsors:"voSponsors",disableSelf:"disableSelf",customTitle:"customTitle"},outputs:{sponsorTypeSelected:"sponsorTypeSelected",sponsorSelected:"sponsorSelected"},features:[Jt],decls:16,vars:23,consts:[[1,"mt-4"],[1,"dialog-container",3,"ngModelChange","ngModel"],["matTooltipPosition","before",3,"matTooltip","matTooltipDisabled"],["value","self",3,"click","disabled"],["value","other",3,"disabled"],[3,"userSelected","disableAutoSelect","users"]],template:function(n,i){n&1&&(a(0,"div",0)(1,"h6"),m(2),l(3,"translate"),r(),a(4,"mat-radio-group",1),te("ngModelChange",function(S){return ee(i.sponsorType,S)||(i.sponsorType=S),S}),C("ngModelChange",function(){return i.emitSponsorType()}),a(5,"span",2),l(6,"translate"),a(7,"mat-radio-button",3),C("click",function(){return i.selectedSponsor=null}),m(8),l(9,"translate"),r()(),a(10,"span",2),l(11,"translate"),a(12,"mat-radio-button",4),m(13),l(14,"translate"),r()()(),v(15,Xu,2,2,"div"),r()),n&2&&(o(2),E(p(3,13,i.customTitle)),o(2),J("ngModel",i.sponsorType),o(),u("matTooltip",w(p(6,15,i.selfTooltip)))("matTooltipDisabled",i.isSelfEnabled()),o(2),u("disabled",!i.isSelfEnabled()),o(),h(" ",p(9,17,"DIALOGS.CREATE_SPONSORED_MEMBER.SELECT_SELF")," "),o(2),u("matTooltip",w(p(11,19,"DIALOGS.CREATE_SPONSORED_MEMBER.SELECT_OTHER_DISABLED")))("matTooltipDisabled",i.isPerunAdmin),o(2),u("disabled",!i.isPerunAdmin),o(),h(" ",p(14,21,"DIALOGS.CREATE_SPONSORED_MEMBER.SELECT_OTHER")," "),o(2),b(i.sponsorType==="other"?15:-1))},dependencies:[D,ri,oi,ai,je,se,Ue,le,L,ne,Hn,O],encapsulation:2})}}return t})();var Ku=()=>["select","id","name","description"];function Qu(t,d){t&1&&(a(0,"div")(1,"perun-web-apps-alert",7),m(2),l(3,"translate"),r()()),t&2&&(o(2),E(p(3,1,"DIALOGS.GENERATE_SPONSORED_MEMBERS.DONT_ASSIGN_INFO")))}function Zu(t,d){if(t&1){let e=I();a(0,"div")(1,"h5",8),m(2),l(3,"translate"),r(),a(4,"perun-web-apps-create-group-form",9),C("asSubgroupChanged",function(i){f(e);let s=c();return g(s.onAsSubgroupChange(i))})("nameChanged",function(i){f(e);let s=c();return g(s.onNameChange(i))})("descriptionChanged",function(i){f(e);let s=c();return g(s.onDescriptionChange(i))})("parentGroupChanged",function(i){f(e);let s=c();return g(s.onParentChange(i))}),r()()}if(t&2){let e=c();o(2),E(p(3,2,"DIALOGS.GENERATE_SPONSORED_MEMBERS.CREATE_NEW_GROUP")),o(2),u("voGroups",e.allVoGroups)}}function Ju(t,d){if(t&1){let e=I();a(0,"div")(1,"h5",8),m(2),l(3,"translate"),r(),a(4,"perun-web-apps-debounce-filter",10),C("filter",function(i){f(e);let s=c();return g(s.applyFilter(i))}),r(),A(5,"perun-web-apps-groups-list",11),r()}if(t&2){let e=c();o(2),E(p(3,8,"DIALOGS.GENERATE_SPONSORED_MEMBERS.SELECT_EXISTING_GROUPS")),o(2),u("placeholder","SHARED_LIB.PERUN.COMPONENTS.RESOURCES_LIST.TABLE_SEARCH"),o(),u("loading",e.loading)("groups",e.assignableGroups)("selection",e.selection)("disableRouting",!0)("displayColumns",ue(10,Ku))("filter",e.filterValue)}}var so=(()=>{class t{constructor(e,n,i){this.groupsService=e,this.guiAuthResolver=n,this.attributesService=i,this.groupsToAdd=new pt,this.submitAllowed=new pt,this.loading=!1,this.assignableGroups=[],this.allVoGroups=[],this.manualMemberAddingBlocked=!1,this.groupAssignment="none",this.selection=new _e(!0,[],!0,(s,S)=>s.id===S.id),this.name="",this.description="",this.asSubgroup=!1,this.parentGroup=null,this.filterValue="",this.groupToCreate={id:0,beanName:"Group"},this.groupIds=[],this.groupAttrNames=[k.GROUP_SYNC_ENABLED,k.GROUP_BLOCK_MANUAL_MEMBER_ADDING]}ngOnInit(){this.onSubmit=this.submit.subscribe(()=>this.handleGroups()),this.selection.changed.subscribe(()=>this.isSubmitAllowed()),this.createGroupAuth=this.guiAuthResolver.isAuthorized("createGroup_Vo_Group_policy",[{id:this.voId,beanName:"Vo"}]),this.attributesService.getVoAttributes(this.voId).subscribe(e=>{this.manualMemberAddingBlocked=ln(e,k.VO_BLOCK_MANUAL_MEMBER_ADDING),this.groupsService.getAllRichGroupsWithAttributesByNames(this.voId,this.groupAttrNames).subscribe(n=>{this.allVoGroups=n.filter(i=>i.name!=="members"),this.assignableGroups=this.filterAssignableGroups(n),this.isSubmitAllowed()})})}ngOnDestroy(){this.onSubmit!==void 0&&this.onSubmit.unsubscribe()}groupAssigmentChanged(){this.selection.clear(),this.groupToCreate.name="",this.groupToCreate.description="",this.asSubgroup=!1,this.groupToCreate.parentGroupId=null,this.isSubmitAllowed()}applyFilter(e){this.filterValue=e}onNameChange(e){this.groupToCreate.name=e,this.isSubmitAllowed()}onParentChange(e){e===null?this.groupToCreate.parentGroupId=null:this.groupToCreate.parentGroupId=e.id,this.isSubmitAllowed()}onAsSubgroupChange(e){this.asSubgroup=e,this.isSubmitAllowed()}onDescriptionChange(e){this.groupToCreate.description=e,this.isSubmitAllowed()}isSubmitAllowed(){this.submitAllowed.emit(!(this.groupAssignment===null||this.groupAssignment==="existing"&&this.selection.selected.length===0||this.groupAssignment==="new"&&(this.groupToCreate.name.length===0||this.groupToCreate.description.length===0)||this.asSubgroup&&this.groupToCreate.parentGroupId===null))}handleGroups(){this.loading=!0,this.groupAssignment==="new"?this.asSubgroup?this.groupsService.createGroupWithParentGroupNameDescription(this.groupToCreate.parentGroupId,this.groupToCreate.name,this.groupToCreate.description).subscribe({next:e=>{this.groupIds.push(e.id),this.groupsToAdd.emit(this.groupIds)},error:()=>this.loading=!1}):this.groupsService.createGroupWithVoNameDescription(this.voId,this.groupToCreate.name,this.groupToCreate.description).subscribe({next:e=>{this.groupIds.push(e.id),this.groupsToAdd.emit(this.groupIds)},error:()=>this.loading=!1}):(this.groupAssignment==="existing"&&(this.groupIds=this.selection.selected.map(e=>e.id)),this.groupsToAdd.emit(this.groupIds))}filterAssignableGroups(e){let n=[];for(let i of e)!(Ui(i)||ln(i.attributes,k.GROUP_BLOCK_MANUAL_MEMBER_ADDING))&&this.guiAuthResolver.isAuthorized("addMembers_Group_List<Member>_policy",[i])&&n.push(i);return n}static{this.\u0275fac=function(n){return new(n||t)(_(De),_(pe),_(Tt))}}static{this.\u0275cmp=x({type:t,selectors:[["app-assign-groups-sponsored-members-component"]],inputs:{submit:"submit",voId:"voId"},outputs:{groupsToAdd:"groupsToAdd",submitAllowed:"submitAllowed"},decls:21,vars:28,consts:[[1,"mt-2"],[1,"mb-4"],[1,"flex-container",3,"change","ngModelChange","ngModel"],["value","none","data-cy","no-assign-button"],["matTooltipPosition","above",3,"matTooltip","matTooltipDisabled"],["value","new",3,"disabled"],["value","existing",3,"disabled"],["alert_type","info",1,"mt-4"],[1,"mt-4"],[3,"asSubgroupChanged","nameChanged","descriptionChanged","parentGroupChanged","voGroups"],[3,"filter","placeholder"],[3,"loading","groups","selection","disableRouting","displayColumns","filter"]],template:function(n,i){n&1&&(a(0,"div",0)(1,"h5",1),m(2),l(3,"translate"),r(),a(4,"mat-radio-group",2),C("change",function(){return i.groupAssigmentChanged()}),te("ngModelChange",function(S){return ee(i.groupAssignment,S)||(i.groupAssignment=S),S}),a(5,"mat-radio-button",3),m(6),l(7,"translate"),r(),a(8,"span",4),l(9,"translate"),a(10,"mat-radio-button",5),m(11),l(12,"translate"),r()(),a(13,"span",4),l(14,"translate"),a(15,"mat-radio-button",6),m(16),l(17,"translate"),r()()()(),v(18,Qu,4,3,"div"),v(19,Zu,5,4,"div"),v(20,Ju,6,11,"div")),n&2&&(o(2),E(p(3,16,"DIALOGS.GENERATE_SPONSORED_MEMBERS.GROUP_ASSIGMENT")),o(2),J("ngModel",i.groupAssignment),o(2),h(" ",p(7,18,"DIALOGS.GENERATE_SPONSORED_MEMBERS.NO_ASSIGN")," "),o(2),u("matTooltip",w(p(9,20,"DIALOGS.GENERATE_SPONSORED_MEMBERS.DISABLED_ASSIGN_NEW")))("matTooltipDisabled",!i.manualMemberAddingBlocked&&i.createGroupAuth),o(2),u("disabled",i.manualMemberAddingBlocked||!i.createGroupAuth),o(),h(" ",p(12,22,"DIALOGS.GENERATE_SPONSORED_MEMBERS.ASSIGN_TO_NEW")," "),o(2),u("matTooltip",w(p(14,24,"DIALOGS.GENERATE_SPONSORED_MEMBERS.DISABLED_ASSIGN_EXISTING")))("matTooltipDisabled",!i.manualMemberAddingBlocked&&i.assignableGroups.length!==0),o(2),u("disabled",i.manualMemberAddingBlocked||i.assignableGroups.length===0),o(),h(" ",p(17,26,"DIALOGS.GENERATE_SPONSORED_MEMBERS.ASSIGN_EXISTING")," "),o(2),b(i.groupAssignment==="none"?18:-1),o(),b(i.groupAssignment==="new"?19:-1),o(),b(i.groupAssignment==="existing"?20:-1))},dependencies:[D,ri,oi,ai,je,se,Ue,le,be,ve,ye,L,ne,Gt,Ua,O],styles:[".flex-container[_ngcontent-%COMP%]{display:flex;flex-direction:column}"]})}}return t})();var e_=["stepper"];function t_(t,d){t&1&&A(0,"perun-web-apps-loading-dialog")}function i_(t,d){t&1&&(a(0,"h1",3),m(1),l(2,"translate"),r()),t&2&&(o(),h(" ",p(2,1,"DIALOGS.CREATE_SPONSORED_MEMBER.TITLE")," "))}function n_(t,d){t&1&&(a(0,"perun-web-apps-alert",6),m(1),l(2,"translate"),r()),t&2&&(o(),h(" ",p(2,1,"DIALOGS.CREATE_SPONSORED_MEMBER.FUNCTIONALITY_NOT_SUPPORTED")," "))}function o_(t,d){t&1&&(m(0),l(1,"translate")),t&2&&E(p(1,1,"DIALOGS.CREATE_SPONSORED_MEMBER.USER_LABEL"))}function a_(t,d){t&1&&(a(0,"mat-error"),m(1),l(2,"translate"),r()),t&2&&(o(),h(" ",p(2,1,"DIALOGS.CREATE_SPONSORED_MEMBER.LENGTH_ERROR")," "))}function r_(t,d){t&1&&(a(0,"mat-error"),m(1),l(2,"translate"),r()),t&2&&(o(),h(" ",p(2,1,"DIALOGS.CREATE_SPONSORED_MEMBER.LENGTH_ERROR")," "))}function s_(t,d){t&1&&(m(0),l(1,"translate")),t&2&&E(p(1,1,"DIALOGS.CREATE_SPONSORED_MEMBER.NAMESPACE_LABEL"))}function l_(t,d){if(t&1&&(a(0,"mat-option",20),m(1),r()),t&2){let e=d.$implicit;u("value",e),Rt("data-cy",e),o(),h(" ",e," ")}}function p_(t,d){t&1&&(a(0,"mat-error"),m(1),l(2,"translate"),r()),t&2&&(o(),h(" ",p(2,1,"DIALOGS.CREATE_SPONSORED_MEMBER.NAMESPACE_ERROR")," "))}function m_(t,d){t&1&&(a(0,"mat-error"),m(1),l(2,"translate"),r()),t&2&&(o(),h(" ",p(2,1,"DIALOGS.CREATE_SPONSORED_MEMBER.LENGTH_ERROR")," "))}function d_(t,d){t&1&&(a(0,"mat-error"),m(1),l(2,"translate"),r()),t&2&&(o(),h(" ",p(2,1,"DIALOGS.CREATE_SPONSORED_MEMBER.EMAIL_ERROR")," "))}function c_(t,d){if(t&1&&(a(0,"mat-option",20),m(1),l(2,"uppercase"),l(3,"translate"),r()),t&2){let e=d.$implicit;u("value",w(e)),o(),h(" ",p(3,5,p(2,3,"SHARED_LIB.LANGUAGES."+e))," ")}}function u_(t,d){if(t&1){let e=I();a(0,"mat-form-field")(1,"mat-label"),m(2),l(3,"translate"),r(),a(4,"mat-select",30),te("valueChange",function(i){f(e);let s=c(4);return ee(s.currentLanguage,i)||(s.currentLanguage=i),g(i)}),de(5,c_,4,7,"mat-option",20,Ce),r()()}if(t&2){let e=c(4);o(2),E(p(3,2,"DIALOGS.INVITE_MEMBER.LANGUAGE")),o(2),J("value",e.currentLanguage),o(),ce(e.languages)}}function __(t,d){t&1&&(m(0),l(1,"translate")),t&2&&E(p(1,1,"DIALOGS.CREATE_SPONSORED_MEMBER.SPONSORSHIP_LABEL"))}function h_(t,d){t&1&&(m(0),l(1,"translate")),t&2&&E(p(1,1,"DIALOGS.GENERATE_SPONSORED_MEMBERS.GROUPS_LABEL"))}function f_(t,d){if(t&1){let e=I();a(0,"mat-stepper",7,1)(2,"mat-step",8),T(3,o_,2,3,"ng-template",9),a(4,"form",10)(5,"h5",11),m(6),l(7,"translate"),r(),a(8,"mat-form-field",12)(9,"mat-label"),m(10),l(11,"translate"),r(),A(12,"input",13),v(13,a_,3,3,"mat-error"),r(),a(14,"mat-form-field")(15,"mat-label"),m(16),l(17,"translate"),r(),A(18,"input",14),v(19,r_,3,3,"mat-error"),r(),a(20,"mat-form-field")(21,"mat-label"),m(22),l(23,"translate"),r(),A(24,"input",15),r(),a(25,"mat-form-field")(26,"mat-label"),m(27),l(28,"translate"),r(),A(29,"input",16),r()()(),a(30,"mat-step",8),T(31,s_,2,3,"ng-template",9),a(32,"h5",11),m(33),l(34,"translate"),r(),a(35,"form",17)(36,"mat-form-field",18)(37,"mat-label"),m(38),l(39,"translate"),r(),a(40,"mat-select",19),C("valueChange",function(i){f(e);let s=c(3);return g(s.onNamespaceChanged(i))}),de(41,l_,2,3,"mat-option",20,Ce),r(),v(43,p_,3,3,"mat-error"),r(),a(44,"mat-form-field",21),l(45,"translate"),a(46,"mat-label"),m(47),l(48,"translate"),r(),A(49,"input",22),v(50,m_,3,3,"mat-error"),r(),a(51,"mat-form-field")(52,"mat-label"),m(53),l(54,"translate"),r(),A(55,"input",23),v(56,d_,3,3,"mat-error"),r(),a(57,"span",21),l(58,"translate"),a(59,"mat-checkbox",24),C("change",function(){f(e);let i=c(3);return g(i.passwordResetChange())}),m(60),l(61,"translate"),r()(),v(62,u_,7,4,"mat-form-field"),A(63,"perun-web-apps-password-form",25),r()(),a(64,"mat-step"),T(65,__,2,3,"ng-template",9),a(66,"div",26)(67,"h5",11),m(68),l(69,"translate"),r(),a(70,"app-choose-sponsor",27),C("sponsorTypeSelected",function(i){f(e);let s=c(3);return g(s.sponsorType=i)})("sponsorSelected",function(i){f(e);let s=c(3);return g(s.selectedSponsor=i)}),r(),a(71,"h6",12),m(72),l(73,"translate"),r(),a(74,"perun-web-apps-expiration-select",28),C("expirationSelected",function(i){f(e);let s=c(3);return g(s.setExpiration(i))}),r()()(),a(75,"mat-step"),T(76,h_,2,3,"ng-template",9),a(77,"app-assign-groups-sponsored-members-component",29),C("groupsToAdd",function(i){f(e);let s=c(3);return g(s.createMember(i))})("submitAllowed",function(i){f(e);let s=c(3);return g(s.submitAllowed=i)}),r()()()}if(t&2){let e=c(3);u("linear",!0),o(2),u("stepControl",e.userControl),o(2),u("formGroup",e.userControl),o(2),h(" ",p(7,38,"DIALOGS.CREATE_SPONSORED_MEMBER.USER_TITLE")," "),o(4),E(p(11,40,"DIALOGS.CREATE_SPONSORED_MEMBER.FIRST_NAME")),o(3),b(e.userControl.hasError("required","firstName")?13:-1),o(3),E(p(17,42,"DIALOGS.CREATE_SPONSORED_MEMBER.LAST_NAME")),o(3),b(e.userControl.hasError("required","lastName")?19:-1),o(3),E(p(23,44,"DIALOGS.CREATE_SPONSORED_MEMBER.TITLE_BEFORE")),o(5),E(p(28,46,"DIALOGS.CREATE_SPONSORED_MEMBER.TITLE_AFTER")),o(3),u("stepControl",e.namespaceControl),o(3),h(" ",p(34,48,"DIALOGS.CREATE_SPONSORED_MEMBER.NAMESPACE_TITLE")," "),o(2),u("formGroup",e.namespaceControl),o(3),E(p(39,50,"DIALOGS.CREATE_SPONSORED_MEMBER.NAMESPACE")),o(3),ce(e.namespaceOptions),o(2),b(e.namespaceControl.hasError("required","namespace")?43:-1),o(),u("matTooltip",w(p(45,52,e.selectedNamespace===null?"DIALOGS.CREATE_SPONSORED_MEMBER.NO_NAMESPACE_SELECTED":"DIALOGS.CREATE_SPONSORED_MEMBER.LOGIN_DISABLED")))("matTooltipDisabled",e.namespaceControl.get("loginCtrl").enabled),o(3),E(p(48,54,"DIALOGS.CREATE_SPONSORED_MEMBER.LOGIN")),o(3),b(e.namespaceControl.hasError("required","loginCtrl")?50:-1),o(3),E(p(54,56,"DIALOGS.CREATE_SPONSORED_MEMBER.EMAIL")),o(3),b(e.namespaceControl.hasError("required","email")||e.namespaceControl.hasError("pattern","email")?56:-1),o(),u("matTooltip",w(p(58,58,e.selectedNamespace===null?"DIALOGS.CREATE_SPONSORED_MEMBER.NO_NAMESPACE_SELECTED":"DIALOGS.CREATE_SPONSORED_MEMBER.PASSWORD_RESET_DISABLED")))("matTooltipDisabled",e.namespaceControl.get("passwordReset").enabled),o(3),h("",p(61,60,"DIALOGS.CREATE_SPONSORED_MEMBER.PASSWORD_RESET")," "),o(2),b(e.namespaceControl.get("passwordReset").value?62:-1),o(),u("formGroup",e.namespaceControl)("namespace",e.selectedNamespace)("tooltipPwdViaEmail",e.namespaceControl.get("passwordReset").value),o(5),h(" ",p(69,62,"DIALOGS.CREATE_SPONSORED_MEMBER.SPONSORSHIP_TITLE")," "),o(2),u("voId",e.data.voId)("voSponsors",e.voSponsors)("customTitle","DIALOGS.CREATE_SPONSORED_MEMBER.SELECT_SPONSOR"),o(2),E(p(73,64,"DIALOGS.CREATE_SPONSORED_MEMBER.EXPIRATION")),o(2),u("minDate",e.minDate),o(3),u("voId",e.data.voId)("submit",e.groupsToAssign.asObservable())}}function g_(t,d){if(t&1&&(a(0,"div",4),v(1,n_,3,3,"perun-web-apps-alert",6),v(2,f_,78,66,"mat-stepper",7),r()),t&2){let e=c(2);o(),b(e.functionalityNotSupported?1:-1),o(),b(e.namespaceRules.length!==0?2:-1)}}function C_(t,d){t&1&&(a(0,"perun-web-apps-alert",6),m(1),l(2,"translate"),r()),t&2&&(o(),E(p(2,1,"DIALOGS.CREATE_SPONSORED_MEMBER.WITH_ERRORS")))}function S_(t,d){if(t&1&&(a(0,"div",4)(1,"div",31)(2,"mat-icon",32),m(3,"done"),r(),m(4),l(5,"translate"),a(6,"i"),m(7),l(8,"userFullName"),r(),m(9),l(10,"translate"),r(),a(11,"div"),m(12),l(13,"translate"),r(),a(14,"div"),m(15),l(16,"translate"),r(),a(17,"perun-web-apps-alert",33),m(18),l(19,"translate"),r(),v(20,C_,3,3,"perun-web-apps-alert",6),r()),t&2){let e=c(2);o(4),h(" ",p(5,9,"DIALOGS.CREATE_SPONSORED_MEMBER.USER")," "),o(3),E(p(8,11,e.createdMember.user)),o(2),h(" ",p(10,13,"DIALOGS.CREATE_SPONSORED_MEMBER.WAS_CREATED")," "),o(3),ot("",p(13,15,"DIALOGS.CREATE_SPONSORED_MEMBER.LOGIN"),": ",e.loginThatWasSet),o(3),ot(" ",p(16,17,"DIALOGS.CREATE_SPONSORED_MEMBER.PASSWORD")," : ",e.namespaceControl.get("passwordCtrl").value," "),o(3),E(p(19,19,"DIALOGS.CREATE_SPONSORED_MEMBER.COPY_INFORMATION")),o(2),b(e.finishedWithErrors?20:-1)}}function v_(t,d){if(t&1){let e=I();a(0,"div",5)(1,"button",34),C("click",function(){f(e);let i=c(2);return g(i.onCancel())}),m(2),l(3,"translate"),r()()}t&2&&(o(2),h(" ",p(3,1,"DIALOGS.CREATE_SPONSORED_MEMBER.OK")," "))}function b_(t,d){if(t&1){let e=I();a(0,"button",39),C("click",function(){f(e);let i=c(3);return g(i.stepperPrevious())}),m(1),l(2,"translate"),r()}t&2&&(o(),h(" ",p(2,1,"DIALOGS.CREATE_SPONSORED_MEMBER.BACK")," "))}function E_(t,d){if(t&1){let e=I();a(0,"button",40),C("click",function(){f(e);let i=c(3);return g(i.stepperNext())}),m(1),l(2,"translate"),r()}if(t&2){let e=c(3);Ee("ms-2",e.stepper!==void 0&&e.stepper.selectedIndex!==0)("ms-auto",!(e.stepper!==void 0&&e.stepper.selectedIndex!==0)),u("disabled",e.getStepperNextConditions()),o(),h(" ",p(2,6,"DIALOGS.CREATE_SPONSORED_MEMBER.NEXT")," ")}}function I_(t,d){if(t&1){let e=I();a(0,"button",41),C("click",function(){f(e);let i=c(3);return g(i.onConfirm())}),m(1),l(2,"translate"),r()}if(t&2){let e=c(3);u("disabled",!e.submitAllowed),o(),h(" ",p(2,2,"DIALOGS.CREATE_SPONSORED_MEMBER.SUBMIT")," ")}}function T_(t,d){if(t&1){let e=I();a(0,"div",5)(1,"div")(2,"button",35),C("click",function(){f(e);let i=c(2);return g(i.onCancel())}),m(3),l(4,"translate"),r(),v(5,b_,3,3,"button",36),v(6,E_,3,8,"button",37),v(7,I_,3,4,"button",38),r()()}if(t&2){let e=c(2);o(3),h(" ",p(4,4,"DIALOGS.CREATE_SPONSORED_MEMBER.CANCEL")," "),o(2),b(e.stepper!==void 0&&e.stepper.selectedIndex!==0?5:-1),o(),b(e.stepper!==void 0&&e.stepper.selectedIndex!==e.stepper._steps.length-1?6:-1),o(),b(e.stepper!==void 0&&e.stepper.selectedIndex===e.stepper._steps.length-1?7:-1)}}function A_(t,d){if(t&1&&(a(0,"div"),v(1,i_,3,3,"h1",3),v(2,g_,3,2,"div",4),v(3,S_,21,21,"div",4),v(4,v_,4,3,"div",5),v(5,T_,8,6,"div",5),r()),t&2){let e=c();o(),b(e.successfullyCreated?-1:1),o(),b(e.successfullyCreated?-1:2),o(),b(e.successfullyCreated?3:-1),o(),b(e.successfullyCreated?4:-1),o(),b(e.functionalityNotSupported||!e.successfullyCreated&&e.stepper!==void 0?5:-1)}}var xr=(()=>{class t{constructor(e,n,i,s,S,M,R,N,re,xe){this.dialogRef=e,this.data=n,this.membersService=i,this.apiRequestConfiguration=s,this.usersService=S,this.store=M,this.formBuilder=R,this.cd=N,this.groupsService=re,this.findSponsors=xe,this.loading=!1,this.functionalityNotSupported=!1,this.loginThatWasSet="",this.successfullyCreated=!1,this.namespaceOptions=[],this.selectedNamespace=null,this.userControl=this.formBuilder.group({firstName:["",he.required],lastName:["",he.required],titleBefore:[""],titleAfter:[""]}),this.namespaceControl=this.formBuilder.group({namespace:["",he.required],loginCtrl:["",[he.required]],passwordCtrl:["",he.required,[vo(null,this.usersService,this.apiRequestConfiguration)]],passwordAgainCtrl:[""],passwordReset:[!1,[]],email:["",[he.required,he.pattern(Kt)]]},{validators:ra.passwordMatchValidator}),this.voSponsors=[],this.selectedSponsor=null,this.sponsorType="self",this.languages=["en"],this.currentLanguage="en",this.finishedWithErrors=!1,this.submitAllowed=!1,this.groupsToAssign=new ci,this.minDate=new Date,this.namespaceRules=[],this.parsedRules=new Map,this.expiration="never"}static parseAttributes(e,n,i){for(let s of n)switch(s){case"login":{e.login=i;break}case"password":{e.password=i;break}default:break}}onConfirm(){this.loading=!0,this.groupsToAssign.next()}createMember(e){this.loading=!0;let n={vo:this.data.voId,userData:{firstName:this.userControl.value.firstName,lastName:this.userControl.value.lastName,titleAfter:this.userControl.value.titleAfter,titleBefore:this.userControl.value.titleBefore,email:this.namespaceControl.value.email},sponsor:this.sponsorType==="other"?this.selectedSponsor.id:this.store.getPerunPrincipal().userId},i=this.namespaceControl.value.namespace,s=this.parsedRules.get(i);i!=="No namespace"&&(n.userData.namespace=i),s.login!=="disabled"&&(n.userData.login=this.namespaceControl.value.loginCtrl),s.password!=="disabled"&&(n.sendActivationLink=this.namespaceControl.value.passwordReset,n.language=this.currentLanguage,n.userData.password=this.namespaceControl.value.passwordCtrl,n.baseUrl=ji()),this.expiration!=="never"&&(n.validityTo=this.expiration),this.membersService.createSponsoredMember(n).subscribe({next:S=>{this.successfullyCreated=!0,this.dialogRef.updateSize("600px"),this.createdMember=S,S&&S.userAttributes&&S.userAttributes.filter(M=>M.baseFriendlyName==="login-namespace").filter(M=>M.friendlyNameParameter===i).filter(M=>M.value!==null).forEach(M=>{this.loginThatWasSet=M.value}),e.length>0&&this.groupsService.addMember(e,S.id).subscribe({next:()=>this.loading=!1,error:()=>{this.finishedWithErrors=!0,this.loading=!1}}),this.loading=!1},error:()=>{this.loading=!1}})}onCancel(){this.successfullyCreated?this.dialogRef.close(!0):this.dialogRef.close()}onNamespaceChanged(e){this.selectedNamespace=e;let n=this.selectedNamespace===null?{login:"disabled",password:"disabled"}:this.parsedRules.get(e),i=this.namespaceControl.get("loginCtrl"),s=this.namespaceControl.get("passwordCtrl"),S=this.namespaceControl.get("passwordAgainCtrl"),M=this.namespaceControl.get("passwordReset");if(n.login!=="disabled"){let R=n.login==="optional"?[]:[he.required];sn(i,R)}else i.disable(),i.setValue("");if(n.password!=="disabled"){let R=n.password==="optional"?[]:[he.required];sn(s,R,[vo(e,this.usersService,this.apiRequestConfiguration)]),sn(S,[]),sn(M,[]),this.namespaceControl.get("passwordReset").setValue(!1)}else s.disable(),s.setValue(""),S.disable(),S.setValue(""),M.disable(),M.setValue(!1)}passwordResetChange(){let e=this.namespaceControl.get("passwordCtrl"),n=this.namespaceControl.get("passwordAgainCtrl");this.namespaceControl.value.passwordReset?(e.disable(),e.setValue(""),n.disable(),n.setValue("")):(e.enable(),n.enable())}setExpiration(e){this.expiration=e}getStepperNextConditions(){if(this.functionalityNotSupported)return!0;switch(this.stepper.selectedIndex){case 0:return this.userControl.invalid;case 1:return this.namespaceControl.invalid||this.namespaceControl.get("passwordCtrl").pending;case 2:return this.sponsorType===null||this.sponsorType==="other"&&this.selectedSponsor===null;default:return!1}}stepperPrevious(){this.stepper.previous()}stepperNext(){this.stepper.next()}ngOnInit(){this.loading=!0,this.theme=this.data.theme,this.languages=this.store.getProperty("supported_languages"),this.membersService.getAllNamespacesRules().subscribe(e=>{this.store.getProperty("allow_empty_sponsor_namespace")&&this.namespaceRules.push({namespaceName:"No namespace",requiredAttributes:[],optionalAttributes:[]}),this.namespaceRules=this.namespaceRules.concat(e),this.parseNamespaceRules(),this.namespaceOptions.length===0&&(this.functionalityNotSupported=!0),this.onNamespaceChanged(this.selectedNamespace),this.findSponsors.getSponsors(this.data.voId).subscribe(n=>{this.voSponsors=n,this.loading=!1}),this.cd.detectChanges()}),this.namespaceControl.get("loginCtrl")?.valueChanges.subscribe(()=>{this.namespaceControl.get("passwordCtrl")?.updateValueAndValidity({onlySelf:!0})})}ngAfterViewInit(){this.cd.detectChanges()}parseNamespaceRules(){for(let e of this.namespaceRules){this.namespaceOptions.push(e.namespaceName);let n={login:"disabled",password:"disabled"};t.parseAttributes(n,e.requiredAttributes,"required"),t.parseAttributes(n,e.optionalAttributes,"optional"),this.parsedRules.set(e.namespaceName,n)}this.namespaceOptions.length===1&&(this.selectedNamespace=this.namespaceOptions[0])}static{this.\u0275fac=function(n){return new(n||t)(_(U),_(j),_(Qe),_(xt),_(In),_(Le),_(Sn),_(yt),_(De),_(si))}}static{this.\u0275cmp=x({type:t,selectors:[["app-create-sponsored-member-dialog"]],viewQuery:function(n,i){if(n&1&&Be(e_,5),n&2){let s;Ve(s=Fe())&&(i.stepper=s.first)}},decls:4,vars:5,consts:[["spinner",""],["stepper",""],[4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],["mat-dialog-title",""],["mat-dialog-content","",1,"dialog-container"],["mat-dialog-actions","",1,"justify-content-end"],["alert_type","error"],[3,"linear"],[3,"stepControl"],["matStepLabel",""],[1,"dialog-container",3,"formGroup"],[1,"mt-2"],[1,"mt-4"],["data-cy","first-name-input","matInput","","formControlName","firstName","required",""],["data-cy","last-name-input","matInput","","formControlName","lastName","required",""],["matInput","","formControlName","titleBefore"],["matInput","","formControlName","titleAfter"],[1,"dialog-container","mt-4",3,"formGroup"],["data-cy","namespace-filter"],["formControlName","namespace","required","",3,"valueChange"],[3,"value"],["matTooltipPosition","left",3,"matTooltip","matTooltipDisabled"],["data-cy","login-input","matInput","","formControlName","loginCtrl","required",""],["data-cy","email-input","matInput","","formControlName","email","required",""],["labelPosition","before","formControlName","passwordReset",3,"change"],[3,"formGroup","namespace","tooltipPwdViaEmail"],[1,"dialog-container"],[3,"sponsorTypeSelected","sponsorSelected","voId","voSponsors","customTitle"],[1,"mt-2",3,"expirationSelected","minDate"],[3,"groupsToAdd","submitAllowed","voId","submit"],[3,"valueChange","value"],[1,"bigger-font","mb-2"],[1,"me-2","mb-2"],["alert_type","warn"],["mat-flat-button","","data-cy","ok-button",1,"ms-auto",3,"click"],["mat-stroked-button","",1,"me-2",3,"click"],["mat-stroked-button","",1,"ms-auto"],["data-cy","next-button","color","accent","mat-flat-button","","type","button",3,"ms-2","ms-auto","disabled"],["data-cy","confirm-button","color","accent","mat-flat-button","","type","button",1,"ms-2",3,"disabled"],["mat-stroked-button","",1,"ms-auto",3,"click"],["data-cy","next-button","color","accent","mat-flat-button","","type","button",3,"click","disabled"],["data-cy","confirm-button","color","accent","mat-flat-button","","type","button",1,"ms-2",3,"click","disabled"]],template:function(n,i){if(n&1&&(T(0,t_,1,0,"ng-template",null,0,B),a(2,"div"),T(3,A_,6,5,"div",2),r()),n&2){let s=y(1);o(2),H(W("",i.theme," position-relative")),o(),u("perunWebAppsLoader",i.loading)("perunWebAppsLoaderIndicator",s)}},dependencies:[D,P,G,lt,st,Oe,Re,Pe,rt,Ke,Xe,Ye,$e,We,Pt,wt,le,Di,ze,se,_i,It,Ri,Oi,K,$,X,Y,be,ve,oe,bi,L,ne,Ni,Ei,Bi,wa,Vi,so,V,At,O,Xt],styles:[".bigger-font[_ngcontent-%COMP%]{font-size:1.5rem}.input-spinner[_ngcontent-%COMP%]{float:right;margin-left:8px}mat-icon[_ngcontent-%COMP%]{color:#28a745;font-size:36px;vertical-align:bottom}"]})}}return t})();var M_=["stepper"];function x_(t,d){t&1&&A(0,"perun-web-apps-loading-dialog")}function D_(t,d){t&1&&(a(0,"perun-web-apps-alert",6),m(1),l(2,"translate"),r()),t&2&&(o(),h(" ",p(2,1,"DIALOGS.CREATE_SPONSORED_MEMBER.FUNCTIONALITY_NOT_SUPPORTED")," "))}function R_(t,d){t&1&&(m(0),l(1,"translate")),t&2&&E(p(1,1,"DIALOGS.GENERATE_SPONSORED_MEMBERS.USERS_LABEL"))}function O_(t,d){if(t&1&&(a(0,"mat-option",14),m(1),r()),t&2){let e=d.$implicit;u("value",e),Rt("data-cy",e),o(),h(" ",e," ")}}function L_(t,d){t&1&&(a(0,"mat-error"),m(1),l(2,"translate"),r()),t&2&&(o(),h(" ",p(2,1,"DIALOGS.GENERATE_SPONSORED_MEMBERS.NAMESPACE_ERROR")," "))}function y_(t,d){t&1&&(a(0,"mat-error"),m(1),l(2,"translate"),r()),t&2&&(o(),h(" ",p(2,1,"DIALOGS.GENERATE_SPONSORED_MEMBERS.NAMES_ERROR")," "))}function w_(t,d){if(t&1&&(a(0,"mat-error"),m(1),l(2,"translate"),r()),t&2){let e=c(3);o(),ot(" ",p(2,2,"DIALOGS.GENERATE_SPONSORED_MEMBERS.ERROR_FORMAT"),": ",e.usersInfoFormGroup.get("sponsoredMembers").getError("invalidFormat").value," ")}}function P_(t,d){if(t&1&&(a(0,"mat-error"),m(1),l(2,"translate"),r()),t&2){let e=c(3);o(),ot(" ",p(2,2,"DIALOGS.GENERATE_SPONSORED_MEMBERS.ERROR_EMAIL"),": ",e.usersInfoFormGroup.get("sponsoredMembers").getError("invalidEmail").value," ")}}function G_(t,d){if(t&1&&(a(0,"mat-error"),m(1),l(2,"translate"),r()),t&2){let e=c(3);o(),ot(" ",p(2,2,"DIALOGS.GENERATE_SPONSORED_MEMBERS.ERROR_LOGIN"),": ",e.usersInfoFormGroup.get("sponsoredMembers").getError("invalidLogin").value," ")}}function N_(t,d){t&1&&(m(0),l(1,"translate")),t&2&&E(p(1,1,"DIALOGS.GENERATE_SPONSORED_MEMBERS.PASSWORD_LABEL"))}function B_(t,d){t&1&&(a(0,"perun-web-apps-alert",19),m(1),l(2,"translate"),r()),t&2&&(o(),h(" ",p(2,1,"DIALOGS.GENERATE_SPONSORED_MEMBERS.NO_NAMESPACE_PASSWORD_INFO")," "))}function V_(t,d){if(t&1){let e=I();a(0,"mat-radio-group",27),te("ngModelChange",function(i){f(e);let s=c(3);return ee(s.passwordReset,i)||(s.passwordReset=i),g(i)}),a(1,"mat-radio-button",28),m(2),l(3,"translate"),r(),a(4,"mat-radio-button",29),m(5),l(6,"translate"),r()()}if(t&2){let e=c(3);J("ngModel",e.passwordReset),o(2),h(" ",p(3,3,"DIALOGS.GENERATE_SPONSORED_MEMBERS.GENERATE_PASSWORD")," "),o(3),h(" ",p(6,5,"DIALOGS.GENERATE_SPONSORED_MEMBERS.PASSWORD_RESET")," ")}}function F_(t,d){if(t&1&&(a(0,"mat-option",14),m(1),l(2,"uppercase"),l(3,"translate"),r()),t&2){let e=d.$implicit;u("value",w(e)),o(),h(" ",p(3,5,p(2,3,"SHARED_LIB.LANGUAGES."+e))," ")}}function k_(t,d){if(t&1){let e=I();a(0,"mat-form-field",21)(1,"mat-label"),m(2),l(3,"translate"),r(),a(4,"mat-select",30),te("valueChange",function(i){f(e);let s=c(3);return ee(s.currentLanguage,i)||(s.currentLanguage=i),g(i)}),de(5,F_,4,7,"mat-option",14,Ce),r()()}if(t&2){let e=c(3);o(2),E(p(3,2,"DIALOGS.INVITE_MEMBER.LANGUAGE")),o(2),J("value",e.currentLanguage),o(),ce(e.languages)}}function U_(t,d){t&1&&(m(0),l(1,"translate")),t&2&&E(p(1,1,"DIALOGS.GENERATE_SPONSORED_MEMBERS.SPONSORSHIP_LABEL"))}function j_(t,d){t&1&&(m(0),l(1,"translate")),t&2&&E(p(1,1,"DIALOGS.GENERATE_SPONSORED_MEMBERS.GROUPS_LABEL"))}function W_(t,d){if(t&1){let e=I();a(0,"mat-stepper",7,1)(2,"mat-step",9),T(3,R_,2,3,"ng-template",10),a(4,"h5",11),m(5),l(6,"translate"),r(),a(7,"form",12)(8,"mat-form-field")(9,"mat-label"),m(10),l(11,"translate"),r(),a(12,"mat-select",13),de(13,O_,2,3,"mat-option",14,Ce),r(),v(15,L_,3,3,"mat-error"),r(),a(16,"div"),m(17),l(18,"translate"),r(),a(19,"div",15),m(20),r(),a(21,"mat-form-field",16)(22,"mat-label"),m(23),l(24,"translate"),r(),a(25,"textarea",17),m(26,"                "),r(),v(27,y_,3,3,"mat-error"),v(28,w_,3,4,"mat-error"),v(29,P_,3,4,"mat-error"),v(30,G_,3,4,"mat-error"),r()()(),a(31,"mat-step"),T(32,N_,2,3,"ng-template",10),a(33,"div",11)(34,"h5",18),m(35),l(36,"translate"),r(),v(37,B_,3,3,"perun-web-apps-alert",19),v(38,V_,7,7,"mat-radio-group",20),v(39,k_,7,4,"mat-form-field",21),r()(),a(40,"mat-step"),T(41,U_,2,3,"ng-template",10),a(42,"div",22)(43,"h5",11),m(44),l(45,"translate"),r(),a(46,"app-choose-sponsor",23),C("sponsorTypeSelected",function(i){f(e);let s=c(2);return g(s.sponsorType=i)})("sponsorSelected",function(i){f(e);let s=c(2);return g(s.selectedSponsor=i)}),r(),a(47,"h6",24),m(48),l(49,"translate"),r(),a(50,"perun-web-apps-expiration-select",25),C("expirationSelected",function(i){f(e);let s=c(2);return g(s.setExpiration(i))}),r()()(),a(51,"mat-step"),T(52,j_,2,3,"ng-template",10),a(53,"app-assign-groups-sponsored-members-component",26),C("groupsToAdd",function(i){f(e);let s=c(2);return g(s.onGenerate(i))})("submitAllowed",function(i){f(e);let s=c(2);return g(s.submitAllowed=i)}),r()()()}if(t&2){let e=c(2);u("linear",!0),o(2),u("stepControl",e.usersInfoFormGroup),o(3),E(p(6,27,"DIALOGS.GENERATE_SPONSORED_MEMBERS.USERS_INFO")),o(2),u("formGroup",e.usersInfoFormGroup),o(3),E(p(11,29,"DIALOGS.GENERATE_SPONSORED_MEMBERS.NAMESPACE")),o(3),ce(e.namespaceOptions),o(2),b(e.usersInfoFormGroup.hasError("required","namespace")?15:-1),o(2),E(p(18,31,"DIALOGS.GENERATE_SPONSORED_MEMBERS.HINT")),o(3),h(" ",e.getSelectedNamespaceRules().csvGenHeaderDescription," "),o(3),E(p(24,33,"DIALOGS.GENERATE_SPONSORED_MEMBERS.INSERT_HERE")),o(2),u("placeholder",w(e.getSelectedNamespaceRules().csvGenPlaceholder)),o(2),b(e.usersInfoFormGroup.hasError("required","sponsoredMembers")?27:-1),o(),b(e.usersInfoFormGroup.hasError("invalidFormat","sponsoredMembers")?28:-1),o(),b(e.usersInfoFormGroup.hasError("invalidEmail","sponsoredMembers")?29:-1),o(),b(e.usersInfoFormGroup.hasError("invalidLogin","sponsoredMembers")?30:-1),o(5),h(" ",p(36,35,"DIALOGS.GENERATE_SPONSORED_MEMBERS.PASSWORD_MANAGEMENT")," "),o(2),b(e.getSelectedNamespaceRules().namespaceName==="No namespace"?37:-1),o(),b(e.getSelectedNamespaceRules().namespaceName!=="No namespace"?38:-1),o(),b(e.passwordReset==="reset"?39:-1),o(5),h(" ",p(45,37,"DIALOGS.GENERATE_SPONSORED_MEMBERS.SPONSORSHIP_TITLE")," "),o(2),u("voId",e.data.voId)("voSponsors",e.voSponsors)("customTitle","DIALOGS.GENERATE_SPONSORED_MEMBERS.SELECT_SPONSOR"),o(2),E(p(49,39,"DIALOGS.GENERATE_SPONSORED_MEMBERS.EXPIRATION")),o(2),u("minDate",e.minDate),o(3),u("voId",e.data.voId)("submit",e.groupsToAssign.asObservable())}}function H_(t,d){t&1&&(a(0,"perun-web-apps-alert",31),m(1),l(2,"translate"),r()),t&2&&(u("alert_type","success"),o(),h(" ",p(2,2,"DIALOGS.GENERATE_SPONSORED_MEMBERS.SUCCESS")," "))}function z_(t,d){t&1&&(a(0,"perun-web-apps-alert",31),m(1),l(2,"translate"),r()),t&2&&(u("alert_type","warn"),o(),h(" ",p(2,2,"DIALOGS.GENERATE_SPONSORED_MEMBERS.FINISHED_WITH_ERRORS")," "))}function q_(t,d){if(t&1&&(a(0,"div"),v(1,H_,3,4,"perun-web-apps-alert",31),v(2,z_,3,4,"perun-web-apps-alert",31),r()),t&2){let e=c(2);o(),b(e.finishedWithErrors===!1?1:-1),o(),b(e.finishedWithErrors?2:-1)}}function $_(t,d){if(t&1){let e=I();a(0,"button",36),C("click",function(){f(e);let i=c(3);return g(i.stepperPrevious())}),m(1),l(2,"translate"),r()}t&2&&(o(),h(" ",p(2,1,"DIALOGS.GENERATE_SPONSORED_MEMBERS.BACK")," "))}function Y_(t,d){if(t&1){let e=I();a(0,"button",37),C("click",function(){f(e);let i=c(3);return g(i.stepperNext())}),m(1),l(2,"translate"),r()}if(t&2){let e=c(3);Ee("ms-2",e.stepper!==void 0&&e.stepper.selectedIndex!==0)("ms-auto",!(e.stepper!==void 0&&e.stepper.selectedIndex!==0)),u("disabled",e.getStepperNextConditions()),o(),h(" ",p(2,6,"DIALOGS.GENERATE_SPONSORED_MEMBERS.NEXT")," ")}}function X_(t,d){if(t&1){let e=I();a(0,"button",38),C("click",function(){f(e);let i=c(3);return g(i.onSubmit())}),m(1),l(2,"translate"),r()}if(t&2){let e=c(3);u("disabled",!e.submitAllowed),o(),h(" ",p(2,2,"DIALOGS.GENERATE_SPONSORED_MEMBERS.SUBMIT")," ")}}function K_(t,d){if(t&1){let e=I();a(0,"div",8)(1,"div")(2,"button",32),C("click",function(){f(e);let i=c(2);return g(i.onCancel())}),m(3),l(4,"translate"),r(),v(5,$_,3,3,"button",33),v(6,Y_,3,8,"button",34),v(7,X_,3,4,"button",35),r()()}if(t&2){let e=c(2);o(3),h(" ",p(4,4,"DIALOGS.GENERATE_SPONSORED_MEMBERS.CANCEL")," "),o(2),b(e.stepper!==void 0&&e.stepper.selectedIndex!==0?5:-1),o(),b(e.stepper!==void 0&&e.stepper.selectedIndex!==e.stepper._steps.length-1?6:-1),o(),b(e.stepper!==void 0&&e.stepper.selectedIndex===e.stepper._steps.length-1?7:-1)}}function Q_(t,d){if(t&1){let e=I();a(0,"div",8)(1,"div")(2,"button",39),C("click",function(){f(e);let i=c(2);return g(i.onClose())}),m(3),l(4,"translate"),r(),a(5,"button",40),m(6),l(7,"translate"),r(),a(8,"mat-menu",null,2)(10,"button",41),C("click",function(){f(e);let i=c(2);return g(i.generatePdf())}),m(11),l(12,"translate"),r(),a(13,"button",41),C("click",function(){f(e);let i=c(2);return g(i.downloadCsv())}),m(14),l(15,"translate"),r()()()()}if(t&2){let e=y(9);o(3),h(" ",p(4,5,"DIALOGS.GENERATE_SPONSORED_MEMBERS.CLOSE")," "),o(2),u("matMenuTriggerFor",e),o(),h(" ",p(7,7,"DIALOGS.GENERATE_SPONSORED_MEMBERS.DOWNLOAD")," "),o(5),h(" ",p(12,9,"DIALOGS.GENERATE_SPONSORED_MEMBERS.DOWNLOAD_PDF")," "),o(3),h(" ",p(15,11,"DIALOGS.GENERATE_SPONSORED_MEMBERS.DOWNLOAD_CSV")," ")}}function Z_(t,d){if(t&1&&(a(0,"div")(1,"h1",4),m(2),l(3,"translate"),r(),a(4,"div",5),v(5,D_,3,3,"perun-web-apps-alert",6),v(6,W_,54,41,"mat-stepper",7),v(7,q_,3,2,"div"),r(),v(8,K_,8,6,"div",8),v(9,Q_,16,13,"div",8),r()),t&2){let e=c();o(2),E(p(3,6,"DIALOGS.GENERATE_SPONSORED_MEMBERS.TITLE")),o(3),b(e.functionalityNotSupported?5:-1),o(),b(e.state==="user-input"&&e.namespaceRules.length!==0?6:-1),o(),b(e.state==="results"?7:-1),o(),b(e.functionalityNotSupported||e.stepper!==void 0&&e.state!=="results"?8:-1),o(),b(e.state==="results"?9:-1)}}var Dr=(()=>{class t{constructor(e,n,i,s,S,M,R,N){this.dialogRef=e,this.data=n,this.store=i,this.membersService=s,this.formBuilder=S,this.sponsoredMembersPDFService=M,this.cd=R,this.findSponsors=N,this.loading=!1,this.functionalityNotSupported=!1,this.namespaceOptions=[],this.usersInfoFormGroup=this.formBuilder.group({namespace:["",he.required],sponsoredMembers:["",[he.required,this.userInputValidator()]]}),this.state="user-input",this.passwordReset="generate",this.expiration="never",this.finishedWithErrors=!1,this.voSponsors=[],this.selectedSponsor=null,this.sponsorType="self",this.submitAllowed=!1,this.groupsToAssign=new ci,this.languages=["en"],this.currentLanguage="en",this.minDate=new Date,this.namespaceRules=[],this.resultData=[]}static didSomeGenerationFailed(e){return e.forEach(n=>{if(n.status!=="OK")return!0}),!1}ngOnInit(){this.loading=!0,this.theme=this.data.theme,this.languages=this.store.getProperty("supported_languages"),this.usersInfoFormGroup.controls.namespace.valueChanges.subscribe({next:()=>{this.usersInfoFormGroup.controls.sponsoredMembers.updateValueAndValidity()}}),this.membersService.getAllNamespacesRules().subscribe(e=>{this.store.getProperty("allow_empty_sponsor_namespace")&&this.namespaceRules.push({namespaceName:"No namespace",csvGenHeader:"firstname;lastname;urn:perun:user:attribute-def:def:preferredMail",csvGenPlaceholder:"John;Doe;john@mail.cz",csvGenHeaderDescription:"First name;Last name;Email"}),this.namespaceRules=this.namespaceRules.concat(e),this.namespaceRules.forEach(n=>this.namespaceOptions.push(n.namespaceName)),this.namespaceOptions.length===0?this.functionalityNotSupported=!0:this.usersInfoFormGroup.setValue({namespace:this.namespaceOptions[0],sponsoredMembers:""}),this.findSponsors.getSponsors(this.data.voId).subscribe(n=>{this.voSponsors=n,this.loading=!1}),this.cd.detectChanges()})}onCancel(){this.dialogRef.close(!1)}onClose(){this.dialogRef.close(!0)}setExpiration(e){this.expiration=e}onSubmit(){this.loading=!0,this.groupsToAssign.next()}getSelectedNamespaceRules(){return this.namespaceRules.find(e=>e.namespaceName===this.usersInfoFormGroup.get("namespace").value)}generatePdf(){if(!this.resultData)throw new Error("Cannot generate pdf because there is no result");this.loading=!0,this.sponsoredMembersPDFService.generate(this.resultData).then(()=>this.loading=!1)}downloadCsv(){if(!this.resultData)throw new Error("Cannot generate pdf because there is no result");Et(this.createOutputObjects(this.resultData),"csv","member-logins")}getStepperNextConditions(){if(this.functionalityNotSupported)return!0;switch(this.stepper.selectedIndex){case 0:return this.usersInfoFormGroup.invalid;case 1:return this.passwordReset===null;case 2:return this.sponsorType===null||this.sponsorType==="other"&&this.selectedSponsor===null;default:return!1}}stepperPrevious(){this.stepper.previous()}stepperNext(){this.stepper.next()}onGenerate(e){this.loading=!0;let n=this.usersInfoFormGroup.value.sponsoredMembers.split(`
`),i=this.getSelectedNamespaceRules().csvGenHeader,s=[];for(let M of n){let R=this.parseMemberLine(M);if(R!=="format"&&R!=="email")R!==""&&s.push(R);else{this.loading=!1;return}}let S={data:s,header:i,namespace:"",sponsor:this.sponsorType==="self"?this.store.getPerunPrincipal().userId:this.selectedSponsor.id,vo:this.data.voId,sendActivationLinks:this.passwordReset==="reset",language:this.currentLanguage,baseUrl:ji()};e.length>0&&(S.groups=e),this.expiration!=="never"&&(S.validityTo=xi(this.expiration,"yyyy-MM-dd","en-GB")),this.usersInfoFormGroup.get("namespace").value!=="No namespace"&&(S.namespace=this.usersInfoFormGroup.value.namespace),this.membersService.createSponsoredMembersFromCSV(S).subscribe({next:M=>{this.state="results",this.finishedWithErrors=t.didSomeGenerationFailed(M),this.loading=!1,this.resultData=M},error:()=>this.loading=!1})}createOutputObjects(e){let n="",i="",s="",S="",M=[];return e.forEach(R=>{n=R.name.replace(";"," ").split(";")[0],i=R.status,s=R.login?R.login:s,S=R.password?R.password:S;let N={name:n,status:i,login:s,password:S};R.note&&(N.note=R.note),M.push(N)}),M}parseMemberLine(e){let n=e.trim();if(n==="")return"";let i=n.split(";"),s=this.getSelectedNamespaceRules().csvGenHeader.split(";");if(i.length!==s.length)return"format";if(s[2].slice(s[2].length-4).toLowerCase()==="mail"&&!i[2].trim().match(Kt))return"email";if(s[3]==="login"&&i[3].trim()==="")return"login";let S="";for(let M of i)S+=M.trim()+";";return S.slice(0,-1)}userInputValidator(){return e=>{let n=e.value.split(`
`);for(let i of n){let s=this.parseMemberLine(i);if(s==="format")return{invalidFormat:{value:i}};if(s==="email")return{invalidEmail:{value:i}};if(s==="login")return{invalidLogin:{value:i}}}return null}}static{this.\u0275fac=function(n){return new(n||t)(_(U),_(j),_(Le),_(Qe),_(Sn),_(sa),_(yt),_(si))}}static{this.\u0275cmp=x({type:t,selectors:[["app-generate-sponsored-members-dialog"]],viewQuery:function(n,i){if(n&1&&Be(M_,5),n&2){let s;Ve(s=Fe())&&(i.stepper=s.first)}},decls:4,vars:5,consts:[["spinner",""],["stepper",""],["menu","matMenu"],[4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],["mat-dialog-title",""],["mat-dialog-content","",1,"dialog-container"],["alert_type","error"],[3,"linear"],["mat-dialog-actions","",1,"justify-content-end"],[3,"stepControl"],["matStepLabel",""],[1,"mt-2"],[1,"flex-container","mt-2",3,"formGroup"],["data-cy","namespace-filter","formControlName","namespace","required",""],[3,"value"],[1,"fw-bold"],[1,"pt-2"],["data-cy","csv-input","cols","50","id","voGenerateSponsoredMembers","name","voGenerateSponsoredMembers","formControlName","sponsoredMembers","matInput","","rows","8",1,"md-textarea","form-control",3,"placeholder"],[1,"mb-4"],["alert_type","info"],[3,"ngModel"],[1,"w-100"],[1,"dialog-container"],[3,"sponsorTypeSelected","sponsorSelected","voId","voSponsors","customTitle"],[1,"mt-4"],[1,"mt-2",3,"expirationSelected","minDate"],[3,"groupsToAdd","submitAllowed","voId","submit"],[3,"ngModelChange","ngModel"],["value","generate"],["value","reset"],[3,"valueChange","value"],[3,"alert_type"],["mat-stroked-button","",1,"me-2",3,"click"],["mat-stroked-button","",1,"ms-auto"],["data-cy","next-button","color","accent","mat-flat-button","",3,"ms-2","ms-auto","disabled"],["data-cy","submit-button","color","accent","mat-flat-button","",3,"disabled"],["mat-stroked-button","",1,"ms-auto",3,"click"],["data-cy","next-button","color","accent","mat-flat-button","",3,"click","disabled"],["data-cy","submit-button","color","accent","mat-flat-button","",3,"click","disabled"],["mat-stroked-button","","data-cy","close-button",1,"me-2",3,"click"],["color","accent","mat-flat-button","",1,"ms-auto","dropdown-toggle",3,"matMenuTriggerFor"],["mat-menu-item","",3,"click"]],template:function(n,i){if(n&1&&(T(0,x_,1,0,"ng-template",null,0,B),a(2,"div"),T(3,Z_,10,8,"div",3),r()),n&2){let s=y(1);o(2),H(W("",i.theme," position-relative")),o(),u("perunWebAppsLoader",i.loading)("perunWebAppsLoaderIndicator",s)}},dependencies:[D,P,G,Oe,Re,Pe,rt,Ke,Xe,Ye,$e,We,ri,oi,ai,le,Di,ze,se,_i,It,Ri,Oi,je,Ue,K,$,X,Y,be,ve,oe,bi,Yt,qt,zt,$t,L,Ni,Ei,Vi,so,Bi,V,At,O],styles:[".flex-container[_ngcontent-%COMP%]{display:flex;flex-direction:column}"]})}}return t})();function J_(t,d){t&1&&A(0,"perun-web-apps-loading-dialog")}function eh(t,d){if(t&1){let e=I();a(0,"mat-form-field",13)(1,"mat-label"),m(2),l(3,"translate"),r(),a(4,"input",14),C("keyup.enter",function(){f(e);let i=c(2);return g(i.onSearchByString())}),r(),a(5,"mat-error"),m(6),l(7,"translate"),r()()}if(t&2){let e=c(2);o(2),E(p(3,3,"DIALOGS.SPONSOR_EXISTING_MEMBER.DESCRIPTION")),o(2),u("formControl",e.searchCtrl),o(2),h(" ",p(7,5,"DIALOGS.SPONSOR_EXISTING_MEMBER.EMPTY_SEARCH_MESSAGE")," ")}}function th(t,d){if(t&1){let e=I();a(0,"button",15),C("click",function(){f(e);let i=c(2);return g(i.onSearchByString())}),m(1),l(2,"translate"),r()}if(t&2){let e=c(2);u("disabled",e.dialogLoading),o(),h(" ",p(2,2,"DIALOGS.SPONSOR_EXISTING_MEMBER.SEARCH")," ")}}function ih(t,d){t&1&&A(0,"perun-web-apps-loading-table")}function nh(t,d){if(t&1&&A(0,"perun-web-apps-members-list",18),t&2){let e=c(3);u("loading",e.tableLoading)("displayedColumns",e.displayedColumns)("disableStatusChange",!0)("disableRouting",!0)("selection",e.selection)("members",e.members)("cacheSubject",e.cacheSubject)}}function oh(t,d){if(t&1&&(a(0,"div",16),T(1,nh,1,7,"perun-web-apps-members-list",17),r()),t&2){c();let e=y(8),n=c();o(),u("perunWebAppsLoader",n.tableLoading)("perunWebAppsLoaderIndicator",e)}}function ah(t,d){t&1&&(a(0,"perun-web-apps-alert",19),m(1),l(2,"translate"),r()),t&2&&(o(),h(" ",p(2,1,"DIALOGS.SPONSOR_EXISTING_MEMBER.BEGIN_SEARCH")," "))}function rh(t,d){if(t&1){let e=I();a(0,"div")(1,"h1",2),m(2),l(3,"translate"),r(),a(4,"div",3),T(5,eh,8,7,"mat-form-field",4)(6,th,3,4,"button",5)(7,ih,1,0,"ng-template",null,0,B)(9,oh,2,2,"div",6)(10,ah,3,3,"perun-web-apps-alert",7),a(11,"app-choose-sponsor",8),C("sponsorTypeSelected",function(i){f(e);let s=c();return g(s.sponsorType=i)})("sponsorSelected",function(i){f(e);let s=c();return g(s.selectedSponsor=i)}),r(),a(12,"div"),A(13,"br"),a(14,"h6"),m(15),l(16,"translate"),r(),a(17,"perun-web-apps-expiration-select",9),C("expirationSelected",function(i){f(e);let s=c();return g(s.setExpiration(i))}),r()()(),a(18,"div",10)(19,"button",11),C("click",function(){f(e);let i=c();return g(i.onCancel())}),m(20),l(21,"translate"),r(),a(22,"button",12),C("click",function(){f(e);let i=c();return g(i.onSubmit())}),m(23),l(24,"translate"),r()()()}if(t&2){let e=c();o(2),E(p(3,13,"DIALOGS.SPONSOR_EXISTING_MEMBER.TITLE")),o(3),u("ngIf",!e.serviceMemberId),o(),u("ngIf",!e.serviceMemberId),o(3),u("ngIf",e.firstSearchDone),o(),u("ngIf",!e.firstSearchDone),o(),u("voId",e.data.voId)("voSponsors",e.voSponsors)("customTitle","DIALOGS.SPONSOR_EXISTING_MEMBER.SELECT_SPONSOR"),o(4),E(p(16,15,"DIALOGS.SPONSOR_EXISTING_MEMBER.EXPIRATION")),o(2),u("minDate",e.minDate),o(3),h(" ",p(21,17,"DIALOGS.SPONSOR_EXISTING_MEMBER.CANCEL")," "),o(2),u("disabled",e.dialogLoading||e.selection.selected.length===0||e.sponsorType==="other"&&!e.selectedSponsor),o(),h(" ",p(24,19,"DIALOGS.SPONSOR_EXISTING_MEMBER.SPONSOR")," ")}}var Rr=(()=>{class t{constructor(e,n,i,s,S,M,R){this.dialogRef=e,this.data=n,this.store=i,this.membersService=s,this.notificator=S,this.translate=M,this.findSponsors=R,this.dialogLoading=!1,this.tableLoading=!1,this.expiration="never",this.searchCtrl=new hi("",[he.required]),this.firstSearchDone=!1,this.members=[],this.selection=new _e(!0,[],!0,(N,re)=>N.id===re.id),this.selectedSponsor=null,this.voSponsors=[],this.sponsorType="self",this.minDate=new Date,this.cacheSubject=new ge(!0)}ngOnInit(){this.dialogLoading=!0,this.theme=this.data.theme,this.serviceMemberId=this.data.serviceMemberId,this.displayedColumns=this.serviceMemberId?["checkbox","id","fullName","sponsored","email"]:["checkbox","id","fullName","status","sponsored","email"],this.findSponsors.getSponsors(this.data.voId).subscribe(e=>{this.voSponsors=e,this.serviceMemberId?(this.searchCtrl.setValue(this.serviceMemberId),this.onSearchByString()):this.dialogLoading=!1})}onCancel(){this.dialogRef.close(!1)}sponsor(e){this.dialogLoading=!0;let n=this.sponsorType==="self"?this.store.getPerunPrincipal().user:this.selectedSponsor,i=e.map(s=>s.id);this.membersService.sponsorMembersBodyParams({members:i,sponsor:n.id,validityTo:this.expiration}).subscribe({next:()=>{this.notificator.showSuccess(this.translate.instant("DIALOGS.SPONSOR_EXISTING_MEMBER.SUCCESS")),this.dialogLoading=!1,this.dialogRef.close(!0)},error:()=>this.dialogLoading=!1})}onSubmit(){this.dialogLoading=!0;let e=Array.from(this.selection.selected);this.expiration=this.expiration==="never"?null:this.expiration,this.sponsor(e)}setExpiration(e){this.expiration=e}onSearchByString(){if(this.searchCtrl.invalid){this.searchCtrl.markAllAsTouched();return}this.firstSearchDone=!0,this.tableLoading=!0,this.cacheSubject.next(!0),this.selection.clear();let e=[k.MEMBER_DEF_EXPIRATION,k.USER_DEF_PREFERRED_MAIL];this.membersService.findCompleteRichMembersForVo(this.data.voId,e,this.searchCtrl.value.trim()).subscribe({next:n=>{this.members=n,this.serviceMemberId&&this.selection.toggle(n[0]),this.tableLoading=!1},error:()=>this.tableLoading=!1})}static{this.\u0275fac=function(n){return new(n||t)(_(U),_(j),_(Le),_(Qe),_(q),_(Mt),_(si))}}static{this.\u0275cmp=x({type:t,selectors:[["app-sponsor-existing-member-dialog"]],decls:4,vars:4,consts:[["spinner",""],[4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],["mat-dialog-title",""],["mat-dialog-content",""],["class","me-2 search-field adjust-width",4,"ngIf"],["data-cy","sponsor-search-button","class","ms-auto","color","accent","mat-flat-button","",3,"disabled","click",4,"ngIf"],["class","position-relative table-min-height",4,"ngIf"],["alert_type","info",4,"ngIf"],[3,"sponsorTypeSelected","sponsorSelected","voId","voSponsors","customTitle"],[3,"expirationSelected","minDate"],["mat-dialog-actions",""],["mat-stroked-button","",1,"ms-auto",3,"click"],["data-cy","sponsor-member-button","color","accent","mat-flat-button","",1,"ms-2",3,"click","disabled"],[1,"me-2","search-field","adjust-width"],["data-cy","sponsor-search-input","autocomplete","false","matInput","",3,"keyup.enter","formControl"],["data-cy","sponsor-search-button","color","accent","mat-flat-button","",1,"ms-auto",3,"click","disabled"],[1,"position-relative","table-min-height"],[3,"loading","displayedColumns","disableStatusChange","disableRouting","selection","members","cacheSubject",4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],[3,"loading","displayedColumns","disableStatusChange","disableRouting","selection","members","cacheSubject"],["alert_type","info"]],template:function(n,i){if(n&1&&(T(0,J_,1,0,"ng-template",null,0,B),a(2,"div"),T(3,rh,25,21,"div",1),r()),n&2){let s=y(1);o(2),H(i.theme),o(),u("perunWebAppsLoader",i.dialogLoading)("perunWebAppsLoaderIndicator",s)}},dependencies:[D,Lo,P,G,Oe,Re,Pe,rt,Ke,Xe,le,ze,se,qe,K,$,X,Y,be,ve,oe,bi,Xi,L,Ei,V,Ge,O],styles:[".adjust-width[_ngcontent-%COMP%]{width:270px}"]})}}return t})();var Or=(t,d)=>[t,d],lo=t=>[t];function sh(t,d){t&1&&A(0,"perun-web-apps-loading-dialog")}function lh(t,d){t&1&&(a(0,"th",17),m(1),l(2,"translate"),r()),t&2&&(o(),h(" ",p(2,1,"DIALOGS.EDIT_MEMBER_SPONSORS.TABLE_ID")," "))}function ph(t,d){if(t&1&&(a(0,"td",18),m(1),r()),t&2){let e=d.$implicit;o(),E(e.user.id)}}function mh(t,d){t&1&&(a(0,"th",17),m(1),l(2,"translate"),r()),t&2&&(o(),h(" ",p(2,1,"DIALOGS.EDIT_MEMBER_SPONSORS.TABLE_NAME")," "))}function dh(t,d){if(t&1&&(a(0,"td",18),m(1),l(2,"userFullName"),r()),t&2){let e=d.$implicit;o(),E(p(2,1,e.user))}}function ch(t,d){t&1&&(a(0,"th",17),m(1),l(2,"translate"),r()),t&2&&(o(),h(" ",p(2,1,"DIALOGS.EDIT_MEMBER_SPONSORS.TABLE_EXPIRATION")," "))}function uh(t,d){if(t&1){let e=I();a(0,"button",20),l(1,"translate"),C("click",function(){f(e);let i=c().$implicit,s=c(2);return g(s.changeExpiration(i))}),a(2,"mat-icon"),m(3," today "),r()()}t&2&&u("matTooltip",w(p(1,2,"DIALOGS.EDIT_MEMBER_SPONSORS.CHANGE_EXPIRATION")))}function _h(t,d){if(t&1&&(a(0,"td",18),l(1,"isAuthorized"),a(2,"span"),m(3),l(4,"parseDate"),r(),v(5,uh,4,4,"button",19),l(6,"isAuthorized"),r()),t&2){let e=d.$implicit,n=c(2);Ee("align-elements",Me(1,4,Mi(12,Or,e.user,n.vo),"updateSponsorshipValidity_Member_User_LocalDate")),o(3),E(p(4,7,e.validityTo)),o(2),b(Me(6,9,Mi(15,Or,e.user,n.vo),"updateSponsorshipValidity_Member_User_LocalDate")?5:-1)}}function hh(t,d){t&1&&A(0,"th",17)}function fh(t,d){t&1&&(a(0,"mat-icon",23),m(1,"clear"),r())}function gh(t,d){t&1&&(a(0,"mat-icon"),m(1,"settings_backup_restore"),r())}function Ch(t,d){if(t&1){let e=I();a(0,"td",18)(1,"div",21),l(2,"translate"),l(3,"isAuthorized"),l(4,"isAuthorized"),a(5,"button",22),l(6,"translate"),l(7,"isAuthorized"),l(8,"isAuthorized"),C("click",function(){let i=f(e).$implicit,s=c(2);return g(s.markSponsor(i))}),v(9,fh,2,0,"mat-icon",23),v(10,gh,2,0,"mat-icon"),r()()()}if(t&2){let e=d.$implicit,n=c(2);o(),u("matTooltip",w(p(2,11,"DIALOGS.EDIT_MEMBER_SPONSORS.REMOVE_SPONSOR_DISABLED")))("matTooltipDisabled",Me(3,13,ke(27,lo,n.member),"sponsored-removeSponsor_Member_User_policy")&&Me(4,16,ke(29,lo,e.user),"sponsor-removeSponsor_Member_User_policy"))("matTooltipPosition","above"),o(4),Rt("data-cy",W("",e.user.firstName,"-unsponsor-mark-button")),u("matTooltip",w(p(6,19,"DIALOGS.EDIT_MEMBER_SPONSORS.REMOVE_SPONSOR")))("disabled",!Me(7,21,ke(31,lo,n.member),"sponsored-removeSponsor_Member_User_policy")||!Me(8,24,ke(33,lo,e.user),"sponsor-removeSponsor_Member_User_policy")),o(4),b(n.sponsorsToRemove.has(e.user.id)?-1:9),o(),b(n.sponsorsToRemove.has(e.user.id)?10:-1)}}function Sh(t,d){t&1&&A(0,"tr",24)}function vh(t,d){if(t&1&&A(0,"tr",25),t&2){let e=d.$implicit,n=c(2);Ee("make-red",n.sponsorsToRemove.has(e.user.id))}}function bh(t,d){if(t&1){let e=I();a(0,"div")(1,"h1",2),m(2),l(3,"translate"),r(),a(4,"div",3)(5,"table",4),Q(6,5),T(7,lh,3,3,"th",6)(8,ph,2,1,"td",7),Z(),Q(9,8),T(10,mh,3,3,"th",6)(11,dh,3,3,"td",7),Z(),Q(12,9),T(13,ch,3,3,"th",6)(14,_h,7,18,"td",10),Z(),Q(15,11),T(16,hh,1,0,"th",6)(17,Ch,11,35,"td",7),Z(),T(18,Sh,1,0,"tr",12)(19,vh,1,2,"tr",13),r()(),a(20,"div",14)(21,"button",15),C("click",function(){f(e);let i=c();return g(i.onCancel())}),m(22),l(23,"translate"),r(),a(24,"button",16),C("click",function(){f(e);let i=c();return g(i.onSubmit())}),m(25),l(26,"translate"),r()()()}if(t&2){let e=c();o(2),E(p(3,7,"DIALOGS.EDIT_MEMBER_SPONSORS.TITLE")),o(3),u("dataSource",e.dataSource),o(13),u("matHeaderRowDef",e.displayedColumns),o(),u("matRowDefColumns",e.displayedColumns),o(3),h(" ",p(23,9,"DIALOGS.EDIT_MEMBER_SPONSORS.CANCEL")," "),o(2),u("disabled",e.loading||e.sponsorsToRemove.size===0),o(),h(" ",p(26,11,"DIALOGS.EDIT_MEMBER_SPONSORS.SUBMIT")," ")}}var Lr=(()=>{class t{constructor(e,n,i,s,S,M,R,N){this.dialogRef=e,this.data=n,this.memberService=i,this.userService=s,this.notificator=S,this.authResolver=M,this.translate=R,this.dialog=N,this.displayedColumns=["id","name","expiration","remove"],this.loading=!1,this.sponsorsToRemove=new Set,this.expirationChanged=!1}ngOnInit(){this.theme=this.data.theme,this.sponsors=this.data.sponsors,this.member=this.data.member,this.dataSource=new et(this.data.sponsors),this.vo={beanName:"Vo",id:this.data.member.voId}}markSponsor(e){this.sponsorsToRemove.has(e.user.id)?this.sponsorsToRemove.delete(e.user.id):this.sponsorsToRemove.add(e.user.id)}onSubmit(){this.loading=!0;let e=Array.from(this.sponsorsToRemove);this.removeSponsors(e)}onCancel(){this.dialogRef.close(this.expirationChanged)}changeExpiration(e){let n=F();n.width="400px",n.data={memberId:this.data.member.id,sponsor:e},this.dialog.open(ya,n).afterClosed().subscribe(s=>{s&&(this.loading=!0,this.expirationChanged=!0,this.userService.getSponsorsForMember(this.data.member.id,[]).subscribe(S=>{this.sponsors=S,this.dataSource=new et(this.sponsors),this.loading=!1}))})}removeSponsors(e){this.memberService.removeSponsors(this.data.member.id,e).subscribe({next:()=>{this.notificator.showSuccess(this.translate.instant("DIALOGS.EDIT_MEMBER_SPONSORS.SUCCESS")),this.loading=!1,this.dialogRef.close(!0)},error:()=>this.loading=!1})}static{this.\u0275fac=function(n){return new(n||t)(_(U),_(j),_(Qe),_(In),_(q),_(pe),_(Mt),_(Ae))}}static{this.\u0275cmp=x({type:t,selectors:[["app-edit-member-sponsors-dialog"]],decls:4,vars:5,consts:[["spinner",""],[4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],["mat-dialog-title",""],["mat-dialog-content",""],["mat-table","",1,"w-100",3,"dataSource"],["matColumnDef","id"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","name"],["matColumnDef","expiration"],["mat-cell","",3,"align-elements",4,"matCellDef"],["matColumnDef","remove"],["class","font-weight-bolder","mat-header-row","",4,"matHeaderRowDef"],["mat-row","",3,"make-red",4,"matRowDef","matRowDefColumns"],["mat-dialog-actions",""],["mat-stroked-button","",1,"ms-auto",3,"click"],["data-cy","unsponsor-confirm-button","color","warn","mat-flat-button","",1,"ms-2",3,"click","disabled"],["mat-header-cell",""],["mat-cell",""],["mat-icon-button","",3,"matTooltip"],["mat-icon-button","",3,"click","matTooltip"],[3,"matTooltipDisabled","matTooltipPosition","matTooltip"],["mat-icon-button","",1,"btn-delete",3,"click","disabled","matTooltip"],["color","warn",1,"icn-delete"],["mat-header-row","",1,"font-weight-bolder"],["mat-row",""]],template:function(n,i){if(n&1&&(T(0,sh,1,0,"ng-template",null,0,B),a(2,"div"),T(3,bh,27,13,"div",1),r()),n&2){let s=y(1);o(2),H(W("",i.theme," position-relative")),o(),u("perunWebAppsLoader",i.loading)("perunWebAppsLoaderIndicator",s)}},dependencies:[D,P,G,ti,lt,st,K,$,X,Y,oe,vt,mt,ct,ft,ut,dt,gt,_t,ht,Ct,St,L,ne,V,Nn,O,Xt,ba],styles:[".make-red[_ngcontent-%COMP%]{background-color:#ffcdd2}.btn-delete[_ngcontent-%COMP%]:disabled   .icn-delete[_ngcontent-%COMP%]{color:gray}"]})}}return t})();var Eh=(t,d)=>d.id;function Ih(t,d){t&1&&A(0,"perun-web-apps-loading-dialog")}function Th(t,d){if(t&1&&(a(0,"mat-option",6),m(1),r()),t&2){let e=d.$implicit;u("value",e),o(),h(" ",e.friendlyNameParameter," ")}}function Ah(t,d){if(t&1&&(a(0,"mat-option",6),m(1),l(2,"uppercase"),l(3,"translate"),r()),t&2){let e=d.$implicit;u("value",e),o(),h(" ",p(3,4,p(2,2,"SHARED_LIB.LANGUAGES."+e))," ")}}function Mh(t,d){if(t&1&&(a(0,"mat-option",6),m(1),r()),t&2){let e=d.$implicit;u("value",e),o(),h(" ",e," ")}}function xh(t,d){if(t&1){let e=I();a(0,"div")(1,"h1",3),m(2),l(3,"translate"),r(),a(4,"div",4)(5,"mat-form-field")(6,"mat-label"),m(7),l(8,"translate"),r(),a(9,"mat-select",5),te("valueChange",function(i){f(e);let s=c();return ee(s.selectedLogin,i)||(s.selectedLogin=i),g(i)}),de(10,Th,2,2,"mat-option",6,Eh),r()(),a(12,"mat-form-field")(13,"mat-label"),m(14),l(15,"translate"),r(),a(16,"mat-select",5),te("valueChange",function(i){f(e);let s=c();return ee(s.selectedLang,i)||(s.selectedLang=i),g(i)}),de(17,Ah,4,6,"mat-option",6,Ce),r()(),a(19,"mat-form-field")(20,"mat-label"),m(21),l(22,"translate"),r(),a(23,"mat-select",5),te("valueChange",function(i){f(e);let s=c();return ee(s.selectedMail,i)||(s.selectedMail=i),g(i)}),de(24,Mh,2,2,"mat-option",6,Ce),r()(),a(26,"div",7)(27,"p",8),m(28),l(29,"translate"),r(),a(30,"p"),m(31),r()()(),a(32,"div",9)(33,"button",10),C("click",function(){f(e);let i=c();return g(i.onCancel())}),m(34),l(35,"translate"),r(),a(36,"button",11),C("click",function(){f(e);let i=c();return g(i.onSubmit())}),m(37),l(38,"translate"),r()()()}if(t&2){let e=c();o(2),E(p(3,12,"DIALOGS.PASSWORD_RESET_REQUEST.TITLE")),o(5),E(p(8,14,"DIALOGS.PASSWORD_RESET_REQUEST.NAMESPACE")),o(2),J("value",e.selectedLogin),o(),ce(e.logins),o(4),E(p(15,16,"DIALOGS.PASSWORD_RESET_REQUEST.LANGUAGE")),o(2),J("value",e.selectedLang),o(),ce(e.languages),o(4),E(p(22,18,"DIALOGS.PASSWORD_RESET_REQUEST.EMAIL")),o(2),J("value",e.selectedMail),o(),ce(e.mails),o(4),E(p(29,20,"DIALOGS.PASSWORD_RESET_REQUEST.LOGIN")),o(3),E(e.selectedLogin.value),o(3),h(" ",p(35,22,"DIALOGS.PASSWORD_RESET_REQUEST.CANCEL")," "),o(2),u("disabled",e.loading),o(),h(" ",p(38,24,"DIALOGS.PASSWORD_RESET_REQUEST.SEND")," ")}}var yr=(()=>{class t{constructor(e,n,i,s,S,M,R){this.dialogRef=e,this.data=n,this.membersManagerService=i,this.attributesManagerService=s,this.store=S,this.translate=M,this.notificator=R,this.languages=this.store.getProperty("supported_languages"),this.selectedLang="en",this.pwdMails=new Map,this.logins=[],this.selectedMail="user:preferredMail",this.mails=[],M.get("DIALOGS.PASSWORD_RESET_REQUEST.SUCCESS").subscribe(N=>this.successMessage=N)}ngOnInit(){this.getMailAttributes(),this.logins=this.data.logins,this.selectedLogin=this.logins[0]}onCancel(){this.dialogRef.close()}onSubmit(){this.loading=!0;let e=this.selectedLogin.friendlyNameParameter,n=ji();this.membersManagerService.sendPasswordResetLinkEmail(this.data.memberId,e,this.pwdMails.get(this.selectedMail),this.selectedLang,n).subscribe(()=>{this.notificator.showSuccess(this.successMessage),this.loading=!1,this.dialogRef.close()},()=>this.loading=!1)}getMailAttributes(){this.pwdMails.set("user:preferredMail","urn:perun:user:attribute-def:def:preferredMail"),this.pwdMails.set("member:mail","urn:perun:member:attribute-def:def:mail"),this.mails=Array.from(this.pwdMails.keys()),this.selectedMail="user:preferredMail"}static{this.\u0275fac=function(n){return new(n||t)(_(U),_(j),_(Qe),_(Tt),_(Le),_(Se),_(q))}}static{this.\u0275cmp=x({type:t,selectors:[["app-password-reset-request-dialog"]],decls:4,vars:2,consts:[["spinner",""],[1,"member-theme","position-relative"],[4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],["mat-dialog-title",""],["mat-dialog-content","",1,"dialog-container"],[3,"valueChange","value"],[3,"value"],[1,"row"],[1,"column-size","ms-3"],["mat-dialog-actions",""],["mat-stroked-button","",1,"ms-auto",3,"click"],["data-cy","reset-passwd-confirm-button","color","accent","mat-flat-button","",1,"ms-2",3,"click","disabled"]],template:function(n,i){if(n&1&&(T(0,Ih,1,0,"ng-template",null,0,B),a(2,"div",1),T(3,xh,39,26,"div",2),r()),n&2){let s=y(1);o(3),u("perunWebAppsLoader",i.loading)("perunWebAppsLoaderIndicator",s)}},dependencies:[D,P,G,Oe,Re,Pe,Ye,$e,We,K,$,X,Y,oe,L,V,At,O],styles:[".column-size[_ngcontent-%COMP%]{width:8rem}"]})}}return t})();var Dh=t=>({all:t}),Rh=t=>({name:t}),wr=(t,d)=>["/organizations",t,"members",d];function Oh(t,d){if(t&1){let e=I();a(0,"th",20)(1,"mat-checkbox",21),l(2,"masterCheckboxLabel"),l(3,"translate"),C("change",function(i){f(e);let s=c(2);return g(i?s.masterToggle():null)}),r()()}if(t&2){let e=c(),n=c();o(),pi("aria-label",p(3,5,p(2,3,e.all))),u("checked",n.selection.hasValue()&&e.all)("indeterminate",n.selection.hasValue()&&!e.all)}}function Lh(t,d){if(t&1){let e=I();a(0,"td",22)(1,"mat-checkbox",23),l(2,"checkboxLabel"),l(3,"userFullName"),l(4,"translate"),C("change",function(i){let s=f(e).$implicit,S=c(2);return g(i?S.toggleRow(s):null)})("click",function(i){return f(e),g(i.stopPropagation())}),r()()}if(t&2){let e=d.$implicit,n=c(2);o(),pi("aria-label",Me(4,6,p(2,2,n.selection.isSelected(e)),ke(9,Rh,p(3,4,e.member.user)))),u("checked",n.selection.isSelected(e))}}function yh(t,d){t&1&&(Q(0,3),T(1,Oh,4,7,"th",18)(2,Lh,5,11,"td",19),Z())}function wh(t,d){t&1&&(a(0,"th",24),m(1),l(2,"translate"),r()),t&2&&(o(),h(" ",p(2,1,"SHARED.COMPONENTS.SPONSORED_MEMBERS_LIST.ID")," "))}function Ph(t,d){if(t&1&&(a(0,"td",25),m(1),r()),t&2){let e=d.$implicit;o(),h(" ",e.member.id," ")}}function Gh(t,d){t&1&&(a(0,"th",24),m(1),l(2,"translate"),r()),t&2&&(o(),h(" ",p(2,1,"SHARED.COMPONENTS.SPONSORED_MEMBERS_LIST.NAME")," "))}function Nh(t,d){if(t&1&&(a(0,"td",26),m(1),l(2,"userFullName"),r()),t&2){let e=d.$implicit;o(),h(" ",p(2,1,e.member.user)," ")}}function Bh(t,d){t&1&&(a(0,"th",27),m(1),l(2,"translate"),r()),t&2&&(o(),h(" ",p(2,1,"SHARED.COMPONENTS.SPONSORED_MEMBERS_LIST.EMAIL")," "))}function Vh(t,d){if(t&1&&(a(0,"td",26),m(1),l(2,"memberEmail"),r()),t&2){let e=d.$implicit;o(),E(p(2,1,e.member))}}function Fh(t,d){t&1&&(a(0,"th",27),m(1),l(2,"translate"),r()),t&2&&(o(),h(" ",p(2,1,"SHARED.COMPONENTS.SPONSORED_MEMBERS_LIST.LOGIN")," "))}function kh(t,d){if(t&1&&(a(0,"td",26),m(1),l(2,"memberLogins"),r()),t&2){let e=d.$implicit;o(),h(" ",p(2,1,e.member)," ")}}function Uh(t,d){t&1&&(a(0,"th",24),m(1),l(2,"translate"),r()),t&2&&(o(),h(" ",p(2,1,"SHARED.COMPONENTS.SPONSORED_MEMBERS_LIST.SPONSORS")," "))}function jh(t,d){if(t&1&&(a(0,"span"),m(1),l(2,"userFullName"),A(3,"br"),r()),t&2){let e=d.$implicit;o(),h(" ",p(2,1,e.user))}}function Wh(t,d){if(t&1&&(a(0,"td",26),de(1,jh,4,3,"span",null,Ce),r()),t&2){let e=d.$implicit;o(),ce(e.sponsors)}}function Hh(t,d){t&1&&(a(0,"th",27),m(1),l(2,"translate"),r()),t&2&&(o(),h(" ",p(2,1,"SHARED.COMPONENTS.SPONSORED_MEMBERS_LIST.EXPIRATION")," "))}function zh(t,d){if(t&1&&(a(0,"td",26),m(1),l(2,"selectedSponsor"),l(3,"parseDate"),r()),t&2){let e=d.$implicit,n=c();o(),h(" ",p(3,4,Me(2,1,e.sponsors,n.selectedSponsor).validityTo)," ")}}function qh(t,d){t&1&&A(0,"th",27)}function $h(t,d){if(t&1){let e=I();a(0,"span")(1,"button",29),l(2,"translate"),C("mouseenter",function(){f(e);let i=c(2);return g(i.disableRouting=!0)})("mouseleave",function(){f(e);let i=c(2);return g(i.disableRouting=i.routingStrategy)})("click",function(){f(e);let i=c().$implicit,s=c();return g(s.resetPassword(i))}),a(3,"mat-icon"),m(4,"vpn_key"),r()()()}if(t&2){let e=c().$implicit,n=c();o(),Rt("data-cy",W("",e.member.user.firstName,"-reset-passwd-button")),u("disabled",n.loading)("matTooltipPosition","above")("matTooltip",p(2,5,"SHARED.COMPONENTS.SPONSORED_MEMBERS_LIST.PASSWORD_RESET"))}}function Yh(t,d){if(t&1){let e=I();a(0,"td",26)(1,"button",28),l(2,"translate"),C("click",function(){let i=f(e).$implicit,s=c();return g(s.showSponsors(i))})("mouseenter",function(){f(e);let i=c();return g(i.disableRouting=!0)})("mouseleave",function(){f(e);let i=c();return g(i.disableRouting=i.routingStrategy)}),a(3,"mat-icon"),m(4,"edit"),r()(),v(5,$h,5,7,"span"),r()}if(t&2){let e=d.$implicit,n=c();o(),Rt("data-cy",W("",e.member.user.firstName,"-edit-sponsors-button")),u("matTooltipPosition","above")("matTooltip",p(2,5,"SHARED.COMPONENTS.SPONSORED_MEMBERS_LIST.EDIT")),o(4),b(n.passwdResetAuth(e)?5:-1)}}function Xh(t,d){t&1&&A(0,"tr",30)}function Kh(t,d){if(t&1&&A(0,"tr",31),t&2){let e=d.$implicit,n=c();Ee("cursor-pointer",!n.disableRouting)("disable-outline",n.disableRouting),Rt("data-cy",W("",e.member.user.firstName,"-name")),u("perunWebAppsMiddleClickRouterLink",n.disableRouting?null:Mi(8,wr,e.member.voId,e.member.id))("routerLink",n.disableRouting?null:Mi(11,wr,e.member.voId,e.member.id))}}function Qh(t,d){t&1&&(a(0,"perun-web-apps-alert",17),m(1),l(2,"translate"),r()),t&2&&(o(),h(" ",p(2,1,"SHARED_LIB.UI.ALERTS.NO_FILTER_RESULTS_ALERT")," "))}function Zh(t,d){t&1&&(a(0,"perun-web-apps-alert",17),m(1),l(2,"translate"),r()),t&2&&(o(),h(" ",p(2,1,"SHARED.COMPONENTS.SPONSORED_MEMBERS_LIST.NO_SPONSORED_MEMBERS_WARNING")," "))}var po=(()=>{class t{constructor(e,n,i,s,S,M){this.dialog=e,this.authResolver=n,this.storeService=i,this.attributesManager=s,this.tableCheckbox=S,this.destroyRef=M,this.sponsoredMembers=[],this.filterValue="",this.displayedColumns=["id","name","email","logins","sponsors","menu"],this.disableRouting=!1,this.refreshTable=new pt,this.loading=!1,this.routingStrategy=!1,this.pageSizeOptions=Fi,this.tableId="app-sponsored-members-list"}set matSort(e){this.sort=e}static getSortDataForColumn(e,n){switch(n){case"id":return e.member.id.toString();case"name":return e.member.user?e.member.user.lastName?e.member.user.lastName:e.member.user.firstName??"":"";case"sponsors":return e.sponsors.length.toString();default:return""}}static getDataForColumn(e,n){switch(n){case"id":return e.member.id.toString();case"name":return e.member.user?rn(e.member.user):"";case"sponsors":return e.sponsors.map(i=>rn(i.user)).join();default:return""}}ngOnInit(){this.selection&&(this.cachedSelection=new _e(this.selection.isMultipleSelection(),[],!0,this.selection.compareWith),this.cachedSubject?.pipe(Ne(this.destroyRef)).subscribe(e=>{e&&this.cachedSelection.clear()}))}ngOnChanges(){localStorage.getItem("showIds")!=="true"&&(this.displayedColumns=this.displayedColumns.filter(e=>e!=="id")),this.setDataSource(),this.routingStrategy=this.disableRouting}exportAllData(e){Et(Ot(this.dataSource.filteredData,this.displayedColumns,t.getDataForColumn),e)}exportDisplayedData(e){let n=this.dataSource.paginator.pageIndex*this.dataSource.paginator.pageSize,i=n+this.dataSource.paginator.pageSize;Et(Ot(this.dataSource.sortData(this.dataSource.filteredData,this.dataSource.sort).slice(n,i),this.displayedColumns,t.getDataForColumn),e)}setDataSource(){this.dataSource||(this.dataSource=new et,this.dataSource.sort=this.sort,this.dataSource.paginator=this.child.paginator,this.dataSource.filterPredicate=(e,n)=>Pn(e,n,this.displayedColumns,t.getDataForColumn),this.dataSource.sortData=(e,n)=>ki(e,n,t.getSortDataForColumn)),this.dataSource.filter=this.filterValue,this.dataSource.data=this.sponsoredMembers}showSponsors(e){let n=F();n.width="650px",n.data={sponsors:e.sponsors,member:e.member,theme:"vo-theme"},this.dialog.open(Lr,n).afterClosed().subscribe(s=>{s&&this.refreshTable.emit()})}isAllSelected(){return this.tableCheckbox.isAllSelected(this.selection.selected.length,this.dataSource)}masterToggle(){this.tableCheckbox.masterToggle(this.isAllSelected(),this.selection,this.cachedSelection,this.filterValue,this.dataSource,this.sort,this.child.paginator.pageSize,this.child.paginator.pageIndex,!1)}toggleRow(e){this.selection.toggle(e),this.cachedSelection.toggle(e)}resetPassword(e){this.loading=!0;let n=this.storeService.getProperty("password_namespace_attributes").map(i=>{let s=i.split(":");return s[s.length-1]});this.attributesManager.getLogins(e.member.userId).subscribe(i=>{let s=i.filter(R=>n.includes(R.friendlyNameParameter)),S=F();S.width="400px",S.data={userId:e.member.userId,memberId:e.member.id,logins:s},this.dialog.open(yr,S).afterClosed().subscribe(()=>{this.loading=!1})},()=>this.loading=!1)}passwdResetAuth(e){let n={id:e.member.voId,beanName:"Vo"};return this.authResolver.isAuthorized("sendPasswordResetLinkEmail_Member_String_String_String_String_policy",[n,e.member])}pageChanged(){this.cachedSelection&&this.tableCheckbox.selectCachedDataOnPage(this.dataSource,this.selection,this.cachedSelection,this.selection.compareWith)}static{this.\u0275fac=function(n){return new(n||t)(_(Ae),_(pe),_(Le),_(Tt),_(Wi),_(we))}}static{this.\u0275cmp=x({type:t,selectors:[["app-sponsored-members-list"]],viewQuery:function(n,i){if(n&1&&(Be(mi,7),Be(Ht,7)),n&2){let s;Ve(s=Fe())&&(i.child=s.first),Ve(s=Fe())&&(i.matSort=s.first)}},inputs:{sponsoredMembers:"sponsoredMembers",selection:"selection",cachedSubject:"cachedSubject",filterValue:"filterValue",displayedColumns:"displayedColumns",tableLoading:"tableLoading",disableRouting:"disableRouting",selectedSponsor:"selectedSponsor"},outputs:{refreshTable:"refreshTable"},features:[Jt],decls:30,vars:15,consts:[[1,"card","mt-3",3,"hidden"],[3,"exportDisplayedData","exportAllData","pageChanged","pageSizeOptions","dataLength","tableId"],["mat-table","","matSort","","matSortActive","name","matSortDirection","asc","matSortDisableClear","",1,"w-100",3,"matSortChange","dataSource"],["matColumnDef","select"],["matColumnDef","id"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["class","static-column-size","mat-cell","",4,"matCellDef"],["matColumnDef","name"],["mat-cell","",4,"matCellDef"],["matColumnDef","email"],["mat-header-cell","",4,"matHeaderCellDef"],["matColumnDef","logins"],["matColumnDef","sponsors"],["matColumnDef","expiration"],["matColumnDef","menu"],["mat-header-row","",4,"matHeaderRowDef"],["class","dark-hover-list-item","mat-row","",3,"cursor-pointer","disable-outline","perunWebAppsMiddleClickRouterLink","routerLink",4,"matRowDef","matRowDefColumns"],["alert_type","warn"],["class","align-checkbox","mat-header-cell","",4,"matHeaderCellDef"],["class","static-column-size align-checkbox","mat-cell","",4,"matCellDef"],["mat-header-cell","",1,"align-checkbox"],["color","primary",3,"change","aria-label","checked","indeterminate"],["mat-cell","",1,"static-column-size","align-checkbox"],["color","primary",3,"change","click","aria-label","checked"],["mat-header-cell","","mat-sort-header",""],["mat-cell","",1,"static-column-size"],["mat-cell",""],["mat-header-cell",""],["aria-label","sponsors of member","mat-icon-button","",1,"dark-hover-list-item",3,"click","mouseenter","mouseleave","matTooltipPosition","matTooltip"],["aria-label","sponsors of member","mat-icon-button","",1,"dark-hover-list-item",3,"mouseenter","mouseleave","click","disabled","matTooltipPosition","matTooltip"],["mat-header-row",""],["mat-row","",1,"dark-hover-list-item",3,"perunWebAppsMiddleClickRouterLink","routerLink"]],template:function(n,i){if(n&1&&(a(0,"div",0)(1,"perun-web-apps-table-wrapper",1),C("exportDisplayedData",function(S){return i.exportDisplayedData(S)})("exportAllData",function(S){return i.exportAllData(S)})("pageChanged",function(){return i.pageChanged()}),a(2,"table",2),C("matSortChange",function(){return i.pageChanged()}),v(3,yh,3,0,"ng-container",3),l(4,"isAllSelected"),Q(5,4),T(6,wh,3,3,"th",5)(7,Ph,2,1,"td",6),Z(),Q(8,7),T(9,Gh,3,3,"th",5)(10,Nh,3,3,"td",8),Z(),Q(11,9),T(12,Bh,3,3,"th",10)(13,Vh,3,3,"td",8),Z(),Q(14,11),T(15,Fh,3,3,"th",10)(16,kh,3,3,"td",8),Z(),Q(17,12),T(18,Uh,3,3,"th",5)(19,Wh,3,0,"td",8),Z(),Q(20,13),T(21,Hh,3,3,"th",10)(22,zh,4,6,"td",8),Z(),Q(23,14),T(24,qh,1,0,"th",10)(25,Yh,6,7,"td",8),Z(),T(26,Xh,1,0,"tr",15)(27,Kh,1,14,"tr",16),r()()(),v(28,Qh,3,3,"perun-web-apps-alert",17),v(29,Zh,3,3,"perun-web-apps-alert",17)),n&2){let s;u("hidden",i.dataSource.filteredData.length===0||i.sponsoredMembers.length===0),o(),u("pageSizeOptions",i.pageSizeOptions)("dataLength",i.dataSource.filteredData.length)("tableId",i.tableId),o(),u("dataSource",i.dataSource),o(),b((s=ke(13,Dh,Me(4,10,i.dataSource,i.selection.selected.length)))?3:-1,s),o(23),u("matHeaderRowDef",i.displayedColumns),o(),u("matRowDefColumns",i.displayedColumns),o(),b(i.dataSource.filteredData.length===0&&i.sponsoredMembers.length!==0?28:-1),o(),b(!i.tableLoading&&i.sponsoredMembers.length===0?29:-1)}},dependencies:[D,P,ti,lt,st,Pt,wt,be,ve,jo,mi,Uo,ko,vt,mt,ct,ft,ut,dt,gt,_t,ht,Ct,St,yi,Ht,Li,L,ne,Hi,Nn,O,zi,Xt,_a,qi,ua,Ea],styles:[".disable-outline[_ngcontent-%COMP%]{outline:none!important}.cursor-pointer[_ngcontent-%COMP%]{cursor:pointer}"]})}}return t})();var Jh=()=>["select","id","name","email","logins","expiration"];function ef(t,d){t&1&&A(0,"perun-web-apps-loading-dialog")}function tf(t,d){t&1&&A(0,"perun-web-apps-loading-table")}function nf(t,d){if(t&1&&A(0,"app-sponsored-members-list",15),t&2){let e=c(3);u("tableLoading",e.tableLoading)("disableRouting",!0)("sponsoredMembers",e.filteredSponsoredMembers)("selection",e.selection)("cachedSubject",e.cachedSubject)("filterValue",e.filter)("displayedColumns",ue(8,Jh))("selectedSponsor",e.sourceSponsor)}}function of(t,d){if(t&1){let e=I();a(0,"div",6)(1,"h6"),m(2),l(3,"translate"),r(),a(4,"perun-web-apps-alert",7),m(5),l(6,"translate"),r(),a(7,"perun-web-apps-debounce-filter",13),C("filter",function(i){f(e);let s=c(2);return g(s.applyFilter(i))}),r(),T(8,nf,1,9,"app-sponsored-members-list",14),r()}if(t&2){c();let e=y(10),n=c();o(2),E(p(3,5,"DIALOGS.COPY_SPONSORED_MEMBERS.SPONSORED_MEMBERS")),o(3),h(" ",p(6,7,"DIALOGS.COPY_SPONSORED_MEMBERS.SPONSORED_MEMBERS_INFO")," "),o(2),u("placeholder","VO_DETAIL.SETTINGS.SPONSORED_MEMBERS.FILTER"),o(),u("perunWebAppsLoader",n.tableLoading)("perunWebAppsLoaderIndicator",e)}}function af(t,d){if(t&1){let e=I();a(0,"app-choose-sponsor",17),C("sponsorTypeSelected",function(i){f(e);let s=c(3);return g(s.sponsorType=i)})("sponsorSelected",function(i){f(e);let s=c(3);return g(s.targetSponsor=i)}),r()}if(t&2){let e=c(3);u("voId",e.data.voId)("customTitle","DIALOGS.CREATE_SPONSORED_MEMBER.SELECT_SPONSOR_COPY")("disableSelf",e.disableSelf)("voSponsors",e.voSponsorsTarget)}}function rf(t,d){if(t&1&&(a(0,"div"),v(1,af,1,4,"app-choose-sponsor",16),r()),t&2){let e=c(2);o(),b(e.tableLoading?-1:1)}}function sf(t,d){if(t&1){let e=I();a(0,"perun-web-apps-expiration-select",18),C("expirationSelected",function(i){f(e);let s=c(2);return g(s.expiration=i)}),r()}if(t&2){let e=c(2);u("minDate",e.minDate)}}function lf(t,d){if(t&1){let e=I();a(0,"div")(1,"h1",3),m(2),l(3,"translate"),r(),a(4,"div",4)(5,"h6"),m(6),l(7,"translate"),r(),a(8,"perun-web-apps-user-search-select",5),C("userSelected",function(i){f(e);let s=c();return g(s.sourceSponsorChanged(i))}),r(),T(9,tf,1,0,"ng-template",null,1,B),v(11,of,9,9,"div",6),v(12,rf,2,1,"div"),a(13,"div")(14,"perun-web-apps-alert",7),m(15),l(16,"translate"),r(),a(17,"h6"),m(18),l(19,"translate"),r(),a(20,"mat-checkbox",8),te("ngModelChange",function(i){f(e);let s=c();return ee(s.pickExpiration,i)||(s.pickExpiration=i),g(i)}),m(21,"Pick new expiration date"),r(),v(22,sf,1,1,"perun-web-apps-expiration-select",9),r()(),a(23,"div",10)(24,"button",11),C("click",function(){f(e);let i=c();return g(i.cancel())}),m(25),l(26,"translate"),r(),a(27,"button",12),C("click",function(){f(e);let i=c();return g(i.submit())}),m(28),l(29,"translate"),r()()()}if(t&2){let e=c();o(2),E(p(3,13,"DIALOGS.COPY_SPONSORED_MEMBERS.TITLE")),o(4),E(p(7,15,"DIALOGS.COPY_SPONSORED_MEMBERS.SPONSOR_FROM")),o(2),u("disableAutoSelect",!0)("users",e.voSponsorsSource),o(3),b(e.sourceSponsorSelected?11:-1),o(),b(e.isPerunAdmin?12:-1),o(3),h(" ",p(16,17,"DIALOGS.COPY_SPONSORED_MEMBERS.EXP_INFO")," "),o(3),E(p(19,19,"DIALOGS.COPY_SPONSORED_MEMBERS.EXPIRATION")),o(2),J("ngModel",e.pickExpiration),o(2),b(e.pickExpiration?22:-1),o(3),h(" ",p(26,21,"DIALOGS.COPY_SPONSORED_MEMBERS.CANCEL")," "),o(2),u("disabled",e.loading||e.selection.selected.length===0||e.sponsorType==="other"&&!e.targetSponsor),o(),h(" ",p(29,23,"DIALOGS.COPY_SPONSORED_MEMBERS.SPONSOR")," ")}}var Pr=(()=>{class t{constructor(e,n,i,s,S,M,R,N){this.dialogRef=e,this.data=n,this.store=i,this.membersService=s,this.notificator=S,this.translate=M,this.auth=R,this.findSponsors=N,this.loading=!1,this.tableLoading=!1,this.sponsorType="self",this.voSponsors=[],this.voSponsorsTarget=[],this.voSponsorsSource=[],this.selection=new _e(!0,[],!0,(re,xe)=>re.member?.id===xe.member?.id),this.cachedSubject=new ge(!0),this.sourceSponsorSelected=!1,this.expiration="never",this.minDate=new Date,this.pickExpiration=!1,this.disableSelf=!1,this.isPerunAdmin=!1,this.attrNames=[k.USER_DEF_PREFERRED_MAIL]}ngOnInit(){this.loading=!0,this.theme=this.data.theme,this.attrNames=this.attrNames.concat(this.store.getLoginAttributeNames()),this.membersService.getAllSponsoredMembersAndTheirSponsors(this.data.voId,this.attrNames).subscribe({next:e=>{this.sponsoredMembers=e}}),this.findSponsors.getSponsors(this.data.voId).subscribe(e=>{this.voSponsors=e,this.voSponsorsTarget=e,this.voSponsorsSource=e,this.isPerunAdmin=this.auth.isPerunAdmin(),this.isPerunAdmin||(this.voSponsorsSource=this.voSponsorsSource.filter(n=>n.id!==this.store.getPerunPrincipal().user.id)),this.loading=!1})}sourceSponsorChanged(e){this.tableLoading=!0,this.sourceSponsor=e,this.voSponsorsTarget=this.voSponsors.filter(n=>n.id!==this.sourceSponsor.id),this.isPerunAdmin&&(this.disableSelf=this.store.getPerunPrincipal().user.id===this.sourceSponsor.id),this.sourceSponsorSelected=!0,this.selection.clear(),this.cachedSubject.next(!0),this.filteredSponsoredMembers=this.sponsoredMembers.filter(n=>n.sponsors.map(i=>i.user.id).includes(this.sourceSponsor.id)),this.tableLoading=!1}sponsor(e){let n=this.sponsorType==="self"?this.store.getPerunPrincipal().user:this.targetSponsor,i=e.map(s=>s.member.id);this.membersService.copySponsoredMembersBodyParams({members:i,copyFrom:this.sourceSponsor.id,copyTo:n.id,copyValidity:!this.pickExpiration,validityTo:this.expiration}).subscribe({next:()=>{this.notificator.showSuccess(this.translate.instant("DIALOGS.COPY_SPONSORED_MEMBERS.SUCCESS")),this.loading=!1,this.dialogRef.close(!0)},error:()=>this.loading=!1})}submit(){this.loading=!0,this.expiration=this.expiration==="never"?null:this.expiration,this.sponsor(this.selection.selected)}cancel(){this.dialogRef.close(!1)}applyFilter(e){this.filter=e,this.selection.clear(),this.cachedSubject.next(!0)}static{this.\u0275fac=function(n){return new(n||t)(_(U),_(j),_(Le),_(Qe),_(q),_(Mt),_(pe),_(si))}}static{this.\u0275cmp=x({type:t,selectors:[["app-copy-sponsored-members-dialog"]],decls:4,vars:5,consts:[["spinner",""],["tableSpinner",""],[4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],["mat-dialog-title",""],["mat-dialog-content","",1,"dialog-container"],[3,"userSelected","disableAutoSelect","users"],[1,"position-relative"],["alert_type","info"],[3,"ngModelChange","ngModel"],[3,"minDate"],["mat-dialog-actions",""],["mat-stroked-button","",1,"ms-auto",3,"click"],["data-cy","sponsor-member-button","color","accent","mat-flat-button","",1,"ms-2",3,"click","disabled"],[3,"filter","placeholder"],[3,"tableLoading","disableRouting","sponsoredMembers","selection","cachedSubject","filterValue","displayedColumns","selectedSponsor",4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],[3,"tableLoading","disableRouting","sponsoredMembers","selection","cachedSubject","filterValue","displayedColumns","selectedSponsor"],[3,"voId","customTitle","disableSelf","voSponsors"],[3,"sponsorTypeSelected","sponsorSelected","voId","customTitle","disableSelf","voSponsors"],[3,"expirationSelected","minDate"]],template:function(n,i){if(n&1&&(T(0,ef,1,0,"ng-template",null,0,B),a(2,"div"),T(3,lf,30,25,"div",2),r()),n&2){let s=y(1);o(2),H(W("",i.theme," position-relative")),o(),u("perunWebAppsLoader",i.loading)("perunWebAppsLoaderIndicator",s)}},dependencies:[D,P,G,Pt,wt,je,se,Ue,le,K,$,X,Y,be,ve,oe,ye,bi,L,po,Ei,V,Hn,Ge,O],encapsulation:2})}}return t})();function pf(t,d){if(t&1&&(a(0,"button",5),m(1),l(2,"translate"),r()),t&2){let e=c(),n=y(9);u("disabled",e.findSponsorsAuth&&!e.sponsorshipIsPossible)("matMenuTriggerFor",n),o(),h(" ",p(2,3,"VO_DETAIL.SETTINGS.SPONSORED_MEMBERS.CREATE")," ")}}function mf(t,d){if(t&1){let e=I();a(0,"button",13),C("click",function(){f(e);let i=c();return g(i.onCreate())}),m(1),l(2,"translate"),r()}t&2&&(o(),h(" ",p(2,1,"VO_DETAIL.SETTINGS.SPONSORED_MEMBERS.CREATE_ONE")," "))}function df(t,d){if(t&1){let e=I();a(0,"button",14),C("click",function(){f(e);let i=c();return g(i.onGenerate())}),m(1),l(2,"translate"),r()}t&2&&(o(),h(" ",p(2,1,"VO_DETAIL.SETTINGS.SPONSORED_MEMBERS.GENERATE")," "))}function cf(t,d){if(t&1){let e=I();a(0,"button",15),C("click",function(){f(e);let i=c();return g(i.onSponsorExistingMember())}),m(1),l(2,"translate"),r()}if(t&2){let e=c();u("disabled",e.findSponsorsAuth&&!e.sponsorshipIsPossible),o(),h(" ",p(2,2,"VO_DETAIL.SETTINGS.SPONSORED_MEMBERS.SPONSOR_EXISTING")," ")}}function uf(t,d){if(t&1){let e=I();a(0,"button",16),C("click",function(){f(e);let i=c();return g(i.copySponsoredMembers())}),m(1),l(2,"translate"),r()}if(t&2){let e=c();u("disabled",e.findSponsorsAuth&&!e.sponsorshipIsPossible),o(),h(" ",p(2,2,"VO_DETAIL.SETTINGS.SPONSORED_MEMBERS.COPY")," ")}}function _f(t,d){t&1&&A(0,"perun-web-apps-loading-table")}function hf(t,d){if(t&1){let e=I();a(0,"app-sponsored-members-list",17),C("refreshTable",function(){f(e);let i=c();return g(i.refresh())}),r()}if(t&2){let e=c();u("tableLoading",e.loading)("disableRouting",!e.routeAuth)("selection",e.selection)("cachedSubject",e.cachedSubject)("filterValue",e.searchString)("sponsoredMembers",e.members)}}var IN=(()=>{class t{static{this.id="VoSponsoredMembersComponent"}constructor(e,n,i,s,S,M,R,N,re){this.membersManager=e,this.dialog=n,this.authResolver=i,this.storeService=s,this.authzResolver=S,this.entityStorageService=M,this.findSponsors=R,this.cacheHelperService=N,this.destroyRef=re,this.members=[],this.sponsorshipIsPossible=!1,this.selection=new _e(!0,[],!0,(xe,Bt)=>xe.member?.id===Bt.member?.id),this.cachedSubject=new ge(!0),this.searchString="",this.loading=!1,this.attrNames=[k.USER_DEF_PREFERRED_MAIL]}ngOnInit(){this.loading=!0,this.vo=this.entityStorageService.getEntity(),this.attrNames=this.attrNames.concat(this.storeService.getLoginAttributeNames()),this.setAuthRights(),this.findSponsorsAuth=this.findSponsors.findSponsorsAuth(this.vo),this.findSponsorsAuth?this.findSponsors.someSponsorExists(this.vo.id).subscribe(e=>{this.sponsorshipIsPossible=e,this.refresh()}):this.refresh(),this.cacheHelperService.refreshComponentCachedData().pipe(Ne(this.destroyRef)).subscribe(e=>{e===t.id&&this.refresh()})}setAuthRights(){this.createAuth=this.authResolver.isAuthorized("createSponsoredMember_Vo_String_Map<String_String>_String_User_LocalDate_policy",[this.vo,this.storeService.getPerunPrincipal().user]),this.generateAuth=this.authResolver.isAuthorized("createSponsoredMembers_Vo_String_List<String>_User_policy",[this.vo,this.storeService.getPerunPrincipal().user]),this.setSponsorshipAuth=this.authResolver.isAuthorized("setSponsorshipForMember_Member_User_LocalDate_policy",[this.vo,this.storeService.getPerunPrincipal().user]),this.members!==null&&this.members.length!==0&&(this.routeAuth=this.authResolver.isAuthorized("getMemberById_int_policy",[this.vo,this.members[0].member]))}onCreate(){let e=F();e.width="750px",e.data={entityId:this.vo.id,voId:this.vo.id,theme:"vo-theme"},this.dialog.open(xr,e).afterClosed().subscribe(i=>{i&&(this.loading=!0,this.authzResolver.getPerunPrincipal().subscribe(s=>{this.storeService.setPerunPrincipal(s),this.refresh()}))})}onGenerate(){let e=F();e.width="750px",e.data={voId:this.vo.id,theme:"vo-theme"},this.dialog.open(Dr,e).afterClosed().subscribe(i=>{i&&(this.loading=!0,this.authzResolver.getPerunPrincipal().subscribe(s=>{this.storeService.setPerunPrincipal(s),this.refresh()}))})}onSponsorExistingMember(){let e=F();e.width="750px",e.data={voId:this.vo.id,theme:"vo-theme",findSponsorsAuth:this.findSponsorsAuth},this.dialog.open(Rr,e).afterClosed().subscribe(i=>{i&&(this.loading=!0,this.authzResolver.getPerunPrincipal().subscribe(s=>{this.storeService.setPerunPrincipal(s),this.refresh()}))})}copySponsoredMembers(){let e=F();e.width="1000px",e.data={voId:this.vo.id,theme:"vo-theme",findSponsorsAuth:this.findSponsorsAuth},this.dialog.open(Pr,e).afterClosed().subscribe(i=>{i&&(this.loading=!0,this.authzResolver.getPerunPrincipal().subscribe(s=>{this.storeService.setPerunPrincipal(s),this.refresh()}))})}refresh(){this.loading=!0,this.membersManager.getSponsoredMembersAndTheirSponsors(this.vo.id,this.attrNames).subscribe(e=>{this.selection.clear(),this.cachedSubject.next(!0),this.members=e,this.setAuthRights(),this.loading=!1})}applyFilter(e){this.searchString=e,this.refresh()}static{this.\u0275fac=function(n){return new(n||t)(_(Qe),_(Ae),_(pe),_(Le),_(bn),_(He),_(si),_(Je),_(we))}}static{this.\u0275cmp=x({type:t,selectors:[["app-vo-settings-sponsored-members"]],hostVars:2,hostBindings:function(n,i){n&2&&Ee("router-component",i.true)},decls:19,vars:16,consts:[["menu","matMenu"],["spinner",""],[1,"page-subtitle"],[3,"refresh"],["matTooltipPosition","above",3,"matTooltip","matTooltipDisabled"],["data-cy","sponsor-dropdown-button","color","accent","mat-flat-button","",1,"me-2","dropdown-toggle",3,"disabled","matMenuTriggerFor"],["data-cy","sponsor-new-button","mat-menu-item","",1,"action-button"],["data-cy","sponsor-csv-button","mat-menu-item","",1,"action-button"],["data-cy","sponsor-existing-button","color","accent","mat-flat-button","",1,"me-2","action-button",3,"disabled"],["color","accent","mat-flat-button","",1,"me-2","action-button",3,"disabled"],[3,"filter","placeholder"],[1,"position-relative","table-min-height"],[3,"tableLoading","disableRouting","selection","cachedSubject","filterValue","sponsoredMembers","refreshTable",4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],["data-cy","sponsor-new-button","mat-menu-item","",1,"action-button",3,"click"],["data-cy","sponsor-csv-button","mat-menu-item","",1,"action-button",3,"click"],["data-cy","sponsor-existing-button","color","accent","mat-flat-button","",1,"me-2","action-button",3,"click","disabled"],["color","accent","mat-flat-button","",1,"me-2","action-button",3,"click","disabled"],[3,"refreshTable","tableLoading","disableRouting","selection","cachedSubject","filterValue","sponsoredMembers"]],template:function(n,i){if(n&1){let s=I();a(0,"div")(1,"h1",2),m(2),l(3,"translate"),r(),a(4,"perun-web-apps-refresh-button",3),C("refresh",function(){return f(s),g(i.refresh())}),r(),a(5,"span",4),l(6,"translate"),v(7,pf,3,5,"button",5),r(),a(8,"mat-menu",null,0),v(10,mf,3,3,"button",6),v(11,df,3,3,"button",7),r(),v(12,cf,3,4,"button",8),v(13,uf,3,4,"button",9),a(14,"perun-web-apps-debounce-filter",10),C("filter",function(M){return f(s),g(i.applyFilter(M))}),r(),T(15,_f,1,0,"ng-template",null,1,B),a(17,"div",11),T(18,hf,1,6,"app-sponsored-members-list",12),r()()}if(n&2){let s=y(16);o(2),E(p(3,12,"VO_DETAIL.SETTINGS.SPONSORED_MEMBERS.TITLE")),o(3),u("matTooltip",w(p(6,14,"VO_DETAIL.SETTINGS.SPONSORED_MEMBERS.NO_SPONSORS")))("matTooltipDisabled",!(i.findSponsorsAuth&&!i.sponsorshipIsPossible)),o(2),b(i.createAuth||i.generateAuth?7:-1),o(3),b(i.createAuth?10:-1),o(),b(i.generateAuth?11:-1),o(),b(i.setSponsorshipAuth?12:-1),o(),b(i.setSponsorshipAuth?13:-1),o(),u("placeholder","VO_DETAIL.SETTINGS.SPONSORED_MEMBERS.FILTER"),o(4),u("perunWebAppsLoader",i.loading)("perunWebAppsLoaderIndicator",s)}},dependencies:[D,P,G,ye,Ze,Yt,qt,zt,$t,L,ne,po,V,Ge,O],encapsulation:2})}}return t})();var GN=(()=>{class t{static{this.id="GroupRolesComponent"}constructor(e,n,i,s,S){this.authzResolverService=e,this.entityStorageService=n,this.roleService=i,this.cacheHelperService=s,this.destroyRef=S,this.roles=new Map}ngOnInit(){this.groupId=this.entityStorageService.getEntity().id,this.getData(),this.cacheHelperService.refreshComponentCachedData().pipe(Ne(this.destroyRef)).subscribe(e=>{e===t.id&&this.getData()})}getData(){this.outerLoading=!0,this.roles.clear(),this.authzResolverService.getGroupRoles(this.groupId).subscribe(e=>{let n=Object.keys(e).map(i=>i.toUpperCase());this.roles=this.roleService.prepareRoles(e,n),this.outerLoading=!1})}static{this.\u0275fac=function(n){return new(n||t)(_(bn),_(He),_(pa),_(Je),_(we))}}static{this.\u0275cmp=x({type:t,selectors:[["app-group-roles"]],hostVars:2,hostBindings:function(n,i){n&2&&Ee("router-component",i.true)},decls:1,vars:5,consts:[[3,"reload","startLoading","outerLoading","roles","entityId","entityType","showDescription"]],template:function(n,i){n&1&&(a(0,"app-perun-web-apps-roles-page",0),C("reload",function(){return i.getData()})("startLoading",function(){return i.outerLoading=!0}),r()),n&2&&u("outerLoading",i.outerLoading)("roles",i.roles)("entityId",i.groupId)("entityType","GROUP")("showDescription",!0)},dependencies:[D,er],encapsulation:2})}}return t})();export{tr as a,bg as b,$n as c,uC as d,Qn as e,ob as f,yr as g,Lr as h,Ei as i,dE as j,kE as k,mr as l,lA as m,EA as n,U2 as o,zx as p,MO as q,qO as r,h3 as s,W3 as t,HL as u,Rr as v,IN as w,GN as x};
