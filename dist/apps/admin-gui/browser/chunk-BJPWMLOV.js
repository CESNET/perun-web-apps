import{Aa as ke,Ac as qe,Ba as Ve,Ca as A,Cc as me,Da as m,Dc as D,Dd as O,Ea as l,Ec as R,Fh as ee,Ia as U,Id as $e,Ii as De,Ja as j,Jd as Ke,Ka as G,La as w,Ld as Je,Na as Q,Nd as ge,Oa as b,Oh as nt,Pa as P,Ph as rt,Qa as _,Qf as Z,Qh as st,Rd as Xe,Rh as at,S as d,Sh as ot,T as u,Tb as le,Ua as se,Va as ae,Ve as ye,Wa as oe,We as Ee,Xh as te,Ya as ce,Zb as de,_e as Ze,aa as s,ca as xe,cd as k,d as N,db as h,dd as V,eb as f,ef as et,fd as ze,ga as p,gd as Ye,ha as v,he as z,ie as Y,jb as x,jc as ue,jd as be,je as _e,kb as Le,kc as pe,kd as he,ke as $,ld as q,le as K,ma as S,md as fe,me as J,mh as Se,ne as X,nf as F,oc as H,pc as Be,qc as Pe,ra as I,rc as Ue,sa as M,sc as je,tc as Ge,ub as T,uc as Oe,uf as tt,vc as Fe,vf as it,wa as c,wc as We,xa as a,xc as Ne,xh as Ce,ya as o,yc as Qe,yd as L,za as E,zc as He}from"./chunk-6NXECROM.js";var ut=["list"];function pt(n,g){n&1&&(a(0,"perun-web-apps-alert",5),b(1),h(2,"translate"),o()),n&2&&(s(),_(" ",f(2,1,"DIALOGS.CREATE_ATTRIBUTE.ERROR_EMPTY_VALUE")," "))}function mt(n,g){n&1&&E(0,"perun-web-apps-loading-table")}function bt(n,g){if(n&1&&E(0,"perun-web-apps-attributes-list",12,1),n&2){let e=l();c("loading",e.loading)("emptyListText","SHARED_LIB.PERUN.COMPONENTS.ATTRIBUTES_LIST.EMPTY_ATTRIBUTES")("attributes",e.attributes)("filterValue",e.filterValue)("selection",e.selected)("cachedSubject",e.cachedSubject)}}var Me=(()=>{class n{constructor(e,t,i,r,y,C){this.dialogRef=e,this.data=t,this.attributesManager=i,this.notificator=r,this.translate=y,this.cd=C,this.attributes=[],this.selected=new H(!0,[],!0,(B,W)=>B.id===W.id),this.cachedSubject=new N(!0),this.showError=!1,this.filterValue="",this.translate.get("DIALOGS.CREATE_ATTRIBUTE.SUCCESS_SAVE").subscribe(B=>this.saveSuccessMessage=B)}ngOnInit(){let e=new Array;this.data.notEmptyAttributes.forEach(we=>{e.push(we.id)});let t,i,r,y,C,B,W,ie;switch(this.data.entity){case"member":t=this.data.entityId;break;case"user":i=this.data.entityId;break;case"vo":r=this.data.entityId;break;case"group":y=this.data.entityId;break;case"resource":C=this.data.entityId;break;case"facility":B=this.data.entityId;break;case"host":W=this.data.entityId;break;case"ues":ie=this.data.entityId;break}switch(this.data.secondEntity){case"member":t=this.data.secondEntityId;break;case"user":i=this.data.secondEntityId;break;case"vo":r=this.data.secondEntityId;break;case"group":y=this.data.secondEntityId;break;case"resource":C=this.data.secondEntityId;break;case"facility":B=this.data.secondEntityId;break;case"host":W=this.data.secondEntityId;break;case"ues":ie=this.data.secondEntityId;break}this.loading=!0,this.attributesManager.getAttributesDefinitionWithRights(t,i,r,y,C,B,W,ie).subscribe(we=>{this.attributes=we,this.attributes=this.attributes.filter(Re=>!e.includes(Re.id)&&this.twoEntityValid(Re)),this.loading=!1})}onCancel(){this.dialogRef.close()}onSave(){this.list.updateMapAttributes();let e=!1;for(let t of this.selected.selected)t.type==="java.util.ArrayList"&&t.value.length===0&&(e=!0),t.value===void 0&&(e=!0);if(e){this.showError=!0,setTimeout(()=>{this.showError=!1},5e3);return}switch(this.data.entity){case"facility":switch(this.data.secondEntity){case"user":this.attributesManager.setUserFacilityAttributes({facility:this.data.entityId,user:this.data.secondEntityId,attributes:this.selected.selected}).subscribe(()=>{this.handleSuccess()});break;default:this.attributesManager.setFacilityAttributes({facility:this.data.entityId,attributes:this.selected.selected}).subscribe(()=>{this.handleSuccess()});break}break;case"group":switch(this.data.secondEntity){case"resource":this.attributesManager.setGroupResourceAttributes({group:this.data.entityId,resource:this.data.secondEntityId,attributes:this.selected.selected}).subscribe(()=>{this.handleSuccess()});break;case"member":this.attributesManager.setMemberGroupAttributes({member:this.data.secondEntityId,group:this.data.entityId,attributes:this.selected.selected}).subscribe(()=>{this.handleSuccess()});break;default:this.attributesManager.setGroupAttributes({group:this.data.entityId,attributes:this.selected.selected}).subscribe(()=>{this.handleSuccess()})}break;case"member":switch(this.data.secondEntity){case"resource":this.attributesManager.setMemberResourceAttributes({member:this.data.entityId,resource:this.data.secondEntityId,attributes:this.selected.selected}).subscribe(()=>{this.handleSuccess()});break;case"group":this.attributesManager.setMemberGroupAttributes({member:this.data.entityId,group:this.data.secondEntityId,attributes:this.selected.selected}).subscribe(()=>{this.handleSuccess()});break;default:this.attributesManager.setMemberAttributes({member:this.data.entityId,attributes:this.selected.selected}).subscribe(()=>{this.handleSuccess()})}break;case"resource":switch(this.data.secondEntity){case"member":this.attributesManager.setMemberResourceAttributes({resource:this.data.entityId,member:this.data.secondEntityId,attributes:this.selected.selected}).subscribe(()=>{this.handleSuccess()});break;case"group":this.attributesManager.setGroupResourceAttributes({resource:this.data.entityId,group:this.data.secondEntityId,attributes:this.selected.selected}).subscribe(()=>{this.handleSuccess()});break;default:this.attributesManager.setResourceAttributes({resource:this.data.entityId,attributes:this.selected.selected}).subscribe(()=>{this.handleSuccess()})}break;case"user":switch(this.data.secondEntity){case"facility":this.attributesManager.setUserFacilityAttributes({user:this.data.entityId,facility:this.data.secondEntityId,attributes:this.selected.selected}).subscribe(()=>{this.handleSuccess()});break;default:this.attributesManager.setUserAttributes({user:this.data.entityId,attributes:this.selected.selected}).subscribe(()=>{this.handleSuccess()})}break;case"vo":this.attributesManager.setVoAttributes({vo:this.data.entityId,attributes:this.selected.selected}).subscribe(()=>{this.handleSuccess()});break;case"host":this.attributesManager.setHostAttributes({host:this.data.entityId,attributes:this.selected.selected}).subscribe(()=>{this.handleSuccess()});break;case"ues":this.attributesManager.setUserExtSourceAttributes({userExtSource:this.data.entityId,attributes:this.selected.selected}).subscribe(()=>{this.handleSuccess()});break}}applyFilter(e){this.filterValue=e,this.selected.clear(),this.cachedSubject.next(!0)}handleSuccess(){this.notificator.showSuccess(this.saveSuccessMessage),this.selected.clear(),this.dialogRef.close("saved"),this.cd.detectChanges()}twoEntityValid(e){return this.data.secondEntity?e.entity===`${this.data.entity}_${this.data.secondEntity}`||e.entity===`${this.data.secondEntity}_${this.data.entity}`:!0}static{this.\u0275fac=function(t){return new(t||n)(p(z),p(Y),p(O),p(Z),p(me),p(Le))}}static{this.\u0275cmp=v({type:n,selectors:[["app-create-attribute-dialog"]],viewQuery:function(t,i){if(t&1&&U(ut,5),t&2){let r;j(r=G())&&(i.list=r.first)}},decls:19,vars:16,consts:[["spinner",""],["list",""],["mat-dialog-title",""],[1,"page-subtitle"],["data-cy","filter-attributes",1,"font-size-1rem",3,"filter","placeholder"],["alert_type","error",1,"ms-3","font-size-1rem"],["mat-dialog-content",""],[1,"position-relative","table-min-height"],[3,"loading","emptyListText","attributes","filterValue","selection","cachedSubject",4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],["mat-dialog-actions",""],["mat-stroked-button","",1,"ms-auto",3,"click"],["color","accent","data-cy","save-selected-attributes","mat-flat-button","",1,"ms-2",3,"click","disabled"],[3,"loading","emptyListText","attributes","filterValue","selection","cachedSubject"]],template:function(t,i){if(t&1){let r=A();a(0,"div")(1,"div",2)(2,"h1",3),b(3),h(4,"translate"),o(),a(5,"perun-web-apps-debounce-filter",4),m("filter",function(C){return d(r),u(i.applyFilter(C))}),o(),I(6,pt,3,3,"perun-web-apps-alert",5),o(),a(7,"div",6),S(8,mt,1,0,"ng-template",null,0,x),a(10,"div",7),S(11,bt,2,6,"perun-web-apps-attributes-list",8),o()(),a(12,"div",9)(13,"button",10),m("click",function(){return d(r),u(i.onCancel())}),b(14),h(15,"translate"),o(),a(16,"button",11),m("click",function(){return d(r),u(i.onSave())}),b(17),h(18,"translate"),o()()()}if(t&2){let r=w(9);Q(i.data.style),s(3),P(f(4,10,"DIALOGS.CREATE_ATTRIBUTE.SET_NEW")),s(2),c("placeholder","SHARED_LIB.PERUN.COMPONENTS.ATTRIBUTES_LIST.FILTER"),s(),M(i.showError?6:-1),s(5),c("perunWebAppsLoader",i.loading)("perunWebAppsLoaderIndicator",r),s(3),_(" ",f(15,12,"DIALOGS.CREATE_ATTRIBUTE.CANCEL")," "),s(2),c("disabled",i.loading||i.selected.selected.length===0),s(),_(" ",f(18,14,"DIALOGS.CREATE_ATTRIBUTE.SAVE")," ")}},dependencies:[T,V,k,X,$,J,K,he,be,te,R,ee,L,q,D],styles:[".font-size-1rem[_ngcontent-%COMP%]{font-size:1rem!important}"]})}}return n})();function ht(n,g){n&1&&E(0,"perun-web-apps-loading-dialog")}function ft(n,g){n&1&&E(0,"th",14)}function gt(n,g){if(n&1&&(a(0,"td",15),b(1),o()),n&2){let e=g.$implicit;s(),P(e.displayName)}}function _t(n,g){n&1&&E(0,"tr",16)}function yt(n,g){n&1&&E(0,"tr",17)}function Et(n,g){if(n&1){let e=A();a(0,"div")(1,"h1",2),b(2),h(3,"translate"),o(),a(4,"div",3)(5,"div"),b(6),h(7,"translate"),o(),a(8,"div",4),b(9),h(10,"translate"),o(),a(11,"table",5),ke(12,6),S(13,ft,1,0,"th",7)(14,gt,2,1,"td",8),Ve(),S(15,_t,1,0,"tr",9)(16,yt,1,0,"tr",10),o()(),a(17,"div",11)(18,"button",12),m("click",function(){d(e);let i=l();return u(i.onCancel())}),b(19),h(20,"translate"),o(),a(21,"button",13),m("click",function(){d(e);let i=l();return u(i.onSubmit())}),b(22),h(23,"translate"),o()()()}if(n&2){let e=l();s(2),P(f(3,9,"DIALOGS.DELETE_ATTRIBUTES.TITLE")),s(4),_(" ",f(7,11,"DIALOGS.DELETE_ATTRIBUTES.DESCRIPTION")," "),s(3),_(" ",f(10,13,"DIALOGS.DELETE_ATTRIBUTES.ASK")," "),s(2),c("dataSource",e.dataSource),s(4),c("matHeaderRowDef",e.displayedColumns),s(),c("matRowDefColumns",e.displayedColumns),s(3),_(" ",f(20,15,"DIALOGS.DELETE_ATTRIBUTES.CANCEL")," "),s(2),c("disabled",e.loading),s(),_(" ",f(23,17,"DIALOGS.DELETE_ATTRIBUTES.DELETE")," ")}}var Te=(()=>{class n{constructor(e,t,i,r,y){this.dialogRef=e,this.data=t,this.notificator=i,this.translate=r,this.attributesManager=y,this.displayedColumns=["name"],this.loading=!1}ngOnInit(){this.dataSource=new qe(this.data.attributes),this.theme=this.data.theme}onCancel(){this.dialogRef.close(!1)}onSubmit(){let e=[];for(let i of this.data.attributes)e.push(i.id);let t={};switch(t[this.data.entity]=this.data.entityId,t.attributes=e,this.data.secondEntity!==void 0&&(t[this.data.secondEntity]=this.data.secondEntityId),this.loading=!0,this.data.entity){case"vo":this.attributesManager.removeVoAttributes(this.data.entityId,e).subscribe({next:()=>{this.onSuccess()},error:()=>this.loading=!1});break;case"group":switch(this.data.secondEntity){case"resource":this.attributesManager.removeGroupResourceAttributes(this.data.entityId,this.data.secondEntityId,e).subscribe({next:()=>{this.onSuccess()},error:()=>this.loading=!1});break;case"member":this.attributesManager.removeMemberGroupAttributes(this.data.secondEntityId,this.data.entityId,e).subscribe({next:()=>{this.onSuccess()},error:()=>this.loading=!1});break;default:this.attributesManager.removeGroupAttributes(this.data.entityId,e).subscribe({next:()=>{this.onSuccess()},error:()=>this.loading=!1})}break;case"user":switch(this.data.secondEntity){case"facility":this.attributesManager.removeUserFacilityAttributes(this.data.entityId,this.data.secondEntityId,e).subscribe({next:()=>{this.onSuccess()},error:()=>this.loading=!1});break;default:this.attributesManager.removeUserAttributes(this.data.entityId,e).subscribe({next:()=>{this.onSuccess()},error:()=>this.loading=!1})}break;case"member":switch(this.data.secondEntity){case"resource":this.attributesManager.removeMemberResourceAttributes(this.data.entityId,this.data.secondEntityId,e).subscribe({next:()=>{this.onSuccess()},error:()=>this.loading=!1});break;case"group":this.attributesManager.removeMemberGroupAttributes(this.data.entityId,this.data.secondEntityId,e).subscribe({next:()=>{this.onSuccess()},error:()=>this.loading=!1});break;default:this.attributesManager.removeMemberAttributes(this.data.entityId,e).subscribe({next:()=>{this.onSuccess()},error:()=>this.loading=!1})}break;case"facility":switch(this.data.secondEntity){case"user":this.attributesManager.removeUserFacilityAttributes(this.data.secondEntityId,this.data.entityId,e).subscribe({next:()=>{this.onSuccess()},error:()=>this.loading=!1});break;default:this.attributesManager.removeFacilityAttributes(this.data.entityId,e).subscribe({next:()=>{this.onSuccess()},error:()=>this.loading=!1})}break;case"host":this.attributesManager.removeHostAttributes(this.data.entityId,e).subscribe({next:()=>{this.onSuccess()},error:()=>this.loading=!1});break;case"ues":this.attributesManager.removeUesAttributes(this.data.entityId,e).subscribe({next:()=>{this.onSuccess()},error:()=>this.loading=!1});break;case"resource":switch(this.data.secondEntity){case"member":this.attributesManager.removeMemberResourceAttributes(this.data.secondEntityId,this.data.entityId,e).subscribe({next:()=>{this.onSuccess()},error:()=>this.loading=!1});break;case"group":this.attributesManager.removeGroupResourceAttributes(this.data.secondEntityId,this.data.entityId,e).subscribe({next:()=>{this.onSuccess()},error:()=>this.loading=!1});break;default:this.attributesManager.removeResourceAttributes(this.data.entityId,e).subscribe({next:()=>{this.onSuccess()},error:()=>this.loading=!1})}break}}onSuccess(){this.translate.get("DIALOGS.DELETE_ATTRIBUTES.SUCCESS").subscribe(e=>{this.notificator.showSuccess(e),this.dialogRef.close(!0)})}static{this.\u0275fac=function(t){return new(t||n)(p(z),p(Y),p(Z),p(me),p(O))}}static{this.\u0275cmp=v({type:n,selectors:[["app-delete-attribute-dialog"]],decls:4,vars:5,consts:[["spinner",""],[4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],["mat-dialog-title",""],["mat-dialog-content",""],[1,"fw-bold"],["mat-table","",1,"w-100",3,"dataSource"],["matColumnDef","name"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["class","font-weight-bolder","mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["mat-dialog-actions",""],["mat-stroked-button","",1,"ms-auto",3,"click"],["color","warn","data-cy","delete-attributes","mat-flat-button","",1,"ms-2",3,"click","disabled"],["mat-header-cell",""],["mat-cell",""],["mat-header-row","",1,"font-weight-bolder"],["mat-row",""]],template:function(t,i){if(t&1&&(S(0,ht,1,0,"ng-template",null,0,x),a(2,"div"),S(3,Et,24,19,"div",1),o()),t&2){let r=w(1);s(2),Q(ce("",i.theme," position-relative")),s(),c("perunWebAppsLoader",i.loading)("perunWebAppsLoaderIndicator",r)}},dependencies:[T,V,k,X,$,J,K,fe,He,Be,Ue,Fe,je,Pe,We,Ge,Oe,Ne,Qe,R,L,D],encapsulation:2})}}return n})();var At=["list"];function vt(n,g){n&1&&E(0,"perun-web-apps-loading-table")}function It(n,g){if(n&1&&E(0,"perun-web-apps-attributes-list",10,1),n&2){let e=l();c("loading",e.loading)("attributes",e.attributes)("filterValue",e.filterValue)("filterEmpty",e.filterEmpty)("selection",e.selection)("cachedSubject",e.cachedSubject)}}var Li=(()=>{class n{constructor(e,t){this.attributesManagerService=e,this.dialog=t,this.attributes=[],this.selection=new H(!0,[],!0,(i,r)=>i.id===r.id),this.cachedSubject=new N(!0),this.filterValue="",this.filterEmpty=!0,this.loading=!1}ngOnInit(){this.refreshTable()}refreshTable(){switch(this.loading=!0,this.entity){case"member":this.attributesManagerService.getMemberAttributes(this.entityId).subscribe(e=>{this.attributes=e,this.selection.clear(),this.cachedSubject.next(!0),this.loading=!1});break;case"group":this.attributesManagerService.getGroupAttributes(this.entityId).subscribe(e=>{this.attributes=e,this.selection.clear(),this.cachedSubject.next(!0),this.loading=!1});break;case"user":this.attributesManagerService.getUserAttributes(this.entityId).subscribe(e=>{this.attributes=e,this.selection.clear(),this.cachedSubject.next(!0),this.loading=!1});break;case"resource":this.attributesManagerService.getResourceAttributes(this.entityId).subscribe(e=>{this.attributes=e,this.selection.clear(),this.cachedSubject.next(!0),this.loading=!1});break;case"facility":this.attributesManagerService.getFacilityAttributes(this.entityId).subscribe(e=>{this.attributes=e,this.selection.clear(),this.cachedSubject.next(!0),this.loading=!1});break;case"vo":this.attributesManagerService.getVoAttributes(this.entityId).subscribe(e=>{this.attributes=e,this.selection.clear(),this.cachedSubject.next(!0),this.loading=!1});break;case"host":this.attributesManagerService.getHostAttributes(this.entityId).subscribe(e=>{this.attributes=e,this.selection.clear(),this.cachedSubject.next(!0),this.loading=!1})}}applyFilter(e){this.filterValue=e,this.refreshTable()}onCreate(){let e=F();e.width="1050px",e.data={entityId:this.entityId,entity:this.entity,notEmptyAttributes:this.attributes,style:this.entity+"-theme"},this.dialog.open(Me,e).afterClosed().subscribe(i=>{i&&this.refreshTable()})}onSave(){this.list.updateMapAttributes();let e=F();e.width="450px",e.data={entityId:this.entityId,entity:this.entity,attributes:this.selection.selected},this.dialog.open(Se,e).afterClosed().subscribe(i=>{i&&this.refreshTable()})}onDelete(){let e=F();e.width="450px",e.data={entityId:this.entityId,entity:this.entity,attributes:this.selection.selected},this.dialog.open(Te,e).afterClosed().subscribe(i=>{i&&this.refreshTable()})}static{this.\u0275fac=function(t){return new(t||n)(p(O),p(_e))}}static{this.\u0275cmp=v({type:n,selectors:[["app-one-entity-attribute-page"]],viewQuery:function(t,i){if(t&1&&U(At,5),t&2){let r;j(r=G())&&(i.list=r.first)}},inputs:{entity:"entity",entityId:"entityId"},decls:18,vars:18,consts:[["spinner",""],["list",""],[3,"refresh"],["color","accent","data-cy","add-attributes","mat-flat-button","",1,"me-2","action-button",3,"click"],["color","accent","mat-flat-button","",1,"me-2",3,"click","disabled"],["color","warn","data-cy","remove-attributes","mat-flat-button","",1,"me-2",3,"click","disabled"],[1,"me-2",3,"filter","placeholder"],["labelPosition","before",3,"ngModelChange","ngModel"],[1,"position-relative","table-min-height"],[3,"loading","attributes","filterValue","filterEmpty","selection","cachedSubject",4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],[3,"loading","attributes","filterValue","filterEmpty","selection","cachedSubject"]],template:function(t,i){if(t&1){let r=A();a(0,"perun-web-apps-refresh-button",2),m("refresh",function(){return d(r),u(i.refreshTable())}),o(),a(1,"button",3),m("click",function(){return d(r),u(i.onCreate())}),b(2),h(3,"translate"),o(),a(4,"button",4),m("click",function(){return d(r),u(i.onSave())}),b(5),h(6,"translate"),o(),a(7,"button",5),m("click",function(){return d(r),u(i.onDelete())}),b(8),h(9,"translate"),o(),a(10,"perun-web-apps-debounce-filter",6),m("filter",function(C){return d(r),u(i.applyFilter(C))}),o(),a(11,"mat-slide-toggle",7),oe("ngModelChange",function(C){return d(r),ae(i.filterEmpty,C)||(i.filterEmpty=C),u(C)}),b(12),h(13,"translate"),o(),S(14,vt,1,0,"ng-template",null,0,x),a(16,"div",8),S(17,It,2,6,"perun-web-apps-attributes-list",9),o()}if(t&2){let r=w(15);s(2),_(" ",f(3,10,"ATTRIBUTE_PAGE.CREATE"),`
`),s(2),c("disabled",i.loading||i.selection.selected.length===0),s(),_(" ",f(6,12,"ATTRIBUTE_PAGE.SAVE"),`
`),s(2),c("disabled",i.loading||i.selection.selected.length===0),s(),_(" ",f(9,14,"ATTRIBUTE_PAGE.DELETE"),`
`),s(2),c("placeholder","ATTRIBUTE_PAGE.FILTER"),s(),se("ngModel",i.filterEmpty),s(),_(" ",f(13,16,"ATTRIBUTE_PAGE.FILTER_EMPTY"),`
`),s(5),c("perunWebAppsLoader",i.loading)("perunWebAppsLoaderIndicator",r)}},dependencies:[T,V,k,Ee,ye,ue,le,de,pe,te,Ce,R,ee,L,q,D],encapsulation:2})}}return n})();var Mt=["list"];function Tt(n,g){n&1&&E(0,"mat-spinner",3)}function wt(n,g){if(n&1&&(a(0,"perun-web-apps-alert",4),b(1),o()),n&2){let e=l();s(),P(e.noEntityMessage)}}function xt(n,g){if(n&1){let e=A();a(0,"perun-web-apps-group-search-select",19),m("groupSelected",function(i){d(e);let r=l(3);return u(r.specifySecondEntity(i))}),o()}if(n&2){let e=l(3);c("firstSelectedGroup",e.specificSecondEntity)("displayStatus",!0)("groups",e.entityValues)}}function Dt(n,g){if(n&1){let e=A();a(0,"perun-web-apps-resource-search-select",20),m("resourceSelected",function(i){d(e);let r=l(3);return u(r.specifySecondEntity(i))}),o()}if(n&2){let e=l(3);c("resources",e.entityValues)}}function Rt(n,g){if(n&1){let e=A();a(0,"perun-web-apps-member-search-select",21),m("memberSelected",function(i){d(e);let r=l(3);return u(r.specifySecondEntity(i))}),o()}if(n&2){let e=l(3);c("members",e.entityValues)}}function kt(n,g){if(n&1){let e=A();a(0,"perun-web-apps-facility-search-select",22),m("facilitySelected",function(i){d(e);let r=l(3);return u(r.specifySecondEntity(i))}),o()}if(n&2){let e=l(3);c("facilities",e.entityValues)}}function Vt(n,g){if(n&1){let e=A();a(0,"perun-web-apps-user-search-select",23),m("userSelected",function(i){d(e);let r=l(3);return u(r.specifySecondEntity(i))}),o()}if(n&2){let e=l(3);c("users",e.entityValues)}}function Lt(n,g){if(n&1&&(a(0,"div",5),I(1,xt,1,3,"perun-web-apps-group-search-select",14),I(2,Dt,1,1,"perun-web-apps-resource-search-select",15),I(3,Rt,1,1,"perun-web-apps-member-search-select",16),I(4,kt,1,1,"perun-web-apps-facility-search-select",17),I(5,Vt,1,1,"perun-web-apps-user-search-select",18),o()),n&2){let e=l(2);s(),M(e.secondEntity==="group"?1:-1),s(),M(e.secondEntity==="resource"?2:-1),s(),M(e.secondEntity==="member"?3:-1),s(),M(e.secondEntity==="facility"?4:-1),s(),M(e.secondEntity==="user"?5:-1)}}function Bt(n,g){n&1&&E(0,"perun-web-apps-loading-table")}function Pt(n,g){if(n&1&&E(0,"perun-web-apps-attributes-list",24,1),n&2){let e=l(2);c("loading",e.innerLoading)("attributes",e.attributes)("filterValue",e.filterValue)("filterEmpty",e.filterEmpty)("selection",e.selection)("cachedSubject",e.cachedSubject)}}function Ut(n,g){if(n&1){let e=A();a(0,"div"),I(1,Lt,6,5,"div",5),a(2,"perun-web-apps-refresh-button",6),m("refresh",function(){d(e);let i=l();return u(i.getAttributes(i.specificSecondEntity.id))}),o(),a(3,"button",7),m("click",function(){d(e);let i=l();return u(i.onAdd(i.specificSecondEntity.id))}),b(4),h(5,"translate"),o(),a(6,"button",8),m("click",function(){d(e);let i=l();return u(i.onSave(i.specificSecondEntity.id))}),b(7),h(8,"translate"),o(),a(9,"button",9),m("click",function(){d(e);let i=l();return u(i.onDelete(i.specificSecondEntity.id))}),b(10),h(11,"translate"),o(),a(12,"perun-web-apps-debounce-filter",10),m("filter",function(i){d(e);let r=l();return u(r.applyFilter(i))}),o(),a(13,"mat-slide-toggle",11),oe("ngModelChange",function(i){d(e);let r=l();return ae(r.filterEmpty,i)||(r.filterEmpty=i),u(i)}),b(14),h(15,"translate"),o(),S(16,Bt,1,0,"ng-template",null,0,x),a(18,"div",12),S(19,Pt,2,6,"perun-web-apps-attributes-list",13),o()()}if(n&2){let e=w(17),t=l();s(),M(t.showSelect?1:-1),s(3),_(" ",f(5,11,"ATTRIBUTE_PAGE.CREATE")," "),s(2),c("disabled",t.loading||t.selection.selected.length===0),s(),_(" ",f(8,13,"ATTRIBUTE_PAGE.SAVE")," "),s(2),c("disabled",t.loading||t.selection.selected.length===0),s(),_(" ",f(11,15,"ATTRIBUTE_PAGE.DELETE")," "),s(2),c("placeholder","ATTRIBUTE_PAGE.FILTER"),s(),se("ngModel",t.filterEmpty),s(),_(" ",f(15,17,"ATTRIBUTE_PAGE.FILTER_EMPTY")," "),s(5),c("perunWebAppsLoader",t.innerLoading)("perunWebAppsLoaderIndicator",e)}}var pn=(()=>{class n{constructor(e,t,i,r,y,C,B){this.attributesManagerService=e,this.resourcesManagerService=t,this.facilitiesManagerService=i,this.groupsManagerService=r,this.membersManager=y,this.usersManager=C,this.dialog=B,this.specificSecondEntity=null,this.entityValues=[],this.attributes=[],this.selection=new H(!0,[],!0,(W,ie)=>W.id===ie.id),this.cachedSubject=new N(!0),this.allowedStatuses=["INVALID","VALID"],this.loading=!1,this.innerLoading=!1,this.filterValue="",this.filterEmpty=!0,this.showSelect=!0}ngOnInit(){this.showSelect=this.specificSecondEntity===null,this.loadEntityValues(),this.setMessages(this.secondEntity.toLowerCase())}loadEntityValues(){switch(this.loading=!0,this.firstEntity){case"member":switch(this.secondEntity){case"resource":this.resourcesManagerService.getAssignedResourcesWithStatus(this.firstEntityId).subscribe(e=>{this.entityValues=e.map(t=>t.enrichedResource.resource),this.preselectEntity(),this.loading=!1});break;case"group":this.groupsManagerService.getMemberGroups(this.firstEntityId).subscribe(e=>{this.entityValues=e,this.preselectEntity(),this.loading=!1})}break;case"group":switch(this.secondEntity){case"resource":this.resourcesManagerService.getResourceAssignments(this.firstEntityId).subscribe(e=>{this.entityValues=e.map(t=>{let i=t.enrichedResource.resource;return i.status=t.status,i}),this.preselectEntity(),this.loading=!1});break;case"member":this.membersManager.getCompleteRichMembersForGroup(this.firstEntityId,!1,this.allowedStatuses,null,[Ze.MEMBER_CORE_ID]).subscribe(e=>{this.entityValues=e,this.preselectEntity(),this.loading=!1});break}break;case"user":switch(this.secondEntity){case"resource":this.usersManager.getAssociatedResourcesForUser(this.facilityId,this.firstEntityId).subscribe(e=>{this.entityValues=e,this.preselectEntity(),this.loading=!1});break;default:this.facilitiesManagerService.getAssignedFacilitiesByUser(this.firstEntityId).subscribe(e=>{this.entityValues=e,this.preselectEntity(),this.loading=!1});break}break;case"resource":switch(this.secondEntity){case"member":this.resourcesManagerService.getAssignedMembersWithStatus(this.firstEntityId).subscribe(e=>{this.entityValues=e.map(t=>t.richMember),this.preselectEntity(),this.loading=!1});break;case"group":this.resourcesManagerService.getGroupAssignments(this.firstEntityId).subscribe(e=>{this.entityValues=e.map(t=>{let i=t.enrichedGroup.group;return i.status=t.status,i}),this.preselectEntity(),this.loading=!1});break}break;case"facility":this.facilitiesManagerService.getAssignedUsers(this.firstEntityId).subscribe(e=>{this.entityValues=e,this.preselectEntity(),this.loading=!1});break}}preselectEntity(){this.specificSecondEntity!==null?this.specifySecondEntity(this.specificSecondEntity):this.entityValues.length!==0&&this.findInitiallySelectedEntity()}findInitiallySelectedEntity(){let e=this.secondEntity==="member"||this.secondEntity==="user"?this.entityValues.sort(it)[0]:this.entityValues.sort(tt)[0],t=et(this.entityKey());if(t){for(let i of this.entityValues)if(i.id===t[0]){e=i;break}}this.specifySecondEntity(e)}entityKey(){switch(this.secondEntity){case"group":return"groups";default:return""}}getAttributes(e){switch(this.innerLoading=!0,this.selection.clear(),this.cachedSubject.next(!0),this.firstEntity){case"member":switch(this.secondEntity){case"resource":this.attributesManagerService.getMemberResourceAttributes(this.firstEntityId,e).subscribe(t=>{this.attributes=t,this.innerLoading=!1});break;case"group":this.attributesManagerService.getMemberGroupAttributes(this.firstEntityId,e).subscribe(t=>{this.attributes=t,this.innerLoading=!1})}break;case"group":switch(this.secondEntity){case"resource":this.attributesManagerService.getGroupResourceAttributes(this.firstEntityId,e).subscribe(t=>{this.attributes=t,this.innerLoading=!1});break;case"member":this.attributesManagerService.getMemberGroupAttributes(e,this.firstEntityId).subscribe(t=>{this.attributes=t,this.innerLoading=!1});break}break;case"user":switch(this.secondEntity){case"resource":this.membersManager.getMemberByUser(this.specificSecondEntity.voId,this.firstEntityId).subscribe(t=>{this.attributesManagerService.getMemberResourceAttributes(t.id,e).subscribe(i=>{this.attributes=i,this.innerLoading=!1})});break;default:this.attributesManagerService.getUserFacilityAttributes(this.firstEntityId,e).subscribe(t=>{this.attributes=t,this.innerLoading=!1});break}break;case"resource":switch(this.secondEntity){case"member":this.attributesManagerService.getMemberResourceAttributes(e,this.firstEntityId).subscribe(t=>{this.attributes=t,this.innerLoading=!1});break;case"group":this.attributesManagerService.getGroupResourceAttributes(e,this.firstEntityId).subscribe(t=>{this.attributes=t,this.innerLoading=!1});break}break;case"facility":this.attributesManagerService.getUserFacilityAttributes(e,this.firstEntityId).subscribe(t=>{this.attributes=t,this.innerLoading=!1});break}}setMessages(e){this.noEntityMessage=`No ${e} assigned`}onSave(e){this.list.updateMapAttributes();let t=F();t.width="450px",t.data={entityId:this.firstEntityId,entity:this.firstEntity,secondEntity:this.secondEntity,secondEntityId:e,attributes:this.selection.selected},this.dialog.open(Se,t).afterClosed().subscribe(r=>{r&&(this.selection.clear(),this.cachedSubject.next(!0),this.getAttributes(e))})}onDelete(e){let t=F();t.width="450px",t.data={entityId:this.firstEntityId,entity:this.firstEntity,secondEntity:this.secondEntity,secondEntityId:e,attributes:this.selection.selected,theme:`${this.firstEntity}-theme`},this.dialog.open(Te,t).afterClosed().subscribe(r=>{r&&(this.selection.clear(),this.cachedSubject.next(!0),this.getAttributes(e))})}onAdd(e){let t=F();t.width="1050px",t.data={entityId:this.firstEntityId,entity:this.firstEntity,secondEntity:this.secondEntity,secondEntityId:e,notEmptyAttributes:this.attributes,style:`${this.firstEntity}-theme`},this.dialog.open(Me,t).afterClosed().subscribe(r=>{r&&(this.selection.clear(),this.cachedSubject.next(!0),this.getAttributes(e))})}specifySecondEntity(e){e&&(this.specificSecondEntity=e,this.getAttributes(this.specificSecondEntity.id))}applyFilter(e){this.filterValue=e}static{this.\u0275fac=function(t){return new(t||n)(p(O),p(ge),p($e),p(Ke),p(Je),p(Xe),p(_e))}}static{this.\u0275cmp=v({type:n,selectors:[["app-two-entity-attribute-page"]],viewQuery:function(t,i){if(t&1&&U(Mt,5),t&2){let r;j(r=G())&&(i.list=r.first)}},inputs:{firstEntityId:"firstEntityId",firstEntity:"firstEntity",secondEntity:"secondEntity",specificSecondEntity:"specificSecondEntity",facilityId:"facilityId"},decls:4,vars:3,consts:[["spinner",""],["list",""],[1,"mt-3"],[1,"ms-auto","me-auto"],["alert_type","warn"],[1,"flex-row"],[3,"refresh"],["color","accent","mat-flat-button","",1,"me-2","action-button",3,"click"],["color","accent","mat-flat-button","",1,"me-2",3,"click","disabled"],["color","warn","mat-flat-button","",1,"me-2",3,"click","disabled"],[1,"me-2",3,"filter","placeholder"],["labelPosition","before",3,"ngModelChange","ngModel"],[1,"position-relative","table-min-height"],[3,"loading","attributes","filterValue","filterEmpty","selection","cachedSubject",4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],[3,"firstSelectedGroup","displayStatus","groups"],[3,"resources"],[3,"members"],[3,"facilities"],[3,"users"],[3,"groupSelected","firstSelectedGroup","displayStatus","groups"],[3,"resourceSelected","resources"],[3,"memberSelected","members"],[3,"facilitySelected","facilities"],[3,"userSelected","users"],[3,"loading","attributes","filterValue","filterEmpty","selection","cachedSubject"]],template:function(t,i){t&1&&(a(0,"div",2),I(1,Tt,1,0,"mat-spinner",3),I(2,wt,2,1,"perun-web-apps-alert",4),I(3,Ut,20,19,"div"),o()),t&2&&(s(),M(i.loading?1:-1),s(),M(i.entityValues.length===0&&!i.loading?2:-1),s(),M(i.entityValues.length!==0?3:-1))},dependencies:[T,V,k,Ee,ye,ue,le,de,pe,he,be,te,Ce,Ye,ze,R,nt,at,L,ot,ee,rt,st,q,D],styles:[".w-35[_ngcontent-%COMP%]{width:35%}"]})}}return n})();function jt(n,g){n&1&&E(0,"perun-web-apps-loading-dialog")}function Gt(n,g){if(n&1){let e=A();a(0,"div")(1,"h1",2),b(2),h(3,"translate"),o(),a(4,"div",3),E(5,"perun-web-apps-ban-specification",4),o(),a(6,"div",5)(7,"button",6),m("click",function(){d(e);let i=l();return u(i.cancelled.emit())}),b(8),h(9,"translate"),o(),a(10,"button",7),m("click",function(){d(e);let i=l();return u(i.updateBan())}),b(11),h(12,"translate"),o()()()}if(n&2){let e=l();s(2),P(f(3,5,"DIALOGS.UPDATE_BAN.TITLE")),s(3),c("description",e.ban.description)("validity",e.ban.validityTo),s(3),_(" ",f(9,7,"DIALOGS.UPDATE_BAN.CANCEL")," "),s(3),_(" ",f(12,9,"DIALOGS.UPDATE_BAN.UPDATE")," ")}}var lt=(()=>{class n{constructor(){this.loading=!1,this.cancelled=new xe,this.update=new xe}updateBan(){this.update.emit({description:this.banForm.getDescription(),validity:this.banForm.getValidity()})}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275cmp=v({type:n,selectors:[["app-update-ban-dialog"]],viewQuery:function(t,i){if(t&1&&U(De,5),t&2){let r;j(r=G())&&(i.banForm=r.first)}},inputs:{loading:"loading",ban:"ban",theme:"theme"},outputs:{cancelled:"cancelled",update:"update"},decls:4,vars:5,consts:[["spinner",""],[4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],["mat-dialog-title",""],["mat-dialog-content",""],[3,"description","validity"],["mat-dialog-actions",""],["mat-stroked-button","",1,"ms-auto","me-2",3,"click"],["mat-flat-button","","color","accent",3,"click"]],template:function(t,i){if(t&1&&(S(0,jt,1,0,"ng-template",null,0,x),a(2,"div"),S(3,Gt,13,11,"div",1),o()),t&2){let r=w(1);s(2),Q(ce("",i.theme," position-relative")),s(),c("perunWebAppsLoader",i.loading)("perunWebAppsLoaderIndicator",r)}},dependencies:[T,V,k,X,$,J,K,fe,R,De,L,D],encapsulation:2})}}return n})();var Bn=(()=>{class n{constructor(e,t,i,r){this.data=e,this.dialogRef=t,this.resourceService=i,this.notificator=r,this.loading=!1}update(e){this.loading=!0,this.resourceService.updateResourceBan({banOnResource:{id:this.data.ban.id,beanName:"BanOnFacility",resourceId:this.data.ban.resourceId,memberId:this.data.ban.memberId,description:e.description,validityTo:e.validity}}).subscribe({next:()=>{this.notificator.showSuccess("DIALOGS.UPDATE_BAN.SUCCESS"),this.dialogRef.close(!0)},error:()=>{this.loading=!1}})}cancel(){this.dialogRef.close(!1)}static{this.\u0275fac=function(t){return new(t||n)(p(Y),p(z),p(ge),p(Z))}}static{this.\u0275cmp=v({type:n,selectors:[["app-update-resource-ban-dialog"]],decls:1,vars:3,consts:[[3,"cancelled","update","ban","theme","loading"]],template:function(t,i){t&1&&(a(0,"app-update-ban-dialog",0),m("cancelled",function(){return i.cancel()})("update",function(y){return i.update(y)}),o()),t&2&&c("ban",i.data.ban)("theme","facility-theme")("loading",i.loading)},dependencies:[T,lt],encapsulation:2})}}return n})();export{Me as a,Te as b,Li as c,pn as d,lt as e,Bn as f};
