import{$ as w,$b as De,Aa as g,Ae as He,B as Fe,Ba as A,Bb as Re,Ca as C,Cc as ee,Cf as ze,Db as L,Hh as st,Hj as at,Ib as Ee,Ih as se,Ja as K,Jf as O,Jg as Je,Jh as ot,K as T,Ka as le,Kb as J,Mb as Le,Na as m,Nc as Me,O as S,Oa as _,P as b,Pa as ce,Qc as Ve,Qi as nt,Ra as E,Re as ke,Sc as Oe,Sj as lt,Tf as P,Tj as ct,Uc as Pe,Uf as $e,Vb as x,Xa as Z,Xb as xe,Y as n,Ya as W,Ye as k,Yf as qe,Z as p,Za as Te,Zd as re,_ as q,_a as we,_b as D,_d as je,ae as Ue,cf as Ye,ch as Xe,d as N,da as v,dh as Qe,di as U,ef as V,eh as et,fh as tt,ga as c,gc as X,gg as Ke,ha as G,hh as B,i as ye,ie as Ne,ka as a,la as l,lc as Q,ld as te,m as Ce,ma as y,od as ie,pa as F,pe,qa as u,qd as Be,ra as f,rg as Ze,se as Ge,ua as ae,uh as it,vc as H,wh as rt,x as Ae,xe as M,y as Ie,za as R,ze as We,zh as j}from"./chunk-L2Q74ABV.js";var dt=s=>[s];function gt(s,o){if(s&1){let t=F();a(0,"button",12),u("click",function(){S(t);let r=f();return b(r.onDelete())}),m(1,"isAuthorized"),g(2),m(3,"translate"),l()}if(s&2){let t=f();c("disabled",t.loading||t.selection.selected.length===0||!ce(1,2,le(7,dt,t.selection.selected[0]==null?null:t.selection.selected[0].facility),"deleteFacility_Facility_Boolean_policy")),n(2),C(" ",_(3,5,"FACILITY_MANAGEMENT.DELETE")," ")}}function vt(s,o){s&1&&y(0,"perun-web-apps-loading-table")}function St(s,o){if(s&1&&y(0,"perun-web-apps-facilities-list",13),s&2){let t=f();c("tableId",t.tableId)("selection",t.selection)("cachedSubject",t.cachedSubject)("loading",t.loading)("filterValue",t.filterValue)("facilities",t.facilities)("recentIds",t.recentIds)}}var bt=()=>({color:"black"}),oi=(()=>{let o=class o{constructor(e,r,i,d,h,I){this.facilityManager=e,this.sideMenuService=r,this.guiAuthResolver=i,this.dialog=d,this.cacheHelperService=h,this.destroyRef=I,this.facilities=[],this.recentIds=[],this.filterValue="",this.tableId=Ke,this.selection=new X(!1,[],!0,(Y,z)=>Y.facility.id===z.facility.id),this.cachedSubject=new N(!0)}ngOnInit(){this.createAuth=this.guiAuthResolver.isAuthorized("createFacility_Facility_policy",[]),this.deleteAuth=this.guiAuthResolver.isFacilityAdmin(),this.refreshTable(),this.cacheHelperService.refreshComponentCachedData().pipe(P(this.destroyRef)).subscribe(e=>{e===o.id&&this.refreshTable()})}ngAfterViewChecked(){this.sideMenuService.setFacilityMenuItems([])}refreshTable(){this.loading=!0,this.facilityManager.getEnrichedFacilities().subscribe(e=>{this.selection.clear(),this.cachedSubject.next(!0),this.facilities=e,this.recentIds=Ge("facilities"),this.loading=!1})}onCreate(){let e=M();e.width="800px",e.data={theme:"facility-theme"},this.dialog.open(lt,e).afterClosed().subscribe(i=>{i&&(this.loading=!0,this.refreshTable())})}onDelete(){let e=M();e.width="500px",e.data={theme:"facility-theme",facility:this.selection.selected[0].facility},this.dialog.open(ct,e).afterClosed().subscribe(i=>{i&&this.refreshTable()})}applyFilter(e){this.filterValue=e,this.refreshTable()}};o.id="FacilitySelectPageComponent",o.\u0275fac=function(r){return new(r||o)(p(L),p(Ye),p(D),p(H),p(U),p(w))},o.\u0275cmp=T({type:o,selectors:[["app-facility-select-page"]],hostVars:2,hostBindings:function(r,i){r&2&&G("router-component",i.true)},decls:21,vars:29,consts:[[1,"container-fluid","ps-xl-5","pe-xl-5","facility-theme"],[1,"page-title","d-flex"],["svgIcon","perun-facility-black",1,"perun-icon","icon-scale",3,"ngStyle"],[3,"refresh"],["matTooltipPosition","below",3,"matTooltipDisabled","matTooltip"],["mat-flat-button","","data-cy","new-facility-button","color","accent",1,"action-button","me-2",3,"disabled","click"],[3,"matTooltipDisabled","matTooltipPosition","matTooltip"],["mat-flat-button","","class","me-2","data-cy","delete-facility-button","color","warn",3,"disabled","click",4,"ngIf"],[3,"autoFocus","placeholder","linkGlobalSearch","filter"],["spinner",""],[1,"position-relative","table-min-height"],[3,"tableId","selection","cachedSubject","loading","filterValue","facilities","recentIds",4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],["mat-flat-button","","data-cy","delete-facility-button","color","warn",1,"me-2",3,"disabled","click"],[3,"tableId","selection","cachedSubject","loading","filterValue","facilities","recentIds"]],template:function(r,i){if(r&1&&(a(0,"div",0),y(1,"perun-web-apps-back-button"),a(2,"h1",1),y(3,"mat-icon",2),g(4),m(5,"translate"),l(),a(6,"perun-web-apps-refresh-button",3),u("refresh",function(){return i.refreshTable()}),l(),a(7,"span",4),m(8,"translate"),a(9,"button",5),u("click",function(){return i.onCreate()}),g(10),m(11,"translate"),l()(),a(12,"span",6),m(13,"isAuthorized"),m(14,"translate"),v(15,gt,4,9,"button",7),l(),a(16,"perun-web-apps-debounce-filter",8),u("filter",function(h){return i.applyFilter(h)}),l(),v(17,vt,1,0,"ng-template",null,9,E),a(19,"div",10),v(20,St,1,7,"perun-web-apps-facilities-list",11),l()()),r&2){let d=R(18);n(3),c("ngStyle",K(26,bt)),n(),C(" ",_(5,15,"FACILITY_MANAGEMENT.TITLE")," "),n(3),ae("matTooltip",_(8,17,"FACILITY_MANAGEMENT.CREATE_DISABLED")),c("matTooltipDisabled",i.createAuth),n(2),c("disabled",!i.createAuth),n(),C(" ",_(11,19,"FACILITY_MANAGEMENT.CREATE")," "),n(2),ae("matTooltip",_(14,24,"FACILITY_MANAGEMENT.DELETE_PERMISSION_HINT")),c("matTooltipDisabled",i.selection.selected.length===0||ce(13,21,le(27,dt,i.selection.selected[0]==null?null:i.selection.selected[0].facility),"deleteFacility_Facility_Boolean_policy"))("matTooltipPosition","below"),n(3),c("ngIf",i.deleteAuth),n(),c("autoFocus",!0)("placeholder","FACILITY_MANAGEMENT.FILTER_PLACEHOLDER")("linkGlobalSearch",!0),n(4),c("perunWebAppsLoader",i.loading)("perunWebAppsLoaderIndicator",d)}},dependencies:[W,Te,Be,ee,Ue,O,B,tt,et,j,V,x,ze],styles:[".icon-scale[_ngcontent-%COMP%]{transform:scale(1.7);margin-left:.5rem;margin-top:-.4rem;margin-right:.9rem}"]});let s=o;return s})();function Ct(s,o){if(s&1){let t=F();a(0,"button",10),u("click",function(){S(t);let r=f();return b(r.createResource())}),g(1),m(2,"translate"),l()}s&2&&(n(),C(" ",_(2,1,"FACILITY_DETAIL.RESOURCES.CREATE")," "))}function At(s,o){if(s&1){let t=F();a(0,"button",11),u("click",function(){S(t);let r=f();return b(r.removeResource())}),g(1),m(2,"translate"),l()}if(s&2){let t=f();c("disabled",t.selected.selected.length===0||t.loading),n(),C(" ",_(2,2,"FACILITY_DETAIL.RESOURCES.DELETE")," ")}}function It(s,o){s&1&&y(0,"perun-web-apps-loading-table")}function Ft(s,o){if(s&1&&y(0,"perun-web-apps-resources-list",12),s&2){let t=f();c("tableId",t.tableId)("loading",t.loading)("filterValue",t.filterValue)("resources",t.resources)("selection",t.selected)("cachedSubject",t.cachedSubject)("disableRouting",!t.routeAuth)("displayedColumns",t.displayedColumns)}}var Ai=(()=>{let o=class o{constructor(e,r,i,d,h,I,Y,z){this.dialog=e,this.facilitiesManager=r,this.servicesManager=i,this.authResolver=d,this.entityStorageService=h,this.cd=I,this.cacheHelperService=Y,this.destroyRef=z,this.resources=[],this.selected=new X(!0,[],!0,(oe,ne)=>oe.id===ne.id),this.cachedSubject=new N(!0),this.emptyService={id:-1,beanName:"Service",name:"All"},this.services=[this.emptyService],this.selectedService=this.emptyService,this.filterValue="",this.tableId=qe,this.displayedColumns=["id","vo","facility","description"]}ngOnInit(){this.loading=!0,this.facility=this.entityStorageService.getEntity(),this.setAuthRights(),this.servicesManager.getAssignedServices(this.facility.id).subscribe(e=>{this.services=[this.emptyService].concat(e),this.refreshTable()}),this.loadResourcesForFacility(),this.cacheHelperService.refreshComponentCachedData().pipe(P(this.destroyRef)).subscribe(e=>{e===o.id&&this.refreshTable()})}ngAfterViewInit(){this.cd.detectChanges()}removeResource(){let e=M();e.width="450px",e.data={theme:"facility-theme",resources:this.selected.selected},this.dialog.open(nt,e).afterClosed().subscribe(i=>{i&&this.refreshTable()})}refreshTable(){this.loading=!0,this.selectedService.id===-1?this.loadResourcesForFacility():this.facilitiesManager.getAssignedRichResourcesForFacilityAndService(this.facility.id,this.selectedService.id).subscribe(e=>{this.resources=e,this.selected.clear(),this.cachedSubject.next(!0),this.setAuthRights(),this.loading=!1})}setAuthRights(){this.addAuth=this.authResolver.isAuthorized("createResource_Resource_Vo_Facility_policy",[this.facility]),this.removeAuth=this.authResolver.isAuthorized("deleteResource_Resource_policy",[this.facility]),this.displayedColumns=this.removeAuth?["select","id","name","vo","description"]:["id","name","vo","description"],this.resources.length!==0&&(this.routeAuth=this.authResolver.isAuthorized("getRichResourceById_int_policy",[this.facility,this.resources[0]]))}applyFilter(e){this.filterValue=e,this.refreshTable()}createResource(){let e=M();e.width="1350px",e.data={facilityId:this.facility.id,theme:"facility-theme"},this.dialog.open(at,e).afterClosed().subscribe(i=>{i&&this.refreshTable()})}serviceSelected(e){this.selectedService=e,this.refreshTable()}loadResourcesForFacility(){this.facilitiesManager.getAssignedRichResourcesForFacility(this.facility.id).subscribe(e=>{this.resources=e,this.selected.clear(),this.cachedSubject.next(!0),this.setAuthRights(),this.loading=!1})}};o.id="FacilityResourcesComponent",o.\u0275fac=function(r){return new(r||o)(p(H),p(L),p(J),p(D),p(k),p(q),p(U),p(w))},o.\u0275cmp=T({type:o,selectors:[["app-facility-resources"]],hostVars:2,hostBindings:function(r,i){r&2&&G("router-component",i.true)},decls:14,vars:10,consts:[[1,"page-subtitle"],[1,"align-elements"],[3,"refresh"],["mat-flat-button","","color","accent","data-cy","create-resource-button","class","me-2 action-button",3,"click",4,"ngIf"],["mat-flat-button","","color","warn","class","me-2","data-cy","delete-resource-button",3,"disabled","click",4,"ngIf"],[1,"search-select","me-2",3,"services","service","serviceSelected"],[1,"filter-field",3,"placeholder","filter"],["spinner",""],[1,"position-relative","table-min-height"],[3,"tableId","loading","filterValue","resources","selection","cachedSubject","disableRouting","displayedColumns",4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],["mat-flat-button","","color","accent","data-cy","create-resource-button",1,"me-2","action-button",3,"click"],["mat-flat-button","","color","warn","data-cy","delete-resource-button",1,"me-2",3,"disabled","click"],[3,"tableId","loading","filterValue","resources","selection","cachedSubject","disableRouting","displayedColumns"]],template:function(r,i){if(r&1&&(a(0,"div")(1,"h1",0),g(2),m(3,"translate"),l(),a(4,"div",1)(5,"perun-web-apps-refresh-button",2),u("refresh",function(){return i.refreshTable()}),l(),v(6,Ct,3,3,"button",3)(7,At,3,4,"button",4),a(8,"perun-web-apps-service-search-select",5),u("serviceSelected",function(h){return i.serviceSelected(h)}),l(),a(9,"perun-web-apps-debounce-filter",6),u("filter",function(h){return i.applyFilter(h)}),l()(),v(10,It,1,0,"ng-template",null,7,E),a(12,"div",8),v(13,Ft,1,8,"perun-web-apps-resources-list",9),l()()),r&2){let d=R(11);n(2),A(_(3,8,"FACILITY_DETAIL.RESOURCES.TITLE")),n(4),c("ngIf",i.addAuth),n(),c("ngIf",i.removeAuth),n(),c("services",i.services)("service",i.selectedService),n(),c("placeholder","SHARED_LIB.PERUN.COMPONENTS.RESOURCES_LIST.TABLE_SEARCH"),n(4),c("perunWebAppsLoader",i.loading)("perunWebAppsLoaderIndicator",d)}},dependencies:[W,ee,O,B,Qe,j,se,V,x],styles:[".search-select[_ngcontent-%COMP%]{min-width:325px}.filter-field[_ngcontent-%COMP%]{min-width:250px}.align-elements[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;align-items:baseline}"]});let s=o;return s})();function Et(s,o){if(s&1&&(a(0,"mat-option",10),g(1),l()),s&2){let t=o.$implicit;c("value",t.id),n(),C(" ",t.name," ")}}function Lt(s,o){s&1&&y(0,"perun-web-apps-loading-table")}var xt=()=>["id","vo","name","description"];function Dt(s,o){if(s&1&&y(0,"perun-web-apps-groups-list",11),s&2){let t=f();c("loading",t.loading)("displayedColumns",K(7,xt))("groups",t.groupsToShow)("disableMembers",!1)("filter",t.filterValue)("groupsToDisableRouting",t.groupsWithoutRouteAuth)("tableId",t.tableId)}}var Oi=(()=>{let o=class o{constructor(e,r,i,d,h){this.facilityManager=e,this.authResolver=r,this.entityStorageService=i,this.cacheHelperService=d,this.destroyRef=h,this.groups=[],this.filterValue="",this.selected="all",this.groupsToShow=this.groups,this.tableId=Ze,this.groupsWithoutRouteAuth=new Set}ngOnInit(){this.loading=!0,this.facility=this.entityStorageService.getEntity(),this.facilityManager.getAllowedVos(this.facility.id).subscribe(e=>{this.vos=e,this.refreshTable()}),this.cacheHelperService.refreshComponentCachedData().pipe(P(this.destroyRef)).subscribe(e=>{e===o.id&&this.refreshTable()})}showGroup(){this.selected!=="all"?this.groupsToShow=this.groups.filter(e=>e.voId===parseInt(this.selected,10)):this.groupsToShow=this.groups}refreshTable(){this.loading=!0,this.groups=[],this.facilityManager.getAllowedGroups(this.facility.id).subscribe(e=>{this.groups=e,this.groupsToShow=this.groups,this.setAuthRights(e),this.loading=!1}),this.vos&&this.vos.length===0&&(this.loading=!1)}setAuthRights(e){e.forEach(r=>{this.authResolver.isAuthorized("getGroupById_int_policy",[r])||this.groupsWithoutRouteAuth.add(r.id)})}applyFilter(e){this.filterValue=e}};o.id="FacilityAllowedGroupsComponent",o.\u0275fac=function(r){return new(r||o)(p(L),p(D),p(k),p(U),p(w))},o.\u0275cmp=T({type:o,selectors:[["app-facility-allowed-groups"]],hostVars:2,hostBindings:function(r,i){r&2&&G("router-component",i.true)},inputs:{groups:"groups"},decls:19,vars:14,consts:[[1,"page-subtitle"],[3,"refresh"],[1,"me-2"],[3,"value","selectionChange","valueChange"],["value","all"],[3,"value",4,"ngFor","ngForOf"],[3,"placeholder","filter"],["spinner",""],[1,"position-relative","table-min-height"],[3,"loading","displayedColumns","groups","disableMembers","filter","groupsToDisableRouting","tableId",4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],[3,"value"],[3,"loading","displayedColumns","groups","disableMembers","filter","groupsToDisableRouting","tableId"]],template:function(r,i){if(r&1&&(a(0,"div")(1,"h1",0),g(2),m(3,"translate"),l(),a(4,"perun-web-apps-refresh-button",1),u("refresh",function(){return i.refreshTable()}),l(),a(5,"mat-form-field",2)(6,"mat-label"),g(7),m(8,"translate"),l(),a(9,"mat-select",3),u("selectionChange",function(){return i.showGroup()})("valueChange",function(h){return i.selected=h}),a(10,"mat-option",4),g(11),m(12,"translate"),l(),v(13,Et,2,2,"mat-option",5),l()(),a(14,"perun-web-apps-debounce-filter",6),u("filter",function(h){return i.applyFilter(h)}),l(),v(15,Lt,1,0,"ng-template",null,7,E),a(17,"div",8),v(18,Dt,1,8,"perun-web-apps-groups-list",9),l()()),r&2){let d=R(16);n(2),A(_(3,8,"MENU_ITEMS.FACILITY.ALLOWED_GROUPS")),n(5),A(_(8,10,"FACILITY_DETAIL.ALLOWED_GROUPS.SHOW_VOS_GROUPS")),n(2),c("value",i.selected),n(2),A(_(12,12,"FACILITY_DETAIL.ALLOWED_GROUPS.ALL")),n(2),c("ngForOf",i.vos),n(),c("placeholder","FACILITY_DETAIL.ALLOWED_GROUPS.FILTER"),n(4),c("perunWebAppsLoader",i.loading)("perunWebAppsLoaderIndicator",d)}},dependencies:[Z,Q,ie,te,re,O,Xe,B,j,V,x]});let s=o;return s})();function Mt(s,o){if(s&1&&(a(0,"mat-option",20),g(1),m(2,"translate"),l()),s&2){let t=o.$implicit;c("value",t),n(),A(_(2,2,"CONSENTS.STATUS_"+t))}}function Vt(s,o){if(s&1){let t=F();a(0,"mat-form-field",17)(1,"mat-label"),g(2),m(3,"translate"),l(),a(4,"mat-select",18),u("closed",function(){S(t);let r=f(2);return b(r.consentStatusSelected())}),a(5,"mat-select-trigger"),g(6),l(),v(7,Mt,3,4,"mat-option",19),l()()}if(s&2){let t=f(2);n(2),A(_(3,4,"CONSENTS.STATUS")),n(2),c("formControl",t.consentStatuses),n(2),C(" ",t.displaySelectedStatuses()," "),n(),c("ngForOf",t.consentStatusesList)}}function Ot(s,o){if(s&1){let t=F();a(0,"div",9)(1,"div",10)(2,"mat-slide-toggle",11),u("ngModelChange",function(r){S(t);let i=f();return b(i.showAllowed=r)})("change",function(){S(t);let r=f();return b(r.changeFilter())}),g(3),m(4,"translate"),l(),a(5,"span",12),g(6),m(7,"translate"),l()(),a(8,"div",1)(9,"perun-web-apps-vo-search-select",13),u("voSelected",function(r){S(t);let i=f();return b(i.voSelected(r))}),l(),a(10,"perun-web-apps-resource-search-select",14),u("resourceSelected",function(r){S(t);let i=f();return b(i.resourceSelected(r))}),l(),a(11,"perun-web-apps-service-search-select",15),u("serviceSelected",function(r){S(t);let i=f();return b(i.serviceSelected(r))}),l(),v(12,Vt,8,6,"mat-form-field",16),l()()}if(s&2){let t=f();n(2),c("ngModel",t.showAllowed),n(),C(" ",_(4,14,"FACILITY_DETAIL.ALLOWED_USERS.FILTER_ALLOWED")," "),n(3),A(_(7,16,t.toggle_messages[t.showAllowed?1:0])),n(3),c("vos",t.vos)("vo",t.selectedVo)("disableAutoSelect",!0),n(),c("resources",t.filteredResources)("displayStatus",!1)("resource",t.selectedResource)("disableAutoSelect",!0),n(),c("services",t.filteredServices)("service",t.selectedService)("disableAutoSelect",!0),n(),c("ngIf",t.globalForceConsents&&t.facilityForceConsents)}}function Pt(s,o){s&1&&y(0,"perun-web-apps-loading-table")}function Bt(s,o){if(s&1){let t=F();a(0,"perun-web-apps-users-list",21),u("queryChanged",function(r){S(t);let i=f();return b(i.nextPage.next(r))})("downloadAll",function(r){S(t);let i=f();return b(i.downloadAll(r))}),m(1,"async"),m(2,"async"),l()}if(s&2){let t=f();c("loading",_(1,8,t.loading$))("routeToAdmin",t.routeAuth)("disableRouting",!t.routeAuth)("users",_(2,10,t.usersPage$))("filter",t.searchString)("tableId",t.tableId)("displayColumns",t.displayedColumns)("facilityId",t.facility.id)}}var dr=(()=>{let o=class o{constructor(e,r,i,d,h,I,Y,z,oe,ne,ut,mt,ht,ft){this.facilityService=e,this.serviceService=r,this.resourceService=i,this.authResolver=d,this.storeService=h,this.entityStorageService=I,this.consentService=Y,this.translate=z,this.cd=oe,this.dialog=ne,this.cacheHelperService=ut,this.userManager=mt,this.destroyRef=ht,this.notificator=ft,this.attributes=[],this.searchString="",this.nextPage=new N({}),this.usersPage$=this.nextPage.pipe(Ie($=>this.userManager.getUsersPage({attrNames:this.attributes,query:{order:$.order,pageSize:$.pageSize,offset:$.offset,sortColumn:$.sortColumn,onlyAllowed:this.showAllowed,consentStatuses:this.selectedConsentStatuses,searchString:$.searchString,facilityId:this.facility.id,resourceId:this.selectedResource?.id,serviceId:this.selectedService?.id,voId:this.selectedVo?.id}})),Fe(()=>{setTimeout(()=>this.loadingSubject$.next(!1),200)}),Ae({data:[],totalCount:0,offset:0,pageSize:0})),this.loadingSubject$=new N(!1),this.loading$=Ce(this.loadingSubject$,this.nextPage.pipe(ye(()=>!0))),this.showAllowed=!0,this.resources=[],this.filteredResources=[],this.vos=[],this.services=[],this.filteredServices=[],this.consentStatusesList=["UNSIGNED","GRANTED","REVOKED"],this.selectedConsentStatuses=[],this.forceConsentsDisplayColumns=["id","name","email","logins","organization","consentStatus"],this.displayedColumns=["id","name","email","logins","organization"],this.tableId=Je,this.toggle_messages=["FACILITY_DETAIL.ALLOWED_USERS.FILTER_ASSIGNED_MSG","FACILITY_DETAIL.ALLOWED_USERS.FILTER_ALLOWED_MSG"],this.advancedFilter=!1}ngOnInit(){this.consentStatuses=new Ve(this.selectedConsentStatuses),this.attributes=[pe.USER_DEF_ORGANIZATION,pe.USER_DEF_PREFERRED_MAIL],this.attributes=this.attributes.concat(this.storeService.getLoginAttributeNames()),this.facility=this.entityStorageService.getEntity(),this.globalForceConsents=this.storeService.getProperty("enforce_consents"),this.consentService.getConsentHubByFacility(this.facility.id).subscribe(e=>{this.facilityForceConsents=e.enforceConsents,this.globalForceConsents&&this.facilityForceConsents&&(this.displayedColumns=this.forceConsentsDisplayColumns)}),this.routeAuth=this.authResolver.isPerunAdminOrObserver(),this.loadFilters(),this.changeFilter(),this.cacheHelperService.refreshComponentCachedData().pipe(P(this.destroyRef)).subscribe(e=>{e===o.id&&this.refresh()})}changeFilter(){this.filtersCount=this.showAllowed?1:0,this.selectedVo&&(this.filtersCount+=1),this.selectedResource&&(this.filtersCount+=1),this.selectedService&&(this.filtersCount+=1),this.selectedConsentStatuses.length>0&&(this.filtersCount+=1),this.cd.detectChanges(),this.refresh()}clearFilters(){let e=this.advancedFilter;this.advancedFilter=!1,this.showAllowed=!1,this.selectedVo=void 0,this.selectedResource=void 0,this.selectedService=void 0,this.selectedConsentStatuses=[],this.consentStatuses.setValue(this.selectedConsentStatuses),this.filtersCount=0,this.voSelected(this.selectedVo),this.resourceSelected(this.selectedResource),this.serviceSelected(this.selectedService),this.cd.detectChanges(),this.advancedFilter=e}loadFilters(){this.facilityService.getAllowedVos(this.facility.id).subscribe(e=>{this.vos=e,this.facilityService.getAssignedResourcesForFacility(this.facility.id).subscribe(r=>{this.resources=r,this.filteredResources=this.resources,this.selectedVo&&(this.filteredResources=this.resources.filter(i=>i.voId===this.selectedVo.id))}),this.serviceService.getAssignedServices(this.facility.id).subscribe(r=>{this.services=r,this.selectedResource&&this.resourceService.getAssignedServicesToResource(this.selectedResource.id).subscribe(i=>{this.filteredServices=i}),this.cd.detectChanges()})})}refresh(){this.loadFilters(),this.nextPage.next(this.nextPage.value)}applyFilter(e){this.searchString=e,this.refresh()}voSelected(e){this.selectedVo=e,this.selectedResource=void 0,this.selectedService=void 0,this.changeFilter()}resourceSelected(e){this.selectedResource=e,this.services=[],this.filteredServices=[],this.selectedService=null,this.changeFilter()}serviceSelected(e){this.selectedService=e,this.changeFilter()}consentStatusSelected(){this.selectedConsentStatuses=this.consentStatuses.value,this.changeFilter()}displaySelectedStatuses(){if(this.selectedConsentStatuses.length===this.consentStatusesList.length)return"ALL";let e=this.consentStatuses.value;return e?`${this.translate.instant("CONSENTS.STATUS_"+e[0])}  ${e.length>1?"(+"+(e.length-1).toString()+" "+(e.length===2?"other)":"others)"):""}`:""}downloadAll(e){let r=this.nextPage.getValue(),i=M();i.width="500px";let d=this.dialog.open($e,i),h=this.userManager.getUsersPage({attrNames:this.attributes,query:{order:r.order,pageSize:e.length,offset:0,sortColumn:r.sortColumn,searchString:r.searchString,onlyAllowed:this.showAllowed,consentStatuses:this.selectedConsentStatuses,facilityId:this.facility.id,resourceId:this.selectedResource?.id,serviceId:this.selectedService?.id,voId:this.selectedVo?.id}}).subscribe({next:I=>{d.close(),He(We(e.convertToExport(I.data),this.displayedColumns,e.getDataForColumnFun),e.format)},error:I=>{this.notificator.showRPCError(I),d.close()}});d.afterClosed().subscribe(()=>{h&&h.unsubscribe()})}};o.id="FacilityAllowedUsersComponent",o.\u0275fac=function(r){return new(r||o)(p(L),p(J),p(Ee),p(D),p(De),p(k),p(Re),p(xe),p(q),p(H),p(U),p(Le),p(w),p(ke))},o.\u0275cmp=T({type:o,selectors:[["app-facility-allowed-users"]],decls:14,vars:11,consts:[[1,"page-subtitle"],[1,"filters"],[1,"me-2",3,"refresh"],[1,"me-2","filter",3,"placeholder","filter"],[3,"advancedFilter","filtersCount","changeAdvancedFilter","clearFilters"],["class","advanced-filter",4,"ngIf"],["spinner",""],[1,"position-relative","table-min-height"],[3,"loading","routeToAdmin","disableRouting","users","filter","tableId","displayColumns","facilityId","queryChanged","downloadAll",4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],[1,"advanced-filter"],[1,"toggle","filters"],["labelPosition","before",1,"me-2",3,"ngModel","ngModelChange","change"],[1,"text-muted"],[1,"search-select",3,"vos","vo","disableAutoSelect","voSelected"],[1,"search-select",3,"resources","displayStatus","resource","disableAutoSelect","resourceSelected"],[1,"search-select",3,"services","service","disableAutoSelect","serviceSelected"],["class","search-select",4,"ngIf"],[1,"search-select"],["multiple","",3,"formControl","closed"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],[3,"loading","routeToAdmin","disableRouting","users","filter","tableId","displayColumns","facilityId","queryChanged","downloadAll"]],template:function(r,i){if(r&1&&(a(0,"div")(1,"h1",0),g(2),m(3,"translate"),l(),a(4,"div",1)(5,"perun-web-apps-refresh-button",2),u("refresh",function(){return i.refresh()}),l(),a(6,"perun-web-apps-debounce-filter",3),u("filter",function(h){return i.applyFilter(h)}),l(),a(7,"perun-web-apps-advanced-filter",4),u("changeAdvancedFilter",function(h){return i.advancedFilter=h})("clearFilters",function(){return i.clearFilters()}),l()(),v(8,Ot,13,18,"div",5)(9,Pt,1,0,"ng-template",null,6,E),a(11,"div",7),v(12,Bt,3,12,"perun-web-apps-users-list",8),m(13,"async"),l()()),r&2){let d=R(10);n(2),A(_(3,7,"FACILITY_DETAIL.ALLOWED_USERS.TITLE")),n(4),c("placeholder","FACILITY_DETAIL.ALLOWED_USERS.FILTER"),n(),c("advancedFilter",i.advancedFilter)("filtersCount",i.filtersCount),n(),c("ngIf",i.advancedFilter),n(4),c("perunWebAppsLoader",_(13,9,i.loading$))("perunWebAppsLoaderIndicator",d)}},dependencies:[Z,W,Q,ie,te,Me,Pe,Oe,re,je,Ne,O,B,it,rt,j,st,se,ot,V,we,x],styles:[".filters[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;align-items:baseline}.filter[_ngcontent-%COMP%]{min-width:350px}.search-select[_ngcontent-%COMP%]{width:32%;margin-right:20px;margin-top:30px}.toggle[_ngcontent-%COMP%]{display:flex;flex-direction:column}.advanced-filter[_ngcontent-%COMP%]{border:1px solid lightgray;padding:15px}"]});let s=o;return s})();export{oi as a,Ai as b,Oi as c,dr as d};
