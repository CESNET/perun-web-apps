import{$ as w,$c as je,$g as Xe,Aa as g,Ab as Re,B as Ie,Ba as A,Ca as C,Cb as E,Cc as te,Ed as He,Ee as ze,Eh as rt,Fc as ie,Fh as se,Gf as $e,Gh as st,Hb as Ee,Ig as Ke,Ja as Z,Jb as X,Jc as Me,K as F,Ka as ae,Ki as nt,Lb as xe,Mc as Ve,Mg as V,Na as h,Nj as at,O as S,Oa as _,Oc as Oe,Oj as lt,P as b,Pa as le,Pd as ke,Qc as Pe,Ra as R,Sb as x,Ub as Le,Wa as J,Wg as Ze,Xa as G,Xb as L,Xh as j,Y as o,Ya as we,Yb as De,Yc as re,Yg as O,Z as p,Za as Te,Zc as Ue,_ as K,_g as Je,ah as Qe,bh as et,cd as ce,cg as k,d as B,da as v,dc as W,dh as P,fd as Be,ga as c,ha as N,he as Ye,i as be,ic as Q,ig as qe,ka as a,kd as D,kg as M,la as l,m as ye,ma as y,md as Ne,nd as Ge,pa as I,qa as u,qh as tt,ra as m,sc as H,sh as it,ua as Fe,ud as We,vh as U,x as Ce,y as Ae,yj as ot,za as T,zc as ee}from"./chunk-FVLRQPQH.js";function ft(s,n){if(s&1){let t=I();a(0,"button",11),u("click",function(){S(t);let r=m();return b(r.onCreate())}),g(1),h(2,"translate"),l()}s&2&&(o(),C(" ",_(2,1,"FACILITY_MANAGEMENT.CREATE")," "))}var pt=s=>[s];function _t(s,n){if(s&1){let t=I();a(0,"button",12),u("click",function(){S(t);let r=m();return b(r.onDelete())}),h(1,"isAuthorized"),g(2),h(3,"translate"),l()}if(s&2){let t=m();c("disabled",t.loading||t.selection.selected.length===0||!le(1,2,ae(7,pt,t.selection.selected[0]==null?null:t.selection.selected[0].facility),"deleteFacility_Facility_Boolean_policy")),o(2),C(" ",_(3,5,"FACILITY_MANAGEMENT.DELETE")," ")}}function gt(s,n){s&1&&y(0,"perun-web-apps-loading-table")}function vt(s,n){if(s&1&&y(0,"perun-web-apps-facilities-list",13),s&2){let t=m();c("tableId",t.tableId)("selection",t.selection)("cachedSubject",t.cachedSubject)("loading",t.loading)("filterValue",t.filterValue)("facilities",t.facilities)("recentIds",t.recentIds)}}var St=()=>({color:"black"}),si=(()=>{let n=class n{constructor(e,r,i,d,f,Y){this.facilityManager=e,this.sideMenuService=r,this.guiAuthResolver=i,this.dialog=d,this.cacheHelperService=f,this.destroyRef=Y,this.facilities=[],this.recentIds=[],this.filterValue="",this.tableId=He,this.selection=new W(!1,[],!0,(z,$)=>z.facility.id===$.facility.id),this.cachedSubject=new B(!0)}ngOnInit(){this.createAuth=this.guiAuthResolver.isAuthorized("createFacility_Facility_policy",[]),this.deleteAuth=this.guiAuthResolver.isFacilityAdmin(),this.refreshTable(),this.cacheHelperService.refreshComponentCachedData().pipe(O(this.destroyRef)).subscribe(e=>{e===n.id&&this.refreshTable()})}ngAfterViewChecked(){this.sideMenuService.setFacilityMenuItems([])}refreshTable(){this.loading=!0,this.facilityManager.getEnrichedFacilities().subscribe(e=>{this.selection.clear(),this.cachedSubject.next(!0),this.facilities=e,this.recentIds=Be("facilities"),this.loading=!1})}onCreate(){let e=D();e.width="800px",e.data={theme:"facility-theme"},this.dialog.open(at,e).afterClosed().subscribe(i=>{i&&(this.loading=!0,this.refreshTable())})}onDelete(){let e=D();e.width="500px",e.data={theme:"facility-theme",facility:this.selection.selected[0].facility},this.dialog.open(lt,e).afterClosed().subscribe(i=>{i&&this.refreshTable()})}applyFilter(e){this.filterValue=e,this.refreshTable()}};n.id="FacilitySelectPageComponent",n.\u0275fac=function(r){return new(r||n)(p(E),p(qe),p(L),p(H),p(j),p(w))},n.\u0275cmp=F({type:n,selectors:[["app-facility-select-page"]],hostVars:2,hostBindings:function(r,i){r&2&&N("router-component",i.true)},decls:17,vars:21,consts:[[1,"container-fluid","ps-xl-5","pe-xl-5","facility-theme"],[1,"page-title","d-flex"],["svgIcon","perun-facility-black",1,"perun-icon","icon-scale",3,"ngStyle"],[3,"refresh"],["mat-flat-button","","class","action-button me-2","data-cy","new-facility-button","color","accent",3,"click",4,"ngIf"],[3,"matTooltipDisabled","matTooltipPosition","matTooltip"],["mat-flat-button","","class","me-2","data-cy","delete-facility-button","color","warn",3,"disabled","click",4,"ngIf"],[3,"autoFocus","placeholder","filter"],["spinner",""],[1,"position-relative","table-min-height"],[3,"tableId","selection","cachedSubject","loading","filterValue","facilities","recentIds",4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],["mat-flat-button","","data-cy","new-facility-button","color","accent",1,"action-button","me-2",3,"click"],["mat-flat-button","","data-cy","delete-facility-button","color","warn",1,"me-2",3,"disabled","click"],[3,"tableId","selection","cachedSubject","loading","filterValue","facilities","recentIds"]],template:function(r,i){if(r&1&&(a(0,"div",0),y(1,"perun-web-apps-back-button"),a(2,"h1",1),y(3,"mat-icon",2),g(4),h(5,"translate"),l(),a(6,"perun-web-apps-refresh-button",3),u("refresh",function(){return i.refreshTable()}),l(),v(7,ft,3,3,"button",4),a(8,"span",5),h(9,"isAuthorized"),h(10,"translate"),v(11,_t,4,9,"button",6),l(),a(12,"perun-web-apps-debounce-filter",7),u("filter",function(f){return i.applyFilter(f)}),l(),v(13,gt,1,0,"ng-template",null,8,R),a(15,"div",9),v(16,vt,1,7,"perun-web-apps-facilities-list",10),l()()),r&2){let d=T(14);o(3),c("ngStyle",Z(18,St)),o(),C(" ",_(5,11,"FACILITY_MANAGEMENT.TITLE")," "),o(3),c("ngIf",i.createAuth),o(),Fe("matTooltip",_(10,16,"FACILITY_MANAGEMENT.DELETE_PERMISSION_HINT")),c("matTooltipDisabled",i.selection.selected.length===0||le(9,13,ae(19,pt,i.selection.selected[0]==null?null:i.selection.selected[0].facility),"deleteFacility_Facility_Boolean_policy"))("matTooltipPosition","below"),o(3),c("ngIf",i.deleteAuth),o(),c("autoFocus",!0)("placeholder","FACILITY_MANAGEMENT.FILTER_PLACEHOLDER"),o(4),c("perunWebAppsLoader",i.loading)("perunWebAppsLoaderIndicator",d)}},dependencies:[G,we,ze,ee,je,V,P,et,Qe,U,M,x,Ke],styles:[".icon-scale[_ngcontent-%COMP%]{transform:scale(1.7);margin-left:.5rem;margin-top:-.4rem;margin-right:.9rem}"]});let s=n;return s})();function yt(s,n){if(s&1){let t=I();a(0,"button",10),u("click",function(){S(t);let r=m();return b(r.createResource())}),g(1),h(2,"translate"),l()}s&2&&(o(),C(" ",_(2,1,"FACILITY_DETAIL.RESOURCES.CREATE")," "))}function Ct(s,n){if(s&1){let t=I();a(0,"button",11),u("click",function(){S(t);let r=m();return b(r.removeResource())}),g(1),h(2,"translate"),l()}if(s&2){let t=m();c("disabled",t.selected.selected.length===0||t.loading),o(),C(" ",_(2,2,"FACILITY_DETAIL.RESOURCES.DELETE")," ")}}function At(s,n){s&1&&y(0,"perun-web-apps-loading-table")}function It(s,n){if(s&1&&y(0,"perun-web-apps-resources-list",12),s&2){let t=m();c("tableId",t.tableId)("loading",t.loading)("filterValue",t.filterValue)("resources",t.resources)("selection",t.selected)("cachedSubject",t.cachedSubject)("disableRouting",!t.routeAuth)("displayedColumns",t.displayedColumns)}}var Ci=(()=>{let n=class n{constructor(e,r,i,d,f,Y,z,$){this.dialog=e,this.facilitiesManager=r,this.servicesManager=i,this.authResolver=d,this.entityStorageService=f,this.cd=Y,this.cacheHelperService=z,this.destroyRef=$,this.resources=[],this.selected=new W(!0,[],!0,(ne,oe)=>ne.id===oe.id),this.cachedSubject=new B(!0),this.emptyService={id:-1,beanName:"Service",name:"All"},this.services=[this.emptyService],this.selectedService=this.emptyService,this.filterValue="",this.tableId=We,this.displayedColumns=["id","vo","facility","description"]}ngOnInit(){this.loading=!0,this.facility=this.entityStorageService.getEntity(),this.setAuthRights(),this.servicesManager.getAssignedServices(this.facility.id).subscribe(e=>{this.services=[this.emptyService].concat(e),this.refreshTable()}),this.loadResourcesForFacility(),this.cacheHelperService.refreshComponentCachedData().pipe(O(this.destroyRef)).subscribe(e=>{e===n.id&&this.refreshTable()})}ngAfterViewInit(){this.cd.detectChanges()}removeResource(){let e=D();e.width="450px",e.data={theme:"facility-theme",resources:this.selected.selected},this.dialog.open(nt,e).afterClosed().subscribe(i=>{i&&this.refreshTable()})}refreshTable(){this.loading=!0,this.selectedService.id===-1?this.loadResourcesForFacility():this.facilitiesManager.getAssignedRichResourcesForFacilityAndService(this.facility.id,this.selectedService.id).subscribe(e=>{this.resources=e,this.selected.clear(),this.cachedSubject.next(!0),this.setAuthRights(),this.loading=!1})}setAuthRights(){this.addAuth=this.authResolver.isAuthorized("createResource_Resource_Vo_Facility_policy",[this.facility]),this.removeAuth=this.authResolver.isAuthorized("deleteResource_Resource_policy",[this.facility]),this.displayedColumns=this.removeAuth?["select","id","name","vo","description"]:["id","name","vo","description"],this.resources.length!==0&&(this.routeAuth=this.authResolver.isAuthorized("getRichResourceById_int_policy",[this.facility,this.resources[0]]))}applyFilter(e){this.filterValue=e,this.refreshTable()}createResource(){let e=D();e.width="1350px",e.data={facilityId:this.facility.id,theme:"facility-theme"},this.dialog.open(ot,e).afterClosed().subscribe(i=>{i&&this.refreshTable()})}serviceSelected(e){this.selectedService=e,this.refreshTable()}loadResourcesForFacility(){this.facilitiesManager.getAssignedRichResourcesForFacility(this.facility.id).subscribe(e=>{this.resources=e,this.selected.clear(),this.cachedSubject.next(!0),this.setAuthRights(),this.loading=!1})}};n.id="FacilityResourcesComponent",n.\u0275fac=function(r){return new(r||n)(p(H),p(E),p(X),p(L),p(k),p(K),p(j),p(w))},n.\u0275cmp=F({type:n,selectors:[["app-facility-resources"]],hostVars:2,hostBindings:function(r,i){r&2&&N("router-component",i.true)},decls:14,vars:10,consts:[[1,"page-subtitle"],[1,"align-elements"],[3,"refresh"],["mat-flat-button","","color","accent","data-cy","create-resource-button","class","me-2 action-button",3,"click",4,"ngIf"],["mat-flat-button","","color","warn","class","me-2","data-cy","delete-resource-button",3,"disabled","click",4,"ngIf"],[1,"search-select","me-2",3,"services","service","serviceSelected"],[1,"filter-field",3,"placeholder","filter"],["spinner",""],[1,"position-relative","table-min-height"],[3,"tableId","loading","filterValue","resources","selection","cachedSubject","disableRouting","displayedColumns",4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],["mat-flat-button","","color","accent","data-cy","create-resource-button",1,"me-2","action-button",3,"click"],["mat-flat-button","","color","warn","data-cy","delete-resource-button",1,"me-2",3,"disabled","click"],[3,"tableId","loading","filterValue","resources","selection","cachedSubject","disableRouting","displayedColumns"]],template:function(r,i){if(r&1&&(a(0,"div")(1,"h1",0),g(2),h(3,"translate"),l(),a(4,"div",1)(5,"perun-web-apps-refresh-button",2),u("refresh",function(){return i.refreshTable()}),l(),v(6,yt,3,3,"button",3)(7,Ct,3,4,"button",4),a(8,"perun-web-apps-service-search-select",5),u("serviceSelected",function(f){return i.serviceSelected(f)}),l(),a(9,"perun-web-apps-debounce-filter",6),u("filter",function(f){return i.applyFilter(f)}),l()(),v(10,At,1,0,"ng-template",null,7,R),a(12,"div",8),v(13,It,1,8,"perun-web-apps-resources-list",9),l()()),r&2){let d=T(11);o(2),A(_(3,8,"FACILITY_DETAIL.RESOURCES.TITLE")),o(4),c("ngIf",i.addAuth),o(),c("ngIf",i.removeAuth),o(),c("services",i.services)("service",i.selectedService),o(),c("placeholder","SHARED_LIB.PERUN.COMPONENTS.RESOURCES_LIST.TABLE_SEARCH"),o(4),c("perunWebAppsLoader",i.loading)("perunWebAppsLoaderIndicator",d)}},dependencies:[G,ee,V,P,Xe,U,se,M,x],styles:[".search-select[_ngcontent-%COMP%]{min-width:325px}.filter-field[_ngcontent-%COMP%]{min-width:250px}.align-elements[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;align-items:baseline}"]});let s=n;return s})();function Rt(s,n){if(s&1&&(a(0,"mat-option",10),g(1),l()),s&2){let t=n.$implicit;c("value",t.id),o(),C(" ",t.name," ")}}function Et(s,n){s&1&&y(0,"perun-web-apps-loading-table")}var xt=()=>["id","vo","name","description"];function Lt(s,n){if(s&1&&y(0,"perun-web-apps-groups-list",11),s&2){let t=m();c("loading",t.loading)("displayedColumns",Z(7,xt))("groups",t.groupsToShow)("disableMembers",!1)("filter",t.filterValue)("groupsToDisableRouting",t.groupsWithoutRouteAuth)("tableId",t.tableId)}}var Vi=(()=>{let n=class n{constructor(e,r,i,d,f){this.facilityManager=e,this.authResolver=r,this.entityStorageService=i,this.cacheHelperService=d,this.destroyRef=f,this.groups=[],this.filterValue="",this.selected="all",this.groupsToShow=this.groups,this.tableId=ke,this.groupsWithoutRouteAuth=new Set}ngOnInit(){this.loading=!0,this.facility=this.entityStorageService.getEntity(),this.facilityManager.getAllowedVos(this.facility.id).subscribe(e=>{this.vos=e,this.refreshTable()}),this.cacheHelperService.refreshComponentCachedData().pipe(O(this.destroyRef)).subscribe(e=>{e===n.id&&this.refreshTable()})}showGroup(){this.selected!=="all"?this.groupsToShow=this.groups.filter(e=>e.voId===parseInt(this.selected,10)):this.groupsToShow=this.groups}refreshTable(){this.loading=!0,this.groups=[],this.facilityManager.getAllowedGroups(this.facility.id).subscribe(e=>{this.groups=e,this.groupsToShow=this.groups,this.setAuthRights(e),this.loading=!1}),this.vos&&this.vos.length===0&&(this.loading=!1)}setAuthRights(e){e.forEach(r=>{this.authResolver.isAuthorized("getGroupById_int_policy",[r])||this.groupsWithoutRouteAuth.add(r.id)})}applyFilter(e){this.filterValue=e}};n.id="FacilityAllowedGroupsComponent",n.\u0275fac=function(r){return new(r||n)(p(E),p(L),p(k),p(j),p(w))},n.\u0275cmp=F({type:n,selectors:[["app-facility-allowed-groups"]],hostVars:2,hostBindings:function(r,i){r&2&&N("router-component",i.true)},inputs:{groups:"groups"},decls:19,vars:14,consts:[[1,"page-subtitle"],[3,"refresh"],[1,"me-2"],[3,"value","selectionChange","valueChange"],["value","all"],[3,"value",4,"ngFor","ngForOf"],[3,"placeholder","filter"],["spinner",""],[1,"position-relative","table-min-height"],[3,"loading","displayedColumns","groups","disableMembers","filter","groupsToDisableRouting","tableId",4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],[3,"value"],[3,"loading","displayedColumns","groups","disableMembers","filter","groupsToDisableRouting","tableId"]],template:function(r,i){if(r&1&&(a(0,"div")(1,"h1",0),g(2),h(3,"translate"),l(),a(4,"perun-web-apps-refresh-button",1),u("refresh",function(){return i.refreshTable()}),l(),a(5,"mat-form-field",2)(6,"mat-label"),g(7),h(8,"translate"),l(),a(9,"mat-select",3),u("selectionChange",function(){return i.showGroup()})("valueChange",function(f){return i.selected=f}),a(10,"mat-option",4),g(11),h(12,"translate"),l(),v(13,Rt,2,2,"mat-option",5),l()(),a(14,"perun-web-apps-debounce-filter",6),u("filter",function(f){return i.applyFilter(f)}),l(),v(15,Et,1,0,"ng-template",null,7,R),a(17,"div",8),v(18,Lt,1,8,"perun-web-apps-groups-list",9),l()()),r&2){let d=T(16);o(2),A(_(3,8,"MENU_ITEMS.FACILITY.ALLOWED_GROUPS")),o(5),A(_(8,10,"FACILITY_DETAIL.ALLOWED_GROUPS.SHOW_VOS_GROUPS")),o(2),c("value",i.selected),o(2),A(_(12,12,"FACILITY_DETAIL.ALLOWED_GROUPS.ALL")),o(2),c("ngForOf",i.vos),o(),c("placeholder","FACILITY_DETAIL.ALLOWED_GROUPS.FILTER"),o(4),c("perunWebAppsLoader",i.loading)("perunWebAppsLoaderIndicator",d)}},dependencies:[J,Q,ie,te,re,V,Je,P,U,M,x]});let s=n;return s})();function Dt(s,n){if(s&1&&(a(0,"mat-option",20),g(1),h(2,"translate"),l()),s&2){let t=n.$implicit;c("value",t),o(),A(_(2,2,"CONSENTS.STATUS_"+t))}}function Mt(s,n){if(s&1){let t=I();a(0,"mat-form-field",17)(1,"mat-label"),g(2),h(3,"translate"),l(),a(4,"mat-select",18),u("closed",function(){S(t);let r=m(2);return b(r.consentStatusSelected())}),a(5,"mat-select-trigger"),g(6),l(),v(7,Dt,3,4,"mat-option",19),l()()}if(s&2){let t=m(2);o(2),A(_(3,4,"CONSENTS.STATUS")),o(2),c("formControl",t.consentStatuses),o(2),C(" ",t.displaySelectedStatuses()," "),o(),c("ngForOf",t.consentStatusesList)}}function Vt(s,n){if(s&1){let t=I();a(0,"div",9)(1,"div",10)(2,"mat-slide-toggle",11),u("ngModelChange",function(r){S(t);let i=m();return b(i.showAllowed=r)})("change",function(){S(t);let r=m();return b(r.changeFilter())}),g(3),h(4,"translate"),l(),a(5,"span",12),g(6),h(7,"translate"),l()(),a(8,"div",1)(9,"perun-web-apps-vo-search-select",13),u("voSelected",function(r){S(t);let i=m();return b(i.voSelected(r))}),l(),a(10,"perun-web-apps-resource-search-select",14),u("resourceSelected",function(r){S(t);let i=m();return b(i.resourceSelected(r))}),l(),a(11,"perun-web-apps-service-search-select",15),u("serviceSelected",function(r){S(t);let i=m();return b(i.serviceSelected(r))}),l(),v(12,Mt,8,6,"mat-form-field",16),l()()}if(s&2){let t=m();o(2),c("ngModel",t.showAllowed),o(),C(" ",_(4,14,"FACILITY_DETAIL.ALLOWED_USERS.FILTER_ALLOWED")," "),o(3),A(_(7,16,t.toggle_messages[t.showAllowed?1:0])),o(3),c("vos",t.vos)("vo",t.selectedVo)("disableAutoSelect",!0),o(),c("resources",t.filteredResources)("displayStatus",!1)("resource",t.selectedResource)("disableAutoSelect",!0),o(),c("services",t.filteredServices)("service",t.selectedService)("disableAutoSelect",!0),o(),c("ngIf",t.globalForceConsents&&t.facilityForceConsents)}}function Ot(s,n){s&1&&y(0,"perun-web-apps-loading-table")}function Pt(s,n){if(s&1){let t=I();a(0,"perun-web-apps-users-list",21),u("queryChanged",function(r){S(t);let i=m();return b(i.nextPage.next(r))})("downloadAll",function(r){S(t);let i=m();return b(i.downloadAll(r))}),h(1,"async"),h(2,"async"),l()}if(s&2){let t=m();c("loading",_(1,8,t.loading$))("routeToAdmin",t.routeAuth)("users",_(2,10,t.usersPage$))("filter",t.searchString)("selection",t.selection)("tableId",t.tableId)("displayColumns",t.displayedColumns)("facilityId",t.facility.id)}}var pr=(()=>{let n=class n{constructor(e,r,i,d,f,Y,z,$,ne,oe,dt,ut,mt){this.facilityService=e,this.serviceService=r,this.resourceService=i,this.authResolver=d,this.storeService=f,this.entityStorageService=Y,this.consentService=z,this.translate=$,this.cd=ne,this.dialog=oe,this.cacheHelperService=dt,this.userManager=ut,this.destroyRef=mt,this.attributes=[],this.searchString="",this.selection=new W(!0,[]),this.nextPage=new B({}),this.usersPage$=this.nextPage.pipe(Ae(q=>this.userManager.getUsersPage({attrNames:this.attributes,query:{order:q.order,pageSize:q.pageSize,offset:q.offset,sortColumn:q.sortColumn,onlyAllowed:this.showAllowed,consentStatuses:this.selectedConsentStatuses,searchString:q.searchString,facilityId:this.facility.id,resourceId:this.selectedResource?.id,serviceId:this.selectedService?.id,voId:this.selectedVo?.id}})),Ie(()=>{this.selection.clear(),setTimeout(()=>this.loadingSubject$.next(!1),200)}),Ce({data:[],totalCount:0,offset:0,pageSize:0})),this.loadingSubject$=new B(!1),this.loading$=ye(this.loadingSubject$,this.nextPage.pipe(be(()=>!0))),this.showAllowed=!0,this.resources=[],this.filteredResources=[],this.vos=[],this.services=[],this.filteredServices=[],this.consentStatusesList=["UNSIGNED","GRANTED","REVOKED"],this.selectedConsentStatuses=[],this.forceConsentsDisplayColumns=["id","name","email","logins","organization","consentStatus"],this.displayedColumns=["id","name","email","logins","organization"],this.tableId=Ye,this.toggle_messages=["FACILITY_DETAIL.ALLOWED_USERS.FILTER_ASSIGNED_MSG","FACILITY_DETAIL.ALLOWED_USERS.FILTER_ALLOWED_MSG"],this.advancedFilter=!1}ngOnInit(){this.consentStatuses=new Ve(this.selectedConsentStatuses),this.attributes=[ce.USER_DEF_ORGANIZATION,ce.USER_DEF_PREFERRED_MAIL],this.attributes=this.attributes.concat(this.storeService.getLoginAttributeNames()),this.facility=this.entityStorageService.getEntity(),this.globalForceConsents=this.storeService.getProperty("enforce_consents"),this.consentService.getConsentHubByFacility(this.facility.id).subscribe(e=>{this.facilityForceConsents=e.enforceConsents,this.globalForceConsents&&this.facilityForceConsents&&(this.displayedColumns=this.forceConsentsDisplayColumns)}),this.routeAuth=this.authResolver.isPerunAdminOrObserver(),this.loadFilters(),this.changeFilter(),this.cacheHelperService.refreshComponentCachedData().pipe(O(this.destroyRef)).subscribe(e=>{e===n.id&&this.refresh()})}changeFilter(){this.filtersCount=this.showAllowed?1:0,this.selectedVo&&(this.filtersCount+=1),this.selectedResource&&(this.filtersCount+=1),this.selectedService&&(this.filtersCount+=1),this.selectedConsentStatuses.length>0&&(this.filtersCount+=1),this.cd.detectChanges(),this.refresh()}clearFilters(){let e=this.advancedFilter;this.advancedFilter=!1,this.showAllowed=!1,this.selectedVo=void 0,this.selectedResource=void 0,this.selectedService=void 0,this.selectedConsentStatuses=[],this.consentStatuses.setValue(this.selectedConsentStatuses),this.filtersCount=0,this.voSelected(this.selectedVo),this.resourceSelected(this.selectedResource),this.serviceSelected(this.selectedService),this.cd.detectChanges(),this.advancedFilter=e}loadFilters(){this.facilityService.getAllowedVos(this.facility.id).subscribe(e=>{this.vos=e,this.facilityService.getAssignedResourcesForFacility(this.facility.id).subscribe(r=>{this.resources=r,this.filteredResources=this.resources,this.selectedVo&&(this.filteredResources=this.resources.filter(i=>i.voId===this.selectedVo.id))}),this.serviceService.getAssignedServices(this.facility.id).subscribe(r=>{this.services=r,this.selectedResource&&this.resourceService.getAssignedServicesToResource(this.selectedResource.id).subscribe(i=>{this.filteredServices=i}),this.cd.detectChanges()})})}refresh(){this.loadFilters(),this.nextPage.next(this.nextPage.value)}applyFilter(e){this.searchString=e,this.refresh()}voSelected(e){this.selectedVo=e,this.selectedResource=void 0,this.selectedService=void 0,this.changeFilter()}resourceSelected(e){this.selectedResource=e,this.services=[],this.filteredServices=[],this.selectedService=null,this.changeFilter()}serviceSelected(e){this.selectedService=e,this.changeFilter()}consentStatusSelected(){this.selectedConsentStatuses=this.consentStatuses.value,this.changeFilter()}displaySelectedStatuses(){if(this.selectedConsentStatuses.length===this.consentStatusesList.length)return"ALL";let e=this.consentStatuses.value;return e?`${this.translate.instant("CONSENTS.STATUS_"+e[0])}  ${e.length>1?"(+"+(e.length-1).toString()+" "+(e.length===2?"other)":"others)"):""}`:""}downloadAll(e){let r=this.nextPage.getValue(),i=D();i.width="300px";let d=this.dialog.open(Ze,i);this.userManager.getUsersPage({attrNames:this.attributes,query:{order:r.order,pageSize:e.length,offset:0,sortColumn:r.sortColumn,searchString:r.searchString,onlyAllowed:this.showAllowed,consentStatuses:this.selectedConsentStatuses,facilityId:this.facility.id,resourceId:this.selectedResource?.id,serviceId:this.selectedService?.id,voId:this.selectedVo?.id}}).subscribe({next:f=>{d.close(),Ge(Ne(e.convertToExport(f.data),this.displayedColumns,e.getDataForColumnFun),e.format)}})}};n.id="FacilityAllowedUsersComponent",n.\u0275fac=function(r){return new(r||n)(p(E),p(X),p(Ee),p(L),p(De),p(k),p(Re),p(Le),p(K),p(H),p(j),p(xe),p(w))},n.\u0275cmp=F({type:n,selectors:[["app-facility-allowed-users"]],decls:14,vars:11,consts:[[1,"page-subtitle"],[1,"filters"],[1,"me-2",3,"refresh"],[1,"me-2","filter",3,"placeholder","filter"],[3,"advancedFilter","filtersCount","changeAdvancedFilter","clearFilters"],["class","advanced-filter",4,"ngIf"],["spinner",""],[1,"position-relative","table-min-height"],[3,"loading","routeToAdmin","users","filter","selection","tableId","displayColumns","facilityId","queryChanged","downloadAll",4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],[1,"advanced-filter"],[1,"toggle","filters"],["labelPosition","before",1,"me-2",3,"ngModel","ngModelChange","change"],[1,"text-muted"],[1,"search-select",3,"vos","vo","disableAutoSelect","voSelected"],[1,"search-select",3,"resources","displayStatus","resource","disableAutoSelect","resourceSelected"],[1,"search-select",3,"services","service","disableAutoSelect","serviceSelected"],["class","search-select",4,"ngIf"],[1,"search-select"],["multiple","",3,"formControl","closed"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],[3,"loading","routeToAdmin","users","filter","selection","tableId","displayColumns","facilityId","queryChanged","downloadAll"]],template:function(r,i){if(r&1&&(a(0,"div")(1,"h1",0),g(2),h(3,"translate"),l(),a(4,"div",1)(5,"perun-web-apps-refresh-button",2),u("refresh",function(){return i.refresh()}),l(),a(6,"perun-web-apps-debounce-filter",3),u("filter",function(f){return i.applyFilter(f)}),l(),a(7,"perun-web-apps-advanced-filter",4),u("changeAdvancedFilter",function(f){return i.advancedFilter=f})("clearFilters",function(){return i.clearFilters()}),l()(),v(8,Vt,13,18,"div",5)(9,Ot,1,0,"ng-template",null,6,R),a(11,"div",7),v(12,Pt,3,12,"perun-web-apps-users-list",8),h(13,"async"),l()()),r&2){let d=T(10);o(2),A(_(3,7,"FACILITY_DETAIL.ALLOWED_USERS.TITLE")),o(4),c("placeholder","FACILITY_DETAIL.ALLOWED_USERS.FILTER"),o(),c("advancedFilter",i.advancedFilter)("filtersCount",i.filtersCount),o(),c("ngIf",i.advancedFilter),o(4),c("perunWebAppsLoader",_(13,9,i.loading$))("perunWebAppsLoaderIndicator",d)}},dependencies:[J,G,Q,ie,te,Me,Pe,Oe,re,Ue,$e,V,P,tt,it,U,rt,se,st,M,Te,x],styles:[".filters[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;align-items:baseline}.filter[_ngcontent-%COMP%]{min-width:350px}.search-select[_ngcontent-%COMP%]{width:32%;margin-right:20px;margin-top:30px}.toggle[_ngcontent-%COMP%]{display:flex;flex-direction:column}.advanced-filter[_ngcontent-%COMP%]{border:1px solid lightgray;padding:15px}"]});let s=n;return s})();export{si as a,Ci as b,Vi as c,pr as d};
