import{a as an,b as on,c as rn,d as sn}from"./chunk-KI3QCVUA.js";import{a as Ei,b as Ri,c as wi,d as Li,e as Di,f as Mi,g as Oi,h as Ni,i as Vi,j as Bi,k as Pi,l as ji}from"./chunk-FTDLCCYF.js";import{a as nn}from"./chunk-AC5BMJPC.js";import"./chunk-TGJ2CKAC.js";import{a as je}from"./chunk-55PNGS7N.js";import{j as tn}from"./chunk-7T2BZ3KJ.js";import"./chunk-IB5QV2IP.js";import{$b as D,$d as kt,$e as $t,$h as bi,Aa as f,Ba as T,Bh as U,Bi as Pe,Ca as S,Da as oe,Db as w,Dc as N,E as at,Ea as mt,Ec as At,Ee as Ut,F as Ae,Fh as Ne,Ga as dt,Gb as It,Gc as Ft,Gf as ti,H as ot,Hf as ii,Hh as ke,If as ni,Ij as Ge,Ja as q,Jb as Re,Jc as xt,Je as le,Jf as ai,Jh as Si,Jj as Gi,K as E,Ka as Qe,Ki as xi,Kj as Ui,L as Fe,Lb as ae,Lc as Rt,Le as Yt,Lh as vi,Mb as we,Mc as Ze,Me as Wt,Mj as Ue,Na as d,Nb as yt,Nc as wt,Ne as Ht,Nj as Yi,O as y,Oa as u,Oj as Wi,P as b,Qj as Hi,Ra as P,Rc as se,Rg as ci,Rj as zi,Sg as G,Sj as $i,T as xe,Tj as Ki,Uc as Lt,Ug as pi,Uh as Ii,Vb as re,Vg as mi,Wa as ut,Wb as A,We as zt,Wg as di,Xa as ft,Xf as De,Xj as Xi,Y as r,Ya as L,Yb as bt,Yf as oi,Yg as ui,Yh as yi,Z as m,Za as ht,_ as rt,_a as gt,_b as Ct,_d as Nt,aa as ue,ac as Tt,ae as Vt,af as Kt,ag as Z,be as Bt,ca as st,cb as _t,cf as Xt,d as B,da as _,dd as Le,df as qt,di as Ci,dk as Ye,ek as qi,ff as Ce,fi as Ti,fj as ki,fk as Qi,ga as c,gd as et,gi as Ve,ha as k,hc as V,hf as Qt,hg as F,hh as fi,i as Te,ia as fe,ie as Pt,if as Jt,ig as Me,ii as Ai,jf as Zt,jh as W,ji as Fi,ka as l,kf as ei,la as s,ld as Dt,lk as Ji,ma as v,mc as Et,md as Mt,mk as Zi,ne as jt,ng as ri,od as M,pa as C,pd as Ot,pe as Gt,pg as j,pk as en,qa as g,qb as ge,qh as hi,ra as h,rh as Oe,sg as si,tb as _e,tg as li,ua as he,ub as St,uc as Se,vc as ve,vh as gi,wa as lt,wb as Je,wc as Y,x as Ee,xa as ct,xc as Ie,xh as _i,ya as pt,yb as vt,yc as ye,z as nt,za as R,zc as be,zg as ee,zi as Be}from"./chunk-XQ7YXRXE.js";import"./chunk-2YRG3NBG.js";function Rn(i,o){i&1&&v(0,"mat-spinner",3)}function wn(i,o){if(i&1){let n=C();l(0,"button",12),g("click",function(){y(n);let t=h(2);return b(t.editFacility())}),d(1,"translate"),l(2,"mat-icon"),f(3,"edit"),s()()}i&2&&he("matTooltip",u(1,1,"FACILITY_DETAIL.EDIT"))}function Ln(i,o){if(i&1){let n=C();l(0,"button",12),g("click",function(){y(n);let t=h(2);return b(t.deleteFacility())}),d(1,"translate"),l(2,"mat-icon"),f(3,"delete_forever"),s()()}i&2&&he("matTooltip",u(1,1,"FACILITY_DETAIL.DELETE"))}var Dn=()=>({color:"black"}),ln=i=>["/facilities",i];function Mn(i,o){if(i&1&&(l(0,"div")(1,"div",4),v(2,"mat-icon",5),d(3,"translate"),l(4,"div",6)(5,"div",7)(6,"a",8),g("auxclick",function(e){return e.preventDefault()}),f(7),s(),l(8,"span",9),f(9),s(),_(10,wn,4,3,"button",10)(11,Ln,4,3,"button",10),s(),l(12,"div"),f(13),d(14,"translate"),s(),l(15,"span",11),f(16),d(17,"translate"),d(18,"translate"),s()()(),v(19,"app-animated-router-outlet"),s()),i&2){let n=h();r(2),he("matTooltip",u(3,13,"FACILITY_DETAIL.ENTITY")),c("ngStyle",q(21,Dn)),r(4),c("perunWebAppsMiddleClickRouterLink",Qe(22,ln,n.facility.id.toString()))("routerLink",Qe(24,ln,n.facility.id)),r(),T(n.facility.name),r(2),S(" \xA0#",n.facility.id," "),r(),c("ngIf",n.editFacilityAuth),r(),c("ngIf",n.deleteAuth),r(2),oe("",u(14,15,"FACILITY_DETAIL.UUID"),": ",n.facility.uuid,""),r(3),mt(" ",u(17,17,"FACILITY_DETAIL.ENTITY"),", ",u(18,19,"FACILITY_DETAIL.DESCRIPTION"),": ",n.facility.description," ")}}var pn=(()=>{let o=class o extends Ei(){constructor(e,t,a,p,I,x,H,z,J){super(),this.dialog=e,this.facilityManager=t,this.route=a,this.sideMenuService=p,this.sideMenuItemService=I,this.guiAuthResolver=x,this.router=H,this.entityStorageService=z,this.reloadEntityDetail=J,this.editFacilityAuth=!1,this.deleteAuth=!1,this.loading=!1}ngOnInit(){this.reloadData(),this.reloadEntityDetail.entityDetailChange.pipe(nt(this.destroyed$)).subscribe(()=>{this.reloadData()})}reloadData(){this.loading=!0,this.route.params.subscribe(e=>{let t=Number(e.facilityId);this.facilityManager.getFacilityById(t).subscribe({next:a=>{this.facility=a,this.entityStorageService.setEntityAndPathParam({id:a.id,beanName:a.beanName},Ct.Facility),this.setMenuItems(),this.editFacilityAuth=this.guiAuthResolver.isAuthorized("updateFacility_Facility_policy",[this.facility]),this.deleteAuth=this.guiAuthResolver.isAuthorized("deleteFacility_Facility_Boolean_policy",[this.facility]),Dt("facilities",this.facility),Mt(this.facility),this.loading=!1},error:()=>this.loading=!1})})}setMenuItems(){let e=this.sideMenuItemService.parseFacility(this.facility);this.sideMenuService.setFacilityMenuItems([e])}editFacility(){let e=M();e.width="450px",e.data={theme:"facility-theme",facility:this.facility,dialogType:si.FACILITY},this.dialog.open(li,e).afterClosed().subscribe(a=>{a&&this.facilityManager.getFacilityById(this.facility.id).subscribe(p=>{this.facility=p,this.setMenuItems()})})}deleteFacility(){let e=M();e.width="500px",e.data={theme:"facility-theme",facility:this.facility},this.dialog.open(Xi,e).afterClosed().subscribe(a=>{a&&this.router.navigate([""],{queryParamsHandling:"preserve"})})}};o.\u0275fac=function(t){return new(t||o)(m(Y),m(w),m(ge),m(ri),m(Ci),m(D),m(_e),m(F),m(Ti))},o.\u0275cmp=E({type:o,selectors:[["app-facility-detail-page"]],features:[st],decls:4,vars:2,consts:[[1,"container-fluid","ps-xl-5","pe-xl-5","facility-theme"],["class","me-auto ms-auto",4,"ngIf"],[4,"ngIf"],[1,"me-auto","ms-auto"],[1,"d-flex","page-title-headtitle"],["svgIcon","perun-facility-black",1,"perun-icon","perun-icon-detail",3,"matTooltip","ngStyle"],[1,"page-title-block"],[1,"page-title-headline","d-flex","align-items-center"],[1,"facility-link",3,"perunWebAppsMiddleClickRouterLink","routerLink","auxclick"],[1,"text-muted"],["mat-icon-button","",3,"matTooltip","click",4,"ngIf"],[1,"mt-1","entity-info"],["mat-icon-button","",3,"matTooltip","click"]],template:function(t,a){t&1&&(l(0,"div",0),v(1,"perun-web-apps-back-button"),_(2,Rn,1,0,"mat-spinner",1)(3,Mn,20,26,"div",2),s()),t&2&&(r(2),c("ngIf",a.loading),r(),c("ngIf",!a.loading&&a.facility!==void 0))},dependencies:[L,ht,St,le,At,Ce,Le,Ve,fi,mi,di,A],data:{animation:[ke]}});let i=o;return i})();function Nn(i,o){i&1&&v(0,"mat-spinner",2)}function kn(i,o){if(i&1&&(l(0,"div"),v(1,"perun-web-apps-menu-buttons-field",3)(2,"perun-web-apps-expandable-tiles",4),s()),i&2){let n=h();r(),c("items",n.items),r(),c("items",n.settingItems)("title","MENU_ITEMS.FACILITY.SETTINGS")("sectionId","settings")}}var mn=(()=>{let o=class o{constructor(e,t,a,p){this.facilityManager=e,this.authResolver=t,this.entityStorageService=a,this.routePolicyService=p,this.items=[],this.settingItems=[],this.loading=!1}ngOnInit(){this.loading=!0,this.facility=this.entityStorageService.getEntity(),this.setItems(),this.setSettingsItems(),this.loading=!1}setItems(){this.items=[],this.routePolicyService.canNavigate("facilities-resources",this.facility)&&this.items.push({cssIcon:"perun-manage-facility",url:`/facilities/${this.facility.id}/resources`,label:"MENU_ITEMS.FACILITY.RESOURCES",style:"facility-btn"}),this.routePolicyService.canNavigate("facilities-allowed-users",this.facility)&&this.items.push({cssIcon:"perun-user",url:`/facilities/${this.facility.id}/allowed-users`,label:"MENU_ITEMS.FACILITY.ALLOWED_USERS",style:"facility-btn"}),this.routePolicyService.canNavigate("facilities-allowed-groups",this.facility)&&this.items.push({cssIcon:"perun-group",url:`/facilities/${this.facility.id}/allowed-groups`,label:"MENU_ITEMS.FACILITY.ALLOWED_GROUPS",style:"facility-btn"}),this.routePolicyService.canNavigate("facilities-services-status",this.facility)&&this.items.push({cssIcon:"perun-service-status",url:`/facilities/${this.facility.id}/services-status`,label:"MENU_ITEMS.FACILITY.SERVICES_STATUS",style:"facility-btn"}),this.routePolicyService.canNavigate("facilities-services-destinations",this.facility)&&this.items.push({cssIcon:"perun-service_destination",url:`/facilities/${this.facility.id}/services-destinations`,label:"MENU_ITEMS.FACILITY.SERVICES_DESTINATIONS",style:"facility-btn"}),this.routePolicyService.canNavigate("facilities-hosts",this.facility)&&this.items.push({cssIcon:"perun-hosts",url:`/facilities/${this.facility.id}/hosts`,label:"MENU_ITEMS.FACILITY.HOSTS",style:"facility-btn"}),this.routePolicyService.canNavigate("facilities-attributes",this.facility)&&this.items.push({cssIcon:"perun-attributes",url:`/facilities/${this.facility.id}/attributes`,label:"MENU_ITEMS.FACILITY.ATTRIBUTES",style:"facility-btn"})}setSettingsItems(){this.settingItems=[],this.routePolicyService.canNavigate("facilities-settings-owners",this.facility)&&this.settingItems.push({cssIcon:"perun-owner-grey",url:`/facilities/${this.facility.id}/settings/owners`,label:"MENU_ITEMS.FACILITY.OWNERS",style:"facility-btn"}),this.routePolicyService.canNavigate("facilities-settings-managers",this.facility)&&this.settingItems.push({cssIcon:"perun-manager",url:`/facilities/${this.facility.id}/settings/managers`,label:"MENU_ITEMS.FACILITY.MANAGERS",style:"facility-btn"}),this.routePolicyService.canNavigate("facilities-settings-security-teams",this.facility)&&this.settingItems.push({cssIcon:"perun-security-teams",url:`/facilities/${this.facility.id}/settings/security-teams`,label:"MENU_ITEMS.FACILITY.SECURITY_TEAMS",style:"facility-btn"}),this.routePolicyService.canNavigate("facilities-settings-blacklist",this.facility)&&this.settingItems.push({cssIcon:"perun-black-list",url:`/facilities/${this.facility.id}/settings/blacklist`,label:"MENU_ITEMS.FACILITY.BLACKLIST",style:"facility-btn"}),this.routePolicyService.canNavigate("facilities-settings-bans",this.facility)&&this.settingItems.push({cssIcon:"perun-ban",url:`/facilities/${this.facility.id}/settings/bans`,label:"MENU_ITEMS.FACILITY.BANS",style:"facility-btn"})}};o.\u0275fac=function(t){return new(t||o)(m(w),m(D),m(F),m(Me))},o.\u0275cmp=E({type:o,selectors:[["app-facility-overview"]],hostVars:2,hostBindings:function(t,a){t&2&&k("router-component",a.true)},decls:2,vars:2,consts:[["class","me-auto ms-auto",4,"ngIf"],[4,"ngIf"],[1,"me-auto","ms-auto"],[3,"items"],[3,"items","title","sectionId"]],template:function(t,a){t&1&&_(0,Nn,1,0,"mat-spinner",0)(1,kn,3,4,"div",1),t&2&&(c("ngIf",a.loading),r(),c("ngIf",!a.loading))},dependencies:[L,Ce,Oe,yi]});let i=o;return i})();var dn=(()=>{let o=class o{};o.\u0275fac=function(t){return new(t||o)},o.\u0275cmp=E({type:o,selectors:[["app-facility-settings"]],hostVars:2,hostBindings:function(t,a){t&2&&k("router-component",a.true)},decls:1,vars:0,template:function(t,a){t&1&&v(0,"app-animated-router-outlet")},dependencies:[Ve],data:{animation:[ke]}});let i=o;return i})();function Vn(i,o){i&1&&v(0,"mat-spinner",2)}function Bn(i,o){if(i&1&&(l(0,"div"),v(1,"perun-web-apps-menu-buttons-field",3),s()),i&2){let n=h();r(),c("items",n.items)}}var un=(()=>{let o=class o{constructor(e,t,a,p){this.facilityManager=e,this.authResolver=t,this.entityStorageService=a,this.routePolicyService=p,this.items=[],this.loading=!1}ngOnInit(){this.loading=!0,this.facility=this.entityStorageService.getEntity(),this.initItems(),this.loading=!1}initItems(){this.items=[],this.routePolicyService.canNavigate("facilities-settings-owners",this.facility)&&this.items.push({cssIcon:"perun-owner-grey",url:`/facilities/${this.facility.id}/settings/owners`,label:"MENU_ITEMS.FACILITY.OWNERS",style:"facility-btn"}),this.routePolicyService.canNavigate("facilities-settings-managers",this.facility)&&this.items.push({cssIcon:"perun-manager",url:`/facilities/${this.facility.id}/settings/managers`,label:"MENU_ITEMS.FACILITY.MANAGERS",style:"facility-btn"}),this.routePolicyService.canNavigate("facilities-settings-security-teams",this.facility)&&this.items.push({cssIcon:"perun-security-teams",url:`/facilities/${this.facility.id}/settings/security-teams`,label:"MENU_ITEMS.FACILITY.SECURITY_TEAMS",style:"facility-btn"}),this.routePolicyService.canNavigate("facilities-settings-blacklist",this.facility)&&this.items.push({cssIcon:"perun-black-list",url:`/facilities/${this.facility.id}/settings/blacklist`,label:"MENU_ITEMS.FACILITY.BLACKLIST",style:"facility-btn"}),this.routePolicyService.canNavigate("facilities-settings-bans",this.facility)&&this.items.push({cssIcon:"perun-ban",url:`/facilities/${this.facility.id}/settings/bans`,label:"MENU_ITEMS.FACILITY.BANS",style:"facility-btn"})}};o.\u0275fac=function(t){return new(t||o)(m(w),m(D),m(F),m(Me))},o.\u0275cmp=E({type:o,selectors:[["app-facility-settings-overview"]],hostVars:2,hostBindings:function(t,a){t&2&&k("router-component",a.true)},decls:2,vars:2,consts:[["class","me-auto ms-auto",4,"ngIf"],[4,"ngIf"],[1,"me-auto","ms-auto"],[3,"items"]],template:function(t,a){t&1&&_(0,Vn,1,0,"mat-spinner",0)(1,Bn,2,1,"div",1),t&2&&(c("ngIf",a.loading),r(),c("ngIf",!a.loading))},dependencies:[L,Ce,Oe]});let i=o;return i})();function jn(i,o){i&1&&(f(0),d(1,"translate")),i&2&&S(" ",u(1,1,"FACILITY_DETAIL.ENTITY")," ")}function Gn(i,o){if(i&1&&v(0,"app-one-entity-attribute-page",5),i&2){let n=h();c("entityId",n.facility.id)("entity","facility")}}function Un(i,o){i&1&&(f(0),d(1,"translate"),d(2,"translate")),i&2&&oe(" ",u(1,2,"FACILITY_DETAIL.ENTITY")," - ",u(2,4,"ADMIN_USER.ENTITY")," ")}function Yn(i,o){if(i&1&&v(0,"app-two-entity-attribute-page",6),i&2){let n=h(2);c("firstEntity","facility")("firstEntityId",n.facility.id)("secondEntity","user")}}function Wn(i,o){i&1&&(l(0,"mat-tab"),_(1,Un,3,6,"ng-template",2)(2,Yn,1,3,"ng-template",3),s())}var fn=(()=>{let o=class o{constructor(e,t){this.authResolver=e,this.entityStorageService=t}ngOnInit(){this.facility=this.entityStorageService.getEntity(),this.facilityUserAttAuth=this.authResolver.isAuthorized("getAssignedUsers_Facility_policy",[this.facility])}};o.\u0275fac=function(t){return new(t||o)(m(D),m(F))},o.\u0275cmp=E({type:o,selectors:[["app-facility-attributes"]],hostVars:2,hostBindings:function(t,a){t&2&&k("router-component",a.true)},decls:9,vars:4,consts:[[1,"page-subtitle"],["mat-stretch-tabs","false"],["matTabLabel",""],["matTabContent",""],[4,"ngIf"],[3,"entityId","entity"],[3,"firstEntity","firstEntityId","secondEntity"]],template:function(t,a){t&1&&(l(0,"div")(1,"h1",0),f(2),d(3,"translate"),s(),l(4,"mat-tab-group",1)(5,"mat-tab"),_(6,jn,2,3,"ng-template",2)(7,Gn,1,2,"ng-template",3),s(),_(8,Wn,3,0,"mat-tab",4),s()()),t&2&&(r(2),T(u(3,2,"FACILITY_DETAIL.SETTINGS.ATTRIBUTES.TITLE")),r(6),c("ngIf",a.facilityUserAttAuth))},dependencies:[L,ti,ii,ni,ai,xi,Be,A]});let i=o;return i})();function zn(i,o){if(i&1){let n=C();l(0,"mat-option",10),g("onSelectionChange",function(){let a=y(n).$implicit,p=h(3);return b(p.onSelectedService(a))}),f(1),s()}if(i&2){let n=o.$implicit;c("value",n),r(),S(" ",n.name," ")}}function $n(i,o){if(i&1){let n=C();l(0,"mat-form-field",6)(1,"mat-label"),f(2),d(3,"translate"),s(),l(4,"input",7),g("keyup",function(t){y(n);let a=h(2);return b(a.updatedSerVal(t))}),s(),l(5,"mat-autocomplete",8,9)(7,"mat-option",10),g("onSelectionChange",function(){y(n);let t=h(2);return b(t.onSelectedService("NOT_SELECTED"))}),f(8),d(9,"translate"),s(),l(10,"mat-option",10),g("onSelectionChange",function(){y(n);let t=h(2);return b(t.onSelectedService("ALL"))}),f(11),d(12,"translate"),s(),_(13,zn,2,2,"mat-option",11),d(14,"async"),s()()}if(i&2){let n=R(6),e=h(2);r(2),T(u(3,9,"FACILITY_DETAIL.SERVICE_CONFIG.SERVICE_SELECT")),r(2),c("formControl",e.serviceField)("matAutocomplete",n),r(),c("displayWith",e.serviceDisplayFn.bind(e)),r(2),c("value","NOT_SELECTED"),r(),S(" ",u(9,11,"FACILITY_DETAIL.SERVICE_CONFIG.NOT_SELECTED")," "),r(2),c("value","ALL"),r(),S(" ",u(12,13,"FACILITY_DETAIL.SERVICE_CONFIG.ALL")," "),r(2),c("ngForOf",u(14,15,e.filteredServices))}}function Kn(i,o){if(i&1){let n=C();l(0,"mat-option",10),g("onSelectionChange",function(){let a=y(n).$implicit,p=h(3);return b(p.onSelectedResource(a))}),f(1),s()}if(i&2){let n=o.$implicit;c("value",n),r(),S(" ",n.name," ")}}function Xn(i,o){if(i&1){let n=C();l(0,"mat-form-field",6)(1,"mat-label"),f(2),d(3,"translate"),s(),l(4,"input",7),g("keyup",function(t){y(n);let a=h(2);return b(a.updatedResVal(t))}),s(),l(5,"mat-autocomplete",8,9),_(7,Kn,2,2,"mat-option",11),d(8,"async"),s()()}if(i&2){let n=R(6),e=h(2);r(2),T(u(3,5,"FACILITY_DETAIL.SERVICE_CONFIG.RES_SELECT")),r(2),c("formControl",e.resourceField)("matAutocomplete",n),r(),c("displayWith",e.resourceDisplayFn.bind(e)),r(2),c("ngForOf",u(8,7,e.filteredResources))}}function qn(i,o){if(i&1){let n=C();l(0,"mat-option",10),g("onSelectionChange",function(){let a=y(n).$implicit,p=h(3);return b(p.onSelectedGroup(a))}),f(1),s()}if(i&2){let n=o.$implicit;c("value",n),r(),S(" ",n.name," ")}}function Qn(i,o){if(i&1){let n=C();l(0,"mat-form-field",6)(1,"mat-label"),f(2),d(3,"translate"),s(),l(4,"input",7),g("keyup",function(t){y(n);let a=h(2);return b(a.updatedGroupVal(t))}),s(),l(5,"mat-autocomplete",12,9),_(7,qn,2,2,"mat-option",11),d(8,"async"),s()()}if(i&2){let n=R(6),e=h(2);r(2),T(u(3,5,"FACILITY_DETAIL.SERVICE_CONFIG.GROUP_SELECT")),r(2),c("formControl",e.groupField)("matAutocomplete",n),r(),c("displayWith",e.groupDisplayFn.bind(e)),r(2),c("ngForOf",u(8,7,e.filteredGroups))}}function Jn(i,o){if(i&1){let n=C();l(0,"mat-option",10),g("onSelectionChange",function(){let a=y(n).$implicit,p=h(3);return b(p.onSelectedMember(a))}),f(1),d(2,"userFullName"),s()}if(i&2){let n=o.$implicit;c("value",n),r(),S(" ",u(2,2,n.user)," ")}}function Zn(i,o){if(i&1&&(l(0,"mat-form-field",6)(1,"mat-label"),f(2),d(3,"translate"),s(),v(4,"input",13),l(5,"mat-autocomplete",8,9),_(7,Jn,3,4,"mat-option",11),d(8,"async"),s()()),i&2){let n=R(6),e=h(2);r(2),T(u(3,5,"FACILITY_DETAIL.SERVICE_CONFIG.MEMBER_SELECT")),r(2),c("matAutocomplete",n)("formControl",e.memberField),r(),c("displayWith",e.memberDisplayFn.bind(e)),r(2),c("ngForOf",u(8,7,e.filteredMembers))}}function ea(i,o){if(i&1){let n=C();l(0,"div",3),_(1,$n,15,17,"mat-form-field",4),l(2,"mat-checkbox",5),g("change",function(t){y(n);let a=h();return b(a.onOfferAllServices(t))}),f(3),d(4,"translate"),s(),_(5,Xn,9,9,"mat-form-field",4)(6,Qn,9,9,"mat-form-field",4)(7,Zn,9,9,"mat-form-field",4),s()}if(i&2){let n=h();r(),c("ngIf",n.services!==void 0),r(2),S(" ",u(4,5,"FACILITY_DETAIL.SERVICE_CONFIG.ALL_SERVICES")," "),r(2),c("ngIf",n.resources!==void 0&&n.resources.length!==0),r(),c("ngIf",n.selectedResource!==void 0&&n.groups!==void 0&&n.groups.length!==0),r(),c("ngIf",n.selectedGroup!==void 0&&n.members!==void 0&&n.members.length!==0)}}function ta(i,o){if(i&1&&v(0,"perun-web-apps-service-configurator",14),i&2){let n=h();c("facility",n.facility)("resource",n.selectedResource)("group",n.selectedGroup)("member",n.selectedMember)("service",n.selectedService)}}var hn=(()=>{let o=class o{constructor(e,t,a,p,I,x,H){this.facilityManager=e,this.resourceManager=t,this.serviceManager=a,this.membersManager=p,this.namePipe=I,this.translate=x,this.entityStorageService=H,this.serviceField=new se,this.resourceField=new se,this.groupField=new se,this.memberField=new se,this.allowedStatuses=["INVALID","VALID"],this.selectedService="NOT_SELECTED",this.attrNames=[],this.translate.get("FACILITY_DETAIL.SERVICE_CONFIG.ALL").subscribe(z=>this.serviceAllTranslation=z),this.translate.get("FACILITY_DETAIL.SERVICE_CONFIG.NOT_SELECTED").subscribe(z=>this.serviceNotSelectedTranslation=z)}ngOnInit(){this.facility=this.entityStorageService.getEntity(),this.facilityManager.getFacilityById(this.facility.id).subscribe(e=>{this.facility=e,this.facilityManager.getAssignedResourcesForFacility(e.id).subscribe(t=>this.resources=t),this.serviceManager.getAssignedServices(e.id).subscribe(t=>this.services=t)}),this.filteredServices=this.serviceField.valueChanges.pipe(Ee(""),Te(e=>this._filterServices(e))),this.filteredResources=this.resourceField.valueChanges.pipe(Ee(""),Te(e=>this._filterResources(e))),this.filteredGroups=this.groupField.valueChanges.pipe(Ee(""),Te(e=>this._filterGroups(e))),this.filteredMembers=this.memberField.valueChanges.pipe(Ee(""),Te(e=>this._filterMembers(e)))}onSelectedService(e){this.selectedService=e}onSelectedResource(e){this.selectedResource=e,this.selectedResource!==void 0?(this.resourceManager.getAssignedGroups(this.selectedResource.id).subscribe(t=>this.groups=t),this.selectedGroup=void 0,this.selectedMember=void 0):this.groups=void 0}onOfferAllServices(e){e.checked||this.serviceManager.getAssignedServices(this.facility.id).subscribe(t=>this.services=t)}onSelectedGroup(e){this.selectedGroup=e,this.selectedGroup!==void 0?(this.membersManager.getCompleteRichMembersForGroup(this.selectedGroup.id,!1,this.allowedStatuses,[],this.attrNames).subscribe(t=>this.members=t),this.selectedMember=void 0):this.members=void 0}onSelectedMember(e){this.selectedMember=e}serviceDisplayFn(e){if(e!==null)return e==="ALL"?this.serviceAllTranslation:e==="NOT_SELECTED"?this.serviceNotSelectedTranslation:typeof e!="string"?e.name:e}resourceDisplayFn(e){if(e!==null)return e.name}groupDisplayFn(e){if(e!==null)return e.name}memberDisplayFn(e){if(e!==null)return this.namePipe.transform(e.user)}updatedSerVal(e){e.target.value===""&&(this.selectedService="NOT_SELECTED")}updatedResVal(e){e.target.value===""&&(this.groups=void 0,this.members=void 0)}updatedGroupVal(e){e.target.value===""&&(this.members=void 0)}_filterServices(e){let t=e.toString().toLowerCase();return this.services.filter(a=>a.name.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").includes(t))}_filterResources(e){let t=e.toString().toLowerCase();return this.resources.filter(a=>a.name.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").includes(t))}_filterGroups(e){let t=e.toString().toLowerCase();return this.groups.filter(a=>a.name.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").includes(t))}_filterMembers(e){let t=e.toString().toLowerCase();return this.members.filter(a=>this.namePipe.transform(a.user).toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").includes(t))}};o.\u0275fac=function(t){return new(t||o)(m(w),m(Re),m(ae),m(It),m(ee),m(re),m(F))},o.\u0275cmp=E({type:o,selectors:[["app-facility-service-config"]],decls:6,vars:5,consts:[[1,"page-subtitle"],["class","col-12 col-lg-6 mb-2",4,"ngIf"],[3,"facility","resource","group","member","service",4,"ngIf"],[1,"col-12","col-lg-6","mb-2"],["class","w-100",4,"ngIf"],[3,"change"],[1,"w-100"],["matInput","","type","text",3,"formControl","matAutocomplete","keyup"],["autoActiveFirstOption","",3,"displayWith"],["auto","matAutocomplete"],[3,"value","onSelectionChange"],[3,"value","onSelectionChange",4,"ngFor","ngForOf"],["autoActiveFirstOption","",3,"displayWith","ngClass"],["matInput","","type","text",3,"matAutocomplete","formControl"],[3,"facility","resource","group","member","service"]],template:function(t,a){t&1&&(l(0,"div")(1,"h1",0),f(2),d(3,"translate"),s(),_(4,ea,8,7,"div",1)(5,ta,1,5,"perun-web-apps-service-configurator",2),s()),t&2&&(r(2),T(u(3,3,"FACILITY_DETAIL.SERVICE_CONFIG.TITLE")),r(2),c("ngIf",!!a.facility),r(),c("ngIf",!!a.facility))},dependencies:[ut,ft,L,Ai,Et,Fi,Ut,xt,Ft,Rt,wt,Lt,zt,gt,A,ee]});let i=o;return i})();var He=(()=>{let o=class o{constructor(e,t,a){this.facilityService=e,this.guiAuthResolver=t,this.entityStorageService=a,this.disableRouting=!1,this.disableSelf=!1,this.availableRoles=[],this.selected="user",this.type="Facility",this.theme="facility-theme"}ngOnInit(){this.facility=this.entityStorageService.getEntity(),this.guiAuthResolver.assignAvailableRoles(this.availableRoles,"Facility")}};o.\u0275fac=function(t){return new(t||o)(m(w),m(D),m(F))},o.\u0275cmp=E({type:o,selectors:[["app-perun-web-apps-facility-settings-managers"]],hostVars:2,hostBindings:function(t,a){t&2&&k("router-component",a.true)},inputs:{disableRouting:"disableRouting",disableSelf:"disableSelf"},decls:1,vars:6,consts:[[3,"complementaryObject","availableRoles","complementaryObjectType","disableSelf","disableRouting","theme"]],template:function(t,a){t&1&&v(0,"app-managers-page",0),t&2&&c("complementaryObject",a.facility)("availableRoles",a.availableRoles)("complementaryObjectType",a.type)("disableSelf",a.disableSelf)("disableRouting",a.disableRouting)("theme",a.theme)},dependencies:[Pe]});let i=o;return i})();function ra(i,o){i&1&&(l(0,"perun-web-apps-alert",10),f(1),d(2,"translate"),s()),i&2&&(r(),S(" ",u(2,1,"FACILITY_DETAIL.SERVICES_DESTINATIONS.DESTINATIONS_INFO")," "))}function sa(i,o){if(i&1){let n=C();l(0,"button",11),g("click",function(){y(n);let t=h();return b(t.addDestination())}),f(1),d(2,"translate"),s()}i&2&&(r(),S(" ",u(2,1,"FACILITY_DETAIL.SERVICES_DESTINATIONS.ADD")," "))}function la(i,o){if(i&1){let n=C();l(0,"button",12),g("click",function(){y(n);let t=h();return b(t.removeDestination())}),f(1),d(2,"translate"),s()}if(i&2){let n=h();c("disabled",n.loading||n.selected.selected.length===0),r(),S(" ",u(2,2,"FACILITY_DETAIL.SERVICES_DESTINATIONS.REMOVE")," ")}}function ca(i,o){if(i&1){let n=C();l(0,"button",13),g("click",function(){y(n);let t=h();return b(t.onAllow())}),l(1,"mat-icon"),f(2," check_circle_outline "),s(),f(3),d(4,"translate"),s()}if(i&2){let n=h();c("disabled",n.loading||n.selected.selected.length===0||n.allSelectedAllowed()),r(3),S(" ",u(4,2,"FACILITY_DETAIL.SERVICES_DESTINATIONS.ALLOW")," ")}}function pa(i,o){if(i&1){let n=C();l(0,"button",13),g("click",function(){y(n);let t=h();return b(t.onBlock())}),l(1,"mat-icon"),f(2," block "),s(),f(3),d(4,"translate"),s()}if(i&2){let n=h();c("disabled",n.loading||n.selected.selected.length===0||n.allSelectedBlocked()),r(3),S(" ",u(4,2,"FACILITY_DETAIL.SERVICES_DESTINATIONS.BLOCK")," ")}}function ma(i,o){i&1&&v(0,"perun-web-apps-loading-table")}function da(i,o){if(i&1&&v(0,"app-perun-web-apps-destination-list",14),i&2){let n=h();c("filterValue",n.filterValue)("loading",n.loading)("selection",n.selected)("cachedSubject",n.cachedSubject)("destinations",n.destinations)("services",n.configServicesIds)("displayedColumns",n.displayedColumns)("tableId",n.tableId)}}var ze=(()=>{let o=class o{constructor(e,t,a,p,I,x,H){this.dialog=e,this.servicesManager=t,this.translate=a,this.notificator=p,this.authResolver=I,this.serviceManager=x,this.entityStorageService=H,this.displayedColumns=["select","destinationId","service","destination","type","status","propagationType","lastSuccessfulPropagation"],this.configServices=[],this.configServicesIds=new Set,this.title="FACILITY_DETAIL.SERVICES_DESTINATIONS.TITLE",this.destinationEmitter=new ue,this.destinations=[],this.selected=new V(!0,[],!0,(z,J)=>z.id===J.id&&z.facility?.id===J.facility?.id&&z.service?.id===J.service?.id),this.cachedSubject=new B(!0),this.filterValue="",this.tableId=Nt}ngOnInit(){this.loading=!0,this.facility=this.entityStorageService.getEntity(),this.setAuthRights(),this.refreshTable()}refreshTable(){this.loading=!0,this.servicesManager.getAllRichDestinationsForFacility(this.facility.id).subscribe(e=>{this.destinations=e,this.destinationEmitter.emit(this.destinations),this.selected.clear(),this.cachedSubject.next(!0),this.setAuthRights(),this.loading=!1})}setAuthRights(){this.addAuth=this.authResolver.isAuthorized("addDestination_Service_Facility_Destination_policy",[this.facility]),this.removeAuth=this.authResolver.isAuthorized("removeDestination_Service_Facility_Destination_policy",[this.facility]),this.allowAuth=this.authResolver.isAuthorized("unblockServiceOnDestination_Service_int_policy",[this.facility]),this.blockAuth=this.authResolver.isAuthorized("blockServiceOnDestination_Service_int_policy",[this.facility]),this.displayedColumns=this.removeAuth?this.displayedColumns:this.displayedColumns.filter(e=>e!=="select")}addDestination(){let e=M();e.width="600px",e.data={facility:this.facility,theme:"facility-theme",configServices:this.configServices},this.dialog.open(Ui,e).afterClosed().subscribe(a=>{a&&(this.refreshTable(),this.notificator.showSuccess(this.translate.instant("FACILITY_DETAIL.SERVICES_DESTINATIONS.ADD_SUCCESS")))})}removeDestination(){let e=M();e.width="600px",e.data={destinations:this.selected.selected,theme:"facility-theme"},this.dialog.open(Gi,e).afterClosed().subscribe(a=>{a&&this.refreshTable()})}blockServicesOnDestinations(e){this.serviceManager.blockServicesOnDestinations({richDestinations:e}).subscribe({next:()=>{this.notificator.showSuccess(this.translate.instant("FACILITY_DETAIL.SERVICES_DESTINATIONS.BLOCK_SUCCESS")),this.refreshTable()},error:()=>this.loading=!1})}onBlock(){this.loading=!0,this.blockServicesOnDestinations(this.selected.selected)}allowServicesOnDestinations(e){this.serviceManager.unblockServicesOnDestinations({richDestinations:e}).subscribe({next:()=>{this.notificator.showSuccess(this.translate.instant("FACILITY_DETAIL.SERVICES_DESTINATIONS.ALLOW_SUCCESS")),this.refreshTable()},error:()=>this.loading=!1})}onAllow(){this.loading=!0,this.allowServicesOnDestinations(this.selected.selected)}applyFilter(e){this.filterValue=e,this.refreshTable()}allSelectedAllowed(){return this.selected.selected.reduce((e,t)=>e&&!t.blocked,!0)}allSelectedBlocked(){return this.selected.selected.reduce((e,t)=>e&&t.blocked,!0)}};o.id="FacilityServicesDestinationsComponent",o.\u0275fac=function(t){return new(t||o)(m(Y),m(ae),m(bt),m(Z),m(D),m(ae),m(F))},o.\u0275cmp=E({type:o,selectors:[["app-perun-web-apps-facility-services-destinations"]],hostVars:2,hostBindings:function(t,a){t&2&&k("router-component",a.true)},inputs:{displayedColumns:"displayedColumns",configServices:"configServices",configServicesIds:"configServicesIds",title:"title",loading:"loading"},outputs:{destinationEmitter:"destinationEmitter"},decls:15,vars:11,consts:[[1,"page-subtitle"],["alert_type","info",4,"ngIf"],[3,"refresh"],["color","accent","class","me-2 action-button","mat-flat-button","",3,"click",4,"ngIf"],["class","me-2","color","warn","mat-flat-button","",3,"disabled","click",4,"ngIf"],["class","me-2","mat-stroked-button","",3,"disabled","click",4,"ngIf"],[3,"placeholder","filter"],["spinner",""],[1,"position-relative","table-min-height"],[3,"filterValue","loading","selection","cachedSubject","destinations","services","displayedColumns","tableId",4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],["alert_type","info"],["color","accent","mat-flat-button","",1,"me-2","action-button",3,"click"],["color","warn","mat-flat-button","",1,"me-2",3,"disabled","click"],["mat-stroked-button","",1,"me-2",3,"disabled","click"],[3,"filterValue","loading","selection","cachedSubject","destinations","services","displayedColumns","tableId"]],template:function(t,a){if(t&1&&(l(0,"div")(1,"h1",0),f(2),d(3,"translate"),s(),_(4,ra,3,3,"perun-web-apps-alert",1),l(5,"perun-web-apps-refresh-button",2),g("refresh",function(){return a.refreshTable()}),s(),_(6,sa,3,3,"button",3)(7,la,3,4,"button",4)(8,ca,5,4,"button",5)(9,pa,5,4,"button",5),l(10,"perun-web-apps-debounce-filter",6),g("filter",function(I){return a.applyFilter(I)}),s(),_(11,ma,1,0,"ng-template",null,7,P),l(13,"div",8),_(14,da,1,8,"app-perun-web-apps-destination-list",9),s()()),t&2){let p=R(12);r(2),T(u(3,9,a.title)),r(2),c("ngIf",a.title.includes("CONFIG")),r(2),c("ngIf",a.addAuth),r(),c("ngIf",a.removeAuth),r(),c("ngIf",a.allowAuth),r(),c("ngIf",a.blockAuth),r(),c("placeholder","FACILITY_DETAIL.SERVICES_DESTINATIONS.FILTER"),r(4),c("perunWebAppsLoader",a.loading)("perunWebAppsLoaderIndicator",p)}},dependencies:[L,le,N,Ge,De,G,W,U,j,A]});let i=o;return i})();function ha(i,o){if(i&1){let n=C();l(0,"button",8),g("click",function(){y(n);let t=h();return b(t.onCreate())}),f(1),d(2,"translate"),s()}i&2&&(r(),S(" ",u(2,1,"FACILITY_DETAIL.SETTINGS.OWNERS.ADD"),`
`))}function ga(i,o){if(i&1){let n=C();l(0,"button",9),g("click",function(){y(n);let t=h();return b(t.onRemove())}),f(1),d(2,"translate"),s()}if(i&2){let n=h();c("disabled",n.loading||n.selection.selected.length===0),r(),S(" ",u(2,2,"FACILITY_DETAIL.SETTINGS.OWNERS.DELETE"),`
`)}}function _a(i,o){i&1&&v(0,"perun-web-apps-loading-table")}function Sa(i,o){if(i&1&&v(0,"perun-web-apps-owners-list",10),i&2){let n=h();c("displayedColumns",n.displayedColumns)("loading",n.loading)("filterValue",n.filterValue)("owners",n.owners)("selection",n.selection)("cachedSubject",n.cachedSubject)("tableId",n.tableId)}}var $e=(()=>{let o=class o{constructor(e,t,a,p){this.facilitiesManagerService=e,this.dialog=t,this.authResolver=a,this.entityStorageService=p,this.ownerEmitter=new ue,this.owners=[],this.selection=new V(!0,[],!0,(I,x)=>I.id===x.id),this.cachedSubject=new B(!0),this.displayedColumns=["id","name","contact","type"],this.tableId=Gt}ngOnInit(){this.filterValue="",this.facility=this.entityStorageService.getEntity(),this.setAuthRights(),this.refreshTable()}refreshTable(){this.loading=!0,this.selection.clear(),this.cachedSubject.next(!0),this.facilitiesManagerService.getFacilityOwners(this.facility.id).subscribe(e=>{this.owners=e,this.ownerEmitter.emit(this.owners),this.loading=!1})}setAuthRights(){this.addAuth=this.authResolver.isAuthorized("addOwner_Facility_Owner_policy",[this.facility]),this.removeAuth=this.authResolver.isAuthorized("removeOwner_Facility_Owner_policy",[this.facility]),this.displayedColumns=this.removeAuth?["select","id","name","contact","type"]:["id","name","contact","type"]}applyFilter(e){this.filterValue=e,this.refreshTable()}onCreate(){let e=M();e.width="800px",e.data={theme:"facility-theme",facilityId:this.facility.id,forbiddenOwners:this.owners.map(a=>a.id)},this.dialog.open($i,e).afterClosed().subscribe(a=>{a&&this.refreshTable()})}onRemove(){let e=M();e.width="600px",e.data={theme:"facility-theme",owners:this.selection.selected,facilityId:this.facility.id},this.dialog.open(Ki,e).afterClosed().subscribe(a=>{a&&this.refreshTable()})}};o.\u0275fac=function(t){return new(t||o)(m(w),m(Y),m(D),m(F))},o.\u0275cmp=E({type:o,selectors:[["app-facility-settings-owners"]],outputs:{ownerEmitter:"ownerEmitter"},decls:11,vars:8,consts:[[1,"page-subtitle"],[3,"refresh"],["class","me-2 action-button","color","accent","mat-flat-button","",3,"click",4,"ngIf"],["class","me-2","color","warn","mat-flat-button","",3,"disabled","click",4,"ngIf"],[3,"placeholder","filter"],["spinner",""],[1,"position-relative","table-min-height"],[3,"displayedColumns","loading","filterValue","owners","selection","cachedSubject","tableId",4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],["color","accent","mat-flat-button","",1,"me-2","action-button",3,"click"],["color","warn","mat-flat-button","",1,"me-2",3,"disabled","click"],[3,"displayedColumns","loading","filterValue","owners","selection","cachedSubject","tableId"]],template:function(t,a){if(t&1&&(l(0,"h1",0),f(1),d(2,"translate"),s(),l(3,"perun-web-apps-refresh-button",1),g("refresh",function(){return a.refreshTable()}),s(),_(4,ha,3,3,"button",2)(5,ga,3,4,"button",3),l(6,"perun-web-apps-debounce-filter",4),g("filter",function(I){return a.applyFilter(I)}),s(),_(7,_a,1,0,"ng-template",null,5,P),l(9,"div",6),_(10,Sa,1,7,"perun-web-apps-owners-list",7),s()),t&2){let p=R(8);r(),T(u(2,6,"FACILITY_DETAIL.SETTINGS.OWNERS.TITLE")),r(3),c("ngIf",a.addAuth),r(),c("ngIf",a.removeAuth),r(),c("placeholder","VO_MANAGEMENT.FILTER_PLACEHOLDER"),r(4),c("perunWebAppsLoader",a.loading)("perunWebAppsLoaderIndicator",p)}},dependencies:[L,N,G,W,U,Ne,j,A]});let i=o;return i})();function ya(i,o){if(i&1){let n=C();l(0,"button",8),g("click",function(){y(n);let t=h();return b(t.addHost())}),f(1),d(2,"translate"),s()}i&2&&(r(),S(" ",u(2,1,"FACILITY_DETAIL.HOSTS.ADD")," "))}function ba(i,o){if(i&1){let n=C();l(0,"button",9),g("click",function(){y(n);let t=h();return b(t.removeHost())}),f(1),d(2,"translate"),s()}if(i&2){let n=h();c("disabled",n.loading||n.selected.selected.length===0),r(),S(" ",u(2,2,"FACILITY_DETAIL.HOSTS.REMOVE")," ")}}function Ca(i,o){i&1&&v(0,"perun-web-apps-loading-table")}function Ta(i,o){if(i&1&&v(0,"app-hosts-list",10),i&2){let n=h();c("disableRouting",!n.routeAuth||n.disableRouting)("loading",n.loading)("filterValue",n.filterValue)("hosts",n.hosts)("selection",n.selected)("cachedSubject",n.cachedSubject)("displayedColumns",n.displayedColumns)("facilityId",n.facility.id)("tableId",n.tableId)}}var Ke=(()=>{let o=class o{constructor(e,t,a,p){this.dialog=e,this.facilitiesManager=t,this.authResolver=a,this.entityStorageService=p,this.disableRouting=!1,this.hostEmitter=new ue,this.hosts=[],this.selected=new V(!0,[],!0,(I,x)=>I.id===x.id),this.cachedSubject=new B(!0),this.filterValue="",this.tableId=kt,this.displayedColumns=["id","name"]}ngOnInit(){this.loading=!0,this.facility=this.entityStorageService.getEntity(),this.setAuthRights(),this.refreshTable()}refreshTable(){this.loading=!0,this.facilitiesManager.getHosts(this.facility.id).subscribe(e=>{this.hosts=e,this.hostEmitter.emit(this.hosts),this.selected.clear(),this.cachedSubject.next(!0),this.setAuthRights(),this.loading=!1})}setAuthRights(){this.addAuth=this.authResolver.isAuthorized("addHosts_Facility_List<String>_policy",[this.facility]),this.removeAuth=this.authResolver.isAuthorized("removeHosts_List<Host>_Facility_policy",[this.facility]),this.displayedColumns=this.removeAuth?["select","id","name"]:["id","name"],this.hosts.length!==0&&(this.routeAuth=this.authResolver.isAuthorized("getHostById_int_policy",[this.facility,this.hosts[0]]))}addHost(){let e=M();e.width="600px",e.data={facilityId:this.facility.id,theme:"facility-theme"},this.dialog.open(Hi,e).afterClosed().subscribe(a=>{a&&this.refreshTable()})}removeHost(){let e=M();e.width="600px",e.data={facilityId:this.facility.id,theme:"facility-theme",hosts:this.selected.selected},this.dialog.open(zi,e).afterClosed().subscribe(a=>{a&&this.refreshTable()})}applyFilter(e){this.filterValue=e,this.refreshTable()}};o.\u0275fac=function(t){return new(t||o)(m(Y),m(w),m(D),m(F))},o.\u0275cmp=E({type:o,selectors:[["app-facility-hosts"]],inputs:{disableRouting:"disableRouting"},outputs:{hostEmitter:"hostEmitter"},decls:12,vars:8,consts:[[1,"page-subtitle"],[3,"refresh"],["color","accent","class","me-2 action-button","mat-flat-button","",3,"click",4,"ngIf"],["class","me-2","color","warn","mat-flat-button","",3,"disabled","click",4,"ngIf"],[3,"placeholder","filter"],["spinner",""],[1,"position-relative","table-min-height"],[3,"disableRouting","loading","filterValue","hosts","selection","cachedSubject","displayedColumns","facilityId","tableId",4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],["color","accent","mat-flat-button","",1,"me-2","action-button",3,"click"],["color","warn","mat-flat-button","",1,"me-2",3,"disabled","click"],[3,"disableRouting","loading","filterValue","hosts","selection","cachedSubject","displayedColumns","facilityId","tableId"]],template:function(t,a){if(t&1&&(l(0,"div")(1,"h1",0),f(2),d(3,"translate"),s(),l(4,"perun-web-apps-refresh-button",1),g("refresh",function(){return a.refreshTable()}),s(),_(5,ya,3,3,"button",2)(6,ba,3,4,"button",3),l(7,"perun-web-apps-debounce-filter",4),g("filter",function(I){return a.applyFilter(I)}),s(),_(8,Ca,1,0,"ng-template",null,5,P),l(10,"div",6),_(11,Ta,1,9,"app-hosts-list",7),s()()),t&2){let p=R(9);r(2),T(u(3,6,"FACILITY_DETAIL.HOSTS.TITLE")),r(3),c("ngIf",a.addAuth),r(),c("ngIf",a.removeAuth),r(),c("placeholder","FACILITY_DETAIL.HOSTS.FILTER"),r(4),c("perunWebAppsLoader",a.loading)("perunWebAppsLoaderIndicator",p)}},dependencies:[L,N,Ue,G,W,U,j,A]});let i=o;return i})();function Aa(i,o){i&1&&v(0,"perun-web-apps-loading-table")}function Fa(i,o){if(i&1&&v(0,"app-perun-web-apps-blacklist-list",6),i&2){let n=h();c("bansOnFacilitiesWithUsers",n.bansOnFacilitiesWithUsers)("loading",n.loading)("filterValue",n.filterValue)("selection",n.selected)("cachedSubject",n.cachedSubject)("tableId",n.tableId)}}var gn=(()=>{let o=class o{constructor(e,t,a){this.facilitiesManager=e,this.usersManager=t,this.entityStorageService=a,this.bansOnFacilitiesWithUsers=[],this.selected=new V(!0,[],!0,([p,I],[x,H])=>p.id===x.id&&I.id===H.id),this.cachedSubject=new B(!0),this.filterValue="",this.tableId=Vt}ngOnInit(){this.loading=!0,this.facility=this.entityStorageService.getEntity(),this.refreshTable()}refreshTable(){this.loading=!0,this.facilitiesManager.getBansForFacility(this.facility.id).subscribe(e=>{let t=e;for(let a of t){let p;this.usersManager.getUserById(a.userId).subscribe(I=>{p=I}),this.bansOnFacilitiesWithUsers.push([a,p])}this.selected.clear(),this.cachedSubject.next(!0),this.loading=!1})}applyFilter(e){this.filterValue=e,this.refreshTable()}};o.\u0275fac=function(t){return new(t||o)(m(w),m(yt),m(F))},o.\u0275cmp=E({type:o,selectors:[["app-perun-web-apps-facility-settings-blacklist"]],decls:11,vars:8,consts:[[1,"page-subtitle"],[3,"refresh"],[3,"placeholder","filter"],["spinner",""],[1,"position-relative","table-min-height"],[3,"bansOnFacilitiesWithUsers","loading","filterValue","selection","cachedSubject","tableId",4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],[3,"bansOnFacilitiesWithUsers","loading","filterValue","selection","cachedSubject","tableId"]],template:function(t,a){if(t&1&&(l(0,"div")(1,"h1",0),f(2),d(3,"translate"),s(),l(4,"perun-web-apps-refresh-button",1),g("refresh",function(){return a.refreshTable()}),s(),l(5,"perun-web-apps-debounce-filter",2),g("filter",function(I){return a.applyFilter(I)}),d(6,"translate"),s(),_(7,Aa,1,0,"ng-template",null,3,P),l(9,"div",4),_(10,Fa,1,6,"app-perun-web-apps-blacklist-list",5),s()()),t&2){let p=R(8);r(2),T(u(3,4,"FACILITY_DETAIL.SETTINGS.BLACKLIST.TITLE")),r(3),c("placeholder",u(6,6,"FACILITY_DETAIL.SETTINGS.BLACKLIST.FILTER")),r(5),c("perunWebAppsLoader",a.loading)("perunWebAppsLoaderIndicator",p)}},dependencies:[Yi,G,W,U,j,A]});let i=o;return i})();var _n=(()=>{let o=class o{constructor(e,t){this.facilityManager=e,this.route=t,this.host={beanName:"",id:0}}ngOnInit(){this.route.params.subscribe(e=>{this.hostId=Number(e.hostId),this.facilityManager.getHostById(this.hostId).subscribe(t=>{this.host=t})})}};o.\u0275fac=function(t){return new(t||o)(m(w),m(ge))},o.\u0275cmp=E({type:o,selectors:[["app-facility-hosts-detail"]],decls:5,vars:6,consts:[[1,"page-subtitle"],[3,"entityId","entity"]],template:function(t,a){t&1&&(l(0,"div")(1,"h1",0),f(2),d(3,"translate"),s(),v(4,"app-one-entity-attribute-page",1),s()),t&2&&(r(2),oe(" ",u(3,4,"FACILITY_DETAIL.HOSTS.HOSTS_DETAIL.TITLE")," ",a.host.hostname," "),r(2),c("entityId",a.hostId)("entity","host"))},dependencies:[Be,A]});let i=o;return i})();function xa(i,o){i&1&&v(0,"perun-web-apps-loading-table")}function Ra(i,o){if(i&1&&v(0,"app-security-teams-list",6),i&2){let n=h();c("displayedColumns",n.displayedColumns)("loading",n.loading)("filterValue",n.filterValue)("securityTeams",n.securityTeams)("selection",n.selected)("cachedSubject",n.cachedSubject)("tableId",n.tableId)}}var Sn=(()=>{let o=class o{constructor(e,t,a){this.facilitiesManager=e,this.authResolver=t,this.entityStorageService=a,this.securityTeams=[],this.selected=new V(!0,[],!0,(p,I)=>p.id===I.id),this.cachedSubject=new B(!0),this.filterValue="",this.tableId=Bt,this.displayedColumns=[]}ngOnInit(){this.facility=this.entityStorageService.getEntity(),this.refreshTable()}refreshTable(){this.loading=!0,this.facilitiesManager.getAssignedSecurityTeams(this.facility.id).subscribe(e=>{this.securityTeams=e,this.selected.clear(),this.cachedSubject.next(!0),this.setAuthRights(),this.loading=!1})}setAuthRights(){this.addAuth=this.authResolver.isAuthorized("assignSecurityTeam_Facility_SecurityTeam_policy",[this.facility]),this.removeAuth=this.authResolver.isAuthorized("removeSecurityTeam_Facility_SecurityTeam_policy",[this.facility]),this.displayedColumns=this.removeAuth?["select","id","name","description"]:["id","name","description"]}applyFilter(e){this.filterValue=e,this.refreshTable()}};o.\u0275fac=function(t){return new(t||o)(m(w),m(D),m(F))},o.\u0275cmp=E({type:o,selectors:[["app-facility-security-teams"]],decls:10,vars:6,consts:[[1,"page-subtitle"],[3,"refresh"],[3,"placeholder","filter"],["spinner",""],[1,"position-relative","table-min-height"],[3,"displayedColumns","loading","filterValue","securityTeams","selection","cachedSubject","tableId",4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],[3,"displayedColumns","loading","filterValue","securityTeams","selection","cachedSubject","tableId"]],template:function(t,a){if(t&1&&(l(0,"div")(1,"h1",0),f(2),d(3,"translate"),s(),l(4,"perun-web-apps-refresh-button",1),g("refresh",function(){return a.refreshTable()}),s(),l(5,"perun-web-apps-debounce-filter",2),g("filter",function(I){return a.applyFilter(I)}),s(),_(6,xa,1,0,"ng-template",null,3,P),l(8,"div",4),_(9,Ra,1,7,"app-security-teams-list",5),s()()),t&2){let p=R(7);r(2),T(u(3,4,"FACILITY_DETAIL.SECURITY_TEAMS.TITLE")),r(3),c("placeholder","FACILITY_DETAIL.SECURITY_TEAMS.FILTER"),r(4),c("perunWebAppsLoader",a.loading)("perunWebAppsLoaderIndicator",p)}},dependencies:[Wi,G,W,U,j,A]});let i=o;return i})();function wa(i,o){if(i&1){let n=C();l(0,"button",12),g("click",function(){y(n);let t=h();return b(t.forcePropagation())}),f(1),d(2,"translate"),s()}if(i&2){let n=h();c("disabled",n.selected.selected.length===0||n.disableForcePropagationButton||n.loading),r(),S(" ",u(2,2,"FACILITY_DETAIL.SERVICES_STATUS.FORCE_PROPAGATION")," ")}}function La(i,o){if(i&1){let n=C();l(0,"button",12),g("click",function(){y(n);let t=h();return b(t.allow())}),f(1),d(2,"translate"),s()}if(i&2){let n=h();c("disabled",n.selected.selected.length===0||n.disableAllowButton||n.loading),r(),S(" ",u(2,2,"FACILITY_DETAIL.SERVICES_STATUS.ALLOW")," ")}}function Da(i,o){if(i&1){let n=C();l(0,"button",13),g("click",function(){y(n);let t=h();return b(t.block())}),f(1),d(2,"translate"),s()}if(i&2){let n=h();c("disabled",n.selected.selected.length===0||n.disableBlockButton||n.loading),r(),S(" ",u(2,2,"FACILITY_DETAIL.SERVICES_STATUS.BLOCK")," ")}}function Ma(i,o){if(i&1&&(l(0,"button",14),d(1,"translate"),f(2),d(3,"translate"),s()),i&2){let n=h(),e=R(10);he("matTooltip",u(1,5,"DIALOGS.REMOVE_SERVICE_FROM_FACILITY.CHECKBOXES_DISABLED")),c("disabled",n.selected.selected.length===0||n.disableRemoveButton||n.loading)("matMenuTriggerFor",e)("matTooltipDisabled",!n.disableRemoveButton),r(2),S(" ",u(3,7,"FACILITY_DETAIL.SERVICES_STATUS.REMOVE")," ")}}function Oa(i,o){if(i&1){let n=C();l(0,"button",7),g("click",function(){y(n);let t=h();return b(t.removeTaskResults())}),f(1),d(2,"translate"),s()}i&2&&(r(),S(" ",u(2,1,"FACILITY_DETAIL.SERVICES_STATUS.REMOVE_TASK_RESULTS")," "))}function Na(i,o){i&1&&v(0,"perun-web-apps-loading-table")}function ka(i,o){if(i&1){let n=C();l(0,"perun-web-apps-services-status-list",15),g("selectionChange",function(){y(n);let t=h();return b(t.selectionChanged())}),s()}if(i&2){let n=h();c("disableRouting",!n.routeAuth)("loading",n.loading)("filterValue",n.filterValue)("servicesStatus",n.servicesStates)("selection",n.selected)("cachedSubject",n.cachedSubject)("tableId",n.tableId)}}var vn=(()=>{let o=class o{constructor(e,t,a,p,I,x,H,z,J){this.tasksManager=e,this.servicesManager=t,this.notificator=a,this.translate=p,this.authResolver=I,this.facilityManager=x,this.resourcesManager=H,this.dialog=z,this.entityStorageService=J,this.servicesStates=[],this.selected=new V(!0,[],!0,(Xe,ne)=>Xe.service.id===ne.service.id),this.cachedSubject=new B(!0),this.filterValue="",this.tableId=Pt,this.disableAllowButton=!0,this.disableBlockButton=!0,this.disableRemoveButton=!0,this.disableForcePropagationButton=!1}ngOnInit(){this.loading=!0,this.facility=this.entityStorageService.getEntity(),this.setAuthRights(),this.refreshTable()}forcePropagation(){let e=this.selected.selected.map(t=>t.service.id);this.servicesManager.forceServicePropagationBulk(e,this.facility.id).subscribe({next:()=>{this.notificator.showInstantSuccess("FACILITY_DETAIL.SERVICES_STATUS.SUCCESS_FORCE_PROPAGATION"),this.loading=!1,this.refreshTable()},error:()=>{this.loading=!1}})}allow(){let e=this.selected.selected.map(t=>t.service.id);this.servicesManager.unblockServicesOnFacility(e,this.facility.id).subscribe({next:()=>{this.notificator.showInstantSuccess("FACILITY_DETAIL.SERVICES_STATUS.SUCCESS_ALLOW"),this.refreshTable()},error:()=>{this.loading=!1}})}block(){let e=this.selected.selected.map(t=>t.service.id);this.servicesManager.blockServicesOnFacility(e,this.facility.id).subscribe({next:()=>{this.notificator.showInstantSuccess("FACILITY_DETAIL.SERVICES_STATUS.SUCCESS_BLOCK"),this.refreshTable()},error:()=>{this.loading=!1}})}removeTaskResults(){this.loading=!0,this.tasksManager.getTaskResultsForGUIByTask(this.selected.selected[0].task.id).subscribe(e=>{let t=M();t.width="600px",t.data={theme:"facility-theme",taskResults:e},this.loading=!1,this.dialog.open(Ye,t)})}removeServiceFromFacility(){this.loading=!0,this.facilityManager.getAssignedResourcesByAssignedServiceForFacility(this.selected.selected[0].facility.id,this.selected.selected[0].service.id).subscribe({next:e=>{let t=M();t.width="600px",this.taskId=this.taskIsNull?null:this.selected.selected[0].task.id,e.length===0?(t.data={theme:"facility-theme",taskId:this.taskId},this.loading=!1,this.dialog.open(Qi,t).afterClosed().subscribe(p=>{p&&(this.disableRemoveButton=!0,this.refreshTable())})):this.resourcesManager.getRichResourcesByIds(e.map(a=>a.id)).subscribe(a=>{t.data={theme:"facility-theme",taskId:this.taskId,serviceId:this.selected.selected[0].service.id,facilityId:this.selected.selected[0].facility.id,resource:a},this.loading=!1,this.dialog.open(qi,t).afterClosed().subscribe(I=>{I&&(this.disableRemoveButton=!0,this.refreshTable())})})},error:()=>this.loading=!1})}refreshTable(){this.loading=!0,this.tasksManager.getFacilityServicesState(this.facility.id).subscribe(e=>{this.servicesStates=e,this.selected.clear(),this.cachedSubject.next(!0),this.setAuthRights(),this.loading=!1})}setAuthRights(){this.propagationAuth=this.authResolver.isAuthorized("forceServicePropagation_Facility_Service_policy",[this.facility]),this.blockAuth=this.authResolver.isAuthorized("blockServiceOnFacility_Service_Facility_policy",[this.facility]),this.allowAuth=this.authResolver.isAuthorized("unblockServiceOnFacility_Service_Facility_policy",[this.facility]),this.deleteAuth=this.authResolver.isAuthorized("deleteTask_Task_policy",[this.facility]),this.routeAuth=this.authResolver.isAuthorized("getTaskResultsByTask_int_policy",[this.facility])}applyFilter(e){this.filterValue=e,this.refreshTable()}selectionChanged(){this.disableBlockButton=!1,this.disableAllowButton=!1,this.disableRemoveButton=this.selected.selected.length!==1,this.disableForcePropagationButton=!1,this.disableRemoveButton||(this.taskIsNull=this.selected.selected[0].task===null);for(let e of this.selected.selected)e.blockedOnFacility?(this.disableBlockButton=!0,this.disableForcePropagationButton=!0):this.disableAllowButton=!0}};o.\u0275fac=function(t){return new(t||o)(m(we),m(ae),m(Z),m(re),m(D),m(w),m(Re),m(Y),m(F))},o.\u0275cmp=E({type:o,selectors:[["app-facility-service-status"]],decls:20,vars:14,consts:[[1,"page-subtitle"],[3,"refresh"],["class","me-2","color","accent","mat-flat-button","",3,"disabled","click",4,"ngIf"],["class","me-2","color","warn","mat-flat-button","",3,"disabled","click",4,"ngIf"],["mat-flat-button","","class","me-2 dropdown-toggle","color","warn",3,"disabled","matMenuTriggerFor","matTooltipDisabled","matTooltip",4,"ngIf"],["menu","matMenu"],["mat-menu-item","",3,"click",4,"ngIf"],["mat-menu-item","",3,"click"],[3,"placeholder","filter"],["spinner",""],[1,"position-relative","table-min-height"],[3,"disableRouting","loading","filterValue","servicesStatus","selection","cachedSubject","tableId","selectionChange",4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],["color","accent","mat-flat-button","",1,"me-2",3,"disabled","click"],["color","warn","mat-flat-button","",1,"me-2",3,"disabled","click"],["mat-flat-button","","color","warn",1,"me-2","dropdown-toggle",3,"disabled","matMenuTriggerFor","matTooltipDisabled","matTooltip"],[3,"disableRouting","loading","filterValue","servicesStatus","selection","cachedSubject","tableId","selectionChange"]],template:function(t,a){if(t&1&&(l(0,"div")(1,"h1",0),f(2),d(3,"translate"),s(),l(4,"perun-web-apps-refresh-button",1),g("refresh",function(){return a.refreshTable()}),s(),_(5,wa,3,4,"button",2)(6,La,3,4,"button",2)(7,Da,3,4,"button",3)(8,Ma,4,9,"button",4),l(9,"mat-menu",null,5),_(11,Oa,3,3,"button",6),l(12,"button",7),g("click",function(){return a.removeServiceFromFacility()}),f(13),d(14,"translate"),s()(),l(15,"perun-web-apps-debounce-filter",8),g("filter",function(I){return a.applyFilter(I)}),s(),_(16,Na,1,0,"ng-template",null,9,P),l(18,"div",10),_(19,ka,1,7,"perun-web-apps-services-status-list",11),s()()),t&2){let p=R(17);r(2),T(u(3,10,"FACILITY_DETAIL.SERVICES_STATUS.TITLE")),r(3),c("ngIf",a.propagationAuth),r(),c("ngIf",a.allowAuth),r(),c("ngIf",a.blockAuth),r(),c("ngIf",a.deleteAuth),r(3),c("ngIf",!a.taskIsNull),r(2),S(" ",u(14,12,"FACILITY_DETAIL.SERVICES_STATUS.REMOVE_SERVICE_FROM_FACILITY")," "),r(2),c("placeholder","SHARED_LIB.PERUN.COMPONENTS.SERVICES_STATUS_LIST.TABLE_SEARCH"),r(4),c("perunWebAppsLoader",a.loading)("perunWebAppsLoaderIndicator",p)}},dependencies:[L,N,Le,Wt,Yt,Ht,G,W,gi,U,j,A]});let i=o;return i})();function Va(i,o){if(i&1){let n=C();l(0,"button",8),g("click",function(){y(n);let t=h();return b(t.removeTaskResult())}),f(1),d(2,"translate"),s()}if(i&2){let n=h();c("disabled",n.loading||n.selection.selected.length===0),r(),S(" ",u(2,2,"FACILITY_DETAIL.TASK_RESULTS.REMOVE"),`
`)}}function Ba(i,o){i&1&&v(0,"perun-web-apps-loading-table")}function Pa(i,o){if(i&1&&v(0,"perun-web-apps-task-results-list",9),i&2){let n=h();c("tableId",n.tableId)("loading",n.loading)("displayedColumns",n.displayedColumns)("filterValue",n.filterValue)("selection",n.selection)("cachedSubject",n.cachedSubject)("taskResults",n.taskResults)}}var In=(()=>{let o=class o{constructor(e,t,a,p,I){this.route=e,this.taskManager=t,this.authResolver=a,this.dialog=p,this.entityStorageService=I,this.loading=!1,this.filterValue="",this.selection=new V(!0,[],!0,(x,H)=>x.id===H.id),this.task={id:0},this.taskResults=[],this.cachedSubject=new B(!0),this.tableId=jt,this.displayedColumns=["select","id","destination","type","service","status","time","returnCode","standardMessage","errorMessage"],this.removeAuth=!1}ngOnInit(){this.loading=!0,this.facility=this.entityStorageService.getEntity(),this.removeAuth=this.authResolver.isAuthorized("deleteTask_Task_policy",[this.facility]),this.removeAuth||(this.displayedColumns=["id","destination","type","service","status","time","returnCode","standardMessage","errorMessage"]),this.route.params.subscribe(e=>{this.taskId=Number(e.taskId),this.taskManager.getTaskById(this.taskId).subscribe(t=>{this.task=t,this.refreshTable()})})}refreshTable(){this.loading=!0,this.taskManager.getTaskResultsForGUIByTask(this.taskId).subscribe(e=>{this.selection.clear(),this.cachedSubject.next(!0),this.taskResults=e,this.loading=!1})}removeTaskResult(){let e=M();e.width="600px",e.data={theme:"facility-theme",taskResults:this.selection.selected},this.dialog.open(Ye,e).afterClosed().subscribe(a=>{a&&this.refreshTable()})}applyFilter(e){this.filterValue=e,this.refreshTable()}};o.\u0275fac=function(t){return new(t||o)(m(ge),m(we),m(D),m(Y),m(F))},o.\u0275cmp=E({type:o,selectors:[["app-facility-task-results"]],decls:12,vars:9,consts:[[1,"page-subtitle"],[1,"text-muted"],[3,"refresh"],["class","me-2","color","warn","mat-flat-button","",3,"disabled","click",4,"ngIf"],[3,"placeholder","filter"],["spinner",""],[1,"position-relative","table-min-height"],[3,"tableId","loading","displayedColumns","filterValue","selection","cachedSubject","taskResults",4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],["color","warn","mat-flat-button","",1,"me-2",3,"disabled","click"],[3,"tableId","loading","displayedColumns","filterValue","selection","cachedSubject","taskResults"]],template:function(t,a){if(t&1&&(l(0,"h1",0),f(1),d(2,"translate"),l(3,"span",1),f(4),s()(),l(5,"perun-web-apps-refresh-button",2),g("refresh",function(){return a.refreshTable()}),s(),_(6,Va,3,4,"button",3),l(7,"perun-web-apps-debounce-filter",4),g("filter",function(I){return a.applyFilter(I)}),s(),_(8,Ba,1,0,"ng-template",null,5,P),l(10,"div",6),_(11,Pa,1,7,"perun-web-apps-task-results-list",7),s()),t&2){let p=R(9);r(),oe(" ",u(2,7,"FACILITY_DETAIL.TASK_RESULTS.TITLE")," - ",a.task.service?a.task.service.name:""," "),r(3),S(" \xA0#",a.task.id," "),r(2),c("ngIf",a.removeAuth),r(),c("placeholder","FACILITY_DETAIL.TASK_RESULTS.FILTER"),r(4),c("perunWebAppsLoader",a.loading)("perunWebAppsLoaderIndicator",p)}},dependencies:[L,N,G,W,_i,U,j,A]});let i=o;return i})();var yn=(()=>{let o=class o{constructor(e,t){this.dialogRef=e,this.data=t,this.theme=""}ngOnInit(){this.theme=this.data.theme}onCancel(){this.dialogRef.close(!1)}onSkip(){this.dialogRef.close(!0)}};o.\u0275fac=function(t){return new(t||o)(m(Se),m(ve))},o.\u0275cmp=E({type:o,selectors:[["app-no-service-dialog"]],decls:14,vars:15,consts:[["mat-dialog-title",""],["mat-dialog-content",""],["matDialogActions",""],["mat-stroked-button","",1,"ms-auto","me-2",3,"click"],["color","accent","mat-flat-button","",3,"click"]],template:function(t,a){t&1&&(l(0,"div")(1,"h1",0),f(2),d(3,"translate"),s(),l(4,"div",1),f(5),d(6,"translate"),s(),l(7,"div",2)(8,"button",3),g("click",function(){return a.onCancel()}),f(9),d(10,"translate"),s(),l(11,"button",4),g("click",function(){return a.onSkip()}),f(12),d(13,"translate"),s()()()),t&2&&(fe(a.theme),r(2),T(u(3,7,"DIALOGS.NO_SERVICE.TITLE")),r(3),S(" ",u(6,9,"DIALOGS.NO_SERVICE.INFO")," "),r(4),S(" ",u(10,11,"DIALOGS.NO_SERVICE.CANCEL")," "),r(3),S(" ",u(13,13,"DIALOGS.NO_SERVICE.SKIP")," "))},dependencies:[N,Ie,be,ye,A]});let i=o;return i})();var bn=(()=>{let o=class o{constructor(e,t){this.dialogRef=e,this.data=t,this.theme=""}ngOnInit(){this.theme=this.data.theme}onCancel(){this.dialogRef.close(!1)}onSkip(){this.dialogRef.close(!0)}};o.\u0275fac=function(t){return new(t||o)(m(Se),m(ve))},o.\u0275cmp=E({type:o,selectors:[["app-config-unsaved-dialog"]],decls:14,vars:15,consts:[["mat-dialog-title",""],["mat-dialog-content",""],["matDialogActions",""],["mat-stroked-button","",1,"ms-auto","me-2",3,"click"],["color","accent","mat-flat-button","",3,"click"]],template:function(t,a){t&1&&(l(0,"div")(1,"h1",0),f(2),d(3,"translate"),s(),l(4,"div",1),f(5),d(6,"translate"),s(),l(7,"div",2)(8,"button",3),g("click",function(){return a.onCancel()}),f(9),d(10,"translate"),s(),l(11,"button",4),g("click",function(){return a.onSkip()}),f(12),d(13,"translate"),s()()()),t&2&&(fe(a.theme),r(2),T(u(3,7,"DIALOGS.CONFIG_UNSAVED.TITLE")),r(3),S(" ",u(6,9,"DIALOGS.CONFIG_UNSAVED.INFO")," "),r(4),S(" ",u(10,11,"DIALOGS.CONFIG_UNSAVED.CANCEL")," "),r(3),S(" ",u(13,13,"DIALOGS.CONFIG_UNSAVED.SKIP")," "))},dependencies:[N,Ie,be,ye,A]});let i=o;return i})();function ja(i,o){if(i&1&&(l(0,"div",3),v(1,"i",4),d(2,"translate"),s()),i&2){let n=h();r(),c("innerHTML",u(2,1,n.info),xe)}}function Ga(i,o){if(i&1){let n=C();l(0,"button",10),g("click",function(){y(n);let t=h(2);return b(t.onKeep())}),f(1),d(2,"translate"),s()}i&2&&(r(),S(" ",u(2,1,"DIALOGS.CANCEL_CONFIG.KEEP")," "))}function Ua(i,o){if(i&1){let n=C();l(0,"div",5)(1,"button",6),g("click",function(){y(n);let t=h();return b(t.onCancel())}),f(2),d(3,"translate"),s(),l(4,"button",7),g("click",function(){y(n);let t=h();return b(t.onDelete())}),l(5,"mat-icon",8),f(6," warning "),s(),f(7),d(8,"translate"),s(),_(9,Ga,3,3,"button",9),s()}if(i&2){let n=h();r(2),S(" ",u(3,3,"DIALOGS.CANCEL_CONFIG.CANCEL")," "),r(5),S(" ",u(8,5,"DIALOGS.CANCEL_CONFIG.DELETE")," "),r(2),c("ngIf",!n.lastStep)}}var Cn=(()=>{let o=class o{constructor(e,t,a,p,I){this.dialogRef=e,this.data=t,this.facilityService=a,this.notificator=p,this.translate=I,this.theme="",this.title="",this.info="",this.loading=!1}ngOnInit(){this.theme=this.data.theme,this.lastStep=this.data.lastStep,this.lastStep?(this.title="DIALOGS.CANCEL_CONFIG.TITLE_COMPLETE",this.info="DIALOGS.CANCEL_CONFIG.INFO_COMPLETE"):(this.title="DIALOGS.CANCEL_CONFIG.TITLE_INCOMPLETE",this.info="DIALOGS.CANCEL_CONFIG.INFO_INCOMPLETE")}onCancel(){this.dialogRef.close(!1)}onDelete(){this.loading=!0,this.facilityService.deleteFacility(this.data.facilityId,!0).subscribe(()=>{this.notificator.showSuccess(this.translate.instant("DIALOGS.CANCEL_CONFIG.SUCCESS")),this.dialogRef.close(!0),this.loading=!1},()=>this.loading=!1)}onKeep(){this.dialogRef.close(!0)}};o.\u0275fac=function(t){return new(t||o)(m(Se),m(ve),m(w),m(Z),m(re))},o.\u0275cmp=E({type:o,selectors:[["app-cancel-configuration-dialog"]],decls:6,vars:8,consts:[["mat-dialog-title",""],["mat-dialog-content","",4,"ngIf"],["matDialogActions","",4,"ngIf"],["mat-dialog-content",""],[3,"innerHTML"],["matDialogActions",""],["mat-stroked-button","",1,"me-2",3,"click"],["color","warn","mat-flat-button","",1,"ms-auto","me-2",3,"click"],["iconPositionEnd",""],["color","accent","mat-flat-button","",3,"click",4,"ngIf"],["color","accent","mat-flat-button","",3,"click"]],template:function(t,a){t&1&&(l(0,"div")(1,"h1",0),f(2),d(3,"translate"),s(),_(4,ja,3,3,"div",1)(5,Ua,10,7,"div",2),s()),t&2&&(fe(a.theme),r(2),T(u(3,6,a.title)),r(2),c("ngIf",!a.loading),r(),c("ngIf",!a.loading))},dependencies:[L,le,N,Ie,be,ye,A]});let i=o;return i})();var Ya=["stepper"];function Wa(i,o){i&1&&v(0,"perun-web-apps-loading-table")}function Ha(i,o){i&1&&(f(0),d(1,"translate")),i&2&&T(u(1,1,"FACILITY_CONFIGURATION.OWNERS"))}function za(i,o){if(i&1){let n=C();l(0,"app-facility-settings-owners",15),g("ownerEmitter",function(t){y(n);let a=h();return b(a.owners=t)}),s()}}function $a(i,o){i&1&&(f(0),d(1,"translate")),i&2&&T(u(1,1,"FACILITY_CONFIGURATION.HOSTS"))}function Ka(i,o){if(i&1){let n=C();l(0,"app-facility-hosts",16),g("hostEmitter",function(t){y(n);let a=h();return b(a.hosts=t)}),s()}i&2&&c("disableRouting",!0)}function Xa(i,o){i&1&&(f(0),d(1,"translate")),i&2&&T(u(1,1,"FACILITY_CONFIGURATION.SERVICES"))}var qa=()=>["select","id","name","enabled","description"];function Qa(i,o){if(i&1){let n=C();l(0,"h1",17),f(1),d(2,"translate"),s(),l(3,"perun-web-apps-alert",18),f(4),d(5,"translate"),s(),l(6,"div",19)(7,"perun-web-apps-debounce-filter",20),g("filter",function(t){y(n);let a=h();return b(a.applyFilter(t))}),s(),l(8,"perun-web-apps-service-package-search-select",21),g("packageSelected",function(t){y(n);let a=h();return b(a.packagesSelected(t))}),s()(),l(9,"app-services-list",22),g("selectionChanged",function(){y(n);let t=h();return b(t.singleServiceSelected())}),s()}if(i&2){let n=h();r(),T(u(2,15,"FACILITY_CONFIGURATION.SERVICES")),r(3),S(" ",u(5,17,"FACILITY_CONFIGURATION.SERVICES_INFO")," "),r(3),c("placeholder","FACILITY_CONFIGURATION.SERVICES_FILTER"),r(),c("disableAutoSelect",!0)("selectedPackage",n.selectedPackages)("multiple",!0)("servicePackages",n.servicePackages)("theme","facility-theme"),r(),c("loading",n.processing)("disableRouting",!0)("displayedColumns",q(19,qa))("selection",n.selection)("cachedSubject",n.cachedSubject)("filterValue",n.filterValue)("services",n.services)}}function Ja(i,o){i&1&&(f(0),d(1,"translate")),i&2&&T(u(1,1,"FACILITY_CONFIGURATION.SERVICE_CONFIG"))}function Za(i,o){if(i&1){let n=C();l(0,"perun-web-apps-service-search-select",28),g("serviceSelected",function(t){y(n);let a=h(2);return b(a.filterAttributes(t))}),s()}if(i&2){let n=h(2);c("disableAutoSelect",!0)("services",n.selection.selected)("multiple",!0)("theme","facility-theme")}}function eo(i,o){if(i&1&&v(0,"perun-web-apps-attributes-list",29),i&2){let n=h(2);c("loading",n.processing)("emptyListText","FACILITY_CONFIGURATION.EMPTY_REQ_ATT")("attributes",n.filteredAttributes)("selection",n.attSelection)("cachedSubject",n.cachedSubject)}}function to(i,o){if(i&1){let n=C();l(0,"h1",17),f(1),d(2,"translate"),s(),l(3,"perun-web-apps-alert",18),f(4),d(5,"translate"),s(),l(6,"div",19)(7,"button",23),g("click",function(){y(n);let t=h();return b(t.onRemoveAttributes())}),f(8),d(9,"translate"),s(),l(10,"button",24),g("click",function(){y(n);let t=h();return b(t.onSaveAttributes())}),f(11),d(12,"translate"),s(),_(13,Za,1,4,"perun-web-apps-service-search-select",25),s(),l(14,"div",26),_(15,eo,1,5,"perun-web-apps-attributes-list",27),s()}if(i&2){let n=h(),e=R(5),t=R(7);r(),T(u(2,9,"FACILITY_CONFIGURATION.SERVICE_CONFIG")),r(3),S(" ",u(5,11,"FACILITY_CONFIGURATION.ATT_INFO")," "),r(3),c("disabled",n.processing||n.attSelection.selected.length===0),r(),S(" ",u(9,13,"FACILITY_CONFIGURATION.REMOVE")," "),r(2),c("disabled",n.processing||n.attSelection.selected.length===0),r(),S(" ",u(12,15,"FACILITY_CONFIGURATION.SAVE")," "),r(2),c("ngIf",e.selectedIndex===n.ATTRIBUTES_IDX),r(2),c("perunWebAppsLoader",n.processing)("perunWebAppsLoaderIndicator",t)}}function io(i,o){i&1&&(f(0),d(1,"translate")),i&2&&T(u(1,1,"FACILITY_CONFIGURATION.DESTINATION_CONFIG"))}var no=()=>["select","destinationId","service","warn","destination","type","propagationType"];function ao(i,o){if(i&1){let n=C();l(0,"app-perun-web-apps-facility-services-destinations",30),g("destinationEmitter",function(t){y(n);let a=h();return b(a.destinations=t)}),s()}if(i&2){let n=h();c("configServicesIds",n.serviceIds)("displayedColumns",q(5,no))("configServices",n.selection.selected)("loading",n.processing)("title","FACILITY_CONFIGURATION.DESTINATION_CONFIG")}}function oo(i,o){i&1&&(f(0),d(1,"translate")),i&2&&T(u(1,1,"FACILITY_CONFIGURATION.MANAGERS"))}function ro(i,o){i&1&&v(0,"app-perun-web-apps-facility-settings-managers",31),i&2&&c("disableRouting",!0)("disableSelf",!0)}function so(i,o){i&1&&(f(0),d(1,"translate")),i&2&&T(u(1,1,"FACILITY_CONFIGURATION.SUMMARY"))}var lo=()=>["id","name","contact","type"];function co(i,o){if(i&1&&v(0,"perun-web-apps-owners-list",48),i&2){let n=h(3);c("loading",n.processing)("displayedColumns",q(3,lo))("owners",n.owners)}}var po=()=>["id","name"];function mo(i,o){if(i&1&&v(0,"app-hosts-list",49),i&2){let n=h(3);c("loading",n.processing)("disableRouting",!0)("displayedColumns",q(4,po))("hosts",n.hosts)}}var uo=()=>["destinationId","service","warn","destination","type","propagationType"];function fo(i,o){if(i&1&&v(0,"app-perun-web-apps-destination-list",50),i&2){let n=h(3);c("loading",n.processing)("destinations",n.destinations)("displayedColumns",q(4,uo))("services",n.serviceIds)}}var ho=()=>["id","name","enabled","script","description"],go=()=>["id","displayName","value","description"],_o=()=>["id","vo","name","description"],So=()=>["id","name","email","logins","organization"];function vo(i,o){if(i&1){let n=C();l(0,"mat-accordion")(1,"mat-expansion-panel",34)(2,"mat-expansion-panel-header")(3,"mat-panel-title"),v(4,"mat-icon",35),f(5),d(6,"translate"),s()(),l(7,"h1",17),f(8),d(9,"translate"),s(),l(10,"div",26),_(11,co,1,4,"perun-web-apps-owners-list",36),s()(),l(12,"mat-expansion-panel",34)(13,"mat-expansion-panel-header")(14,"mat-panel-title"),v(15,"mat-icon",37),f(16),d(17,"translate"),s()(),l(18,"h1",17),f(19),d(20,"translate"),s(),l(21,"div",26),_(22,mo,1,5,"app-hosts-list",38),s()(),l(23,"mat-expansion-panel",34)(24,"mat-expansion-panel-header")(25,"mat-panel-title"),v(26,"mat-icon",39),f(27),d(28,"translate"),s()(),l(29,"h1",17),f(30),d(31,"translate"),s(),v(32,"app-services-list",40),s(),l(33,"mat-expansion-panel",41),g("opened",function(){y(n);let t=h(2);return b(t.getNonEmptyAttributes())}),l(34,"mat-expansion-panel-header")(35,"mat-panel-title"),v(36,"mat-icon",37),f(37),d(38,"translate"),s()(),l(39,"h1",17),f(40),d(41,"translate"),s(),v(42,"perun-web-apps-attributes-list",42),s(),l(43,"mat-expansion-panel",43),g("expandedChange",function(t){y(n);let a=h(2);return b(a.destinationServiceMissing=t)}),l(44,"mat-expansion-panel-header")(45,"mat-panel-title"),v(46,"mat-icon",44),f(47),d(48,"translate"),s()(),l(49,"h1",17),f(50),d(51,"translate"),s(),l(52,"div",26),_(53,fo,1,5,"app-perun-web-apps-destination-list",45),s()(),l(54,"mat-expansion-panel")(55,"mat-expansion-panel-header")(56,"mat-panel-title"),v(57,"mat-icon",46),f(58),d(59,"translate"),s()(),v(60,"app-managers-page",47),s()()}if(i&2){let n=h(2),e=R(7);c("@.disabled",!0),r(),c("disabled",n.owners.length===0),r(),k("cursor-default",n.owners.length===0),r(3),S(" ",u(6,49,"FACILITY_CONFIGURATION.OWNERS")," "),r(3),T(u(9,51,"FACILITY_CONFIGURATION.OWNERS")),r(3),c("perunWebAppsLoader",n.processing)("perunWebAppsLoaderIndicator",e),r(),c("disabled",n.hosts.length===0),r(),k("cursor-default",n.hosts.length===0),r(3),S(" ",u(17,53,"FACILITY_CONFIGURATION.HOSTS")," "),r(3),T(u(20,55,"FACILITY_CONFIGURATION.HOSTS")),r(3),c("perunWebAppsLoader",n.processing)("perunWebAppsLoaderIndicator",e),r(),c("disabled",n.selection.selected.length===0),r(),k("cursor-default",n.selection.selected.length===0),r(3),S(" ",u(28,57,"FACILITY_CONFIGURATION.SERVICES")," "),r(3),T(u(31,59,"FACILITY_CONFIGURATION.SERVICES")),r(2),c("loading",n.processing)("disableRouting",!0)("displayedColumns",q(71,ho))("services",n.selection.selected),r(),c("disabled",n.selection.selected.length===0),r(),k("cursor-default",n.selection.selected.length===0),r(3),S(" ",u(38,61,"FACILITY_CONFIGURATION.SERVICE_CONFIG")," "),r(3),T(u(41,63,"FACILITY_CONFIGURATION.ATTS")),r(2),c("loading",n.processing)("displayedColumns",q(72,go))("attributes",n.filteredAttributes)("emptyListText","FACILITY_CONFIGURATION.EMPTY_REQ_ATT"),r(),c("expanded",n.destinationServiceMissing)("disabled",n.selection.selected.length===0&&n.destinations.length===0),r(),k("cursor-default",n.selection.selected.length===0&&n.destinations.length===0),r(3),S(" ",u(48,65,"FACILITY_CONFIGURATION.DESTINATION_CONFIG")," "),r(3),T(u(51,67,"FACILITY_CONFIGURATION.DESTINATION")),r(3),c("perunWebAppsLoader",n.processing)("perunWebAppsLoaderIndicator",e),r(5),S(" ",u(59,69,"FACILITY_CONFIGURATION.MANAGERS")," "),r(2),c("complementaryObject",n.facility)("configMode",!0)("disableRouting",!0)("availableRoles",n.availableRoles)("complementaryObjectType","Facility")("displayedGroupColumns",q(73,_o))("displayedUserColumns",q(74,So))}}function Io(i,o){if(i&1&&(l(0,"perun-web-apps-alert",18),v(1,"i",32),d(2,"translate"),s(),_(3,vo,61,75,"mat-accordion",33)),i&2){h();let n=R(5);r(),c("innerHTML",u(2,2,"FACILITY_CONFIGURATION.SUMMARY_INFO"),xe),r(2),c("ngIf",n.selectedIndex===n.steps.length-1)}}function yo(i,o){if(i&1){let n=C();l(0,"button",51),g("click",function(){y(n);let t=h();return b(t.back())}),f(1),d(2,"translate"),s()}i&2&&(r(),S(" ",u(2,1,"FACILITY_CONFIGURATION.BACK")," "))}function bo(i,o){if(i&1){let n=C();l(0,"button",52),g("click",function(){y(n);let t=h();return b(t.next())}),f(1),d(2,"translate"),s()}if(i&2){h();let n=R(5);k("me-2",n!==void 0&&n.selectedIndex!==0)("ms-auto",!(n!==void 0&&n.selectedIndex!==0)),r(),S(" ",u(2,5,"FACILITY_CONFIGURATION.NEXT")," ")}}function Co(i,o){if(i&1){let n=C();l(0,"button",53),g("click",function(){y(n);let t=h();return b(t.onFinish())}),f(1),d(2,"translate"),s()}i&2&&(r(),S(" ",u(2,1,"FACILITY_CONFIGURATION.FINISH")," "))}var Tn=(()=>{let o=class o{constructor(e,t,a,p,I,x,H,z,J,Xe){this.attributesManager=e,this.serviceManager=t,this.facilityService=a,this.cd=p,this.dialog=I,this.notificator=x,this.translate=H,this.router=z,this.guiAuthResolver=J,this.entityStorageService=Xe,this.processing=!1,this.filteredAttributes=[],this.attSelection=new V(!0,[],!0,(ne,qe)=>ne.id===qe.id),this.cachedSubject=new B(!0),this.services=[],this.serviceIds=new Set,this.servicePackages=[],this.selectedPackages=[],this.selection=new V(!0,[],!0,(ne,qe)=>ne.id===qe.id),this.owners=[],this.hosts=[],this.destinations=[],this.destinationServiceMissing=!1,this.availableRoles=[],this.filterValue="",this.ATTRIBUTES_IDX=3,this.serviceControl=new se(!1,Ze.requiredTrue),this.attributesControl=new se(!0,Ze.requiredTrue),this.allowNavigate=!1,this.attributes=[],this.attributeIds=new Set,this.attributesPerService=new Map,this.servicesPerPackage=new Map,this.saveMsg="",this.removeMsg="",this.BEFORE_OPTIONAL_IDX=2,this.DESTINATIONS_IDX=4,this.AFTER_OPTIONAL_IDX=5,this.translate.get("FACILITY_CONFIGURATION.ATT_SAVED").subscribe(ne=>this.saveMsg=ne),this.translate.get("FACILITY_CONFIGURATION.ATT_REMOVED").subscribe(ne=>this.removeMsg=ne)}ngOnInit(){this.facility=this.entityStorageService.getEntity(),this.guiAuthResolver.assignAvailableRoles(this.availableRoles,"Facility"),this.serviceManager.getServicesPackages().subscribe(e=>{this.servicePackages=e,this.getServicePackageServices(e,0)})}ngAfterViewInit(){this.cd.detectChanges(),this.attSelection.changed.subscribe(()=>{this.attributesControl.setValue(this.attSelection.selected.length===0)})}onCancel(){let e=M();e.width="550px",e.data={facilityId:this.facility.id,lastStep:this.stepper.selectedIndex===this.stepper.steps.length-1,theme:"facility-theme"},this.dialog.open(Cn,e).afterClosed().subscribe(a=>{a&&(this.allowNavigate=!0,sessionStorage.removeItem("newFacilityId"),this.router.navigate(["facilities"],{queryParamsHandling:"merge"}))})}packagesSelected(e){if(this.packageSelectionEqual(e))return;this.processing=!0;let t=new Set;if(!e||e.length===0?this.selectedPackages.forEach(I=>{this.servicesPerPackage.get(I.id).forEach(x=>t.add(x))}):t=this.setSymDif(this.selectedPackages,e),t.size===0)return;let a=this.filterService(t,e.filter(I=>this.selectedPackages.findIndex(x=>x.id===I.id)<0)),p=this.filterService(t,this.selectedPackages.filter(I=>e.findIndex(x=>x.id===I.id)<0));for(let I of this.services)a.has(I.id)?this.selection.select(I):p.has(I.id)&&this.selection.deselect(I);this.selectedPackages=e,this.setServiceControl(),this.processing=!1}singleServiceSelected(){this.setServiceControl(),!this.processing&&this.checkPackageComplete()}back(){this.stepper.selectedIndex<=this.BEFORE_OPTIONAL_IDX&&this.setServiceControl(),this.stepper.selectedIndex===this.AFTER_OPTIONAL_IDX&&this.selection.selected.length===0?this.stepper.selectedIndex=this.BEFORE_OPTIONAL_IDX:this.stepper.previous()}onSaveAttributes(){return new Promise((e,t)=>{this.processing=!0,this.attributesManager.setFacilityAttributes({facility:this.facility.id,attributes:this.attSelection.selected}).subscribe({next:()=>{this.notificator.showSuccess(this.saveMsg),this.attSelection.clear(),this.cachedSubject.next(!0),this.processing=!1,e()},error:()=>{this.processing=!1,t()}})})}next(){this.checkDestinationDependency(this.stepper.selectedIndex),this.stepper.selectedIndex===this.BEFORE_OPTIONAL_IDX?this.selection.selected.length===0?this.openSkipDialog():(this.getRequiredAttributes(),this.stepper.next()):this.stepper.selectedIndex===this.ATTRIBUTES_IDX?this.attSelection.selected.length!==0?this.openUnsavedAttsDialog():this.stepper.next():this.stepper.next()}onFinish(){this.allowNavigate=!0,sessionStorage.removeItem("newFacilityId"),this.router.navigate(["facilities",this.facility.id],{queryParamsHandling:"merge"})}onRemoveAttributes(){this.processing=!0;let e=this.attSelection.selected.map(t=>t.id);this.attributesManager.removeFacilityAttributes(this.facility.id,e).subscribe({next:()=>{this.notificator.showSuccess(this.removeMsg),this.attSelection.clear(),this.cachedSubject.next(!0),this.getRequiredAttributes(),this.processing=!1},error:()=>this.processing=!1})}filterAttributes(e){if(e===void 0||e.length===0){this.filteredAttributes=this.attributes;return}let t=new Set;for(let a of e)this.attributesPerService.get(a.id).forEach(p=>t.add(p));this.filteredAttributes=[];for(let a of this.attributes)t.has(a.id)&&this.filteredAttributes.push(a);this.attSelection.clear(),this.cachedSubject.next(!0)}getNonEmptyAttributes(){this.filteredAttributes=this.attributes.filter(e=>{if(e.value&&(!Array.isArray(e.value)||e.value.length!==0))return e})}navigationStep(e){this.checkDestinationDependency(e.previouslySelectedIndex),e.selectedIndex===this.ATTRIBUTES_IDX?this.getRequiredAttributes():e.selectedIndex===this.DESTINATIONS_IDX?this.processing=!1:e.selectedIndex<=this.BEFORE_OPTIONAL_IDX&&this.setServiceControl()}applyFilter(e){this.filterValue=e,this.selection.clear(),this.cachedSubject.next(!0)}canDeactivate(){return this.allowNavigate||this.onCancel(),this.allowNavigate}getServicePackageServices(e,t){t===e.length?this.serviceManager.getServices().subscribe(a=>{this.services=a}):this.serviceManager.getServicesFromServicesPackage(e[t].id).subscribe(a=>{this.servicesPerPackage.set(e[t].id,new Set([...a.map(p=>p.id)])),this.getServicePackageServices(e,t+1)})}getServiceRequiredAttributes(e,t){t!==e.length&&this.attributesManager.getRequiredAttributesDefinition(e[t].id).subscribe(a=>{a=a.filter(p=>this.attributeIds.has(p.id)),this.attributesPerService.set(e[t].id,a.map(p=>p.id)),this.getServiceRequiredAttributes(e,t+1)})}setServiceControl(){this.serviceControl.setValue(this.selection.selected.length!==0)}buildServiceSet(e){let t=new Set;return e.forEach(a=>{this.servicesPerPackage.get(a.id).forEach(p=>t.add(p))}),t}setDiff(e,t){return new Set([...e].filter(a=>!t.has(a)))}setIntersect(e,t){return new Set([...e].filter(a=>t.has(a)))}setSymDif(e,t){let a=this.buildServiceSet(e),p=this.buildServiceSet(t),I=this.setDiff(a,p),x=this.setDiff(p,a);return new Set([...I,...x])}filterService(e,t){let a=new Set;for(let p of t){let I=this.setIntersect(e,this.servicesPerPackage.get(p.id));I.size!==0&&I.forEach(x=>a.add(x))}return a}packageSelectionEqual(e){return e.length!==this.selectedPackages.length?!1:(e.forEach(t=>{if(this.selectedPackages.findIndex(a=>a.id===t.id)===-1)return!1}),!0)}checkPackageComplete(){let e=[];for(let t of this.selectedPackages){let a=!0;for(let p of this.servicesPerPackage.get(t.id))if(this.selection.selected.findIndex(I=>I.id===p)===-1){a=!1;break}a&&e.push(t)}this.selectedPackages=e}openSkipDialog(){let e=M();e.width="400px",e.data={theme:"facility-theme"},this.dialog.open(yn,e).afterClosed().subscribe(a=>{a&&(this.serviceControl.setValue(!0),this.stepper.selectedIndex=this.AFTER_OPTIONAL_IDX)})}getRequiredAttributes(){this.processing=!0,this.attributesManager.getRequiredAttributesFacilityServices(this.selection.selected.map(e=>e.id),this.facility.id).subscribe(e=>{this.attSelection.clear(),this.attributes=e.filter(t=>!Ot(t)),this.filteredAttributes=this.attributes,this.attributes.forEach(t=>this.attributeIds.add(t.id)),this.getServiceRequiredAttributes(this.selection.selected,0),this.processing=!1})}openUnsavedAttsDialog(){let e=M();e.width="400px",e.data={theme:"facility-theme"},this.dialog.open(bn,e).afterClosed().subscribe(a=>{a&&this.onSaveAttributes().then(()=>{this.stepper.next()},()=>this.getRequiredAttributes())})}checkDestinationDependency(e){(e===this.BEFORE_OPTIONAL_IDX||e===this.DESTINATIONS_IDX)&&(this.serviceIds=new Set([...this.selection.selected.map(t=>t.id)]),this.destinationServicePresent())}destinationServicePresent(){for(let e of this.destinations)if(!this.serviceIds.has(e.service.id)){this.destinationServiceMissing=!0;return}this.destinationServiceMissing=!1}};o.\u0275fac=function(t){return new(t||o)(m(vt),m(ae),m(w),m(rt),m(Y),m(Z),m(re),m(_e),m(D),m(F))},o.\u0275cmp=E({type:o,selectors:[["app-facility-configuration-page"]],viewQuery:function(t,a){if(t&1&&lt(Ya,5),t&2){let p;ct(p=pt())&&(a.stepper=p.first)}},decls:36,vars:15,consts:[[1,"facility-theme"],[1,"page-title"],[3,"linear","selectionChange"],["stepper",""],["spinner",""],["matStepLabel",""],["matStepContent",""],[3,"stepControl"],["optional","true",3,"editable","stepControl"],[3,"editable","optional"],[1,"actions"],["mat-stroked-button","",3,"click"],["class","ms-auto me-2","mat-stroked-button","",3,"click",4,"ngIf"],["color","accent","mat-flat-button","",3,"me-2","ms-auto","click",4,"ngIf"],["class","me-2","color","accent","mat-flat-button","",3,"click",4,"ngIf"],[3,"ownerEmitter"],[3,"disableRouting","hostEmitter"],[1,"page-subtitle"],["alert_type","info"],[1,"filters"],[1,"filter",3,"placeholder","filter"],[1,"package-search-select",3,"disableAutoSelect","selectedPackage","multiple","servicePackages","theme","packageSelected"],[3,"loading","disableRouting","displayedColumns","selection","cachedSubject","filterValue","services","selectionChanged"],["color","warn","mat-flat-button","",1,"me-2",3,"disabled","click"],["color","accent","mat-flat-button","",1,"me-2",3,"disabled","click"],["class","service-search-select",3,"disableAutoSelect","services","multiple","theme","serviceSelected",4,"ngIf"],[1,"position-relative","table-min-height"],[3,"loading","emptyListText","attributes","selection","cachedSubject",4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],[1,"service-search-select",3,"disableAutoSelect","services","multiple","theme","serviceSelected"],[3,"loading","emptyListText","attributes","selection","cachedSubject"],[3,"configServicesIds","displayedColumns","configServices","loading","title","destinationEmitter"],[3,"disableRouting","disableSelf"],[3,"innerHTML"],[4,"ngIf"],[3,"disabled"],["svgIcon","perun-owner-grey",1,"me-2"],[3,"loading","displayedColumns","owners",4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],["svgIcon","perun-hosts",1,"me-2"],[3,"loading","disableRouting","displayedColumns","hosts",4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],["svgIcon","perun-service",1,"me-2"],[3,"loading","disableRouting","displayedColumns","services"],[3,"disabled","opened"],[3,"loading","displayedColumns","attributes","emptyListText"],[3,"expanded","disabled","expandedChange"],["svgIcon","perun-service_destination",1,"me-2"],[3,"loading","destinations","displayedColumns","services",4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],["svgIcon","perun-manager",1,"me-2"],[3,"complementaryObject","configMode","disableRouting","availableRoles","complementaryObjectType","displayedGroupColumns","displayedUserColumns"],[3,"loading","displayedColumns","owners"],[3,"loading","disableRouting","displayedColumns","hosts"],[3,"loading","destinations","displayedColumns","services"],["mat-stroked-button","",1,"ms-auto","me-2",3,"click"],["color","accent","mat-flat-button","",3,"click"],["color","accent","mat-flat-button","",1,"me-2",3,"click"]],template:function(t,a){if(t&1&&(l(0,"div",0)(1,"div",1),f(2),d(3,"translate"),s(),l(4,"mat-stepper",2,3),g("selectionChange",function(I){return a.navigationStep(I)}),_(6,Wa,1,0,"ng-template",null,4,P),l(8,"mat-step"),_(9,Ha,2,3,"ng-template",5)(10,za,1,0,"ng-template",6),s(),l(11,"mat-step"),_(12,$a,2,3,"ng-template",5)(13,Ka,1,1,"ng-template",6),s(),l(14,"mat-step",7),_(15,Xa,2,3,"ng-template",5)(16,Qa,10,20,"ng-template",6),s(),l(17,"mat-step",8),_(18,Ja,2,3,"ng-template",5)(19,to,16,17,"ng-template",6),s(),l(20,"mat-step",9),_(21,io,2,3,"ng-template",5)(22,ao,1,6,"ng-template",6),s(),l(23,"mat-step"),_(24,oo,2,3,"ng-template",5)(25,ro,1,2,"ng-template",6),s(),l(26,"mat-step"),_(27,so,2,3,"ng-template",5)(28,Io,4,4,"ng-template",6),s()(),l(29,"div",10)(30,"button",11),g("click",function(){return a.onCancel()}),f(31),d(32,"translate"),s(),_(33,yo,3,3,"button",12)(34,bo,3,7,"button",13)(35,Co,3,3,"button",14),s()()),t&2){let p=R(5);r(2),S(" ",u(3,11,"FACILITY_CONFIGURATION.TITLE")," "),r(2),c("linear",!0),r(10),c("stepControl",a.serviceControl),r(3),c("editable",a.selection.selected.length!==0)("stepControl",a.attributesControl),r(3),c("editable",a.selection.selected.length!==0||a.destinations.length!==0)("optional",a.destinations.length===0),r(11),S(" ",u(32,13,"FACILITY_CONFIGURATION.CANCEL")," "),r(2),c("ngIf",p!==void 0&&p.selectedIndex!==0),r(),c("ngIf",p!==void 0&&p.selectedIndex!==p.steps.length-1),r(),c("ngIf",p!==void 0&&p.selectedIndex===p.steps.length-1)}},dependencies:[L,le,N,Zt,Qt,ei,Jt,qt,$t,Kt,Xt,Pe,Ge,Ue,ki,De,G,hi,U,Ne,Si,vi,j,He,ze,$e,Ke,A],styles:[".icon-scale[_ngcontent-%COMP%]{transform:scale(1.7);margin-left:.5rem;margin-top:-.6rem;margin-right:.9rem}.filters[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;align-items:baseline}.package-search-select[_ngcontent-%COMP%]{width:650px}.service-search-select[_ngcontent-%COMP%]{width:400px}.filter[_ngcontent-%COMP%]{width:350px;margin-right:20px}.actions[_ngcontent-%COMP%]{background-color:#fff;display:flex;padding:20px}.cursor-default[_ngcontent-%COMP%]{cursor:default}"]});let i=o;return i})();var it=(()=>{let o=class o{constructor(e){this.router=e}canActivate(e){return e.parent.params.facilityId===sessionStorage.getItem("newFacilityId")?!0:(this.router.navigate(["/home"],{queryParamsHandling:"merge"}),!1)}canDeactivate(e){return e.canDeactivate()}};o.\u0275fac=function(t){return new(t||o)(ot(_e))},o.\u0275prov=at({token:o,factory:o.\u0275fac,providedIn:"root"});let i=o;return i})();function To(i,o){if(i&1){let n=C();l(0,"button",8),g("click",function(){y(n);let t=h();return b(t.add())}),f(1),d(2,"translate"),s()}i&2&&(r(),S(" ",u(2,1,"FACILITY_DETAIL.SETTINGS.BANS.ADD"),`
`))}function Eo(i,o){if(i&1){let n=C();l(0,"button",9),g("click",function(){y(n);let t=h();return b(t.remove())}),f(1),d(2,"translate"),s()}if(i&2){let n=h();c("disabled",n.loading||n.selection.selected.length===0),r(),S(" ",u(2,2,"FACILITY_DETAIL.SETTINGS.BANS.REMOVE"),`
`)}}function Ao(i,o){if(i&1){let n=C();l(0,"perun-web-apps-ban-on-entity-list",10),g("updateBan",function(t){y(n);let a=h();return b(a.update(t))}),s()}if(i&2){let n=h();c("loading",n.loading)("bans",n.bans)("selection",n.selection)("cachedSubject",n.cachedSubject)("displayedColumns",n.displayedColumns)("filter",n.filter)("updatePolicy","updateBan_BanOnFacility_policy")}}function Fo(i,o){i&1&&v(0,"perun-web-apps-loading-table")}var En=(()=>{let o=class o{constructor(e,t,a,p,I,x,H){this.facilityService=e,this.entityService=t,this.authResolver=a,this.dialog=p,this.notificator=I,this.store=x,this.userName=H,this.loading=!1,this.bans=[],this.removeAuth=!1,this.filter="",this.selection=new V(!1,[],!0,(z,J)=>z.ban.id===J.ban.id),this.cachedSubject=new B(!0),this.attrNames=[et.MEMBER_DEF_MAIL,et.USER_DEF_PREFERRED_MAIL].concat(this.store.getLoginAttributeNames()),this.displayedColumns=["select","banId","subjectId","subjectName","description","expiration","edit"]}ngOnInit(){this.loading=!0,this.facility=this.entityService.getEntity(),this.addAuth=this.authResolver.isAuthorized("setBan_BanOnFacility_policy",[this.facility]),this.removeAuth=this.authResolver.isAuthorized("removeBan_int_policy",[this.facility]),this.refresh()}refresh(){this.loading=!0,this.facilityService.getEnrichedBansForFacility(this.facility.id,this.attrNames).subscribe({next:e=>{this.bans=e,this.selection.clear(),this.cachedSubject.next(!0),this.loading=!1},error:()=>this.loading=!1})}add(){let e=M();e.width="850px",e.data={entityId:this.facility.id,theme:"facility-theme",bans:this.bans.map(a=>a.ban)},this.dialog.open(Ji,e).afterClosed().subscribe(a=>{a&&this.refresh()})}remove(){let e=M();e.width="550px",e.data={theme:"facility-theme",title:"DIALOGS.REMOVE_BAN.TITLE",description:"DIALOGS.REMOVE_BAN.DESCRIPTION",items:[this.userName.transform(this.selection.selected[0].user)],type:"remove",showAsk:!0},this.dialog.open(ui,e).afterClosed().subscribe(a=>{a&&(this.loading=!0,this.facilityService.removeFacilityBanById(this.selection.selected[0].ban.id).subscribe(()=>{this.notificator.showSuccess("DIALOGS.REMOVE_BAN.SUCCESS"),this.refresh()}))})}update(e){let t=M();t.width="600px",t.data={ban:e.ban,theme:"facility-theme"},this.dialog.open(Zi,t).afterClosed().subscribe(p=>{p&&this.refresh()})}applyFilter(e){this.filter=e,this.refresh()}};o.\u0275fac=function(t){return new(t||o)(m(w),m(F),m(D),m(Y),m(Z),m(Tt),m(ee))},o.\u0275cmp=E({type:o,selectors:[["app-facility-settings-bans"]],features:[dt([ee])],decls:11,vars:8,consts:[[1,"page-subtitle"],[3,"click"],["class","me-2 action-button","color","accent","mat-flat-button","",3,"click",4,"ngIf"],["color","warn","class","me-2","mat-flat-button","",3,"disabled","click",4,"ngIf"],[1,"mt-2","search-field",3,"placeholder","filter"],[1,"position-relative","table-min-height"],[3,"loading","bans","selection","cachedSubject","displayedColumns","filter","updatePolicy","updateBan",4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],["spinner",""],["color","accent","mat-flat-button","",1,"me-2","action-button",3,"click"],["color","warn","mat-flat-button","",1,"me-2",3,"disabled","click"],[3,"loading","bans","selection","cachedSubject","displayedColumns","filter","updatePolicy","updateBan"]],template:function(t,a){if(t&1&&(l(0,"h1",0),f(1),d(2,"translate"),s(),l(3,"perun-web-apps-refresh-button",1),g("click",function(){return a.refresh()}),s(),_(4,To,3,3,"button",2)(5,Eo,3,4,"button",3),l(6,"perun-web-apps-debounce-filter",4),g("filter",function(I){return a.applyFilter(I)}),s(),l(7,"div",5),_(8,Ao,1,7,"perun-web-apps-ban-on-entity-list",6),s(),_(9,Fo,1,0,"ng-template",null,7,P)),t&2){let p=R(10);r(),S(" ",u(2,6,"FACILITY_DETAIL.SETTINGS.BANS.TITLE"),`
`),r(3),c("ngIf",a.addAuth),r(),c("ngIf",a.removeAuth),r(),c("placeholder","FACILITY_DETAIL.SETTINGS.BANS.FILTER"),r(2),c("perunWebAppsLoader",a.loading)("perunWebAppsLoaderIndicator",p)}},dependencies:[L,N,G,W,U,Ii,j,A]});let i=o;return i})();var xo=[{path:"",component:an,canActivate:[je]},{path:":facilityId",component:pn,canActivateChild:[je],children:[{path:"",component:mn,data:{animation:"FacilityOverviewPage"}},{path:"attributes",component:fn,data:{animation:"FacilityAttributesPage"}},{path:"resources",component:on,data:{animation:"FacilityResourcesPage"}},{path:"allowed-users",component:sn,data:{animation:"FacilityAllowedUsersPage"}},{path:"allowed-groups",component:rn,data:{animation:"FacilityAllowedGroupsPage"}},{path:"services-status",component:vn,data:{animation:"FacilityServiceStatusPage"}},{path:"services-status/:taskId",component:In,data:{animation:"FacilityTaskResultsPage"}},{path:"service-config",component:hn,data:{animation:"FacilityServiceConfigPage"}},{path:"services-destinations",component:ze,data:{animation:"FacilityServicesDestinationsPage"}},{path:"hosts",component:Ke,data:{animation:"FacilityHostsPage"}},{path:"hosts/:hostId",component:_n,data:{animation:"FacilityHostsDetailPage"}},{path:"settings",component:dn,children:[{path:"",component:un,data:{animation:"FacilitySettingsOverviewPage"}},{path:"owners",component:$e,data:{animation:"FacilitySettingOwnersPage"}},{path:"managers",component:He,data:{animation:"FacilitySettingsManagersPage"}},{path:"security-teams",component:Sn,data:{animation:"FacilitySecurityTeamsPage"}},{path:"blacklist",component:gn,data:{animation:"FacilitySettingsBlackListPage"}},{path:"bans",component:En,data:{animation:"FacilitySettingsBansPage"}}]},{path:"configuration",component:Tn,canActivate:[it],canDeactivate:[it]}]},{path:":facilityId/resources/:resourceId",component:Ri,canActivateChild:[je],children:[{path:"",component:wi,data:{animation:"ResourceOverviewPage"}},{path:"attributes",component:Oi,data:{animation:"ResourceAttributesPage"}},{path:"groups",component:Li,data:{animation:"ResourceGroupsComponent"}},{path:"services",component:Vi,data:{animation:"ResourceAssignedServicesComponent"}},{path:"members",component:Bi,data:{animation:"ResourceAssignedMembersComponent"}},{path:"tags",component:Pi,data:{animation:"ResourceTagsComponent"}},{path:"settings",component:Di,children:[{path:"",component:Mi,data:{animation:"ResourceSettingsOverviewPage"}},{path:"managers",component:Ni,data:{animation:"ResourceSettingsManagersPage"}},{path:"bans",component:ji,data:{animation:"ResourceSettingsBansPage"}}]}]}],An=(()=>{let o=class o{};o.\u0275fac=function(t){return new(t||o)},o.\u0275mod=Fe({type:o}),o.\u0275inj=Ae({imports:[Je.forChild(xo),Je]});let i=o;return i})();var Hm=(()=>{let o=class o{};o.\u0275fac=function(t){return new(t||o)},o.\u0275mod=Fe({type:o}),o.\u0275inj=Ae({providers:[ee],imports:[_t,An,en,oi,pi,bi,ci,tn,nn]});let i=o;return i})();export{Hm as FacilitiesModule};
