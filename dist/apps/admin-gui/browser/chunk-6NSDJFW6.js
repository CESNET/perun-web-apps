import{a as Zi,b as en,c as tn,d as nn}from"./chunk-DQZUSVX7.js";import{a as yi,b as Ei,c as Ai,d as Fi,e as xi,f as Ri,g as wi,h as Li,i as Mi,j as Oi,k as Ni,l as ki}from"./chunk-RABIIYCV.js";import{a as Ji}from"./chunk-6Y5N7GHO.js";import"./chunk-ZWIACL5N.js";import{a as Be}from"./chunk-BK2DHELO.js";import{j as Qi}from"./chunk-26PPFL5E.js";import"./chunk-P4QD2LAB.js";import{$ as pe,$f as x,Aa as T,Ac as bt,Af as Jt,Aj as Yi,Ba as v,Bb as F,Bf as Zt,Bj as ji,Ca as ie,Ce as oe,Cf as ei,Cj as Wi,Da as lt,Db as _t,Dc as Tt,E as tt,Ee as Pt,F as Te,Fa as ct,Fc as Et,Fe as Gt,Gb as Fe,Gc as qe,Ge as Ut,Gg as oi,Gj as Hi,H as it,Hc as At,Hg as U,Ia as $,Ib as te,Ih as gi,Ja as Ke,Jb as xe,Jg as ri,K as E,Kb as vt,Kg as si,L as Ee,Lc as ae,Lg as li,Ma as d,Mh as _i,Na as u,Ng as ci,O as S,Oc as Ft,Oh as vi,Oj as Ue,P as y,Pe as Yt,Pf as we,Pj as zi,Qa as B,Qb as ne,Qf as ti,Qj as $i,Rb as A,Sh as Ii,Si as Di,T as Ae,Tb as It,Ua as pt,Ud as Lt,Ue as jt,Uf as J,Uh as Si,Va as mt,Vb as L,Vd as Dt,Ve as Wt,Vh as Ne,Wa as w,Wb as St,Wd as Mt,Wj as Ki,Xa as dt,Xd as Ot,Xe as Ht,Xg as pi,Xh as Ci,Xj as Xi,Y as r,Ya as ut,Ye as zt,Yh as bi,Z as m,Zc as Re,Zg as j,_ as nt,_e as Se,_j as qi,ab as ft,ad as Qe,af as $t,ag as Le,ba as at,bc as V,bf as Kt,ca as _,ce as Nt,cf as Xt,df as qt,eh as mi,fa as c,fd as xt,fg as ii,fh as De,ga as k,gc as yt,gd as Rt,ha as me,he as kt,hg as G,i as Ce,id as D,ja as l,jd as wt,je as Vt,jh as di,ka as s,kg as ni,la as I,lg as ai,lh as ui,mi as ke,oa as b,ob as ue,oc as he,oi as Ve,pa as g,pc as ge,ph as Y,qa as h,qc as P,qg as Z,rb as fe,rc as _e,rj as Pe,sb as ht,sc as ve,sj as Vi,ta as de,tc as Ie,th as Me,tj as Bi,ub as Xe,va as ot,vh as Oe,vi as Ti,vj as Ge,wa as rt,wb as gt,wj as Pi,x as be,xa as st,xc as N,xe as Bt,xh as fi,xj as Gi,ya as R,yc as Ct,z as et,za as f,zf as Qt,zh as hi,zj as Ui}from"./chunk-T6672D7J.js";import"./chunk-2YRG3NBG.js";function An(i,o){i&1&&I(0,"mat-spinner",3)}function Fn(i,o){if(i&1){let n=b();l(0,"button",12),g("click",function(){S(n);let t=h(2);return y(t.editFacility())}),d(1,"translate"),l(2,"mat-icon"),f(3,"edit"),s()()}i&2&&de("matTooltip",u(1,1,"FACILITY_DETAIL.EDIT"))}function xn(i,o){if(i&1){let n=b();l(0,"button",12),g("click",function(){S(n);let t=h(2);return y(t.deleteFacility())}),d(1,"translate"),l(2,"mat-icon"),f(3,"delete_forever"),s()()}i&2&&de("matTooltip",u(1,1,"FACILITY_DETAIL.DELETE"))}var Rn=()=>({color:"black"}),an=i=>["/facilities",i];function wn(i,o){if(i&1&&(l(0,"div")(1,"div",4),I(2,"mat-icon",5),d(3,"translate"),l(4,"div",6)(5,"div",7)(6,"a",8),g("auxclick",function(e){return e.preventDefault()}),f(7),s(),l(8,"span",9),f(9),s(),_(10,Fn,4,3,"button",10)(11,xn,4,3,"button",10),s(),l(12,"div"),f(13),d(14,"translate"),s(),l(15,"span",11),f(16),d(17,"translate"),d(18,"translate"),s()()(),I(19,"app-animated-router-outlet"),s()),i&2){let n=h();r(2),de("matTooltip",u(3,13,"FACILITY_DETAIL.ENTITY")),c("ngStyle",$(21,Rn)),r(4),c("perunWebAppsMiddleClickRouterLink",Ke(22,an,n.facility.id.toString()))("routerLink",Ke(24,an,n.facility.id)),r(),T(n.facility.name),r(2),v(" \xA0#",n.facility.id," "),r(),c("ngIf",n.editFacilityAuth),r(),c("ngIf",n.deleteAuth),r(2),ie("",u(14,15,"FACILITY_DETAIL.UUID"),": ",n.facility.uuid,""),r(3),lt(" ",u(17,17,"FACILITY_DETAIL.ENTITY"),", ",u(18,19,"FACILITY_DETAIL.DESCRIPTION"),": ",n.facility.description," ")}}var rn=(()=>{let o=class o extends yi(){constructor(e,t,a,p,C,O,X,q,ye){super(),this.dialog=e,this.facilityManager=t,this.route=a,this.sideMenuService=p,this.sideMenuItemService=C,this.guiAuthResolver=O,this.router=X,this.entityStorageService=q,this.reloadEntityDetail=ye,this.editFacilityAuth=!1,this.deleteAuth=!1,this.loading=!1}ngOnInit(){this.reloadData(),this.reloadEntityDetail.entityDetailChange.pipe(et(this.destroyed$)).subscribe(()=>{this.reloadData()})}reloadData(){this.loading=!0,this.route.params.subscribe(e=>{let t=Number(e.facilityId);this.facilityManager.getFacilityById(t).subscribe(a=>{this.facility=a,this.entityStorageService.setEntity({id:a.id,beanName:a.beanName}),this.setMenuItems(),this.editFacilityAuth=this.guiAuthResolver.isAuthorized("updateFacility_Facility_policy",[this.facility]),this.deleteAuth=this.guiAuthResolver.isAuthorized("deleteFacility_Facility_Boolean_policy",[this.facility]),xt("facilities",this.facility),Rt(this.facility),this.loading=!1},()=>this.loading=!1)})}setMenuItems(){let e=this.sideMenuItemService.parseFacility(this.facility);this.sideMenuService.setFacilityMenuItems([e])}editFacility(){let e=D();e.width="450px",e.data={theme:"facility-theme",facility:this.facility,dialogType:ni.FACILITY},this.dialog.open(ai,e).afterClosed().subscribe(a=>{a&&this.facilityManager.getFacilityById(this.facility.id).subscribe(p=>{this.facility=p,this.setMenuItems()})})}deleteFacility(){let e=D();e.width="500px",e.data={theme:"facility-theme",facility:this.facility},this.dialog.open(Hi,e).afterClosed().subscribe(a=>{a&&this.router.navigate([""],{queryParamsHandling:"preserve"})})}};o.\u0275fac=function(t){return new(t||o)(m(P),m(F),m(ue),m(ii),m(Ii),m(L),m(fe),m(x),m(Si))},o.\u0275cmp=E({type:o,selectors:[["app-facility-detail-page"]],features:[at],decls:4,vars:2,consts:[[1,"container-fluid","ps-xl-5","pe-xl-5","facility-theme"],["class","me-auto ms-auto",4,"ngIf"],[4,"ngIf"],[1,"me-auto","ms-auto"],[1,"d-flex","page-title-headtitle"],["svgIcon","perun-facility-black",1,"perun-icon","perun-icon-detail",3,"matTooltip","ngStyle"],[1,"page-title-block"],[1,"page-title-headline","d-flex","align-items-center"],[1,"facility-link",3,"perunWebAppsMiddleClickRouterLink","routerLink","auxclick"],[1,"text-muted"],["mat-icon-button","",3,"matTooltip","click",4,"ngIf"],[1,"mt-1","entity-info"],["mat-icon-button","",3,"matTooltip","click"]],template:function(t,a){t&1&&(l(0,"div",0),I(1,"perun-web-apps-back-button"),_(2,An,1,0,"mat-spinner",1)(3,wn,20,26,"div",2),s()),t&2&&(r(2),c("ngIf",a.loading),r(),c("ngIf",!a.loading&&a.facility!==void 0))},dependencies:[w,dt,ht,oe,Ct,Se,Re,Ne,pi,si,li,A],data:{animation:[Oe]}});let i=o;return i})();function Dn(i,o){i&1&&I(0,"mat-spinner",2)}function Mn(i,o){if(i&1&&(l(0,"div"),I(1,"perun-web-apps-menu-buttons-field",3)(2,"perun-web-apps-expandable-tiles",4),s()),i&2){let n=h();r(),c("items",n.items),r(),c("items",n.settingItems)("title","MENU_ITEMS.FACILITY.SETTINGS")("sectionId","settings")}}var sn=(()=>{let o=class o{constructor(e,t,a,p){this.facilityManager=e,this.authResolver=t,this.entityStorageService=a,this.routePolicyService=p,this.items=[],this.settingItems=[],this.loading=!1}ngOnInit(){this.loading=!0,this.facility=this.entityStorageService.getEntity(),this.setItems(),this.setSettingsItems(),this.loading=!1}setItems(){this.items=[],this.routePolicyService.canNavigate("facilities-resources",this.facility)&&this.items.push({cssIcon:"perun-manage-facility",url:`/facilities/${this.facility.id}/resources`,label:"MENU_ITEMS.FACILITY.RESOURCES",style:"facility-btn"}),this.routePolicyService.canNavigate("facilities-allowed-users",this.facility)&&this.items.push({cssIcon:"perun-user",url:`/facilities/${this.facility.id}/allowed-users`,label:"MENU_ITEMS.FACILITY.ALLOWED_USERS",style:"facility-btn"}),this.routePolicyService.canNavigate("facilities-allowed-groups",this.facility)&&this.items.push({cssIcon:"perun-group",url:`/facilities/${this.facility.id}/allowed-groups`,label:"MENU_ITEMS.FACILITY.ALLOWED_GROUPS",style:"facility-btn"}),this.routePolicyService.canNavigate("facilities-services-status",this.facility)&&this.items.push({cssIcon:"perun-service-status",url:`/facilities/${this.facility.id}/services-status`,label:"MENU_ITEMS.FACILITY.SERVICES_STATUS",style:"facility-btn"}),this.routePolicyService.canNavigate("facilities-services-destinations",this.facility)&&this.items.push({cssIcon:"perun-service_destination",url:`/facilities/${this.facility.id}/services-destinations`,label:"MENU_ITEMS.FACILITY.SERVICES_DESTINATIONS",style:"facility-btn"}),this.routePolicyService.canNavigate("facilities-hosts",this.facility)&&this.items.push({cssIcon:"perun-hosts",url:`/facilities/${this.facility.id}/hosts`,label:"MENU_ITEMS.FACILITY.HOSTS",style:"facility-btn"}),this.routePolicyService.canNavigate("facilities-attributes",this.facility)&&this.items.push({cssIcon:"perun-attributes",url:`/facilities/${this.facility.id}/attributes`,label:"MENU_ITEMS.FACILITY.ATTRIBUTES",style:"facility-btn"})}setSettingsItems(){this.settingItems=[],this.routePolicyService.canNavigate("facilities-settings-owners",this.facility)&&this.settingItems.push({cssIcon:"perun-owner-grey",url:`/facilities/${this.facility.id}/settings/owners`,label:"MENU_ITEMS.FACILITY.OWNERS",style:"facility-btn"}),this.routePolicyService.canNavigate("facilities-settings-managers",this.facility)&&this.settingItems.push({cssIcon:"perun-manager",url:`/facilities/${this.facility.id}/settings/managers`,label:"MENU_ITEMS.FACILITY.MANAGERS",style:"facility-btn"}),this.routePolicyService.canNavigate("facilities-settings-security-teams",this.facility)&&this.settingItems.push({cssIcon:"perun-security-teams",url:`/facilities/${this.facility.id}/settings/security-teams`,label:"MENU_ITEMS.FACILITY.SECURITY_TEAMS",style:"facility-btn"}),this.routePolicyService.canNavigate("facilities-settings-blacklist",this.facility)&&this.settingItems.push({cssIcon:"perun-black-list",url:`/facilities/${this.facility.id}/settings/blacklist`,label:"MENU_ITEMS.FACILITY.BLACKLIST",style:"facility-btn"}),this.routePolicyService.canNavigate("facilities-settings-bans",this.facility)&&this.settingItems.push({cssIcon:"perun-ban",url:`/facilities/${this.facility.id}/settings/bans`,label:"MENU_ITEMS.FACILITY.BANS",style:"facility-btn"})}};o.\u0275fac=function(t){return new(t||o)(m(F),m(L),m(x),m(Le))},o.\u0275cmp=E({type:o,selectors:[["app-facility-overview"]],hostVars:2,hostBindings:function(t,a){t&2&&k("router-component",a.true)},decls:2,vars:2,consts:[["class","me-auto ms-auto",4,"ngIf"],[4,"ngIf"],[1,"me-auto","ms-auto"],[3,"items"],[3,"items","title","sectionId"]],template:function(t,a){t&1&&_(0,Dn,1,0,"mat-spinner",0)(1,Mn,3,4,"div",1),t&2&&(c("ngIf",a.loading),r(),c("ngIf",!a.loading))},dependencies:[w,Se,De,_i]});let i=o;return i})();var ln=(()=>{let o=class o{};o.\u0275fac=function(t){return new(t||o)},o.\u0275cmp=E({type:o,selectors:[["app-facility-settings"]],hostVars:2,hostBindings:function(t,a){t&2&&k("router-component",a.true)},decls:1,vars:0,template:function(t,a){t&1&&I(0,"app-animated-router-outlet")},dependencies:[Ne],data:{animation:[Oe]}});let i=o;return i})();function On(i,o){i&1&&I(0,"mat-spinner",2)}function Nn(i,o){if(i&1&&(l(0,"div"),I(1,"perun-web-apps-menu-buttons-field",3),s()),i&2){let n=h();r(),c("items",n.items)}}var cn=(()=>{let o=class o{constructor(e,t,a,p){this.facilityManager=e,this.authResolver=t,this.entityStorageService=a,this.routePolicyService=p,this.items=[],this.loading=!1}ngOnInit(){this.loading=!0,this.facility=this.entityStorageService.getEntity(),this.initItems(),this.loading=!1}initItems(){this.items=[],this.routePolicyService.canNavigate("facilities-settings-owners",this.facility)&&this.items.push({cssIcon:"perun-owner-grey",url:`/facilities/${this.facility.id}/settings/owners`,label:"MENU_ITEMS.FACILITY.OWNERS",style:"facility-btn"}),this.routePolicyService.canNavigate("facilities-settings-managers",this.facility)&&this.items.push({cssIcon:"perun-manager",url:`/facilities/${this.facility.id}/settings/managers`,label:"MENU_ITEMS.FACILITY.MANAGERS",style:"facility-btn"}),this.routePolicyService.canNavigate("facilities-settings-security-teams",this.facility)&&this.items.push({cssIcon:"perun-security-teams",url:`/facilities/${this.facility.id}/settings/security-teams`,label:"MENU_ITEMS.FACILITY.SECURITY_TEAMS",style:"facility-btn"}),this.routePolicyService.canNavigate("facilities-settings-blacklist",this.facility)&&this.items.push({cssIcon:"perun-black-list",url:`/facilities/${this.facility.id}/settings/blacklist`,label:"MENU_ITEMS.FACILITY.BLACKLIST",style:"facility-btn"}),this.routePolicyService.canNavigate("facilities-settings-bans",this.facility)&&this.items.push({cssIcon:"perun-ban",url:`/facilities/${this.facility.id}/settings/bans`,label:"MENU_ITEMS.FACILITY.BANS",style:"facility-btn"})}};o.\u0275fac=function(t){return new(t||o)(m(F),m(L),m(x),m(Le))},o.\u0275cmp=E({type:o,selectors:[["app-facility-settings-overview"]],hostVars:2,hostBindings:function(t,a){t&2&&k("router-component",a.true)},decls:2,vars:2,consts:[["class","me-auto ms-auto",4,"ngIf"],[4,"ngIf"],[1,"me-auto","ms-auto"],[3,"items"]],template:function(t,a){t&1&&_(0,On,1,0,"mat-spinner",0)(1,Nn,2,1,"div",1),t&2&&(c("ngIf",a.loading),r(),c("ngIf",!a.loading))},dependencies:[w,Se,De]});let i=o;return i})();function Vn(i,o){i&1&&(f(0),d(1,"translate")),i&2&&v(" ",u(1,1,"FACILITY_DETAIL.ENTITY")," ")}function Bn(i,o){if(i&1&&I(0,"app-one-entity-attribute-page",5),i&2){let n=h();c("entityId",n.facility.id)("entity","facility")}}function Pn(i,o){i&1&&(f(0),d(1,"translate"),d(2,"translate")),i&2&&ie(" ",u(1,2,"FACILITY_DETAIL.ENTITY")," - ",u(2,4,"ADMIN_USER.ENTITY")," ")}function Gn(i,o){if(i&1&&I(0,"app-two-entity-attribute-page",6),i&2){let n=h(2);c("firstEntity","facility")("firstEntityId",n.facility.id)("secondEntity","user")}}function Un(i,o){i&1&&(l(0,"mat-tab"),_(1,Pn,3,6,"ng-template",2)(2,Gn,1,3,"ng-template",3),s())}var pn=(()=>{let o=class o{constructor(e,t){this.authResolver=e,this.entityStorageService=t}ngOnInit(){this.facility=this.entityStorageService.getEntity(),this.facilityUserAttAuth=this.authResolver.isAuthorized("getAssignedUsers_Facility_policy",[this.facility])}};o.\u0275fac=function(t){return new(t||o)(m(L),m(x))},o.\u0275cmp=E({type:o,selectors:[["app-facility-attributes"]],hostVars:2,hostBindings:function(t,a){t&2&&k("router-component",a.true)},decls:9,vars:4,consts:[[1,"page-subtitle"],["mat-stretch-tabs","false"],["matTabLabel",""],["matTabContent",""],[4,"ngIf"],[3,"entityId","entity"],[3,"firstEntity","firstEntityId","secondEntity"]],template:function(t,a){t&1&&(l(0,"div")(1,"h1",0),f(2),d(3,"translate"),s(),l(4,"mat-tab-group",1)(5,"mat-tab"),_(6,Vn,2,3,"ng-template",2)(7,Bn,1,2,"ng-template",3),s(),_(8,Un,3,0,"mat-tab",4),s()()),t&2&&(r(2),T(u(3,2,"FACILITY_DETAIL.SETTINGS.ATTRIBUTES.TITLE")),r(6),c("ngIf",a.facilityUserAttAuth))},dependencies:[w,Qt,Jt,Zt,ei,Ti,ke,A]});let i=o;return i})();function jn(i,o){if(i&1){let n=b();l(0,"mat-option",10),g("onSelectionChange",function(){let a=S(n).$implicit,p=h(3);return y(p.onSelectedService(a))}),f(1),s()}if(i&2){let n=o.$implicit;c("value",n),r(),v(" ",n.name," ")}}function Wn(i,o){if(i&1){let n=b();l(0,"mat-form-field",6)(1,"mat-label"),f(2),d(3,"translate"),s(),l(4,"input",7),g("keyup",function(t){S(n);let a=h(2);return y(a.updatedSerVal(t))}),s(),l(5,"mat-autocomplete",8,9)(7,"mat-option",10),g("onSelectionChange",function(){S(n);let t=h(2);return y(t.onSelectedService("NOT_SELECTED"))}),f(8),d(9,"translate"),s(),l(10,"mat-option",10),g("onSelectionChange",function(){S(n);let t=h(2);return y(t.onSelectedService("ALL"))}),f(11),d(12,"translate"),s(),_(13,jn,2,2,"mat-option",11),d(14,"async"),s()()}if(i&2){let n=R(6),e=h(2);r(2),T(u(3,9,"FACILITY_DETAIL.SERVICE_CONFIG.SERVICE_SELECT")),r(2),c("formControl",e.serviceField)("matAutocomplete",n),r(),c("displayWith",e.serviceDisplayFn.bind(e)),r(2),c("value","NOT_SELECTED"),r(),v(" ",u(9,11,"FACILITY_DETAIL.SERVICE_CONFIG.NOT_SELECTED")," "),r(2),c("value","ALL"),r(),v(" ",u(12,13,"FACILITY_DETAIL.SERVICE_CONFIG.ALL")," "),r(2),c("ngForOf",u(14,15,e.filteredServices))}}function Hn(i,o){if(i&1){let n=b();l(0,"mat-option",10),g("onSelectionChange",function(){let a=S(n).$implicit,p=h(3);return y(p.onSelectedResource(a))}),f(1),s()}if(i&2){let n=o.$implicit;c("value",n),r(),v(" ",n.name," ")}}function zn(i,o){if(i&1){let n=b();l(0,"mat-form-field",6)(1,"mat-label"),f(2),d(3,"translate"),s(),l(4,"input",7),g("keyup",function(t){S(n);let a=h(2);return y(a.updatedResVal(t))}),s(),l(5,"mat-autocomplete",8,9),_(7,Hn,2,2,"mat-option",11),d(8,"async"),s()()}if(i&2){let n=R(6),e=h(2);r(2),T(u(3,5,"FACILITY_DETAIL.SERVICE_CONFIG.RES_SELECT")),r(2),c("formControl",e.resourceField)("matAutocomplete",n),r(),c("displayWith",e.resourceDisplayFn.bind(e)),r(2),c("ngForOf",u(8,7,e.filteredResources))}}function $n(i,o){if(i&1){let n=b();l(0,"mat-option",10),g("onSelectionChange",function(){let a=S(n).$implicit,p=h(3);return y(p.onSelectedGroup(a))}),f(1),s()}if(i&2){let n=o.$implicit;c("value",n),r(),v(" ",n.name," ")}}function Kn(i,o){if(i&1){let n=b();l(0,"mat-form-field",6)(1,"mat-label"),f(2),d(3,"translate"),s(),l(4,"input",7),g("keyup",function(t){S(n);let a=h(2);return y(a.updatedGroupVal(t))}),s(),l(5,"mat-autocomplete",12,9),_(7,$n,2,2,"mat-option",11),d(8,"async"),s()()}if(i&2){let n=R(6),e=h(2);r(2),T(u(3,5,"FACILITY_DETAIL.SERVICE_CONFIG.GROUP_SELECT")),r(2),c("formControl",e.groupField)("matAutocomplete",n),r(),c("displayWith",e.groupDisplayFn.bind(e)),r(2),c("ngForOf",u(8,7,e.filteredGroups))}}function Xn(i,o){if(i&1){let n=b();l(0,"mat-option",10),g("onSelectionChange",function(){let a=S(n).$implicit,p=h(3);return y(p.onSelectedMember(a))}),f(1),d(2,"userFullName"),s()}if(i&2){let n=o.$implicit;c("value",n),r(),v(" ",u(2,2,n.user)," ")}}function qn(i,o){if(i&1&&(l(0,"mat-form-field",6)(1,"mat-label"),f(2),d(3,"translate"),s(),I(4,"input",13),l(5,"mat-autocomplete",8,9),_(7,Xn,3,4,"mat-option",11),d(8,"async"),s()()),i&2){let n=R(6),e=h(2);r(2),T(u(3,5,"FACILITY_DETAIL.SERVICE_CONFIG.MEMBER_SELECT")),r(2),c("matAutocomplete",n)("formControl",e.memberField),r(),c("displayWith",e.memberDisplayFn.bind(e)),r(2),c("ngForOf",u(8,7,e.filteredMembers))}}function Qn(i,o){if(i&1){let n=b();l(0,"div",3),_(1,Wn,15,17,"mat-form-field",4),l(2,"mat-checkbox",5),g("change",function(t){S(n);let a=h();return y(a.onOfferAllServices(t))}),f(3),d(4,"translate"),s(),_(5,zn,9,9,"mat-form-field",4)(6,Kn,9,9,"mat-form-field",4)(7,qn,9,9,"mat-form-field",4),s()}if(i&2){let n=h();r(),c("ngIf",n.services!==void 0),r(2),v(" ",u(4,5,"FACILITY_DETAIL.SERVICE_CONFIG.ALL_SERVICES")," "),r(2),c("ngIf",n.resources!==void 0&&n.resources.length!==0),r(),c("ngIf",n.selectedResource!==void 0&&n.groups!==void 0&&n.groups.length!==0),r(),c("ngIf",n.selectedGroup!==void 0&&n.members!==void 0&&n.members.length!==0)}}function Jn(i,o){if(i&1&&I(0,"perun-web-apps-service-configurator",14),i&2){let n=h();c("facility",n.facility)("resource",n.selectedResource)("group",n.selectedGroup)("member",n.selectedMember)("service",n.selectedService)}}var mn=(()=>{let o=class o{constructor(e,t,a,p,C,O,X){this.facilityManager=e,this.resourceManager=t,this.serviceManager=a,this.membersManager=p,this.namePipe=C,this.translate=O,this.entityStorageService=X,this.serviceField=new ae,this.resourceField=new ae,this.groupField=new ae,this.memberField=new ae,this.allowedStatuses=["INVALID","VALID"],this.selectedService="NOT_SELECTED",this.attrNames=[],this.translate.get("FACILITY_DETAIL.SERVICE_CONFIG.ALL").subscribe(q=>this.serviceAllTranslation=q),this.translate.get("FACILITY_DETAIL.SERVICE_CONFIG.NOT_SELECTED").subscribe(q=>this.serviceNotSelectedTranslation=q)}ngOnInit(){this.facility=this.entityStorageService.getEntity(),this.facilityManager.getFacilityById(this.facility.id).subscribe(e=>{this.facility=e,this.facilityManager.getAssignedResourcesForFacility(e.id).subscribe(t=>this.resources=t),this.serviceManager.getAssignedServices(e.id).subscribe(t=>this.services=t)}),this.filteredServices=this.serviceField.valueChanges.pipe(be(""),Ce(e=>this._filterServices(e))),this.filteredResources=this.resourceField.valueChanges.pipe(be(""),Ce(e=>this._filterResources(e))),this.filteredGroups=this.groupField.valueChanges.pipe(be(""),Ce(e=>this._filterGroups(e))),this.filteredMembers=this.memberField.valueChanges.pipe(be(""),Ce(e=>this._filterMembers(e)))}onSelectedService(e){this.selectedService=e}onSelectedResource(e){this.selectedResource=e,this.selectedResource!==void 0?(this.resourceManager.getAssignedGroups(this.selectedResource.id).subscribe(t=>this.groups=t),this.selectedGroup=void 0,this.selectedMember=void 0):this.groups=void 0}onOfferAllServices(e){e.checked||this.serviceManager.getAssignedServices(this.facility.id).subscribe(t=>this.services=t)}onSelectedGroup(e){this.selectedGroup=e,this.selectedGroup!==void 0?(this.membersManager.getCompleteRichMembersForGroup(this.selectedGroup.id,!1,this.allowedStatuses,[],this.attrNames).subscribe(t=>this.members=t),this.selectedMember=void 0):this.members=void 0}onSelectedMember(e){this.selectedMember=e}serviceDisplayFn(e){if(e!==null)return e==="ALL"?this.serviceAllTranslation:e==="NOT_SELECTED"?this.serviceNotSelectedTranslation:typeof e!="string"?e.name:e}resourceDisplayFn(e){if(e!==null)return e.name}groupDisplayFn(e){if(e!==null)return e.name}memberDisplayFn(e){if(e!==null)return this.namePipe.transform(e.user)}updatedSerVal(e){e.target.value===""&&(this.selectedService="NOT_SELECTED")}updatedResVal(e){e.target.value===""&&(this.groups=void 0,this.members=void 0)}updatedGroupVal(e){e.target.value===""&&(this.members=void 0)}_filterServices(e){let t=e.toString().toLowerCase();return this.services.filter(a=>a.name.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").includes(t))}_filterResources(e){let t=e.toString().toLowerCase();return this.resources.filter(a=>a.name.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").includes(t))}_filterGroups(e){let t=e.toString().toLowerCase();return this.groups.filter(a=>a.name.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").includes(t))}_filterMembers(e){let t=e.toString().toLowerCase();return this.members.filter(a=>this.namePipe.transform(a.user).toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").includes(t))}};o.\u0275fac=function(t){return new(t||o)(m(F),m(Fe),m(te),m(_t),m(Z),m(ne),m(x))},o.\u0275cmp=E({type:o,selectors:[["app-facility-service-config"]],decls:6,vars:5,consts:[[1,"page-subtitle"],["class","col-12 col-lg-6 mb-2",4,"ngIf"],[3,"facility","resource","group","member","service",4,"ngIf"],[1,"col-12","col-lg-6","mb-2"],["class","w-100",4,"ngIf"],[3,"change"],[1,"w-100"],["matInput","","type","text",3,"formControl","matAutocomplete","keyup"],["autoActiveFirstOption","",3,"displayWith"],["auto","matAutocomplete"],[3,"value","onSelectionChange"],[3,"value","onSelectionChange",4,"ngFor","ngForOf"],["autoActiveFirstOption","",3,"displayWith","ngClass"],["matInput","","type","text",3,"matAutocomplete","formControl"],[3,"facility","resource","group","member","service"]],template:function(t,a){t&1&&(l(0,"div")(1,"h1",0),f(2),d(3,"translate"),s(),_(4,Qn,8,7,"div",1)(5,Jn,1,5,"perun-web-apps-service-configurator",2),s()),t&2&&(r(2),T(u(3,3,"FACILITY_DETAIL.SERVICE_CONFIG.TITLE")),r(2),c("ngIf",!!a.facility),r(),c("ngIf",!!a.facility))},dependencies:[pt,mt,w,Ci,yt,bi,Bt,Tt,bt,Et,At,Ft,Yt,ut,A,Z]});let i=o;return i})();var je=(()=>{let o=class o{constructor(e,t,a){this.facilityService=e,this.guiAuthResolver=t,this.entityStorageService=a,this.disableRouting=!1,this.disableSelf=!1,this.availableRoles=[],this.selected="user",this.type="Facility",this.theme="facility-theme"}ngOnInit(){this.facility=this.entityStorageService.getEntity(),this.guiAuthResolver.assignAvailableRoles(this.availableRoles,"Facility")}};o.\u0275fac=function(t){return new(t||o)(m(F),m(L),m(x))},o.\u0275cmp=E({type:o,selectors:[["app-perun-web-apps-facility-settings-managers"]],hostVars:2,hostBindings:function(t,a){t&2&&k("router-component",a.true)},inputs:{disableRouting:"disableRouting",disableSelf:"disableSelf"},decls:1,vars:6,consts:[[3,"complementaryObject","availableRoles","complementaryObjectType","disableSelf","disableRouting","theme"]],template:function(t,a){t&1&&I(0,"app-managers-page",0),t&2&&c("complementaryObject",a.facility)("availableRoles",a.availableRoles)("complementaryObjectType",a.type)("disableSelf",a.disableSelf)("disableRouting",a.disableRouting)("theme",a.theme)},dependencies:[Ve]});let i=o;return i})();function na(i,o){i&1&&(l(0,"perun-web-apps-alert",10),f(1),d(2,"translate"),s()),i&2&&(r(),v(" ",u(2,1,"FACILITY_DETAIL.SERVICES_DESTINATIONS.DESTINATIONS_INFO")," "))}function aa(i,o){if(i&1){let n=b();l(0,"button",11),g("click",function(){S(n);let t=h();return y(t.addDestination())}),f(1),d(2,"translate"),s()}i&2&&(r(),v(" ",u(2,1,"FACILITY_DETAIL.SERVICES_DESTINATIONS.ADD")," "))}function oa(i,o){if(i&1){let n=b();l(0,"button",12),g("click",function(){S(n);let t=h();return y(t.removeDestination())}),f(1),d(2,"translate"),s()}if(i&2){let n=h();c("disabled",n.selected.selected.length===0),r(),v(" ",u(2,2,"FACILITY_DETAIL.SERVICES_DESTINATIONS.REMOVE")," ")}}function ra(i,o){if(i&1){let n=b();l(0,"button",13),g("click",function(){S(n);let t=h();return y(t.onAllow())}),l(1,"mat-icon"),f(2," check_circle_outline "),s(),f(3),d(4,"translate"),s()}if(i&2){let n=h();c("disabled",n.selected.selected.length===0||n.allSelectedAllowed()),r(3),v(" ",u(4,2,"FACILITY_DETAIL.SERVICES_DESTINATIONS.ALLOW")," ")}}function sa(i,o){if(i&1){let n=b();l(0,"button",13),g("click",function(){S(n);let t=h();return y(t.onBlock())}),l(1,"mat-icon"),f(2," block "),s(),f(3),d(4,"translate"),s()}if(i&2){let n=h();c("disabled",n.selected.selected.length===0||n.allSelectedBlocked()),r(3),v(" ",u(4,2,"FACILITY_DETAIL.SERVICES_DESTINATIONS.BLOCK")," ")}}function la(i,o){i&1&&I(0,"perun-web-apps-loading-table")}function ca(i,o){if(i&1&&I(0,"app-perun-web-apps-destination-list",14),i&2){let n=h();c("filterValue",n.filterValue)("loading",n.loading)("selection",n.selected)("destinations",n.destinations)("services",n.configServicesIds)("displayedColumns",n.displayedColumns)("tableId",n.tableId)}}var We=(()=>{let o=class o{constructor(e,t,a,p,C,O,X,q){this.dialog=e,this.facilitiesManager=t,this.servicesManager=a,this.translate=p,this.notificator=C,this.authResolver=O,this.serviceManager=X,this.entityStorageService=q,this.displayedColumns=["select","destinationId","service","destination","type","status","propagationType","lastSuccessfulPropagation"],this.configServices=[],this.configServicesIds=new Set,this.title="FACILITY_DETAIL.SERVICES_DESTINATIONS.TITLE",this.destinationEmitter=new pe,this.destinations=[],this.selected=new V(!0,[]),this.filterValue="",this.tableId=Lt}ngOnInit(){this.loading=!0,this.facility=this.entityStorageService.getEntity(),this.setAuthRights(),this.refreshTable()}refreshTable(){this.loading=!0,this.servicesManager.getAllRichDestinationsForFacility(this.facility.id).subscribe(e=>{this.destinations=e,this.destinationEmitter.emit(this.destinations),this.selected.clear(),this.setAuthRights(),this.loading=!1})}setAuthRights(){this.addAuth=this.authResolver.isAuthorized("addDestination_Service_Facility_Destination_policy",[this.facility]),this.removeAuth=this.authResolver.isAuthorized("removeDestination_Service_Facility_Destination_policy",[this.facility]),this.allowAuth=this.authResolver.isAuthorized("unblockServiceOnDestination_Service_int_policy",[this.facility]),this.blockAuth=this.authResolver.isAuthorized("blockServiceOnDestination_Service_int_policy",[this.facility]),this.displayedColumns=this.removeAuth?this.displayedColumns:this.displayedColumns.filter(e=>e!=="select")}addDestination(){let e=D();e.width="600px",e.data={facility:this.facility,theme:"facility-theme",configServices:this.configServices},this.dialog.open(Bi,e).afterClosed().subscribe(a=>{a&&(this.refreshTable(),this.notificator.showSuccess(this.translate.instant("FACILITY_DETAIL.SERVICES_DESTINATIONS.ADD_SUCCESS")))})}removeDestination(){let e=D();e.width="600px",e.data={destinations:this.selected.selected,theme:"facility-theme"},this.dialog.open(Vi,e).afterClosed().subscribe(a=>{a&&this.refreshTable()})}blockServicesOnDestinations(e){this.serviceManager.blockServicesOnDestinations({richDestinations:e}).subscribe({next:()=>{this.notificator.showSuccess(this.translate.instant("FACILITY_DETAIL.SERVICES_DESTINATIONS.BLOCK_SUCCESS")),this.refreshTable()},error:()=>this.loading=!1})}onBlock(){this.loading=!0,this.blockServicesOnDestinations(this.selected.selected)}allowServicesOnDestinations(e){this.serviceManager.unblockServicesOnDestinations({richDestinations:e}).subscribe({next:()=>{this.notificator.showSuccess(this.translate.instant("FACILITY_DETAIL.SERVICES_DESTINATIONS.ALLOW_SUCCESS")),this.refreshTable()},error:()=>this.loading=!1})}onAllow(){this.loading=!0,this.allowServicesOnDestinations(this.selected.selected)}applyFilter(e){this.filterValue=e}allSelectedAllowed(){return this.selected.selected.reduce((e,t)=>e&&!t.blocked,!0)}allSelectedBlocked(){return this.selected.selected.reduce((e,t)=>e&&t.blocked,!0)}};o.id="FacilityServicesDestinationsComponent",o.\u0275fac=function(t){return new(t||o)(m(P),m(F),m(te),m(It),m(J),m(L),m(te),m(x))},o.\u0275cmp=E({type:o,selectors:[["app-perun-web-apps-facility-services-destinations"]],hostVars:2,hostBindings:function(t,a){t&2&&k("router-component",a.true)},inputs:{displayedColumns:"displayedColumns",configServices:"configServices",configServicesIds:"configServicesIds",title:"title",loading:"loading"},outputs:{destinationEmitter:"destinationEmitter"},decls:15,vars:11,consts:[[1,"page-subtitle"],["alert_type","info",4,"ngIf"],[3,"refresh"],["color","accent","class","me-2 action-button","mat-flat-button","",3,"click",4,"ngIf"],["class","me-2","color","warn","mat-flat-button","",3,"disabled","click",4,"ngIf"],["class","me-2","mat-stroked-button","",3,"disabled","click",4,"ngIf"],[3,"placeholder","filter"],["spinner",""],[1,"position-relative","table-min-height"],[3,"filterValue","loading","selection","destinations","services","displayedColumns","tableId",4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],["alert_type","info"],["color","accent","mat-flat-button","",1,"me-2","action-button",3,"click"],["color","warn","mat-flat-button","",1,"me-2",3,"disabled","click"],["mat-stroked-button","",1,"me-2",3,"disabled","click"],[3,"filterValue","loading","selection","destinations","services","displayedColumns","tableId"]],template:function(t,a){if(t&1&&(l(0,"div")(1,"h1",0),f(2),d(3,"translate"),s(),_(4,na,3,3,"perun-web-apps-alert",1),l(5,"perun-web-apps-refresh-button",2),g("refresh",function(){return a.refreshTable()}),s(),_(6,aa,3,3,"button",3)(7,oa,3,4,"button",4)(8,ra,5,4,"button",5)(9,sa,5,4,"button",5),l(10,"perun-web-apps-debounce-filter",6),g("filter",function(C){return a.applyFilter(C)}),s(),_(11,la,1,0,"ng-template",null,7,B),l(13,"div",8),_(14,ca,1,7,"app-perun-web-apps-destination-list",9),s()()),t&2){let p=R(12);r(2),T(u(3,9,a.title)),r(2),c("ngIf",a.title.includes("CONFIG")),r(2),c("ngIf",a.addAuth),r(),c("ngIf",a.removeAuth),r(),c("ngIf",a.allowAuth),r(),c("ngIf",a.blockAuth),r(),c("placeholder","FACILITY_DETAIL.SERVICES_DESTINATIONS.FILTER"),r(4),c("perunWebAppsLoader",a.loading)("perunWebAppsLoaderIndicator",p)}},dependencies:[w,oe,N,Pe,we,U,j,Y,G,A]});let i=o;return i})();function da(i,o){if(i&1){let n=b();l(0,"button",8),g("click",function(){S(n);let t=h();return y(t.onCreate())}),f(1),d(2,"translate"),s()}i&2&&(r(),v(" ",u(2,1,"FACILITY_DETAIL.SETTINGS.OWNERS.ADD"),`
`))}function ua(i,o){if(i&1){let n=b();l(0,"button",9),g("click",function(){S(n);let t=h();return y(t.onRemove())}),f(1),d(2,"translate"),s()}if(i&2){let n=h();c("disabled",n.selection.selected.length===0),r(),v(" ",u(2,2,"FACILITY_DETAIL.SETTINGS.OWNERS.DELETE"),`
`)}}function fa(i,o){i&1&&I(0,"perun-web-apps-loading-table")}function ha(i,o){if(i&1&&I(0,"perun-web-apps-owners-list",10),i&2){let n=h();c("displayedColumns",n.displayedColumns)("loading",n.loading)("filterValue",n.filterValue)("owners",n.owners)("selection",n.selection)("tableId",n.tableId)}}var He=(()=>{let o=class o{constructor(e,t,a,p){this.facilitiesManagerService=e,this.dialog=t,this.authResolver=a,this.entityStorageService=p,this.ownerEmitter=new pe,this.owners=[],this.selection=new V(!0,[]),this.displayedColumns=["id","name","contact","type"],this.tableId=Vt}ngOnInit(){this.filterValue="",this.facility=this.entityStorageService.getEntity(),this.setAuthRights(),this.refreshTable()}refreshTable(){this.loading=!0,this.selection.clear(),this.facilitiesManagerService.getFacilityOwners(this.facility.id).subscribe(e=>{this.owners=e,this.ownerEmitter.emit(this.owners),this.loading=!1})}setAuthRights(){this.addAuth=this.authResolver.isAuthorized("addOwner_Facility_Owner_policy",[this.facility]),this.removeAuth=this.authResolver.isAuthorized("removeOwner_Facility_Owner_policy",[this.facility]),this.displayedColumns=this.removeAuth?["select","id","name","contact","type"]:["id","name","contact","type"]}applyFilter(e){this.filterValue=e}onCreate(){let e=D();e.width="800px",e.data={theme:"facility-theme",facilityId:this.facility.id,forbiddenOwners:this.owners.map(a=>a.id)},this.dialog.open(ji,e).afterClosed().subscribe(a=>{a&&this.refreshTable()})}onRemove(){let e=D();e.width="600px",e.data={theme:"facility-theme",owners:this.selection.selected,facilityId:this.facility.id},this.dialog.open(Wi,e).afterClosed().subscribe(a=>{a&&this.refreshTable()})}};o.\u0275fac=function(t){return new(t||o)(m(F),m(P),m(L),m(x))},o.\u0275cmp=E({type:o,selectors:[["app-facility-settings-owners"]],outputs:{ownerEmitter:"ownerEmitter"},decls:11,vars:8,consts:[[1,"page-subtitle"],[3,"refresh"],["class","me-2 action-button","color","accent","mat-flat-button","",3,"click",4,"ngIf"],["class","me-2","color","warn","mat-flat-button","",3,"disabled","click",4,"ngIf"],[3,"placeholder","filter"],["spinner",""],[1,"position-relative","table-min-height"],[3,"displayedColumns","loading","filterValue","owners","selection","tableId",4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],["color","accent","mat-flat-button","",1,"me-2","action-button",3,"click"],["color","warn","mat-flat-button","",1,"me-2",3,"disabled","click"],[3,"displayedColumns","loading","filterValue","owners","selection","tableId"]],template:function(t,a){if(t&1&&(l(0,"h1",0),f(1),d(2,"translate"),s(),l(3,"perun-web-apps-refresh-button",1),g("refresh",function(){return a.refreshTable()}),s(),_(4,da,3,3,"button",2)(5,ua,3,4,"button",3),l(6,"perun-web-apps-debounce-filter",4),g("filter",function(C){return a.applyFilter(C)}),s(),_(7,fa,1,0,"ng-template",null,5,B),l(9,"div",6),_(10,ha,1,6,"perun-web-apps-owners-list",7),s()),t&2){let p=R(8);r(),T(u(2,6,"FACILITY_DETAIL.SETTINGS.OWNERS.TITLE")),r(3),c("ngIf",a.addAuth),r(),c("ngIf",a.removeAuth),r(),c("placeholder","VO_MANAGEMENT.FILTER_PLACEHOLDER"),r(4),c("perunWebAppsLoader",a.loading)("perunWebAppsLoaderIndicator",p)}},dependencies:[w,N,U,j,Y,Me,G,A]});let i=o;return i})();function va(i,o){if(i&1){let n=b();l(0,"button",8),g("click",function(){S(n);let t=h();return y(t.addHost())}),f(1),d(2,"translate"),s()}i&2&&(r(),v(" ",u(2,1,"FACILITY_DETAIL.HOSTS.ADD")," "))}function Ia(i,o){if(i&1){let n=b();l(0,"button",9),g("click",function(){S(n);let t=h();return y(t.removeHost())}),f(1),d(2,"translate"),s()}if(i&2){let n=h();c("disabled",n.selected.selected.length===0),r(),v(" ",u(2,2,"FACILITY_DETAIL.HOSTS.REMOVE")," ")}}function Sa(i,o){i&1&&I(0,"perun-web-apps-loading-table")}function ya(i,o){if(i&1&&I(0,"app-hosts-list",10),i&2){let n=h();c("disableRouting",!n.routeAuth||n.disableRouting)("loading",n.loading)("filterValue",n.filterValue)("hosts",n.hosts)("selection",n.selected)("displayedColumns",n.displayedColumns)("facilityId",n.facility.id)("tableId",n.tableId)}}var ze=(()=>{let o=class o{constructor(e,t,a,p){this.dialog=e,this.facilitiesManager=t,this.authResolver=a,this.entityStorageService=p,this.disableRouting=!1,this.hostEmitter=new pe,this.hosts=[],this.selected=new V(!0,[]),this.filterValue="",this.tableId=Dt,this.displayedColumns=["id","name"]}ngOnInit(){this.loading=!0,this.facility=this.entityStorageService.getEntity(),this.setAuthRights(),this.refreshTable()}refreshTable(){this.loading=!0,this.facilitiesManager.getHosts(this.facility.id).subscribe(e=>{this.hosts=e,this.hostEmitter.emit(this.hosts),this.selected.clear(),this.setAuthRights(),this.loading=!1})}setAuthRights(){this.addAuth=this.authResolver.isAuthorized("addHosts_Facility_List<String>_policy",[this.facility]),this.removeAuth=this.authResolver.isAuthorized("removeHosts_List<Host>_Facility_policy",[this.facility]),this.displayedColumns=this.removeAuth?["select","id","name"]:["id","name"],this.hosts.length!==0&&(this.routeAuth=this.authResolver.isAuthorized("getHostById_int_policy",[this.facility,this.hosts[0]]))}addHost(){let e=D();e.width="600px",e.data={facilityId:this.facility.id,theme:"facility-theme"},this.dialog.open(Ui,e).afterClosed().subscribe(a=>{a&&this.refreshTable()})}removeHost(){let e=D();e.width="600px",e.data={facilityId:this.facility.id,theme:"facility-theme",hosts:this.selected.selected},this.dialog.open(Yi,e).afterClosed().subscribe(a=>{a&&this.refreshTable()})}applyFilter(e){this.filterValue=e}};o.\u0275fac=function(t){return new(t||o)(m(P),m(F),m(L),m(x))},o.\u0275cmp=E({type:o,selectors:[["app-facility-hosts"]],inputs:{disableRouting:"disableRouting"},outputs:{hostEmitter:"hostEmitter"},decls:12,vars:8,consts:[[1,"page-subtitle"],[3,"refresh"],["color","accent","class","me-2 action-button","mat-flat-button","",3,"click",4,"ngIf"],["class","me-2","color","warn","mat-flat-button","",3,"disabled","click",4,"ngIf"],[3,"placeholder","filter"],["spinner",""],[1,"position-relative","table-min-height"],[3,"disableRouting","loading","filterValue","hosts","selection","displayedColumns","facilityId","tableId",4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],["color","accent","mat-flat-button","",1,"me-2","action-button",3,"click"],["color","warn","mat-flat-button","",1,"me-2",3,"disabled","click"],[3,"disableRouting","loading","filterValue","hosts","selection","displayedColumns","facilityId","tableId"]],template:function(t,a){if(t&1&&(l(0,"div")(1,"h1",0),f(2),d(3,"translate"),s(),l(4,"perun-web-apps-refresh-button",1),g("refresh",function(){return a.refreshTable()}),s(),_(5,va,3,3,"button",2)(6,Ia,3,4,"button",3),l(7,"perun-web-apps-debounce-filter",4),g("filter",function(C){return a.applyFilter(C)}),s(),_(8,Sa,1,0,"ng-template",null,5,B),l(10,"div",6),_(11,ya,1,8,"app-hosts-list",7),s()()),t&2){let p=R(9);r(2),T(u(3,6,"FACILITY_DETAIL.HOSTS.TITLE")),r(3),c("ngIf",a.addAuth),r(),c("ngIf",a.removeAuth),r(),c("placeholder","FACILITY_DETAIL.HOSTS.FILTER"),r(4),c("perunWebAppsLoader",a.loading)("perunWebAppsLoaderIndicator",p)}},dependencies:[w,N,Ge,U,j,Y,G,A]});let i=o;return i})();function ba(i,o){i&1&&I(0,"perun-web-apps-loading-table")}function Ta(i,o){if(i&1&&I(0,"app-perun-web-apps-blacklist-list",6),i&2){let n=h();c("bansOnFacilitiesWithUsers",n.bansOnFacilitiesWithUsers)("loading",n.loading)("filterValue",n.filterValue)("selection",n.selected)("tableId",n.tableId)}}var dn=(()=>{let o=class o{constructor(e,t,a){this.facilitiesManager=e,this.usersManager=t,this.entityStorageService=a,this.bansOnFacilitiesWithUsers=[],this.selected=new V(!0,[]),this.filterValue="",this.tableId=Mt}ngOnInit(){this.loading=!0,this.facility=this.entityStorageService.getEntity(),this.refreshTable()}refreshTable(){this.loading=!0,this.facilitiesManager.getBansForFacility(this.facility.id).subscribe(e=>{let t=e;for(let a of t){let p;this.usersManager.getUserById(a.userId).subscribe(C=>{p=C}),this.bansOnFacilitiesWithUsers.push([a,p])}this.selected.clear(),this.loading=!1})}applyFilter(e){this.filterValue=e}};o.\u0275fac=function(t){return new(t||o)(m(F),m(vt),m(x))},o.\u0275cmp=E({type:o,selectors:[["app-perun-web-apps-facility-settings-blacklist"]],decls:11,vars:8,consts:[[1,"page-subtitle"],[3,"refresh"],[3,"placeholder","filter"],["spinner",""],[1,"position-relative","table-min-height"],[3,"bansOnFacilitiesWithUsers","loading","filterValue","selection","tableId",4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],[3,"bansOnFacilitiesWithUsers","loading","filterValue","selection","tableId"]],template:function(t,a){if(t&1&&(l(0,"div")(1,"h1",0),f(2),d(3,"translate"),s(),l(4,"perun-web-apps-refresh-button",1),g("refresh",function(){return a.refreshTable()}),s(),l(5,"perun-web-apps-debounce-filter",2),g("filter",function(C){return a.applyFilter(C)}),d(6,"translate"),s(),_(7,ba,1,0,"ng-template",null,3,B),l(9,"div",4),_(10,Ta,1,5,"app-perun-web-apps-blacklist-list",5),s()()),t&2){let p=R(8);r(2),T(u(3,4,"FACILITY_DETAIL.SETTINGS.BLACKLIST.TITLE")),r(3),c("placeholder",u(6,6,"FACILITY_DETAIL.SETTINGS.BLACKLIST.FILTER")),r(5),c("perunWebAppsLoader",a.loading)("perunWebAppsLoaderIndicator",p)}},dependencies:[Pi,U,j,Y,G,A]});let i=o;return i})();var un=(()=>{let o=class o{constructor(e,t){this.facilityManager=e,this.route=t,this.host={beanName:"",id:0}}ngOnInit(){this.route.params.subscribe(e=>{this.hostId=Number(e.hostId),this.facilityManager.getHostById(this.hostId).subscribe(t=>{this.host=t})})}};o.\u0275fac=function(t){return new(t||o)(m(F),m(ue))},o.\u0275cmp=E({type:o,selectors:[["app-facility-hosts-detail"]],decls:5,vars:6,consts:[[1,"page-subtitle"],[3,"entityId","entity"]],template:function(t,a){t&1&&(l(0,"div")(1,"h1",0),f(2),d(3,"translate"),s(),I(4,"app-one-entity-attribute-page",1),s()),t&2&&(r(2),ie(" ",u(3,4,"FACILITY_DETAIL.HOSTS.HOSTS_DETAIL.TITLE")," ",a.host.hostname," "),r(2),c("entityId",a.hostId)("entity","host"))},dependencies:[ke,A]});let i=o;return i})();function Ea(i,o){i&1&&I(0,"perun-web-apps-loading-table")}function Aa(i,o){if(i&1&&I(0,"app-security-teams-list",6),i&2){let n=h();c("displayedColumns",n.displayedColumns)("loading",n.loading)("filterValue",n.filterValue)("securityTeams",n.securityTeams)("selection",n.selected)("tableId",n.tableId)}}var fn=(()=>{let o=class o{constructor(e,t,a,p){this.dialog=e,this.facilitiesManager=t,this.authResolver=a,this.entityStorageService=p,this.securityTeams=[],this.selected=new V(!0,[]),this.filterValue="",this.tableId=Ot,this.displayedColumns=[]}ngOnInit(){this.facility=this.entityStorageService.getEntity(),this.refreshTable()}refreshTable(){this.loading=!0,this.facilitiesManager.getAssignedSecurityTeams(this.facility.id).subscribe(e=>{this.securityTeams=e,this.selected.clear(),this.setAuthRights(),this.loading=!1})}setAuthRights(){this.addAuth=this.authResolver.isAuthorized("assignSecurityTeam_Facility_SecurityTeam_policy",[this.facility]),this.removeAuth=this.authResolver.isAuthorized("removeSecurityTeam_Facility_SecurityTeam_policy",[this.facility]),this.displayedColumns=this.removeAuth?["select","id","name","description"]:["id","name","description"]}applyFilter(e){this.filterValue=e}};o.\u0275fac=function(t){return new(t||o)(m(P),m(F),m(L),m(x))},o.\u0275cmp=E({type:o,selectors:[["app-facility-security-teams"]],decls:10,vars:6,consts:[[1,"page-subtitle"],[3,"refresh"],[3,"placeholder","filter"],["spinner",""],[1,"position-relative","table-min-height"],[3,"displayedColumns","loading","filterValue","securityTeams","selection","tableId",4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],[3,"displayedColumns","loading","filterValue","securityTeams","selection","tableId"]],template:function(t,a){if(t&1&&(l(0,"div")(1,"h1",0),f(2),d(3,"translate"),s(),l(4,"perun-web-apps-refresh-button",1),g("refresh",function(){return a.refreshTable()}),s(),l(5,"perun-web-apps-debounce-filter",2),g("filter",function(C){return a.applyFilter(C)}),s(),_(6,Ea,1,0,"ng-template",null,3,B),l(8,"div",4),_(9,Aa,1,6,"app-security-teams-list",5),s()()),t&2){let p=R(7);r(2),T(u(3,4,"FACILITY_DETAIL.SECURITY_TEAMS.TITLE")),r(3),c("placeholder","FACILITY_DETAIL.SECURITY_TEAMS.FILTER"),r(4),c("perunWebAppsLoader",a.loading)("perunWebAppsLoaderIndicator",p)}},dependencies:[Gi,U,j,Y,G,A]});let i=o;return i})();function Fa(i,o){if(i&1){let n=b();l(0,"button",12),g("click",function(){S(n);let t=h();return y(t.forcePropagation())}),f(1),d(2,"translate"),s()}if(i&2){let n=h();c("disabled",n.selected.selected.length===0||n.disableForcePropagationButton||n.loading),r(),v(" ",u(2,2,"FACILITY_DETAIL.SERVICES_STATUS.FORCE_PROPAGATION")," ")}}function xa(i,o){if(i&1){let n=b();l(0,"button",12),g("click",function(){S(n);let t=h();return y(t.allow())}),f(1),d(2,"translate"),s()}if(i&2){let n=h();c("disabled",n.selected.selected.length===0||n.disableAllowButton||n.loading),r(),v(" ",u(2,2,"FACILITY_DETAIL.SERVICES_STATUS.ALLOW")," ")}}function Ra(i,o){if(i&1){let n=b();l(0,"button",13),g("click",function(){S(n);let t=h();return y(t.block())}),f(1),d(2,"translate"),s()}if(i&2){let n=h();c("disabled",n.selected.selected.length===0||n.disableBlockButton||n.loading),r(),v(" ",u(2,2,"FACILITY_DETAIL.SERVICES_STATUS.BLOCK")," ")}}function wa(i,o){if(i&1&&(l(0,"button",14),d(1,"translate"),f(2),d(3,"translate"),s()),i&2){let n=h(),e=R(10);de("matTooltip",u(1,5,"DIALOGS.REMOVE_SERVICE_FROM_FACILITY.CHECKBOXES_DISABLED")),c("disabled",n.selected.selected.length===0||n.disableRemoveButton||n.loading)("matMenuTriggerFor",e)("matTooltipDisabled",!n.disableRemoveButton),r(2),v(" ",u(3,7,"FACILITY_DETAIL.SERVICES_STATUS.REMOVE")," ")}}function La(i,o){if(i&1){let n=b();l(0,"button",7),g("click",function(){S(n);let t=h();return y(t.removeTaskResults())}),f(1),d(2,"translate"),s()}i&2&&(r(),v(" ",u(2,1,"FACILITY_DETAIL.SERVICES_STATUS.REMOVE_TASK_RESULTS")," "))}function Da(i,o){i&1&&I(0,"perun-web-apps-loading-table")}function Ma(i,o){if(i&1){let n=b();l(0,"perun-web-apps-services-status-list",15),g("selectionChange",function(){S(n);let t=h();return y(t.selectionChanged())}),s()}if(i&2){let n=h();c("disableRouting",!n.routeAuth)("loading",n.loading)("filterValue",n.filterValue)("servicesStatus",n.servicesStates)("selection",n.selected)("tableId",n.tableId)}}var hn=(()=>{let o=class o{constructor(e,t,a,p,C,O,X,q,ye){this.tasksManager=e,this.servicesManager=t,this.notificator=a,this.translate=p,this.authResolver=C,this.facilityManager=O,this.resourcesManager=X,this.dialog=q,this.entityStorageService=ye,this.servicesStates=[],this.selected=new V(!0,[]),this.filterValue="",this.tableId=Nt,this.disableAllowButton=!0,this.disableBlockButton=!0,this.disableRemoveButton=!0,this.disableForcePropagationButton=!1}ngOnInit(){this.loading=!0,this.facility=this.entityStorageService.getEntity(),this.setAuthRights(),this.refreshTable()}forcePropagation(){let e=this.selected.selected.map(t=>t.service.id);this.servicesManager.forceServicePropagationBulk(e,this.facility.id).subscribe({next:()=>{this.notificator.showInstantSuccess("FACILITY_DETAIL.SERVICES_STATUS.SUCCESS_FORCE_PROPAGATION"),this.loading=!1},error:()=>{this.loading=!1}})}allow(){let e=this.selected.selected.map(t=>t.service.id);this.servicesManager.unblockServicesOnFacility(e,this.facility.id).subscribe({next:()=>{this.notificator.showInstantSuccess("FACILITY_DETAIL.SERVICES_STATUS.SUCCESS_ALLOW"),this.refreshTable()},error:()=>{this.loading=!1}})}block(){let e=this.selected.selected.map(t=>t.service.id);this.servicesManager.blockServicesOnFacility(e,this.facility.id).subscribe({next:()=>{this.notificator.showInstantSuccess("FACILITY_DETAIL.SERVICES_STATUS.SUCCESS_BLOCK"),this.refreshTable()},error:()=>{this.loading=!1}})}removeTaskResults(){this.loading=!0,this.tasksManager.getTaskResultsForGUIByTask(this.selected.selected[0].task.id).subscribe(e=>{let t=D();t.width="600px",t.data={theme:"facility-theme",taskResults:e},this.loading=!1,this.dialog.open(Ue,t)})}removeServiceFromFacility(){this.loading=!0,this.facilityManager.getAssignedResourcesByAssignedServiceForFacility(this.selected.selected[0].facility.id,this.selected.selected[0].service.id).subscribe({next:e=>{let t=D();t.width="600px",this.taskId=this.taskIsNull?null:this.selected.selected[0].task.id,e.length===0?(t.data={theme:"facility-theme",taskId:this.taskId},this.loading=!1,this.dialog.open($i,t).afterClosed().subscribe(p=>{p&&(this.disableRemoveButton=!0,this.refreshTable())})):this.resourcesManager.getRichResourcesByIds(e.map(a=>a.id)).subscribe(a=>{t.data={theme:"facility-theme",taskId:this.taskId,serviceId:this.selected.selected[0].service.id,facilityId:this.selected.selected[0].facility.id,resource:a},this.loading=!1,this.dialog.open(zi,t).afterClosed().subscribe(C=>{C&&(this.disableRemoveButton=!0,this.refreshTable())})})},error:()=>this.loading=!1})}refreshTable(){this.loading=!0,this.tasksManager.getFacilityServicesState(this.facility.id).subscribe(e=>{this.servicesStates=e,this.selected.clear(),this.setAuthRights(),this.loading=!1})}setAuthRights(){this.propagationAuth=this.authResolver.isAuthorized("forceServicePropagation_Facility_Service_policy",[this.facility]),this.blockAuth=this.authResolver.isAuthorized("blockServiceOnFacility_Service_Facility_policy",[this.facility]),this.allowAuth=this.authResolver.isAuthorized("unblockServiceOnFacility_Service_Facility_policy",[this.facility]),this.deleteAuth=this.authResolver.isAuthorized("deleteTask_Task_policy",[this.facility]),this.routeAuth=this.authResolver.isAuthorized("getTaskResultsByTask_int_policy",[this.facility])}applyFilter(e){this.filterValue=e}selectionChanged(){this.disableBlockButton=!1,this.disableAllowButton=!1,this.disableRemoveButton=this.selected.selected.length!==1,this.disableForcePropagationButton=!1,this.disableRemoveButton||(this.taskIsNull=this.selected.selected[0].task===null);for(let e of this.selected.selected)e.blockedOnFacility?(this.disableBlockButton=!0,this.disableForcePropagationButton=!0):this.disableAllowButton=!0}};o.\u0275fac=function(t){return new(t||o)(m(xe),m(te),m(J),m(ne),m(L),m(F),m(Fe),m(P),m(x))},o.\u0275cmp=E({type:o,selectors:[["app-facility-service-status"]],decls:20,vars:14,consts:[[1,"page-subtitle"],[3,"refresh"],["class","me-2","color","accent","mat-flat-button","",3,"disabled","click",4,"ngIf"],["class","me-2","color","warn","mat-flat-button","",3,"disabled","click",4,"ngIf"],["mat-flat-button","","class","me-2 dropdown-toggle","color","warn",3,"disabled","matMenuTriggerFor","matTooltipDisabled","matTooltip",4,"ngIf"],["menu","matMenu"],["mat-menu-item","",3,"click",4,"ngIf"],["mat-menu-item","",3,"click"],[3,"placeholder","filter"],["spinner",""],[1,"position-relative","table-min-height"],[3,"disableRouting","loading","filterValue","servicesStatus","selection","tableId","selectionChange",4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],["color","accent","mat-flat-button","",1,"me-2",3,"disabled","click"],["color","warn","mat-flat-button","",1,"me-2",3,"disabled","click"],["mat-flat-button","","color","warn",1,"me-2","dropdown-toggle",3,"disabled","matMenuTriggerFor","matTooltipDisabled","matTooltip"],[3,"disableRouting","loading","filterValue","servicesStatus","selection","tableId","selectionChange"]],template:function(t,a){if(t&1&&(l(0,"div")(1,"h1",0),f(2),d(3,"translate"),s(),l(4,"perun-web-apps-refresh-button",1),g("refresh",function(){return a.refreshTable()}),s(),_(5,Fa,3,4,"button",2)(6,xa,3,4,"button",2)(7,Ra,3,4,"button",3)(8,wa,4,9,"button",4),l(9,"mat-menu",null,5),_(11,La,3,3,"button",6),l(12,"button",7),g("click",function(){return a.removeServiceFromFacility()}),f(13),d(14,"translate"),s()(),l(15,"perun-web-apps-debounce-filter",8),g("filter",function(C){return a.applyFilter(C)}),s(),_(16,Da,1,0,"ng-template",null,9,B),l(18,"div",10),_(19,Ma,1,6,"perun-web-apps-services-status-list",11),s()()),t&2){let p=R(17);r(2),T(u(3,10,"FACILITY_DETAIL.SERVICES_STATUS.TITLE")),r(3),c("ngIf",a.propagationAuth),r(),c("ngIf",a.allowAuth),r(),c("ngIf",a.blockAuth),r(),c("ngIf",a.deleteAuth),r(3),c("ngIf",!a.taskIsNull),r(2),v(" ",u(14,12,"FACILITY_DETAIL.SERVICES_STATUS.REMOVE_SERVICE_FROM_FACILITY")," "),r(2),c("placeholder","SHARED_LIB.PERUN.COMPONENTS.SERVICES_STATUS_LIST.TABLE_SEARCH"),r(4),c("perunWebAppsLoader",a.loading)("perunWebAppsLoaderIndicator",p)}},dependencies:[w,N,Re,Gt,Pt,Ut,U,j,di,Y,G,A]});let i=o;return i})();function Oa(i,o){if(i&1){let n=b();l(0,"button",8),g("click",function(){S(n);let t=h();return y(t.removeTaskResult())}),f(1),d(2,"translate"),s()}if(i&2){let n=h();c("disabled",n.selection.selected.length===0),r(),v(" ",u(2,2,"FACILITY_DETAIL.TASK_RESULTS.REMOVE"),`
`)}}function Na(i,o){i&1&&I(0,"perun-web-apps-loading-table")}function ka(i,o){if(i&1&&I(0,"perun-web-apps-task-results-list",9),i&2){let n=h();c("tableId",n.tableId)("loading",n.loading)("displayedColumns",n.displayedColumns)("filterValue",n.filterValue)("selection",n.selection)("taskResults",n.taskResults)}}var gn=(()=>{let o=class o{constructor(e,t,a,p,C){this.route=e,this.taskManager=t,this.authResolver=a,this.dialog=p,this.entityStorageService=C,this.loading=!1,this.filterValue="",this.selection=new V(!0,[]),this.task={id:0},this.taskResults=[],this.tableId=kt,this.displayedColumns=["select","id","destination","type","service","status","time","returnCode","standardMessage","errorMessage"],this.removeAuth=!1}ngOnInit(){this.loading=!0,this.facility=this.entityStorageService.getEntity(),this.removeAuth=this.authResolver.isAuthorized("deleteTask_Task_policy",[this.facility]),this.removeAuth||(this.displayedColumns=["id","destination","type","service","status","time","returnCode","standardMessage","errorMessage"]),this.route.params.subscribe(e=>{this.taskId=Number(e.taskId),this.taskManager.getTaskById(this.taskId).subscribe(t=>{this.task=t,this.refreshTable()})})}refreshTable(){this.loading=!0,this.taskManager.getTaskResultsForGUIByTask(this.taskId).subscribe(e=>{this.selection.clear(),this.taskResults=e,this.loading=!1})}removeTaskResult(){let e=D();e.width="600px",e.data={theme:"facility-theme",taskResults:this.selection.selected},this.dialog.open(Ue,e).afterClosed().subscribe(a=>{a&&this.refreshTable()})}applyFilter(e){this.filterValue=e}};o.\u0275fac=function(t){return new(t||o)(m(ue),m(xe),m(L),m(P),m(x))},o.\u0275cmp=E({type:o,selectors:[["app-facility-task-results"]],decls:12,vars:9,consts:[[1,"page-subtitle"],[1,"text-muted"],[3,"refresh"],["class","me-2","color","warn","mat-flat-button","",3,"disabled","click",4,"ngIf"],[3,"placeholder","filter"],["spinner",""],[1,"position-relative","table-min-height"],[3,"tableId","loading","displayedColumns","filterValue","selection","taskResults",4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],["color","warn","mat-flat-button","",1,"me-2",3,"disabled","click"],[3,"tableId","loading","displayedColumns","filterValue","selection","taskResults"]],template:function(t,a){if(t&1&&(l(0,"h1",0),f(1),d(2,"translate"),l(3,"span",1),f(4),s()(),l(5,"perun-web-apps-refresh-button",2),g("refresh",function(){return a.refreshTable()}),s(),_(6,Oa,3,4,"button",3),l(7,"perun-web-apps-debounce-filter",4),g("filter",function(C){return a.applyFilter(C)}),s(),_(8,Na,1,0,"ng-template",null,5,B),l(10,"div",6),_(11,ka,1,6,"perun-web-apps-task-results-list",7),s()),t&2){let p=R(9);r(),ie(" ",u(2,7,"FACILITY_DETAIL.TASK_RESULTS.TITLE")," - ",a.task.service?a.task.service.name:""," "),r(3),v(" \xA0#",a.task.id," "),r(2),c("ngIf",a.removeAuth),r(),c("placeholder","FACILITY_DETAIL.TASK_RESULTS.FILTER"),r(4),c("perunWebAppsLoader",a.loading)("perunWebAppsLoaderIndicator",p)}},dependencies:[w,N,U,j,ui,Y,G,A]});let i=o;return i})();var _n=(()=>{let o=class o{constructor(e,t){this.dialogRef=e,this.data=t,this.theme=""}ngOnInit(){this.theme=this.data.theme}onCancel(){this.dialogRef.close(!1)}onSkip(){this.dialogRef.close(!0)}};o.\u0275fac=function(t){return new(t||o)(m(he),m(ge))},o.\u0275cmp=E({type:o,selectors:[["app-no-service-dialog"]],decls:14,vars:15,consts:[["mat-dialog-title",""],["mat-dialog-content",""],["matDialogActions",""],["mat-stroked-button","",1,"ms-auto","me-2",3,"click"],["color","accent","mat-flat-button","",3,"click"]],template:function(t,a){t&1&&(l(0,"div")(1,"h1",0),f(2),d(3,"translate"),s(),l(4,"div",1),f(5),d(6,"translate"),s(),l(7,"div",2)(8,"button",3),g("click",function(){return a.onCancel()}),f(9),d(10,"translate"),s(),l(11,"button",4),g("click",function(){return a.onSkip()}),f(12),d(13,"translate"),s()()()),t&2&&(me(a.theme),r(2),T(u(3,7,"DIALOGS.NO_SERVICE.TITLE")),r(3),v(" ",u(6,9,"DIALOGS.NO_SERVICE.INFO")," "),r(4),v(" ",u(10,11,"DIALOGS.NO_SERVICE.CANCEL")," "),r(3),v(" ",u(13,13,"DIALOGS.NO_SERVICE.SKIP")," "))},dependencies:[N,_e,Ie,ve,A]});let i=o;return i})();var vn=(()=>{let o=class o{constructor(e,t){this.dialogRef=e,this.data=t,this.theme=""}ngOnInit(){this.theme=this.data.theme}onCancel(){this.dialogRef.close(!1)}onSkip(){this.dialogRef.close(!0)}};o.\u0275fac=function(t){return new(t||o)(m(he),m(ge))},o.\u0275cmp=E({type:o,selectors:[["app-config-unsaved-dialog"]],decls:14,vars:15,consts:[["mat-dialog-title",""],["mat-dialog-content",""],["matDialogActions",""],["mat-stroked-button","",1,"ms-auto","me-2",3,"click"],["color","accent","mat-flat-button","",3,"click"]],template:function(t,a){t&1&&(l(0,"div")(1,"h1",0),f(2),d(3,"translate"),s(),l(4,"div",1),f(5),d(6,"translate"),s(),l(7,"div",2)(8,"button",3),g("click",function(){return a.onCancel()}),f(9),d(10,"translate"),s(),l(11,"button",4),g("click",function(){return a.onSkip()}),f(12),d(13,"translate"),s()()()),t&2&&(me(a.theme),r(2),T(u(3,7,"DIALOGS.CONFIG_UNSAVED.TITLE")),r(3),v(" ",u(6,9,"DIALOGS.CONFIG_UNSAVED.INFO")," "),r(4),v(" ",u(10,11,"DIALOGS.CONFIG_UNSAVED.CANCEL")," "),r(3),v(" ",u(13,13,"DIALOGS.CONFIG_UNSAVED.SKIP")," "))},dependencies:[N,_e,Ie,ve,A]});let i=o;return i})();function Va(i,o){if(i&1&&(l(0,"div",3),I(1,"i",4),d(2,"translate"),s()),i&2){let n=h();r(),c("innerHTML",u(2,1,n.info),Ae)}}function Ba(i,o){if(i&1){let n=b();l(0,"button",10),g("click",function(){S(n);let t=h(2);return y(t.onKeep())}),f(1),d(2,"translate"),s()}i&2&&(r(),v(" ",u(2,1,"DIALOGS.CANCEL_CONFIG.KEEP")," "))}function Pa(i,o){if(i&1){let n=b();l(0,"div",5)(1,"button",6),g("click",function(){S(n);let t=h();return y(t.onCancel())}),f(2),d(3,"translate"),s(),l(4,"button",7),g("click",function(){S(n);let t=h();return y(t.onDelete())}),l(5,"mat-icon",8),f(6," warning "),s(),f(7),d(8,"translate"),s(),_(9,Ba,3,3,"button",9),s()}if(i&2){let n=h();r(2),v(" ",u(3,3,"DIALOGS.CANCEL_CONFIG.CANCEL")," "),r(5),v(" ",u(8,5,"DIALOGS.CANCEL_CONFIG.DELETE")," "),r(2),c("ngIf",!n.lastStep)}}var In=(()=>{let o=class o{constructor(e,t,a,p,C){this.dialogRef=e,this.data=t,this.facilityService=a,this.notificator=p,this.translate=C,this.theme="",this.title="",this.info="",this.loading=!1}ngOnInit(){this.theme=this.data.theme,this.lastStep=this.data.lastStep,this.lastStep?(this.title="DIALOGS.CANCEL_CONFIG.TITLE_COMPLETE",this.info="DIALOGS.CANCEL_CONFIG.INFO_COMPLETE"):(this.title="DIALOGS.CANCEL_CONFIG.TITLE_INCOMPLETE",this.info="DIALOGS.CANCEL_CONFIG.INFO_INCOMPLETE")}onCancel(){this.dialogRef.close(!1)}onDelete(){this.loading=!0,this.facilityService.deleteFacility(this.data.facilityId,!0).subscribe(()=>{this.notificator.showSuccess(this.translate.instant("DIALOGS.CANCEL_CONFIG.SUCCESS")),this.dialogRef.close(!0),this.loading=!1},()=>this.loading=!1)}onKeep(){this.dialogRef.close(!0)}};o.\u0275fac=function(t){return new(t||o)(m(he),m(ge),m(F),m(J),m(ne))},o.\u0275cmp=E({type:o,selectors:[["app-cancel-configuration-dialog"]],decls:6,vars:8,consts:[["mat-dialog-title",""],["mat-dialog-content","",4,"ngIf"],["matDialogActions","",4,"ngIf"],["mat-dialog-content",""],[3,"innerHTML"],["matDialogActions",""],["mat-stroked-button","",1,"me-2",3,"click"],["color","warn","mat-flat-button","",1,"ms-auto","me-2",3,"click"],["iconPositionEnd",""],["color","accent","mat-flat-button","",3,"click",4,"ngIf"],["color","accent","mat-flat-button","",3,"click"]],template:function(t,a){t&1&&(l(0,"div")(1,"h1",0),f(2),d(3,"translate"),s(),_(4,Va,3,3,"div",1)(5,Pa,10,7,"div",2),s()),t&2&&(me(a.theme),r(2),T(u(3,6,a.title)),r(2),c("ngIf",!a.loading),r(),c("ngIf",!a.loading))},dependencies:[w,oe,N,_e,Ie,ve,A]});let i=o;return i})();var Ga=["stepper"];function Ua(i,o){i&1&&I(0,"perun-web-apps-loading-table")}function Ya(i,o){i&1&&(f(0),d(1,"translate")),i&2&&T(u(1,1,"FACILITY_CONFIGURATION.OWNERS"))}function ja(i,o){if(i&1){let n=b();l(0,"app-facility-settings-owners",15),g("ownerEmitter",function(t){S(n);let a=h();return y(a.owners=t)}),s()}}function Wa(i,o){i&1&&(f(0),d(1,"translate")),i&2&&T(u(1,1,"FACILITY_CONFIGURATION.HOSTS"))}function Ha(i,o){if(i&1){let n=b();l(0,"app-facility-hosts",16),g("hostEmitter",function(t){S(n);let a=h();return y(a.hosts=t)}),s()}i&2&&c("disableRouting",!0)}function za(i,o){i&1&&(f(0),d(1,"translate")),i&2&&T(u(1,1,"FACILITY_CONFIGURATION.SERVICES"))}var $a=()=>["select","id","name","enabled","description"];function Ka(i,o){if(i&1){let n=b();l(0,"h1",17),f(1),d(2,"translate"),s(),l(3,"perun-web-apps-alert",18),f(4),d(5,"translate"),s(),l(6,"div",19)(7,"perun-web-apps-debounce-filter",20),g("filter",function(t){S(n);let a=h();return y(a.applyFilter(t))}),s(),l(8,"perun-web-apps-service-package-search-select",21),g("packageSelected",function(t){S(n);let a=h();return y(a.packagesSelected(t))}),s()(),l(9,"app-services-list",22),g("selectionChanged",function(){S(n);let t=h();return y(t.singleServiceSelected())}),s()}if(i&2){let n=h();r(),T(u(2,14,"FACILITY_CONFIGURATION.SERVICES")),r(3),v(" ",u(5,16,"FACILITY_CONFIGURATION.SERVICES_INFO")," "),r(3),c("placeholder","FACILITY_CONFIGURATION.SERVICES_FILTER"),r(),c("disableAutoSelect",!0)("selectedPackage",n.selectedPackages)("multiple",!0)("servicePackages",n.servicePackages)("theme","facility-theme"),r(),c("loading",n.processing)("disableRouting",!0)("displayedColumns",$(18,$a))("selection",n.selection)("filterValue",n.filterValue)("services",n.services)}}function Xa(i,o){i&1&&(f(0),d(1,"translate")),i&2&&T(u(1,1,"FACILITY_CONFIGURATION.SERVICE_CONFIG"))}function qa(i,o){if(i&1){let n=b();l(0,"perun-web-apps-service-search-select",28),g("serviceSelected",function(t){S(n);let a=h(2);return y(a.filterAttributes(t))}),s()}if(i&2){let n=h(2);c("disableAutoSelect",!0)("services",n.selection.selected)("multiple",!0)("theme","facility-theme")}}function Qa(i,o){if(i&1&&I(0,"perun-web-apps-attributes-list",29),i&2){let n=h(2);c("loading",n.processing)("emptyListText","FACILITY_CONFIGURATION.EMPTY_REQ_ATT")("attributes",n.filteredAttributes)("selection",n.attSelection)}}function Ja(i,o){if(i&1){let n=b();l(0,"h1",17),f(1),d(2,"translate"),s(),l(3,"perun-web-apps-alert",18),f(4),d(5,"translate"),s(),l(6,"div",19)(7,"button",23),g("click",function(){S(n);let t=h();return y(t.onRemoveAttributes())}),f(8),d(9,"translate"),s(),l(10,"button",24),g("click",function(){S(n);let t=h();return y(t.onSaveAttributes())}),f(11),d(12,"translate"),s(),_(13,qa,1,4,"perun-web-apps-service-search-select",25),s(),l(14,"div",26),_(15,Qa,1,4,"perun-web-apps-attributes-list",27),s()}if(i&2){let n=h(),e=R(5),t=R(7);r(),T(u(2,9,"FACILITY_CONFIGURATION.SERVICE_CONFIG")),r(3),v(" ",u(5,11,"FACILITY_CONFIGURATION.ATT_INFO")," "),r(3),c("disabled",n.attSelection.selected.length===0),r(),v(" ",u(9,13,"FACILITY_CONFIGURATION.REMOVE")," "),r(2),c("disabled",n.attSelection.selected.length===0),r(),v(" ",u(12,15,"FACILITY_CONFIGURATION.SAVE")," "),r(2),c("ngIf",e.selectedIndex===n.ATTRIBUTES_IDX),r(2),c("perunWebAppsLoader",n.processing)("perunWebAppsLoaderIndicator",t)}}function Za(i,o){i&1&&(f(0),d(1,"translate")),i&2&&T(u(1,1,"FACILITY_CONFIGURATION.DESTINATION_CONFIG"))}var eo=()=>["select","destinationId","service","warn","destination","type","propagationType"];function to(i,o){if(i&1){let n=b();l(0,"app-perun-web-apps-facility-services-destinations",30),g("destinationEmitter",function(t){S(n);let a=h();return y(a.destinations=t)}),s()}if(i&2){let n=h();c("configServicesIds",n.serviceIds)("displayedColumns",$(5,eo))("configServices",n.selection.selected)("loading",n.processing)("title","FACILITY_CONFIGURATION.DESTINATION_CONFIG")}}function io(i,o){i&1&&(f(0),d(1,"translate")),i&2&&T(u(1,1,"FACILITY_CONFIGURATION.MANAGERS"))}function no(i,o){i&1&&I(0,"app-perun-web-apps-facility-settings-managers",31),i&2&&c("disableRouting",!0)("disableSelf",!0)}function ao(i,o){i&1&&(f(0),d(1,"translate")),i&2&&T(u(1,1,"FACILITY_CONFIGURATION.SUMMARY"))}var oo=()=>["id","name","contact","type"];function ro(i,o){if(i&1&&I(0,"perun-web-apps-owners-list",48),i&2){let n=h(3);c("loading",n.processing)("displayedColumns",$(3,oo))("owners",n.owners)}}var so=()=>["id","name"];function lo(i,o){if(i&1&&I(0,"app-hosts-list",49),i&2){let n=h(3);c("loading",n.processing)("disableRouting",!0)("displayedColumns",$(4,so))("hosts",n.hosts)}}var co=()=>["destinationId","service","warn","destination","type","propagationType"];function po(i,o){if(i&1&&I(0,"app-perun-web-apps-destination-list",50),i&2){let n=h(3);c("loading",n.processing)("destinations",n.destinations)("displayedColumns",$(4,co))("services",n.serviceIds)}}var mo=()=>["id","name","enabled","script","description"],uo=()=>["id","displayName","value","description"],fo=()=>["id","vo","name","description"],ho=()=>["id","name","email","logins","organization"];function go(i,o){if(i&1){let n=b();l(0,"mat-accordion")(1,"mat-expansion-panel",34)(2,"mat-expansion-panel-header")(3,"mat-panel-title"),I(4,"mat-icon",35),f(5),d(6,"translate"),s()(),l(7,"h1",17),f(8),d(9,"translate"),s(),l(10,"div",26),_(11,ro,1,4,"perun-web-apps-owners-list",36),s()(),l(12,"mat-expansion-panel",34)(13,"mat-expansion-panel-header")(14,"mat-panel-title"),I(15,"mat-icon",37),f(16),d(17,"translate"),s()(),l(18,"h1",17),f(19),d(20,"translate"),s(),l(21,"div",26),_(22,lo,1,5,"app-hosts-list",38),s()(),l(23,"mat-expansion-panel",34)(24,"mat-expansion-panel-header")(25,"mat-panel-title"),I(26,"mat-icon",39),f(27),d(28,"translate"),s()(),l(29,"h1",17),f(30),d(31,"translate"),s(),I(32,"app-services-list",40),s(),l(33,"mat-expansion-panel",41),g("opened",function(){S(n);let t=h(2);return y(t.getNonEmptyAttributes())}),l(34,"mat-expansion-panel-header")(35,"mat-panel-title"),I(36,"mat-icon",37),f(37),d(38,"translate"),s()(),l(39,"h1",17),f(40),d(41,"translate"),s(),I(42,"perun-web-apps-attributes-list",42),s(),l(43,"mat-expansion-panel",43),g("expandedChange",function(t){S(n);let a=h(2);return y(a.destinationServiceMissing=t)}),l(44,"mat-expansion-panel-header")(45,"mat-panel-title"),I(46,"mat-icon",44),f(47),d(48,"translate"),s()(),l(49,"h1",17),f(50),d(51,"translate"),s(),l(52,"div",26),_(53,po,1,5,"app-perun-web-apps-destination-list",45),s()(),l(54,"mat-expansion-panel")(55,"mat-expansion-panel-header")(56,"mat-panel-title"),I(57,"mat-icon",46),f(58),d(59,"translate"),s()(),I(60,"app-managers-page",47),s()()}if(i&2){let n=h(2),e=R(7);c("@.disabled",!0),r(),c("disabled",n.owners.length===0),r(),k("cursor-default",n.owners.length===0),r(3),v(" ",u(6,49,"FACILITY_CONFIGURATION.OWNERS")," "),r(3),T(u(9,51,"FACILITY_CONFIGURATION.OWNERS")),r(3),c("perunWebAppsLoader",n.processing)("perunWebAppsLoaderIndicator",e),r(),c("disabled",n.hosts.length===0),r(),k("cursor-default",n.hosts.length===0),r(3),v(" ",u(17,53,"FACILITY_CONFIGURATION.HOSTS")," "),r(3),T(u(20,55,"FACILITY_CONFIGURATION.HOSTS")),r(3),c("perunWebAppsLoader",n.processing)("perunWebAppsLoaderIndicator",e),r(),c("disabled",n.selection.selected.length===0),r(),k("cursor-default",n.selection.selected.length===0),r(3),v(" ",u(28,57,"FACILITY_CONFIGURATION.SERVICES")," "),r(3),T(u(31,59,"FACILITY_CONFIGURATION.SERVICES")),r(2),c("loading",n.processing)("disableRouting",!0)("displayedColumns",$(71,mo))("services",n.selection.selected),r(),c("disabled",n.selection.selected.length===0),r(),k("cursor-default",n.selection.selected.length===0),r(3),v(" ",u(38,61,"FACILITY_CONFIGURATION.SERVICE_CONFIG")," "),r(3),T(u(41,63,"FACILITY_CONFIGURATION.ATTS")),r(2),c("loading",n.processing)("displayedColumns",$(72,uo))("attributes",n.filteredAttributes)("emptyListText","FACILITY_CONFIGURATION.EMPTY_REQ_ATT"),r(),c("expanded",n.destinationServiceMissing)("disabled",n.selection.selected.length===0&&n.destinations.length===0),r(),k("cursor-default",n.selection.selected.length===0&&n.destinations.length===0),r(3),v(" ",u(48,65,"FACILITY_CONFIGURATION.DESTINATION_CONFIG")," "),r(3),T(u(51,67,"FACILITY_CONFIGURATION.DESTINATION")),r(3),c("perunWebAppsLoader",n.processing)("perunWebAppsLoaderIndicator",e),r(5),v(" ",u(59,69,"FACILITY_CONFIGURATION.MANAGERS")," "),r(2),c("complementaryObject",n.facility)("configMode",!0)("disableRouting",!0)("availableRoles",n.availableRoles)("complementaryObjectType","Facility")("displayedGroupColumns",$(73,fo))("displayedUserColumns",$(74,ho))}}function _o(i,o){if(i&1&&(l(0,"perun-web-apps-alert",18),I(1,"i",32),d(2,"translate"),s(),_(3,go,61,75,"mat-accordion",33)),i&2){h();let n=R(5);r(),c("innerHTML",u(2,2,"FACILITY_CONFIGURATION.SUMMARY_INFO"),Ae),r(2),c("ngIf",n.selectedIndex===n.steps.length-1)}}function vo(i,o){if(i&1){let n=b();l(0,"button",51),g("click",function(){S(n);let t=h();return y(t.back())}),f(1),d(2,"translate"),s()}i&2&&(r(),v(" ",u(2,1,"FACILITY_CONFIGURATION.BACK")," "))}function Io(i,o){if(i&1){let n=b();l(0,"button",52),g("click",function(){S(n);let t=h();return y(t.next())}),f(1),d(2,"translate"),s()}if(i&2){h();let n=R(5);k("me-2",n!==void 0&&n.selectedIndex!==0)("ms-auto",!(n!==void 0&&n.selectedIndex!==0)),r(),v(" ",u(2,5,"FACILITY_CONFIGURATION.NEXT")," ")}}function So(i,o){if(i&1){let n=b();l(0,"button",53),g("click",function(){S(n);let t=h();return y(t.onFinish())}),f(1),d(2,"translate"),s()}i&2&&(r(),v(" ",u(2,1,"FACILITY_CONFIGURATION.FINISH")," "))}var Sn=(()=>{let o=class o{constructor(e,t,a,p,C,O,X,q,ye,bn){this.attributesManager=e,this.serviceManager=t,this.facilityService=a,this.cd=p,this.dialog=C,this.notificator=O,this.translate=X,this.router=q,this.guiAuthResolver=ye,this.entityStorageService=bn,this.processing=!1,this.filteredAttributes=[],this.attSelection=new V(!0,[]),this.services=[],this.serviceIds=new Set,this.servicePackages=[],this.selectedPackages=[],this.selection=new V(!0,[]),this.owners=[],this.hosts=[],this.destinations=[],this.destinationServiceMissing=!1,this.availableRoles=[],this.filterValue="",this.ATTRIBUTES_IDX=3,this.serviceControl=new ae(!1,qe.requiredTrue),this.attributesControl=new ae(!0,qe.requiredTrue),this.allowNavigate=!1,this.attributes=[],this.attributeIds=new Set,this.attributesPerService=new Map,this.servicesPerPackage=new Map,this.saveMsg="",this.removeMsg="",this.BEFORE_OPTIONAL_IDX=2,this.DESTINATIONS_IDX=4,this.AFTER_OPTIONAL_IDX=5,this.translate.get("FACILITY_CONFIGURATION.ATT_SAVED").subscribe($e=>this.saveMsg=$e),this.translate.get("FACILITY_CONFIGURATION.ATT_REMOVED").subscribe($e=>this.removeMsg=$e)}ngOnInit(){this.facility=this.entityStorageService.getEntity(),this.guiAuthResolver.assignAvailableRoles(this.availableRoles,"Facility"),this.serviceManager.getServicesPackages().subscribe(e=>{this.servicePackages=e,this.getServicePackageServices(e,0)})}ngAfterViewInit(){this.cd.detectChanges(),this.attSelection.changed.subscribe(()=>{this.attributesControl.setValue(this.attSelection.selected.length===0)})}onCancel(){let e=D();e.width="550px",e.data={facilityId:this.facility.id,lastStep:this.stepper.selectedIndex===this.stepper.steps.length-1,theme:"facility-theme"},this.dialog.open(In,e).afterClosed().subscribe(a=>{a&&(this.allowNavigate=!0,sessionStorage.removeItem("newFacilityId"),this.router.navigate(["facilities"],{queryParamsHandling:"merge"}))})}packagesSelected(e){if(this.packageSelectionEqual(e))return;this.processing=!0;let t=new Set;if(!e||e.length===0?this.selectedPackages.forEach(C=>{this.servicesPerPackage.get(C.id).forEach(O=>t.add(O))}):t=this.setSymDif(this.selectedPackages,e),t.size===0)return;let a=this.filterService(t,e.filter(C=>this.selectedPackages.findIndex(O=>O.id===C.id)<0)),p=this.filterService(t,this.selectedPackages.filter(C=>e.findIndex(O=>O.id===C.id)<0));for(let C of this.services)a.has(C.id)?this.selection.select(C):p.has(C.id)&&this.selection.deselect(C);this.selectedPackages=e,this.setServiceControl(),this.processing=!1}singleServiceSelected(){this.setServiceControl(),!this.processing&&this.checkPackageComplete()}back(){this.stepper.selectedIndex<=this.BEFORE_OPTIONAL_IDX&&this.setServiceControl(),this.stepper.selectedIndex===this.AFTER_OPTIONAL_IDX&&this.selection.selected.length===0?this.stepper.selectedIndex=this.BEFORE_OPTIONAL_IDX:this.stepper.previous()}onSaveAttributes(){return new Promise((e,t)=>{this.processing=!0,this.attributesManager.setFacilityAttributes({facility:this.facility.id,attributes:this.attSelection.selected}).subscribe({next:()=>{this.notificator.showSuccess(this.saveMsg),this.attSelection.clear(),this.processing=!1,e()},error:()=>{this.processing=!1,t()}})})}next(){this.checkDestinationDependency(this.stepper.selectedIndex),this.stepper.selectedIndex===this.BEFORE_OPTIONAL_IDX?this.selection.selected.length===0?this.openSkipDialog():(this.getRequiredAttributes(),this.stepper.next()):this.stepper.selectedIndex===this.ATTRIBUTES_IDX?this.attSelection.selected.length!==0?this.openUnsavedAttsDialog():this.stepper.next():this.stepper.next()}onFinish(){this.allowNavigate=!0,sessionStorage.removeItem("newFacilityId"),this.router.navigate(["facilities",this.facility.id],{queryParamsHandling:"merge"})}onRemoveAttributes(){this.processing=!0;let e=this.attSelection.selected.map(t=>t.id);this.attributesManager.removeFacilityAttributes(this.facility.id,e).subscribe({next:()=>{this.notificator.showSuccess(this.removeMsg),this.getRequiredAttributes(),this.processing=!1},error:()=>this.processing=!1})}filterAttributes(e){if(e===void 0||e.length===0){this.filteredAttributes=this.attributes;return}let t=new Set;for(let a of e)this.attributesPerService.get(a.id).forEach(p=>t.add(p));this.filteredAttributes=[];for(let a of this.attributes)t.has(a.id)&&this.filteredAttributes.push(a)}getNonEmptyAttributes(){this.filteredAttributes=this.attributes.filter(e=>{if(e.value&&(!Array.isArray(e.value)||e.value.length!==0))return e})}navigationStep(e){this.checkDestinationDependency(e.previouslySelectedIndex),e.selectedIndex===this.ATTRIBUTES_IDX?this.getRequiredAttributes():e.selectedIndex===this.DESTINATIONS_IDX?this.processing=!1:e.selectedIndex<=this.BEFORE_OPTIONAL_IDX&&this.setServiceControl()}applyFilter(e){this.filterValue=e}canDeactivate(){return this.allowNavigate||this.onCancel(),this.allowNavigate}getServicePackageServices(e,t){t===e.length?this.serviceManager.getServices().subscribe(a=>{this.services=a}):this.serviceManager.getServicesFromServicesPackage(e[t].id).subscribe(a=>{this.servicesPerPackage.set(e[t].id,new Set([...a.map(p=>p.id)])),this.getServicePackageServices(e,t+1)})}getServiceRequiredAttributes(e,t){t!==e.length&&this.attributesManager.getRequiredAttributesDefinition(e[t].id).subscribe(a=>{a=a.filter(p=>this.attributeIds.has(p.id)),this.attributesPerService.set(e[t].id,a.map(p=>p.id)),this.getServiceRequiredAttributes(e,t+1)})}setServiceControl(){this.serviceControl.setValue(this.selection.selected.length!==0)}buildServiceSet(e){let t=new Set;return e.forEach(a=>{this.servicesPerPackage.get(a.id).forEach(p=>t.add(p))}),t}setDiff(e,t){return new Set([...e].filter(a=>!t.has(a)))}setIntersect(e,t){return new Set([...e].filter(a=>t.has(a)))}setSymDif(e,t){let a=this.buildServiceSet(e),p=this.buildServiceSet(t),C=this.setDiff(a,p),O=this.setDiff(p,a);return new Set([...C,...O])}filterService(e,t){let a=new Set;for(let p of t){let C=this.setIntersect(e,this.servicesPerPackage.get(p.id));C.size!==0&&C.forEach(O=>a.add(O))}return a}packageSelectionEqual(e){return e.length!==this.selectedPackages.length?!1:(e.forEach(t=>{if(this.selectedPackages.findIndex(a=>a.id===t.id)===-1)return!1}),!0)}checkPackageComplete(){let e=[];for(let t of this.selectedPackages){let a=!0;for(let p of this.servicesPerPackage.get(t.id))if(this.selection.selected.findIndex(C=>C.id===p)===-1){a=!1;break}a&&e.push(t)}this.selectedPackages=e}openSkipDialog(){let e=D();e.width="400px",e.data={theme:"facility-theme"},this.dialog.open(_n,e).afterClosed().subscribe(a=>{a&&(this.serviceControl.setValue(!0),this.stepper.selectedIndex=this.AFTER_OPTIONAL_IDX)})}getRequiredAttributes(){this.processing=!0,this.attributesManager.getRequiredAttributesFacilityServices(this.selection.selected.map(e=>e.id),this.facility.id).subscribe(e=>{this.attSelection.clear(),this.attributes=e.filter(t=>!wt(t)),this.filteredAttributes=this.attributes,this.attributes.forEach(t=>this.attributeIds.add(t.id)),this.getServiceRequiredAttributes(this.selection.selected,0),this.processing=!1})}openUnsavedAttsDialog(){let e=D();e.width="400px",e.data={theme:"facility-theme"},this.dialog.open(vn,e).afterClosed().subscribe(a=>{a&&this.onSaveAttributes().then(()=>{this.stepper.next()},()=>this.getRequiredAttributes())})}checkDestinationDependency(e){(e===this.BEFORE_OPTIONAL_IDX||e===this.DESTINATIONS_IDX)&&(this.serviceIds=new Set([...this.selection.selected.map(t=>t.id)]),this.destinationServicePresent())}destinationServicePresent(){for(let e of this.destinations)if(!this.serviceIds.has(e.service.id)){this.destinationServiceMissing=!0;return}this.destinationServiceMissing=!1}};o.\u0275fac=function(t){return new(t||o)(m(gt),m(te),m(F),m(nt),m(P),m(J),m(ne),m(fe),m(L),m(x))},o.\u0275cmp=E({type:o,selectors:[["app-facility-configuration-page"]],viewQuery:function(t,a){if(t&1&&ot(Ga,5),t&2){let p;rt(p=st())&&(a.stepper=p.first)}},decls:36,vars:15,consts:[[1,"facility-theme"],[1,"page-title"],[3,"linear","selectionChange"],["stepper",""],["spinner",""],["matStepLabel",""],["matStepContent",""],[3,"stepControl"],["optional","true",3,"editable","stepControl"],[3,"editable","optional"],[1,"actions"],["mat-stroked-button","",3,"click"],["class","ms-auto me-2","mat-stroked-button","",3,"click",4,"ngIf"],["color","accent","mat-flat-button","",3,"me-2","ms-auto","click",4,"ngIf"],["class","me-2","color","accent","mat-flat-button","",3,"click",4,"ngIf"],[3,"ownerEmitter"],[3,"disableRouting","hostEmitter"],[1,"page-subtitle"],["alert_type","info"],[1,"filters"],[1,"filter",3,"placeholder","filter"],[1,"package-search-select",3,"disableAutoSelect","selectedPackage","multiple","servicePackages","theme","packageSelected"],[3,"loading","disableRouting","displayedColumns","selection","filterValue","services","selectionChanged"],["color","warn","mat-flat-button","",1,"me-2",3,"disabled","click"],["color","accent","mat-flat-button","",1,"me-2",3,"disabled","click"],["class","service-search-select",3,"disableAutoSelect","services","multiple","theme","serviceSelected",4,"ngIf"],[1,"position-relative","table-min-height"],[3,"loading","emptyListText","attributes","selection",4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],[1,"service-search-select",3,"disableAutoSelect","services","multiple","theme","serviceSelected"],[3,"loading","emptyListText","attributes","selection"],[3,"configServicesIds","displayedColumns","configServices","loading","title","destinationEmitter"],[3,"disableRouting","disableSelf"],[3,"innerHTML"],[4,"ngIf"],[3,"disabled"],["svgIcon","perun-owner-grey",1,"me-2"],[3,"loading","displayedColumns","owners",4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],["svgIcon","perun-hosts",1,"me-2"],[3,"loading","disableRouting","displayedColumns","hosts",4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],["svgIcon","perun-service",1,"me-2"],[3,"loading","disableRouting","displayedColumns","services"],[3,"disabled","opened"],[3,"loading","displayedColumns","attributes","emptyListText"],[3,"expanded","disabled","expandedChange"],["svgIcon","perun-service_destination",1,"me-2"],[3,"loading","destinations","displayedColumns","services",4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],["svgIcon","perun-manager",1,"me-2"],[3,"complementaryObject","configMode","disableRouting","availableRoles","complementaryObjectType","displayedGroupColumns","displayedUserColumns"],[3,"loading","displayedColumns","owners"],[3,"loading","disableRouting","displayedColumns","hosts"],[3,"loading","destinations","displayedColumns","services"],["mat-stroked-button","",1,"ms-auto","me-2",3,"click"],["color","accent","mat-flat-button","",3,"click"],["color","accent","mat-flat-button","",1,"me-2",3,"click"]],template:function(t,a){if(t&1&&(l(0,"div",0)(1,"div",1),f(2),d(3,"translate"),s(),l(4,"mat-stepper",2,3),g("selectionChange",function(C){return a.navigationStep(C)}),_(6,Ua,1,0,"ng-template",null,4,B),l(8,"mat-step"),_(9,Ya,2,3,"ng-template",5)(10,ja,1,0,"ng-template",6),s(),l(11,"mat-step"),_(12,Wa,2,3,"ng-template",5)(13,Ha,1,1,"ng-template",6),s(),l(14,"mat-step",7),_(15,za,2,3,"ng-template",5)(16,Ka,10,19,"ng-template",6),s(),l(17,"mat-step",8),_(18,Xa,2,3,"ng-template",5)(19,Ja,16,17,"ng-template",6),s(),l(20,"mat-step",9),_(21,Za,2,3,"ng-template",5)(22,to,1,6,"ng-template",6),s(),l(23,"mat-step"),_(24,io,2,3,"ng-template",5)(25,no,1,2,"ng-template",6),s(),l(26,"mat-step"),_(27,ao,2,3,"ng-template",5)(28,_o,4,4,"ng-template",6),s()(),l(29,"div",10)(30,"button",11),g("click",function(){return a.onCancel()}),f(31),d(32,"translate"),s(),_(33,vo,3,3,"button",12)(34,Io,3,7,"button",13)(35,So,3,3,"button",14),s()()),t&2){let p=R(5);r(2),v(" ",u(3,11,"FACILITY_CONFIGURATION.TITLE")," "),r(2),c("linear",!0),r(10),c("stepControl",a.serviceControl),r(3),c("editable",a.selection.selected.length!==0)("stepControl",a.attributesControl),r(3),c("editable",a.selection.selected.length!==0||a.destinations.length!==0)("optional",a.destinations.length===0),r(11),v(" ",u(32,13,"FACILITY_CONFIGURATION.CANCEL")," "),r(2),c("ngIf",p!==void 0&&p.selectedIndex!==0),r(),c("ngIf",p!==void 0&&p.selectedIndex!==p.steps.length-1),r(),c("ngIf",p!==void 0&&p.selectedIndex===p.steps.length-1)}},dependencies:[w,oe,N,Xt,$t,qt,Kt,zt,jt,Wt,Ht,Ve,Pe,Ge,Di,we,U,mi,Y,Me,fi,hi,G,je,We,He,ze,A],styles:[".icon-scale[_ngcontent-%COMP%]{transform:scale(1.7);margin-left:.5rem;margin-top:-.6rem;margin-right:.9rem}.filters[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;align-items:baseline}.package-search-select[_ngcontent-%COMP%]{width:650px}.service-search-select[_ngcontent-%COMP%]{width:400px}.filter[_ngcontent-%COMP%]{width:350px;margin-right:20px}.actions[_ngcontent-%COMP%]{background-color:#fff;display:flex;padding:20px}.cursor-default[_ngcontent-%COMP%]{cursor:default}"]});let i=o;return i})();var Ze=(()=>{let o=class o{constructor(e){this.router=e}canActivate(e){return e.parent.params.facilityId===sessionStorage.getItem("newFacilityId")?!0:(this.router.navigate(["/home"],{queryParamsHandling:"merge"}),!1)}canDeactivate(e){return e.canDeactivate()}};o.\u0275fac=function(t){return new(t||o)(it(fe))},o.\u0275prov=tt({token:o,factory:o.\u0275fac,providedIn:"root"});let i=o;return i})();function yo(i,o){if(i&1){let n=b();l(0,"button",8),g("click",function(){S(n);let t=h();return y(t.add())}),f(1),d(2,"translate"),s()}i&2&&(r(),v(" ",u(2,1,"FACILITY_DETAIL.SETTINGS.BANS.ADD"),`
`))}function Co(i,o){if(i&1){let n=b();l(0,"button",9),g("click",function(){S(n);let t=h();return y(t.remove())}),f(1),d(2,"translate"),s()}if(i&2){let n=h();c("disabled",n.selection.selected.length===0),r(),v(" ",u(2,2,"FACILITY_DETAIL.SETTINGS.BANS.REMOVE"),`
`)}}function bo(i,o){if(i&1){let n=b();l(0,"perun-web-apps-ban-on-entity-list",10),g("updateBan",function(t){S(n);let a=h();return y(a.update(t))}),s()}if(i&2){let n=h();c("loading",n.loading)("bans",n.bans)("selection",n.selection)("displayedColumns",n.displayedColumns)("filter",n.filter)("updatePolicy","updateBan_BanOnFacility_policy")}}function To(i,o){i&1&&I(0,"perun-web-apps-loading-table")}var yn=(()=>{let o=class o{constructor(e,t,a,p,C,O,X){this.facilityService=e,this.entityService=t,this.authResolver=a,this.dialog=p,this.notificator=C,this.store=O,this.userName=X,this.loading=!1,this.bans=[],this.removeAuth=!1,this.filter="",this.selection=new V(!1,[]),this.attrNames=[Qe.MEMBER_DEF_MAIL,Qe.USER_DEF_PREFERRED_MAIL].concat(this.store.getLoginAttributeNames()),this.displayedColumns=["select","banId","subjectId","subjectName","description","expiration","edit"]}ngOnInit(){this.loading=!0,this.facility=this.entityService.getEntity(),this.addAuth=this.authResolver.isAuthorized("setBan_BanOnFacility_policy",[this.facility]),this.removeAuth=this.authResolver.isAuthorized("removeBan_int_policy",[this.facility]),this.refresh()}refresh(){this.loading=!0,this.facilityService.getEnrichedBansForFacility(this.facility.id,this.attrNames).subscribe({next:e=>{this.bans=e,this.selection.clear(),this.loading=!1},error:()=>this.loading=!1})}add(){let e=D();e.width="850px",e.data={entityId:this.facility.id,theme:"facility-theme",bans:this.bans.map(a=>a.ban)},this.dialog.open(Ki,e).afterClosed().subscribe(a=>{a&&this.refresh()})}remove(){let e=D();e.width="550px",e.data={theme:"facility-theme",title:"DIALOGS.REMOVE_BAN.TITLE",description:"DIALOGS.REMOVE_BAN.DESCRIPTION",items:[this.userName.transform(this.selection.selected[0].user)],type:"remove",showAsk:!0},this.dialog.open(ci,e).afterClosed().subscribe(a=>{a&&(this.loading=!0,this.facilityService.removeFacilityBanById(this.selection.selected[0].ban.id).subscribe(()=>{this.notificator.showSuccess("DIALOGS.REMOVE_BAN.SUCCESS"),this.refresh()}))})}update(e){let t=D();t.width="600px",t.data={ban:e.ban,theme:"facility-theme"},this.dialog.open(Xi,t).afterClosed().subscribe(p=>{p&&this.refresh()})}};o.\u0275fac=function(t){return new(t||o)(m(F),m(x),m(L),m(P),m(J),m(St),m(Z))},o.\u0275cmp=E({type:o,selectors:[["app-facility-settings-bans"]],features:[ct([Z])],decls:11,vars:8,consts:[[1,"page-subtitle"],[3,"click"],["class","me-2 action-button","color","accent","mat-flat-button","",3,"click",4,"ngIf"],["color","warn","class","me-2","mat-flat-button","",3,"disabled","click",4,"ngIf"],[1,"mt-2","search-field",3,"placeholder","filter"],[1,"position-relative","table-min-height"],[3,"loading","bans","selection","displayedColumns","filter","updatePolicy","updateBan",4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],["spinner",""],["color","accent","mat-flat-button","",1,"me-2","action-button",3,"click"],["color","warn","mat-flat-button","",1,"me-2",3,"disabled","click"],[3,"loading","bans","selection","displayedColumns","filter","updatePolicy","updateBan"]],template:function(t,a){if(t&1&&(l(0,"h1",0),f(1),d(2,"translate"),s(),l(3,"perun-web-apps-refresh-button",1),g("click",function(){return a.refresh()}),s(),_(4,yo,3,3,"button",2)(5,Co,3,4,"button",3),l(6,"perun-web-apps-debounce-filter",4),g("filter",function(C){return a.filter=C}),s(),l(7,"div",5),_(8,bo,1,6,"perun-web-apps-ban-on-entity-list",6),s(),_(9,To,1,0,"ng-template",null,7,B)),t&2){let p=R(10);r(),v(" ",u(2,6,"FACILITY_DETAIL.SETTINGS.BANS.TITLE"),`
`),r(3),c("ngIf",a.addAuth),r(),c("ngIf",a.removeAuth),r(),c("placeholder","FACILITY_DETAIL.SETTINGS.BANS.FILTER"),r(2),c("perunWebAppsLoader",a.loading)("perunWebAppsLoaderIndicator",p)}},dependencies:[w,N,U,j,Y,gi,G,A]});let i=o;return i})();var Eo=[{path:"",component:Zi,canActivate:[Be]},{path:":facilityId",component:rn,canActivateChild:[Be],children:[{path:"",component:sn,data:{animation:"FacilityOverviewPage"}},{path:"attributes",component:pn,data:{animation:"FacilityAttributesPage"}},{path:"resources",component:en,data:{animation:"FacilityResourcesPage"}},{path:"allowed-users",component:nn,data:{animation:"FacilityAllowedUsersPage"}},{path:"allowed-groups",component:tn,data:{animation:"FacilityAllowedGroupsPage"}},{path:"services-status",component:hn,data:{animation:"FacilityServiceStatusPage"}},{path:"services-status/:taskId",component:gn,data:{animation:"FacilityTaskResultsPage"}},{path:"service-config",component:mn,data:{animation:"FacilityServiceConfigPage"}},{path:"services-destinations",component:We,data:{animation:"FacilityServicesDestinationsPage"}},{path:"hosts",component:ze,data:{animation:"FacilityHostsPage"}},{path:"hosts/:hostId",component:un,data:{animation:"FacilityHostsDetailPage"}},{path:"settings",component:ln,children:[{path:"",component:cn,data:{animation:"FacilitySettingsOverviewPage"}},{path:"owners",component:He,data:{animation:"FacilitySettingOwnersPage"}},{path:"managers",component:je,data:{animation:"FacilitySettingsManagersPage"}},{path:"security-teams",component:fn,data:{animation:"FacilitySecurityTeamsPage"}},{path:"blacklist",component:dn,data:{animation:"FacilitySettingsBlackListPage"}},{path:"bans",component:yn,data:{animation:"FacilitySettingsBansPage"}}]},{path:"configuration",component:Sn,canActivate:[Ze],canDeactivate:[Ze]}]},{path:":facilityId/resources/:resourceId",component:Ei,canActivateChild:[Be],children:[{path:"",component:Ai,data:{animation:"ResourceOverviewPage"}},{path:"attributes",component:wi,data:{animation:"ResourceAttributesPage"}},{path:"groups",component:Fi,data:{animation:"ResourceGroupsComponent"}},{path:"services",component:Mi,data:{animation:"ResourceAssignedServicesComponent"}},{path:"members",component:Oi,data:{animation:"ResourceAssignedMembersComponent"}},{path:"tags",component:Ni,data:{animation:"ResourceTagsComponent"}},{path:"settings",component:xi,children:[{path:"",component:Ri,data:{animation:"ResourceSettingsOverviewPage"}},{path:"managers",component:Li,data:{animation:"ResourceSettingsManagersPage"}},{path:"bans",component:ki,data:{animation:"ResourceSettingsBansPage"}}]}]}],Cn=(()=>{let o=class o{};o.\u0275fac=function(t){return new(t||o)},o.\u0275mod=Ee({type:o}),o.\u0275inj=Te({imports:[Xe.forChild(Eo),Xe]});let i=o;return i})();var Mm=(()=>{let o=class o{};o.\u0275fac=function(t){return new(t||o)},o.\u0275mod=Ee({type:o}),o.\u0275inj=Te({providers:[Z],imports:[ft,Cn,qi,ti,ri,vi,oi,Qi,Ji]});let i=o;return i})();export{Mm as FacilitiesModule};
