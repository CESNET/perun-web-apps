import{a as H,b as _t}from"./chunk-NMYZ7ZF4.js";import{$b as Ae,Ac as ye,Bd as We,Bf as ot,Ca as x,Cc as we,Da as C,Dc as y,Dd as je,Ea as l,Ec as w,G as fe,Gh as ct,H as Ce,K as ge,La as B,Ma as Y,Mh as pt,Na as Z,Oa as d,Od as Ge,Pa as E,Pd as W,Qa as S,Qe as Ke,Qf as j,Rb as ve,Rd as He,Re as Qe,S as h,Sb as k,Se as et,T as f,Tb as xe,Tc as Ve,Td as qe,Te as tt,Th as dt,Ua as N,Uc as Le,Ue as it,V as L,Va as O,Wa as P,Xb as q,Xc as Be,Xh as ae,Ya as Ee,Zb as Ie,Zc as Ne,Zg as G,_a as R,_e as pe,_g as st,_h as mt,aa as r,cd as K,d as V,db as c,dd as Q,eb as p,fc as Te,fd as Oe,fe as ze,ga as m,gd as Pe,ge as Xe,ha as D,he as te,ie,jb as F,jc as De,je as ne,k as _e,kb as Se,kc as Me,ke as Ye,ld as ee,le as Ze,ma as A,mc as $,md as Fe,me as $e,nc as J,ne as Je,nf as z,oc as Re,qb as be,qi as oe,r as he,ra as b,sa as v,sf as nt,sh as lt,tf as rt,ub as M,ud as ke,uf as at,vd as Ue,wa as u,wi as ut,xa as o,xh as re,ya as s,yd as U,za as I}from"./chunk-Q6VFHOR5.js";function Et(t,_){t&1&&I(0,"perun-web-apps-loading-table")}function St(t,_){if(t&1){let e=x();o(0,"perun-web-apps-users-list",7),c(1,"async"),c(2,"async"),C("queryChanged",function(i){h(e);let a=l();return f(a.nextPage.next(i))})("downloadAll",function(i){h(e);let a=l();return f(a.downloadAll(i))}),s()}if(t&2){let e=l();u("loading",p(1,6,e.loading$))("users",p(2,8,e.usersPage$))("routeToAdmin",!0)("displayColumns",e.displayedColumns)("filter",e.searchString)("resetPagination",e.resetPagination)}}var vi=(()=>{class t{static{this.id="AdminUsersComponent"}constructor(e,n,i,a,g,T,ce){this.storeService=e,this.cd=n,this.dialog=i,this.cacheHelperService=a,this.userManager=g,this.destroyRef=T,this.notificator=ce,this.usersWithoutVo=!1,this.attributes=[],this.displayedColumns=["user","id","name","email","logins","organization"],this.nextPage=new V({}),this.usersPage$=this.nextPage.pipe(Ce(X=>this.userManager.getUsersPage({attrNames:this.attributes,query:{order:X.order,pageSize:X.pageSize,offset:X.offset,sortColumn:X.sortColumn,searchString:this.searchString,withoutVo:this.usersWithoutVo}})),ge(()=>{setTimeout(()=>this.loadingSubject$.next(!1),200)}),fe({data:[],totalCount:0,offset:0,pageSize:0})),this.loadingSubject$=new V(!1),this.resetPagination=new V(!1),this.loading$=he(this.loadingSubject$,this.nextPage.pipe(_e(()=>!0)))}ngOnInit(){this.attributes=[pe.USER_DEF_ORGANIZATION,pe.USER_DEF_PREFERRED_MAIL],this.attributes=this.attributes.concat(this.storeService.getLoginAttributeNames()),this.cacheHelperService.refreshComponentCachedData().pipe(G(this.destroyRef)).subscribe(e=>{e===t.id&&this.refresh()})}filterSearchString(e){this.searchString=e,this.cd.detectChanges()}filterUserWithoutVO(){this.usersWithoutVo=!this.usersWithoutVo,this.refresh()}refresh(){this.resetPagination.next(!0),this.nextPage.next(this.nextPage.value)}downloadAll(e){let n=this.nextPage.getValue(),i=z();i.width="500px";let a=this.dialog.open(st,i),g=this.userManager.getUsersPage({attrNames:this.attributes,query:{order:n.order,pageSize:e.length,offset:0,sortColumn:n.sortColumn,searchString:n.searchString,withoutVo:this.usersWithoutVo}}).subscribe({next:T=>{a.close(),rt(nt(T.data,this.displayedColumns,e.getDataForColumnFun),e.format)},error:T=>{this.notificator.showRPCError(T),a.close()}});a.afterClosed().subscribe(()=>{g&&g.unsubscribe()})}static{this.\u0275fac=function(n){return new(n||t)(m(ze),m(Se),m(ne),m(H),m(He),m(L),m(j))}}static{this.\u0275cmp=D({type:t,selectors:[["app-admin-users"]],hostVars:2,hostBindings:function(n,i){n&2&&Y("router-component",i.true)},decls:13,vars:14,consts:[["spinner",""],[1,"page-subtitle"],[3,"click"],[1,"mt-2","search-field",3,"filter","autoFocus","placeholder","linkGlobalSearch"],["color","primary",3,"change","checked"],[1,"position-relative","table-min-height"],[3,"loading","users","routeToAdmin","displayColumns","filter","resetPagination","queryChanged","downloadAll",4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],[3,"queryChanged","downloadAll","loading","users","routeToAdmin","displayColumns","filter","resetPagination"]],template:function(n,i){if(n&1){let a=x();o(0,"h1",1),d(1),c(2,"translate"),s(),o(3,"perun-web-apps-refresh-button",2),C("click",function(){return h(a),f(i.refresh())}),s(),o(4,"perun-web-apps-debounce-filter",3),C("filter",function(T){return h(a),f(i.filterSearchString(T))}),s(),o(5,"mat-checkbox",4),C("change",function(){return h(a),f(i.filterUserWithoutVO())}),d(6),c(7,"translate"),s(),A(8,Et,1,0,"ng-template",null,0,F),o(10,"div",5),A(11,St,3,10,"perun-web-apps-users-list",6),c(12,"async"),s()}if(n&2){let a=B(9);r(),E(p(2,8,"ADMIN.USERS.TITLE")),r(3),u("autoFocus",!0)("placeholder","ADMIN.USERS.SEARCH_PLACEHOLDER")("linkGlobalSearch",!0),r(),u("checked",i.usersWithoutVo),r(),S(" ",p(7,10,"ADMIN.USERS.USERS_WITHOUT_VO"),`
`),r(5),u("perunWebAppsLoader",p(12,12,i.loading$))("perunWebAppsLoaderIndicator",a)}},dependencies:[M,J,$,ae,re,w,oe,U,ee,be,y],styles:[".search-field[_ngcontent-%COMP%]{width:325px}"]})}}return t})();function vt(t,_){t&1&&I(0,"perun-web-apps-loading-dialog")}function xt(t,_){t&1&&(o(0,"mat-error"),d(1),c(2,"translate"),s()),t&2&&(r(),S(" ",p(2,1,"DIALOGS.NAME_SPACE_ERROR")," "))}function It(t,_){t&1&&(o(0,"mat-error"),d(1),c(2,"translate"),s()),t&2&&(r(),E(p(2,1,"DIALOGS.CREATE_EDIT_SERVICE.RESTRICTION_NAME")))}function At(t,_){if(t&1){let e=x();o(0,"div")(1,"h1",2),d(2),s(),o(3,"div",3)(4,"mat-form-field")(5,"mat-label"),d(6),c(7,"translate"),s(),o(8,"input",4),C("change",function(){h(e);let i=l();return f(i.makePath())}),s(),b(9,xt,3,3,"mat-error"),b(10,It,3,3,"mat-error"),s(),o(11,"mat-form-field")(12,"mat-label"),d(13),c(14,"translate"),s(),o(15,"input",5),P("ngModelChange",function(i){h(e);let a=l();return O(a.description,i)||(a.description=i),f(i)}),s()(),o(16,"mat-form-field")(17,"mat-label"),d(18),c(19,"translate"),s(),I(20,"input",6),o(21,"mat-error"),d(22),c(23,"translate"),s()(),o(24,"mat-form-field")(25,"mat-label"),d(26),c(27,"translate"),s(),I(28,"input",6),o(29,"mat-error"),d(30),c(31,"translate"),s()(),o(32,"mat-form-field")(33,"mat-label"),d(34),c(35,"translate"),s(),I(36,"input",6),o(37,"mat-error"),d(38),c(39,"translate"),s()(),o(40,"div"),d(41),c(42,"translate"),o(43,"mat-checkbox",7),P("ngModelChange",function(i){h(e);let a=l();return O(a.status,i)||(a.status=i),f(i)}),d(44),c(45,"translate"),s()(),o(46,"span",8),d(47),c(48,"translate"),o(49,"mat-checkbox",7),P("ngModelChange",function(i){h(e);let a=l();return O(a.propagateExpiredMembers,i)||(a.propagateExpiredMembers=i),f(i)}),d(50),c(51,"translate"),s()(),o(52,"span",8),d(53),c(54,"translate"),o(55,"mat-checkbox",7),P("ngModelChange",function(i){h(e);let a=l();return O(a.propagateExpiredVoMembers,i)||(a.propagateExpiredVoMembers=i),f(i)}),d(56),c(57,"translate"),s()(),o(58,"span",8),d(59),c(60,"translate"),o(61,"mat-checkbox",7),P("ngModelChange",function(i){h(e);let a=l();return O(a.propagateBannedMembers,i)||(a.propagateBannedMembers=i),f(i)}),d(62),c(63,"translate"),s()()(),o(64,"div",9)(65,"button",10),C("click",function(){h(e);let i=l();return f(i.onCancel())}),d(66),c(67,"translate"),s(),o(68,"button",11),C("click",function(){h(e);let i=l();return f(i.asEdit?i.onEdit():i.onCreate())}),d(69),s()()()}if(t&2){let e=l();r(2),E(e.title),r(4),E(p(7,31,"DIALOGS.CREATE_EDIT_SERVICE.NAME")),r(2),u("formControl",e.nameControl),r(),v(e.nameControl.errors!=null&&e.nameControl.errors.spaceName?9:-1),r(),v(e.nameControl.errors!=null&&e.nameControl.errors.spaceName?-1:10),r(3),E(p(14,33,"DIALOGS.CREATE_EDIT_SERVICE.DESCRIPTION")),r(2),N("ngModel",e.description),r(3),E(p(19,35,"DIALOGS.CREATE_EDIT_SERVICE.DELAY")),r(2),u("formControl",e.delayControl),r(2),E(p(23,37,"DIALOGS.CREATE_EDIT_SERVICE.INVALID_DELAY")),r(4),E(p(27,39,"DIALOGS.CREATE_EDIT_SERVICE.RECURRENCE")),r(2),u("formControl",e.recurrenceControl),r(2),E(p(31,41,"DIALOGS.CREATE_EDIT_SERVICE.INVALID_RECURRENCE")),r(4),E(p(35,43,"DIALOGS.CREATE_EDIT_SERVICE.PATH")),r(2),u("formControl",e.pathControl),r(2),E(p(39,45,"DIALOGS.CREATE_EDIT_SERVICE.REQUIRE_PATH")),r(3),S(" ",p(42,47,"DIALOGS.CREATE_EDIT_SERVICE.STATUS")," "),r(2),N("ngModel",e.status),r(),E(p(45,49,"DIALOGS.CREATE_EDIT_SERVICE.STATUS_HINT")),r(3),S("",p(48,51,"DIALOGS.CREATE_EDIT_SERVICE.EXPIRED_MEMBERS")," "),r(2),N("ngModel",e.propagateExpiredMembers),r(),E(p(51,53,"DIALOGS.CREATE_EDIT_SERVICE.EXPIRED_MEMBERS_HINT")),r(3),S("",p(54,55,"DIALOGS.CREATE_EDIT_SERVICE.EXPIRED_MEMBERS_VO")," "),r(2),N("ngModel",e.propagateExpiredVoMembers),r(),E(p(57,57,"DIALOGS.CREATE_EDIT_SERVICE.EXPIRED_MEMBERS_VO_HINT")),r(3),S("",p(60,59,"DIALOGS.CREATE_EDIT_SERVICE.BANNED_MEMBERS")," "),r(2),N("ngModel",e.propagateBannedMembers),r(),E(p(63,61,"DIALOGS.CREATE_EDIT_SERVICE.BANNED_MEMBERS_HINT")),r(4),S(" ",p(67,63,"DIALOGS.CREATE_EDIT_SERVICE.CANCEL")," "),r(2),u("disabled",e.nameControl.invalid||e.delayControl.invalid||e.recurrenceControl.invalid||e.pathControl.invalid||e.loading),r(),S(" ",e.buttonText," ")}}var ft=(()=>{class t{constructor(e,n,i,a,g){this.dialogRef=e,this.data=n,this.serviceManager=i,this.notificator=a,this.translate=g,this.loading=!1,this.status=!0,this.propagateExpiredMembers=!0,this.propagateExpiredVoMembers=!1,this.propagateBannedMembers=!0,this.nameControl=new q("",[k.required,k.pattern("^[a-zA-Z0-9_]+$"),ot()]),this.delayControl=new q(10,[k.pattern("^[0-9]*$")]),this.recurrenceControl=new q(2,[k.pattern("^[0-9]*$")]),this.pathControl=new q("",[k.required]),this.asEdit=!1}ngOnInit(){this.theme=this.data.theme,this.asEdit=this.data.service!==void 0,this.asEdit?(this.nameControl.setValue(this.data.service.name),this.description=this.data.service.description,this.delayControl.setValue(this.data.service.delay),this.recurrenceControl.setValue(this.data.service.recurrence),this.pathControl.setValue(this.data.service.script),this.status=this.data.service.enabled,this.propagateExpiredMembers=this.data.service.useExpiredMembers,this.propagateExpiredVoMembers=this.data.service.useExpiredVoMembers,this.propagateBannedMembers=this.data.service.useBannedMembers,this.title=this.translate.instant("DIALOGS.CREATE_EDIT_SERVICE.EDIT_TITLE"),this.buttonText=this.translate.instant("DIALOGS.CREATE_EDIT_SERVICE.EDIT")):(this.title=this.translate.instant("DIALOGS.CREATE_EDIT_SERVICE.CREATE_TITLE"),this.buttonText=this.translate.instant("DIALOGS.CREATE_EDIT_SERVICE.CREATE"))}onCreate(){this.loading=!0,this.serviceManager.createServiceWithService({service:{name:this.nameControl.value,description:this.description,delay:this.delayControl.value,recurrence:this.recurrenceControl.value,enabled:this.status,script:this.pathControl.value,useExpiredMembers:this.propagateExpiredMembers,useExpiredVoMembers:this.propagateExpiredVoMembers,useBannedMembers:this.propagateBannedMembers,id:0,beanName:""}}).subscribe({next:()=>{this.notificator.showSuccess(this.translate.instant("DIALOGS.CREATE_EDIT_SERVICE.CREATE_SUCCESS")),this.dialogRef.close(!0),this.loading=!1},error:()=>this.loading=!1})}onEdit(){this.loading=!0,this.serviceManager.updateService({service:{name:this.nameControl.value,description:this.description,delay:this.delayControl.value,recurrence:this.recurrenceControl.value,enabled:this.status,script:this.pathControl.value,useExpiredMembers:this.propagateExpiredMembers,useExpiredVoMembers:this.propagateExpiredVoMembers,useBannedMembers:this.propagateBannedMembers,id:this.data.service.id,beanName:this.data.service.beanName}}).subscribe({next:()=>{this.notificator.showSuccess(this.translate.instant("DIALOGS.CREATE_EDIT_SERVICE.EDIT_SUCCESS")),this.dialogRef.close(!0),this.loading=!1},error:()=>this.loading=!1})}onCancel(){this.dialogRef.close(!1)}makePath(){let e="./".concat(this.nameControl.value);this.pathControl.setValue(e)}static{this.\u0275fac=function(n){return new(n||t)(m(te),m(ie),m(W),m(j),m(we))}}static{this.\u0275cmp=D({type:t,selectors:[["app-create-service-dialog"]],decls:4,vars:5,consts:[["spinner",""],[4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],["mat-dialog-title",""],["mat-dialog-content","",1,"dialog-container"],["matInput","","data-cy","service-name-input","required","",3,"change","formControl"],["matInput","","data-cy","service-description-input",3,"ngModelChange","ngModel"],["matInput","","required","",3,"formControl"],[1,"ms-3",3,"ngModelChange","ngModel"],[1,"d-flex","align-elements"],["mat-dialog-actions",""],["mat-stroked-button","",1,"ms-auto",3,"click"],["color","accent","data-cy","service-create-edit-dialog-button","mat-flat-button","",1,"ms-2",3,"click","disabled"]],template:function(n,i){if(n&1&&(A(0,vt,1,0,"ng-template",null,0,F),o(2,"div"),A(3,At,70,65,"div",1),s()),n&2){let a=B(1);r(2),Z(Ee("",i.theme," position-relative")),r(),u("perunWebAppsLoader",i.loading)("perunWebAppsLoaderIndicator",a)}},dependencies:[M,Q,K,Ne,Be,Ve,Le,Ue,ke,J,$,Me,ve,xe,Te,Ae,De,Ie,Je,Ye,$e,Ze,Fe,w,U,y],encapsulation:2})}}return t})();var Ct=(()=>{class t{constructor(e,n,i,a,g){this.dialogRef=e,this.data=n,this.serviceManager=i,this.notificator=a,this.translate=g,this.dataSource=new ye(this.data.services),this.loading=!1,this.relations=[],this.force=!1}ngOnInit(){this.theme=this.data.theme,this.services=this.data.services,this.relations.push(this.translate.instant("DIALOGS.DELETE_SERVICE.DESTINATION_RELATION")),this.anotherMessage=this.translate.instant("DIALOGS.DELETE_SERVICE.MORE_INFORMATION")}onConfirm(){this.loading=!0;let e=this.services.map(n=>n.id);this.serviceManager.deleteServices(e,this.force).subscribe({next:()=>{this.dialogRef.close(!0),this.notificator.showSuccess(this.translate.instant("DIALOGS.DELETE_SERVICE.SUCCESS")),this.loading=!1},error:()=>this.loading=!1})}onCancel(){this.dialogRef.close(!1)}onSubmit(e){this.force=e.force,e.deleted?this.onConfirm():this.onCancel()}static{this.\u0275fac=function(n){return new(n||t)(m(te),m(ie),m(W),m(j),m(We))}}static{this.\u0275cmp=D({type:t,selectors:[["app-delete-service-dialog"]],decls:2,vars:7,consts:[[3,"deleted","entityNames","entityType","anotherMessage","loading","relations"]],template:function(n,i){n&1&&(o(0,"div")(1,"perun-web-apps-delete-entity-dialog",0),C("deleted",function(g){return i.onSubmit(g)}),s()()),n&2&&(Z(i.theme),r(),u("entityNames",i.dataSource)("entityType","services")("anotherMessage",i.anotherMessage)("loading",i.loading)("relations",i.relations))},dependencies:[M,lt],encapsulation:2})}}return t})();function Tt(t,_){if(t&1){let e=x();o(0,"button",8),C("click",function(){h(e);let i=l();return f(i.createService())}),d(1),c(2,"translate"),s()}t&2&&(r(),S(" ",p(2,1,"ADMIN.SERVICES.CREATE")," "))}function Dt(t,_){if(t&1){let e=x();o(0,"button",9),C("click",function(){h(e);let i=l();return f(i.deleteService())}),d(1),c(2,"translate"),s()}if(t&2){let e=l();u("disabled",e.loading||e.selection.selected.length===0),r(),S(" ",p(2,2,"ADMIN.SERVICES.DELETE")," ")}}function Mt(t,_){t&1&&I(0,"perun-web-apps-loading-table")}function Rt(t,_){if(t&1&&I(0,"app-services-list",10),t&2){let e=l();u("loading",e.loading)("filterValue",e.filterValue)("selection",e.selection)("cachedSubject",e.cachedSubject)("services",e.services)}}var vn=(()=>{class t{static{this.id="AdminServicesComponent"}constructor(e,n,i,a,g){this.serviceManager=e,this.dialog=n,this.authResolver=i,this.cacheHelperService=a,this.destroyRef=g,this.selection=new Re(!0,[],!0,(T,ce)=>T.id===ce.id),this.cachedSubject=new V(!0),this.loading=!1,this.filterValue=""}ngOnInit(){this.refreshTable(),this.cacheHelperService.refreshComponentCachedData().pipe(G(this.destroyRef)).subscribe(e=>{e===t.id&&this.refreshTable()})}createService(){let e=z();e.width="600px",e.data={theme:"admin-theme"},this.dialog.open(ft,e).afterClosed().subscribe(i=>{i&&this.refreshTable()})}deleteService(){let e=z();e.width="600px",e.data={theme:"admin-theme",services:this.selection.selected},this.dialog.open(Ct,e).afterClosed().subscribe(i=>{i&&this.refreshTable()})}refreshTable(){this.loading=!0,this.serviceManager.getServices().subscribe(e=>{this.services=e,this.selection.clear(),this.cachedSubject.next(!0),this.loading=!1})}applyFilter(e){this.filterValue=e,this.refreshTable()}static{this.\u0275fac=function(n){return new(n||t)(m(W),m(ne),m(Xe),m(H),m(L))}}static{this.\u0275cmp=D({type:t,selectors:[["app-admin-services"]],decls:12,vars:8,consts:[["spinner",""],[1,"page-subtitle"],[3,"refresh"],["color","accent","data-cy","service-create-button","mat-flat-button","",1,"action-button","me-2"],["color","warn","data-cy","service-delete-button","mat-flat-button","",1,"me-2",3,"disabled"],[3,"filter","placeholder"],[1,"position-relative","table-min-height"],[3,"loading","filterValue","selection","cachedSubject","services",4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],["color","accent","data-cy","service-create-button","mat-flat-button","",1,"action-button","me-2",3,"click"],["color","warn","data-cy","service-delete-button","mat-flat-button","",1,"me-2",3,"click","disabled"],[3,"loading","filterValue","selection","cachedSubject","services"]],template:function(n,i){if(n&1){let a=x();o(0,"div")(1,"h1",1),d(2),c(3,"translate"),s(),o(4,"perun-web-apps-refresh-button",2),C("refresh",function(){return h(a),f(i.refreshTable())}),s(),b(5,Tt,3,3,"button",3),b(6,Dt,3,4,"button",4),o(7,"perun-web-apps-debounce-filter",5),C("filter",function(T){return h(a),f(i.applyFilter(T))}),s(),A(8,Mt,1,0,"ng-template",null,0,F),o(10,"div",6),A(11,Rt,1,5,"app-services-list",7),s()()}if(n&2){let a=B(9);r(2),E(p(3,6,"ADMIN.SERVICES.TITLE")),r(3),v(i.authResolver.isPerunAdmin()?5:-1),r(),v(i.authResolver.isPerunAdmin()?6:-1),r(),u("placeholder","ADMIN.SERVICES.FILTER"),r(4),u("perunWebAppsLoader",i.loading)("perunWebAppsLoaderIndicator",a)}},dependencies:[M,Q,K,ae,re,w,_t,U,ee,y],encapsulation:2})}}return t})();var yt=()=>["user"],wt=()=>["user","id","name"],Vt=()=>["user","member"],Lt=()=>["id","voId","userId","status"],Bt=()=>["facility"],Nt=()=>["id","name","description"],Ot=()=>["resource"],Pt=()=>["id","name","description","voId","facilityId"];function Ft(t,_){t&1&&(d(0),c(1,"translate")),t&2&&S(" ",p(1,1,"ADMIN.SEARCHER.TAB_USERS")," ")}function kt(t,_){if(t&1){let e=x();o(0,"perun-web-apps-attribute-search-select",8),C("search",function(i){h(e);let a=l(2);return f(a.getUsers(i))}),s()}if(t&2){let e=l(2);u("attributes",e.allAttrDefinitions)("attributesForEntity",R(2,yt))}}function Ut(t,_){if(t&1&&I(0,"perun-web-apps-users-list",7),t&2){let e=l(2);u("loading",e.loading)("routeToAdmin",!0)("displayColumns",R(4,wt))("users",e.entities)}}function Wt(t,_){if(t&1&&(b(0,kt,1,3,"perun-web-apps-attribute-search-select",6),b(1,Ut,1,5,"perun-web-apps-users-list",7)),t&2){let e=l();v(e.loading?-1:0),r(),v(e.loadingEntityData?-1:1)}}function jt(t,_){t&1&&(d(0),c(1,"translate")),t&2&&S(" ",p(1,1,"ADMIN.SEARCHER.TAB_MEMBERS")," ")}function Gt(t,_){if(t&1){let e=x();o(0,"perun-web-apps-vo-search-select",12),C("voSelected",function(i){h(e);let a=l(2);return f(a.voSelected(i))}),s()}if(t&2){let e=l(2);u("vos",e.vos)}}function Ht(t,_){if(t&1){let e=x();o(0,"perun-web-apps-attribute-search-select",8),C("search",function(i){h(e);let a=l(2);return f(a.getMembers(i))}),s()}if(t&2){let e=l(2);u("attributes",e.allAttrDefinitions)("attributesForEntity",R(2,Vt))}}function qt(t,_){if(t&1){let e=x();o(0,"perun-web-apps-members-list",13),C("refreshTable",function(){h(e);let i=l(2);return f(i.getMembers(i.searchInput))}),s()}if(t&2){let e=l(2);u("loading",e.loading)("displayedColumns",R(3,Lt))("members",e.entities)}}function zt(t,_){if(t&1&&(o(0,"div",9),b(1,Gt,1,1,"perun-web-apps-vo-search-select",10),s(),b(2,Ht,1,3,"perun-web-apps-attribute-search-select",6),b(3,qt,1,4,"perun-web-apps-members-list",11)),t&2){let e=l();r(),v(e.vos.length>0?1:-1),r(),v(e.loading?-1:2),r(),v(e.loadingEntityData?-1:3)}}function Xt(t,_){t&1&&(d(0),c(1,"translate")),t&2&&S(" ",p(1,1,"ADMIN.SEARCHER.TAB_FACILITIES")," ")}function Yt(t,_){if(t&1){let e=x();o(0,"perun-web-apps-attribute-search-select",8),C("search",function(i){h(e);let a=l(2);return f(a.getFacilities(i))}),s()}if(t&2){let e=l(2);u("attributes",e.allAttrDefinitions)("attributesForEntity",R(2,Bt))}}function Zt(t,_){if(t&1&&I(0,"perun-web-apps-facilities-list",14),t&2){let e=l(2);u("loading",e.loading)("displayColumns",R(3,Nt))("facilities",e.entities)}}function $t(t,_){if(t&1&&(b(0,Yt,1,3,"perun-web-apps-attribute-search-select",6),b(1,Zt,1,4,"perun-web-apps-facilities-list",14)),t&2){let e=l();v(e.loading?-1:0),r(),v(e.loadingEntityData?-1:1)}}function Jt(t,_){t&1&&(d(0),c(1,"translate")),t&2&&S(" ",p(1,1,"ADMIN.SEARCHER.TAB_RESOURCES")," ")}function Kt(t,_){if(t&1){let e=x();o(0,"perun-web-apps-attribute-search-select",8),C("search",function(i){h(e);let a=l(2);return f(a.getResources(i))}),s()}if(t&2){let e=l(2);u("attributes",e.allAttrDefinitions)("attributesForEntity",R(2,Ot))}}function Qt(t,_){if(t&1&&I(0,"perun-web-apps-resources-list",15),t&2){let e=l(2);u("loading",e.loading)("displayColumns",R(3,Pt))("resources",e.entities)}}function ei(t,_){if(t&1&&(b(0,Kt,1,3,"perun-web-apps-attribute-search-select",6),b(1,Qt,1,4,"perun-web-apps-resources-list",15)),t&2){let e=l();v(e.loading?-1:0),r(),v(e.loadingEntityData?-1:1)}}function ti(t,_){t&1&&I(0,"mat-spinner",5)}var Un=(()=>{class t{static{this.id="AdminSearcherComponent"}constructor(e,n,i,a,g){this.attributesManager=e,this.searcher=n,this.voService=i,this.cacheHelperService=a,this.destroyRef=g,this.loadingEntityData=!1,this.allAttrDefinitions=[],this.entities=[],this.vos=[]}ngOnInit(){this.loading=!0,this.attributesManager.getAllAttributeDefinitions().subscribe(e=>{this.allAttrDefinitions=e.filter(n=>!n.namespace.includes("-def:virt")),this.loading=!1}),this.cacheHelperService.refreshComponentCachedData().pipe(G(this.destroyRef)).subscribe(e=>{e===t.id&&this.refresh()})}tabChanged(e){switch(this.entities=[],e){case 0:break;case 1:this.loadingEntityData=!0,this.loadAllVos();break;case 2:break;case 3:break;default:break}}loadAllVos(){this.loadingEntityData=!0,this.voService.getAllVos().subscribe(e=>{this.vos=e,this.vos.sort(at),this.selectedVo=e[0],this.loadingEntityData=!1})}voSelected(e){e!==void 0&&(this.selectedVo=e)}getUsers(e){this.searchInput=e,this.loadingEntityData=!0,this.searcher.getUsersSearcher({attributesWithSearchingValues:this.searchInput}).subscribe({next:n=>{this.entities=n,this.loadingEntityData=!1},error:()=>{this.loadingEntityData=!1}})}getMembers(e){this.searchInput=e,this.loadingEntityData=!0,this.searcher.getMembersSearcher({vo:this.selectedVo.id,attributesWithSearchingValues:this.searchInput}).subscribe({next:n=>{this.entities=n,this.loadingEntityData=!1},error:()=>{this.loadingEntityData=!1}})}getFacilities(e){this.searchInput=e,this.loadingEntityData=!0,this.searcher.getFacilities({attributesWithSearchingValues:this.searchInput}).subscribe({next:n=>{this.entities=n.map(i=>({facility:i})),this.loadingEntityData=!1},error:()=>{this.loadingEntityData=!1}})}getResources(e){this.searchInput=e,this.loadingEntityData=!0,this.searcher.getAttributesResources({attributesWithSearchingValues:this.searchInput}).subscribe({next:n=>{this.entities=n,this.loadingEntityData=!1},error:()=>{this.loadingEntityData=!1}})}refresh(){this.searchInput}static{this.\u0275fac=function(n){return new(n||t)(m(je),m(Ge),m(qe),m(H),m(L))}}static{this.\u0275cmp=D({type:t,selectors:[["app-admin-searcher"]],hostVars:2,hostBindings:function(n,i){n&2&&Y("router-component",i.true)},decls:17,vars:4,consts:[[1,"page-subtitle"],["mat-stretch-tabs","false",3,"selectedIndexChange"],[1,"mb-2"],["matTabLabel",""],["matTabContent",""],[1,"ms-auto","me-auto"],[3,"attributes","attributesForEntity"],[3,"loading","routeToAdmin","displayColumns","users"],[3,"search","attributes","attributesForEntity"],[1,"mt-3"],[3,"vos"],[3,"loading","displayedColumns","members"],[3,"voSelected","vos"],[3,"refreshTable","loading","displayedColumns","members"],[3,"loading","displayColumns","facilities"],[3,"loading","displayColumns","resources"]],template:function(n,i){n&1&&(o(0,"h1",0),d(1),c(2,"translate"),s(),o(3,"mat-tab-group",1),C("selectedIndexChange",function(g){return i.tabChanged(g)}),o(4,"mat-tab",2),A(5,Ft,2,3,"ng-template",3)(6,Wt,2,2,"ng-template",4),s(),o(7,"mat-tab"),A(8,jt,2,3,"ng-template",3)(9,zt,4,3,"ng-template",4),s(),o(10,"mat-tab"),A(11,Xt,2,3,"ng-template",3)(12,$t,2,2,"ng-template",4),s(),o(13,"mat-tab"),A(14,Jt,2,3,"ng-template",3)(15,ei,2,2,"ng-template",4),s()(),b(16,ti,1,0,"mat-spinner",5)),n&2&&(r(),E(p(2,2,"ADMIN.SEARCHER.TITLE")),r(15),v(i.loading||i.loadingEntityData?16:-1))},dependencies:[M,mt,it,Ke,Qe,et,tt,Pe,Oe,w,ut,oe,dt,ct,pt,y],encapsulation:2})}}return t})();export{vi as a,ft as b,Ct as c,vn as d,Un as e};
