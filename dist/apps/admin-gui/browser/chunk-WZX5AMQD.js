import{$ as w,$b as le,$g as J,Aa as C,Ae as Se,B as te,Ba as T,Be as Ce,Ca as I,Ce as ve,Dc as de,Eh as $,Gg as Ae,Hh as De,Ja as E,K as y,Kb as se,Kf as P,Lb as ae,Na as h,Nb as oe,Nh as q,O as g,Oa as f,P as S,Pb as pe,Ra as k,Rh as Re,Se as xe,Vf as R,Wb as D,Wf as Ie,Y as c,Ya as j,Yj as Me,Z as m,Zg as W,Zj as Le,_ as ie,_a as re,_g as Z,ac as ce,ah as K,bd as ue,d as M,da as u,ee as he,fe,ff as N,fi as V,ga as a,ge as be,ha as B,hc as me,he as ge,hg as Ee,i as X,ih as ye,ij as Ve,jh as we,ka as p,la as l,m as Y,ma as x,mh as O,pa as v,qa as _,qe as G,ra as o,vd as _e,wc as H,x as Q,y as ee,yb as ne,ye as L,za as U,zh as Te}from"./chunk-E7YEJTUE.js";function ze(e,n){e&1&&x(0,"perun-web-apps-loading-table")}function Ge(e,n){if(e&1){let t=v();p(0,"perun-web-apps-users-list",7),_("queryChanged",function(r){g(t);let s=o();return S(s.nextPage.next(r))})("downloadAll",function(r){g(t);let s=o();return S(s.downloadAll(r))}),h(1,"async"),h(2,"async"),l()}if(e&2){let t=o();a("loading",f(1,6,t.loading$))("users",f(2,8,t.usersPage$))("routeToAdmin",!0)("displayColumns",t.displayedColumns)("filter",t.searchString)("tableId",t.tableId)}}var Ht=(()=>{let n=class n{constructor(i,r,s,d,b,A,z){this.storeService=i,this.cd=r,this.dialog=s,this.cacheHelperService=d,this.userManager=b,this.destroyRef=A,this.notificator=z,this.usersWithoutVo=!1,this.tableId=Ee,this.attributes=[],this.displayedColumns=["user","id","name","email","logins","organization"],this.nextPage=new M({}),this.usersPage$=this.nextPage.pipe(ee(F=>this.userManager.getUsersPage({attrNames:this.attributes,query:{order:F.order,pageSize:F.pageSize,offset:F.offset,sortColumn:F.sortColumn,searchString:this.searchString,withoutVo:this.usersWithoutVo}})),te(()=>{setTimeout(()=>this.loadingSubject$.next(!1),200)}),Q({data:[],totalCount:0,offset:0,pageSize:0})),this.loadingSubject$=new M(!1),this.loading$=Y(this.loadingSubject$,this.nextPage.pipe(X(()=>!0)))}ngOnInit(){this.attributes=[G.USER_DEF_ORGANIZATION,G.USER_DEF_PREFERRED_MAIL],this.attributes=this.attributes.concat(this.storeService.getLoginAttributeNames()),this.cacheHelperService.refreshComponentCachedData().pipe(R(this.destroyRef)).subscribe(i=>{i===n.id&&this.refresh()})}filterSearchString(i){this.searchString=i,this.cd.detectChanges()}filterUserWithoutVO(){this.usersWithoutVo=!this.usersWithoutVo,this.refresh()}refresh(){this.nextPage.next(this.nextPage.value)}downloadAll(i){let r=this.nextPage.getValue(),s=L();s.width="500px";let d=this.dialog.open(Ie,s),b=this.userManager.getUsersPage({attrNames:this.attributes,query:{order:r.order,pageSize:i.length,offset:0,sortColumn:r.sortColumn,searchString:r.searchString,withoutVo:this.usersWithoutVo}}).subscribe({next:A=>{d.close(),Ce(Se(A.data,this.displayedColumns,i.getDataForColumnFun),i.format)},error:A=>{this.notificator.showRPCError(A),d.close()}});d.afterClosed().subscribe(()=>{b&&b.unsubscribe()})}};n.id="AdminUsersComponent",n.\u0275fac=function(r){return new(r||n)(m(ce),m(ie),m(H),m(V),m(oe),m(w),m(xe))},n.\u0275cmp=y({type:n,selectors:[["app-admin-users"]],hostVars:2,hostBindings:function(r,s){r&2&&B("router-component",s.true)},decls:13,vars:13,consts:[[1,"page-subtitle"],[3,"click"],[1,"mt-2","search-field",3,"autoFocus","placeholder","filter"],["color","primary",3,"checked","change"],["spinner",""],[1,"position-relative","table-min-height"],[3,"loading","users","routeToAdmin","displayColumns","filter","tableId","queryChanged","downloadAll",4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],[3,"loading","users","routeToAdmin","displayColumns","filter","tableId","queryChanged","downloadAll"]],template:function(r,s){if(r&1&&(p(0,"h1",0),C(1),h(2,"translate"),l(),p(3,"perun-web-apps-refresh-button",1),_("click",function(){return s.refresh()}),l(),p(4,"perun-web-apps-debounce-filter",2),_("filter",function(b){return s.filterSearchString(b)}),l(),p(5,"mat-checkbox",3),_("change",function(){return s.filterUserWithoutVO()}),C(6),h(7,"translate"),l(),u(8,ze,1,0,"ng-template",null,4,k),p(10,"div",5),u(11,Ge,3,10,"perun-web-apps-users-list",6),h(12,"async"),l()),r&2){let d=U(9);c(),T(f(2,7,"ADMIN.USERS.TITLE")),c(3),a("autoFocus",!0)("placeholder","ADMIN.USERS.SEARCH_PLACEHOLDER"),c(),a("checked",s.usersWithoutVo),c(),I(" ",f(7,9,"ADMIN.USERS.USERS_WITHOUT_VO"),`
`),c(5),a("perunWebAppsLoader",f(12,11,s.loading$))("perunWebAppsLoaderIndicator",d)}},dependencies:[ue,P,O,$,q,N,re,D],styles:[".search-field[_ngcontent-%COMP%]{width:325px}"]});let e=n;return e})();function Ze(e,n){if(e&1){let t=v();p(0,"button",8),_("click",function(){g(t);let r=o();return S(r.createService())}),C(1),h(2,"translate"),l()}e&2&&(c(),I(" ",f(2,1,"ADMIN.SERVICES.CREATE")," "))}function Je(e,n){if(e&1){let t=v();p(0,"button",9),_("click",function(){g(t);let r=o();return S(r.deleteService())}),C(1),h(2,"translate"),l()}if(e&2){let t=o();a("disabled",t.loading||t.selection.selected.length===0),c(),I(" ",f(2,2,"ADMIN.SERVICES.DELETE")," ")}}function Ke(e,n){e&1&&x(0,"perun-web-apps-loading-table")}function Xe(e,n){if(e&1&&x(0,"app-services-list",10),e&2){let t=o();a("loading",t.loading)("filterValue",t.filterValue)("selection",t.selection)("cachedSubject",t.cachedSubject)("services",t.services)("tableId",t.tableId)}}var ii=(()=>{let n=class n{constructor(i,r,s,d,b){this.serviceManager=i,this.dialog=r,this.authResolver=s,this.cacheHelperService=d,this.destroyRef=b,this.selection=new me(!0,[],!0,(A,z)=>A.id===z.id),this.cachedSubject=new M(!0),this.loading=!1,this.filterValue="",this.tableId=Ae}ngOnInit(){this.refreshTable(),this.cacheHelperService.refreshComponentCachedData().pipe(R(this.destroyRef)).subscribe(i=>{i===n.id&&this.refreshTable()})}createService(){let i=L();i.width="600px",i.data={theme:"admin-theme"},this.dialog.open(Me,i).afterClosed().subscribe(s=>{s&&this.refreshTable()})}deleteService(){let i=L();i.width="600px",i.data={theme:"admin-theme",services:this.selection.selected},this.dialog.open(Le,i).afterClosed().subscribe(s=>{s&&this.refreshTable()})}refreshTable(){this.loading=!0,this.serviceManager.getServices().subscribe(i=>{this.services=i,this.selection.clear(),this.cachedSubject.next(!0),this.loading=!1})}applyFilter(i){this.filterValue=i,this.refreshTable()}};n.id="AdminServicesComponent",n.\u0275fac=function(r){return new(r||n)(m(ae),m(H),m(le),m(V),m(w))},n.\u0275cmp=y({type:n,selectors:[["app-admin-services"]],decls:12,vars:8,consts:[[1,"page-subtitle"],[3,"refresh"],["color","accent","class","action-button me-2","data-cy","service-create-button","mat-flat-button","",3,"click",4,"ngIf"],["class","me-2","color","warn","data-cy","service-delete-button","mat-flat-button","",3,"disabled","click",4,"ngIf"],[3,"placeholder","filter"],["spinner",""],[1,"position-relative","table-min-height"],[3,"loading","filterValue","selection","cachedSubject","services","tableId",4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],["color","accent","data-cy","service-create-button","mat-flat-button","",1,"action-button","me-2",3,"click"],["color","warn","data-cy","service-delete-button","mat-flat-button","",1,"me-2",3,"disabled","click"],[3,"loading","filterValue","selection","cachedSubject","services","tableId"]],template:function(r,s){if(r&1&&(p(0,"div")(1,"h1",0),C(2),h(3,"translate"),l(),p(4,"perun-web-apps-refresh-button",1),_("refresh",function(){return s.refreshTable()}),l(),u(5,Ze,3,3,"button",2)(6,Je,3,4,"button",3),p(7,"perun-web-apps-debounce-filter",4),_("filter",function(b){return s.applyFilter(b)}),l(),u(8,Ke,1,0,"ng-template",null,5,k),p(10,"div",6),u(11,Xe,1,6,"app-services-list",7),l()()),r&2){let d=U(9);c(2),T(f(3,6,"ADMIN.SERVICES.TITLE")),c(3),a("ngIf",s.authResolver.isPerunAdmin()),c(),a("ngIf",s.authResolver.isPerunAdmin()),c(),a("placeholder","ADMIN.SERVICES.FILTER"),c(4),a("perunWebAppsLoader",s.loading)("perunWebAppsLoaderIndicator",d)}},dependencies:[j,de,Ve,P,O,$,N,D]});let e=n;return e})();function Ye(e,n){e&1&&(C(0),h(1,"translate")),e&2&&I(" ",f(1,1,"ADMIN.SEARCHER.TAB_USERS")," ")}var Qe=()=>["user"];function et(e,n){if(e&1){let t=v();p(0,"perun-web-apps-attribute-search-select",8),_("search",function(r){g(t);let s=o(2);return S(s.getUsers(r))}),l()}if(e&2){let t=o(2);a("attributes",t.allAttrDefinitions)("attributesForEntity",E(2,Qe))}}var tt=()=>["user","id","name"];function it(e,n){if(e&1&&x(0,"perun-web-apps-users-list",9),e&2){let t=o(2);a("loading",t.loading)("tableId",t.tableId)("routeToAdmin",!0)("displayColumns",E(5,tt))("users",t.entities)}}function rt(e,n){if(e&1&&u(0,et,1,3,"perun-web-apps-attribute-search-select",6)(1,it,1,6,"perun-web-apps-users-list",7),e&2){let t=o();a("ngIf",!t.loading),c(),a("ngIf",!t.loadingEntityData)}}function nt(e,n){e&1&&(C(0),h(1,"translate")),e&2&&I(" ",f(1,1,"ADMIN.SEARCHER.TAB_MEMBERS")," ")}function st(e,n){if(e&1){let t=v();p(0,"perun-web-apps-vo-search-select",13),_("voSelected",function(r){g(t);let s=o(2);return S(s.voSelected(r))}),l()}if(e&2){let t=o(2);a("vos",t.vos)}}var at=()=>["user","member"];function ot(e,n){if(e&1){let t=v();p(0,"perun-web-apps-attribute-search-select",8),_("search",function(r){g(t);let s=o(2);return S(s.getMembers(r))}),l()}if(e&2){let t=o(2);a("attributes",t.allAttrDefinitions)("attributesForEntity",E(2,at))}}var pt=()=>["id","voId","userId","status"];function lt(e,n){if(e&1){let t=v();p(0,"perun-web-apps-members-list",14),_("refreshTable",function(){g(t);let r=o(2);return S(r.getMembers(r.searchInput))}),l()}if(e&2){let t=o(2);a("loading",t.loading)("displayedColumns",E(4,pt))("members",t.entities)("tableId",t.tableId)}}function ct(e,n){if(e&1&&(p(0,"div",10),u(1,st,1,1,"perun-web-apps-vo-search-select",11),l(),u(2,ot,1,3,"perun-web-apps-attribute-search-select",6)(3,lt,1,5,"perun-web-apps-members-list",12)),e&2){let t=o();c(),a("ngIf",t.vos.length>0),c(),a("ngIf",!t.loading),c(),a("ngIf",!t.loadingEntityData)}}function mt(e,n){e&1&&(C(0),h(1,"translate")),e&2&&I(" ",f(1,1,"ADMIN.SEARCHER.TAB_FACILITIES")," ")}var dt=()=>["facility"];function ut(e,n){if(e&1){let t=v();p(0,"perun-web-apps-attribute-search-select",8),_("search",function(r){g(t);let s=o(2);return S(s.getFacilities(r))}),l()}if(e&2){let t=o(2);a("attributes",t.allAttrDefinitions)("attributesForEntity",E(2,dt))}}var _t=()=>["id","name","description"];function ht(e,n){if(e&1&&x(0,"perun-web-apps-facilities-list",16),e&2){let t=o(2);a("loading",t.loading)("tableId",t.tableId)("displayedColumns",E(4,_t))("facilities",t.entities)}}function ft(e,n){if(e&1&&u(0,ut,1,3,"perun-web-apps-attribute-search-select",6)(1,ht,1,5,"perun-web-apps-facilities-list",15),e&2){let t=o();a("ngIf",!t.loading),c(),a("ngIf",!t.loadingEntityData)}}function bt(e,n){e&1&&(C(0),h(1,"translate")),e&2&&I(" ",f(1,1,"ADMIN.SEARCHER.TAB_RESOURCES")," ")}var gt=()=>["resource"];function St(e,n){if(e&1){let t=v();p(0,"perun-web-apps-attribute-search-select",8),_("search",function(r){g(t);let s=o(2);return S(s.getResources(r))}),l()}if(e&2){let t=o(2);a("attributes",t.allAttrDefinitions)("attributesForEntity",E(2,gt))}}var Ct=()=>["id","name","description","voId","facilityId"];function vt(e,n){if(e&1&&x(0,"perun-web-apps-resources-list",18),e&2){let t=o(2);a("loading",t.loading)("tableId",t.tableId)("displayedColumns",E(4,Ct))("resources",t.entities)}}function xt(e,n){if(e&1&&u(0,St,1,3,"perun-web-apps-attribute-search-select",6)(1,vt,1,5,"perun-web-apps-resources-list",17),e&2){let t=o();a("ngIf",!t.loading),c(),a("ngIf",!t.loadingEntityData)}}function It(e,n){e&1&&x(0,"mat-spinner",19)}var Ci=(()=>{let n=class n{constructor(i,r,s,d,b){this.attributesManager=i,this.searcher=r,this.voService=s,this.cacheHelperService=d,this.destroyRef=b,this.loadingEntityData=!1,this.allAttrDefinitions=[],this.tableId=W,this.entities=[],this.vos=[]}ngOnInit(){this.loading=!0,this.attributesManager.getAllAttributeDefinitions().subscribe(i=>{this.allAttrDefinitions=i.filter(r=>!r.namespace.includes("-def:virt")),this.loading=!1}),this.cacheHelperService.refreshComponentCachedData().pipe(R(this.destroyRef)).subscribe(i=>{i===n.id&&this.refresh()})}tabChanged(i){switch(this.entities=[],i){case 0:this.tableId=W;break;case 1:this.loadingEntityData=!0,this.loadAllVos(),this.tableId=Z;break;case 2:this.tableId=J;break;case 3:this.tableId=K;break;default:break}}loadAllVos(){this.loadingEntityData=!0,this.voService.getAllVos().subscribe(i=>{this.vos=i,this.vos.sort(ve),this.selectedVo=i[0],this.loadingEntityData=!1})}voSelected(i){i!==void 0&&(this.selectedVo=i)}getUsers(i){this.searchInput=i,this.loadingEntityData=!0,this.searcher.getUsersSearcher({attributesWithSearchingValues:this.searchInput}).subscribe({next:r=>{this.entities=r,this.loadingEntityData=!1},error:()=>{this.loadingEntityData=!1}})}getMembers(i){this.searchInput=i,this.loadingEntityData=!0,this.searcher.getMembersSearcher({vo:this.selectedVo.id,attributesWithSearchingValues:this.searchInput}).subscribe({next:r=>{this.entities=r,this.loadingEntityData=!1},error:()=>{this.loadingEntityData=!1}})}getFacilities(i){this.searchInput=i,this.loadingEntityData=!0,this.searcher.getFacilities({attributesWithSearchingValues:this.searchInput}).subscribe({next:r=>{this.entities=r.map(s=>({facility:s})),this.loadingEntityData=!1},error:()=>{this.loadingEntityData=!1}})}getResources(i){this.searchInput=i,this.loadingEntityData=!0,this.searcher.getAttributesResources({attributesWithSearchingValues:this.searchInput}).subscribe({next:r=>{this.entities=r,this.loadingEntityData=!1},error:()=>{this.loadingEntityData=!1}})}refresh(){if(this.searchInput)switch(this.tableId){case W:this.getUsers(this.searchInput);break;case Z:this.getMembers(this.searchInput);break;case J:this.getFacilities(this.searchInput);break;case K:this.getResources(this.searchInput);break;default:break}}};n.id="AdminSearcherComponent",n.\u0275fac=function(r){return new(r||n)(m(ne),m(se),m(pe),m(V),m(w))},n.\u0275cmp=y({type:n,selectors:[["app-admin-searcher"]],hostVars:2,hostBindings:function(r,s){r&2&&B("router-component",s.true)},decls:17,vars:4,consts:[[1,"page-subtitle"],["mat-stretch-tabs","false",3,"selectedIndexChange"],[1,"mb-2"],["matTabLabel",""],["matTabContent",""],["class","ms-auto me-auto",4,"ngIf"],[3,"attributes","attributesForEntity","search",4,"ngIf"],[3,"loading","tableId","routeToAdmin","displayColumns","users",4,"ngIf"],[3,"attributes","attributesForEntity","search"],[3,"loading","tableId","routeToAdmin","displayColumns","users"],[1,"mt-3"],[3,"vos","voSelected",4,"ngIf"],[3,"loading","displayedColumns","members","tableId","refreshTable",4,"ngIf"],[3,"vos","voSelected"],[3,"loading","displayedColumns","members","tableId","refreshTable"],[3,"loading","tableId","displayedColumns","facilities",4,"ngIf"],[3,"loading","tableId","displayedColumns","facilities"],[3,"loading","tableId","displayedColumns","resources",4,"ngIf"],[3,"loading","tableId","displayedColumns","resources"],[1,"ms-auto","me-auto"]],template:function(r,s){r&1&&(p(0,"h1",0),C(1),h(2,"translate"),l(),p(3,"mat-tab-group",1),_("selectedIndexChange",function(b){return s.tabChanged(b)}),p(4,"mat-tab",2),u(5,Ye,2,3,"ng-template",3)(6,rt,2,2,"ng-template",4),l(),p(7,"mat-tab"),u(8,nt,2,3,"ng-template",3)(9,ct,4,3,"ng-template",4),l(),p(10,"mat-tab"),u(11,mt,2,3,"ng-template",3)(12,ft,2,2,"ng-template",4),l(),p(13,"mat-tab"),u(14,bt,2,3,"ng-template",3)(15,xt,2,2,"ng-template",4),l()(),u(16,It,1,0,"mat-spinner",5)),r&2&&(c(),T(f(2,2,"ADMIN.SEARCHER.TITLE")),c(15),a("ngIf",s.loading||s.loadingEntityData))},dependencies:[j,he,fe,be,ge,_e,ye,Te,De,we,q,Re,D]});let e=n;return e})();export{Ht as a,ii as b,Ci as c};
