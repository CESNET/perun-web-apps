import{a as Ji,b as Zi,c as en,d as tn}from"./chunk-FJ7APLOV.js";import{a as yi,b as Ai,c as Fi,d as xi,e as Ri,f as wi,g as Di,h as Li,i as Oi,j as Ni,k as ki,l as Vi}from"./chunk-6A3CEFNH.js";import{a as Qi}from"./chunk-JJTWFEPZ.js";import"./chunk-UQYKEMNM.js";import{j as Ki}from"./chunk-FY44JBUX.js";import"./chunk-XDROFCJ6.js";import{a as je}from"./chunk-DKNLPFFQ.js";import{$b as M,$h as Si,Aa as d,Ad as jt,Ag as si,Ai as Pe,Ba as T,Bh as H,Ca as _,Ci as Be,Da as oe,Db as L,Dc as O,E as at,Ea as mt,Ec as Et,F as Ae,Fh as Ne,Ga as dt,Gb as It,H as ot,Hg as li,Hh as ke,Ja as q,Jb as Re,Jf as ti,Jh as hi,K as E,Ka as Qe,Kf as Y,Kj as Ge,L as Fe,Lb as ae,Lh as gi,Li as Ei,Lj as Pi,Mb as we,Mc as At,Mf as ii,Mg as ci,Mj as Bi,Na as p,Nc as Ze,Ne as Le,Nf as ni,O as I,Oa as m,Oc as Ft,Oe as Qt,Of as ai,Og as pi,Oj as Ue,P as C,Pf as oi,Qj as ji,Ra as G,Rj as Gi,Sc as se,Se as Z,Sj as Ui,T as xe,Td as Gt,Tj as Yi,Ud as Ut,Uh as _i,Vb as re,Vc as xt,Vd as Yt,Wa as ut,Wb as A,Xa as ft,Xj as Hi,Y as r,Ya as x,Yb as Ct,Yh as vi,Z as u,Za as ht,Ze as R,_ as rt,_a as gt,_b as yt,_e as Me,aa as ce,ac as bt,bd as Rt,be as De,ca as st,cb as _t,d as j,da as v,df as Jt,di as Ii,dk as Ye,ee as Ht,ek as Wi,fe as Wt,ff as U,fi as Ci,fk as zi,ga as c,gd as wt,ge as zt,gi as Ve,gj as Mi,ha as k,hc as B,hd as Dt,he as $t,hh as mi,i as be,ia as pe,if as Zt,ii as bi,jd as Lt,jf as ei,jh as K,ji as Ti,ka as l,kd as Mt,la as s,lk as $i,ma as S,mc as Tt,md as Ot,mk as Xi,pa as b,pd as Nt,pf as ee,qa as g,qb as de,qe as et,qh as di,qk as qi,ra as h,rd as le,rh as Oe,tb as ue,td as kt,ua as me,ub as vt,uc as fe,vc as he,vd as Se,ve as Xt,vh as ui,wa as lt,wb as Je,wc as V,we as qt,x as Te,xa as ct,xc as ge,xd as Vt,xh as fi,ya as pt,yb as St,yc as _e,yd as Pt,ye as D,z as nt,za as w,zc as ve,zd as Bt,ze as Kt,zg as ri}from"./chunk-VNBWX7HP.js";import"./chunk-2YRG3NBG.js";function yn(i,o){i&1&&S(0,"mat-spinner",3)}function bn(i,o){if(i&1){let n=b();l(0,"button",12),g("click",function(){I(n);let t=h(2);return C(t.editFacility())}),p(1,"translate"),l(2,"mat-icon"),d(3,"edit"),s()()}i&2&&me("matTooltip",m(1,1,"FACILITY_DETAIL.EDIT"))}function Tn(i,o){if(i&1){let n=b();l(0,"button",12),g("click",function(){I(n);let t=h(2);return C(t.deleteFacility())}),p(1,"translate"),l(2,"mat-icon"),d(3,"delete_forever"),s()()}i&2&&me("matTooltip",m(1,1,"FACILITY_DETAIL.DELETE"))}var En=()=>({color:"black"}),nn=i=>["/facilities",i];function An(i,o){if(i&1&&(l(0,"div")(1,"div",4),S(2,"mat-icon",5),p(3,"translate"),l(4,"div",6)(5,"div",7)(6,"a",8),g("auxclick",function(e){return e.preventDefault()}),d(7),s(),l(8,"span",9),d(9),s(),v(10,bn,4,3,"button",10)(11,Tn,4,3,"button",10),s(),l(12,"div"),d(13),p(14,"translate"),s(),l(15,"span",11),d(16),p(17,"translate"),p(18,"translate"),s()()(),S(19,"app-animated-router-outlet"),s()),i&2){let n=h();r(2),me("matTooltip",m(3,13,"FACILITY_DETAIL.ENTITY")),c("ngStyle",q(21,En)),r(4),c("perunWebAppsMiddleClickRouterLink",Qe(22,nn,n.facility.id.toString()))("routerLink",Qe(24,nn,n.facility.id)),r(),T(n.facility.name),r(2),_(" \xA0#",n.facility.id," "),r(),c("ngIf",n.editFacilityAuth),r(),c("ngIf",n.deleteAuth),r(2),oe("",m(14,15,"FACILITY_DETAIL.UUID"),": ",n.facility.uuid,""),r(3),mt(" ",m(17,17,"FACILITY_DETAIL.ENTITY"),", ",m(18,19,"FACILITY_DETAIL.DESCRIPTION"),": ",n.facility.description," ")}}var on=(()=>{let o=class o extends yi(){constructor(e,t,a,f,y,F,W,P,J){super(),this.dialog=e,this.facilityManager=t,this.route=a,this.sideMenuService=f,this.sideMenuItemService=y,this.guiAuthResolver=F,this.router=W,this.entityStorageService=P,this.reloadEntityDetail=J,this.editFacilityAuth=!1,this.deleteAuth=!1,this.loading=!1}ngOnInit(){this.reloadData(),this.reloadEntityDetail.entityDetailChange.pipe(nt(this.destroyed$)).subscribe(()=>{this.reloadData()})}reloadData(){this.loading=!0,this.route.params.subscribe(e=>{let t=Number(e.facilityId);this.facilityManager.getFacilityById(t).subscribe({next:a=>{this.facility=a,this.entityStorageService.setEntityAndPathParam({id:a.id,beanName:a.beanName},yt.Facility),this.setMenuItems(),this.editFacilityAuth=this.guiAuthResolver.isAuthorized("updateFacility_Facility_policy",[this.facility]),this.deleteAuth=this.guiAuthResolver.isAuthorized("deleteFacility_Facility_Boolean_policy",[this.facility]),Xt("facilities",this.facility),qt(this.facility),this.loading=!1},error:()=>this.loading=!1})})}setMenuItems(){let e=this.sideMenuItemService.parseFacility(this.facility);this.sideMenuService.setFacilityMenuItems([e])}editFacility(){let e=D();e.width="450px",e.data={theme:"facility-theme",facility:this.facility,dialogType:Zt.FACILITY},this.dialog.open(ei,e).afterClosed().subscribe(a=>{a&&this.facilityManager.getFacilityById(this.facility.id).subscribe(f=>{this.facility=f,this.setMenuItems()})})}deleteFacility(){let e=D();e.width="500px",e.data={theme:"facility-theme",facility:this.facility},this.dialog.open(Hi,e).afterClosed().subscribe(a=>{a&&this.router.navigate([""],{queryParamsHandling:"preserve"})})}};o.\u0275fac=function(t){return new(t||o)(u(V),u(L),u(de),u(Jt),u(Ii),u(M),u(ue),u(R),u(Ci))},o.\u0275cmp=E({type:o,selectors:[["app-facility-detail-page"]],features:[st],decls:4,vars:2,consts:[[1,"container-fluid","ps-xl-5","pe-xl-5","facility-theme"],["class","me-auto ms-auto",4,"ngIf"],[4,"ngIf"],[1,"me-auto","ms-auto"],[1,"d-flex","page-title-headtitle"],["svgIcon","perun-facility-black",1,"perun-icon","perun-icon-detail",3,"matTooltip","ngStyle"],[1,"page-title-block"],[1,"page-title-headline","d-flex","align-items-center"],[1,"facility-link",3,"perunWebAppsMiddleClickRouterLink","routerLink","auxclick"],[1,"text-muted"],["mat-icon-button","",3,"matTooltip","click",4,"ngIf"],[1,"mt-1","entity-info"],["mat-icon-button","",3,"matTooltip","click"]],template:function(t,a){t&1&&(l(0,"div",0),S(1,"perun-web-apps-back-button"),v(2,yn,1,0,"mat-spinner",1)(3,An,20,26,"div",2),s()),t&2&&(r(2),c("ngIf",a.loading),r(),c("ngIf",!a.loading&&a.facility!==void 0))},dependencies:[x,ht,vt,le,Et,Se,De,Ve,mi,ni,ai,A],data:{animation:[ke]}});let i=o;return i})();function xn(i,o){i&1&&S(0,"mat-spinner",2)}function Rn(i,o){if(i&1&&(l(0,"div"),S(1,"perun-web-apps-menu-buttons-field",3)(2,"perun-web-apps-expandable-tiles",4),s()),i&2){let n=h();r(),c("items",n.items),r(),c("items",n.settingItems)("title","MENU_ITEMS.FACILITY.SETTINGS")("sectionId","settings")}}var rn=(()=>{let o=class o{constructor(e,t,a,f){this.facilityManager=e,this.authResolver=t,this.entityStorageService=a,this.routePolicyService=f,this.items=[],this.settingItems=[],this.loading=!1}ngOnInit(){this.loading=!0,this.facility=this.entityStorageService.getEntity(),this.setItems(),this.setSettingsItems(),this.loading=!1}setItems(){this.items=[],this.routePolicyService.canNavigate("facilities-resources",this.facility)&&this.items.push({cssIcon:"perun-manage-facility",url:`/facilities/${this.facility.id}/resources`,label:"MENU_ITEMS.FACILITY.RESOURCES",style:"facility-btn"}),this.routePolicyService.canNavigate("facilities-allowed-users",this.facility)&&this.items.push({cssIcon:"perun-user",url:`/facilities/${this.facility.id}/allowed-users`,label:"MENU_ITEMS.FACILITY.ALLOWED_USERS",style:"facility-btn"}),this.routePolicyService.canNavigate("facilities-allowed-groups",this.facility)&&this.items.push({cssIcon:"perun-group",url:`/facilities/${this.facility.id}/allowed-groups`,label:"MENU_ITEMS.FACILITY.ALLOWED_GROUPS",style:"facility-btn"}),this.routePolicyService.canNavigate("facilities-services-status",this.facility)&&this.items.push({cssIcon:"perun-service-status",url:`/facilities/${this.facility.id}/services-status`,label:"MENU_ITEMS.FACILITY.SERVICES_STATUS",style:"facility-btn"}),this.routePolicyService.canNavigate("facilities-services-destinations",this.facility)&&this.items.push({cssIcon:"perun-service_destination",url:`/facilities/${this.facility.id}/services-destinations`,label:"MENU_ITEMS.FACILITY.SERVICES_DESTINATIONS",style:"facility-btn"}),this.routePolicyService.canNavigate("facilities-hosts",this.facility)&&this.items.push({cssIcon:"perun-hosts",url:`/facilities/${this.facility.id}/hosts`,label:"MENU_ITEMS.FACILITY.HOSTS",style:"facility-btn"}),this.routePolicyService.canNavigate("facilities-attributes",this.facility)&&this.items.push({cssIcon:"perun-attributes",url:`/facilities/${this.facility.id}/attributes`,label:"MENU_ITEMS.FACILITY.ATTRIBUTES",style:"facility-btn"})}setSettingsItems(){this.settingItems=[],this.routePolicyService.canNavigate("facilities-settings-owners",this.facility)&&this.settingItems.push({cssIcon:"perun-owner-grey",url:`/facilities/${this.facility.id}/settings/owners`,label:"MENU_ITEMS.FACILITY.OWNERS",style:"facility-btn"}),this.routePolicyService.canNavigate("facilities-settings-managers",this.facility)&&this.settingItems.push({cssIcon:"perun-manager",url:`/facilities/${this.facility.id}/settings/managers`,label:"MENU_ITEMS.FACILITY.MANAGERS",style:"facility-btn"}),this.routePolicyService.canNavigate("facilities-settings-bans",this.facility)&&this.settingItems.push({cssIcon:"perun-ban",url:`/facilities/${this.facility.id}/settings/bans`,label:"MENU_ITEMS.FACILITY.BANS",style:"facility-btn"})}};o.\u0275fac=function(t){return new(t||o)(u(L),u(M),u(R),u(Me))},o.\u0275cmp=E({type:o,selectors:[["app-facility-overview"]],hostVars:2,hostBindings:function(t,a){t&2&&k("router-component",a.true)},decls:2,vars:2,consts:[["class","me-auto ms-auto",4,"ngIf"],[4,"ngIf"],[1,"me-auto","ms-auto"],[3,"items"],[3,"items","title","sectionId"]],template:function(t,a){t&1&&v(0,xn,1,0,"mat-spinner",0)(1,Rn,3,4,"div",1),t&2&&(c("ngIf",a.loading),r(),c("ngIf",!a.loading))},dependencies:[x,Se,Oe,vi]});let i=o;return i})();var sn=(()=>{let o=class o{};o.\u0275fac=function(t){return new(t||o)},o.\u0275cmp=E({type:o,selectors:[["app-facility-settings"]],hostVars:2,hostBindings:function(t,a){t&2&&k("router-component",a.true)},decls:1,vars:0,template:function(t,a){t&1&&S(0,"app-animated-router-outlet")},dependencies:[Ve],data:{animation:[ke]}});let i=o;return i})();function wn(i,o){i&1&&S(0,"mat-spinner",2)}function Dn(i,o){if(i&1&&(l(0,"div"),S(1,"perun-web-apps-menu-buttons-field",3),s()),i&2){let n=h();r(),c("items",n.items)}}var ln=(()=>{let o=class o{constructor(e,t,a,f){this.facilityManager=e,this.authResolver=t,this.entityStorageService=a,this.routePolicyService=f,this.items=[],this.loading=!1}ngOnInit(){this.loading=!0,this.facility=this.entityStorageService.getEntity(),this.initItems(),this.loading=!1}initItems(){this.items=[],this.routePolicyService.canNavigate("facilities-settings-owners",this.facility)&&this.items.push({cssIcon:"perun-owner-grey",url:`/facilities/${this.facility.id}/settings/owners`,label:"MENU_ITEMS.FACILITY.OWNERS",style:"facility-btn"}),this.routePolicyService.canNavigate("facilities-settings-managers",this.facility)&&this.items.push({cssIcon:"perun-manager",url:`/facilities/${this.facility.id}/settings/managers`,label:"MENU_ITEMS.FACILITY.MANAGERS",style:"facility-btn"}),this.routePolicyService.canNavigate("facilities-settings-bans",this.facility)&&this.items.push({cssIcon:"perun-ban",url:`/facilities/${this.facility.id}/settings/bans`,label:"MENU_ITEMS.FACILITY.BANS",style:"facility-btn"})}};o.\u0275fac=function(t){return new(t||o)(u(L),u(M),u(R),u(Me))},o.\u0275cmp=E({type:o,selectors:[["app-facility-settings-overview"]],hostVars:2,hostBindings:function(t,a){t&2&&k("router-component",a.true)},decls:2,vars:2,consts:[["class","me-auto ms-auto",4,"ngIf"],[4,"ngIf"],[1,"me-auto","ms-auto"],[3,"items"]],template:function(t,a){t&1&&v(0,wn,1,0,"mat-spinner",0)(1,Dn,2,1,"div",1),t&2&&(c("ngIf",a.loading),r(),c("ngIf",!a.loading))},dependencies:[x,Se,Oe]});let i=o;return i})();function Mn(i,o){i&1&&(d(0),p(1,"translate")),i&2&&_(" ",m(1,1,"FACILITY_DETAIL.ENTITY")," ")}function On(i,o){if(i&1&&S(0,"app-one-entity-attribute-page",5),i&2){let n=h();c("entityId",n.facility.id)("entity","facility")}}function Nn(i,o){i&1&&(d(0),p(1,"translate"),p(2,"translate")),i&2&&oe(" ",m(1,2,"FACILITY_DETAIL.ENTITY")," - ",m(2,4,"ADMIN_USER.ENTITY")," ")}function kn(i,o){if(i&1&&S(0,"app-two-entity-attribute-page",6),i&2){let n=h(2);c("firstEntity","facility")("firstEntityId",n.facility.id)("secondEntity","user")}}function Vn(i,o){i&1&&(l(0,"mat-tab"),v(1,Nn,3,6,"ng-template",2)(2,kn,1,3,"ng-template",3),s())}var cn=(()=>{let o=class o{constructor(e,t){this.authResolver=e,this.entityStorageService=t}ngOnInit(){this.facility=this.entityStorageService.getEntity(),this.facilityUserAttAuth=this.authResolver.isAuthorized("getAssignedUsers_Facility_policy",[this.facility])}};o.\u0275fac=function(t){return new(t||o)(u(M),u(R))},o.\u0275cmp=E({type:o,selectors:[["app-facility-attributes"]],hostVars:2,hostBindings:function(t,a){t&2&&k("router-component",a.true)},decls:9,vars:4,consts:[[1,"page-subtitle"],["mat-stretch-tabs","false"],["matTabLabel",""],["matTabContent",""],[4,"ngIf"],[3,"entityId","entity"],[3,"firstEntity","firstEntityId","secondEntity"]],template:function(t,a){t&1&&(l(0,"div")(1,"h1",0),d(2),p(3,"translate"),s(),l(4,"mat-tab-group",1)(5,"mat-tab"),v(6,Mn,2,3,"ng-template",2)(7,On,1,2,"ng-template",3),s(),v(8,Vn,3,0,"mat-tab",4),s()()),t&2&&(r(2),T(m(3,2,"FACILITY_DETAIL.SETTINGS.ATTRIBUTES.TITLE")),r(6),c("ngIf",a.facilityUserAttAuth))},dependencies:[x,Ht,Wt,zt,$t,Ei,Pe,A]});let i=o;return i})();function Bn(i,o){if(i&1){let n=b();l(0,"mat-option",10),g("onSelectionChange",function(){let a=I(n).$implicit,f=h(3);return C(f.onSelectedService(a))}),d(1),s()}if(i&2){let n=o.$implicit;c("value",n),r(),_(" ",n.name," ")}}function jn(i,o){if(i&1){let n=b();l(0,"mat-form-field",6)(1,"mat-label"),d(2),p(3,"translate"),s(),l(4,"input",7),g("keyup",function(t){I(n);let a=h(2);return C(a.updatedSerVal(t))}),s(),l(5,"mat-autocomplete",8,9)(7,"mat-option",10),g("onSelectionChange",function(){I(n);let t=h(2);return C(t.onSelectedService("NOT_SELECTED"))}),d(8),p(9,"translate"),s(),l(10,"mat-option",10),g("onSelectionChange",function(){I(n);let t=h(2);return C(t.onSelectedService("ALL"))}),d(11),p(12,"translate"),s(),v(13,Bn,2,2,"mat-option",11),p(14,"async"),s()()}if(i&2){let n=w(6),e=h(2);r(2),T(m(3,9,"FACILITY_DETAIL.SERVICE_CONFIG.SERVICE_SELECT")),r(2),c("formControl",e.serviceField)("matAutocomplete",n),r(),c("displayWith",e.serviceDisplayFn.bind(e)),r(2),c("value","NOT_SELECTED"),r(),_(" ",m(9,11,"FACILITY_DETAIL.SERVICE_CONFIG.NOT_SELECTED")," "),r(2),c("value","ALL"),r(),_(" ",m(12,13,"FACILITY_DETAIL.SERVICE_CONFIG.ALL")," "),r(2),c("ngForOf",m(14,15,e.filteredServices))}}function Gn(i,o){if(i&1){let n=b();l(0,"mat-option",10),g("onSelectionChange",function(){let a=I(n).$implicit,f=h(3);return C(f.onSelectedResource(a))}),d(1),s()}if(i&2){let n=o.$implicit;c("value",n),r(),_(" ",n.name," ")}}function Un(i,o){if(i&1){let n=b();l(0,"mat-form-field",6)(1,"mat-label"),d(2),p(3,"translate"),s(),l(4,"input",7),g("keyup",function(t){I(n);let a=h(2);return C(a.updatedResVal(t))}),s(),l(5,"mat-autocomplete",8,9),v(7,Gn,2,2,"mat-option",11),p(8,"async"),s()()}if(i&2){let n=w(6),e=h(2);r(2),T(m(3,5,"FACILITY_DETAIL.SERVICE_CONFIG.RES_SELECT")),r(2),c("formControl",e.resourceField)("matAutocomplete",n),r(),c("displayWith",e.resourceDisplayFn.bind(e)),r(2),c("ngForOf",m(8,7,e.filteredResources))}}function Yn(i,o){if(i&1){let n=b();l(0,"mat-option",10),g("onSelectionChange",function(){let a=I(n).$implicit,f=h(3);return C(f.onSelectedGroup(a))}),d(1),s()}if(i&2){let n=o.$implicit;c("value",n),r(),_(" ",n.name," ")}}function Hn(i,o){if(i&1){let n=b();l(0,"mat-form-field",6)(1,"mat-label"),d(2),p(3,"translate"),s(),l(4,"input",7),g("keyup",function(t){I(n);let a=h(2);return C(a.updatedGroupVal(t))}),s(),l(5,"mat-autocomplete",12,9),v(7,Yn,2,2,"mat-option",11),p(8,"async"),s()()}if(i&2){let n=w(6),e=h(2);r(2),T(m(3,5,"FACILITY_DETAIL.SERVICE_CONFIG.GROUP_SELECT")),r(2),c("formControl",e.groupField)("matAutocomplete",n),r(),c("displayWith",e.groupDisplayFn.bind(e)),r(2),c("ngForOf",m(8,7,e.filteredGroups))}}function Wn(i,o){if(i&1){let n=b();l(0,"mat-option",10),g("onSelectionChange",function(){let a=I(n).$implicit,f=h(3);return C(f.onSelectedMember(a))}),d(1),p(2,"userFullName"),s()}if(i&2){let n=o.$implicit;c("value",n),r(),_(" ",m(2,2,n.user)," ")}}function zn(i,o){if(i&1&&(l(0,"mat-form-field",6)(1,"mat-label"),d(2),p(3,"translate"),s(),S(4,"input",13),l(5,"mat-autocomplete",8,9),v(7,Wn,3,4,"mat-option",11),p(8,"async"),s()()),i&2){let n=w(6),e=h(2);r(2),T(m(3,5,"FACILITY_DETAIL.SERVICE_CONFIG.MEMBER_SELECT")),r(2),c("matAutocomplete",n)("formControl",e.memberField),r(),c("displayWith",e.memberDisplayFn.bind(e)),r(2),c("ngForOf",m(8,7,e.filteredMembers))}}function $n(i,o){if(i&1){let n=b();l(0,"div",3),v(1,jn,15,17,"mat-form-field",4),l(2,"mat-checkbox",5),g("change",function(t){I(n);let a=h();return C(a.onOfferAllServices(t))}),d(3),p(4,"translate"),s(),v(5,Un,9,9,"mat-form-field",4)(6,Hn,9,9,"mat-form-field",4)(7,zn,9,9,"mat-form-field",4),s()}if(i&2){let n=h();r(),c("ngIf",n.services!==void 0),r(2),_(" ",m(4,5,"FACILITY_DETAIL.SERVICE_CONFIG.ALL_SERVICES")," "),r(2),c("ngIf",n.resources!==void 0&&n.resources.length!==0),r(),c("ngIf",n.selectedResource!==void 0&&n.groups!==void 0&&n.groups.length!==0),r(),c("ngIf",n.selectedGroup!==void 0&&n.members!==void 0&&n.members.length!==0)}}function Xn(i,o){if(i&1&&S(0,"perun-web-apps-service-configurator",14),i&2){let n=h();c("facility",n.facility)("resource",n.selectedResource)("group",n.selectedGroup)("member",n.selectedMember)("service",n.selectedService)}}var pn=(()=>{let o=class o{constructor(e,t,a,f,y,F,W){this.facilityManager=e,this.resourceManager=t,this.serviceManager=a,this.membersManager=f,this.namePipe=y,this.translate=F,this.entityStorageService=W,this.serviceField=new se,this.resourceField=new se,this.groupField=new se,this.memberField=new se,this.allowedStatuses=["INVALID","VALID"],this.selectedService="NOT_SELECTED",this.attrNames=[],this.translate.get("FACILITY_DETAIL.SERVICE_CONFIG.ALL").subscribe(P=>this.serviceAllTranslation=P),this.translate.get("FACILITY_DETAIL.SERVICE_CONFIG.NOT_SELECTED").subscribe(P=>this.serviceNotSelectedTranslation=P)}ngOnInit(){this.facility=this.entityStorageService.getEntity(),this.facilityManager.getFacilityById(this.facility.id).subscribe(e=>{this.facility=e,this.facilityManager.getAssignedResourcesForFacility(e.id).subscribe(t=>this.resources=t),this.serviceManager.getAssignedServices(e.id).subscribe(t=>this.services=t)}),this.filteredServices=this.serviceField.valueChanges.pipe(Te(""),be(e=>this._filterServices(e))),this.filteredResources=this.resourceField.valueChanges.pipe(Te(""),be(e=>this._filterResources(e))),this.filteredGroups=this.groupField.valueChanges.pipe(Te(""),be(e=>this._filterGroups(e))),this.filteredMembers=this.memberField.valueChanges.pipe(Te(""),be(e=>this._filterMembers(e)))}onSelectedService(e){this.selectedService=e}onSelectedResource(e){this.selectedResource=e,this.selectedResource!==void 0?(this.resourceManager.getAssignedGroups(this.selectedResource.id).subscribe(t=>this.groups=t),this.selectedGroup=void 0,this.selectedMember=void 0):this.groups=void 0}onOfferAllServices(e){e.checked||this.serviceManager.getAssignedServices(this.facility.id).subscribe(t=>this.services=t)}onSelectedGroup(e){this.selectedGroup=e,this.selectedGroup!==void 0?(this.membersManager.getCompleteRichMembersForGroup(this.selectedGroup.id,!1,this.allowedStatuses,[],this.attrNames).subscribe(t=>this.members=t),this.selectedMember=void 0):this.members=void 0}onSelectedMember(e){this.selectedMember=e}serviceDisplayFn(e){if(e!==null)return e==="ALL"?this.serviceAllTranslation:e==="NOT_SELECTED"?this.serviceNotSelectedTranslation:typeof e!="string"?e.name:e}resourceDisplayFn(e){if(e!==null)return e.name}groupDisplayFn(e){if(e!==null)return e.name}memberDisplayFn(e){if(e!==null)return this.namePipe.transform(e.user)}updatedSerVal(e){e.target.value===""&&(this.selectedService="NOT_SELECTED")}updatedResVal(e){e.target.value===""&&(this.groups=void 0,this.members=void 0)}updatedGroupVal(e){e.target.value===""&&(this.members=void 0)}_filterServices(e){let t=e.toString().toLowerCase();return this.services.filter(a=>a.name.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").includes(t))}_filterResources(e){let t=e.toString().toLowerCase();return this.resources.filter(a=>a.name.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").includes(t))}_filterGroups(e){let t=e.toString().toLowerCase();return this.groups.filter(a=>a.name.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").includes(t))}_filterMembers(e){let t=e.toString().toLowerCase();return this.members.filter(a=>this.namePipe.transform(a.user).toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").includes(t))}};o.\u0275fac=function(t){return new(t||o)(u(L),u(Re),u(ae),u(It),u(ee),u(re),u(R))},o.\u0275cmp=E({type:o,selectors:[["app-facility-service-config"]],decls:6,vars:5,consts:[[1,"page-subtitle"],["class","col-12 col-lg-6 mb-2",4,"ngIf"],[3,"facility","resource","group","member","service",4,"ngIf"],[1,"col-12","col-lg-6","mb-2"],["class","w-100",4,"ngIf"],[3,"change"],[1,"w-100"],["matInput","","type","text",3,"formControl","matAutocomplete","keyup"],["autoActiveFirstOption","",3,"displayWith"],["auto","matAutocomplete"],[3,"value","onSelectionChange"],[3,"value","onSelectionChange",4,"ngFor","ngForOf"],["autoActiveFirstOption","",3,"displayWith","ngClass"],["matInput","","type","text",3,"matAutocomplete","formControl"],[3,"facility","resource","group","member","service"]],template:function(t,a){t&1&&(l(0,"div")(1,"h1",0),d(2),p(3,"translate"),s(),v(4,$n,8,7,"div",1)(5,Xn,1,5,"perun-web-apps-service-configurator",2),s()),t&2&&(r(2),T(m(3,3,"FACILITY_DETAIL.SERVICE_CONFIG.TITLE")),r(2),c("ngIf",!!a.facility),r(),c("ngIf",!!a.facility))},dependencies:[ut,ft,x,bi,Tt,Ti,kt,Nt,Ot,At,Ft,xt,Rt,gt,A,ee]});let i=o;return i})();var We=(()=>{let o=class o{constructor(e,t,a){this.facilityService=e,this.guiAuthResolver=t,this.entityStorageService=a,this.disableRouting=!1,this.disableSelf=!1,this.availableRoles=[],this.selected="user",this.type="Facility",this.theme="facility-theme"}ngOnInit(){this.facility=this.entityStorageService.getEntity(),this.guiAuthResolver.assignAvailableRoles(this.availableRoles,"Facility")}};o.\u0275fac=function(t){return new(t||o)(u(L),u(M),u(R))},o.\u0275cmp=E({type:o,selectors:[["app-perun-web-apps-facility-settings-managers"]],hostVars:2,hostBindings:function(t,a){t&2&&k("router-component",a.true)},inputs:{disableRouting:"disableRouting",disableSelf:"disableSelf"},decls:1,vars:6,consts:[[3,"complementaryObject","availableRoles","complementaryObjectType","disableSelf","disableRouting","theme"]],template:function(t,a){t&1&&S(0,"app-managers-page",0),t&2&&c("complementaryObject",a.facility)("availableRoles",a.availableRoles)("complementaryObjectType",a.type)("disableSelf",a.disableSelf)("disableRouting",a.disableRouting)("theme",a.theme)},dependencies:[Be]});let i=o;return i})();function Zn(i,o){i&1&&(l(0,"perun-web-apps-alert",10),d(1),p(2,"translate"),s()),i&2&&(r(),_(" ",m(2,1,"FACILITY_DETAIL.SERVICES_DESTINATIONS.DESTINATIONS_INFO")," "))}function ea(i,o){if(i&1){let n=b();l(0,"button",11),g("click",function(){I(n);let t=h();return C(t.addDestination())}),d(1),p(2,"translate"),s()}i&2&&(r(),_(" ",m(2,1,"FACILITY_DETAIL.SERVICES_DESTINATIONS.ADD")," "))}function ta(i,o){if(i&1){let n=b();l(0,"button",12),g("click",function(){I(n);let t=h();return C(t.removeDestination())}),d(1),p(2,"translate"),s()}if(i&2){let n=h();c("disabled",n.loading||n.selected.selected.length===0),r(),_(" ",m(2,2,"FACILITY_DETAIL.SERVICES_DESTINATIONS.REMOVE")," ")}}function ia(i,o){if(i&1){let n=b();l(0,"button",13),g("click",function(){I(n);let t=h();return C(t.onAllow())}),l(1,"mat-icon"),d(2," check_circle_outline "),s(),d(3),p(4,"translate"),s()}if(i&2){let n=h();c("disabled",n.loading||n.selected.selected.length===0||n.allSelectedAllowed()),r(3),_(" ",m(4,2,"FACILITY_DETAIL.SERVICES_DESTINATIONS.ALLOW")," ")}}function na(i,o){if(i&1){let n=b();l(0,"button",13),g("click",function(){I(n);let t=h();return C(t.onBlock())}),l(1,"mat-icon"),d(2," block "),s(),d(3),p(4,"translate"),s()}if(i&2){let n=h();c("disabled",n.loading||n.selected.selected.length===0||n.allSelectedBlocked()),r(3),_(" ",m(4,2,"FACILITY_DETAIL.SERVICES_DESTINATIONS.BLOCK")," ")}}function aa(i,o){i&1&&S(0,"perun-web-apps-loading-table")}function oa(i,o){if(i&1&&S(0,"app-perun-web-apps-destination-list",14),i&2){let n=h();c("filterValue",n.filterValue)("loading",n.loading)("selection",n.selected)("cachedSubject",n.cachedSubject)("destinations",n.destinations)("services",n.configServicesIds)("displayedColumns",n.displayedColumns)("tableId",n.tableId)}}var ze=(()=>{let o=class o{constructor(e,t,a,f,y,F,W){this.dialog=e,this.servicesManager=t,this.translate=a,this.notificator=f,this.authResolver=y,this.serviceManager=F,this.entityStorageService=W,this.displayedColumns=["select","destinationId","service","destination","type","status","propagationType","lastSuccessfulPropagation"],this.configServices=[],this.configServicesIds=new Set,this.title="FACILITY_DETAIL.SERVICES_DESTINATIONS.TITLE",this.destinationEmitter=new ce,this.destinations=[],this.selected=new B(!0,[],!0,(P,J)=>P.id===J.id&&P.facility?.id===J.facility?.id&&P.service?.id===J.service?.id),this.cachedSubject=new j(!0),this.filterValue="",this.tableId=ri}ngOnInit(){this.loading=!0,this.facility=this.entityStorageService.getEntity(),this.setAuthRights(),this.refreshTable()}refreshTable(){this.loading=!0,this.servicesManager.getAllRichDestinationsForFacility(this.facility.id).subscribe(e=>{this.destinations=e,this.destinationEmitter.emit(this.destinations),this.selected.clear(),this.cachedSubject.next(!0),this.setAuthRights(),this.loading=!1})}setAuthRights(){this.addAuth=this.authResolver.isAuthorized("addDestination_Service_Facility_Destination_policy",[this.facility]),this.removeAuth=this.authResolver.isAuthorized("removeDestination_Service_Facility_Destination_policy",[this.facility]),this.allowAuth=this.authResolver.isAuthorized("unblockServiceOnDestination_Service_int_policy",[this.facility]),this.blockAuth=this.authResolver.isAuthorized("blockServiceOnDestination_Service_int_policy",[this.facility]),this.displayedColumns=this.removeAuth?this.displayedColumns:this.displayedColumns.filter(e=>e!=="select")}addDestination(){let e=D();e.width="600px",e.data={facility:this.facility,theme:"facility-theme",configServices:this.configServices},this.dialog.open(Bi,e).afterClosed().subscribe(a=>{a&&(this.refreshTable(),this.notificator.showSuccess(this.translate.instant("FACILITY_DETAIL.SERVICES_DESTINATIONS.ADD_SUCCESS")))})}removeDestination(){let e=D();e.width="600px",e.data={destinations:this.selected.selected,theme:"facility-theme"},this.dialog.open(Pi,e).afterClosed().subscribe(a=>{a&&this.refreshTable()})}blockServicesOnDestinations(e){this.serviceManager.blockServicesOnDestinations({richDestinations:e}).subscribe({next:()=>{this.notificator.showSuccess(this.translate.instant("FACILITY_DETAIL.SERVICES_DESTINATIONS.BLOCK_SUCCESS")),this.refreshTable()},error:()=>this.loading=!1})}onBlock(){this.loading=!0,this.blockServicesOnDestinations(this.selected.selected)}allowServicesOnDestinations(e){this.serviceManager.unblockServicesOnDestinations({richDestinations:e}).subscribe({next:()=>{this.notificator.showSuccess(this.translate.instant("FACILITY_DETAIL.SERVICES_DESTINATIONS.ALLOW_SUCCESS")),this.refreshTable()},error:()=>this.loading=!1})}onAllow(){this.loading=!0,this.allowServicesOnDestinations(this.selected.selected)}applyFilter(e){this.filterValue=e,this.refreshTable()}allSelectedAllowed(){return this.selected.selected.reduce((e,t)=>e&&!t.blocked,!0)}allSelectedBlocked(){return this.selected.selected.reduce((e,t)=>e&&t.blocked,!0)}};o.id="FacilityServicesDestinationsComponent",o.\u0275fac=function(t){return new(t||o)(u(V),u(ae),u(Ct),u(Z),u(M),u(ae),u(R))},o.\u0275cmp=E({type:o,selectors:[["app-perun-web-apps-facility-services-destinations"]],hostVars:2,hostBindings:function(t,a){t&2&&k("router-component",a.true)},inputs:{displayedColumns:"displayedColumns",configServices:"configServices",configServicesIds:"configServicesIds",title:"title",loading:"loading"},outputs:{destinationEmitter:"destinationEmitter"},decls:15,vars:11,consts:[[1,"page-subtitle"],["alert_type","info",4,"ngIf"],[3,"refresh"],["color","accent","class","me-2 action-button","mat-flat-button","",3,"click",4,"ngIf"],["class","me-2","color","warn","mat-flat-button","",3,"disabled","click",4,"ngIf"],["class","me-2","mat-stroked-button","",3,"disabled","click",4,"ngIf"],[3,"placeholder","filter"],["spinner",""],[1,"position-relative","table-min-height"],[3,"filterValue","loading","selection","cachedSubject","destinations","services","displayedColumns","tableId",4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],["alert_type","info"],["color","accent","mat-flat-button","",1,"me-2","action-button",3,"click"],["color","warn","mat-flat-button","",1,"me-2",3,"disabled","click"],["mat-stroked-button","",1,"me-2",3,"disabled","click"],[3,"filterValue","loading","selection","cachedSubject","destinations","services","displayedColumns","tableId"]],template:function(t,a){if(t&1&&(l(0,"div")(1,"h1",0),d(2),p(3,"translate"),s(),v(4,Zn,3,3,"perun-web-apps-alert",1),l(5,"perun-web-apps-refresh-button",2),g("refresh",function(){return a.refreshTable()}),s(),v(6,ea,3,3,"button",3)(7,ta,3,4,"button",4)(8,ia,5,4,"button",5)(9,na,5,4,"button",5),l(10,"perun-web-apps-debounce-filter",6),g("filter",function(y){return a.applyFilter(y)}),s(),v(11,aa,1,0,"ng-template",null,7,G),l(13,"div",8),v(14,oa,1,8,"app-perun-web-apps-destination-list",9),s()()),t&2){let f=w(12);r(2),T(m(3,9,a.title)),r(2),c("ngIf",a.title.includes("CONFIG")),r(2),c("ngIf",a.addAuth),r(),c("ngIf",a.removeAuth),r(),c("ngIf",a.allowAuth),r(),c("ngIf",a.blockAuth),r(),c("placeholder","FACILITY_DETAIL.SERVICES_DESTINATIONS.FILTER"),r(4),c("perunWebAppsLoader",a.loading)("perunWebAppsLoaderIndicator",f)}},dependencies:[x,le,O,Ge,Le,Y,K,H,U,A]});let i=o;return i})();function la(i,o){if(i&1){let n=b();l(0,"button",8),g("click",function(){I(n);let t=h();return C(t.onCreate())}),d(1),p(2,"translate"),s()}i&2&&(r(),_(" ",m(2,1,"FACILITY_DETAIL.SETTINGS.OWNERS.ADD"),`
`))}function ca(i,o){if(i&1){let n=b();l(0,"button",9),g("click",function(){I(n);let t=h();return C(t.onRemove())}),d(1),p(2,"translate"),s()}if(i&2){let n=h();c("disabled",n.loading||n.selection.selected.length===0),r(),_(" ",m(2,2,"FACILITY_DETAIL.SETTINGS.OWNERS.DELETE"),`
`)}}function pa(i,o){i&1&&S(0,"perun-web-apps-loading-table")}function ma(i,o){if(i&1&&S(0,"perun-web-apps-owners-list",10),i&2){let n=h();c("displayedColumns",n.displayedColumns)("loading",n.loading)("filterValue",n.filterValue)("owners",n.owners)("selection",n.selection)("cachedSubject",n.cachedSubject)("tableId",n.tableId)}}var $e=(()=>{let o=class o{constructor(e,t,a,f){this.facilitiesManagerService=e,this.dialog=t,this.authResolver=a,this.entityStorageService=f,this.ownerEmitter=new ce,this.owners=[],this.selection=new B(!0,[],!0,(y,F)=>y.id===F.id),this.cachedSubject=new j(!0),this.displayedColumns=["id","name","contact","type"],this.tableId=pi}ngOnInit(){this.filterValue="",this.facility=this.entityStorageService.getEntity(),this.setAuthRights(),this.refreshTable()}refreshTable(){this.loading=!0,this.selection.clear(),this.cachedSubject.next(!0),this.facilitiesManagerService.getFacilityOwners(this.facility.id).subscribe(e=>{this.owners=e,this.ownerEmitter.emit(this.owners),this.loading=!1})}setAuthRights(){this.addAuth=this.authResolver.isAuthorized("addOwner_Facility_Owner_policy",[this.facility]),this.removeAuth=this.authResolver.isAuthorized("removeOwner_Facility_Owner_policy",[this.facility]),this.displayedColumns=this.removeAuth?["select","id","name","contact","type"]:["id","name","contact","type"]}applyFilter(e){this.filterValue=e,this.refreshTable()}onCreate(){let e=D();e.width="800px",e.data={theme:"facility-theme",facilityId:this.facility.id,forbiddenOwners:this.owners.map(a=>a.id)},this.dialog.open(Ui,e).afterClosed().subscribe(a=>{a&&this.refreshTable()})}onRemove(){let e=D();e.width="600px",e.data={theme:"facility-theme",owners:this.selection.selected,facilityId:this.facility.id},this.dialog.open(Yi,e).afterClosed().subscribe(a=>{a&&this.refreshTable()})}};o.\u0275fac=function(t){return new(t||o)(u(L),u(V),u(M),u(R))},o.\u0275cmp=E({type:o,selectors:[["app-facility-settings-owners"]],outputs:{ownerEmitter:"ownerEmitter"},decls:11,vars:8,consts:[[1,"page-subtitle"],[3,"refresh"],["class","me-2 action-button","color","accent","mat-flat-button","",3,"click",4,"ngIf"],["class","me-2","color","warn","mat-flat-button","",3,"disabled","click",4,"ngIf"],[3,"placeholder","filter"],["spinner",""],[1,"position-relative","table-min-height"],[3,"displayedColumns","loading","filterValue","owners","selection","cachedSubject","tableId",4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],["color","accent","mat-flat-button","",1,"me-2","action-button",3,"click"],["color","warn","mat-flat-button","",1,"me-2",3,"disabled","click"],[3,"displayedColumns","loading","filterValue","owners","selection","cachedSubject","tableId"]],template:function(t,a){if(t&1&&(l(0,"h1",0),d(1),p(2,"translate"),s(),l(3,"perun-web-apps-refresh-button",1),g("refresh",function(){return a.refreshTable()}),s(),v(4,la,3,3,"button",2)(5,ca,3,4,"button",3),l(6,"perun-web-apps-debounce-filter",4),g("filter",function(y){return a.applyFilter(y)}),s(),v(7,pa,1,0,"ng-template",null,5,G),l(9,"div",6),v(10,ma,1,7,"perun-web-apps-owners-list",7),s()),t&2){let f=w(8);r(),T(m(2,6,"FACILITY_DETAIL.SETTINGS.OWNERS.TITLE")),r(3),c("ngIf",a.addAuth),r(),c("ngIf",a.removeAuth),r(),c("placeholder","VO_MANAGEMENT.FILTER_PLACEHOLDER"),r(4),c("perunWebAppsLoader",a.loading)("perunWebAppsLoaderIndicator",f)}},dependencies:[x,O,Y,K,H,Ne,U,A]});let i=o;return i})();function fa(i,o){if(i&1){let n=b();l(0,"button",8),g("click",function(){I(n);let t=h();return C(t.addHost())}),d(1),p(2,"translate"),s()}i&2&&(r(),_(" ",m(2,1,"FACILITY_DETAIL.HOSTS.ADD")," "))}function ha(i,o){if(i&1){let n=b();l(0,"button",9),g("click",function(){I(n);let t=h();return C(t.removeHost())}),d(1),p(2,"translate"),s()}if(i&2){let n=h();c("disabled",n.loading||n.selected.selected.length===0),r(),_(" ",m(2,2,"FACILITY_DETAIL.HOSTS.REMOVE")," ")}}function ga(i,o){i&1&&S(0,"perun-web-apps-loading-table")}function _a(i,o){if(i&1&&S(0,"app-hosts-list",10),i&2){let n=h();c("disableRouting",!n.routeAuth||n.disableRouting)("loading",n.loading)("filterValue",n.filterValue)("hosts",n.hosts)("selection",n.selected)("cachedSubject",n.cachedSubject)("displayedColumns",n.displayedColumns)("facilityId",n.facility.id)("tableId",n.tableId)}}var Xe=(()=>{let o=class o{constructor(e,t,a,f){this.dialog=e,this.facilitiesManager=t,this.authResolver=a,this.entityStorageService=f,this.disableRouting=!1,this.hostEmitter=new ce,this.hosts=[],this.selected=new B(!0,[],!0,(y,F)=>y.id===F.id),this.cachedSubject=new j(!0),this.filterValue="",this.tableId=si,this.displayedColumns=["id","name"]}ngOnInit(){this.loading=!0,this.facility=this.entityStorageService.getEntity(),this.setAuthRights(),this.refreshTable()}refreshTable(){this.loading=!0,this.facilitiesManager.getHosts(this.facility.id).subscribe(e=>{this.hosts=e,this.hostEmitter.emit(this.hosts),this.selected.clear(),this.cachedSubject.next(!0),this.setAuthRights(),this.loading=!1})}setAuthRights(){this.addAuth=this.authResolver.isAuthorized("addHosts_Facility_List<String>_policy",[this.facility]),this.removeAuth=this.authResolver.isAuthorized("removeHosts_List<Host>_Facility_policy",[this.facility]),this.displayedColumns=this.removeAuth?["select","id","name"]:["id","name"],this.hosts.length!==0&&(this.routeAuth=this.authResolver.isAuthorized("getHostById_int_policy",[this.facility,this.hosts[0]]))}addHost(){let e=D();e.width="600px",e.data={facilityId:this.facility.id,theme:"facility-theme"},this.dialog.open(ji,e).afterClosed().subscribe(a=>{a&&this.refreshTable()})}removeHost(){let e=D();e.width="600px",e.data={facilityId:this.facility.id,theme:"facility-theme",hosts:this.selected.selected},this.dialog.open(Gi,e).afterClosed().subscribe(a=>{a&&this.refreshTable()})}applyFilter(e){this.filterValue=e,this.refreshTable()}};o.\u0275fac=function(t){return new(t||o)(u(V),u(L),u(M),u(R))},o.\u0275cmp=E({type:o,selectors:[["app-facility-hosts"]],inputs:{disableRouting:"disableRouting"},outputs:{hostEmitter:"hostEmitter"},decls:12,vars:8,consts:[[1,"page-subtitle"],[3,"refresh"],["color","accent","class","me-2 action-button","mat-flat-button","",3,"click",4,"ngIf"],["class","me-2","color","warn","mat-flat-button","",3,"disabled","click",4,"ngIf"],[3,"placeholder","filter"],["spinner",""],[1,"position-relative","table-min-height"],[3,"disableRouting","loading","filterValue","hosts","selection","cachedSubject","displayedColumns","facilityId","tableId",4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],["color","accent","mat-flat-button","",1,"me-2","action-button",3,"click"],["color","warn","mat-flat-button","",1,"me-2",3,"disabled","click"],[3,"disableRouting","loading","filterValue","hosts","selection","cachedSubject","displayedColumns","facilityId","tableId"]],template:function(t,a){if(t&1&&(l(0,"div")(1,"h1",0),d(2),p(3,"translate"),s(),l(4,"perun-web-apps-refresh-button",1),g("refresh",function(){return a.refreshTable()}),s(),v(5,fa,3,3,"button",2)(6,ha,3,4,"button",3),l(7,"perun-web-apps-debounce-filter",4),g("filter",function(y){return a.applyFilter(y)}),s(),v(8,ga,1,0,"ng-template",null,5,G),l(10,"div",6),v(11,_a,1,9,"app-hosts-list",7),s()()),t&2){let f=w(9);r(2),T(m(3,6,"FACILITY_DETAIL.HOSTS.TITLE")),r(3),c("ngIf",a.addAuth),r(),c("ngIf",a.removeAuth),r(),c("placeholder","FACILITY_DETAIL.HOSTS.FILTER"),r(4),c("perunWebAppsLoader",a.loading)("perunWebAppsLoaderIndicator",f)}},dependencies:[x,O,Ue,Y,K,H,U,A]});let i=o;return i})();var mn=(()=>{let o=class o{constructor(e,t){this.facilityManager=e,this.route=t,this.host={beanName:"",id:0}}ngOnInit(){this.route.params.subscribe(e=>{this.hostId=Number(e.hostId),this.facilityManager.getHostById(this.hostId).subscribe(t=>{this.host=t})})}};o.\u0275fac=function(t){return new(t||o)(u(L),u(de))},o.\u0275cmp=E({type:o,selectors:[["app-facility-hosts-detail"]],decls:5,vars:6,consts:[[1,"page-subtitle"],[3,"entityId","entity"]],template:function(t,a){t&1&&(l(0,"div")(1,"h1",0),d(2),p(3,"translate"),s(),S(4,"app-one-entity-attribute-page",1),s()),t&2&&(r(2),oe(" ",m(3,4,"FACILITY_DETAIL.HOSTS.HOSTS_DETAIL.TITLE")," ",a.host.hostname," "),r(2),c("entityId",a.hostId)("entity","host"))},dependencies:[Pe,A]});let i=o;return i})();function Sa(i,o){if(i&1){let n=b();l(0,"button",12),g("click",function(){I(n);let t=h();return C(t.forcePropagation())}),d(1),p(2,"translate"),s()}if(i&2){let n=h();c("disabled",n.selected.selected.length===0||n.disableForcePropagationButton||n.loading),r(),_(" ",m(2,2,"FACILITY_DETAIL.SERVICES_STATUS.FORCE_PROPAGATION")," ")}}function Ia(i,o){if(i&1){let n=b();l(0,"button",12),g("click",function(){I(n);let t=h();return C(t.allow())}),d(1),p(2,"translate"),s()}if(i&2){let n=h();c("disabled",n.selected.selected.length===0||n.disableAllowButton||n.loading),r(),_(" ",m(2,2,"FACILITY_DETAIL.SERVICES_STATUS.ALLOW")," ")}}function Ca(i,o){if(i&1){let n=b();l(0,"button",13),g("click",function(){I(n);let t=h();return C(t.block())}),d(1),p(2,"translate"),s()}if(i&2){let n=h();c("disabled",n.selected.selected.length===0||n.disableBlockButton||n.loading),r(),_(" ",m(2,2,"FACILITY_DETAIL.SERVICES_STATUS.BLOCK")," ")}}function ya(i,o){if(i&1&&(l(0,"button",14),p(1,"translate"),d(2),p(3,"translate"),s()),i&2){let n=h(),e=w(10);me("matTooltip",m(1,5,"DIALOGS.REMOVE_SERVICE_FROM_FACILITY.CHECKBOXES_DISABLED")),c("disabled",n.selected.selected.length===0||n.disableRemoveButton||n.loading)("matMenuTriggerFor",e)("matTooltipDisabled",!n.disableRemoveButton),r(2),_(" ",m(3,7,"FACILITY_DETAIL.SERVICES_STATUS.REMOVE")," ")}}function ba(i,o){if(i&1){let n=b();l(0,"button",7),g("click",function(){I(n);let t=h();return C(t.removeTaskResults())}),d(1),p(2,"translate"),s()}i&2&&(r(),_(" ",m(2,1,"FACILITY_DETAIL.SERVICES_STATUS.REMOVE_TASK_RESULTS")," "))}function Ta(i,o){i&1&&S(0,"perun-web-apps-loading-table")}function Ea(i,o){if(i&1){let n=b();l(0,"perun-web-apps-services-status-list",15),g("selectionChange",function(){I(n);let t=h();return C(t.selectionChanged())}),s()}if(i&2){let n=h();c("disableRouting",!n.routeAuth)("loading",n.loading)("filterValue",n.filterValue)("servicesStatus",n.servicesStates)("selection",n.selected)("cachedSubject",n.cachedSubject)("tableId",n.tableId)}}var dn=(()=>{let o=class o{constructor(e,t,a,f,y,F,W,P,J){this.tasksManager=e,this.servicesManager=t,this.notificator=a,this.translate=f,this.authResolver=y,this.facilityManager=F,this.resourcesManager=W,this.dialog=P,this.entityStorageService=J,this.servicesStates=[],this.selected=new B(!0,[],!0,(qe,ne)=>qe.service.id===ne.service.id),this.cachedSubject=new j(!0),this.filterValue="",this.tableId=li,this.disableAllowButton=!0,this.disableBlockButton=!0,this.disableRemoveButton=!0,this.disableForcePropagationButton=!1}ngOnInit(){this.loading=!0,this.facility=this.entityStorageService.getEntity(),this.setAuthRights(),this.refreshTable()}forcePropagation(){let e=this.selected.selected.map(t=>t.service.id);this.servicesManager.forceServicePropagationBulk(e,this.facility.id).subscribe({next:()=>{this.notificator.showInstantSuccess("FACILITY_DETAIL.SERVICES_STATUS.SUCCESS_FORCE_PROPAGATION"),this.loading=!1,this.refreshTable()},error:()=>{this.loading=!1}})}allow(){let e=this.selected.selected.map(t=>t.service.id);this.servicesManager.unblockServicesOnFacility(e,this.facility.id).subscribe({next:()=>{this.notificator.showInstantSuccess("FACILITY_DETAIL.SERVICES_STATUS.SUCCESS_ALLOW"),this.refreshTable()},error:()=>{this.loading=!1}})}block(){let e=this.selected.selected.map(t=>t.service.id);this.servicesManager.blockServicesOnFacility(e,this.facility.id).subscribe({next:()=>{this.notificator.showInstantSuccess("FACILITY_DETAIL.SERVICES_STATUS.SUCCESS_BLOCK"),this.refreshTable()},error:()=>{this.loading=!1}})}removeTaskResults(){this.loading=!0,this.tasksManager.getTaskResultsForGUIByTask(this.selected.selected[0].task.id).subscribe(e=>{let t=D();t.width="600px",t.data={theme:"facility-theme",taskResults:e},this.loading=!1,this.dialog.open(Ye,t)})}removeServiceFromFacility(){this.loading=!0,this.facilityManager.getAssignedResourcesByAssignedServiceForFacility(this.selected.selected[0].facility.id,this.selected.selected[0].service.id).subscribe({next:e=>{let t=D();t.width="600px",this.taskId=this.taskIsNull?null:this.selected.selected[0].task.id,e.length===0?(t.data={theme:"facility-theme",taskId:this.taskId},this.loading=!1,this.dialog.open(zi,t).afterClosed().subscribe(f=>{f&&(this.disableRemoveButton=!0,this.refreshTable())})):this.resourcesManager.getRichResourcesByIds(e.map(a=>a.id)).subscribe(a=>{t.data={theme:"facility-theme",taskId:this.taskId,serviceId:this.selected.selected[0].service.id,facilityId:this.selected.selected[0].facility.id,resource:a},this.loading=!1,this.dialog.open(Wi,t).afterClosed().subscribe(y=>{y&&(this.disableRemoveButton=!0,this.refreshTable())})})},error:()=>this.loading=!1})}refreshTable(){this.loading=!0,this.tasksManager.getFacilityServicesState(this.facility.id).subscribe(e=>{this.servicesStates=e,this.selected.clear(),this.cachedSubject.next(!0),this.setAuthRights(),this.loading=!1})}setAuthRights(){this.propagationAuth=this.authResolver.isAuthorized("forceServicePropagation_Facility_Service_policy",[this.facility]),this.blockAuth=this.authResolver.isAuthorized("blockServiceOnFacility_Service_Facility_policy",[this.facility]),this.allowAuth=this.authResolver.isAuthorized("unblockServiceOnFacility_Service_Facility_policy",[this.facility]),this.deleteAuth=this.authResolver.isAuthorized("deleteTask_Task_policy",[this.facility]),this.routeAuth=this.authResolver.isAuthorized("getTaskResultsByTask_int_policy",[this.facility])}applyFilter(e){this.filterValue=e,this.refreshTable()}selectionChanged(){this.disableBlockButton=!1,this.disableAllowButton=!1,this.disableRemoveButton=this.selected.selected.length!==1,this.disableForcePropagationButton=!1,this.disableRemoveButton||(this.taskIsNull=this.selected.selected[0].task===null);for(let e of this.selected.selected)e.blockedOnFacility?(this.disableBlockButton=!0,this.disableForcePropagationButton=!0):this.disableAllowButton=!0}};o.\u0275fac=function(t){return new(t||o)(u(we),u(ae),u(Z),u(re),u(M),u(L),u(Re),u(V),u(R))},o.\u0275cmp=E({type:o,selectors:[["app-facility-service-status"]],decls:20,vars:14,consts:[[1,"page-subtitle"],[3,"refresh"],["class","me-2","color","accent","mat-flat-button","",3,"disabled","click",4,"ngIf"],["class","me-2","color","warn","mat-flat-button","",3,"disabled","click",4,"ngIf"],["mat-flat-button","","class","me-2 dropdown-toggle","color","warn",3,"disabled","matMenuTriggerFor","matTooltipDisabled","matTooltip",4,"ngIf"],["menu","matMenu"],["mat-menu-item","",3,"click",4,"ngIf"],["mat-menu-item","",3,"click"],[3,"placeholder","filter"],["spinner",""],[1,"position-relative","table-min-height"],[3,"disableRouting","loading","filterValue","servicesStatus","selection","cachedSubject","tableId","selectionChange",4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],["color","accent","mat-flat-button","",1,"me-2",3,"disabled","click"],["color","warn","mat-flat-button","",1,"me-2",3,"disabled","click"],["mat-flat-button","","color","warn",1,"me-2","dropdown-toggle",3,"disabled","matMenuTriggerFor","matTooltipDisabled","matTooltip"],[3,"disableRouting","loading","filterValue","servicesStatus","selection","cachedSubject","tableId","selectionChange"]],template:function(t,a){if(t&1&&(l(0,"div")(1,"h1",0),d(2),p(3,"translate"),s(),l(4,"perun-web-apps-refresh-button",1),g("refresh",function(){return a.refreshTable()}),s(),v(5,Sa,3,4,"button",2)(6,Ia,3,4,"button",2)(7,Ca,3,4,"button",3)(8,ya,4,9,"button",4),l(9,"mat-menu",null,5),v(11,ba,3,3,"button",6),l(12,"button",7),g("click",function(){return a.removeServiceFromFacility()}),d(13),p(14,"translate"),s()(),l(15,"perun-web-apps-debounce-filter",8),g("filter",function(y){return a.applyFilter(y)}),s(),v(16,Ta,1,0,"ng-template",null,9,G),l(18,"div",10),v(19,Ea,1,7,"perun-web-apps-services-status-list",11),s()()),t&2){let f=w(17);r(2),T(m(3,10,"FACILITY_DETAIL.SERVICES_STATUS.TITLE")),r(3),c("ngIf",a.propagationAuth),r(),c("ngIf",a.allowAuth),r(),c("ngIf",a.blockAuth),r(),c("ngIf",a.deleteAuth),r(3),c("ngIf",!a.taskIsNull),r(2),_(" ",m(14,12,"FACILITY_DETAIL.SERVICES_STATUS.REMOVE_SERVICE_FROM_FACILITY")," "),r(2),c("placeholder","SHARED_LIB.PERUN.COMPONENTS.SERVICES_STATUS_LIST.TABLE_SEARCH"),r(4),c("perunWebAppsLoader",a.loading)("perunWebAppsLoaderIndicator",f)}},dependencies:[x,O,De,Ut,Gt,Yt,Y,K,ui,H,U,A]});let i=o;return i})();function Aa(i,o){if(i&1){let n=b();l(0,"button",8),g("click",function(){I(n);let t=h();return C(t.removeTaskResult())}),d(1),p(2,"translate"),s()}if(i&2){let n=h();c("disabled",n.loading||n.selection.selected.length===0),r(),_(" ",m(2,2,"FACILITY_DETAIL.TASK_RESULTS.REMOVE"),`
`)}}function Fa(i,o){i&1&&S(0,"perun-web-apps-loading-table")}function xa(i,o){if(i&1&&S(0,"perun-web-apps-task-results-list",9),i&2){let n=h();c("tableId",n.tableId)("loading",n.loading)("displayedColumns",n.displayedColumns)("filterValue",n.filterValue)("selection",n.selection)("cachedSubject",n.cachedSubject)("taskResults",n.taskResults)}}var un=(()=>{let o=class o{constructor(e,t,a,f,y){this.route=e,this.taskManager=t,this.authResolver=a,this.dialog=f,this.entityStorageService=y,this.loading=!1,this.filterValue="",this.selection=new B(!0,[],!0,(F,W)=>F.id===W.id),this.task={id:0},this.taskResults=[],this.cachedSubject=new j(!0),this.tableId=ci,this.displayedColumns=["select","id","destination","type","service","status","time","returnCode","standardMessage","errorMessage"],this.removeAuth=!1}ngOnInit(){this.loading=!0,this.facility=this.entityStorageService.getEntity(),this.removeAuth=this.authResolver.isAuthorized("deleteTask_Task_policy",[this.facility]),this.removeAuth||(this.displayedColumns=["id","destination","type","service","status","time","returnCode","standardMessage","errorMessage"]),this.route.params.subscribe(e=>{this.taskId=Number(e.taskId),this.taskManager.getTaskById(this.taskId).subscribe(t=>{this.task=t,this.refreshTable()})})}refreshTable(){this.loading=!0,this.taskManager.getTaskResultsForGUIByTask(this.taskId).subscribe(e=>{this.selection.clear(),this.cachedSubject.next(!0),this.taskResults=e,this.loading=!1})}removeTaskResult(){let e=D();e.width="600px",e.data={theme:"facility-theme",taskResults:this.selection.selected},this.dialog.open(Ye,e).afterClosed().subscribe(a=>{a&&this.refreshTable()})}applyFilter(e){this.filterValue=e,this.refreshTable()}};o.\u0275fac=function(t){return new(t||o)(u(de),u(we),u(M),u(V),u(R))},o.\u0275cmp=E({type:o,selectors:[["app-facility-task-results"]],decls:12,vars:9,consts:[[1,"page-subtitle"],[1,"text-muted"],[3,"refresh"],["class","me-2","color","warn","mat-flat-button","",3,"disabled","click",4,"ngIf"],[3,"placeholder","filter"],["spinner",""],[1,"position-relative","table-min-height"],[3,"tableId","loading","displayedColumns","filterValue","selection","cachedSubject","taskResults",4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],["color","warn","mat-flat-button","",1,"me-2",3,"disabled","click"],[3,"tableId","loading","displayedColumns","filterValue","selection","cachedSubject","taskResults"]],template:function(t,a){if(t&1&&(l(0,"h1",0),d(1),p(2,"translate"),l(3,"span",1),d(4),s()(),l(5,"perun-web-apps-refresh-button",2),g("refresh",function(){return a.refreshTable()}),s(),v(6,Aa,3,4,"button",3),l(7,"perun-web-apps-debounce-filter",4),g("filter",function(y){return a.applyFilter(y)}),s(),v(8,Fa,1,0,"ng-template",null,5,G),l(10,"div",6),v(11,xa,1,7,"perun-web-apps-task-results-list",7),s()),t&2){let f=w(9);r(),oe(" ",m(2,7,"FACILITY_DETAIL.TASK_RESULTS.TITLE")," - ",a.task.service?a.task.service.name:""," "),r(3),_(" \xA0#",a.task.id," "),r(2),c("ngIf",a.removeAuth),r(),c("placeholder","FACILITY_DETAIL.TASK_RESULTS.FILTER"),r(4),c("perunWebAppsLoader",a.loading)("perunWebAppsLoaderIndicator",f)}},dependencies:[x,O,Y,K,fi,H,U,A]});let i=o;return i})();var fn=(()=>{let o=class o{constructor(e,t){this.dialogRef=e,this.data=t,this.theme=""}ngOnInit(){this.theme=this.data.theme}onCancel(){this.dialogRef.close(!1)}onSkip(){this.dialogRef.close(!0)}};o.\u0275fac=function(t){return new(t||o)(u(fe),u(he))},o.\u0275cmp=E({type:o,selectors:[["app-no-service-dialog"]],decls:14,vars:15,consts:[["mat-dialog-title",""],["mat-dialog-content",""],["matDialogActions",""],["mat-stroked-button","",1,"ms-auto","me-2",3,"click"],["color","accent","mat-flat-button","",3,"click"]],template:function(t,a){t&1&&(l(0,"div")(1,"h1",0),d(2),p(3,"translate"),s(),l(4,"div",1),d(5),p(6,"translate"),s(),l(7,"div",2)(8,"button",3),g("click",function(){return a.onCancel()}),d(9),p(10,"translate"),s(),l(11,"button",4),g("click",function(){return a.onSkip()}),d(12),p(13,"translate"),s()()()),t&2&&(pe(a.theme),r(2),T(m(3,7,"DIALOGS.NO_SERVICE.TITLE")),r(3),_(" ",m(6,9,"DIALOGS.NO_SERVICE.INFO")," "),r(4),_(" ",m(10,11,"DIALOGS.NO_SERVICE.CANCEL")," "),r(3),_(" ",m(13,13,"DIALOGS.NO_SERVICE.SKIP")," "))},dependencies:[O,ge,ve,_e,A]});let i=o;return i})();var hn=(()=>{let o=class o{constructor(e,t){this.dialogRef=e,this.data=t,this.theme=""}ngOnInit(){this.theme=this.data.theme}onCancel(){this.dialogRef.close(!1)}onSkip(){this.dialogRef.close(!0)}};o.\u0275fac=function(t){return new(t||o)(u(fe),u(he))},o.\u0275cmp=E({type:o,selectors:[["app-config-unsaved-dialog"]],decls:14,vars:15,consts:[["mat-dialog-title",""],["mat-dialog-content",""],["matDialogActions",""],["mat-stroked-button","",1,"ms-auto","me-2",3,"click"],["color","accent","mat-flat-button","",3,"click"]],template:function(t,a){t&1&&(l(0,"div")(1,"h1",0),d(2),p(3,"translate"),s(),l(4,"div",1),d(5),p(6,"translate"),s(),l(7,"div",2)(8,"button",3),g("click",function(){return a.onCancel()}),d(9),p(10,"translate"),s(),l(11,"button",4),g("click",function(){return a.onSkip()}),d(12),p(13,"translate"),s()()()),t&2&&(pe(a.theme),r(2),T(m(3,7,"DIALOGS.CONFIG_UNSAVED.TITLE")),r(3),_(" ",m(6,9,"DIALOGS.CONFIG_UNSAVED.INFO")," "),r(4),_(" ",m(10,11,"DIALOGS.CONFIG_UNSAVED.CANCEL")," "),r(3),_(" ",m(13,13,"DIALOGS.CONFIG_UNSAVED.SKIP")," "))},dependencies:[O,ge,ve,_e,A]});let i=o;return i})();function Ra(i,o){if(i&1&&(l(0,"div",3),S(1,"i",4),p(2,"translate"),s()),i&2){let n=h();r(),c("innerHTML",m(2,1,n.info),xe)}}function wa(i,o){if(i&1){let n=b();l(0,"button",10),g("click",function(){I(n);let t=h(2);return C(t.onKeep())}),d(1),p(2,"translate"),s()}i&2&&(r(),_(" ",m(2,1,"DIALOGS.CANCEL_CONFIG.KEEP")," "))}function Da(i,o){if(i&1){let n=b();l(0,"div",5)(1,"button",6),g("click",function(){I(n);let t=h();return C(t.onCancel())}),d(2),p(3,"translate"),s(),l(4,"button",7),g("click",function(){I(n);let t=h();return C(t.onDelete())}),l(5,"mat-icon",8),d(6," warning "),s(),d(7),p(8,"translate"),s(),v(9,wa,3,3,"button",9),s()}if(i&2){let n=h();r(2),_(" ",m(3,3,"DIALOGS.CANCEL_CONFIG.CANCEL")," "),r(5),_(" ",m(8,5,"DIALOGS.CANCEL_CONFIG.DELETE")," "),r(2),c("ngIf",!n.lastStep)}}var gn=(()=>{let o=class o{constructor(e,t,a,f,y){this.dialogRef=e,this.data=t,this.facilityService=a,this.notificator=f,this.translate=y,this.theme="",this.title="",this.info="",this.loading=!1}ngOnInit(){this.theme=this.data.theme,this.lastStep=this.data.lastStep,this.lastStep?(this.title="DIALOGS.CANCEL_CONFIG.TITLE_COMPLETE",this.info="DIALOGS.CANCEL_CONFIG.INFO_COMPLETE"):(this.title="DIALOGS.CANCEL_CONFIG.TITLE_INCOMPLETE",this.info="DIALOGS.CANCEL_CONFIG.INFO_INCOMPLETE")}onCancel(){this.dialogRef.close(!1)}onDelete(){this.loading=!0,this.facilityService.deleteFacility(this.data.facilityId,!0).subscribe(()=>{this.notificator.showSuccess(this.translate.instant("DIALOGS.CANCEL_CONFIG.SUCCESS")),this.dialogRef.close(!0),this.loading=!1},()=>this.loading=!1)}onKeep(){this.dialogRef.close(!0)}};o.\u0275fac=function(t){return new(t||o)(u(fe),u(he),u(L),u(Z),u(re))},o.\u0275cmp=E({type:o,selectors:[["app-cancel-configuration-dialog"]],decls:6,vars:8,consts:[["mat-dialog-title",""],["mat-dialog-content","",4,"ngIf"],["matDialogActions","",4,"ngIf"],["mat-dialog-content",""],[3,"innerHTML"],["matDialogActions",""],["mat-stroked-button","",1,"me-2",3,"click"],["color","warn","mat-flat-button","",1,"ms-auto","me-2",3,"click"],["iconPositionEnd",""],["color","accent","mat-flat-button","",3,"click",4,"ngIf"],["color","accent","mat-flat-button","",3,"click"]],template:function(t,a){t&1&&(l(0,"div")(1,"h1",0),d(2),p(3,"translate"),s(),v(4,Ra,3,3,"div",1)(5,Da,10,7,"div",2),s()),t&2&&(pe(a.theme),r(2),T(m(3,6,a.title)),r(2),c("ngIf",!a.loading),r(),c("ngIf",!a.loading))},dependencies:[x,le,O,ge,ve,_e,A]});let i=o;return i})();var La=["stepper"];function Ma(i,o){i&1&&S(0,"perun-web-apps-loading-table")}function Oa(i,o){i&1&&(d(0),p(1,"translate")),i&2&&T(m(1,1,"FACILITY_CONFIGURATION.OWNERS"))}function Na(i,o){if(i&1){let n=b();l(0,"app-facility-settings-owners",15),g("ownerEmitter",function(t){I(n);let a=h();return C(a.owners=t)}),s()}}function ka(i,o){i&1&&(d(0),p(1,"translate")),i&2&&T(m(1,1,"FACILITY_CONFIGURATION.HOSTS"))}function Va(i,o){if(i&1){let n=b();l(0,"app-facility-hosts",16),g("hostEmitter",function(t){I(n);let a=h();return C(a.hosts=t)}),s()}i&2&&c("disableRouting",!0)}function Pa(i,o){i&1&&(d(0),p(1,"translate")),i&2&&T(m(1,1,"FACILITY_CONFIGURATION.SERVICES"))}var Ba=()=>["select","id","name","enabled","description"];function ja(i,o){if(i&1){let n=b();l(0,"h1",17),d(1),p(2,"translate"),s(),l(3,"perun-web-apps-alert",18),d(4),p(5,"translate"),s(),l(6,"div",19)(7,"perun-web-apps-debounce-filter",20),g("filter",function(t){I(n);let a=h();return C(a.applyFilter(t))}),s(),l(8,"perun-web-apps-service-package-search-select",21),g("packageSelected",function(t){I(n);let a=h();return C(a.packagesSelected(t))}),s()(),l(9,"app-services-list",22),g("selectionChanged",function(){I(n);let t=h();return C(t.singleServiceSelected())}),s()}if(i&2){let n=h();r(),T(m(2,15,"FACILITY_CONFIGURATION.SERVICES")),r(3),_(" ",m(5,17,"FACILITY_CONFIGURATION.SERVICES_INFO")," "),r(3),c("placeholder","FACILITY_CONFIGURATION.SERVICES_FILTER"),r(),c("disableAutoSelect",!0)("selectedPackage",n.selectedPackages)("multiple",!0)("servicePackages",n.servicePackages)("theme","facility-theme"),r(),c("loading",n.processing)("disableRouting",!0)("displayedColumns",q(19,Ba))("selection",n.selection)("cachedSubject",n.cachedSubject)("filterValue",n.filterValue)("services",n.services)}}function Ga(i,o){i&1&&(d(0),p(1,"translate")),i&2&&T(m(1,1,"FACILITY_CONFIGURATION.SERVICE_CONFIG"))}function Ua(i,o){if(i&1){let n=b();l(0,"perun-web-apps-service-search-select",28),g("serviceSelected",function(t){I(n);let a=h(2);return C(a.filterAttributes(t))}),s()}if(i&2){let n=h(2);c("disableAutoSelect",!0)("services",n.selection.selected)("multiple",!0)("theme","facility-theme")}}function Ya(i,o){if(i&1&&S(0,"perun-web-apps-attributes-list",29),i&2){let n=h(2);c("loading",n.processing)("emptyListText","FACILITY_CONFIGURATION.EMPTY_REQ_ATT")("attributes",n.filteredAttributes)("selection",n.attSelection)("cachedSubject",n.cachedSubject)}}function Ha(i,o){if(i&1){let n=b();l(0,"h1",17),d(1),p(2,"translate"),s(),l(3,"perun-web-apps-alert",18),d(4),p(5,"translate"),s(),l(6,"div",19)(7,"button",23),g("click",function(){I(n);let t=h();return C(t.onRemoveAttributes())}),d(8),p(9,"translate"),s(),l(10,"button",24),g("click",function(){I(n);let t=h();return C(t.onSaveAttributes())}),d(11),p(12,"translate"),s(),v(13,Ua,1,4,"perun-web-apps-service-search-select",25),s(),l(14,"div",26),v(15,Ya,1,5,"perun-web-apps-attributes-list",27),s()}if(i&2){let n=h(),e=w(5),t=w(7);r(),T(m(2,9,"FACILITY_CONFIGURATION.SERVICE_CONFIG")),r(3),_(" ",m(5,11,"FACILITY_CONFIGURATION.ATT_INFO")," "),r(3),c("disabled",n.processing||n.attSelection.selected.length===0),r(),_(" ",m(9,13,"FACILITY_CONFIGURATION.REMOVE")," "),r(2),c("disabled",n.processing||n.attSelection.selected.length===0),r(),_(" ",m(12,15,"FACILITY_CONFIGURATION.SAVE")," "),r(2),c("ngIf",e.selectedIndex===n.ATTRIBUTES_IDX),r(2),c("perunWebAppsLoader",n.processing)("perunWebAppsLoaderIndicator",t)}}function Wa(i,o){i&1&&(d(0),p(1,"translate")),i&2&&T(m(1,1,"FACILITY_CONFIGURATION.DESTINATION_CONFIG"))}var za=()=>["select","destinationId","service","warn","destination","type","propagationType"];function $a(i,o){if(i&1){let n=b();l(0,"app-perun-web-apps-facility-services-destinations",30),g("destinationEmitter",function(t){I(n);let a=h();return C(a.destinations=t)}),s()}if(i&2){let n=h();c("configServicesIds",n.serviceIds)("displayedColumns",q(5,za))("configServices",n.selection.selected)("loading",n.processing)("title","FACILITY_CONFIGURATION.DESTINATION_CONFIG")}}function Xa(i,o){i&1&&(d(0),p(1,"translate")),i&2&&T(m(1,1,"FACILITY_CONFIGURATION.MANAGERS"))}function qa(i,o){i&1&&S(0,"app-perun-web-apps-facility-settings-managers",31),i&2&&c("disableRouting",!0)("disableSelf",!0)}function Ka(i,o){i&1&&(d(0),p(1,"translate")),i&2&&T(m(1,1,"FACILITY_CONFIGURATION.SUMMARY"))}var Qa=()=>["id","name","contact","type"];function Ja(i,o){if(i&1&&S(0,"perun-web-apps-owners-list",48),i&2){let n=h(3);c("loading",n.processing)("displayedColumns",q(3,Qa))("owners",n.owners)}}var Za=()=>["id","name"];function eo(i,o){if(i&1&&S(0,"app-hosts-list",49),i&2){let n=h(3);c("loading",n.processing)("disableRouting",!0)("displayedColumns",q(4,Za))("hosts",n.hosts)}}var to=()=>["destinationId","service","warn","destination","type","propagationType"];function io(i,o){if(i&1&&S(0,"app-perun-web-apps-destination-list",50),i&2){let n=h(3);c("loading",n.processing)("destinations",n.destinations)("displayedColumns",q(4,to))("services",n.serviceIds)}}var no=()=>["id","name","enabled","script","description"],ao=()=>["id","displayName","value","description"],oo=()=>["id","vo","name","description"],ro=()=>["id","name","email","logins","organization"];function so(i,o){if(i&1){let n=b();l(0,"mat-accordion")(1,"mat-expansion-panel",34)(2,"mat-expansion-panel-header")(3,"mat-panel-title"),S(4,"mat-icon",35),d(5),p(6,"translate"),s()(),l(7,"h1",17),d(8),p(9,"translate"),s(),l(10,"div",26),v(11,Ja,1,4,"perun-web-apps-owners-list",36),s()(),l(12,"mat-expansion-panel",34)(13,"mat-expansion-panel-header")(14,"mat-panel-title"),S(15,"mat-icon",37),d(16),p(17,"translate"),s()(),l(18,"h1",17),d(19),p(20,"translate"),s(),l(21,"div",26),v(22,eo,1,5,"app-hosts-list",38),s()(),l(23,"mat-expansion-panel",34)(24,"mat-expansion-panel-header")(25,"mat-panel-title"),S(26,"mat-icon",39),d(27),p(28,"translate"),s()(),l(29,"h1",17),d(30),p(31,"translate"),s(),S(32,"app-services-list",40),s(),l(33,"mat-expansion-panel",41),g("opened",function(){I(n);let t=h(2);return C(t.getNonEmptyAttributes())}),l(34,"mat-expansion-panel-header")(35,"mat-panel-title"),S(36,"mat-icon",37),d(37),p(38,"translate"),s()(),l(39,"h1",17),d(40),p(41,"translate"),s(),S(42,"perun-web-apps-attributes-list",42),s(),l(43,"mat-expansion-panel",43),g("expandedChange",function(t){I(n);let a=h(2);return C(a.destinationServiceMissing=t)}),l(44,"mat-expansion-panel-header")(45,"mat-panel-title"),S(46,"mat-icon",44),d(47),p(48,"translate"),s()(),l(49,"h1",17),d(50),p(51,"translate"),s(),l(52,"div",26),v(53,io,1,5,"app-perun-web-apps-destination-list",45),s()(),l(54,"mat-expansion-panel")(55,"mat-expansion-panel-header")(56,"mat-panel-title"),S(57,"mat-icon",46),d(58),p(59,"translate"),s()(),S(60,"app-managers-page",47),s()()}if(i&2){let n=h(2),e=w(7);c("@.disabled",!0),r(),c("disabled",n.owners.length===0),r(),k("cursor-default",n.owners.length===0),r(3),_(" ",m(6,49,"FACILITY_CONFIGURATION.OWNERS")," "),r(3),T(m(9,51,"FACILITY_CONFIGURATION.OWNERS")),r(3),c("perunWebAppsLoader",n.processing)("perunWebAppsLoaderIndicator",e),r(),c("disabled",n.hosts.length===0),r(),k("cursor-default",n.hosts.length===0),r(3),_(" ",m(17,53,"FACILITY_CONFIGURATION.HOSTS")," "),r(3),T(m(20,55,"FACILITY_CONFIGURATION.HOSTS")),r(3),c("perunWebAppsLoader",n.processing)("perunWebAppsLoaderIndicator",e),r(),c("disabled",n.selection.selected.length===0),r(),k("cursor-default",n.selection.selected.length===0),r(3),_(" ",m(28,57,"FACILITY_CONFIGURATION.SERVICES")," "),r(3),T(m(31,59,"FACILITY_CONFIGURATION.SERVICES")),r(2),c("loading",n.processing)("disableRouting",!0)("displayedColumns",q(71,no))("services",n.selection.selected),r(),c("disabled",n.selection.selected.length===0),r(),k("cursor-default",n.selection.selected.length===0),r(3),_(" ",m(38,61,"FACILITY_CONFIGURATION.SERVICE_CONFIG")," "),r(3),T(m(41,63,"FACILITY_CONFIGURATION.ATTS")),r(2),c("loading",n.processing)("displayedColumns",q(72,ao))("attributes",n.filteredAttributes)("emptyListText","FACILITY_CONFIGURATION.EMPTY_REQ_ATT"),r(),c("expanded",n.destinationServiceMissing)("disabled",n.selection.selected.length===0&&n.destinations.length===0),r(),k("cursor-default",n.selection.selected.length===0&&n.destinations.length===0),r(3),_(" ",m(48,65,"FACILITY_CONFIGURATION.DESTINATION_CONFIG")," "),r(3),T(m(51,67,"FACILITY_CONFIGURATION.DESTINATION")),r(3),c("perunWebAppsLoader",n.processing)("perunWebAppsLoaderIndicator",e),r(5),_(" ",m(59,69,"FACILITY_CONFIGURATION.MANAGERS")," "),r(2),c("complementaryObject",n.facility)("configMode",!0)("disableRouting",!0)("availableRoles",n.availableRoles)("complementaryObjectType","Facility")("displayedGroupColumns",q(73,oo))("displayedUserColumns",q(74,ro))}}function lo(i,o){if(i&1&&(l(0,"perun-web-apps-alert",18),S(1,"i",32),p(2,"translate"),s(),v(3,so,61,75,"mat-accordion",33)),i&2){h();let n=w(5);r(),c("innerHTML",m(2,2,"FACILITY_CONFIGURATION.SUMMARY_INFO"),xe),r(2),c("ngIf",n.selectedIndex===n.steps.length-1)}}function co(i,o){if(i&1){let n=b();l(0,"button",51),g("click",function(){I(n);let t=h();return C(t.back())}),d(1),p(2,"translate"),s()}i&2&&(r(),_(" ",m(2,1,"FACILITY_CONFIGURATION.BACK")," "))}function po(i,o){if(i&1){let n=b();l(0,"button",52),g("click",function(){I(n);let t=h();return C(t.next())}),d(1),p(2,"translate"),s()}if(i&2){h();let n=w(5);k("me-2",n!==void 0&&n.selectedIndex!==0)("ms-auto",!(n!==void 0&&n.selectedIndex!==0)),r(),_(" ",m(2,5,"FACILITY_CONFIGURATION.NEXT")," ")}}function mo(i,o){if(i&1){let n=b();l(0,"button",53),g("click",function(){I(n);let t=h();return C(t.onFinish())}),d(1),p(2,"translate"),s()}i&2&&(r(),_(" ",m(2,1,"FACILITY_CONFIGURATION.FINISH")," "))}var _n=(()=>{let o=class o{constructor(e,t,a,f,y,F,W,P,J,qe){this.attributesManager=e,this.serviceManager=t,this.facilityService=a,this.cd=f,this.dialog=y,this.notificator=F,this.translate=W,this.router=P,this.guiAuthResolver=J,this.entityStorageService=qe,this.processing=!1,this.filteredAttributes=[],this.attSelection=new B(!0,[],!0,(ne,Ke)=>ne.id===Ke.id),this.cachedSubject=new j(!0),this.services=[],this.serviceIds=new Set,this.servicePackages=[],this.selectedPackages=[],this.selection=new B(!0,[],!0,(ne,Ke)=>ne.id===Ke.id),this.owners=[],this.hosts=[],this.destinations=[],this.destinationServiceMissing=!1,this.availableRoles=[],this.filterValue="",this.ATTRIBUTES_IDX=3,this.serviceControl=new se(!1,Ze.requiredTrue),this.attributesControl=new se(!0,Ze.requiredTrue),this.allowNavigate=!1,this.attributes=[],this.attributeIds=new Set,this.attributesPerService=new Map,this.servicesPerPackage=new Map,this.saveMsg="",this.removeMsg="",this.BEFORE_OPTIONAL_IDX=2,this.DESTINATIONS_IDX=4,this.AFTER_OPTIONAL_IDX=5,this.translate.get("FACILITY_CONFIGURATION.ATT_SAVED").subscribe(ne=>this.saveMsg=ne),this.translate.get("FACILITY_CONFIGURATION.ATT_REMOVED").subscribe(ne=>this.removeMsg=ne)}ngOnInit(){this.facility=this.entityStorageService.getEntity(),this.guiAuthResolver.assignAvailableRoles(this.availableRoles,"Facility"),this.serviceManager.getServicesPackages().subscribe(e=>{this.servicePackages=e,this.getServicePackageServices(e,0)})}ngAfterViewInit(){this.cd.detectChanges(),this.attSelection.changed.subscribe(()=>{this.attributesControl.setValue(this.attSelection.selected.length===0)})}onCancel(){let e=D();e.width="550px",e.data={facilityId:this.facility.id,lastStep:this.stepper.selectedIndex===this.stepper.steps.length-1,theme:"facility-theme"},this.dialog.open(gn,e).afterClosed().subscribe(a=>{a&&(this.allowNavigate=!0,sessionStorage.removeItem("newFacilityId"),this.router.navigate(["facilities"],{queryParamsHandling:"merge"}))})}packagesSelected(e){if(this.packageSelectionEqual(e))return;this.processing=!0;let t=new Set;if(!e||e.length===0?this.selectedPackages.forEach(y=>{this.servicesPerPackage.get(y.id).forEach(F=>t.add(F))}):t=this.setSymDif(this.selectedPackages,e),t.size===0)return;let a=this.filterService(t,e.filter(y=>this.selectedPackages.findIndex(F=>F.id===y.id)<0)),f=this.filterService(t,this.selectedPackages.filter(y=>e.findIndex(F=>F.id===y.id)<0));for(let y of this.services)a.has(y.id)?this.selection.select(y):f.has(y.id)&&this.selection.deselect(y);this.selectedPackages=e,this.setServiceControl(),this.processing=!1}singleServiceSelected(){this.setServiceControl(),!this.processing&&this.checkPackageComplete()}back(){this.stepper.selectedIndex<=this.BEFORE_OPTIONAL_IDX&&this.setServiceControl(),this.stepper.selectedIndex===this.AFTER_OPTIONAL_IDX&&this.selection.selected.length===0?this.stepper.selectedIndex=this.BEFORE_OPTIONAL_IDX:this.stepper.previous()}onSaveAttributes(){return new Promise((e,t)=>{this.processing=!0,this.attributesManager.setFacilityAttributes({facility:this.facility.id,attributes:this.attSelection.selected}).subscribe({next:()=>{this.notificator.showSuccess(this.saveMsg),this.attSelection.clear(),this.cachedSubject.next(!0),this.processing=!1,e()},error:()=>{this.processing=!1,t()}})})}next(){this.checkDestinationDependency(this.stepper.selectedIndex),this.stepper.selectedIndex===this.BEFORE_OPTIONAL_IDX?this.selection.selected.length===0?this.openSkipDialog():(this.getRequiredAttributes(),this.stepper.next()):this.stepper.selectedIndex===this.ATTRIBUTES_IDX?this.attSelection.selected.length!==0?this.openUnsavedAttsDialog():this.stepper.next():this.stepper.next()}onFinish(){this.allowNavigate=!0,sessionStorage.removeItem("newFacilityId"),this.router.navigate(["facilities",this.facility.id],{queryParamsHandling:"merge"})}onRemoveAttributes(){this.processing=!0;let e=this.attSelection.selected.map(t=>t.id);this.attributesManager.removeFacilityAttributes(this.facility.id,e).subscribe({next:()=>{this.notificator.showSuccess(this.removeMsg),this.attSelection.clear(),this.cachedSubject.next(!0),this.getRequiredAttributes(),this.processing=!1},error:()=>this.processing=!1})}filterAttributes(e){if(e===void 0||e.length===0){this.filteredAttributes=this.attributes;return}let t=new Set;for(let a of e)this.attributesPerService.get(a.id).forEach(f=>t.add(f));this.filteredAttributes=[];for(let a of this.attributes)t.has(a.id)&&this.filteredAttributes.push(a);this.attSelection.clear(),this.cachedSubject.next(!0)}getNonEmptyAttributes(){this.filteredAttributes=this.attributes.filter(e=>{if(e.value&&(!Array.isArray(e.value)||e.value.length!==0))return e})}navigationStep(e){this.checkDestinationDependency(e.previouslySelectedIndex),e.selectedIndex===this.ATTRIBUTES_IDX?this.getRequiredAttributes():e.selectedIndex===this.DESTINATIONS_IDX?this.processing=!1:e.selectedIndex<=this.BEFORE_OPTIONAL_IDX&&this.setServiceControl()}applyFilter(e){this.filterValue=e,this.selection.clear(),this.cachedSubject.next(!0)}canDeactivate(){return this.allowNavigate||this.onCancel(),this.allowNavigate}getServicePackageServices(e,t){t===e.length?this.serviceManager.getServices().subscribe(a=>{this.services=a}):this.serviceManager.getServicesFromServicesPackage(e[t].id).subscribe(a=>{this.servicesPerPackage.set(e[t].id,new Set([...a.map(f=>f.id)])),this.getServicePackageServices(e,t+1)})}getServiceRequiredAttributes(e,t){t!==e.length&&this.attributesManager.getRequiredAttributesDefinition(e[t].id).subscribe(a=>{a=a.filter(f=>this.attributeIds.has(f.id)),this.attributesPerService.set(e[t].id,a.map(f=>f.id)),this.getServiceRequiredAttributes(e,t+1)})}setServiceControl(){this.serviceControl.setValue(this.selection.selected.length!==0)}buildServiceSet(e){let t=new Set;return e.forEach(a=>{this.servicesPerPackage.get(a.id).forEach(f=>t.add(f))}),t}setDiff(e,t){return new Set([...e].filter(a=>!t.has(a)))}setIntersect(e,t){return new Set([...e].filter(a=>t.has(a)))}setSymDif(e,t){let a=this.buildServiceSet(e),f=this.buildServiceSet(t),y=this.setDiff(a,f),F=this.setDiff(f,a);return new Set([...y,...F])}filterService(e,t){let a=new Set;for(let f of t){let y=this.setIntersect(e,this.servicesPerPackage.get(f.id));y.size!==0&&y.forEach(F=>a.add(F))}return a}packageSelectionEqual(e){return e.length!==this.selectedPackages.length?!1:(e.forEach(t=>{if(this.selectedPackages.findIndex(a=>a.id===t.id)===-1)return!1}),!0)}checkPackageComplete(){let e=[];for(let t of this.selectedPackages){let a=!0;for(let f of this.servicesPerPackage.get(t.id))if(this.selection.selected.findIndex(y=>y.id===f)===-1){a=!1;break}a&&e.push(t)}this.selectedPackages=e}openSkipDialog(){let e=D();e.width="400px",e.data={theme:"facility-theme"},this.dialog.open(fn,e).afterClosed().subscribe(a=>{a&&(this.serviceControl.setValue(!0),this.stepper.selectedIndex=this.AFTER_OPTIONAL_IDX)})}getRequiredAttributes(){this.processing=!0,this.attributesManager.getRequiredAttributesFacilityServices(this.selection.selected.map(e=>e.id),this.facility.id).subscribe(e=>{this.attSelection.clear(),this.attributes=e.filter(t=>!Kt(t)),this.filteredAttributes=this.attributes,this.attributes.forEach(t=>this.attributeIds.add(t.id)),this.getServiceRequiredAttributes(this.selection.selected,0),this.processing=!1})}openUnsavedAttsDialog(){let e=D();e.width="400px",e.data={theme:"facility-theme"},this.dialog.open(hn,e).afterClosed().subscribe(a=>{a&&this.onSaveAttributes().then(()=>{this.stepper.next()},()=>this.getRequiredAttributes())})}checkDestinationDependency(e){(e===this.BEFORE_OPTIONAL_IDX||e===this.DESTINATIONS_IDX)&&(this.serviceIds=new Set([...this.selection.selected.map(t=>t.id)]),this.destinationServicePresent())}destinationServicePresent(){for(let e of this.destinations)if(!this.serviceIds.has(e.service.id)){this.destinationServiceMissing=!0;return}this.destinationServiceMissing=!1}};o.\u0275fac=function(t){return new(t||o)(u(St),u(ae),u(L),u(rt),u(V),u(Z),u(re),u(ue),u(M),u(R))},o.\u0275cmp=E({type:o,selectors:[["app-facility-configuration-page"]],viewQuery:function(t,a){if(t&1&&lt(La,5),t&2){let f;ct(f=pt())&&(a.stepper=f.first)}},decls:36,vars:15,consts:[[1,"facility-theme"],[1,"page-title"],[3,"linear","selectionChange"],["stepper",""],["spinner",""],["matStepLabel",""],["matStepContent",""],[3,"stepControl"],["optional","true",3,"editable","stepControl"],[3,"editable","optional"],[1,"actions"],["mat-stroked-button","",3,"click"],["class","ms-auto me-2","mat-stroked-button","",3,"click",4,"ngIf"],["color","accent","mat-flat-button","",3,"me-2","ms-auto","click",4,"ngIf"],["class","me-2","color","accent","mat-flat-button","",3,"click",4,"ngIf"],[3,"ownerEmitter"],[3,"disableRouting","hostEmitter"],[1,"page-subtitle"],["alert_type","info"],[1,"filters"],[1,"filter",3,"placeholder","filter"],[1,"package-search-select",3,"disableAutoSelect","selectedPackage","multiple","servicePackages","theme","packageSelected"],[3,"loading","disableRouting","displayedColumns","selection","cachedSubject","filterValue","services","selectionChanged"],["color","warn","mat-flat-button","",1,"me-2",3,"disabled","click"],["color","accent","mat-flat-button","",1,"me-2",3,"disabled","click"],["class","service-search-select",3,"disableAutoSelect","services","multiple","theme","serviceSelected",4,"ngIf"],[1,"position-relative","table-min-height"],[3,"loading","emptyListText","attributes","selection","cachedSubject",4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],[1,"service-search-select",3,"disableAutoSelect","services","multiple","theme","serviceSelected"],[3,"loading","emptyListText","attributes","selection","cachedSubject"],[3,"configServicesIds","displayedColumns","configServices","loading","title","destinationEmitter"],[3,"disableRouting","disableSelf"],[3,"innerHTML"],[4,"ngIf"],[3,"disabled"],["svgIcon","perun-owner-grey",1,"me-2"],[3,"loading","displayedColumns","owners",4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],["svgIcon","perun-hosts",1,"me-2"],[3,"loading","disableRouting","displayedColumns","hosts",4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],["svgIcon","perun-service",1,"me-2"],[3,"loading","disableRouting","displayedColumns","services"],[3,"disabled","opened"],[3,"loading","displayedColumns","attributes","emptyListText"],[3,"expanded","disabled","expandedChange"],["svgIcon","perun-service_destination",1,"me-2"],[3,"loading","destinations","displayedColumns","services",4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],["svgIcon","perun-manager",1,"me-2"],[3,"complementaryObject","configMode","disableRouting","availableRoles","complementaryObjectType","displayedGroupColumns","displayedUserColumns"],[3,"loading","displayedColumns","owners"],[3,"loading","disableRouting","displayedColumns","hosts"],[3,"loading","destinations","displayedColumns","services"],["mat-stroked-button","",1,"ms-auto","me-2",3,"click"],["color","accent","mat-flat-button","",3,"click"],["color","accent","mat-flat-button","",1,"me-2",3,"click"]],template:function(t,a){if(t&1&&(l(0,"div",0)(1,"div",1),d(2),p(3,"translate"),s(),l(4,"mat-stepper",2,3),g("selectionChange",function(y){return a.navigationStep(y)}),v(6,Ma,1,0,"ng-template",null,4,G),l(8,"mat-step"),v(9,Oa,2,3,"ng-template",5)(10,Na,1,0,"ng-template",6),s(),l(11,"mat-step"),v(12,ka,2,3,"ng-template",5)(13,Va,1,1,"ng-template",6),s(),l(14,"mat-step",7),v(15,Pa,2,3,"ng-template",5)(16,ja,10,20,"ng-template",6),s(),l(17,"mat-step",8),v(18,Ga,2,3,"ng-template",5)(19,Ha,16,17,"ng-template",6),s(),l(20,"mat-step",9),v(21,Wa,2,3,"ng-template",5)(22,$a,1,6,"ng-template",6),s(),l(23,"mat-step"),v(24,Xa,2,3,"ng-template",5)(25,qa,1,2,"ng-template",6),s(),l(26,"mat-step"),v(27,Ka,2,3,"ng-template",5)(28,lo,4,4,"ng-template",6),s()(),l(29,"div",10)(30,"button",11),g("click",function(){return a.onCancel()}),d(31),p(32,"translate"),s(),v(33,co,3,3,"button",12)(34,po,3,7,"button",13)(35,mo,3,3,"button",14),s()()),t&2){let f=w(5);r(2),_(" ",m(3,11,"FACILITY_CONFIGURATION.TITLE")," "),r(2),c("linear",!0),r(10),c("stepControl",a.serviceControl),r(3),c("editable",a.selection.selected.length!==0)("stepControl",a.attributesControl),r(3),c("editable",a.selection.selected.length!==0||a.destinations.length!==0)("optional",a.destinations.length===0),r(11),_(" ",m(32,13,"FACILITY_CONFIGURATION.CANCEL")," "),r(2),c("ngIf",f!==void 0&&f.selectedIndex!==0),r(),c("ngIf",f!==void 0&&f.selectedIndex!==f.steps.length-1),r(),c("ngIf",f!==void 0&&f.selectedIndex===f.steps.length-1)}},dependencies:[x,le,O,Bt,Vt,jt,Pt,Mt,wt,Dt,Lt,Be,Ge,Ue,Mi,Le,Y,di,H,Ne,hi,gi,U,We,ze,$e,Xe,A],styles:[".icon-scale[_ngcontent-%COMP%]{transform:scale(1.7);margin-left:.5rem;margin-top:-.6rem;margin-right:.9rem}.filters[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;align-items:baseline}.package-search-select[_ngcontent-%COMP%]{width:650px}.service-search-select[_ngcontent-%COMP%]{width:400px}.filter[_ngcontent-%COMP%]{width:350px;margin-right:20px}.actions[_ngcontent-%COMP%]{background-color:#fff;display:flex;padding:20px}.cursor-default[_ngcontent-%COMP%]{cursor:default}"]});let i=o;return i})();var it=(()=>{let o=class o{constructor(e){this.router=e}canActivate(e){return e.parent.params.facilityId===sessionStorage.getItem("newFacilityId")?!0:(this.router.navigate(["/home"],{queryParamsHandling:"merge"}),!1)}canDeactivate(e){return e.canDeactivate()}};o.\u0275fac=function(t){return new(t||o)(ot(ue))},o.\u0275prov=at({token:o,factory:o.\u0275fac,providedIn:"root"});let i=o;return i})();function uo(i,o){if(i&1){let n=b();l(0,"button",8),g("click",function(){I(n);let t=h();return C(t.add())}),d(1),p(2,"translate"),s()}i&2&&(r(),_(" ",m(2,1,"FACILITY_DETAIL.SETTINGS.BANS.ADD"),`
`))}function fo(i,o){if(i&1){let n=b();l(0,"button",9),g("click",function(){I(n);let t=h();return C(t.remove())}),d(1),p(2,"translate"),s()}if(i&2){let n=h();c("disabled",n.loading||n.selection.selected.length===0),r(),_(" ",m(2,2,"FACILITY_DETAIL.SETTINGS.BANS.REMOVE"),`
`)}}function ho(i,o){if(i&1){let n=b();l(0,"perun-web-apps-ban-on-entity-list",10),g("updateBan",function(t){I(n);let a=h();return C(a.update(t))}),s()}if(i&2){let n=h();c("loading",n.loading)("bans",n.bans)("selection",n.selection)("cachedSubject",n.cachedSubject)("displayedColumns",n.displayedColumns)("filter",n.filter)("updatePolicy","updateBan_BanOnFacility_policy")}}function go(i,o){i&1&&S(0,"perun-web-apps-loading-table")}var vn=(()=>{let o=class o{constructor(e,t,a,f,y,F,W){this.facilityService=e,this.entityService=t,this.authResolver=a,this.dialog=f,this.notificator=y,this.store=F,this.userName=W,this.loading=!1,this.bans=[],this.removeAuth=!1,this.filter="",this.selection=new B(!1,[],!0,(P,J)=>P.ban.id===J.ban.id),this.cachedSubject=new j(!0),this.attrNames=[et.MEMBER_DEF_MAIL,et.USER_DEF_PREFERRED_MAIL].concat(this.store.getLoginAttributeNames()),this.displayedColumns=["select","banId","subjectId","subjectName","description","expiration","edit"]}ngOnInit(){this.loading=!0,this.facility=this.entityService.getEntity(),this.addAuth=this.authResolver.isAuthorized("setBan_BanOnFacility_policy",[this.facility]),this.removeAuth=this.authResolver.isAuthorized("removeBan_int_policy",[this.facility]),this.refresh()}refresh(){this.loading=!0,this.facilityService.getEnrichedBansForFacility(this.facility.id,this.attrNames).subscribe({next:e=>{this.bans=e,this.selection.clear(),this.cachedSubject.next(!0),this.loading=!1},error:()=>this.loading=!1})}add(){let e=D();e.width="850px",e.data={entityId:this.facility.id,theme:"facility-theme",bans:this.bans.map(a=>a.ban)},this.dialog.open($i,e).afterClosed().subscribe(a=>{a&&this.refresh()})}remove(){let e=D();e.width="550px",e.data={theme:"facility-theme",title:"DIALOGS.REMOVE_BAN.TITLE",description:"DIALOGS.REMOVE_BAN.DESCRIPTION",items:[this.userName.transform(this.selection.selected[0].user)],type:"remove",showAsk:!0},this.dialog.open(oi,e).afterClosed().subscribe(a=>{a&&(this.loading=!0,this.facilityService.removeFacilityBanById(this.selection.selected[0].ban.id).subscribe(()=>{this.notificator.showSuccess("DIALOGS.REMOVE_BAN.SUCCESS"),this.refresh()}))})}update(e){let t=D();t.width="600px",t.data={ban:e.ban,theme:"facility-theme"},this.dialog.open(Xi,t).afterClosed().subscribe(f=>{f&&this.refresh()})}applyFilter(e){this.filter=e,this.refresh()}};o.\u0275fac=function(t){return new(t||o)(u(L),u(R),u(M),u(V),u(Z),u(bt),u(ee))},o.\u0275cmp=E({type:o,selectors:[["app-facility-settings-bans"]],features:[dt([ee])],decls:11,vars:8,consts:[[1,"page-subtitle"],[3,"click"],["class","me-2 action-button","color","accent","mat-flat-button","",3,"click",4,"ngIf"],["color","warn","class","me-2","mat-flat-button","",3,"disabled","click",4,"ngIf"],[1,"mt-2","search-field",3,"placeholder","filter"],[1,"position-relative","table-min-height"],[3,"loading","bans","selection","cachedSubject","displayedColumns","filter","updatePolicy","updateBan",4,"perunWebAppsLoader","perunWebAppsLoaderIndicator"],["spinner",""],["color","accent","mat-flat-button","",1,"me-2","action-button",3,"click"],["color","warn","mat-flat-button","",1,"me-2",3,"disabled","click"],[3,"loading","bans","selection","cachedSubject","displayedColumns","filter","updatePolicy","updateBan"]],template:function(t,a){if(t&1&&(l(0,"h1",0),d(1),p(2,"translate"),s(),l(3,"perun-web-apps-refresh-button",1),g("click",function(){return a.refresh()}),s(),v(4,uo,3,3,"button",2)(5,fo,3,4,"button",3),l(6,"perun-web-apps-debounce-filter",4),g("filter",function(y){return a.applyFilter(y)}),s(),l(7,"div",5),v(8,ho,1,7,"perun-web-apps-ban-on-entity-list",6),s(),v(9,go,1,0,"ng-template",null,7,G)),t&2){let f=w(10);r(),_(" ",m(2,6,"FACILITY_DETAIL.SETTINGS.BANS.TITLE"),`
`),r(3),c("ngIf",a.addAuth),r(),c("ngIf",a.removeAuth),r(),c("placeholder","FACILITY_DETAIL.SETTINGS.BANS.FILTER"),r(2),c("perunWebAppsLoader",a.loading)("perunWebAppsLoaderIndicator",f)}},dependencies:[x,O,Y,K,H,_i,U,A]});let i=o;return i})();var _o=[{path:"",component:Ji,canActivate:[je]},{path:":facilityId",component:on,canActivateChild:[je],children:[{path:"",component:rn,data:{animation:"FacilityOverviewPage"}},{path:"attributes",component:cn,data:{animation:"FacilityAttributesPage"}},{path:"resources",component:Zi,data:{animation:"FacilityResourcesPage"}},{path:"allowed-users",component:tn,data:{animation:"FacilityAllowedUsersPage"}},{path:"allowed-groups",component:en,data:{animation:"FacilityAllowedGroupsPage"}},{path:"services-status",component:dn,data:{animation:"FacilityServiceStatusPage"}},{path:"services-status/:taskId",component:un,data:{animation:"FacilityTaskResultsPage"}},{path:"service-config",component:pn,data:{animation:"FacilityServiceConfigPage"}},{path:"services-destinations",component:ze,data:{animation:"FacilityServicesDestinationsPage"}},{path:"hosts",component:Xe,data:{animation:"FacilityHostsPage"}},{path:"hosts/:hostId",component:mn,data:{animation:"FacilityHostsDetailPage"}},{path:"settings",component:sn,children:[{path:"",component:ln,data:{animation:"FacilitySettingsOverviewPage"}},{path:"owners",component:$e,data:{animation:"FacilitySettingOwnersPage"}},{path:"managers",component:We,data:{animation:"FacilitySettingsManagersPage"}},{path:"bans",component:vn,data:{animation:"FacilitySettingsBansPage"}}]},{path:"configuration",component:_n,canActivate:[it],canDeactivate:[it]}]},{path:":facilityId/resources/:resourceId",component:Ai,canActivateChild:[je],children:[{path:"",component:Fi,data:{animation:"ResourceOverviewPage"}},{path:"attributes",component:Di,data:{animation:"ResourceAttributesPage"}},{path:"groups",component:xi,data:{animation:"ResourceGroupsComponent"}},{path:"services",component:Oi,data:{animation:"ResourceAssignedServicesComponent"}},{path:"members",component:Ni,data:{animation:"ResourceAssignedMembersComponent"}},{path:"tags",component:ki,data:{animation:"ResourceTagsComponent"}},{path:"settings",component:Ri,children:[{path:"",component:wi,data:{animation:"ResourceSettingsOverviewPage"}},{path:"managers",component:Li,data:{animation:"ResourceSettingsManagersPage"}},{path:"bans",component:Vi,data:{animation:"ResourceSettingsBansPage"}}]}]}],Sn=(()=>{let o=class o{};o.\u0275fac=function(t){return new(t||o)},o.\u0275mod=Fe({type:o}),o.\u0275inj=Ae({imports:[Je.forChild(_o),Je]});let i=o;return i})();var lm=(()=>{let o=class o{};o.\u0275fac=function(t){return new(t||o)},o.\u0275mod=Fe({type:o}),o.\u0275inj=Ae({providers:[ee],imports:[_t,Sn,qi,Qt,ii,Si,ti,Ki,Qi]});let i=o;return i})();export{lm as FacilitiesModule};
