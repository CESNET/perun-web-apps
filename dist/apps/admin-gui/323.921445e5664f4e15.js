"use strict";(self.webpackChunkadmin_gui=self.webpackChunkadmin_gui||[]).push([[323],{15935:(A,C,i)=>{i.d(C,{D:()=>K});var g=i(95017),h=i(96308),u=i(30671),_=i(9244),d=i(35382),e=i(94650),t=i(36895),b=i(56709),E=i(98380),P=i(18750),m=i(89383),D=i(9185),o=i(37677);function c(r,p){if(1&r){const s=e.EpF();e.TgZ(0,"th",16)(1,"mat-checkbox",17),e.NdJ("change",function(l){e.CHM(s);const n=e.oxw(2);return e.KtG(l?n.masterToggle():null)}),e.qZA()()}if(2&r){const s=e.oxw().ngIf,a=e.oxw();e.xp6(1),e.Q6J("aria-label",a.checkboxLabel())("checked",a.selection.hasValue()&&s.all)("indeterminate",a.selection.hasValue()&&!s.all)}}function x(r,p){if(1&r){const s=e.EpF();e.TgZ(0,"td",18)(1,"mat-checkbox",19),e.NdJ("change",function(l){const f=e.CHM(s).$implicit,M=e.oxw(2);return e.KtG(l?M.selection.toggle(f):null)})("click",function(l){return l.stopPropagation()}),e.qZA()()}if(2&r){const s=p.$implicit,a=e.oxw(2);e.xp6(1),e.Q6J("aria-label",a.checkboxLabel(s))("checked",a.selection.isSelected(s))}}function O(r,p){1&r&&(e.ynx(0,13),e.YNc(1,c,2,3,"th",14),e.YNc(2,x,2,2,"td",15),e.BQk())}function T(r,p){1&r&&(e.TgZ(0,"th",20),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&r&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"SHARED.COMPONENTS.EXT_SOURCES_LIST.ID")," "))}function S(r,p){if(1&r&&(e.TgZ(0,"td",21),e._uU(1),e.qZA()),2&r){const s=p.$implicit;e.xp6(1),e.Oqu(s.id)}}function R(r,p){1&r&&(e.TgZ(0,"th",20),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&r&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"SHARED.COMPONENTS.EXT_SOURCES_LIST.NAME")," "))}function I(r,p){if(1&r&&(e.TgZ(0,"td",22),e.ALo(1,"lowercase"),e._uU(2),e.qZA()),2&r){const s=p.$implicit;e.Q2q("data-cy","",e.lcZ(1,2,s.name),"-name-td"),e.xp6(2),e.hij(" ",s.name," ")}}function L(r,p){1&r&&(e.TgZ(0,"th",20),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&r&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"SHARED.COMPONENTS.EXT_SOURCES_LIST.TYPE")," "))}function y(r,p){if(1&r&&(e.TgZ(0,"td",22),e._uU(1),e.ALo(2,"extSourceType"),e.qZA()),2&r){const s=p.$implicit;e.xp6(1),e.Oqu(e.lcZ(2,1,s.type))}}function U(r,p){1&r&&e._UZ(0,"tr",23)}function Z(r,p){1&r&&e._UZ(0,"tr",24)}function w(r,p){1&r&&(e.TgZ(0,"perun-web-apps-alert",25),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&r&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"SHARED.COMPONENTS.EXT_SOURCES_LIST.NO_EXT_SOURCES"),"\n"))}function B(r,p){1&r&&(e.TgZ(0,"perun-web-apps-alert",25),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&r&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"SHARED.COMPONENTS.EXT_SOURCES_LIST.NO_FILTER_RESULTS"),"\n"))}const N=function(r){return{all:r}};let K=(()=>{class r{constructor(s,a){this.authResolver=s,this.tableCheckbox=a,this.selection=new g.Ov,this.filterValue="",this.displayedColumns=["select","id","name","type"],this.exporting=!1,this.pageSizeOptions=_.f7}set matSort(s){this.sort=s,this.setDataSource()}static getDataForColumn(s,a){switch(a){case"id":return s.id.toString();case"type":return s.type.substring(40);case"name":return s.name;default:return""}}ngAfterViewInit(){this.setDataSource()}ngOnChanges(){this.authResolver.isPerunAdminOrObserver()||(this.displayedColumns=this.displayedColumns.filter(s=>"id"!==s)),this.dataSource=new u.by(this.extSources),this.setDataSource()}exportAllData(s){(0,_.O6)((0,_.Xn)(this.dataSource.filteredData,this.displayedColumns,r.getDataForColumn),s)}exportDisplayedData(s){const a=this.dataSource.paginator.pageIndex*this.dataSource.paginator.pageSize,l=a+this.dataSource.paginator.pageSize;(0,_.O6)((0,_.Xn)(this.dataSource.sortData(this.dataSource.filteredData,this.dataSource.sort).slice(a,l),this.displayedColumns,r.getDataForColumn),s)}setDataSource(){this.dataSource&&(this.dataSource.filterPredicate=(s,a)=>(0,_.Sd)(s,a,this.displayedColumns,r.getDataForColumn),this.dataSource.sortData=(s,a)=>(0,_.pR)(s,a,r.getDataForColumn),this.dataSource.sort=this.sort,this.dataSource.paginator=this.child.paginator,this.dataSource.filter=this.filterValue)}isAllSelected(){return this.tableCheckbox.isAllSelected(this.selection.selected.length,this.dataSource)}masterToggle(){this.tableCheckbox.masterToggle(this.isAllSelected(),this.selection,this.filterValue,this.dataSource,this.sort,this.child.paginator.pageSize,this.child.paginator.pageIndex,!1)}checkboxLabel(s){return s?`${this.selection.isSelected(s)?"deselect":"select"} row ${s.id+1}`:(this.isAllSelected()?"select":"deselect")+" all"}}return r.\u0275fac=function(s){return new(s||r)(e.Y36(d.x4),e.Y36(d.UA))},r.\u0275cmp=e.Xpm({type:r,selectors:[["app-ext-sources-list"]],viewQuery:function(s,a){if(1&s&&(e.Gf(_.l9,7),e.Gf(h.YE,7)),2&s){let l;e.iGM(l=e.CRH())&&(a.child=l.first),e.iGM(l=e.CRH())&&(a.matSort=l.first)}},inputs:{extSources:"extSources",selection:"selection",filterValue:"filterValue",displayedColumns:"displayedColumns",tableId:"tableId"},features:[e.TTD],decls:18,vars:15,consts:[[1,"card","mt-2",3,"hidden"],[3,"pageSizeOptions","dataLength","tableId","exportDisplayedData","exportAllData"],["mat-table","","matSort","","matSortActive","id","matSortDirection","asc","matSortDisableClear","",1,"w-100",3,"dataSource"],["matColumnDef","select",4,"ngIf"],["matColumnDef","id"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["class","static-column-size","mat-cell","",4,"matCellDef"],["matColumnDef","name"],["mat-cell","",4,"matCellDef"],["matColumnDef","type"],["mat-header-row","",4,"matHeaderRowDef"],["class","dark-hover-list-item","mat-row","",4,"matRowDef","matRowDefColumns"],["alert_type","warn",4,"ngIf"],["matColumnDef","select"],["class","align-checkbox","mat-header-cell","",4,"matHeaderCellDef"],["class","static-column-size align-checkbox","mat-cell","",4,"matCellDef"],["mat-header-cell","",1,"align-checkbox"],["color","primary",3,"aria-label","checked","indeterminate","change"],["mat-cell","",1,"static-column-size","align-checkbox"],["color","primary",3,"aria-label","checked","change","click"],["mat-header-cell","","mat-sort-header",""],["mat-cell","",1,"static-column-size"],["mat-cell",""],["mat-header-row",""],["mat-row","",1,"dark-hover-list-item"],["alert_type","warn"]],template:function(s,a){1&s&&(e.TgZ(0,"div",0)(1,"perun-web-apps-table-wrapper",1),e.NdJ("exportDisplayedData",function(n){return a.exportDisplayedData(n)})("exportAllData",function(n){return a.exportAllData(n)}),e.TgZ(2,"table",2),e.YNc(3,O,3,0,"ng-container",3),e.ALo(4,"isAllSelected"),e.ynx(5,4),e.YNc(6,T,3,3,"th",5),e.YNc(7,S,2,1,"td",6),e.BQk(),e.ynx(8,7),e.YNc(9,R,3,3,"th",5),e.YNc(10,I,3,4,"td",8),e.BQk(),e.ynx(11,9),e.YNc(12,L,3,3,"th",5),e.YNc(13,y,3,3,"td",8),e.BQk(),e.YNc(14,U,1,0,"tr",10),e.YNc(15,Z,1,0,"tr",11),e.qZA()()(),e.YNc(16,w,3,3,"perun-web-apps-alert",12),e.YNc(17,B,3,3,"perun-web-apps-alert",12)),2&s&&(e.Q6J("hidden",0===a.extSources.length||0===a.dataSource.filteredData.length),e.xp6(1),e.Q6J("pageSizeOptions",a.pageSizeOptions)("dataLength",a.dataSource.filteredData.length)("tableId",a.tableId),e.xp6(1),e.Q6J("dataSource",a.dataSource),e.xp6(1),e.Q6J("ngIf",e.VKq(13,N,e.xi3(4,10,a.dataSource,a.selection.selected.length))),e.xp6(11),e.Q6J("matHeaderRowDef",a.displayedColumns),e.xp6(1),e.Q6J("matRowDefColumns",a.displayedColumns),e.xp6(1),e.Q6J("ngIf",0===a.extSources.length),e.xp6(1),e.Q6J("ngIf",0===a.dataSource.filteredData.length&&0!==a.extSources.length))},dependencies:[t.O5,h.YE,h.nU,u.BZ,u.fO,u.as,u.w1,u.Dz,u.nj,u.ge,u.ev,u.XQ,u.Gk,b.oG,E.w,P.l,t.i8,m.X$,D.I,o.A]}),r})()},60526:(A,C,i)=>{i.d(C,{b:()=>s});var g=i(32105),h=i(9244),u=i(74281),_=i(30671),d=i(35382),e=i(64080),t=i(94650),b=i(65412),E=i(89383),P=i(36895),m=i(97392),D=i(4859),o=i(51572),c=i(73546),x=i(69773),O=i(21757),T=i(38993),S=i(62383),R=i(21330);function I(a,l){1&a&&t._UZ(0,"mat-spinner",4)}function L(a,l){1&a&&t._UZ(0,"th",12)}function y(a,l){if(1&a&&(t.TgZ(0,"td",13),t._uU(1),t.qZA()),2&a){const n=l.$implicit;t.xp6(1),t.hij("",n,":")}}function U(a,l){1&a&&t._UZ(0,"th",12)}function Z(a,l){if(1&a){const n=t.EpF();t.TgZ(0,"button",17),t.NdJ("click",function(){t.CHM(n);const M=t.oxw(4);return t.KtG(M.changeStatus())}),t.TgZ(1,"mat-icon"),t._uU(2,"edit"),t.qZA()()}}function w(a,l){if(1&a&&(t.TgZ(0,"div")(1,"i"),t.ALo(2,"memberStatusIconColor"),t._uU(3),t.ALo(4,"memberStatusIcon"),t.qZA(),t.TgZ(5,"b",15),t._uU(6),t.ALo(7,"transformMemberStatus"),t.qZA(),t.YNc(8,Z,3,0,"button",16),t.ALo(9,"memberStatusDisabled"),t.qZA()),2&a){const n=t.oxw(3);t.xp6(1),t.Gre("material-icons vert-center mr-1 ",t.lcZ(2,6,n.member),""),t.xp6(2),t.hij(" ",t.lcZ(4,8,n.member.status)," "),t.xp6(3),t.hij(" ",t.lcZ(7,10,n.member.status)," "),t.xp6(2),t.Q6J("ngIf",n.authResolver.isThisVoAdmin(n.vo.id)&&!t.lcZ(9,12,n.member))}}function B(a,l){if(1&a){const n=t.EpF();t.TgZ(0,"button",17),t.NdJ("click",function(){t.CHM(n);const M=t.oxw(4);return t.KtG(M.changeVoExpiration(!1))}),t.TgZ(1,"mat-icon"),t._uU(2,"edit"),t.qZA()()}}function N(a,l){if(1&a&&(t.TgZ(0,"div")(1,"i",18),t._uU(2),t.ALo(3,"parseDate"),t.qZA(),t.YNc(4,B,3,0,"button",16),t.ALo(5,"memberStatusDisabled"),t.qZA()),2&a){const n=t.oxw(3);t.xp6(2),t.hij(" ",t.lcZ(3,2,n.voExpiration)," "),t.xp6(2),t.Q6J("ngIf",n.authResolver.isThisVoAdmin(n.vo.id)&&!t.lcZ(5,4,n.member))}}function K(a,l){if(1&a&&(t.TgZ(0,"td",14),t.YNc(1,w,10,14,"div",3),t.YNc(2,N,6,6,"div",3),t.qZA()),2&a){const n=l.$implicit;t.xp6(1),t.Q6J("ngIf","Status"===n),t.xp6(1),t.Q6J("ngIf","Expiration"===n)}}function r(a,l){1&a&&t._UZ(0,"tr",19)}function p(a,l){if(1&a&&(t.TgZ(0,"div")(1,"table",5),t.ynx(2,6),t.YNc(3,L,1,0,"th",7),t.YNc(4,y,2,1,"td",8),t.BQk(),t.ynx(5,9),t.YNc(6,U,1,0,"th",7),t.YNc(7,K,3,2,"td",10),t.BQk(),t.YNc(8,r,1,0,"tr",11),t.qZA()()),2&a){const n=t.oxw();t.xp6(1),t.Q6J("dataSource",n.voMembershipDataSource),t.xp6(7),t.Q6J("matRowDefColumns",n.displayedColumns)}}let s=(()=>{class a{constructor(n,f,M,v,W,Y){this.dialog=n,this.authResolver=f,this.apiRequest=M,this.attributesManager=v,this.translate=W,this.notificator=Y,this.voMembershipDataSource=new _.by,this.voExpiration="",this.displayedColumns=["attName","attValue"]}ngOnChanges(){this.voMembershipDataSource=new _.by(["Status","Expiration"]),this.refreshVoExpiration()}changeStatus(){const n=(0,h.kZ)();n.width="600px",n.data={member:this.member,voId:this.vo.id};const f=this.member.status;this.dialog.open(u.pf,n).afterClosed().subscribe(v=>{v&&(this.member=v,("VALID"===f&&("EXPIRED"===v.status||"DISABLED"===v.status)||"VALID"===v.status)&&this.changeVoExpiration(!0))})}changeVoExpiration(n){const f=(0,h.kZ)();f.width="400px",f.data={voId:this.vo.id,memberId:this.member.id,expirationAttr:this.voExpirationAtt,status:this.member.status,statusChanged:n},this.dialog.open(u.kZ,f).afterClosed().subscribe(v=>{v.success&&(v.member&&(this.member=v.member),this.refreshVoExpiration())})}refreshVoExpiration(){this.loading=!0,this.apiRequest.dontHandleErrorForNext(),this.attributesManager.getMemberAttributeByName(this.member.id,e.r.MEMBER_DEF_EXPIRATION).subscribe(n=>{this.voExpirationAtt=n,this.voExpiration=n.value?n.value:this.translate.instant("MEMBER_DETAIL.OVERVIEW.NEVER_EXPIRES"),this.loading=!1},n=>{"PrivilegeException"!==n.name?this.notificator.showError(n.name):this.voMembershipDataSource=new _.by(["Status"]),this.loading=!1})}}return a.\u0275fac=function(n){return new(n||a)(t.Y36(b.uw),t.Y36(d.x4),t.Y36(d.F5),t.Y36(g.H8),t.Y36(E.sK),t.Y36(d.V6))},a.\u0275cmp=t.Xpm({type:a,selectors:[["app-member-overview-membership"]],inputs:{member:"member",vo:"vo"},features:[t.TTD],decls:9,vars:5,consts:[[1,"mat-elevation-z3","membership-card"],[1,"page-subtitle"],["class","mr-auto ml-auto",4,"ngIf"],[4,"ngIf"],[1,"mr-auto","ml-auto"],["mat-table","",1,"ml-auto","mr-auto",3,"dataSource"],["matColumnDef","attName"],["mat-header-cell","",4,"matHeaderCellDef"],["class","font-weight-bold","mat-cell","",4,"matCellDef"],["matColumnDef","attValue"],["class","column-center","mat-cell","",4,"matCellDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["mat-header-cell",""],["mat-cell","",1,"font-weight-bold"],["mat-cell","",1,"column-center"],[1,"vert-top"],["mat-icon-button","",3,"click",4,"ngIf"],["mat-icon-button","",3,"click"],[1,"column-center"],["mat-row",""]],template:function(n,f){1&n&&(t.TgZ(0,"mat-card",0)(1,"mat-card-header")(2,"mat-card-title")(3,"h1",1),t._uU(4),t.ALo(5,"translate"),t.qZA()()(),t.TgZ(6,"mat-card-content"),t.YNc(7,I,1,0,"mat-spinner",2),t.YNc(8,p,9,2,"div",3),t.qZA()()),2&n&&(t.xp6(4),t.hij(" ",t.lcZ(5,3,"MEMBER_DETAIL.OVERVIEW.ORGANIZATION_MEMBERSHIP")," "),t.xp6(3),t.Q6J("ngIf",f.loading),t.xp6(1),t.Q6J("ngIf",!f.loading))},dependencies:[P.O5,m.Hw,D.lW,_.BZ,_.fO,_.w1,_.Dz,_.nj,_.ge,_.ev,_.Gk,o.Ou,c.a8,c.dk,c.dn,c.n5,E.X$,x.u,O.f,T.n,S.M,R.r],styles:[".membership-card[_ngcontent-%COMP%]{max-width:400px}.vert-center[_ngcontent-%COMP%]{vertical-align:middle!important}"]}),a})()},21330:(A,C,i)=>{i.d(C,{r:()=>h});var g=i(94650);let h=(()=>{class u{transform(d,e){return"valid"!==d.toLowerCase()||e&&"valid"!==d.toLowerCase()?d:"ACTIVE"}}return u.\u0275fac=function(d){return new(d||u)},u.\u0275pipe=g.Yjl({name:"transformMemberStatus",type:u,pure:!0}),u})()},71992:(A,C,i)=>{i.d(C,{a:()=>b});var g=i(35382),h=i(32105),u=i(54004),_=i(70262),d=i(39646),e=i(94650),t=i(94364);let b=(()=>{class E{constructor(m,D,o,c,x,O,T,S){this.authResolver=m,this.routePolicyService=D,this.router=o,this.notificator=c,this.apiRequest=x,this.memberManager=O,this.groupManager=T,this.resourceManager=S}static getBeanName(m){switch(m){case"organizations":return"Vo";case"groups":return"Group";case"facilities":case"services":return"Facility";case"resources":return"Resource";case"members":return"Member";default:return""}}static parseUrl(m){const D=m.slice(1).split("/").reverse(),o={key:"",entity:{id:-1,beanName:""}};for(const c of D){if(Number(c)){if(-1===o.entity.id){o.entity.id=Number(c);continue}"services-status-"===o.key&&(o.entity.id=Number(c));break}o.key=c.concat("-",o.key)}return o.key=o.key.slice(0,o.key.length-1),o.entity.beanName=E.getBeanName(o.key.split("-")[0]),o}canActivateChild(m,D){if(this.authResolver.isPerunAdminOrObserver())return!0;const o=E.parseUrl(D.url);return o.key.startsWith("members")?(this.apiRequest.dontHandleErrorForNext(),this.memberManager.getMemberById(o.entity.id).pipe((0,u.U)(c=>(o.entity.userId=c.userId,o.entity.voId=c.voId,this.finalizeCanActivateChild(o))),(0,_.K)(c=>this.errorRedirectUrl(c)))):o.key.startsWith("groups")?(this.apiRequest.dontHandleErrorForNext(),this.groupManager.getGroupById(o.entity.id).pipe((0,u.U)(c=>(o.entity.voId=c.voId,this.finalizeCanActivateChild(o))),(0,_.K)(c=>this.errorRedirectUrl(c)))):o.key.startsWith("resources")?(this.apiRequest.dontHandleErrorForNext(),this.resourceManager.getResourceById(o.entity.id).pipe((0,u.U)(c=>(o.entity.facilityId=c.facilityId,o.entity.voId=c.voId,this.finalizeCanActivateChild(o))),(0,_.K)(c=>this.errorRedirectUrl(c)))):this.finalizeCanActivateChild(o)}finalizeCanActivateChild(m){return!!this.routePolicyService.canNavigate(m.key,m.entity)||(this.notificator.showRouteError(),this.router.parseUrl("/notAuthorized"))}errorRedirectUrl(m){if("PrivilegeException"===m.name)return this.notificator.showRouteError(),(0,d.of)(this.router.parseUrl("/notAuthorized"))}}return E.\u0275fac=function(m){return new(m||E)(e.LFG(g.x4),e.LFG(g.Ip),e.LFG(t.F0),e.LFG(g.V6),e.LFG(g.F5),e.LFG(h.uq),e.LFG(h.ff),e.LFG(h.xk))},E.\u0275prov=e.Yz7({token:E,factory:E.\u0275fac,providedIn:"root"}),E})()},23123:(A,C,i)=>{i.d(C,{i:()=>u});var g=i(94650),h=i(89383);let u=(()=>{class _{constructor(e){this.translate=e,this.prefix="ROLES."}transform(e){const t=this.prefix.concat(e);return this.translate.instant(t)}}return _.\u0275fac=function(e){return new(e||_)(g.Y36(h.sK,16))},_.\u0275pipe=g.Yjl({name:"displayedRole",type:_,pure:!0}),_})()}}]);