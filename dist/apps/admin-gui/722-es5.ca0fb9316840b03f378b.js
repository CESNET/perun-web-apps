!function(){function e(e){return function(e){if(Array.isArray(e))return n(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||a(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function t(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var i=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==i)return;var a,n,s=[],l=!0,r=!1;try{for(i=i.call(e);!(l=(a=i.next()).done)&&(s.push(a.value),!t||s.length!==t);l=!0);}catch(o){r=!0,n=o}finally{try{l||null==i.return||i.return()}finally{if(r)throw n}}return s}(e,t)||a(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function i(e,t){var i="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!i){if(Array.isArray(e)||(i=a(e))||t&&e&&"number"==typeof e.length){i&&(e=i);var n=0,s=function(){};return{s:s,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:s}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var l,r=!0,o=!1;return{s:function(){i=i.call(e)},n:function(){var e=i.next();return r=e.done,e},e:function(e){o=!0,l=e},f:function(){try{r||null==i.return||i.return()}finally{if(o)throw l}}}}function a(e,t){if(e){if("string"==typeof e)return n(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);return"Object"===i&&e.constructor&&(i=e.constructor.name),"Map"===i||"Set"===i?Array.from(e):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?n(e,t):void 0}}function n(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,a=new Array(t);i<t;i++)a[i]=e[i];return a}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function l(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function r(e,t,i){return t&&l(e.prototype,t),i&&l(e,i),e}(self.webpackChunkperun_web_apps=self.webpackChunkperun_web_apps||[]).push([[722],{86722:function(a,n,l){"use strict";l.r(n),l.d(n,{FacilitiesModule:function(){return Un}});var o=l(61511),c=l(57629),u=l(73916),d=l(17),h=l(75585),f=l(65249),p=l(84140),g=l(68416),m=l(6527),S=l(30570),v=l(31572),A=l(84608),T=l(48958),I=l(66297),y=l(67806),b=l(43691),E=l(36922),Z=l(21575),C=l(15980),_=l(48160);function k(e,t){1&e&&v._UZ(0,"mat-spinner",3)}function L(e,t){if(1&e){var i=v.EpF();v.TgZ(0,"button",12),v.NdJ("click",function(){return v.CHM(i),v.oxw(2).editFacility()}),v.TgZ(1,"mat-icon"),v._uU(2,"edit"),v.qZA(),v.qZA()}}function x(e,t){if(1&e){var i=v.EpF();v.TgZ(0,"button",12),v.NdJ("click",function(){return v.CHM(i),v.oxw(2).deleteFacility()}),v.TgZ(1,"mat-icon"),v._uU(2,"delete_forever"),v.qZA(),v.qZA()}}var O=function(){return{color:"black"}},R=function(e){return["/facilities",e]};function D(e,t){if(1&e&&(v.TgZ(0,"div"),v.TgZ(1,"div",4),v._UZ(2,"mat-icon",5),v.ALo(3,"translate"),v.TgZ(4,"div",6),v.TgZ(5,"div",7),v.TgZ(6,"a",8),v._uU(7),v.qZA(),v.TgZ(8,"span",9),v._uU(9),v.qZA(),v.YNc(10,L,3,0,"button",10),v.YNc(11,x,3,0,"button",10),v.qZA(),v.TgZ(12,"span",11),v._uU(13),v.ALo(14,"translate"),v.ALo(15,"translate"),v.qZA(),v.qZA(),v.qZA(),v._UZ(16,"app-animated-router-outlet"),v.qZA()),2&e){var i=v.oxw();v.xp6(2),v.s9C("matTooltip",v.lcZ(3,10,"FACILITY_DETAIL.ENTITY")),v.Q6J("ngStyle",v.DdM(16,O)),v.xp6(4),v.Q6J("routerLink",v.VKq(17,R,i.facility.id)),v.xp6(1),v.Oqu(i.facility.name),v.xp6(2),v.hij(" \xa0#",i.facility.id," "),v.xp6(1),v.Q6J("ngIf",i.editFacilityAuth),v.xp6(1),v.Q6J("ngIf",i.deleteAuth),v.xp6(2),v.lnq(" ",v.lcZ(14,12,"FACILITY_DETAIL.ENTITY"),", ",v.lcZ(15,14,"FACILITY_DETAIL.DESCRIPTION"),": ",i.facility.description," ")}}var N=function(){var e=function(){function e(t,i,a,n,l,r,o,c){s(this,e),this.dialog=t,this.facilityManager=i,this.route=a,this.sideMenuService=n,this.sideMenuItemService=l,this.guiAuthResolver=r,this.router=o,this.entityStorageService=c,this.editFacilityAuth=!1,this.deleteAuth=!1,this.loading=!1}return r(e,[{key:"ngOnInit",value:function(){var e=this;this.loading=!0,this.route.params.subscribe(function(t){e.facilityManager.getFacilityById(t.facilityId).subscribe(function(t){e.facility=t,e.entityStorageService.setEntity({id:t.id,beanName:t.beanName});var i=e.sideMenuItemService.parseFacility(t);e.sideMenuService.setFacilityMenuItems([i]),e.editFacilityAuth=e.guiAuthResolver.isAuthorized("updateFacility_Facility_policy",[e.facility]),e.deleteAuth=e.guiAuthResolver.isAuthorized("deleteFacility_Facility_Boolean_policy",[e.facility]),(0,p.sF)("facilities",e.facility),(0,p.XI)(e.facility),e.loading=!1},function(){return e.loading=!1})})}},{key:"editFacility",value:function(){var e=this,t=(0,p.kZ)();t.width="450px",t.data={theme:"facility-theme",facility:this.facility,dialogType:m.Eg.FACILITY},this.dialog.open(m.rd,t).afterClosed().subscribe(function(t){t&&e.facilityManager.getFacilityById(e.facility.id).subscribe(function(t){e.facility=t})})}},{key:"deleteFacility",value:function(){var e=this,t=(0,p.kZ)();t.width="500px",t.data={theme:"facility-theme",facility:this.facility},this.dialog.open(S.Y,t).afterClosed().subscribe(function(t){t&&e.router.navigate([""])})}}]),e}();return e.\u0275fac=function(t){return new(t||e)(v.Y36(A.uw),v.Y36(f.IQ),v.Y36(c.gz),v.Y36(T.D),v.Y36(h.V),v.Y36(g.x4),v.Y36(c.F0),v.Y36(g.fb))},e.\u0275cmp=v.Xpm({type:e,selectors:[["app-facility-detail-page"]],decls:4,vars:2,consts:[[1,"container-fluid","pl-xl-5","pr-xl-5","facility-theme"],["class","mr-auto ml-auto",4,"ngIf"],[4,"ngIf"],[1,"mr-auto","ml-auto"],[1,"d-flex","page-title-headtitle"],["svgIcon","perun-facility-black",1,"perun-icon","perun-icon-detail",3,"matTooltip","ngStyle"],[1,"page-title-block"],[1,"page-title-headline","d-flex","align-items-center"],["queryParamsHandling","merge",1,"facility-link",3,"routerLink"],[1,"text-muted"],["mat-icon-button","",3,"click",4,"ngIf"],[1,"mt-1","entity-info"],["mat-icon-button","",3,"click"]],template:function(e,t){1&e&&(v.TgZ(0,"div",0),v._UZ(1,"perun-web-apps-back-button"),v.YNc(2,k,1,0,"mat-spinner",1),v.YNc(3,D,17,19,"div",2),v.qZA()),2&e&&(v.xp6(2),v.Q6J("ngIf",t.loading),v.xp6(1),v.Q6J("ngIf",!t.loading&&void 0!==t.facility))},directives:[I.W,o.O5,y.$g,b.Hw,E.gM,o.PC,c.yS,Z.A,C.lW],pipes:[_.X$],styles:[""],data:{animation:[d.Ji]}}),e}(),w=l(8557);function Y(e,t){1&e&&v._UZ(0,"mat-spinner",2)}function F(e,t){if(1&e&&(v.TgZ(0,"div"),v._UZ(1,"perun-web-apps-menu-buttons-field",3),v.qZA()),2&e){var i=v.oxw();v.xp6(1),v.Q6J("items",i.navItems)("size","small")}}var M=function(){var e=function(){function e(t,i,a){s(this,e),this.facilityManager=t,this.authResolver=i,this.entityStorageService=a,this.navItems=[],this.loading=!1}return r(e,[{key:"ngOnInit",value:function(){this.loading=!0,this.facility=this.entityStorageService.getEntity(),this.initItems(),this.loading=!1}},{key:"initItems",value:function(){this.navItems=[],this.authResolver.isAuthorized("getAssignedRichResources_Facility_policy",[this.facility])&&this.navItems.push({cssIcon:"perun-manage-facility",url:"/facilities/".concat(this.facility.id,"/resources"),label:"MENU_ITEMS.FACILITY.RESOURCES",style:"facility-btn"}),this.authResolver.isAuthorized("getAssignedUsers_Facility_Service_policy",[this.facility])&&this.navItems.push({cssIcon:"perun-user",url:"/facilities/".concat(this.facility.id,"/allowed-users"),label:"MENU_ITEMS.FACILITY.ALLOWED_USERS",style:"facility-btn"}),this.authResolver.isAuthorized("getAllowedGroups_Facility_Vo_Service_policy",[this.facility])&&this.navItems.push({cssIcon:"perun-group",url:"/facilities/".concat(this.facility.id,"/allowed-groups"),label:"MENU_ITEMS.FACILITY.ALLOWED_GROUPS",style:"facility-btn"}),this.authResolver.isAuthorized("getFacilityServicesState_Facility_policy",[this.facility])&&this.navItems.push({cssIcon:"perun-service-status",url:"/facilities/".concat(this.facility.id,"/services-status"),label:"MENU_ITEMS.FACILITY.SERVICES_STATUS",style:"facility-btn"}),this.authResolver.isAuthorized("getAllRichDestinations_Facility_policy",[this.facility])&&this.navItems.push({cssIcon:"perun-service_destination",url:"/facilities/".concat(this.facility.id,"/services-destinations"),label:"MENU_ITEMS.FACILITY.SERVICES_DESTINATIONS",style:"facility-btn"}),this.authResolver.isFacilityAdmin()&&this.navItems.push({cssIcon:"perun-hosts",url:"/facilities/".concat(this.facility.id,"/hosts"),label:"MENU_ITEMS.FACILITY.HOSTS",style:"facility-btn"}),this.navItems.push({cssIcon:"perun-attributes",url:"/facilities/".concat(this.facility.id,"/attributes"),label:"MENU_ITEMS.FACILITY.ATTRIBUTES",style:"facility-btn"}),(this.authResolver.isAuthorized("getBansForFacility_int_policy",[this.facility])||this.authResolver.isManagerPagePrivileged(this.facility)||this.authResolver.isAuthorized("getOwners_Facility_policy",[this.facility])||this.authResolver.isAuthorized("getAssignedSecurityTeams_Facility_policy",[this.facility]))&&this.navItems.push({cssIcon:"perun-settings2",url:"/facilities/".concat(this.facility.id,"/settings"),label:"MENU_ITEMS.FACILITY.SETTINGS",style:"facility-btn"})}}]),e}();return e.\u0275fac=function(t){return new(t||e)(v.Y36(f.IQ),v.Y36(g.x4),v.Y36(g.fb))},e.\u0275cmp=v.Xpm({type:e,selectors:[["app-facility-overview"]],hostVars:2,hostBindings:function(e,t){2&e&&v.ekj("router-component",t.true)},decls:2,vars:2,consts:[["class","mr-auto ml-auto",4,"ngIf"],[4,"ngIf"],[1,"mr-auto","ml-auto"],[3,"items","size"]],template:function(e,t){1&e&&(v.YNc(0,Y,1,0,"mat-spinner",0),v.YNc(1,F,2,2,"div",1)),2&e&&(v.Q6J("ngIf",t.loading),v.xp6(1),v.Q6J("ngIf",!t.loading))},directives:[o.O5,y.$g,w.L],styles:[""]}),e}(),U=l(64467),q=l(39124),J=l(72920),Q=l(76527),V=function(){var e=function e(){s(this,e)};return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=v.Xpm({type:e,selectors:[["app-facility-settings"]],hostVars:2,hostBindings:function(e,t){2&e&&v.ekj("router-component",t.true)},decls:1,vars:0,template:function(e,t){1&e&&v._UZ(0,"app-animated-router-outlet")},directives:[Z.A],styles:[""],data:{animation:[d.Ji]}}),e}();function H(e,t){1&e&&v._UZ(0,"mat-spinner",2)}function P(e,t){if(1&e&&(v.TgZ(0,"div"),v._UZ(1,"perun-web-apps-menu-buttons-field",3),v.qZA()),2&e){var i=v.oxw();v.xp6(1),v.Q6J("items",i.items)("size","small")}}var B=function(){var e=function(){function e(t,i,a){s(this,e),this.facilityManager=t,this.authResolver=i,this.entityStorageService=a,this.items=[],this.loading=!1}return r(e,[{key:"ngOnInit",value:function(){this.loading=!0,this.facility=this.entityStorageService.getEntity(),this.initItems(),this.loading=!1}},{key:"initItems",value:function(){this.items=[],this.authResolver.isAuthorized("getOwners_Facility_policy",[this.facility])&&this.items.push({cssIcon:"perun-owner-grey",url:"/facilities/".concat(this.facility.id,"/settings/owners"),label:"MENU_ITEMS.FACILITY.OWNERS",style:"facility-btn"}),this.authResolver.isManagerPagePrivileged(this.facility)&&this.items.push({cssIcon:"perun-manager",url:"/facilities/".concat(this.facility.id,"/settings/managers"),label:"MENU_ITEMS.FACILITY.MANAGERS",style:"facility-btn"}),this.authResolver.isAuthorized("getAssignedSecurityTeams_Facility_policy",[this.facility])&&this.items.push({cssIcon:"perun-security-teams",url:"/facilities/".concat(this.facility.id,"/settings/security-teams"),label:"MENU_ITEMS.FACILITY.SECURITY_TEAMS",style:"facility-btn"}),this.authResolver.isAuthorized("getBansForFacility_int_policy",[this.facility])&&this.items.push({cssIcon:"perun-black-list",url:"/facilities/".concat(this.facility.id,"/settings/blacklist"),label:"MENU_ITEMS.FACILITY.BLACKLIST",style:"facility-btn"})}}]),e}();return e.\u0275fac=function(t){return new(t||e)(v.Y36(f.IQ),v.Y36(g.x4),v.Y36(g.fb))},e.\u0275cmp=v.Xpm({type:e,selectors:[["app-facility-settings-overview"]],hostVars:2,hostBindings:function(e,t){2&e&&v.ekj("router-component",t.true)},decls:2,vars:2,consts:[["class","mr-auto ml-auto",4,"ngIf"],[4,"ngIf"],[1,"mr-auto","ml-auto"],[3,"items","size"]],template:function(e,t){1&e&&(v.YNc(0,H,1,0,"mat-spinner",0),v.YNc(1,P,2,2,"div",1)),2&e&&(v.Q6J("ngIf",t.loading),v.xp6(1),v.Q6J("ngIf",!t.loading))},directives:[o.O5,y.$g,w.L],styles:[""]}),e}(),G=l(55109),$=l(541),z=l(3417);function j(e,t){1&e&&(v._uU(0),v.ALo(1,"translate")),2&e&&v.hij(" ",v.lcZ(1,1,"FACILITY_DETAIL.ENTITY")," ")}function K(e,t){if(1&e&&v._UZ(0,"app-one-entity-attribute-page",4),2&e){var i=v.oxw();v.Q6J("entity","facility")("entityId",i.facility.id)}}function W(e,t){1&e&&(v._uU(0),v.ALo(1,"translate"),v.ALo(2,"translate")),2&e&&v.AsE(" ",v.lcZ(1,2,"FACILITY_DETAIL.ENTITY")," - ",v.lcZ(2,4,"ADMIN_USER.ENTITY")," ")}function X(e,t){if(1&e&&v._UZ(0,"app-two-entity-attribute-page",5),2&e){var i=v.oxw(2);v.Q6J("firstEntity","facility")("firstEntityId",i.facility.id)("secondEntity","user")}}function ee(e,t){1&e&&(v.TgZ(0,"mat-tab"),v.YNc(1,W,3,6,"ng-template",1),v.YNc(2,X,1,3,"ng-template",2),v.qZA())}var te=function(){var e=function(){function e(t,i){s(this,e),this.authResolver=t,this.entityStorageService=i}return r(e,[{key:"ngOnInit",value:function(){this.facility=this.entityStorageService.getEntity(),this.facilityUserAttAuth=this.authResolver.isAuthorized("getAssignedUsers_Facility_policy",[this.facility])}}]),e}();return e.\u0275fac=function(t){return new(t||e)(v.Y36(g.x4),v.Y36(g.fb))},e.\u0275cmp=v.Xpm({type:e,selectors:[["app-facility-attributes"]],hostVars:2,hostBindings:function(e,t){2&e&&v.ekj("router-component",t.true)},decls:9,vars:4,consts:[[1,"page-subtitle"],["matTabLabel",""],["matTabContent",""],[4,"ngIf"],[3,"entity","entityId"],[3,"firstEntity","firstEntityId","secondEntity"]],template:function(e,t){1&e&&(v.TgZ(0,"div"),v.TgZ(1,"h1",0),v._uU(2),v.ALo(3,"translate"),v.qZA(),v.TgZ(4,"mat-tab-group"),v.TgZ(5,"mat-tab"),v.YNc(6,j,2,3,"ng-template",1),v.YNc(7,K,1,2,"ng-template",2),v.qZA(),v.YNc(8,ee,3,0,"mat-tab",3),v.qZA(),v.qZA()),2&e&&(v.xp6(2),v.Oqu(v.lcZ(3,2,"FACILITY_DETAIL.SETTINGS.ATTRIBUTES.TITLE")),v.xp6(6),v.Q6J("ngIf",t.facilityUserAttAuth))},directives:[G.SP,G.uX,G.uD,G.Vc,o.O5,$.t,z.Y],pipes:[_.X$],styles:[""]}),e}(),ie=l(77968),ae=l(22927),ne=l(79472),se=l(42473),le=l(16073),re=l(56238),oe=l(79996),ce=l(22280),ue=l(29236),de=l(66283),he=l(80340),fe=l(40084),pe=l(71522),ge=l(22196);function me(e,t){if(1&e){var i=v.EpF();v.TgZ(0,"mat-option",10),v.NdJ("onSelectionChange",function(){var e=v.CHM(i).$implicit;return v.oxw(3).onSelectedService(e)}),v._uU(1),v.qZA()}if(2&e){var a=t.$implicit;v.Q6J("value",a),v.xp6(1),v.hij(" ",a.name," ")}}function Se(e,t){if(1&e){var i=v.EpF();v.TgZ(0,"mat-form-field",6),v.TgZ(1,"input",7),v.NdJ("keyup",function(e){return v.CHM(i),v.oxw(2).updatedSerVal(e)}),v.ALo(2,"translate"),v.qZA(),v.TgZ(3,"mat-autocomplete",8,9),v.TgZ(5,"mat-option",10),v.NdJ("onSelectionChange",function(){return v.CHM(i),v.oxw(2).onSelectedService("NOT_SELECTED")}),v._uU(6),v.ALo(7,"translate"),v.qZA(),v.TgZ(8,"mat-option",10),v.NdJ("onSelectionChange",function(){return v.CHM(i),v.oxw(2).onSelectedService("ALL")}),v._uU(9),v.ALo(10,"translate"),v.qZA(),v.YNc(11,me,2,2,"mat-option",11),v.ALo(12,"async"),v.qZA(),v.qZA()}if(2&e){var a=v.MAs(4),n=v.oxw(2);v.xp6(1),v.s9C("placeholder",v.lcZ(2,9,"FACILITY_DETAIL.SERVICE_CONFIG.SERVICE_SELECT")),v.Q6J("formControl",n.serviceField)("matAutocomplete",a),v.xp6(2),v.Q6J("displayWith",n.serviceDisplayFn.bind(n)),v.xp6(2),v.Q6J("value","NOT_SELECTED"),v.xp6(1),v.hij(" ",v.lcZ(7,11,"FACILITY_DETAIL.SERVICE_CONFIG.NOT_SELECTED")," "),v.xp6(2),v.Q6J("value","ALL"),v.xp6(1),v.hij(" ",v.lcZ(10,13,"FACILITY_DETAIL.SERVICE_CONFIG.ALL")," "),v.xp6(2),v.Q6J("ngForOf",v.lcZ(12,15,n.filteredServices))}}function ve(e,t){if(1&e){var i=v.EpF();v.TgZ(0,"mat-option",10),v.NdJ("onSelectionChange",function(){var e=v.CHM(i).$implicit;return v.oxw(3).onSelectedResource(e)}),v._uU(1),v.qZA()}if(2&e){var a=t.$implicit;v.Q6J("value",a),v.xp6(1),v.hij(" ",a.name," ")}}function Ae(e,t){if(1&e){var i=v.EpF();v.TgZ(0,"mat-form-field",6),v.TgZ(1,"input",12),v.NdJ("keyup",function(e){return v.CHM(i),v.oxw(2).updatedResVal(e)}),v.ALo(2,"translate"),v.qZA(),v.TgZ(3,"mat-autocomplete",8,9),v.YNc(5,ve,2,2,"mat-option",11),v.ALo(6,"async"),v.qZA(),v.qZA()}if(2&e){var a=v.MAs(4),n=v.oxw(2);v.xp6(1),v.s9C("placeholder",v.lcZ(2,5,"FACILITY_DETAIL.SERVICE_CONFIG.RES_SELECT")),v.Q6J("matAutocomplete",a)("formControl",n.resourceField),v.xp6(2),v.Q6J("displayWith",n.resourceDisplayFn.bind(n)),v.xp6(2),v.Q6J("ngForOf",v.lcZ(6,7,n.filteredResources))}}function Te(e,t){if(1&e){var i=v.EpF();v.TgZ(0,"mat-option",10),v.NdJ("onSelectionChange",function(){var e=v.CHM(i).$implicit;return v.oxw(3).onSelectedGroup(e)}),v._uU(1),v.qZA()}if(2&e){var a=t.$implicit;v.Q6J("value",a),v.xp6(1),v.hij(" ",a.name," ")}}function Ie(e,t){if(1&e){var i=v.EpF();v.TgZ(0,"mat-form-field",6),v.TgZ(1,"input",12),v.NdJ("keyup",function(e){return v.CHM(i),v.oxw(2).updatedGroupVal(e)}),v.ALo(2,"translate"),v.qZA(),v.TgZ(3,"mat-autocomplete",13,9),v.YNc(5,Te,2,2,"mat-option",11),v.ALo(6,"async"),v.qZA(),v.qZA()}if(2&e){var a=v.MAs(4),n=v.oxw(2);v.xp6(1),v.s9C("placeholder",v.lcZ(2,5,"FACILITY_DETAIL.SERVICE_CONFIG.GROUP_SELECT")),v.Q6J("matAutocomplete",a)("formControl",n.groupField),v.xp6(2),v.Q6J("displayWith",n.groupDisplayFn.bind(n)),v.xp6(2),v.Q6J("ngForOf",v.lcZ(6,7,n.filteredGroups))}}function ye(e,t){if(1&e){var i=v.EpF();v.TgZ(0,"mat-option",10),v.NdJ("onSelectionChange",function(){var e=v.CHM(i).$implicit;return v.oxw(3).onSelectedMember(e)}),v._uU(1),v.ALo(2,"userFullName"),v.qZA()}if(2&e){var a=t.$implicit;v.Q6J("value",a),v.xp6(1),v.hij(" ",v.lcZ(2,2,a.user)," ")}}function be(e,t){if(1&e&&(v.TgZ(0,"mat-form-field",6),v._UZ(1,"input",14),v.ALo(2,"translate"),v.TgZ(3,"mat-autocomplete",8,9),v.YNc(5,ye,3,4,"mat-option",11),v.ALo(6,"async"),v.qZA(),v.qZA()),2&e){var i=v.MAs(4),a=v.oxw(2);v.xp6(1),v.s9C("placeholder",v.lcZ(2,5,"FACILITY_DETAIL.SERVICE_CONFIG.MEMBER_SELECT")),v.Q6J("formControl",a.memberField)("matAutocomplete",i),v.xp6(2),v.Q6J("displayWith",a.memberDisplayFn.bind(a)),v.xp6(2),v.Q6J("ngForOf",v.lcZ(6,7,a.filteredMembers))}}function Ee(e,t){if(1&e){var i=v.EpF();v.TgZ(0,"div",3),v.YNc(1,Se,13,17,"mat-form-field",4),v.TgZ(2,"mat-checkbox",5),v.NdJ("change",function(e){return v.CHM(i),v.oxw().onOfferAllServices(e)}),v._uU(3),v.ALo(4,"translate"),v.qZA(),v.YNc(5,Ae,7,9,"mat-form-field",4),v.YNc(6,Ie,7,9,"mat-form-field",4),v.YNc(7,be,7,9,"mat-form-field",4),v.qZA()}if(2&e){var a=v.oxw();v.xp6(1),v.Q6J("ngIf",void 0!==a.services),v.xp6(2),v.hij(" ",v.lcZ(4,5,"FACILITY_DETAIL.SERVICE_CONFIG.ALL_SERVICES")," "),v.xp6(2),v.Q6J("ngIf",void 0!==a.resources&&0!==a.resources.length),v.xp6(1),v.Q6J("ngIf",void 0!==a.selectedResource&&void 0!==a.groups&&0!==a.groups.length),v.xp6(1),v.Q6J("ngIf",void 0!==a.selectedGroup&&void 0!==a.members&&0!==a.members.length)}}function Ze(e,t){if(1&e&&v._UZ(0,"perun-web-apps-service-configurator",15),2&e){var i=v.oxw();v.Q6J("facility",i.facility)("resource",i.selectedResource)("group",i.selectedGroup)("service",i.selectedService)("member",i.selectedMember)}}var Ce=function(){var e=function(){function e(t,i,a,n,l,r,o){var c=this;s(this,e),this.facilityManager=t,this.resourceManager=i,this.serviceManager=a,this.membersManager=n,this.namePipe=l,this.translate=r,this.entityStorageService=o,this.selectedService="NOT_SELECTED",this.attrNames=[],this.serviceField=new le.NI,this.resourceField=new le.NI,this.groupField=new le.NI,this.memberField=new le.NI,this.allowedStatuses=["INVALID","VALID"],this.translate.get("FACILITY_DETAIL.SERVICE_CONFIG.ALL").subscribe(function(e){return c.serviceAllTranslation=e}),this.translate.get("FACILITY_DETAIL.SERVICE_CONFIG.NOT_SELECTED").subscribe(function(e){return c.serviceNotSelectedTranslation=e})}return r(e,[{key:"ngOnInit",value:function(){var e=this;this.facility=this.entityStorageService.getEntity(),this.facilityManager.getFacilityById(this.facility.id).subscribe(function(t){e.facility=t,e.facilityManager.getAssignedResourcesForFacility(t.id).subscribe(function(t){return e.resources=t}),e.serviceManager.getAssignedServices(t.id).subscribe(function(t){return e.services=t})}),this.filteredServices=this.serviceField.valueChanges.pipe((0,re.O)(""),(0,oe.U)(function(t){return e._filterServices(t)})),this.filteredResources=this.resourceField.valueChanges.pipe((0,re.O)(""),(0,oe.U)(function(t){return e._filterResources(t)})),this.filteredGroups=this.groupField.valueChanges.pipe((0,re.O)(""),(0,oe.U)(function(t){return e._filterGroups(t)})),this.filteredMembers=this.memberField.valueChanges.pipe((0,re.O)(""),(0,oe.U)(function(t){return e._filterMembers(t)}))}},{key:"onSelectedService",value:function(e){this.selectedService=e}},{key:"onSelectedResource",value:function(e){var t=this;this.selectedResource=e,void 0!==this.selectedResource?(this.resourceManager.getAssignedGroups(this.selectedResource.id).subscribe(function(e){return t.groups=e}),this.selectedGroup=void 0,this.selectedMember=void 0):this.groups=void 0}},{key:"onOfferAllServices",value:function(e){var t=this;e.checked||this.serviceManager.getAssignedServices(this.facility.id).subscribe(function(e){return t.services=e})}},{key:"onSelectedGroup",value:function(e){var t=this;this.selectedGroup=e,void 0!==this.selectedGroup?(this.membersManager.getCompleteRichMembersForGroup(this.selectedGroup.id,!1,this.allowedStatuses,this.attrNames).subscribe(function(e){return t.members=e}),this.selectedMember=void 0):this.members=void 0}},{key:"onSelectedMember",value:function(e){this.selectedMember=e}},{key:"_filterServices",value:function(e){var t=e.toString().toLowerCase();return this.services.filter(function(e){return e.name.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").includes(t)})}},{key:"_filterResources",value:function(e){var t=e.toString().toLowerCase();return this.resources.filter(function(e){return e.name.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").includes(t)})}},{key:"_filterGroups",value:function(e){var t=e.toString().toLowerCase();return this.groups.filter(function(e){return e.name.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").includes(t)})}},{key:"_filterMembers",value:function(e){var t=this,i=e.toString().toLowerCase();return this.members.filter(function(e){return t.namePipe.transform(e.user).toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").includes(i)})}},{key:"serviceDisplayFn",value:function(e){if(null!==e)return"ALL"===e?this.serviceAllTranslation:"NOT_SELECTED"===e?this.serviceNotSelectedTranslation:e.name}},{key:"resourceDisplayFn",value:function(e){if(null!==e)return e.name}},{key:"groupDisplayFn",value:function(e){if(null!==e)return e.name}},{key:"memberDisplayFn",value:function(e){if(null!==e)return this.namePipe.transform(e.user)}},{key:"updatedSerVal",value:function(e){""===e.target.value&&(this.selectedService="NOT_SELECTED")}},{key:"updatedResVal",value:function(e){""===e.target.value&&(this.groups=void 0,this.members=void 0)}},{key:"updatedGroupVal",value:function(e){""===e.target.value&&(this.members=void 0)}},{key:"updatedMemVal",value:function(e){}}]),e}();return e.\u0275fac=function(t){return new(t||e)(v.Y36(f.IQ),v.Y36(f.xk),v.Y36(f.KK),v.Y36(f.uq),v.Y36(ce.dp),v.Y36(_.sK),v.Y36(g.fb))},e.\u0275cmp=v.Xpm({type:e,selectors:[["app-facility-service-config"]],decls:6,vars:5,consts:[[1,"page-subtitle"],["class","col-12 col-lg-6 mb-2",4,"ngIf"],[3,"facility","resource","group","service","member",4,"ngIf"],[1,"col-12","col-lg-6","mb-2"],["class","w-100",4,"ngIf"],[3,"change"],[1,"w-100"],["type","text","matInput","",3,"placeholder","formControl","matAutocomplete","keyup"],["autoActiveFirstOption","",3,"displayWith"],["auto","matAutocomplete"],[3,"value","onSelectionChange"],[3,"value","onSelectionChange",4,"ngFor","ngForOf"],["type","text","matInput","",3,"placeholder","matAutocomplete","formControl","keyup"],["autoActiveFirstOption","",3,"ngClass","displayWith"],["type","text","matInput","",3,"placeholder","formControl","matAutocomplete"],[3,"facility","resource","group","service","member"]],template:function(e,t){1&e&&(v.TgZ(0,"div"),v.TgZ(1,"h1",0),v._uU(2),v.ALo(3,"translate"),v.qZA(),v.YNc(4,Ee,8,7,"div",1),v.YNc(5,Ze,1,5,"perun-web-apps-service-configurator",2),v.qZA()),2&e&&(v.xp6(2),v.Oqu(v.lcZ(3,3,"FACILITY_DETAIL.SERVICE_CONFIG.TITLE")),v.xp6(2),v.Q6J("ngIf",!!t.facility),v.xp6(1),v.Q6J("ngIf",!!t.facility))},directives:[o.O5,ue.oG,de.KE,he.Nt,le.Fj,fe.ZL,le.JJ,le.oH,fe.XC,pe.ey,o.sg,o.mk],pipes:[_.X$,o.Ov,ge.d],styles:[""]}),e}(),_e=l(489),ke=function(){var e=function(){function e(t,i,a){s(this,e),this.facilityService=t,this.guiAuthResolver=i,this.entityStorageService=a,this.availableRoles=[],this.selected="user",this.type="Facility",this.theme="facility-theme"}return r(e,[{key:"ngOnInit",value:function(){this.facility=this.entityStorageService.getEntity(),this.guiAuthResolver.assignAvailableRoles(this.availableRoles,"Facility")}}]),e}();return e.\u0275fac=function(t){return new(t||e)(v.Y36(f.IQ),v.Y36(g.x4),v.Y36(g.fb))},e.\u0275cmp=v.Xpm({type:e,selectors:[["app-perun-web-apps-facility-settings-managers"]],hostVars:2,hostBindings:function(e,t){2&e&&v.ekj("router-component",t.true)},decls:1,vars:4,consts:[[3,"complementaryObject","complementaryObjectType","theme","availableRoles"]],template:function(e,t){1&e&&v._UZ(0,"app-managers-page",0),2&e&&v.Q6J("complementaryObject",t.facility)("complementaryObjectType",t.type)("theme",t.theme)("availableRoles",t.availableRoles)},directives:[_e.s],styles:[""]}),e}(),Le=l(60611),xe=l(4230),Oe=l(60547),Re=l(4786);function De(e,t){1&e&&v._UZ(0,"mat-spinner",6)}function Ne(e,t){1&e&&(v.TgZ(0,"mat-option",19),v._uU(1),v.ALo(2,"translate"),v.qZA()),2&e&&(v.xp6(1),v.Oqu(v.lcZ(2,1,"DIALOGS.ADD_SERVICE_DESTINATION.SELECTION_ALL")))}function we(e,t){1&e&&(v.TgZ(0,"mat-option",20),v._uU(1),v.ALo(2,"translate"),v.qZA()),2&e&&(v.xp6(1),v.Oqu(v.lcZ(2,1,"DIALOGS.ADD_SERVICE_DESTINATION.NO_SERVICE")))}function Ye(e,t){if(1&e&&(v.TgZ(0,"mat-option",21),v._uU(1),v.qZA()),2&e){var i=t.$implicit;v.Q6J("value",i),v.xp6(1),v.hij(" ",i.name," ")}}function Fe(e,t){1&e&&(v.TgZ(0,"mat-error"),v._uU(1),v.ALo(2,"translate"),v.qZA()),2&e&&(v.xp6(1),v.hij(" ",v.lcZ(2,1,"DIALOGS.ADD_SERVICE_DESTINATION.CHOOSE_SERVICE")," "))}function Me(e,t){if(1&e&&(v.TgZ(0,"mat-option",21),v._uU(1),v.qZA()),2&e){var i=t.$implicit,a=v.oxw(2);v.Q6J("value",i),v.xp6(1),v.hij(" ",a.getTypeForView(i)," ")}}function Ue(e,t){1&e&&(v.TgZ(0,"mat-error"),v._uU(1),v.ALo(2,"translate"),v.qZA()),2&e&&(v.xp6(1),v.hij(" ",v.lcZ(2,1,"DIALOGS.ADD_SERVICE_DESTINATION.REQUIRED_FIELD")," "))}function qe(e,t){1&e&&(v.TgZ(0,"mat-error"),v._uU(1),v.ALo(2,"translate"),v.qZA()),2&e&&(v.xp6(1),v.hij(" ",v.lcZ(2,1,"DIALOGS.ADD_SERVICE_DESTINATION.INVALID_DESTINATION")," "))}function Je(e,t){if(1&e&&(v.TgZ(0,"mat-form-field",22),v._UZ(1,"input",23),v.YNc(2,Ue,3,3,"mat-error",13),v.YNc(3,qe,3,3,"mat-error",13),v.qZA()),2&e){var i=v.oxw(2);v.xp6(1),v.s9C("placeholder",i.getTypeForView(i.selectedType)),v.Q6J("formControl",i.destinationControl),v.xp6(1),v.Q6J("ngIf","host"===i.selectedType&&!i.useFacilityHost&&i.destinationControl.hasError("required")),v.xp6(1),v.Q6J("ngIf",i.destinationControl.hasError("invalidDestination"))}}function Qe(e,t){if(1&e){var i=v.EpF();v.TgZ(0,"mat-checkbox",24),v.NdJ("ngModelChange",function(e){return v.CHM(i),v.oxw(2).useFacilityHost=e}),v._uU(1),v.ALo(2,"translate"),v.qZA()}if(2&e){var a=v.oxw(2);v.Q6J("ngModel",a.useFacilityHost),v.xp6(1),v.hij(" ",v.lcZ(2,2,"DIALOGS.ADD_SERVICE_DESTINATION.USE_FACILITY_HOST")," ")}}function Ve(e,t){if(1&e&&(v.TgZ(0,"mat-option",21),v._uU(1),v.qZA()),2&e){var i=t.$implicit;v.Q6J("value",i),v.xp6(1),v.hij(" ",i," ")}}function He(e,t){if(1&e){var i=v.EpF();v.TgZ(0,"div",7),v.TgZ(1,"div",8),v._uU(2),v.ALo(3,"translate"),v.qZA(),v.TgZ(4,"mat-form-field"),v.TgZ(5,"mat-select",9),v.ALo(6,"translate"),v.YNc(7,Ne,3,3,"mat-option",10),v.YNc(8,we,3,3,"mat-option",11),v.YNc(9,Ye,2,2,"mat-option",12),v.qZA(),v.YNc(10,Fe,3,3,"mat-error",13),v.qZA(),v.TgZ(11,"mat-checkbox",14),v.NdJ("change",function(){return v.CHM(i),v.oxw().getServices()})("ngModelChange",function(e){return v.CHM(i),v.oxw().servicesOnFacility=e}),v._uU(12),v.ALo(13,"translate"),v.qZA(),v.TgZ(14,"mat-form-field"),v.TgZ(15,"mat-select",15),v.NdJ("ngModelChange",function(e){return v.CHM(i),v.oxw().selectedType=e})("selectionChange",function(){return v.CHM(i),v.oxw().destinationControl.updateValueAndValidity()}),v.ALo(16,"translate"),v.YNc(17,Me,2,2,"mat-option",12),v.qZA(),v.qZA(),v.YNc(18,Je,4,4,"mat-form-field",16),v.YNc(19,Qe,3,4,"mat-checkbox",17),v.TgZ(20,"mat-form-field"),v.TgZ(21,"mat-select",18),v.NdJ("ngModelChange",function(e){return v.CHM(i),v.oxw().selectedPropagation=e}),v.ALo(22,"translate"),v.YNc(23,Ve,2,2,"mat-option",12),v.qZA(),v.qZA(),v.TgZ(24,"div",8),v._uU(25),v.ALo(26,"translate"),v.qZA(),v.qZA()}if(2&e){var a=v.oxw();v.xp6(2),v.Oqu(v.lcZ(3,18,"DIALOGS.ADD_SERVICE_DESTINATION.DESCRIPTION")),v.xp6(3),v.s9C("placeholder",v.lcZ(6,20,"DIALOGS.ADD_SERVICE_DESTINATION.SERVICE")),v.Q6J("formControl",a.serviceControl),v.xp6(2),v.Q6J("ngIf",0!==a.services.length),v.xp6(1),v.Q6J("ngIf",0===a.services.length),v.xp6(1),v.Q6J("ngForOf",a.services),v.xp6(1),v.Q6J("ngIf",void 0===a.serviceControl.value),v.xp6(1),v.Q6J("ngModel",a.servicesOnFacility),v.xp6(1),v.Oqu(v.lcZ(13,22,"DIALOGS.ADD_SERVICE_DESTINATION.IS_SERVICES_ONLY_ON_FACILITY")),v.xp6(3),v.s9C("placeholder",v.lcZ(16,24,"DIALOGS.ADD_SERVICE_DESTINATION.TYPE")),v.Q6J("ngModel",a.selectedType),v.xp6(2),v.Q6J("ngForOf",a.types),v.xp6(1),v.Q6J("ngIf",!("host"===a.selectedType&&a.useFacilityHost)),v.xp6(1),v.Q6J("ngIf","host"===a.selectedType),v.xp6(2),v.s9C("placeholder",v.lcZ(22,26,"DIALOGS.ADD_SERVICE_DESTINATION.PROPAGATION")),v.Q6J("ngModel",a.selectedPropagation),v.xp6(2),v.Q6J("ngForOf",a.propagations),v.xp6(2),v.hij(" ",v.lcZ(26,28,"DIALOGS.ADD_SERVICE_DESTINATION.PROPAGATION_TYPE_"+a.selectedPropagation)," ")}}var Pe=function(){var e=function(){function e(t,i,a,n){s(this,e),this.dialogRef=t,this.data=i,this.facilitiesManager=a,this.servicesManager=n,this.services=[],this.types=["host","user@host","user@host:port","user@host-windows","host-windows-proxy","url","email","semail","service-specific"],this.selectedType="host",this.propagations=["PARALLEL","DUMMY"],this.selectedPropagation="PARALLEL",this.useFacilityHost=!1,this.loading=!1,this.emailRegex=new RegExp(p.B2),this.hostPattern=new RegExp("^(?!:\\/\\/)(?=.{1,255}$)((.{1,63}\\.){1,127}(?![0-9]*$)[a-z0-9-]+\\.?)$|^(25[0-5]|2[0-4]\\d|[0-1]?\\d?\\d)(\\.(25[0-5]|2[0-4]\\d|[0-1]?\\d?\\d)){3}$"),this.urlPattern=new RegExp("^(https?|ftp|file)://[-a-zA-Z0-9+&@#/%?=~_|!:,.;()*$']*[-a-zA-Z0-9+&@#/%=~_|()*$']$"),this.userAtHostPattern=new RegExp("^[a-z_]([a-z0-9_-]{0,31}|[a-z0-9_-]{0,30}\\$)@(?:(?!:\\/\\/)(?=.{1,255}$)((.{1,63}\\.){1,127}(?![0-9]*$)[a-z0-9-]+\\.?)$|(25[0-5]|2[0-4]\\d|[0-1]?\\d?\\d)(\\.(25[0-5]|2[0-4]\\d|[0-1]?\\d?\\d)){3}$)"),this.userAtHostPortPattern=new RegExp("^[a-z_]([a-z0-9_-]{0,31}|[a-z0-9_-]{0,30}\\$)@(?:(?!:\\/\\/)(?=.{1,255}$)((.{1,63}\\.){1,127}(?![0-9]*$)[a-z0-9-]+\\.?)|(25[0-5]|2[0-4]\\d|[0-1]?\\d?\\d)(\\.(25[0-5]|2[0-4]\\d|[0-1]?\\d?\\d)){3}):[0-9]+"),this.serviceSpecificPattern=new RegExp("^(?!-)[a-zA-Z0-9-_.:/]*$")}return r(e,[{key:"ngOnInit",value:function(){var e=this;this.loading=!0,this.serviceControl=new le.NI(void 0,le.kI.required),this.destinationControl=new le.NI("",this.getDestinationValidator()),this.emailControl=new le.NI("",[le.kI.required,le.kI.pattern(this.emailRegex)]),this.facilitiesManager.getHosts(this.data.facility.id).subscribe(function(t){e.hosts=t,e.servicesOnFacility=!0,e.getServices(),e.loading=!1},function(){return e.loading=!1})}},{key:"getDestinationValidator",value:function(){var e=this;return function(t){if(!t.value)return null;var i;switch(e.selectedType){case"host":case"host-windows-proxy":i=e.hostPattern;break;case"email":case"semail":i=e.emailRegex;break;case"url":i=e.urlPattern;break;case"user@host":case"user@host-windows":i=e.userAtHostPattern;break;case"user@host:port":i=e.userAtHostPortPattern;break;case"service-specific":i=e.serviceSpecificPattern;break;default:return null}return i.test(t.value)?null:{invalidDestination:{value:t.value}}}}},{key:"onCancel",value:function(){this.dialogRef.close()}},{key:"onSubmit",value:function(){var e=this;this.loading=!0,"all"===this.serviceControl.value?this.useFacilityHost?this.servicesManager.addDestinationsDefinedByHostsOnFacilityWithListOfServiceAndFacility({services:this.services,facility:this.data.facility.id}).subscribe(function(){e.dialogRef.close(!0)},function(){return e.loading=!1}):this.servicesManager.addDestinationToMultipleServices({services:this.services,facility:this.data.facility.id,destination:this.destinationControl.value,type:this.selectedType,propagationType:this.selectedPropagation}).subscribe(function(){e.dialogRef.close(!0)},function(){return e.loading=!1}):this.useFacilityHost?this.servicesManager.addDestinationsDefinedByHostsOnFacilityWithServiceAndFacility(this.serviceControl.value.id,this.data.facility.id).subscribe(function(){e.dialogRef.close(!0)},function(){return e.loading=!1}):this.servicesManager.addDestination(this.serviceControl.value.id,this.data.facility.id,this.destinationControl.value,this.selectedType,this.selectedPropagation).subscribe(function(){e.dialogRef.close(!0)},function(){return e.loading=!1})}},{key:"getServices",value:function(){var e=this;this.loading=!0,this.servicesOnFacility?this.servicesManager.getAssignedServices(this.data.facility.id).subscribe(function(t){e.services=t},function(){return e.loading=!1}):this.servicesManager.getServices().subscribe(function(t){e.services=t},function(){return e.loading=!1}),this.loading=!1,this.serviceControl.setValue(void 0)}},{key:"getTypeForView",value:function(e){return"semail"===e?"Send Mail":"service-specific"===e?"Service Specific":e}},{key:"invalidDestination",value:function(){return("host"!==this.selectedType||!this.useFacilityHost)&&this.destinationControl.invalid}}]),e}();return e.\u0275fac=function(t){return new(t||e)(v.Y36(A.so),v.Y36(A.WI),v.Y36(f.IQ),v.Y36(f.KK))},e.\u0275cmp=v.Xpm({type:e,selectors:[["app-perun-web-apps-add-services-destination-dialog"]],decls:13,vars:15,consts:[["mat-dialog-title",""],["class","mr-auto ml-auto",4,"ngIf"],["mat-dialog-content","","class","dialog-container",4,"ngIf"],["mat-dialog-actions",""],["mat-flat-button","",1,"ml-auto",3,"click"],["color","accent","mat-flat-button","",1,"ml-2",3,"disabled","click"],[1,"mr-auto","ml-auto"],["mat-dialog-content","",1,"dialog-container"],[1,"font-italic"],["required","",3,"formControl","placeholder"],["value","all",4,"ngIf"],["value","noService",4,"ngIf"],[3,"value",4,"ngFor","ngForOf"],[4,"ngIf"],[3,"ngModel","change","ngModelChange"],[3,"ngModel","placeholder","ngModelChange","selectionChange"],["class","w-100",4,"ngIf"],[3,"ngModel","ngModelChange",4,"ngIf"],[3,"ngModel","placeholder","ngModelChange"],["value","all"],["value","noService"],[3,"value"],[1,"w-100"],["matInput","","required","",3,"formControl","placeholder"],[3,"ngModel","ngModelChange"]],template:function(e,t){1&e&&(v.TgZ(0,"div"),v.TgZ(1,"h1",0),v._uU(2),v.ALo(3,"translate"),v.qZA(),v.YNc(4,De,1,0,"mat-spinner",1),v.YNc(5,He,27,30,"div",2),v.TgZ(6,"div",3),v.TgZ(7,"button",4),v.NdJ("click",function(){return t.onCancel()}),v._uU(8),v.ALo(9,"translate"),v.qZA(),v.TgZ(10,"button",5),v.NdJ("click",function(){return t.onSubmit()}),v._uU(11),v.ALo(12,"translate"),v.qZA(),v.qZA(),v.qZA()),2&e&&(v.Tol(t.data.theme),v.xp6(2),v.Oqu(v.lcZ(3,9,"DIALOGS.ADD_SERVICE_DESTINATION.TITLE")),v.xp6(2),v.Q6J("ngIf",t.loading),v.xp6(1),v.Q6J("ngIf",!t.loading),v.xp6(3),v.hij(" ",v.lcZ(9,11,"DIALOGS.ADD_SERVICE_DESTINATION.CANCEL")," "),v.xp6(2),v.Q6J("disabled",t.loading||t.invalidDestination()||t.serviceControl.invalid||"noService"===t.serviceControl.value),v.xp6(1),v.hij(" ",v.lcZ(12,13,"DIALOGS.ADD_SERVICE_DESTINATION.ADD")," "))},directives:[A.uh,o.O5,A.H8,C.lW,y.$g,A.xY,de.KE,Re.gD,le.Q7,le.JJ,le.oH,o.sg,ue.oG,le.On,pe.ey,de.TO,he.Nt,le.Fj],pipes:[_.X$],styles:[""],data:{animation:[d.BQ]}}),e}(),Be=l(59403),Ge=l(19139),$e=l(94357);function ze(e,t){if(1&e){var i=v.EpF();v.TgZ(0,"button",8),v.NdJ("click",function(){return v.CHM(i),v.oxw().addDestination()}),v._uU(1),v.ALo(2,"translate"),v.qZA()}2&e&&(v.xp6(1),v.hij(" ",v.lcZ(2,1,"FACILITY_DETAIL.SERVICES_DESTINATIONS.ADD")," "))}function je(e,t){if(1&e){var i=v.EpF();v.TgZ(0,"button",9),v.NdJ("click",function(){return v.CHM(i),v.oxw().removeDestination()}),v._uU(1),v.ALo(2,"translate"),v.qZA()}if(2&e){var a=v.oxw();v.Q6J("disabled",0===a.selected.selected.length),v.xp6(1),v.hij(" ",v.lcZ(2,2,"FACILITY_DETAIL.SERVICES_DESTINATIONS.REMOVE")," ")}}function Ke(e,t){if(1&e){var i=v.EpF();v.TgZ(0,"button",10),v.NdJ("click",function(){return v.CHM(i),v.oxw().onAllow()}),v.TgZ(1,"mat-icon"),v._uU(2," check_circle_outline "),v.qZA(),v._uU(3),v.ALo(4,"translate"),v.qZA()}if(2&e){var a=v.oxw();v.Q6J("disabled",0===a.selected.selected.length||a.allSelectedAllowed()),v.xp6(3),v.hij(" ",v.lcZ(4,2,"FACILITY_DETAIL.SERVICES_DESTINATIONS.ALLOW")," ")}}function We(e,t){if(1&e){var i=v.EpF();v.TgZ(0,"button",10),v.NdJ("click",function(){return v.CHM(i),v.oxw().onBlock()}),v.TgZ(1,"mat-icon"),v._uU(2," block "),v.qZA(),v._uU(3),v.ALo(4,"translate"),v.qZA()}if(2&e){var a=v.oxw();v.Q6J("disabled",0===a.selected.selected.length||a.allSelectedBlocked()),v.xp6(3),v.hij(" ",v.lcZ(4,2,"FACILITY_DETAIL.SERVICES_DESTINATIONS.BLOCK")," ")}}function Xe(e,t){1&e&&v._UZ(0,"mat-spinner",11)}function et(e,t){if(1&e&&v._UZ(0,"app-perun-web-apps-destination-list",12),2&e){var i=v.oxw();v.Q6J("tableId",i.tableId)("filterValue",i.filterValue)("destinations",i.destinations)("selection",i.selected)("displayedColumns",i.displayedColumns)}}var tt=function(){var e=function(){function e(t,i,a,n,l,r,o,c){s(this,e),this.dialog=t,this.facilitiesManager=i,this.servicesManager=a,this.translate=n,this.notificator=l,this.authResolver=r,this.serviceManager=o,this.entityStorageService=c,this.selected=new xe.Ov(!0,[]),this.displayedColumns=["select","destinationId","service","destination","type","propagationType"],this.filterValue="",this.tableId=Le.Cf}return r(e,[{key:"ngOnInit",value:function(){this.loading=!0,this.facility=this.entityStorageService.getEntity(),this.setAuthRights(),this.refreshTable()}},{key:"refreshTable",value:function(){var e=this;this.loading=!0,this.servicesManager.getAllRichDestinationsForFacility(this.facility.id).subscribe(function(t){e.destinations=t,e.selected.clear(),e.setAuthRights(),e.loading=!1})}},{key:"setAuthRights",value:function(){this.addAuth=this.authResolver.isAuthorized("addDestination_Service_Facility_Destination_policy",[this.facility]),this.removeAuth=this.authResolver.isAuthorized("removeDestination_Service_Facility_Destination_policy",[this.facility]),this.allowAuth=this.authResolver.isAuthorized("unblockServiceOnDestination_Service_int_policy",[this.facility]),this.blockAuth=this.authResolver.isAuthorized("blockServiceOnDestination_Service_int_policy",[this.facility]),this.displayedColumns=this.removeAuth?["select","destinationId","service","destination","type","status","propagationType"]:["destinationId","service","destination","type","status","propagationType"]}},{key:"addDestination",value:function(){var e=this,t=(0,p.kZ)();t.width="600px",t.data={facility:this.facility,theme:"facility-theme"},this.dialog.open(Pe,t).afterClosed().subscribe(function(t){t&&e.translate.get("FACILITY_DETAIL.SERVICES_DESTINATIONS.ADD_SUCCESS").subscribe(function(t){e.refreshTable(),e.notificator.showSuccess(t)})})}},{key:"removeDestination",value:function(){var e=this,t=(0,p.kZ)();t.width="600px",t.data={destinations:this.selected.selected,theme:"facility-theme"},this.dialog.open(Oe.u,t).afterClosed().subscribe(function(t){t&&e.refreshTable()})}},{key:"blockServiceOnDestinations",value:function(e){var t=this;if(0===e.length)return this.notificator.showSuccess(this.translate.instant("FACILITY_DETAIL.SERVICES_DESTINATIONS.BLOCK_SUCCESS")),void this.refreshTable();var i=e.pop();this.serviceManager.blockServiceOnDestination(i.service.id,i.id).subscribe(function(){t.blockServiceOnDestinations(e)},function(){return t.loading=!1})}},{key:"onBlock",value:function(){this.loading=!0,this.blockServiceOnDestinations(this.selected.selected)}},{key:"allowServiceOnDestinations",value:function(e){var t=this;if(0===e.length)return this.notificator.showSuccess(this.translate.instant("FACILITY_DETAIL.SERVICES_DESTINATIONS.ALLOW_SUCCESS")),void this.refreshTable();var i=e.pop();this.serviceManager.unblockServiceOnDestinationById(i.service.id,i.id).subscribe(function(){t.allowServiceOnDestinations(e)},function(){return t.loading=!1})}},{key:"onAllow",value:function(){this.loading=!0,this.allowServiceOnDestinations(this.selected.selected)}},{key:"applyFilter",value:function(e){this.filterValue=e}},{key:"allSelectedAllowed",value:function(){return this.selected.selected.reduce(function(e,t){return e&&!t.blocked},!0)}},{key:"allSelectedBlocked",value:function(){return this.selected.selected.reduce(function(e,t){return e&&t.blocked},!0)}}]),e}();return e.id="FacilityServicesDestinationsComponent",e.\u0275fac=function(t){return new(t||e)(v.Y36(A.uw),v.Y36(f.IQ),v.Y36(f.KK),v.Y36(_.sK),v.Y36(g.V6),v.Y36(g.x4),v.Y36(f.KK),v.Y36(g.fb))},e.\u0275cmp=v.Xpm({type:e,selectors:[["app-perun-web-apps-facility-services-destinations"]],hostVars:2,hostBindings:function(e,t){2&e&&v.ekj("router-component",t.true)},decls:12,vars:10,consts:[[1,"page-subtitle"],[3,"refresh"],["mat-flat-button","","color","accent","class","mr-2 action-button",3,"click",4,"ngIf"],["mat-flat-button","","color","warn","class","mr-2",3,"disabled","click",4,"ngIf"],["mat-stroked-button","","class","mr-2",3,"disabled","click",4,"ngIf"],[3,"placeholder","filter"],["class","ml-auto mr-auto",4,"ngIf"],[3,"tableId","filterValue","destinations","selection","displayedColumns",4,"ngIf"],["mat-flat-button","","color","accent",1,"mr-2","action-button",3,"click"],["mat-flat-button","","color","warn",1,"mr-2",3,"disabled","click"],["mat-stroked-button","",1,"mr-2",3,"disabled","click"],[1,"ml-auto","mr-auto"],[3,"tableId","filterValue","destinations","selection","displayedColumns"]],template:function(e,t){1&e&&(v.TgZ(0,"div"),v.TgZ(1,"h1",0),v._uU(2),v.ALo(3,"translate"),v.qZA(),v.TgZ(4,"perun-web-apps-refresh-button",1),v.NdJ("refresh",function(){return t.refreshTable()}),v.qZA(),v.YNc(5,ze,3,3,"button",2),v.YNc(6,je,3,4,"button",3),v.YNc(7,Ke,5,4,"button",4),v.YNc(8,We,5,4,"button",4),v.TgZ(9,"perun-web-apps-immediate-filter",5),v.NdJ("filter",function(e){return t.applyFilter(e)}),v.qZA(),v.YNc(10,Xe,1,0,"mat-spinner",6),v.YNc(11,et,1,5,"app-perun-web-apps-destination-list",7),v.qZA()),2&e&&(v.xp6(2),v.Oqu(v.lcZ(3,8,"FACILITY_DETAIL.SERVICES_DESTINATIONS.TITLE")),v.xp6(3),v.Q6J("ngIf",t.addAuth),v.xp6(1),v.Q6J("ngIf",t.removeAuth),v.xp6(1),v.Q6J("ngIf",t.allowAuth),v.xp6(1),v.Q6J("ngIf",t.blockAuth),v.xp6(1),v.Q6J("placeholder","FACILITY_DETAIL.SERVICES_DESTINATIONS.FILTER"),v.xp6(1),v.Q6J("ngIf",t.loading),v.xp6(1),v.Q6J("ngIf",!t.loading))},directives:[Be.t,o.O5,Ge.L,C.lW,b.Hw,y.$g,$e.q],pipes:[_.X$],styles:[""]}),e}(),it=l(17767);function at(e,t){1&e&&v._UZ(0,"mat-spinner",3)}function nt(e,t){if(1&e){var i=v.EpF();v.TgZ(0,"div"),v.TgZ(1,"perun-web-apps-immediate-filter",4),v.NdJ("filter",function(e){return v.CHM(i),v.oxw().applyFilter(e)}),v.qZA(),v.TgZ(2,"div",5),v._UZ(3,"perun-web-apps-owners-list",6),v.qZA(),v.TgZ(4,"div",7),v.TgZ(5,"button",8),v.NdJ("click",function(){return v.CHM(i),v.oxw().onCancel()}),v._uU(6),v.ALo(7,"translate"),v.qZA(),v.TgZ(8,"button",9),v.NdJ("click",function(){return v.CHM(i),v.oxw().onAdd()}),v._uU(9),v.ALo(10,"translate"),v.qZA(),v.qZA(),v.qZA()}if(2&e){var a=v.oxw();v.xp6(1),v.Q6J("placeholder","DIALOGS.ADD_OWNERS.FILTER"),v.xp6(2),v.Q6J("filterValue",a.filterValue)("tableId",a.tableId)("owners",a.owners)("selection",a.selection),v.xp6(3),v.hij(" ",v.lcZ(7,8,"DIALOGS.ADD_OWNERS.CANCEL")," "),v.xp6(2),v.Q6J("disabled",0===a.selection.selected.length||a.loading),v.xp6(1),v.hij(" ",v.lcZ(10,10,"DIALOGS.ADD_OWNERS.ADD")," ")}}var st=function(){var e=function(){function e(t,i,a,n,l,r){var o=this;s(this,e),this.dialogRef=t,this.data=i,this.notificator=a,this.translate=n,this.ownersManagerService=l,this.facilitiesManagerService=r,this.extSources=[],this.selection=new xe.Ov(!0,[]),this.filterValue="",this.tableId=Le.BV,this.owners=[],this.translate.get("DIALOGS.ADD_OWNERS.SUCCESS").subscribe(function(e){return o.successMessage=e})}return r(e,[{key:"ngOnInit",value:function(){var e=this;this.theme=this.data.theme,this.loading=!0,this.ownersManagerService.getAllOwners().subscribe(function(t){e.owners=t.filter(function(t){return!e.data.forbiddenOwners.includes(t.id)}),e.loading=!1},function(){return e.loading=!1})}},{key:"applyFilter",value:function(e){this.filterValue=e}},{key:"onAdd",value:function(){var e=this;this.loading=!0,0!==this.selection.selected.length?this.facilitiesManagerService.addFacilityOwner(this.data.facilityId,this.selection.selected.pop().id).subscribe(function(){return e.onAdd()},function(){return e.loading=!1}):(this.loading=!1,this.notificator.showSuccess(this.successMessage),this.dialogRef.close(!0))}},{key:"onCancel",value:function(){this.dialogRef.close(!1)}}]),e}();return e.\u0275fac=function(t){return new(t||e)(v.Y36(A.so),v.Y36(A.WI),v.Y36(g.V6),v.Y36(_.sK),v.Y36(f.aC),v.Y36(f.IQ))},e.\u0275cmp=v.Xpm({type:e,selectors:[["app-add-facility-owner-dialog"]],decls:6,vars:8,consts:[["mat-dialog-title",""],["class","mr-auto ml-auto",4,"ngIf"],[4,"ngIf"],[1,"mr-auto","ml-auto"],[1,"font-size-1rem",3,"placeholder","filter"],["mat-dialog-content",""],[3,"filterValue","tableId","owners","selection"],["mat-dialog-actions",""],["mat-flat-button","",1,"ml-auto",3,"click"],["color","accent","mat-flat-button","",1,"ml-2",3,"disabled","click"]],template:function(e,t){1&e&&(v.TgZ(0,"h1",0),v._uU(1),v.ALo(2,"translate"),v.qZA(),v.TgZ(3,"div"),v.YNc(4,at,1,0,"mat-spinner",1),v.YNc(5,nt,11,12,"div",2),v.qZA()),2&e&&(v.xp6(1),v.Oqu(v.lcZ(2,6,"DIALOGS.ADD_OWNERS.TITLE")),v.xp6(2),v.Tol(t.theme),v.xp6(1),v.Q6J("ngIf",t.loading),v.xp6(1),v.Q6J("ngIf",!t.loading))},directives:[A.uh,o.O5,y.$g,Ge.L,A.xY,it.Q,A.H8,C.lW],pipes:[_.X$],styles:[""]}),e}(),lt=l(67033);function rt(e,t){1&e&&v._UZ(0,"mat-spinner",6)}function ot(e,t){1&e&&v._UZ(0,"th",15)}function ct(e,t){if(1&e&&(v.TgZ(0,"td",16),v._uU(1),v.qZA()),2&e){var i=t.$implicit;v.xp6(1),v.hij(" ",i.name," ")}}function ut(e,t){1&e&&v._UZ(0,"tr",17)}function dt(e,t){1&e&&v._UZ(0,"tr",18)}function ht(e,t){if(1&e&&(v.TgZ(0,"div",7),v.TgZ(1,"p"),v._uU(2),v.ALo(3,"translate"),v.qZA(),v.TgZ(4,"div",8),v._uU(5),v.ALo(6,"translate"),v.qZA(),v.TgZ(7,"table",9),v.ynx(8,10),v.YNc(9,ot,1,0,"th",11),v.YNc(10,ct,2,1,"td",12),v.BQk(),v.YNc(11,ut,1,0,"tr",13),v.YNc(12,dt,1,0,"tr",14),v.qZA(),v.qZA()),2&e){var i=v.oxw();v.xp6(2),v.hij(" ",v.lcZ(3,5,"DIALOGS.REMOVE_OWNERS.DESCRIPTION")," "),v.xp6(3),v.hij(" ",v.lcZ(6,7,"DIALOGS.REMOVE_OWNERS.ASK")," "),v.xp6(2),v.Q6J("dataSource",i.dataSource),v.xp6(4),v.Q6J("matHeaderRowDef",i.displayedColumns),v.xp6(1),v.Q6J("matRowDefColumns",i.displayedColumns)}}var ft=function(){var e=function(){function e(t,i,a,n,l){var r=this;s(this,e),this.dialogRef=t,this.data=i,this.notificator=a,this.translate=n,this.facilitiesManagerService=l,this.displayedColumns=["name"],n.get("DIALOGS.REMOVE_OWNERS.SUCCESS").subscribe(function(e){return r.successMessage=e})}return r(e,[{key:"ngOnInit",value:function(){this.dataSource=new lt.by(this.data.owners),this.theme=this.data.theme}},{key:"onCancel",value:function(){this.dialogRef.close(!1)}},{key:"onSubmit",value:function(){var e=this;this.loading=!0,0!==this.data.owners.length?this.facilitiesManagerService.removeFacilityOwner(this.data.facilityId,this.data.owners.pop().id).subscribe(function(){return e.onSubmit()},function(){return e.loading=!1}):(this.loading=!1,this.notificator.showSuccess(this.successMessage),this.dialogRef.close(!0))}}]),e}();return e.\u0275fac=function(t){return new(t||e)(v.Y36(A.so),v.Y36(A.WI),v.Y36(g.V6),v.Y36(_.sK),v.Y36(f.IQ))},e.\u0275cmp=v.Xpm({type:e,selectors:[["app-remove-facility-owner-dialog"]],decls:13,vars:15,consts:[["mat-dialog-title",""],["class","mr-auto ml-auto",4,"ngIf"],["mat-dialog-content","",4,"ngIf"],["mat-dialog-actions",""],["mat-flat-button","",1,"ml-auto",3,"click"],["color","warn","mat-flat-button","",1,"ml-2",3,"disabled","click"],[1,"mr-auto","ml-auto"],["mat-dialog-content",""],[1,"font-weight-bold"],["mat-table","",1,"w-100",3,"dataSource"],["matColumnDef","name"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["class","font-weight-bolder","mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["mat-header-cell",""],["mat-cell",""],["mat-header-row","",1,"font-weight-bolder"],["mat-row",""]],template:function(e,t){1&e&&(v.TgZ(0,"h1",0),v._uU(1),v.ALo(2,"translate"),v.qZA(),v.TgZ(3,"div"),v.YNc(4,rt,1,0,"mat-spinner",1),v.YNc(5,ht,13,9,"div",2),v.TgZ(6,"div",3),v.TgZ(7,"button",4),v.NdJ("click",function(){return t.onCancel()}),v._uU(8),v.ALo(9,"translate"),v.qZA(),v.TgZ(10,"button",5),v.NdJ("click",function(){return t.onSubmit()}),v._uU(11),v.ALo(12,"translate"),v.qZA(),v.qZA(),v.qZA()),2&e&&(v.xp6(1),v.Oqu(v.lcZ(2,9,"DIALOGS.REMOVE_OWNERS.TITLE")),v.xp6(2),v.Tol(t.theme),v.xp6(1),v.Q6J("ngIf",t.loading),v.xp6(1),v.Q6J("ngIf",!t.loading),v.xp6(3),v.hij(" ",v.lcZ(9,11,"DIALOGS.REMOVE_OWNERS.CANCEL")," "),v.xp6(2),v.Q6J("disabled",t.loading),v.xp6(1),v.hij(" ",v.lcZ(12,13,"DIALOGS.REMOVE_OWNERS.DELETE")," "))},directives:[A.uh,o.O5,A.H8,C.lW,y.$g,A.xY,lt.BZ,lt.w1,lt.fO,lt.Dz,lt.as,lt.nj,lt.ge,lt.ev,lt.XQ,lt.Gk],pipes:[_.X$],styles:[""]}),e}();function pt(e,t){if(1&e){var i=v.EpF();v.TgZ(0,"button",7),v.NdJ("click",function(){return v.CHM(i),v.oxw().onCreate()}),v._uU(1),v.ALo(2,"translate"),v.qZA()}2&e&&(v.xp6(1),v.hij(" ",v.lcZ(2,1,"FACILITY_DETAIL.SETTINGS.OWNERS.ADD"),"\n"))}function gt(e,t){if(1&e){var i=v.EpF();v.TgZ(0,"button",8),v.NdJ("click",function(){return v.CHM(i),v.oxw().onRemove()}),v._uU(1),v.ALo(2,"translate"),v.qZA()}if(2&e){var a=v.oxw();v.Q6J("disabled",0===a.selection.selected.length),v.xp6(1),v.hij(" ",v.lcZ(2,2,"FACILITY_DETAIL.SETTINGS.OWNERS.DELETE"),"\n")}}function mt(e,t){1&e&&v._UZ(0,"mat-spinner",9)}function St(e,t){if(1&e&&v._UZ(0,"perun-web-apps-owners-list",10),2&e){var i=v.oxw();v.Q6J("tableId",i.tableId)("filterValue",i.filterValue)("owners",i.owners)("displayedColumns",i.displayedColumns)("selection",i.selection)}}var vt=function(){var e=function(){function e(t,i,a,n){s(this,e),this.facilitiesManagerService=t,this.dialog=i,this.authResolver=a,this.entityStorageService=n,this.owners=[],this.selection=new xe.Ov(!0,[]),this.displayedColumns=["id","name","contact","type"],this.tableId=Le.zp}return r(e,[{key:"ngOnInit",value:function(){this.filterValue="",this.facility=this.entityStorageService.getEntity(),this.setAuthRights(),this.refreshTable()}},{key:"refreshTable",value:function(){var e=this;this.loading=!0,this.selection.clear(),this.facilitiesManagerService.getFacilityOwners(this.facility.id).subscribe(function(t){e.owners=t,e.loading=!1})}},{key:"setAuthRights",value:function(){this.addAuth=this.authResolver.isAuthorized("addOwner_Facility_Owner_policy",[this.facility]),this.removeAuth=this.authResolver.isAuthorized("removeOwner_Facility_Owner_policy",[this.facility]),this.displayedColumns=this.removeAuth?["select","id","name","contact","type"]:["id","name","contact","type"]}},{key:"applyFilter",value:function(e){this.filterValue=e}},{key:"onCreate",value:function(){var e=this,t=(0,p.kZ)();t.width="800px",t.data={theme:"facility-theme",facilityId:this.facility.id,forbiddenOwners:this.owners.map(function(e){return e.id})},this.dialog.open(st,t).afterClosed().subscribe(function(t){t&&e.refreshTable()})}},{key:"onRemove",value:function(){var e=this,t=(0,p.kZ)();t.width="600px",t.data={theme:"facility-theme",owners:this.selection.selected,facilityId:this.facility.id},this.dialog.open(ft,t).afterClosed().subscribe(function(t){t&&e.refreshTable()})}}]),e}();return e.\u0275fac=function(t){return new(t||e)(v.Y36(f.IQ),v.Y36(A.uw),v.Y36(g.x4),v.Y36(g.fb))},e.\u0275cmp=v.Xpm({type:e,selectors:[["app-facility-settings-owners"]],decls:9,vars:8,consts:[[1,"page-subtitle"],[3,"refresh"],["class","mr-2 action-button","color","accent","mat-flat-button","",3,"click",4,"ngIf"],["class","mr-2","color","warn","mat-flat-button","",3,"disabled","click",4,"ngIf"],[3,"placeholder","filter"],["class","ml-auto mr-auto",4,"ngIf"],[3,"tableId","filterValue","owners","displayedColumns","selection",4,"ngIf"],["color","accent","mat-flat-button","",1,"mr-2","action-button",3,"click"],["color","warn","mat-flat-button","",1,"mr-2",3,"disabled","click"],[1,"ml-auto","mr-auto"],[3,"tableId","filterValue","owners","displayedColumns","selection"]],template:function(e,t){1&e&&(v.TgZ(0,"h1",0),v._uU(1),v.ALo(2,"translate"),v.qZA(),v.TgZ(3,"perun-web-apps-refresh-button",1),v.NdJ("refresh",function(){return t.refreshTable()}),v.qZA(),v.YNc(4,pt,3,3,"button",2),v.YNc(5,gt,3,4,"button",3),v.TgZ(6,"perun-web-apps-immediate-filter",4),v.NdJ("filter",function(e){return t.applyFilter(e)}),v.qZA(),v.YNc(7,mt,1,0,"mat-spinner",5),v.YNc(8,St,1,5,"perun-web-apps-owners-list",6)),2&e&&(v.xp6(1),v.Oqu(v.lcZ(2,6,"FACILITY_DETAIL.SETTINGS.OWNERS.TITLE")),v.xp6(3),v.Q6J("ngIf",t.addAuth),v.xp6(1),v.Q6J("ngIf",t.removeAuth),v.xp6(1),v.Q6J("placeholder","VO_MANAGEMENT.FILTER_PLACEHOLDER"),v.xp6(1),v.Q6J("ngIf",t.loading),v.xp6(1),v.Q6J("ngIf",!t.loading))},directives:[Be.t,o.O5,Ge.L,C.lW,y.$g,it.Q],pipes:[_.X$],styles:[""]}),e}();function At(e,t){1&e&&v._UZ(0,"mat-spinner",7)}function Tt(e,t){1&e&&(v.TgZ(0,"mat-error"),v._uU(1),v.ALo(2,"translate"),v.qZA()),2&e&&(v.xp6(1),v.hij(" ",v.lcZ(2,1,"DIALOGS.ADD_HOST.EMPTY_MESSAGE")," "))}function It(e,t){if(1&e&&(v.TgZ(0,"mat-error"),v._uU(1),v.ALo(2,"translate"),v.qZA()),2&e){var i=v.oxw(2);v.xp6(1),v.AsE(" ",v.lcZ(2,2,"DIALOGS.ADD_HOST.INVALID_HOST"),"",i.hostsCtrl.getError("invalidHost").value," ")}}function yt(e,t){if(1&e&&(v.TgZ(0,"div",8),v.TgZ(1,"mat-form-field"),v.TgZ(2,"textarea",9),v._uU(3,"      "),v.qZA(),v.YNc(4,Tt,3,3,"mat-error",10),v.YNc(5,It,3,4,"mat-error",10),v.qZA(),v.TgZ(6,"div",11),v._uU(7),v.ALo(8,"translate"),v.qZA(),v.qZA()),2&e){var i=v.oxw();v.xp6(2),v.Q6J("formControl",i.hostsCtrl),v.xp6(2),v.Q6J("ngIf",i.hostsCtrl.hasError("required")),v.xp6(1),v.Q6J("ngIf",i.hostsCtrl.hasError("invalidHost")),v.xp6(2),v.Oqu(v.lcZ(8,4,"DIALOGS.ADD_HOST.HINT"))}}var bt=function(){var e=function(){function e(t,i,a,n,l){s(this,e),this.dialogRef=t,this.data=i,this.facilitiesManager=a,this.notificator=n,this.translate=l,this.loading=!1,this.hostPattern=new RegExp("^(?!:\\/\\/)(?=.{1,255}$)((.{1,63}\\.){1,127}(?![0-9]*$)[a-z0-9-]+\\.?)$|^(25[0-5]|2[0-4]\\d|[0-1]?\\d?\\d)(\\.(25[0-5]|2[0-4]\\d|[0-1]?\\d?\\d)){3}$")}return r(e,[{key:"ngOnInit",value:function(){this.theme=this.data.theme,this.facilityName=this.data.facilityName,this.hostsCtrl=new le.NI("",[le.kI.required,this.hostsNameValidator()]),this.hostsCtrl.markAllAsTouched()}},{key:"onAdd",value:function(){var e=this;this.loading=!0;var t,a=[],n=i(this.hostsCtrl.value.split("\n"));try{for(n.s();!(t=n.n()).done;){var s=t.value;a=a.concat(this.parseHostName(s))}}catch(l){n.e(l)}finally{n.f()}this.facilitiesManager.addHosts(this.data.facilityId,a).subscribe(function(){e.notificator.showSuccess(e.translate.instant("DIALOGS.ADD_HOST.SUCCESS")),e.dialogRef.close(!0)},function(){return e.loading=!1})}},{key:"onCancel",value:function(){this.dialogRef.close(!1)}},{key:"hostsNameValidator",value:function(){var e=this;return function(t){var a,n=[],s=i(t.value.split("\n"));try{for(s.s();!(a=s.n()).done;){var l=a.value;n=n.concat(e.parseHostName(l))}}catch(u){s.e(u)}finally{s.f()}var r,o=i(n);try{for(o.s();!(r=o.n()).done;){var c=r.value;if(!e.hostPattern.test(c))return{invalidHost:{value:c}}}}catch(u){o.e(u)}finally{o.f()}return null}}},{key:"parseHostName",value:function(e){var i=new RegExp("[[0-9]+-[0-9]+]","g"),a=e.split(i),n=e.match(i);if(null==n)return""===e?[]:[e];for(var s=[],l=0;l<a.length-1;l++){for(var r=t(this.parseRange(n[l]),2),o=r[0],c=r[1],u=[],d=o;d<=c;d++)u=u.concat(a[l].concat(d.toString()));s=s.concat([u])}return s=s.concat([a[a.length-1]]),this.joinHostNames(s,0)}},{key:"parseRange",value:function(e){var i=t(e.split("-"),2),a=i[0],n=i[1];return[parseInt(a.substring(1,a.length),10),parseInt(n.substring(0,n.length),10)]}},{key:"joinHostNames",value:function(e,t){if(t===e.length-1)return[e[t]];var a,n=this.joinHostNames(e,t+1),s=[],l=i(e[t]);try{for(l.s();!(a=l.n()).done;){var r,o=a.value,c=i(n);try{for(c.s();!(r=c.n()).done;){var u=r.value;s.push(o.concat(u))}}catch(d){c.e(d)}finally{c.f()}}}catch(d){l.e(d)}finally{l.f()}return s}}]),e}();return e.\u0275fac=function(t){return new(t||e)(v.Y36(A.so),v.Y36(A.WI),v.Y36(f.IQ),v.Y36(g.V6),v.Y36(_.sK))},e.\u0275cmp=v.Xpm({type:e,selectors:[["app-add-host-dialog"]],decls:16,vars:19,consts:[["mat-dialog-title",""],[1,"page-subtitle"],["class","ml-auto mr-auto",4,"ngIf"],["mat-dialog-content","","class","dialog-container",4,"ngIf"],["mat-dialog-actions",""],["mat-flat-button","",1,"ml-auto",3,"click"],["mat-flat-button","","color","accent",1,"ml-2",3,"disabled","click"],[1,"ml-auto","mr-auto"],["mat-dialog-content","",1,"dialog-container"],["id","facilityAddHost","name","facilityAddHost","rows","8","cols","50","matInput","","required","",1,"md-textarea","form-control",3,"formControl"],[4,"ngIf"],[1,"text-muted"]],template:function(e,t){1&e&&(v.TgZ(0,"div"),v.TgZ(1,"h1",0),v._uU(2),v.ALo(3,"translate"),v.qZA(),v.TgZ(4,"h1",1),v._uU(5),v.ALo(6,"translate"),v.qZA(),v.YNc(7,At,1,0,"mat-spinner",2),v.YNc(8,yt,9,6,"div",3),v.TgZ(9,"div",4),v.TgZ(10,"button",5),v.NdJ("click",function(){return t.onCancel()}),v._uU(11),v.ALo(12,"translate"),v.qZA(),v.TgZ(13,"button",6),v.NdJ("click",function(){return t.onAdd()}),v._uU(14),v.ALo(15,"translate"),v.qZA(),v.qZA(),v.qZA()),2&e&&(v.Tol(t.theme),v.xp6(2),v.AsE("",t.facilityName,": ",v.lcZ(3,11,"DIALOGS.ADD_HOST.TITLE"),""),v.xp6(3),v.hij("",v.lcZ(6,13,"DIALOGS.ADD_HOST.SUBTITLE"),":"),v.xp6(2),v.Q6J("ngIf",t.loading),v.xp6(1),v.Q6J("ngIf",!t.loading),v.xp6(3),v.hij(" ",v.lcZ(12,15,"DIALOGS.ADD_HOST.CANCEL"),""),v.xp6(2),v.Q6J("disabled",t.hostsCtrl.invalid||t.loading),v.xp6(1),v.hij(" ",v.lcZ(15,17,"DIALOGS.ADD_HOST.ADD"),""))},directives:[A.uh,o.O5,A.H8,C.lW,y.$g,A.xY,de.KE,he.Nt,le.Fj,le.Q7,le.JJ,le.oH,de.TO],pipes:[_.X$],styles:[""]}),e}();function Et(e,t){1&e&&v._UZ(0,"mat-spinner",6)}function Zt(e,t){1&e&&v._UZ(0,"th",15)}function Ct(e,t){if(1&e&&(v.TgZ(0,"td",16),v._uU(1),v.qZA()),2&e){var i=t.$implicit;v.xp6(1),v.hij(" ",i.hostname," ")}}function _t(e,t){1&e&&v._UZ(0,"tr",17)}function kt(e,t){1&e&&v._UZ(0,"tr",18)}function Lt(e,t){if(1&e&&(v.TgZ(0,"div",7),v.TgZ(1,"p"),v._uU(2),v.ALo(3,"translate"),v.qZA(),v.TgZ(4,"div",8),v._uU(5),v.ALo(6,"translate"),v.qZA(),v.TgZ(7,"table",9),v.ynx(8,10),v.YNc(9,Zt,1,0,"th",11),v.YNc(10,Ct,2,1,"td",12),v.BQk(),v.YNc(11,_t,1,0,"tr",13),v.YNc(12,kt,1,0,"tr",14),v.qZA(),v.qZA()),2&e){var i=v.oxw();v.xp6(2),v.Oqu(v.lcZ(3,5,"DIALOGS.REMOVE_HOST.DESCRIPTION")),v.xp6(3),v.hij(" ",v.lcZ(6,7,"DIALOGS.REMOVE_HOST.ASK")," "),v.xp6(2),v.Q6J("dataSource",i.dataSource),v.xp6(4),v.Q6J("matHeaderRowDef",i.displayedColumns),v.xp6(1),v.Q6J("matRowDefColumns",i.displayedColumns)}}var xt=function(){var e=function(){function e(t,i,a,n,l){s(this,e),this.dialogRef=t,this.data=i,this.facilitiesManager=a,this.notificator=n,this.translate=l,this.displayedColumns=["name"],this.loading=!1}return r(e,[{key:"ngOnInit",value:function(){this.theme=this.data.theme,this.hosts=this.data.hosts,this.dataSource=new lt.by(this.data.hosts)}},{key:"onConfirm",value:function(){var e=this;this.loading=!0,this.facilitiesManager.removeHosts(this.data.facilityId,this.hosts.map(function(e){return e.id})).subscribe(function(){e.notificator.showSuccess(e.translate.instant("DIALOGS.REMOVE_HOST.SUCCESS")),e.dialogRef.close(!0)},function(){return e.loading=!1})}},{key:"onCancel",value:function(){this.dialogRef.close(!1)}}]),e}();return e.\u0275fac=function(t){return new(t||e)(v.Y36(A.so),v.Y36(A.WI),v.Y36(f.IQ),v.Y36(g.V6),v.Y36(_.sK))},e.\u0275cmp=v.Xpm({type:e,selectors:[["app-remove-host-dialog"]],decls:13,vars:15,consts:[["mat-dialog-title",""],["class","mr-auto ml-auto",4,"ngIf"],["mat-dialog-content","",4,"ngIf"],["mat-dialog-actions",""],["mat-flat-button","",1,"ml-auto",3,"click"],["mat-flat-button","","color","warn",1,"ml-2",3,"disabled","click"],[1,"mr-auto","ml-auto"],["mat-dialog-content",""],[1,"font-weight-bold"],["mat-table","",1,"w-100",3,"dataSource"],["matColumnDef","name"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["mat-header-row","","class","font-weight-bolder",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["mat-header-cell",""],["mat-cell",""],["mat-header-row","",1,"font-weight-bolder"],["mat-row",""]],template:function(e,t){1&e&&(v.TgZ(0,"h1",0),v._uU(1),v.ALo(2,"translate"),v.qZA(),v.TgZ(3,"div"),v.YNc(4,Et,1,0,"mat-spinner",1),v.YNc(5,Lt,13,9,"div",2),v.TgZ(6,"div",3),v.TgZ(7,"button",4),v.NdJ("click",function(){return t.onCancel()}),v._uU(8),v.ALo(9,"translate"),v.qZA(),v.TgZ(10,"button",5),v.NdJ("click",function(){return t.onConfirm()}),v._uU(11),v.ALo(12,"translate"),v.qZA(),v.qZA(),v.qZA()),2&e&&(v.xp6(1),v.Oqu(v.lcZ(2,9,"DIALOGS.REMOVE_HOST.TITLE")),v.xp6(2),v.Tol(t.theme),v.xp6(1),v.Q6J("ngIf",t.loading),v.xp6(1),v.Q6J("ngIf",!t.loading),v.xp6(3),v.hij(" ",v.lcZ(9,11,"DIALOGS.REMOVE_HOST.CANCEL"),""),v.xp6(2),v.Q6J("disabled",t.loading),v.xp6(1),v.hij(" ",v.lcZ(12,13,"DIALOGS.REMOVE_HOST.CONFIRM"),""))},directives:[A.uh,o.O5,A.H8,C.lW,y.$g,A.xY,lt.BZ,lt.w1,lt.fO,lt.Dz,lt.as,lt.nj,lt.ge,lt.ev,lt.XQ,lt.Gk],pipes:[_.X$],styles:[""]}),e}(),Ot=l(58623),Rt=l(82819),Dt=l(84534),Nt=l(39571);function wt(e,t){if(1&e){var i=v.EpF();v.TgZ(0,"th",14),v.TgZ(1,"mat-checkbox",15),v.NdJ("change",function(e){v.CHM(i);var t=v.oxw();return e?t.masterToggle():null}),v.qZA(),v.qZA()}if(2&e){var a=v.oxw();v.xp6(1),v.Q6J("aria-label",a.checkboxLabel())("checked",a.selection.hasValue()&&a.isAllSelected())("indeterminate",a.selection.hasValue()&&!a.isAllSelected())}}function Yt(e,t){if(1&e){var i=v.EpF();v.TgZ(0,"td",16),v.TgZ(1,"mat-checkbox",17),v.NdJ("change",function(e){var t=v.CHM(i).$implicit,a=v.oxw();return e?a.selection.toggle(t):null})("click",function(e){return e.stopPropagation()}),v.qZA(),v.qZA()}if(2&e){var a=t.$implicit,n=v.oxw();v.xp6(1),v.Q6J("aria-label",n.checkboxLabel(a))("checked",n.selection.isSelected(a))}}function Ft(e,t){1&e&&(v.TgZ(0,"th",18),v._uU(1),v.ALo(2,"translate"),v.qZA()),2&e&&(v.xp6(1),v.Oqu(v.lcZ(2,1,"SHARED.COMPONENTS.HOSTS_LIST.TABLE_HOST_ID")))}function Mt(e,t){if(1&e&&(v.TgZ(0,"td",19),v._uU(1),v.qZA()),2&e){var i=t.$implicit;v.xp6(1),v.Oqu(i.id)}}function Ut(e,t){1&e&&(v.TgZ(0,"th",18),v._uU(1),v.ALo(2,"translate"),v.qZA()),2&e&&(v.xp6(1),v.Oqu(v.lcZ(2,1,"SHARED.COMPONENTS.HOSTS_LIST.TABLE_HOST_NAME")))}function qt(e,t){if(1&e&&(v.TgZ(0,"td",20),v._uU(1),v.qZA()),2&e){var i=t.$implicit;v.xp6(1),v.Oqu(i.hostname)}}function Jt(e,t){1&e&&v._UZ(0,"tr",21)}var Qt=function(e,t){return["/facilities",e,"hosts",t]};function Vt(e,t){if(1&e&&v._UZ(0,"tr",22),2&e){var i=t.$implicit,a=v.oxw();v.Q6J("perunWebAppsMiddleClickRouterLink",a.disableRouting?null:v.WLB(2,Qt,a.facilityId,i.id))("routerLink",a.disableRouting?null:v.WLB(5,Qt,a.facilityId,i.id))}}function Ht(e,t){1&e&&(v.TgZ(0,"app-alert",23),v._uU(1),v.ALo(2,"translate"),v.qZA()),2&e&&(v.xp6(1),v.hij(" ",v.lcZ(2,1,"SHARED_LIB.UI.ALERTS.NO_FILTER_RESULTS_ALERT"),"\n"))}function Pt(e,t){1&e&&(v.TgZ(0,"app-alert",23),v._uU(1),v.ALo(2,"translate"),v.qZA()),2&e&&(v.xp6(1),v.hij(" ",v.lcZ(2,1,"SHARED.COMPONENTS.HOSTS_LIST.NO_HOST_WARNING"),"\n"))}var Bt=function(){var e=function(){function e(t,i){s(this,e),this.authResolver=t,this.tableCheckbox=i,this.hosts=[],this.selection=new xe.Ov(!0,[]),this.disableRouting=!1,this.displayedColumns=["select","id","name"],this.pageSizeOptions=p.f7}return r(e,[{key:"matSort",set:function(e){this.sort=e,this.setDataSource()}},{key:"ngOnChanges",value:function(){this.authResolver.isPerunAdminOrObserver()||(this.displayedColumns=this.displayedColumns.filter(function(e){return"id"!==e})),this.dataSource=new lt.by(this.hosts),this.setDataSource(),this.dataSource.filter=this.filterValue}},{key:"getDataForColumn",value:function(e,t){switch(t){case"id":return e.id.toString();case"name":return e.hostname;default:return""}}},{key:"exportData",value:function(e){(0,p.O6)((0,p.Xn)(this.dataSource.filteredData,this.displayedColumns,this.getDataForColumn,this),e)}},{key:"setDataSource",value:function(){var e=this;this.dataSource&&(this.dataSource.sort=this.sort,this.dataSource.filterPredicate=function(t,i){return(0,p.Sd)(t,i,e.displayedColumns,e.getDataForColumn,e)},this.dataSource.sortData=function(t,i){return(0,p.pR)(t,i,e.getDataForColumn,e)},this.dataSource.paginator=this.child.paginator)}},{key:"isAllSelected",value:function(){return this.tableCheckbox.isAllSelected(this.selection.selected.length,this.filterValue,this.child.paginator.pageSize,this.child.paginator.hasNextPage(),this.dataSource)}},{key:"masterToggle",value:function(){this.tableCheckbox.masterToggle(this.isAllSelected(),this.selection,this.filterValue,this.dataSource,this.sort,this.child.paginator.pageSize,this.child.paginator.pageIndex,!1)}},{key:"checkboxLabel",value:function(e){return e?"".concat(this.selection.isSelected(e)?"deselect":"select"," row ").concat(e.id+1):(this.isAllSelected()?"select":"deselect")+" all"}},{key:"ngAfterViewInit",value:function(){this.dataSource.paginator=this.child.paginator}}]),e}();return e.\u0275fac=function(t){return new(t||e)(v.Y36(g.x4),v.Y36(g.UA))},e.\u0275cmp=v.Xpm({type:e,selectors:[["app-hosts-list"]],viewQuery:function(e,t){var i;(1&e&&(v.Gf(Ot.YE,7),v.Gf(p.l9,7)),2&e)&&(v.iGM(i=v.CRH())&&(t.matSort=i.first),v.iGM(i=v.CRH())&&(t.child=i.first))},inputs:{hosts:"hosts",selection:"selection",filterValue:"filterValue",tableId:"tableId",facilityId:"facilityId",disableRouting:"disableRouting",displayedColumns:"displayedColumns"},features:[v.TTD],decls:16,vars:9,consts:[[1,"card","mt-3",3,"hidden"],[3,"tableId","dataLength","pageSizeOptions","exportData"],["mat-table","","matSort","","matSortActive","id","matSortDirection","asc","matSortDisableClear","",1,"w-100",3,"dataSource"],["matColumnDef","select"],["mat-header-cell","","class","align-checkbox",4,"matHeaderCellDef"],["class","static-column-size align-checkbox","mat-cell","",4,"matCellDef"],["matColumnDef","id"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["class","static-column-size","mat-cell","",4,"matCellDef"],["matColumnDef","name"],["mat-cell","",4,"matCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["class","dark-hover-list-item","mat-row","",3,"perunWebAppsMiddleClickRouterLink","routerLink",4,"matRowDef","matRowDefColumns"],["alert_type","warn",4,"ngIf"],["mat-header-cell","",1,"align-checkbox"],["color","primary",3,"aria-label","checked","indeterminate","change"],["mat-cell","",1,"static-column-size","align-checkbox"],["color","primary",3,"aria-label","checked","change","click"],["mat-header-cell","","mat-sort-header",""],["mat-cell","",1,"static-column-size"],["mat-cell",""],["mat-header-row",""],["mat-row","",1,"dark-hover-list-item",3,"perunWebAppsMiddleClickRouterLink","routerLink"],["alert_type","warn"]],template:function(e,t){1&e&&(v.TgZ(0,"div",0),v.TgZ(1,"perun-web-apps-table-wrapper",1),v.NdJ("exportData",function(e){return t.exportData(e)}),v.TgZ(2,"table",2),v.ynx(3,3),v.YNc(4,wt,2,3,"th",4),v.YNc(5,Yt,2,2,"td",5),v.BQk(),v.ynx(6,6),v.YNc(7,Ft,3,3,"th",7),v.YNc(8,Mt,2,1,"td",8),v.BQk(),v.ynx(9,9),v.YNc(10,Ut,3,3,"th",7),v.YNc(11,qt,2,1,"td",10),v.BQk(),v.YNc(12,Jt,1,0,"tr",11),v.YNc(13,Vt,1,8,"tr",12),v.qZA(),v.qZA(),v.qZA(),v.YNc(14,Ht,3,3,"app-alert",13),v.YNc(15,Pt,3,3,"app-alert",13)),2&e&&(v.Q6J("hidden",0===t.dataSource.filteredData.length||0===t.hosts.length),v.xp6(1),v.Q6J("tableId",t.tableId)("dataLength",t.dataSource.filteredData.length)("pageSizeOptions",t.pageSizeOptions),v.xp6(1),v.Q6J("dataSource",t.dataSource),v.xp6(10),v.Q6J("matHeaderRowDef",t.displayedColumns),v.xp6(1),v.Q6J("matRowDefColumns",t.displayedColumns),v.xp6(1),v.Q6J("ngIf",0===t.dataSource.filteredData.length&&0!==t.hosts.length),v.xp6(1),v.Q6J("ngIf",0===t.hosts.length))},directives:[Rt.l,lt.BZ,Ot.YE,lt.w1,lt.fO,lt.Dz,lt.as,lt.nj,o.O5,lt.ge,ue.oG,lt.ev,Ot.nU,lt.XQ,lt.Gk,Dt.YH,c.rH,Nt.w],pipes:[_.X$],styles:[".disable-outline[_ngcontent-%COMP%]{outline:none!important}.cursor-pointer[_ngcontent-%COMP%]{cursor:pointer}"]}),e}();function Gt(e,t){if(1&e){var i=v.EpF();v.TgZ(0,"button",7),v.NdJ("click",function(){return v.CHM(i),v.oxw().addHost()}),v._uU(1),v.ALo(2,"translate"),v.qZA()}2&e&&(v.xp6(1),v.hij(" ",v.lcZ(2,1,"FACILITY_DETAIL.HOSTS.ADD")," "))}function $t(e,t){if(1&e){var i=v.EpF();v.TgZ(0,"button",8),v.NdJ("click",function(){return v.CHM(i),v.oxw().removeHost()}),v._uU(1),v.ALo(2,"translate"),v.qZA()}if(2&e){var a=v.oxw();v.Q6J("disabled",0===a.selected.selected.length),v.xp6(1),v.hij(" ",v.lcZ(2,2,"FACILITY_DETAIL.HOSTS.REMOVE")," ")}}function zt(e,t){1&e&&v._UZ(0,"mat-spinner",9)}function jt(e,t){if(1&e&&v._UZ(0,"app-hosts-list",10),2&e){var i=v.oxw();v.Q6J("tableId",i.tableId)("filterValue",i.filterValue)("hosts",i.hosts)("selection",i.selected)("displayedColumns",i.displayedColumns)("disableRouting",!i.routeAuth)("facilityId",i.facility.id)}}var Kt=function(){var e=function(){function e(t,i,a,n){s(this,e),this.dialog=t,this.facilitiesManager=i,this.authResolver=a,this.entityStorageService=n,this.hosts=[],this.selected=new xe.Ov(!0,[]),this.filterValue="",this.tableId=Le.eq,this.displayedColumns=["id","name"]}return r(e,[{key:"ngOnInit",value:function(){var e=this;this.loading=!0,this.facility=this.entityStorageService.getEntity(),this.setAuthRights(),this.facilitiesManager.getFacilityById(this.facility.id).subscribe(function(t){e.facility=t,e.refreshTable()})}},{key:"refreshTable",value:function(){var e=this;this.loading=!0,this.facilitiesManager.getHosts(this.facility.id).subscribe(function(t){e.hosts=t,e.selected.clear(),e.setAuthRights(),e.loading=!1})}},{key:"setAuthRights",value:function(){this.addAuth=this.authResolver.isAuthorized("addHosts_Facility_List<String>_policy",[this.facility]),this.removeAuth=this.authResolver.isAuthorized("removeHosts_List<Host>_Facility_policy",[this.facility]),this.displayedColumns=this.removeAuth?["select","id","name"]:["id","name"],0!==this.hosts.length&&(this.routeAuth=this.authResolver.isAuthorized("getHostById_int_policy",[this.facility,this.hosts[0]]))}},{key:"addHost",value:function(){var e=this,t=(0,p.kZ)();t.width="600px",t.data={facilityId:this.facility.id,facilityName:this.facility.name,theme:"facility-theme"},this.dialog.open(bt,t).afterClosed().subscribe(function(t){t&&e.refreshTable()})}},{key:"removeHost",value:function(){var e=this,t=(0,p.kZ)();t.width="600px",t.data={facilityId:this.facility.id,theme:"facility-theme",hosts:this.selected.selected},this.dialog.open(xt,t).afterClosed().subscribe(function(t){t&&e.refreshTable()})}},{key:"applyFilter",value:function(e){this.filterValue=e}}]),e}();return e.\u0275fac=function(t){return new(t||e)(v.Y36(A.uw),v.Y36(f.IQ),v.Y36(g.x4),v.Y36(g.fb))},e.\u0275cmp=v.Xpm({type:e,selectors:[["app-facility-hosts"]],decls:10,vars:8,consts:[[1,"page-subtitle"],[3,"refresh"],["mat-flat-button","","color","accent","class","mr-2 action-button",3,"click",4,"ngIf"],["mat-flat-button","","color","warn","class","mr-2",3,"disabled","click",4,"ngIf"],[3,"placeholder","filter"],["class","ml-auto mr-auto",4,"ngIf"],[3,"tableId","filterValue","hosts","selection","displayedColumns","disableRouting","facilityId",4,"ngIf"],["mat-flat-button","","color","accent",1,"mr-2","action-button",3,"click"],["mat-flat-button","","color","warn",1,"mr-2",3,"disabled","click"],[1,"ml-auto","mr-auto"],[3,"tableId","filterValue","hosts","selection","displayedColumns","disableRouting","facilityId"]],template:function(e,t){1&e&&(v.TgZ(0,"div"),v.TgZ(1,"h1",0),v._uU(2),v.ALo(3,"translate"),v.qZA(),v.TgZ(4,"perun-web-apps-refresh-button",1),v.NdJ("refresh",function(){return t.refreshTable()}),v.qZA(),v.YNc(5,Gt,3,3,"button",2),v.YNc(6,$t,3,4,"button",3),v.TgZ(7,"perun-web-apps-immediate-filter",4),v.NdJ("filter",function(e){return t.applyFilter(e)}),v.qZA(),v.YNc(8,zt,1,0,"mat-spinner",5),v.YNc(9,jt,1,7,"app-hosts-list",6),v.qZA()),2&e&&(v.xp6(2),v.Oqu(v.lcZ(3,6,"FACILITY_DETAIL.HOSTS.TITLE")),v.xp6(3),v.Q6J("ngIf",t.addAuth),v.xp6(1),v.Q6J("ngIf",t.removeAuth),v.xp6(1),v.Q6J("placeholder","FACILITY_DETAIL.HOSTS.FILTER"),v.xp6(1),v.Q6J("ngIf",t.loading),v.xp6(1),v.Q6J("ngIf",!t.loading))},directives:[Be.t,o.O5,Ge.L,C.lW,y.$g,Bt],pipes:[_.X$],styles:[""]}),e}();function Wt(e,t){if(1&e){var i=v.EpF();v.TgZ(0,"th",15),v.TgZ(1,"mat-checkbox",16),v.NdJ("change",function(e){v.CHM(i);var t=v.oxw();return e?t.masterToggle():null}),v.qZA(),v.qZA()}if(2&e){var a=v.oxw();v.xp6(1),v.Q6J("aria-label",a.checkboxLabel())("checked",a.selection.hasValue()&&a.isAllSelected())("indeterminate",a.selection.hasValue()&&!a.isAllSelected())}}function Xt(e,t){if(1&e){var i=v.EpF();v.TgZ(0,"td",17),v.TgZ(1,"mat-checkbox",18),v.NdJ("change",function(e){var t=v.CHM(i).$implicit,a=v.oxw();return e?a.selection.toggle(t):null})("click",function(e){return e.stopPropagation()}),v.qZA(),v.qZA()}if(2&e){var a=t.$implicit,n=v.oxw();v.xp6(1),v.Q6J("aria-label",n.checkboxLabel(a))("checked",n.selection.isSelected(a))}}function ei(e,t){1&e&&(v.TgZ(0,"th",19),v._uU(1),v.ALo(2,"translate"),v.qZA()),2&e&&(v.xp6(1),v.Oqu(v.lcZ(2,1,"SHARED.COMPONENTS.BLACKLIST_LIST.USER_ID")))}function ti(e,t){if(1&e&&(v.TgZ(0,"td",20),v._uU(1),v.qZA()),2&e){var i=t.$implicit;v.xp6(1),v.Oqu(i[1].id)}}function ii(e,t){1&e&&(v.TgZ(0,"th",19),v._uU(1),v.ALo(2,"translate"),v.qZA()),2&e&&(v.xp6(1),v.Oqu(v.lcZ(2,1,"SHARED.COMPONENTS.BLACKLIST_LIST.NAME")))}function ai(e,t){if(1&e&&(v.TgZ(0,"td",21),v._uU(1),v.ALo(2,"userFullName"),v.qZA()),2&e){var i=t.$implicit;v.xp6(1),v.Oqu(v.lcZ(2,1,i[1]))}}function ni(e,t){1&e&&(v.TgZ(0,"th",19),v._uU(1),v.ALo(2,"translate"),v.qZA()),2&e&&(v.xp6(1),v.Oqu(v.lcZ(2,1,"SHARED.COMPONENTS.BLACKLIST_LIST.REASON")))}function si(e,t){if(1&e&&(v.TgZ(0,"td",21),v._uU(1),v.qZA()),2&e){var i=t.$implicit;v.xp6(1),v.Oqu(i[0].description)}}function li(e,t){1&e&&v._UZ(0,"tr",22)}function ri(e,t){1&e&&v._UZ(0,"tr",23)}function oi(e,t){1&e&&(v.TgZ(0,"app-alert",24),v._uU(1),v.ALo(2,"translate"),v.qZA()),2&e&&(v.xp6(1),v.hij(" ",v.lcZ(2,1,"SHARED_LIB.UI.ALERTS.NO_FILTER_RESULTS_ALERT"),"\n"))}function ci(e,t){1&e&&(v.TgZ(0,"app-alert",24),v._uU(1),v.ALo(2,"translate"),v.qZA()),2&e&&(v.xp6(1),v.hij(" ",v.lcZ(2,1,"SHARED.COMPONENTS.BLACKLIST_LIST.NO_BANS_WARNING"),"\n"))}var ui=function(){var e=function(){function e(t,i){s(this,e),this.authResolver=t,this.tableCheckbox=i,this.bansOnFacilitiesWithUsers=[],this.selection=new xe.Ov(!0,[]),this.displayedColumns=["select","userId","name","reason"],this.pageSizeOptions=p.f7}return r(e,[{key:"matSort",set:function(e){this.sort=e,this.setDataSource()}},{key:"ngOnChanges",value:function(){this.authResolver.isPerunAdminOrObserver()||(this.displayedColumns=this.displayedColumns.filter(function(e){return"userId"!==e})),this.dataSource=new lt.by(this.bansOnFacilitiesWithUsers),this.setDataSource(),this.dataSource.filter=this.filterValue}},{key:"getDataForColumn",value:function(e,t){switch(t){case"userId":return e[1].id.toString();case"reason":return e[0].description;case"name":return(0,p.hu)(e[1]);default:return""}}},{key:"exportData",value:function(e){(0,p.O6)((0,p.Xn)(this.dataSource.filteredData,this.displayedColumns,this.getDataForColumn,this),e)}},{key:"setDataSource",value:function(){var e=this;this.dataSource&&(this.dataSource.filterPredicate=function(t,i){return(0,p.Sd)(t,i,e.displayedColumns,e.getDataForColumn,e)},this.dataSource.sortData=function(t,i){return(0,p.pR)(t,i,e.getDataForColumn,e)},this.dataSource.sort=this.sort,this.dataSource.paginator=this.child.paginator)}},{key:"isAllSelected",value:function(){return this.tableCheckbox.isAllSelected(this.selection.selected.length,this.filterValue,this.child.paginator.pageSize,this.child.paginator.hasNextPage(),this.dataSource)}},{key:"masterToggle",value:function(){this.tableCheckbox.masterToggle(this.isAllSelected(),this.selection,this.filterValue,this.dataSource,this.sort,this.child.paginator.pageSize,this.child.paginator.pageIndex,!1)}},{key:"checkboxLabel",value:function(e){return e?"".concat(this.selection.isSelected(e)?"deselect":"select"," row ").concat(e[0].userId+1):(this.isAllSelected()?"select":"deselect")+" all"}},{key:"ngAfterViewInit",value:function(){this.dataSource.paginator=this.child.paginator}}]),e}();return e.\u0275fac=function(t){return new(t||e)(v.Y36(g.x4),v.Y36(g.UA))},e.\u0275cmp=v.Xpm({type:e,selectors:[["app-perun-web-apps-blacklist-list"]],viewQuery:function(e,t){var i;(1&e&&(v.Gf(Ot.YE,7),v.Gf(p.l9,7)),2&e)&&(v.iGM(i=v.CRH())&&(t.matSort=i.first),v.iGM(i=v.CRH())&&(t.child=i.first))},inputs:{bansOnFacilitiesWithUsers:"bansOnFacilitiesWithUsers",selection:"selection",filterValue:"filterValue",tableId:"tableId"},features:[v.TTD],decls:19,vars:9,consts:[[1,"card","mt-3",3,"hidden"],[3,"tableId","dataLength","pageSizeOptions","exportData"],["mat-table","","matSort","","matSortActive","id","matSortDirection","asc","matSortDisableClear","",1,"w-100",3,"dataSource"],["matColumnDef","select"],["mat-header-cell","","class","align-checkbox",4,"matHeaderCellDef"],["class","static-column-size align-checkbox","mat-cell","",4,"matCellDef"],["matColumnDef","userId"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["class","static-column-size","mat-cell","",4,"matCellDef"],["matColumnDef","name"],["mat-cell","",4,"matCellDef"],["matColumnDef","reason"],["mat-header-row","",4,"matHeaderRowDef"],["class","dark-hover-list-item","mat-row","",4,"matRowDef","matRowDefColumns"],["alert_type","warn",4,"ngIf"],["mat-header-cell","",1,"align-checkbox"],["color","primary",3,"aria-label","checked","indeterminate","change"],["mat-cell","",1,"static-column-size","align-checkbox"],["color","primary",3,"aria-label","checked","change","click"],["mat-header-cell","","mat-sort-header",""],["mat-cell","",1,"static-column-size"],["mat-cell",""],["mat-header-row",""],["mat-row","",1,"dark-hover-list-item"],["alert_type","warn"]],template:function(e,t){1&e&&(v.TgZ(0,"div",0),v.TgZ(1,"perun-web-apps-table-wrapper",1),v.NdJ("exportData",function(e){return t.exportData(e)}),v.TgZ(2,"table",2),v.ynx(3,3),v.YNc(4,Wt,2,3,"th",4),v.YNc(5,Xt,2,2,"td",5),v.BQk(),v.ynx(6,6),v.YNc(7,ei,3,3,"th",7),v.YNc(8,ti,2,1,"td",8),v.BQk(),v.ynx(9,9),v.YNc(10,ii,3,3,"th",7),v.YNc(11,ai,3,3,"td",10),v.BQk(),v.ynx(12,11),v.YNc(13,ni,3,3,"th",7),v.YNc(14,si,2,1,"td",10),v.BQk(),v.YNc(15,li,1,0,"tr",12),v.YNc(16,ri,1,0,"tr",13),v.qZA(),v.qZA(),v.qZA(),v.YNc(17,oi,3,3,"app-alert",14),v.YNc(18,ci,3,3,"app-alert",14)),2&e&&(v.Q6J("hidden",0===t.dataSource.filteredData.length||0===t.bansOnFacilitiesWithUsers.length),v.xp6(1),v.Q6J("tableId",t.tableId)("dataLength",t.dataSource.filteredData.length)("pageSizeOptions",t.pageSizeOptions),v.xp6(1),v.Q6J("dataSource",t.dataSource),v.xp6(13),v.Q6J("matHeaderRowDef",t.displayedColumns),v.xp6(1),v.Q6J("matRowDefColumns",t.displayedColumns),v.xp6(1),v.Q6J("ngIf",0===t.dataSource.filteredData.length&&0!==t.bansOnFacilitiesWithUsers.length),v.xp6(1),v.Q6J("ngIf",0===t.bansOnFacilitiesWithUsers.length))},directives:[Rt.l,lt.BZ,Ot.YE,lt.w1,lt.fO,lt.Dz,lt.as,lt.nj,o.O5,lt.ge,ue.oG,lt.ev,Ot.nU,lt.XQ,lt.Gk,Nt.w],pipes:[_.X$,ge.d],styles:[""]}),e}();function di(e,t){1&e&&v._UZ(0,"mat-spinner",5)}function hi(e,t){if(1&e&&v._UZ(0,"app-perun-web-apps-blacklist-list",6),2&e){var i=v.oxw();v.Q6J("tableId",i.tableId)("filterValue",i.filterValue)("bansOnFacilitiesWithUsers",i.bansOnFacilitiesWithUsers)("selection",i.selected)}}var fi=function(){var e=function(){function e(t,i,a){s(this,e),this.facilitiesManager=t,this.usersManager=i,this.entityStorageService=a,this.bansOnFacilitiesWithUsers=[],this.selected=new xe.Ov(!0,[]),this.filterValue="",this.tableId=Le.NG}return r(e,[{key:"ngOnInit",value:function(){this.loading=!0,this.facility=this.entityStorageService.getEntity(),this.refreshTable()}},{key:"refreshTable",value:function(){var e=this;this.loading=!0,this.facilitiesManager.getBansForFacility(this.facility.id).subscribe(function(t){var a,n=i(t);try{for(n.s();!(a=n.n()).done;){var s=a.value,l=void 0;e.usersManager.getUserById(s.userId).subscribe(function(e){l=e}),e.bansOnFacilitiesWithUsers.push([s,l])}}catch(r){n.e(r)}finally{n.f()}e.selected.clear(),e.loading=!1})}},{key:"applyFilter",value:function(e){this.filterValue=e}}]),e}();return e.\u0275fac=function(t){return new(t||e)(v.Y36(f.IQ),v.Y36(f.Fv),v.Y36(g.fb))},e.\u0275cmp=v.Xpm({type:e,selectors:[["app-perun-web-apps-facility-settings-blacklist"]],decls:9,vars:8,consts:[[1,"page-subtitle"],[3,"refresh"],[3,"placeholder","filter"],["class","ml-auto mr-auto",4,"ngIf"],[3,"tableId","filterValue","bansOnFacilitiesWithUsers","selection",4,"ngIf"],[1,"ml-auto","mr-auto"],[3,"tableId","filterValue","bansOnFacilitiesWithUsers","selection"]],template:function(e,t){1&e&&(v.TgZ(0,"div"),v.TgZ(1,"h1",0),v._uU(2),v.ALo(3,"translate"),v.qZA(),v.TgZ(4,"perun-web-apps-refresh-button",1),v.NdJ("refresh",function(){return t.refreshTable()}),v.qZA(),v.TgZ(5,"perun-web-apps-immediate-filter",2),v.NdJ("filter",function(e){return t.applyFilter(e)}),v.ALo(6,"translate"),v.qZA(),v.YNc(7,di,1,0,"mat-spinner",3),v.YNc(8,hi,1,4,"app-perun-web-apps-blacklist-list",4),v.qZA()),2&e&&(v.xp6(2),v.Oqu(v.lcZ(3,4,"FACILITY_DETAIL.SETTINGS.BLACKLIST.TITLE")),v.xp6(3),v.Q6J("placeholder",v.lcZ(6,6,"FACILITY_DETAIL.SETTINGS.BLACKLIST.FILTER")),v.xp6(2),v.Q6J("ngIf",t.loading),v.xp6(1),v.Q6J("ngIf",!t.loading))},directives:[Be.t,Ge.L,o.O5,y.$g,ui],pipes:[_.X$],styles:[""]}),e}(),pi=l(41939),gi=l(13572),mi=l(40695),Si=l(41186),vi=["list"];function Ai(e,t){if(1&e&&v._UZ(0,"perun-web-apps-attributes-list",6,7),2&e){var i=v.oxw();v.Q6J("tableId",i.tableId)("attributes",i.attributes)("selection",i.selected)}}var Ti=function(){var e=function(){function e(t,i,a,n){s(this,e),this.dialog=t,this.attributesManager=i,this.facilityManager=a,this.route=n,this.attributes=[],this.selected=new xe.Ov(!0,[]),this.host={beanName:"",id:0},this.tableId=Le.rF}return r(e,[{key:"ngOnInit",value:function(){var e=this;this.route.params.subscribe(function(t){e.hostId=t.hostId,e.facilityManager.getHostById(e.hostId).subscribe(function(t){e.host=t}),e.refreshTable()})}},{key:"refreshTable",value:function(){var e=this;this.loading=!0,this.attributesManager.getHostAttributes(this.hostId).subscribe(function(t){e.attributes=(0,p.MX)(t),e.selected.clear(),e.loading=!1})}},{key:"onSave",value:function(){var e=this;this.list.updateMapAttributes();var t=(0,p.kZ)();t.width="450px",t.data={entityId:this.hostId,entity:"host",attributes:this.selected.selected},this.dialog.open(m.wA,t).afterClosed().subscribe(function(t){t&&e.refreshTable()})}},{key:"addAttribute",value:function(){var e=this,t=(0,p.kZ)();t.width="1050px",t.data={entityId:this.hostId,entity:"host",notEmptyAttributes:this.attributes,style:"facility-theme"},this.dialog.open(mi.n,t).afterClosed().subscribe(function(t){"saved"===t&&e.refreshTable()})}},{key:"removeAttribute",value:function(){var e=this,t=(0,p.kZ)();t.width="450px",t.data={entityId:this.hostId,entity:"host",attributes:this.selected.selected,theme:"facility-theme"},this.dialog.open(gi.k,t).afterClosed().subscribe(function(t){t&&e.refreshTable()})}}]),e}();return e.\u0275fac=function(t){return new(t||e)(v.Y36(A.uw),v.Y36(f.H8),v.Y36(f.IQ),v.Y36(c.gz))},e.\u0275cmp=v.Xpm({type:e,selectors:[["app-facility-hosts-detail"]],viewQuery:function(e,t){var i;(1&e&&v.Gf(vi,5),2&e)&&(v.iGM(i=v.CRH())&&(t.list=i.first))},decls:15,vars:16,consts:[[1,"page-subtitle"],[3,"refresh"],["mat-flat-button","","color","accent",1,"mr-2",3,"click"],["mat-flat-button","","color","accent",1,"mr-2",3,"disabled","click"],["mat-flat-button","","color","warn",1,"ml-2",3,"disabled","click"],[3,"tableId","attributes","selection",4,"ngIf"],[3,"tableId","attributes","selection"],["list",""]],template:function(e,t){1&e&&(v.TgZ(0,"div"),v.TgZ(1,"h1",0),v._uU(2),v.ALo(3,"translate"),v.qZA(),v.TgZ(4,"perun-web-apps-refresh-button",1),v.NdJ("refresh",function(){return t.refreshTable()}),v.qZA(),v.TgZ(5,"button",2),v.NdJ("click",function(){return t.addAttribute()}),v._uU(6),v.ALo(7,"translate"),v.qZA(),v.TgZ(8,"button",3),v.NdJ("click",function(){return t.onSave()}),v._uU(9),v.ALo(10,"translate"),v.qZA(),v.TgZ(11,"button",4),v.NdJ("click",function(){return t.removeAttribute()}),v._uU(12),v.ALo(13,"translate"),v.qZA(),v.YNc(14,Ai,2,3,"perun-web-apps-attributes-list",5),v.qZA()),2&e&&(v.xp6(2),v.AsE(" ",v.lcZ(3,8,"FACILITY_DETAIL.HOSTS.HOSTS_DETAIL.TITLE")," ",t.host.hostname,""),v.xp6(4),v.hij(" ",v.lcZ(7,10,"FACILITY_DETAIL.HOSTS.HOSTS_DETAIL.ADD")," "),v.xp6(2),v.Q6J("disabled",0===t.selected.selected.length),v.xp6(1),v.hij(" ",v.lcZ(10,12,"FACILITY_DETAIL.HOSTS.HOSTS_DETAIL.SAVE")," "),v.xp6(2),v.Q6J("disabled",0===t.selected.selected.length),v.xp6(1),v.hij(" ",v.lcZ(13,14,"FACILITY_DETAIL.HOSTS.HOSTS_DETAIL.REMOVE")," "),v.xp6(2),v.Q6J("ngIf",!t.loading))},directives:[Be.t,C.lW,o.O5,Si.p],pipes:[_.X$],styles:[""]}),e}();function Ii(e,t){if(1&e){var i=v.EpF();v.TgZ(0,"th",15),v.TgZ(1,"mat-checkbox",16),v.NdJ("change",function(e){v.CHM(i);var t=v.oxw();return e?t.masterToggle():null}),v.qZA(),v.qZA()}if(2&e){var a=v.oxw();v.xp6(1),v.Q6J("aria-label",a.checkboxLabel())("checked",a.selection.hasValue()&&a.isAllSelected())("indeterminate",a.selection.hasValue()&&!a.isAllSelected())}}function yi(e,t){if(1&e){var i=v.EpF();v.TgZ(0,"td",17),v.TgZ(1,"mat-checkbox",18),v.NdJ("change",function(e){var t=v.CHM(i).$implicit,a=v.oxw();return e?a.selection.toggle(t):null})("click",function(e){return e.stopPropagation()}),v.qZA(),v.qZA()}if(2&e){var a=t.$implicit,n=v.oxw();v.xp6(1),v.Q6J("aria-label",n.checkboxLabel(a))("checked",n.selection.isSelected(a))}}function bi(e,t){1&e&&(v.TgZ(0,"th",19),v._uU(1),v.ALo(2,"translate"),v.qZA()),2&e&&(v.xp6(1),v.Oqu(v.lcZ(2,1,"SHARED.COMPONENTS.SECURITY_TEAMS_LIST.ID")))}function Ei(e,t){if(1&e&&(v.TgZ(0,"td",20),v._uU(1),v.qZA()),2&e){var i=t.$implicit;v.xp6(1),v.Oqu(i.id)}}function Zi(e,t){1&e&&(v.TgZ(0,"th",19),v._uU(1),v.ALo(2,"translate"),v.qZA()),2&e&&(v.xp6(1),v.Oqu(v.lcZ(2,1,"SHARED.COMPONENTS.SECURITY_TEAMS_LIST.NAME")))}function Ci(e,t){if(1&e&&(v.TgZ(0,"td",21),v._uU(1),v.qZA()),2&e){var i=t.$implicit;v.xp6(1),v.Oqu(i.name)}}function _i(e,t){1&e&&(v.TgZ(0,"th",19),v._uU(1),v.ALo(2,"translate"),v.qZA()),2&e&&(v.xp6(1),v.Oqu(v.lcZ(2,1,"SHARED.COMPONENTS.SECURITY_TEAMS_LIST.DESCRIPTION")))}function ki(e,t){if(1&e&&(v.TgZ(0,"td",21),v._uU(1),v.qZA()),2&e){var i=t.$implicit;v.xp6(1),v.Oqu(i.description)}}function Li(e,t){1&e&&v._UZ(0,"tr",22)}function xi(e,t){1&e&&v._UZ(0,"tr",23)}function Oi(e,t){1&e&&(v.TgZ(0,"app-alert",24),v._uU(1),v.ALo(2,"translate"),v.qZA()),2&e&&(v.xp6(1),v.hij(" ",v.lcZ(2,1,"SHARED_LIB.UI.ALERTS.NO_FILTER_RESULTS_ALERT"),"\n"))}function Ri(e,t){1&e&&(v.TgZ(0,"app-alert",24),v._uU(1),v.ALo(2,"translate"),v.qZA()),2&e&&(v.xp6(1),v.hij(" ",v.lcZ(2,1,"SHARED.COMPONENTS.SECURITY_TEAMS_LIST.NO_SECURITY_TEAMS_WARNING"),"\n"))}var Di=function(){var e=function(){function e(t,i){s(this,e),this.authResolver=t,this.tableCheckbox=i,this.securityTeams=[],this.selection=new xe.Ov(!0,[]),this.displayedColumns=["select","id","name","description"],this.pageSizeOptions=p.f7}return r(e,[{key:"matSort",set:function(e){this.sort=e,this.setDataSource()}},{key:"ngOnChanges",value:function(){this.authResolver.isPerunAdminOrObserver()||(this.displayedColumns=this.displayedColumns.filter(function(e){return"id"!==e})),this.dataSource=new lt.by(this.securityTeams),this.setDataSource(),this.dataSource.filter=this.filterValue}},{key:"getDataForColumn",value:function(e,t){switch(t){case"id":return e.id.toString();case"name":return e.name;case"description":return e.description;default:return""}}},{key:"exportData",value:function(e){(0,p.O6)((0,p.Xn)(this.dataSource.filteredData,this.displayedColumns,this.getDataForColumn,this),e)}},{key:"setDataSource",value:function(){var e=this;this.dataSource&&(this.dataSource.filterPredicate=function(t,i){return(0,p.Sd)(t,i,e.displayedColumns,e.getDataForColumn,e)},this.dataSource.sortData=function(t,i){return(0,p.pR)(t,i,e.getDataForColumn,e)},this.dataSource.sort=this.sort,this.dataSource.paginator=this.child.paginator)}},{key:"isAllSelected",value:function(){return this.tableCheckbox.isAllSelected(this.selection.selected.length,this.filterValue,this.child.paginator.pageSize,this.child.paginator.hasNextPage(),this.dataSource)}},{key:"masterToggle",value:function(){this.tableCheckbox.masterToggle(this.isAllSelected(),this.selection,this.filterValue,this.dataSource,this.sort,this.child.paginator.pageSize,this.child.paginator.pageIndex,!1)}},{key:"checkboxLabel",value:function(e){return e?"".concat(this.selection.isSelected(e)?"deselect":"select"," row ").concat(e.id+1):(this.isAllSelected()?"select":"deselect")+" all"}},{key:"ngAfterViewInit",value:function(){this.dataSource.paginator=this.child.paginator}}]),e}();return e.\u0275fac=function(t){return new(t||e)(v.Y36(g.x4),v.Y36(g.UA))},e.\u0275cmp=v.Xpm({type:e,selectors:[["app-security-teams-list"]],viewQuery:function(e,t){var i;(1&e&&(v.Gf(Ot.YE,7),v.Gf(p.l9,7)),2&e)&&(v.iGM(i=v.CRH())&&(t.matSort=i.first),v.iGM(i=v.CRH())&&(t.child=i.first))},inputs:{securityTeams:"securityTeams",selection:"selection",filterValue:"filterValue",tableId:"tableId",displayedColumns:"displayedColumns"},features:[v.TTD],decls:19,vars:9,consts:[[1,"card","mt-3",3,"hidden"],[3,"tableId","dataLength","pageSizeOptions","exportData"],["mat-table","","matSort","","matSortActive","id","matSortDirection","asc","matSortDisableClear","",1,"w-100",3,"dataSource"],["matColumnDef","select"],["mat-header-cell","","class","align-checkbox",4,"matHeaderCellDef"],["class","static-column-size align-checkbox","mat-cell","",4,"matCellDef"],["matColumnDef","id"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["class","static-column-size","mat-cell","",4,"matCellDef"],["matColumnDef","name"],["mat-cell","",4,"matCellDef"],["matColumnDef","description"],["mat-header-row","",4,"matHeaderRowDef"],["class","dark-hover-list-item","mat-row","",4,"matRowDef","matRowDefColumns"],["alert_type","warn",4,"ngIf"],["mat-header-cell","",1,"align-checkbox"],["color","primary",3,"aria-label","checked","indeterminate","change"],["mat-cell","",1,"static-column-size","align-checkbox"],["color","primary",3,"aria-label","checked","change","click"],["mat-header-cell","","mat-sort-header",""],["mat-cell","",1,"static-column-size"],["mat-cell",""],["mat-header-row",""],["mat-row","",1,"dark-hover-list-item"],["alert_type","warn"]],template:function(e,t){1&e&&(v.TgZ(0,"div",0),v.TgZ(1,"perun-web-apps-table-wrapper",1),v.NdJ("exportData",function(e){return t.exportData(e)}),v.TgZ(2,"table",2),v.ynx(3,3),v.YNc(4,Ii,2,3,"th",4),v.YNc(5,yi,2,2,"td",5),v.BQk(),v.ynx(6,6),v.YNc(7,bi,3,3,"th",7),v.YNc(8,Ei,2,1,"td",8),v.BQk(),v.ynx(9,9),v.YNc(10,Zi,3,3,"th",7),v.YNc(11,Ci,2,1,"td",10),v.BQk(),v.ynx(12,11),v.YNc(13,_i,3,3,"th",7),v.YNc(14,ki,2,1,"td",10),v.BQk(),v.YNc(15,Li,1,0,"tr",12),v.YNc(16,xi,1,0,"tr",13),v.qZA(),v.qZA(),v.qZA(),v.YNc(17,Oi,3,3,"app-alert",14),v.YNc(18,Ri,3,3,"app-alert",14)),2&e&&(v.Q6J("hidden",0===t.dataSource.filteredData.length||0===t.securityTeams.length),v.xp6(1),v.Q6J("tableId",t.tableId)("dataLength",t.dataSource.filteredData.length)("pageSizeOptions",t.pageSizeOptions),v.xp6(1),v.Q6J("dataSource",t.dataSource),v.xp6(13),v.Q6J("matHeaderRowDef",t.displayedColumns),v.xp6(1),v.Q6J("matRowDefColumns",t.displayedColumns),v.xp6(1),v.Q6J("ngIf",0===t.dataSource.filteredData.length&&0!==t.securityTeams.length),v.xp6(1),v.Q6J("ngIf",0===t.securityTeams.length))},directives:[Rt.l,lt.BZ,Ot.YE,lt.w1,lt.fO,lt.Dz,lt.as,lt.nj,o.O5,lt.ge,ue.oG,lt.ev,Ot.nU,lt.XQ,lt.Gk,Nt.w],pipes:[_.X$],styles:[""]}),e}();function Ni(e,t){1&e&&v._UZ(0,"mat-spinner",5)}function wi(e,t){if(1&e&&v._UZ(0,"app-security-teams-list",6),2&e){var i=v.oxw();v.Q6J("tableId",i.tableId)("filterValue",i.filterValue)("securityTeams",i.securityTeams)("displayedColumns",i.displayedColumns)("selection",i.selected)}}var Yi=function(){var e=function(){function e(t,i,a,n){s(this,e),this.dialog=t,this.facilitiesManager=i,this.authResolver=a,this.entityStorageService=n,this.securityTeams=[],this.selected=new xe.Ov(!0,[]),this.filterValue="",this.tableId=Le.O9,this.displayedColumns=[]}return r(e,[{key:"ngOnInit",value:function(){this.facility=this.entityStorageService.getEntity(),this.refreshTable()}},{key:"refreshTable",value:function(){var e=this;this.loading=!0,this.facilitiesManager.getAssignedSecurityTeams(this.facility.id).subscribe(function(t){e.securityTeams=t,e.selected.clear(),e.setAuthRights(),e.loading=!1})}},{key:"setAuthRights",value:function(){this.addAuth=this.authResolver.isAuthorized("assignSecurityTeam_Facility_SecurityTeam_policy",[this.facility]),this.removeAuth=this.authResolver.isAuthorized("removeSecurityTeam_Facility_SecurityTeam_policy",[this.facility]),this.displayedColumns=this.removeAuth?["select","id","name","description"]:["id","name","description"]}},{key:"applyFilter",value:function(e){this.filterValue=e}},{key:"addSecurityTeam",value:function(){}},{key:"removeSecurityTeam",value:function(){}}]),e}();return e.\u0275fac=function(t){return new(t||e)(v.Y36(A.uw),v.Y36(f.IQ),v.Y36(g.x4),v.Y36(g.fb))},e.\u0275cmp=v.Xpm({type:e,selectors:[["app-facility-security-teams"]],decls:8,vars:6,consts:[[1,"page-subtitle"],[3,"refresh"],[3,"placeholder","filter"],["class","ml-auto mr-auto",4,"ngIf"],[3,"tableId","filterValue","securityTeams","displayedColumns","selection",4,"ngIf"],[1,"ml-auto","mr-auto"],[3,"tableId","filterValue","securityTeams","displayedColumns","selection"]],template:function(e,t){1&e&&(v.TgZ(0,"div"),v.TgZ(1,"h1",0),v._uU(2),v.ALo(3,"translate"),v.qZA(),v.TgZ(4,"perun-web-apps-refresh-button",1),v.NdJ("refresh",function(){return t.refreshTable()}),v.qZA(),v.TgZ(5,"perun-web-apps-immediate-filter",2),v.NdJ("filter",function(e){return t.applyFilter(e)}),v.qZA(),v.YNc(6,Ni,1,0,"mat-spinner",3),v.YNc(7,wi,1,5,"app-security-teams-list",4),v.qZA()),2&e&&(v.xp6(2),v.Oqu(v.lcZ(3,4,"FACILITY_DETAIL.SECURITY_TEAMS.TITLE")),v.xp6(3),v.Q6J("placeholder","FACILITY_DETAIL.SECURITY_TEAMS.FILTER"),v.xp6(1),v.Q6J("ngIf",t.loading),v.xp6(1),v.Q6J("ngIf",!t.loading))},directives:[Be.t,Ge.L,o.O5,y.$g,Di],pipes:[_.X$],styles:[""]}),e}(),Fi=l(64359),Mi=l(8705);function Ui(e,t){1&e&&v._UZ(0,"mat-spinner",6)}function qi(e,t){1&e&&(v.TgZ(0,"th",17),v._uU(1),v.ALo(2,"translate"),v.qZA()),2&e&&(v.xp6(1),v.Oqu(v.lcZ(2,1,"DIALOGS.DELETE_TASK_RESULT.RESULT_ID")))}function Ji(e,t){if(1&e&&(v.TgZ(0,"td",18),v._uU(1),v.qZA()),2&e){var i=t.$implicit;v.xp6(1),v.hij(" ",i.id," ")}}function Qi(e,t){1&e&&(v.TgZ(0,"th",17),v._uU(1),v.ALo(2,"translate"),v.qZA()),2&e&&(v.xp6(1),v.Oqu(v.lcZ(2,1,"DIALOGS.DELETE_TASK_RESULT.DESTINATION")))}function Vi(e,t){if(1&e&&(v.TgZ(0,"td",18),v._uU(1),v.qZA()),2&e){var i=t.$implicit;v.xp6(1),v.hij(" ",i.destination.destination," ")}}function Hi(e,t){1&e&&(v.TgZ(0,"th",17),v._uU(1),v.ALo(2,"translate"),v.qZA()),2&e&&(v.xp6(1),v.Oqu(v.lcZ(2,1,"DIALOGS.DELETE_TASK_RESULT.TIME")))}function Pi(e,t){if(1&e&&(v.TgZ(0,"td",18),v._uU(1),v.ALo(2,"date"),v.qZA()),2&e){var i=t.$implicit;v.xp6(1),v.hij(" ",v.xi3(2,1,i.timestamp,"d.M.y H:mm:ss")," ")}}function Bi(e,t){1&e&&v._UZ(0,"tr",19)}function Gi(e,t){1&e&&v._UZ(0,"tr",20)}function $i(e,t){if(1&e&&(v.TgZ(0,"div",7),v.TgZ(1,"p"),v._uU(2),v.ALo(3,"translate"),v.qZA(),v.TgZ(4,"div",8),v._uU(5),v.ALo(6,"translate"),v.qZA(),v.TgZ(7,"table",9),v.ynx(8,10),v.YNc(9,qi,3,3,"th",11),v.YNc(10,Ji,2,1,"td",12),v.BQk(),v.ynx(11,13),v.YNc(12,Qi,3,3,"th",11),v.YNc(13,Vi,2,1,"td",12),v.BQk(),v.ynx(14,14),v.YNc(15,Hi,3,3,"th",11),v.YNc(16,Pi,3,4,"td",12),v.BQk(),v.YNc(17,Bi,1,0,"tr",15),v.YNc(18,Gi,1,0,"tr",16),v.qZA(),v.qZA()),2&e){var i=v.oxw();v.xp6(2),v.Oqu(v.lcZ(3,5,"DIALOGS.DELETE_TASK_RESULT.DESCRIPTION")),v.xp6(3),v.hij(" ",v.lcZ(6,7,"DIALOGS.DELETE_TASK_RESULT.ASK")," "),v.xp6(2),v.Q6J("dataSource",i.dataSource),v.xp6(10),v.Q6J("matHeaderRowDef",i.displayedColumns),v.xp6(1),v.Q6J("matRowDefColumns",i.displayedColumns)}}var zi=function(){var e=function(){function e(t,i,a,n,l){s(this,e),this.dialogRef=t,this.data=i,this.taskManager=a,this.notificator=n,this.translate=l,this.loading=!1,this.dataSource=new lt.by(this.data.taskResults),this.displayedColumns=["id","destination","time"]}return r(e,[{key:"ngOnInit",value:function(){this.theme=this.data.theme,this.taskResults=this.data.taskResults}},{key:"deleteResults",value:function(){var e=this;if(this.loading=!0,0===this.taskResults.length)return this.dialogRef.close(!0),this.loading=!1,void this.notificator.showSuccess(this.translate.instant("DIALOGS.DELETE_TASK_RESULT.SUCCESS"));this.taskManager.deleteTaskResultById({taskResultId:this.taskResults.pop().id}).subscribe(function(){e.deleteResults()},function(){return e.loading=!1})}},{key:"onDelete",value:function(){this.deleteResults()}},{key:"onCancel",value:function(){this.dialogRef.close(!1)}}]),e}();return e.\u0275fac=function(t){return new(t||e)(v.Y36(A.so),v.Y36(A.WI),v.Y36(f.Ob),v.Y36(g.V6),v.Y36(_.sK))},e.\u0275cmp=v.Xpm({type:e,selectors:[["app-delete-task-result-dialog"]],decls:13,vars:15,consts:[["mat-dialog-title",""],["class","ml-auto mr-auto",4,"ngIf"],["mat-dialog-content","",4,"ngIf"],["mat-dialog-actions",""],["mat-flat-button","",1,"ml-auto",3,"click"],["mat-flat-button","","color","warn",1,"ml-2",3,"disabled","click"],[1,"ml-auto","mr-auto"],["mat-dialog-content",""],[1,"font-weight-bold"],["mat-table","",1,"w-100",3,"dataSource"],["matColumnDef","id"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","destination"],["matColumnDef","time"],["mat-header-row","","class","font-weight-bolder",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["mat-header-cell",""],["mat-cell",""],["mat-header-row","",1,"font-weight-bolder"],["mat-row",""]],template:function(e,t){1&e&&(v.TgZ(0,"h1",0),v._uU(1),v.ALo(2,"translate"),v.qZA(),v.TgZ(3,"div"),v.YNc(4,Ui,1,0,"mat-spinner",1),v.YNc(5,$i,19,9,"div",2),v.TgZ(6,"div",3),v.TgZ(7,"button",4),v.NdJ("click",function(){return t.onCancel()}),v._uU(8),v.ALo(9,"translate"),v.qZA(),v.TgZ(10,"button",5),v.NdJ("click",function(){return t.onDelete()}),v._uU(11),v.ALo(12,"translate"),v.qZA(),v.qZA(),v.qZA()),2&e&&(v.xp6(1),v.Oqu(v.lcZ(2,9,"DIALOGS.DELETE_TASK_RESULT.TITLE")),v.xp6(2),v.Tol(t.theme),v.xp6(1),v.Q6J("ngIf",t.loading),v.xp6(1),v.Q6J("ngIf",!t.loading),v.xp6(3),v.hij(" ",v.lcZ(9,11,"DIALOGS.DELETE_TASK_RESULT.CANCEL")," "),v.xp6(2),v.Q6J("disabled",t.loading),v.xp6(1),v.hij(" ",v.lcZ(12,13,"DIALOGS.DELETE_TASK_RESULT.REMOVE")," "))},directives:[A.uh,o.O5,A.H8,C.lW,y.$g,A.xY,lt.BZ,lt.w1,lt.fO,lt.Dz,lt.as,lt.nj,lt.ge,lt.ev,lt.XQ,lt.Gk],pipes:[_.X$,o.uU],styles:[""]}),e}(),ji=l(88884);function Ki(e,t){1&e&&v._UZ(0,"mat-spinner",6)}function Wi(e,t){if(1&e){var i=v.EpF();v.TgZ(0,"mat-checkbox",13),v.NdJ("change",function(e){return v.CHM(i),v.oxw(2).change(e)}),v.ALo(1,"translate"),v._uU(2),v.ALo(3,"translate"),v.qZA()}if(2&e){var a=v.oxw(2);v.s9C("matTooltip",v.lcZ(1,5,"DIALOGS.REMOVE_SERVICE_FROM_FACILITY.CHECKBOXES_DISABLED")),v.Q6J("matTooltipDisabled",!a.checkboxesDisabled)("disabled",a.checkboxesDisabled)("checked",a.taskChecked),v.xp6(2),v.hij(" ",v.lcZ(3,7,"DIALOGS.REMOVE_SERVICE_FROM_FACILITY.CHECKBOX_TASK_AND_TASK_RESULTS")," ")}}function Xi(e,t){if(1&e){var i=v.EpF();v.TgZ(0,"mat-checkbox",14),v.NdJ("change",function(e){return v.CHM(i),v.oxw(2).change(e)}),v.ALo(1,"translate"),v._uU(2),v.ALo(3,"translate"),v.qZA()}if(2&e){var a=v.oxw(2);v.s9C("matTooltip",v.lcZ(1,5,"DIALOGS.REMOVE_SERVICE_FROM_FACILITY.CHECKBOXES_DISABLED")),v.Q6J("matTooltipDisabled",!a.checkboxesDisabled)("disabled",a.checkboxesDisabled)("checked",a.taskResultsChecked),v.xp6(2),v.hij(" ",v.lcZ(3,7,"DIALOGS.REMOVE_SERVICE_FROM_FACILITY.CHECKBOX_TASK_RESULTS")," ")}}function ea(e,t){if(1&e){var i=v.EpF();v.TgZ(0,"perun-web-apps-resources-list",15),v.NdJ("allSelected",function(e){return v.CHM(i),v.oxw(2).disableCheckboxes(e)}),v.qZA()}if(2&e){var a=v.oxw(2);v.Q6J("tableId",a.tableId)("disableRouting",!0)("resources",a.resources)("selection",a.selected)("displayedColumns",a.displayedColumns)}}function ta(e,t){if(1&e){var i=v.EpF();v.TgZ(0,"div",7),v.TgZ(1,"p"),v._uU(2),v.ALo(3,"translate"),v.qZA(),v.TgZ(4,"div"),v.YNc(5,Wi,4,9,"mat-checkbox",8),v.YNc(6,Xi,4,9,"mat-checkbox",9),v.TgZ(7,"mat-checkbox",10),v.NdJ("change",function(e){return v.CHM(i),v.oxw().change(e)}),v.ALo(8,"translate"),v._uU(9),v.ALo(10,"translate"),v.qZA(),v.qZA(),v.TgZ(11,"p"),v._uU(12),v.ALo(13,"translate"),v.qZA(),v.TgZ(14,"div",11),v._uU(15),v.ALo(16,"translate"),v.qZA(),v.YNc(17,ea,1,5,"perun-web-apps-resources-list",12),v.qZA()}if(2&e){var a=v.oxw();v.xp6(2),v.Oqu(v.lcZ(3,11,"DIALOGS.REMOVE_SERVICE_FROM_FACILITY.CHECKBOXES_DESCRIPTION")),v.xp6(3),v.Q6J("ngIf",null!==a.taskId),v.xp6(1),v.Q6J("ngIf",null!==a.taskId),v.xp6(1),v.s9C("matTooltip",v.lcZ(8,13,"DIALOGS.REMOVE_SERVICE_FROM_FACILITY.CHECKBOXES_DISABLED")),v.Q6J("matTooltipDisabled",!a.checkboxesDisabled)("disabled",a.checkboxesDisabled)("checked",a.destinationChecked),v.xp6(2),v.hij(" ",v.lcZ(10,15,"DIALOGS.REMOVE_SERVICE_FROM_FACILITY.CHECKBOX_DESTINATION")," "),v.xp6(3),v.Oqu(v.lcZ(13,17,"DIALOGS.REMOVE_SERVICE_FROM_FACILITY.DESCRIPTION")),v.xp6(3),v.hij(" ",v.lcZ(16,19,"DIALOGS.REMOVE_SERVICE_FROM_FACILITY.ASK")," "),v.xp6(2),v.Q6J("ngIf",!a.loading)}}var ia=function(){var t=function(){function t(i,a,n,l,r,o,c,u){s(this,t),this.dialogRef=i,this.data=a,this.resourcesManager=n,this.tasksManager=l,this.serviceManager=r,this.translate=o,this.notificator=c,this.cd=u,this.loading=!1,this.dataSource=new lt.by(this.data.resource),this.selected=new xe.Ov(!0,e(this.dataSource.data)),this.resources=[],this.displayedColumns=["select","id","vo","name"],this.checkboxesDisabled=!1,this.taskChecked=!0,this.taskResultsChecked=!0,this.destinationChecked=!0,this.tableId=Le.$V}return r(t,[{key:"ngOnInit",value:function(){this.theme=this.data.theme,this.taskId=this.data.taskId,this.serviceId=this.data.serviceId,this.facilityId=this.data.facilityId,this.resources=this.data.resource}},{key:"remove",value:function(){var e=this;this.loading=!0,this.taskResultsChecked&&!this.taskChecked&&null!==this.taskId&&this.tasksManager.getTaskResultsForGUIByTask(this.taskId).subscribe(function(t){t.forEach(function(t){e.tasksManager.deleteTaskResultById({taskResultId:t.id}).subscribe()})}),this.taskChecked&&null!==this.taskId&&this.tasksManager.deleteTask({task:this.taskId}).subscribe(),this.destinationChecked&&this.serviceManager.getDestinations(this.serviceId,this.facilityId).subscribe(function(t){t.forEach(function(t){e.serviceManager.removeDestination(e.serviceId,e.facilityId,t.destination,t.type).subscribe()})}),this.selected.selected.forEach(function(t){e.resourcesManager.removeService(t.id,e.serviceId).subscribe(function(){e.translate.get("DIALOGS.REMOVE_SERVICE_FROM_FACILITY.SUCCESS").subscribe(function(t){e.notificator.showSuccess(t),e.dialogRef.close(!0)})},function(){return e.loading=!1})})}},{key:"cancel",value:function(){this.dialogRef.close(!1)}},{key:"disableCheckboxes",value:function(e){e&&this.checkboxesDisabled&&this.changeCheckboxes(!0),e||this.checkboxesDisabled||this.changeCheckboxes(!1)}},{key:"changeCheckboxes",value:function(e){this.checkboxesDisabled=!e,this.taskChecked=e,this.taskResultsChecked=e,this.destinationChecked=e,this.cd.detectChanges()}},{key:"change",value:function(e){switch(e.source.id){case"task":this.taskChecked=e.checked;break;case"taskResults":this.taskResultsChecked=e.checked;break;case"destination":this.destinationChecked=e.checked}}}]),t}();return t.\u0275fac=function(e){return new(e||t)(v.Y36(A.so),v.Y36(A.WI),v.Y36(f.xk),v.Y36(f.Ob),v.Y36(f.KK),v.Y36(_.sK),v.Y36(g.V6),v.Y36(v.sBO))},t.\u0275cmp=v.Xpm({type:t,selectors:[["app-delete-service-from-facility"]],decls:13,vars:15,consts:[["mat-dialog-title",""],["class","ml-auto mr-auto",4,"ngIf"],["mat-dialog-content","",4,"ngIf"],["mat-dialog-actions",""],["mat-flat-button","",1,"ml-auto",3,"click"],["mat-flat-button","","color","warn",1,"ml-2",3,"disabled","click"],[1,"ml-auto","mr-auto"],["mat-dialog-content",""],["id","task","class","right-space","color","warn",3,"matTooltip","matTooltipDisabled","disabled","checked","change",4,"ngIf"],["id","taskResults","class","right-space","color","warn",3,"matTooltip","matTooltipDisabled","disabled","checked","change",4,"ngIf"],["id","destination","color","warn",3,"matTooltip","matTooltipDisabled","disabled","checked","change"],[1,"font-weight-bold"],[3,"tableId","disableRouting","resources","selection","displayedColumns","allSelected",4,"ngIf"],["id","task","color","warn",1,"right-space",3,"matTooltip","matTooltipDisabled","disabled","checked","change"],["id","taskResults","color","warn",1,"right-space",3,"matTooltip","matTooltipDisabled","disabled","checked","change"],[3,"tableId","disableRouting","resources","selection","displayedColumns","allSelected"]],template:function(e,t){1&e&&(v.TgZ(0,"h1",0),v._uU(1),v.ALo(2,"translate"),v.qZA(),v.TgZ(3,"div"),v.YNc(4,Ki,1,0,"mat-spinner",1),v.YNc(5,ta,18,21,"div",2),v.TgZ(6,"div",3),v.TgZ(7,"button",4),v.NdJ("click",function(){return t.cancel()}),v._uU(8),v.ALo(9,"translate"),v.qZA(),v.TgZ(10,"button",5),v.NdJ("click",function(){return t.remove()}),v._uU(11),v.ALo(12,"translate"),v.qZA(),v.qZA(),v.qZA()),2&e&&(v.xp6(1),v.Oqu(v.lcZ(2,9,"DIALOGS.REMOVE_SERVICE_FROM_FACILITY.TITLE")),v.xp6(2),v.Tol(t.theme),v.xp6(1),v.Q6J("ngIf",t.loading),v.xp6(1),v.Q6J("ngIf",!t.loading),v.xp6(3),v.hij(" ",v.lcZ(9,11,"DIALOGS.REMOVE_SERVICE_FROM_FACILITY.CANCEL")," "),v.xp6(2),v.Q6J("disabled",t.loading||0===t.selected.selected.length),v.xp6(1),v.hij(" ",v.lcZ(12,13,"DIALOGS.REMOVE_SERVICE_FROM_FACILITY.REMOVE")," "))},directives:[A.uh,o.O5,A.H8,C.lW,y.$g,A.xY,ue.oG,E.gM,ji.C],pipes:[_.X$],styles:[".right-space[_ngcontent-%COMP%]{margin-right:40px}"]}),t}();function aa(e,t){1&e&&v._UZ(0,"mat-spinner",6)}function na(e,t){1&e&&(v.TgZ(0,"div",7),v.TgZ(1,"div",8),v._uU(2),v.ALo(3,"translate"),v.qZA(),v.qZA()),2&e&&(v.xp6(2),v.hij(" ",v.lcZ(3,1,"DIALOGS.DELETE_TASK.DESCRIPTION")," "))}var sa=function(){var e=function(){function e(t,i,a,n,l){s(this,e),this.dialogRef=t,this.data=i,this.tasksManager=a,this.translate=n,this.notificator=l,this.loading=!1}return r(e,[{key:"ngOnInit",value:function(){this.theme=this.data.theme,this.taskId=this.data.taskId}},{key:"remove",value:function(){var e=this;this.loading=!0,this.tasksManager.deleteTask({task:this.taskId}).subscribe(function(){e.translate.get("DIALOGS.DELETE_TASK.SUCCESS").subscribe(function(t){e.notificator.showSuccess(t),e.dialogRef.close(!0)})},function(){return e.loading=!1})}},{key:"cancel",value:function(){this.dialogRef.close(!1)}}]),e}();return e.\u0275fac=function(t){return new(t||e)(v.Y36(A.so),v.Y36(A.WI),v.Y36(f.Ob),v.Y36(_.sK),v.Y36(g.V6))},e.\u0275cmp=v.Xpm({type:e,selectors:[["app-delete-task-dialog"]],decls:13,vars:15,consts:[["mat-dialog-title",""],["class","ml-auto mr-auto",4,"ngIf"],["mat-dialog-content","",4,"ngIf"],["mat-dialog-actions",""],["mat-flat-button","",1,"ml-auto",3,"click"],["mat-flat-button","","color","warn",1,"ml-2",3,"disabled","click"],[1,"ml-auto","mr-auto"],["mat-dialog-content",""],[1,"font-weight-bold"]],template:function(e,t){1&e&&(v.TgZ(0,"h1",0),v._uU(1),v.ALo(2,"translate"),v.qZA(),v.TgZ(3,"div"),v.YNc(4,aa,1,0,"mat-spinner",1),v.YNc(5,na,4,3,"div",2),v.TgZ(6,"div",3),v.TgZ(7,"button",4),v.NdJ("click",function(){return t.cancel()}),v._uU(8),v.ALo(9,"translate"),v.qZA(),v.TgZ(10,"button",5),v.NdJ("click",function(){return t.remove()}),v._uU(11),v.ALo(12,"translate"),v.qZA(),v.qZA(),v.qZA()),2&e&&(v.xp6(1),v.Oqu(v.lcZ(2,9,"DIALOGS.DELETE_TASK.TITLE")),v.xp6(2),v.Tol(t.theme),v.xp6(1),v.Q6J("ngIf",t.loading),v.xp6(1),v.Q6J("ngIf",!t.loading),v.xp6(3),v.hij(" ",v.lcZ(9,11,"DIALOGS.DELETE_TASK.CANCEL")," "),v.xp6(2),v.Q6J("disabled",t.loading),v.xp6(1),v.hij(" ",v.lcZ(12,13,"DIALOGS.DELETE_TASK.DELETE")," "))},directives:[A.uh,o.O5,A.H8,C.lW,y.$g,A.xY],pipes:[_.X$],styles:[""]}),e}(),la=l(8055),ra=function(){var e=function(){function e(){s(this,e)}return r(e,[{key:"transform",value:function(e){return e.blockedOnFacility?"BLOCKED":e.blockedGlobally?"BLOCKED GLOBALLY":"ALLOWED"}}]),e}();return e.\u0275fac=function(t){return new(t||e)},e.\u0275pipe=v.Yjl({name:"serviceStateBlockedToString",type:e,pure:!0}),e}();function oa(e,t){if(1&e){var i=v.EpF();v.TgZ(0,"th",18),v.TgZ(1,"mat-checkbox",19),v.NdJ("change",function(e){v.CHM(i);var t=v.oxw();return e&&t.masterToggle(),t.selectionChange.emit()}),v.qZA(),v.qZA()}if(2&e){var a=v.oxw();v.xp6(1),v.Q6J("checked",a.selection.hasValue()&&a.isAllSelected())("indeterminate",a.selection.hasValue()&&!a.isAllSelected())("aria-label",a.checkboxLabel())}}function ca(e,t){if(1&e){var i=v.EpF();v.TgZ(0,"td",20),v.TgZ(1,"mat-checkbox",21),v.NdJ("click",function(e){return e.stopPropagation()})("change",function(e){var t=v.CHM(i).$implicit,a=v.oxw();return e&&a.selection.toggle(t),a.selectionChange.emit()}),v.qZA(),v.qZA()}if(2&e){var a=t.$implicit,n=v.oxw();v.xp6(1),v.Q6J("checked",n.selection.isSelected(a))("aria-label",n.checkboxLabel(a))}}function ua(e,t){1&e&&(v.TgZ(0,"th",22),v._uU(1),v.ALo(2,"translate"),v.qZA()),2&e&&(v.xp6(1),v.Oqu(v.lcZ(2,1,"SHARED_LIB.PERUN.COMPONENTS.SERVICES_STATUS_LIST.TASK_ID")))}function da(e,t){if(1&e&&(v.TgZ(0,"div"),v._uU(1),v.qZA()),2&e){var i=v.oxw().$implicit;v.xp6(1),v.Oqu(i.task.id)}}function ha(e,t){1&e&&(v.TgZ(0,"div"),v._uU(1,"0"),v.qZA())}function fa(e,t){if(1&e&&(v.TgZ(0,"td",23),v.YNc(1,da,2,1,"div",24),v.YNc(2,ha,2,0,"div",24),v.qZA()),2&e){var i=t.$implicit;v.xp6(1),v.Q6J("ngIf",i.task),v.xp6(1),v.Q6J("ngIf",!i.task)}}function pa(e,t){1&e&&(v.TgZ(0,"th",22),v._uU(1),v.ALo(2,"translate"),v.qZA()),2&e&&(v.xp6(1),v.Oqu(v.lcZ(2,1,"SHARED_LIB.PERUN.COMPONENTS.SERVICES_STATUS_LIST.SERVICE_NAME")))}function ga(e,t){if(1&e&&(v.TgZ(0,"td",25),v._uU(1),v.qZA()),2&e){var i=t.$implicit;v.xp6(1),v.Oqu(i.service.name)}}function ma(e,t){1&e&&(v.TgZ(0,"th",22),v._uU(1),v.ALo(2,"translate"),v.qZA()),2&e&&(v.xp6(1),v.Oqu(v.lcZ(2,1,"SHARED_LIB.PERUN.COMPONENTS.SERVICES_STATUS_LIST.STATUS")))}function Sa(e,t){if(1&e&&(v.TgZ(0,"td",25),v._uU(1),v.qZA()),2&e){var i=t.$implicit;v.xp6(1),v.Oqu(i.status)}}function va(e,t){1&e&&(v.TgZ(0,"th",22),v._uU(1),v.ALo(2,"translate"),v.qZA()),2&e&&(v.xp6(1),v.Oqu(v.lcZ(2,1,"SHARED_LIB.PERUN.COMPONENTS.SERVICES_STATUS_LIST.BLOCKED")))}function Aa(e,t){if(1&e&&(v.TgZ(0,"td",25),v._uU(1),v.ALo(2,"serviceStateBlockedToString"),v.qZA()),2&e){var i=t.$implicit;v.xp6(1),v.Oqu(v.lcZ(2,1,i))}}function Ta(e,t){1&e&&(v.TgZ(0,"th",22),v._uU(1),v.ALo(2,"translate"),v.qZA()),2&e&&(v.xp6(1),v.Oqu(v.lcZ(2,1,"SHARED_LIB.PERUN.COMPONENTS.SERVICES_STATUS_LIST.STARTED")))}function Ia(e,t){if(1&e&&(v.TgZ(0,"div"),v._uU(1),v.ALo(2,"date"),v.qZA()),2&e){var i=v.oxw().$implicit;v.xp6(1),v.Oqu(v.xi3(2,1,i.task.startTime,"d.M.y H:mm:ss"))}}function ya(e,t){1&e&&(v.TgZ(0,"div"),v._uU(1),v.ALo(2,"translate"),v.qZA()),2&e&&(v.xp6(1),v.hij(" ",v.lcZ(2,1,"SHARED_LIB.PERUN.COMPONENTS.SERVICES_STATUS_LIST.NOT_YET"),""))}function ba(e,t){if(1&e&&(v.TgZ(0,"td",25),v.YNc(1,Ia,3,4,"div",24),v.YNc(2,ya,3,3,"div",24),v.qZA()),2&e){var i=t.$implicit;v.xp6(1),v.Q6J("ngIf",i.task&&i.task.startTime),v.xp6(1),v.Q6J("ngIf",!i.task||!i.task.startTime)}}function Ea(e,t){1&e&&(v.TgZ(0,"th",22),v._uU(1),v.ALo(2,"translate"),v.qZA()),2&e&&(v.xp6(1),v.Oqu(v.lcZ(2,1,"SHARED_LIB.PERUN.COMPONENTS.SERVICES_STATUS_LIST.ENDED")))}function Za(e,t){if(1&e&&(v.TgZ(0,"div"),v._uU(1),v.ALo(2,"date"),v.qZA()),2&e){var i=v.oxw().$implicit;v.xp6(1),v.Oqu(v.xi3(2,1,i.task.endTime,"d.M.y H:mm:ss"))}}function Ca(e,t){1&e&&(v.TgZ(0,"div"),v._uU(1),v.ALo(2,"translate"),v.qZA()),2&e&&(v.xp6(1),v.hij(" ",v.lcZ(2,1,"SHARED_LIB.PERUN.COMPONENTS.SERVICES_STATUS_LIST.NOT_YET")," "))}function _a(e,t){if(1&e&&(v.TgZ(0,"td",25),v.YNc(1,Za,3,4,"div",24),v.YNc(2,Ca,3,3,"div",24),v.qZA()),2&e){var i=t.$implicit;v.xp6(1),v.Q6J("ngIf",i.task&&i.task.endTime),v.xp6(1),v.Q6J("ngIf",!i.task||!i.task.endTime)}}function ka(e,t){1&e&&v._UZ(0,"tr",26)}var La=function(e,t){return["/facilities",e,"services-status",t]};function xa(e,t){if(1&e&&v._UZ(0,"tr",27),2&e){var i=t.$implicit,a=v.oxw();v.ekj("disable-outline",a.disableRouting||!i.task)("make-yellow","WARNING"===i.status)("make-green","DONE"===i.status)("make-red","GENERROR"===i.status||"SENDERROR"===i.status||"ERROR"===i.status)("cursor-pointer",!a.disableRouting&&null!==i.task),v.Q6J("routerLink",a.disableRouting||null===i.task?null:v.WLB(12,La,i.facility.id,i.taskId))("perunWebAppsMiddleClickRouterLink",a.disableRouting||null===i.task?null:v.WLB(15,La,i.facility.id,i.taskId))}}function Oa(e,t){1&e&&(v.TgZ(0,"app-alert",28),v._uU(1),v.ALo(2,"translate"),v.qZA()),2&e&&(v.xp6(1),v.hij(" ",v.lcZ(2,1,"SHARED_LIB.UI.ALERTS.NO_FILTER_RESULTS_ALERT"),"\n"))}function Ra(e,t){1&e&&(v.TgZ(0,"app-alert",28),v._uU(1),v.ALo(2,"translate"),v.qZA()),2&e&&(v.xp6(1),v.hij(" ",v.lcZ(2,1,"SHARED_LIB.PERUN.COMPONENTS.SERVICES_STATUS_LIST.NO_SERVICES_STATUS_WARNING"),"\n"))}var Da=function(){var e=function(){function e(t,i){s(this,e),this.authResolver=t,this.tableCheckbox=i,this.servicesStatus=[],this.displayedColumns=["select","task.id","service.name","status","blocked","task.startTime","task.endTime"],this.selection=new xe.Ov(!0,[]),this.disableRouting=!0,this.selectionChange=new v.vpe,this.pageSizeOptions=p.f7}return r(e,[{key:"matSort",set:function(e){this.sort=e,this.setDataSource()}},{key:"ngOnChanges",value:function(){this.authResolver.isPerunAdminOrObserver()||(this.displayedColumns=this.displayedColumns.filter(function(e){return"task.id"!==e})),this.dataSource=new lt.by(this.servicesStatus),this.setDataSource(),this.dataSource.filterPredicate=function(e,t){var i=t.trim().toLowerCase();return function e(t){var i="";return Object.values(t).forEach(function(t){"object"!=typeof t?i=i+" "+t:null!==t&&(i=i+" "+e(t))}),i.trim().toLowerCase()}(e).includes(i)},this.dataSource.filter=this.filterValue}},{key:"getDataForColumn",value:function(e,t){switch(t){case"task.id":return e.task?e.task.id.toString():e[t];case"service.name":return e.service.name;case"status":return e.status;case"blocked":return e.blockedOnFacility?"BLOCKED":e.blockedGlobally?"BLOCKED GLOBALLY":"ALLOWED";case"task.startTime":return e.task&&e.task.startTime?(0,o.p6)(e.task.startTime,"d.M.y H:mm:ss","en"):e[t];case"task.endTime":return e.task&&e.task.endTime?(0,o.p6)(e.task.endTime,"d.M.y H:mm:ss","en"):e[t];default:return e[t]}}},{key:"getSortDataForColumn",value:function(e,t){switch(t){case"task.id":return e.task?e.task.id.toString():e[t];case"service.name":return e.service.name;case"status":return e.status;case"blocked":return e.blockedOnFacility?"BLOCKED":e.blockedGlobally?"BLOCKED GLOBALLY":"ALLOWED";case"task.startTime":return e.task&&e.task.startTime?(0,o.p6)(e.task.startTime,"yyyy.MM.dd HH:mm:ss","en"):e[t];case"task.endTime":return e.task&&e.task.endTime?(0,o.p6)(e.task.endTime,"yyyy.MM.dd HH:mm:ss","en"):e[t];default:return e[t]}}},{key:"exportData",value:function(e){(0,p.O6)((0,p.Xn)(this.dataSource.filteredData,this.displayedColumns,this.getDataForColumn,this),e)}},{key:"setDataSource",value:function(){var e=this;this.dataSource&&(this.dataSource.filterPredicate=function(t,i){return(0,p.Sd)(t,i,e.displayedColumns,e.getDataForColumn,e)},this.dataSource.sortData=function(t,i){return(0,p.pR)(t,i,e.getSortDataForColumn,e)},this.dataSource.sort=this.sort,this.dataSource.paginator=this.child.paginator)}},{key:"isAllSelected",value:function(){return this.tableCheckbox.isAllSelected(this.selection.selected.length,this.filterValue,this.child.paginator.pageSize,this.child.paginator.hasNextPage(),this.dataSource)}},{key:"masterToggle",value:function(){this.tableCheckbox.masterToggle(this.isAllSelected(),this.selection,this.filterValue,this.dataSource,this.sort,this.child.paginator.pageSize,this.child.paginator.pageIndex,!1)}},{key:"checkboxLabel",value:function(e){return e?"".concat(this.selection.isSelected(e)?"deselect":"select"," row ").concat(e.service.id+1):(this.isAllSelected()?"select":"deselect")+" all"}},{key:"ngAfterViewInit",value:function(){this.dataSource.paginator=this.child.paginator}}]),e}();return e.\u0275fac=function(t){return new(t||e)(v.Y36(g.x4),v.Y36(g.UA))},e.\u0275cmp=v.Xpm({type:e,selectors:[["perun-web-apps-services-status-list"]],viewQuery:function(e,t){var i;(1&e&&(v.Gf(Ot.YE,7),v.Gf(p.l9,7)),2&e)&&(v.iGM(i=v.CRH())&&(t.matSort=i.first),v.iGM(i=v.CRH())&&(t.child=i.first))},inputs:{servicesStatus:"servicesStatus",displayedColumns:"displayedColumns",selection:"selection",filterValue:"filterValue",tableId:"tableId",disableRouting:"disableRouting"},outputs:{selectionChange:"selectionChange"},features:[v.TTD],decls:28,vars:9,consts:[[1,"card","mt-3",3,"hidden"],[3,"tableId","dataLength","pageSizeOptions","exportData"],["mat-table","","matSort","","matSortActive","service.name","matSortDirection","asc","matSortDisableClear","",1,"w-100",3,"dataSource"],["matColumnDef","select"],["mat-header-cell","","class","align-checkbox",4,"matHeaderCellDef"],["mat-cell","","class","static-column-size align-checkbox",4,"matCellDef"],["matColumnDef","task.id"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["mat-cell","","class","static-column-size",4,"matCellDef"],["matColumnDef","service.name"],["mat-cell","",4,"matCellDef"],["matColumnDef","status"],["matColumnDef","blocked"],["matColumnDef","task.startTime"],["matColumnDef","task.endTime"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","","class","dark-hover-list-item",3,"disable-outline","make-yellow","make-green","make-red","cursor-pointer","routerLink","perunWebAppsMiddleClickRouterLink",4,"matRowDef","matRowDefColumns"],["alert_type","warn",4,"ngIf"],["mat-header-cell","",1,"align-checkbox"],["color","primary",3,"checked","indeterminate","aria-label","change"],["mat-cell","",1,"static-column-size","align-checkbox"],["color","primary",3,"checked","aria-label","click","change"],["mat-header-cell","","mat-sort-header",""],["mat-cell","",1,"static-column-size"],[4,"ngIf"],["mat-cell",""],["mat-header-row",""],["mat-row","",1,"dark-hover-list-item",3,"routerLink","perunWebAppsMiddleClickRouterLink"],["alert_type","warn"]],template:function(e,t){1&e&&(v.TgZ(0,"div",0),v.TgZ(1,"perun-web-apps-table-wrapper",1),v.NdJ("exportData",function(e){return t.exportData(e)}),v.TgZ(2,"table",2),v.ynx(3,3),v.YNc(4,oa,2,3,"th",4),v.YNc(5,ca,2,2,"td",5),v.BQk(),v.ynx(6,6),v.YNc(7,ua,3,3,"th",7),v.YNc(8,fa,3,2,"td",8),v.BQk(),v.ynx(9,9),v.YNc(10,pa,3,3,"th",7),v.YNc(11,ga,2,1,"td",10),v.BQk(),v.ynx(12,11),v.YNc(13,ma,3,3,"th",7),v.YNc(14,Sa,2,1,"td",10),v.BQk(),v.ynx(15,12),v.YNc(16,va,3,3,"th",7),v.YNc(17,Aa,3,3,"td",10),v.BQk(),v.ynx(18,13),v.YNc(19,Ta,3,3,"th",7),v.YNc(20,ba,3,2,"td",10),v.BQk(),v.ynx(21,14),v.YNc(22,Ea,3,3,"th",7),v.YNc(23,_a,3,2,"td",10),v.BQk(),v.YNc(24,ka,1,0,"tr",15),v.YNc(25,xa,1,18,"tr",16),v.qZA(),v.qZA(),v.qZA(),v.YNc(26,Oa,3,3,"app-alert",17),v.YNc(27,Ra,3,3,"app-alert",17)),2&e&&(v.Q6J("hidden",0===t.dataSource.filteredData.length||0===t.servicesStatus.length),v.xp6(1),v.Q6J("tableId",t.tableId)("dataLength",t.dataSource.filteredData.length)("pageSizeOptions",t.pageSizeOptions),v.xp6(1),v.Q6J("dataSource",t.dataSource),v.xp6(22),v.Q6J("matHeaderRowDef",t.displayedColumns),v.xp6(1),v.Q6J("matRowDefColumns",t.displayedColumns),v.xp6(1),v.Q6J("ngIf",0===t.dataSource.filteredData.length&&0!==t.servicesStatus.length),v.xp6(1),v.Q6J("ngIf",0===t.servicesStatus.length))},directives:[Rt.l,lt.BZ,Ot.YE,lt.w1,lt.fO,lt.Dz,lt.as,lt.nj,o.O5,lt.ge,ue.oG,lt.ev,Ot.nU,lt.XQ,lt.Gk,c.rH,Dt.YH,Nt.w],pipes:[_.X$,ra,o.uU],styles:[".disable-outline[_ngcontent-%COMP%]{outline:none!important}.make-green[_ngcontent-%COMP%]{background-color:#c4ffcb}.make-yellow[_ngcontent-%COMP%]{background-color:#fffde7}.make-red[_ngcontent-%COMP%]{background-color:#ffcdd2}.cursor-pointer[_ngcontent-%COMP%]{cursor:pointer}"]}),e}();function Na(e,t){if(1&e){var i=v.EpF();v.TgZ(0,"button",11),v.NdJ("click",function(){return v.CHM(i),v.oxw().forcePropagation()}),v._uU(1),v.ALo(2,"translate"),v.qZA()}if(2&e){var a=v.oxw();v.Q6J("disabled",0===a.selected.selected.length),v.xp6(1),v.hij(" ",v.lcZ(2,2,"FACILITY_DETAIL.SERVICES_STATUS.FORCE_PROPAGATION")," ")}}function wa(e,t){if(1&e){var i=v.EpF();v.TgZ(0,"button",11),v.NdJ("click",function(){return v.CHM(i),v.oxw().allow()}),v._uU(1),v.ALo(2,"translate"),v.qZA()}if(2&e){var a=v.oxw();v.Q6J("disabled",0===a.selected.selected.length||a.disableAllowButton),v.xp6(1),v.hij(" ",v.lcZ(2,2,"FACILITY_DETAIL.SERVICES_STATUS.ALLOW")," ")}}function Ya(e,t){if(1&e){var i=v.EpF();v.TgZ(0,"button",12),v.NdJ("click",function(){return v.CHM(i),v.oxw().block()}),v._uU(1),v.ALo(2,"translate"),v.qZA()}if(2&e){var a=v.oxw();v.Q6J("disabled",0===a.selected.selected.length||a.disableBlockButton),v.xp6(1),v.hij(" ",v.lcZ(2,2,"FACILITY_DETAIL.SERVICES_STATUS.BLOCK")," ")}}function Fa(e,t){if(1&e&&(v.TgZ(0,"button",13),v.ALo(1,"translate"),v._uU(2),v.ALo(3,"translate"),v.qZA()),2&e){var i=v.oxw(),a=v.MAs(10);v.s9C("matTooltip",v.lcZ(1,5,"DIALOGS.REMOVE_SERVICE_FROM_FACILITY.CHECKBOXES_DISABLED")),v.Q6J("matTooltipDisabled",!i.disableRemoveButton)("disabled",i.disableRemoveButton)("matMenuTriggerFor",a),v.xp6(2),v.hij(" ",v.lcZ(3,7,"FACILITY_DETAIL.SERVICES_STATUS.REMOVE")," ")}}function Ma(e,t){if(1&e){var i=v.EpF();v.TgZ(0,"button",7),v.NdJ("click",function(){return v.CHM(i),v.oxw().removeTaskResults()}),v._uU(1),v.ALo(2,"translate"),v.qZA()}2&e&&(v.xp6(1),v.hij(" ",v.lcZ(2,1,"FACILITY_DETAIL.SERVICES_STATUS.REMOVE_TASK_RESULTS")," "))}function Ua(e,t){1&e&&v._UZ(0,"mat-spinner",14)}function qa(e,t){if(1&e){var i=v.EpF();v.TgZ(0,"perun-web-apps-services-status-list",15),v.NdJ("selectionChange",function(){return v.CHM(i),v.oxw().selectionChanged()}),v.qZA()}if(2&e){var a=v.oxw();v.Q6J("tableId",a.tableId)("filterValue",a.filterValue)("servicesStatus",a.servicesStates)("selection",a.selected)("disableRouting",!a.routeAuth)}}var Ja=function(){var e=function(){function e(t,i,a,n,l,r,o,c,u){var d=this;s(this,e),this.tasksManager=t,this.servicesManager=i,this.notificator=a,this.translate=n,this.authResolver=l,this.facilityManager=r,this.resourcesManager=o,this.dialog=c,this.entityStorageService=u,this.servicesStates=[],this.selected=new xe.Ov(!0,[]),this.filterValue="",this.tableId=Le.oK,this.disableAllowButton=!0,this.disableBlockButton=!0,this.disableRemoveButton=!0,n.get("FACILITY_DETAIL.SERVICES_STATUS.SUCCESS_FORCE_PROPAGATION").subscribe(function(e){return d.successFPMessage=e}),n.get("FACILITY_DETAIL.SERVICES_STATUS.SUCCESS_ALLOW").subscribe(function(e){return d.successAllowMessage=e}),n.get("FACILITY_DETAIL.SERVICES_STATUS.SUCCESS_BLOCK").subscribe(function(e){return d.successBlockMessage=e}),n.get("FACILITY_DETAIL.SERVICES_STATUS.SUCCESS_DELETE").subscribe(function(e){return d.successDeleteMessage=e}),n.get("FACILITY_DETAIL.SERVICES_STATUS.ALREADY_DELETED").subscribe(function(e){return d.allreadyDeletedMessage=e})}return r(e,[{key:"ngOnInit",value:function(){this.loading=!0,this.facility=this.entityStorageService.getEntity(),this.setAuthRights(),this.refreshTable()}},{key:"forcePropagation",value:function(){var e,t=this,a=i(this.selected.selected);try{for(a.s();!(e=a.n()).done;){var n=e.value;this.servicesManager.forceServicePropagation(n.service.id,n.facility.id).subscribe(function(){t.refreshTable(),t.notificator.showSuccess(t.successFPMessage)})}}catch(s){a.e(s)}finally{a.f()}}},{key:"allow",value:function(){var e,t=this,a=i(this.selected.selected);try{for(a.s();!(e=a.n()).done;){var n=e.value;this.servicesManager.unblockServiceOnFacility(n.service.id,n.facility.id).subscribe(function(){t.refreshTable(),t.notificator.showSuccess(t.successAllowMessage)})}}catch(s){a.e(s)}finally{a.f()}}},{key:"block",value:function(){var e,t=this,a=i(this.selected.selected);try{for(a.s();!(e=a.n()).done;){var n=e.value;this.servicesManager.blockServiceOnFacility(n.service.id,n.facility.id).subscribe(function(){t.refreshTable(),t.notificator.showSuccess(t.successBlockMessage)})}}catch(s){a.e(s)}finally{a.f()}}},{key:"removeTaskResults",value:function(){var e=this;this.tasksManager.getTaskResultsForGUIByTask(this.selected.selected[0].task.id).subscribe(function(t){var i=(0,p.kZ)();i.width="600px",i.data={theme:"facility-theme",taskResults:t},e.dialog.open(zi,i)})}},{key:"removeServiceFromFacility",value:function(){var e=this;this.facilityManager.getAssignedResourcesByAssignedServiceForFacility(this.selected.selected[0].facility.id,this.selected.selected[0].service.id).subscribe(function(t){var i=(0,p.kZ)();i.width="600px",e.taskId=e.taskIsNull?null:e.selected.selected[0].task.id,0===t.length?(i.data={theme:"facility-theme",taskId:e.taskId},e.dialog.open(sa,i).afterClosed().subscribe(function(t){t&&(e.disableRemoveButton=!0,e.refreshTable())})):e.resourcesManager.getRichResourcesByIds(t.map(function(e){return e.id})).subscribe(function(t){i.data={theme:"facility-theme",taskId:e.taskId,serviceId:e.selected.selected[0].service.id,facilityId:e.selected.selected[0].facility.id,resource:t},e.dialog.open(ia,i).afterClosed().subscribe(function(t){t&&(e.disableRemoveButton=!0,e.refreshTable())})})})}},{key:"refreshTable",value:function(){var e=this;this.loading=!0,this.tasksManager.getFacilityServicesState(this.facility.id).subscribe(function(t){e.servicesStates=t,e.selected.clear(),e.setAuthRights(),e.loading=!1})}},{key:"setAuthRights",value:function(){this.propagationAuth=this.authResolver.isAuthorized("forceServicePropagation_Facility_Service_policy",[this.facility]),this.blockAuth=this.authResolver.isAuthorized("blockServiceOnFacility_Service_Facility_policy",[this.facility]),this.allowAuth=this.authResolver.isAuthorized("unblockServiceOnFacility_Service_Facility_policy",[this.facility]),this.deleteAuth=this.authResolver.isAuthorized("deleteTask_Task_policy",[this.facility]),this.routeAuth=this.authResolver.isAuthorized("getTaskResultsByTask_int_policy",[this.facility])}},{key:"applyFilter",value:function(e){this.filterValue=e}},{key:"selectionChanged",value:function(){this.disableBlockButton=!0,this.disableAllowButton=!0,this.disableRemoveButton=1!==this.selected.selected.length,this.disableRemoveButton||(this.taskIsNull=null===this.selected.selected[0].task);var e,t=i(this.selected.selected);try{for(t.s();!(e=t.n()).done;){e.value.blockedOnFacility?this.disableAllowButton=!1:this.disableBlockButton=!1}}catch(a){t.e(a)}finally{t.f()}}}]),e}();return e.\u0275fac=function(t){return new(t||e)(v.Y36(f.Ob),v.Y36(f.KK),v.Y36(g.V6),v.Y36(_.sK),v.Y36(g.x4),v.Y36(f.IQ),v.Y36(f.xk),v.Y36(A.uw),v.Y36(g.fb))},e.\u0275cmp=v.Xpm({type:e,selectors:[["app-facility-service-status"]],decls:18,vars:14,consts:[[1,"page-subtitle"],[3,"refresh"],["mat-flat-button","","color","accent","class","mr-2",3,"disabled","click",4,"ngIf"],["mat-flat-button","","color","warn","class","mr-2",3,"disabled","click",4,"ngIf"],["mat-flat-button","","color","warn","class","mr-2 dropdown-toggle",3,"matTooltip","matTooltipDisabled","disabled","matMenuTriggerFor",4,"ngIf"],["menu","matMenu"],["mat-menu-item","",3,"click",4,"ngIf"],["mat-menu-item","",3,"click"],[3,"placeholder","filter"],["class","ml-auto mr-auto",4,"ngIf"],[3,"tableId","filterValue","servicesStatus","selection","disableRouting","selectionChange",4,"ngIf"],["mat-flat-button","","color","accent",1,"mr-2",3,"disabled","click"],["mat-flat-button","","color","warn",1,"mr-2",3,"disabled","click"],["mat-flat-button","","color","warn",1,"mr-2","dropdown-toggle",3,"matTooltip","matTooltipDisabled","disabled","matMenuTriggerFor"],[1,"ml-auto","mr-auto"],[3,"tableId","filterValue","servicesStatus","selection","disableRouting","selectionChange"]],template:function(e,t){1&e&&(v.TgZ(0,"div"),v.TgZ(1,"h1",0),v._uU(2),v.ALo(3,"translate"),v.qZA(),v.TgZ(4,"perun-web-apps-refresh-button",1),v.NdJ("refresh",function(){return t.refreshTable()}),v.qZA(),v.YNc(5,Na,3,4,"button",2),v.YNc(6,wa,3,4,"button",2),v.YNc(7,Ya,3,4,"button",3),v.YNc(8,Fa,4,9,"button",4),v.TgZ(9,"mat-menu",null,5),v.YNc(11,Ma,3,3,"button",6),v.TgZ(12,"button",7),v.NdJ("click",function(){return t.removeServiceFromFacility()}),v._uU(13),v.ALo(14,"translate"),v.qZA(),v.qZA(),v.TgZ(15,"perun-web-apps-immediate-filter",8),v.NdJ("filter",function(e){return t.applyFilter(e)}),v.qZA(),v.YNc(16,Ua,1,0,"mat-spinner",9),v.YNc(17,qa,1,5,"perun-web-apps-services-status-list",10),v.qZA()),2&e&&(v.xp6(2),v.Oqu(v.lcZ(3,10,"FACILITY_DETAIL.SERVICES_STATUS.TITLE")),v.xp6(3),v.Q6J("ngIf",t.propagationAuth),v.xp6(1),v.Q6J("ngIf",t.allowAuth),v.xp6(1),v.Q6J("ngIf",t.blockAuth),v.xp6(1),v.Q6J("ngIf",t.deleteAuth),v.xp6(3),v.Q6J("ngIf",!t.taskIsNull),v.xp6(2),v.Oqu(v.lcZ(14,12,"FACILITY_DETAIL.SERVICES_STATUS.REMOVE_SERVICE_FROM_FACILITY")),v.xp6(2),v.Q6J("placeholder","SHARED_LIB.PERUN.COMPONENTS.SERVICES_STATUS_LIST.TABLE_SEARCH"),v.xp6(1),v.Q6J("ngIf",t.loading),v.xp6(1),v.Q6J("ngIf",!t.loading))},directives:[Be.t,o.O5,la.VK,la.OP,Ge.L,C.lW,E.gM,la.p6,y.$g,Da],pipes:[_.X$],styles:[""]}),e}(),Qa=l(67004),Va=l(91058),Ha=l(27521),Pa=l(19386),Ba=l(42847),Ga=l(44973),$a=function(){var e=function e(){s(this,e),this.service=null,this.serviceSelected=new v.vpe,this.nameFunction=function(e){return e.name},this.secondaryFunction=function(){return null},this.searchFunction=function(e){return e.name}};return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=v.Xpm({type:e,selectors:[["perun-web-apps-service-search-select"]],inputs:{service:"service",services:"services"},outputs:{serviceSelected:"serviceSelected"},decls:4,vars:14,consts:[[3,"entity","entities","searchFunction","mainTextFunction","secondaryTextFunction","selectPlaceholder","findPlaceholder","noEntriesText","entitySelected"]],template:function(e,t){1&e&&(v.TgZ(0,"perun-web-apps-entity-search-select",0),v.NdJ("entitySelected",function(e){return t.serviceSelected.emit(e)}),v.ALo(1,"translate"),v.ALo(2,"translate"),v.ALo(3,"translate"),v.qZA()),2&e&&v.Q6J("entity",t.service)("entities",t.services)("searchFunction",t.searchFunction)("mainTextFunction",t.nameFunction)("secondaryTextFunction",t.secondaryFunction)("selectPlaceholder",v.lcZ(1,8,"SHARED_LIB.PERUN.COMPONENTS.SERVICE_SEARCH_SELECT.SELECT_SERVICE"))("findPlaceholder",v.lcZ(2,10,"SHARED_LIB.PERUN.COMPONENTS.SERVICE_SEARCH_SELECT.FIND_SERVICE"))("noEntriesText",v.lcZ(3,12,"SHARED_LIB.PERUN.COMPONENTS.SERVICE_SEARCH_SELECT.NO_SERVICE_FOUND"))},directives:[Ga.i],pipes:[_.X$],styles:[""]}),e}(),za=l(16247);function ja(e,t){1&e&&v._UZ(0,"mat-spinner",12)}var Ka=function(){return["id","name","email","logins","organization"]};function Wa(e,t){if(1&e&&v._UZ(0,"perun-web-apps-users-dynamic-list",13),2&e){var i=v.oxw();v.Q6J("tableId",i.tableId)("searchString",i.filterValue)("displayedColumns",v.DdM(10,Ka))("attrNames",i.attributes)("facilityId",i.facility.id)("voId",-1===i.selectedVo.id?null:i.selectedVo.id)("resourceId",-1===i.selectedResource.id?null:i.selectedResource.id)("serviceId",-1===i.selectedService.id?null:i.selectedService.id)("onlyAllowed",i.allowed)("disableRouting",!i.routeAuth)}}var Xa=function(){var e=function(){function e(t,i,a,n,l,r){s(this,e),this.facilityService=t,this.serviceService=i,this.resourceService=a,this.authResolver=n,this.storeService=l,this.entityStorageService=r,this.loading=!1,this.filterValue="",this.attributes=[],this.allowed=!0,this.emptyResource={id:-1,beanName:"Resource",name:"No filter"},this.resources=[this.emptyResource],this.filteredResources=[this.emptyResource],this.selectedResource=this.emptyResource,this.emptyVo={id:-1,beanName:"Vo",name:"No filter"},this.vos=[this.emptyVo],this.selectedVo=this.emptyVo,this.emptyService={id:-1,beanName:"Service",name:"No filter"},this.services=[this.emptyService],this.filteredServices=[this.emptyService],this.selectedService=this.emptyService,this.resourceAssignedServices=new Map,this.tableId=Le.z6,this.toggle_messages=["FACILITY_DETAIL.ALLOWED_USERS.FILTER_ASSIGNED_MSG","FACILITY_DETAIL.ALLOWED_USERS.FILTER_ALLOWED_MSG"]}return r(e,[{key:"ngOnInit",value:function(){this.loading=!0,this.attributes=[Qa.r.USER_DEF_ORGANIZATION,Qa.r.USER_DEF_PREFERRED_MAIL],this.attributes=this.attributes.concat(this.storeService.getLoginAttributeNames()),this.facility=this.entityStorageService.getEntity(),this.routeAuth=this.authResolver.isPerunAdminOrObserver(),this.refreshPage()}},{key:"refreshPage",value:function(){var e=this;this.loading=!0,this.facilityService.getAssignedResourcesForFacility(this.facility.id).subscribe(function(t){e.resources=[e.emptyResource].concat(t),e.filteredResources=e.resources,e.selectedResource=e.emptyResource,e.facilityService.getAllowedVos(e.facility.id).subscribe(function(t){e.vos=[e.emptyVo].concat(t),e.selectedVo=e.emptyVo,e.services=[],e.getAssignedServices(e.resources,e.resources.length-1)},function(){return e.loading=!1})},function(){return e.loading=!1})}},{key:"getAssignedServices",value:function(e,t){var i=this;if(0===t)return this.services=[this.emptyService].concat(this.services),this.filteredServices=this.services,this.selectedService=this.emptyService,void(this.loading=!1);this.resourceService.getAssignedServicesToResource(e[t].id).subscribe(function(a){i.services=i.services.concat(a),i.resourceAssignedServices[e[t].id]=a.map(function(e){return e.id}),i.getAssignedServices(e,t-1)},function(){return i.loading=!1})}},{key:"getFilteredServices",value:function(e){var t=this,i=new Set;return e.forEach(function(e){t.resourceAssignedServices[e.id].forEach(function(e){return i.add(e)})}),[this.emptyService].concat(this.services.filter(function(e){return i.has(e.id)}))}},{key:"applyFilter",value:function(e){this.filterValue=e}},{key:"voSelected",value:function(e){this.selectedVo.id!==e.id&&(this.selectedVo=e,this.selectedResource=this.emptyResource,this.selectedService=this.emptyService,-1===e.id?(this.filteredResources=this.resources,this.filteredServices=this.services):(this.filteredResources=this.resources.filter(function(t){return t.voId===e.id}),this.filteredServices=this.getFilteredServices(this.filteredResources),this.filteredResources=[this.emptyResource].concat(this.filteredResources)))}},{key:"resourceSelected",value:function(e){this.selectedResource.id!==e.id&&(this.selectedResource=e,this.selectedService=this.emptyService,this.filteredServices=-1===e.id?this.services:this.getFilteredServices([e]))}},{key:"serviceSelected",value:function(e){this.selectedService=e}}]),e}();return e.\u0275fac=function(t){return new(t||e)(v.Y36(f.IQ),v.Y36(f.KK),v.Y36(f.xk),v.Y36(g.x4),v.Y36(g.d6),v.Y36(g.fb))},e.\u0275cmp=v.Xpm({type:e,selectors:[["app-facility-allowed-users"]],decls:20,vars:20,consts:[[1,"page-subtitle"],[1,"filters"],[1,"mr-2",3,"refresh"],[1,"mr-2","filter",3,"placeholder","filter"],[1,"toggle"],["labelPosition","before",1,"mr-2",3,"ngModel","ngModelChange"],[1,"text-muted"],[1,"search-select",3,"vo","vos","voSelected"],[1,"search-select",3,"displayStatus","resource","resources","resourceSelected"],[1,"search-select",3,"service","services","serviceSelected"],["class","ml-auto mr-auto",4,"ngIf"],[3,"tableId","searchString","displayedColumns","attrNames","facilityId","voId","resourceId","serviceId","onlyAllowed","disableRouting",4,"ngIf"],[1,"ml-auto","mr-auto"],[3,"tableId","searchString","displayedColumns","attrNames","facilityId","voId","resourceId","serviceId","onlyAllowed","disableRouting"]],template:function(e,t){1&e&&(v.TgZ(0,"div"),v.TgZ(1,"h1",0),v._uU(2),v.ALo(3,"translate"),v.qZA(),v.TgZ(4,"div",1),v.TgZ(5,"perun-web-apps-refresh-button",2),v.NdJ("refresh",function(){return t.refreshPage()}),v.qZA(),v.TgZ(6,"perun-web-apps-debounce-filter",3),v.NdJ("filter",function(e){return t.applyFilter(e)}),v.qZA(),v.TgZ(7,"div",4),v.TgZ(8,"mat-slide-toggle",5),v.NdJ("ngModelChange",function(e){return t.allowed=e}),v._uU(9),v.ALo(10,"translate"),v.qZA(),v.TgZ(11,"span",6),v._uU(12),v.ALo(13,"translate"),v.qZA(),v.qZA(),v.qZA(),v.TgZ(14,"div",1),v.TgZ(15,"perun-web-apps-vo-search-select",7),v.NdJ("voSelected",function(e){return t.voSelected(e)}),v.qZA(),v.TgZ(16,"perun-web-apps-resource-search-select",8),v.NdJ("resourceSelected",function(e){return t.resourceSelected(e)}),v.qZA(),v.TgZ(17,"perun-web-apps-service-search-select",9),v.NdJ("serviceSelected",function(e){return t.serviceSelected(e)}),v.qZA(),v.qZA(),v.YNc(18,ja,1,0,"mat-spinner",10),v.YNc(19,Wa,1,11,"perun-web-apps-users-dynamic-list",11),v.qZA()),2&e&&(v.xp6(2),v.Oqu(v.lcZ(3,14,"FACILITY_DETAIL.ALLOWED_USERS.TITLE")),v.xp6(4),v.Q6J("placeholder","FACILITY_DETAIL.ALLOWED_USERS.FILTER"),v.xp6(2),v.Q6J("ngModel",t.allowed),v.xp6(1),v.hij(" ",v.lcZ(10,16,"FACILITY_DETAIL.ALLOWED_USERS.FILTER_ALLOWED")," "),v.xp6(3),v.Oqu(v.lcZ(13,18,t.toggle_messages[t.allowed?1:0])),v.xp6(3),v.Q6J("vo",t.selectedVo)("vos",t.vos),v.xp6(1),v.Q6J("displayStatus",!1)("resource",t.selectedResource)("resources",t.filteredResources),v.xp6(1),v.Q6J("service",t.selectedService)("services",t.filteredServices),v.xp6(1),v.Q6J("ngIf",t.loading),v.xp6(1),v.Q6J("ngIf",!t.loading))},directives:[Be.t,Va.P,Ha.Rr,le.JJ,le.On,Pa.M,Ba.L,$a,o.O5,y.$g,za.M],pipes:[_.X$],styles:[".filters[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;align-items:baseline}.filter[_ngcontent-%COMP%]{min-width:350px}.search-select[_ngcontent-%COMP%]{width:32%;margin-right:20px;margin-top:30px}.toggle[_ngcontent-%COMP%]{display:flex;flex-direction:column}"]}),e}(),en=l(95142);function tn(e,t){if(1&e){var i=v.EpF();v.TgZ(0,"th",20),v.TgZ(1,"mat-checkbox",21),v.NdJ("change",function(e){v.CHM(i);var t=v.oxw();return e?t.masterToggle():null}),v.qZA(),v.qZA()}if(2&e){var a=v.oxw();v.xp6(1),v.Q6J("aria-label",a.checkboxLabel())("checked",a.selection.hasValue()&&a.isAllSelected())("indeterminate",a.selection.hasValue()&&!a.isAllSelected())}}function an(e,t){if(1&e){var i=v.EpF();v.TgZ(0,"td",22),v.TgZ(1,"mat-checkbox",23),v.NdJ("change",function(e){var t=v.CHM(i).$implicit,a=v.oxw();return e?a.selection.toggle(t):null})("click",function(e){return e.stopPropagation()}),v.qZA(),v.qZA()}if(2&e){var a=t.$implicit,n=v.oxw();v.xp6(1),v.Q6J("aria-label",n.checkboxLabel(a))("checked",n.selection.isSelected(a))}}function nn(e,t){1&e&&(v.TgZ(0,"th",24),v._uU(1),v.ALo(2,"translate"),v.qZA()),2&e&&(v.xp6(1),v.Oqu(v.lcZ(2,1,"SHARED_LIB.PERUN.COMPONENTS.TASK_RESULTS_LIST.RESULT_ID")))}function sn(e,t){if(1&e&&(v.TgZ(0,"td",25),v._uU(1),v.qZA()),2&e){var i=t.$implicit;v.xp6(1),v.Oqu(i.id)}}function ln(e,t){1&e&&(v.TgZ(0,"th",24),v._uU(1),v.ALo(2,"translate"),v.qZA()),2&e&&(v.xp6(1),v.Oqu(v.lcZ(2,1,"SHARED_LIB.PERUN.COMPONENTS.TASK_RESULTS_LIST.DESTINATION")))}function rn(e,t){if(1&e&&(v.TgZ(0,"td",25),v._uU(1),v.qZA()),2&e){var i=t.$implicit;v.xp6(1),v.Oqu(i.destination.destination)}}function on(e,t){1&e&&(v.TgZ(0,"th",24),v._uU(1),v.ALo(2,"translate"),v.qZA()),2&e&&(v.xp6(1),v.Oqu(v.lcZ(2,1,"SHARED_LIB.PERUN.COMPONENTS.TASK_RESULTS_LIST.TYPE")))}function cn(e,t){if(1&e&&(v.TgZ(0,"td",25),v._uU(1),v.qZA()),2&e){var i=t.$implicit;v.xp6(1),v.Oqu(i.destination.type.toUpperCase())}}function un(e,t){1&e&&(v.TgZ(0,"th",24),v._uU(1),v.ALo(2,"translate"),v.qZA()),2&e&&(v.xp6(1),v.Oqu(v.lcZ(2,1,"SHARED_LIB.PERUN.COMPONENTS.TASK_RESULTS_LIST.SERVICE")))}function dn(e,t){if(1&e&&(v.TgZ(0,"td",25),v._uU(1),v.qZA()),2&e){var i=t.$implicit;v.xp6(1),v.Oqu(i.service.name)}}function hn(e,t){1&e&&(v.TgZ(0,"th",24),v._uU(1),v.ALo(2,"translate"),v.qZA()),2&e&&(v.xp6(1),v.Oqu(v.lcZ(2,1,"SHARED_LIB.PERUN.COMPONENTS.TASK_RESULTS_LIST.STATUS")))}function fn(e,t){if(1&e&&(v.TgZ(0,"td",25),v._uU(1),v.qZA()),2&e){var i=t.$implicit;v.xp6(1),v.Oqu(i.status)}}function pn(e,t){1&e&&(v.TgZ(0,"th",24),v._uU(1),v.ALo(2,"translate"),v.qZA()),2&e&&(v.xp6(1),v.Oqu(v.lcZ(2,1,"SHARED_LIB.PERUN.COMPONENTS.TASK_RESULTS_LIST.TIME")))}function gn(e,t){if(1&e&&(v.TgZ(0,"td",25),v._uU(1),v.ALo(2,"date"),v.qZA()),2&e){var i=t.$implicit;v.xp6(1),v.Oqu(v.xi3(2,1,i.timestamp,"d.M.y H:mm:ss"))}}function mn(e,t){1&e&&(v.TgZ(0,"th",24),v._uU(1),v.ALo(2,"translate"),v.qZA()),2&e&&(v.xp6(1),v.Oqu(v.lcZ(2,1,"SHARED_LIB.PERUN.COMPONENTS.TASK_RESULTS_LIST.RETURN_CODE")))}function Sn(e,t){if(1&e&&(v.TgZ(0,"td",25),v._uU(1),v.qZA()),2&e){var i=t.$implicit;v.xp6(1),v.Oqu(i.returnCode)}}function vn(e,t){1&e&&(v.TgZ(0,"th",24),v._uU(1),v.ALo(2,"translate"),v.qZA()),2&e&&(v.xp6(1),v.Oqu(v.lcZ(2,1,"SHARED_LIB.PERUN.COMPONENTS.TASK_RESULTS_LIST.STANDARD_MESSAGE")))}function An(e,t){if(1&e&&(v.TgZ(0,"span"),v._uU(1),v._UZ(2,"br"),v.qZA()),2&e){var i=t.$implicit;v.xp6(1),v.Oqu(i)}}function Tn(e,t){if(1&e&&(v.TgZ(0,"td",25),v.YNc(1,An,3,1,"span",26),v.qZA()),2&e){var i=t.$implicit;v.xp6(1),v.Q6J("ngForOf",i.standardMessage.split("\n"))}}function In(e,t){1&e&&(v.TgZ(0,"th",24),v._uU(1),v.ALo(2,"translate"),v.qZA()),2&e&&(v.xp6(1),v.Oqu(v.lcZ(2,1,"SHARED_LIB.PERUN.COMPONENTS.TASK_RESULTS_LIST.ERROR_MESSAGE")))}function yn(e,t){if(1&e&&(v.TgZ(0,"td",25),v._uU(1),v.qZA()),2&e){var i=t.$implicit;v.xp6(1),v.Oqu(i.errorMessage)}}function bn(e,t){1&e&&v._UZ(0,"tr",27)}function En(e,t){if(1&e&&v._UZ(0,"tr",28),2&e){var i=t.$implicit;v.ekj("greenTableItem","DONE"===i.status)("redTableItem","ERROR"===i.status||"DENIED"===i.status)("yellowTableItem","WARNING"===i.status)}}function Zn(e,t){1&e&&(v.TgZ(0,"app-alert",29),v._uU(1),v.ALo(2,"translate"),v.qZA()),2&e&&(v.xp6(1),v.hij(" ",v.lcZ(2,1,"SHARED_LIB.UI.ALERTS.NO_FILTER_RESULTS_ALERT"),"\n"))}function Cn(e,t){1&e&&(v.TgZ(0,"app-alert",29),v._uU(1),v.ALo(2,"translate"),v.qZA()),2&e&&(v.xp6(1),v.hij(" ",v.lcZ(2,1,"SHARED_LIB.PERUN.COMPONENTS.TASK_RESULTS_LIST.NO_RESULTS_WARNING"),"\n"))}var _n=function(){var e=function(){function e(t,i){s(this,e),this.authResolver=t,this.tableCheckbox=i,this.pageSizeOptions=p.f7,this.taskResults=[],this.selection=new xe.Ov(!0,[]),this.displayedColumns=["select","id","destination","type","service","status","time","returnCode","standardMessage","errorMessage"]}return r(e,[{key:"matSort",set:function(e){this.sort=e,this.setDataSource()}},{key:"ngOnChanges",value:function(){this.authResolver.isPerunAdminOrObserver()||(this.displayedColumns=this.displayedColumns.filter(function(e){return"id"!==e})),this.dataSource=new lt.by(this.taskResults),this.setDataSource(),this.dataSource.filter=this.filterValue}},{key:"getDataForColumn",value:function(e,t){switch(t){case"id":return e.id.toString();case"destination":return e.destination.destination;case"type":return e.destination.type;case"service":return e.service.name;case"status":return e.status;case"time":return(0,o.p6)(e.timestamp.toString(),"d.M.y H:mm:ss","en");case"returnCode":return e.returnCode.toString();case"standardMessage":return e.standardMessage;case"errorMessage":return e.errorMessage;default:return""}}},{key:"getSortDataForColumn",value:function(e,t){switch(t){case"id":return e.id.toString();case"destination":return e.destination.destination;case"type":return e.destination.type;case"service":return e.service.name;case"status":return e.status;case"time":return(0,o.p6)(e.timestamp.toString(),"yyyy.MM.dd HH:mm:ss","en");case"returnCode":return e.returnCode.toString();case"standardMessage":return e.standardMessage;case"errorMessage":return e.errorMessage;default:return""}}},{key:"exportData",value:function(e){(0,p.O6)((0,p.Xn)(this.dataSource.filteredData,this.displayedColumns,this.getDataForColumn,this),e)}},{key:"setDataSource",value:function(){var e=this;this.dataSource&&(this.dataSource.sort=this.sort,this.dataSource.paginator=this.child.paginator,this.dataSource.filter=this.filterValue,this.dataSource.filterPredicate=function(t,i){return(0,p.Sd)(t,i,e.displayedColumns,e.getDataForColumn,e)},this.dataSource.sortData=function(t,i){return(0,p.pR)(t,i,e.getSortDataForColumn,e)})}},{key:"isAllSelected",value:function(){return this.tableCheckbox.isAllSelected(this.selection.selected.length,this.filterValue,this.child.paginator.pageSize,this.child.paginator.hasNextPage(),this.dataSource)}},{key:"masterToggle",value:function(){this.tableCheckbox.masterToggle(this.isAllSelected(),this.selection,this.filterValue,this.dataSource,this.sort,this.child.paginator.pageSize,this.child.paginator.pageIndex,!1)}},{key:"checkboxLabel",value:function(e){return e?"".concat(this.selection.isSelected(e)?"deselect":"select"," row ").concat(e.id+1):(this.isAllSelected()?"select":"deselect")+" all"}},{key:"ngAfterViewInit",value:function(){this.dataSource.paginator=this.child.paginator}}]),e}();return e.\u0275fac=function(t){return new(t||e)(v.Y36(g.x4),v.Y36(g.UA))},e.\u0275cmp=v.Xpm({type:e,selectors:[["perun-web-apps-task-results-list"]],viewQuery:function(e,t){var i;(1&e&&(v.Gf(Ot.YE,7),v.Gf(p.l9,7)),2&e)&&(v.iGM(i=v.CRH())&&(t.matSort=i.first),v.iGM(i=v.CRH())&&(t.child=i.first))},inputs:{taskResults:"taskResults",selection:"selection",filterValue:"filterValue",tableId:"tableId",displayedColumns:"displayedColumns"},features:[v.TTD],decls:37,vars:9,consts:[[1,"card","mt-3",3,"hidden"],[3,"tableId","dataLength","pageSizeOptions","exportData"],["mat-table","","matSort","","matSortActive","time","matSortDirection","desc","matSortDisableClear","",1,"w-100",3,"dataSource"],["matColumnDef","select"],["mat-header-cell","","class","align-checkbox",4,"matHeaderCellDef"],["class","static-column-size align-checkbox","mat-cell","",4,"matCellDef"],["matColumnDef","id"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["class","static-column-size","mat-cell","",4,"matCellDef"],["matColumnDef","destination"],["matColumnDef","type"],["matColumnDef","service"],["matColumnDef","status"],["matColumnDef","time"],["matColumnDef","returnCode"],["matColumnDef","standardMessage"],["matColumnDef","errorMessage"],["mat-header-row","",4,"matHeaderRowDef"],["class","dark-hover-list-item","mat-row","",3,"greenTableItem","redTableItem","yellowTableItem",4,"matRowDef","matRowDefColumns"],["alert_type","warn",4,"ngIf"],["mat-header-cell","",1,"align-checkbox"],["color","primary",3,"aria-label","checked","indeterminate","change"],["mat-cell","",1,"static-column-size","align-checkbox"],["color","primary",3,"aria-label","checked","change","click"],["mat-header-cell","","mat-sort-header",""],["mat-cell","",1,"static-column-size"],[4,"ngFor","ngForOf"],["mat-header-row",""],["mat-row","",1,"dark-hover-list-item"],["alert_type","warn"]],template:function(e,t){1&e&&(v.TgZ(0,"div",0),v.TgZ(1,"perun-web-apps-table-wrapper",1),v.NdJ("exportData",function(e){return t.exportData(e)}),v.TgZ(2,"table",2),v.ynx(3,3),v.YNc(4,tn,2,3,"th",4),v.YNc(5,an,2,2,"td",5),v.BQk(),v.ynx(6,6),v.YNc(7,nn,3,3,"th",7),v.YNc(8,sn,2,1,"td",8),v.BQk(),v.ynx(9,9),v.YNc(10,ln,3,3,"th",7),v.YNc(11,rn,2,1,"td",8),v.BQk(),v.ynx(12,10),v.YNc(13,on,3,3,"th",7),v.YNc(14,cn,2,1,"td",8),v.BQk(),v.ynx(15,11),v.YNc(16,un,3,3,"th",7),v.YNc(17,dn,2,1,"td",8),v.BQk(),v.ynx(18,12),v.YNc(19,hn,3,3,"th",7),v.YNc(20,fn,2,1,"td",8),v.BQk(),v.ynx(21,13),v.YNc(22,pn,3,3,"th",7),v.YNc(23,gn,3,4,"td",8),v.BQk(),v.ynx(24,14),v.YNc(25,mn,3,3,"th",7),v.YNc(26,Sn,2,1,"td",8),v.BQk(),v.ynx(27,15),v.YNc(28,vn,3,3,"th",7),v.YNc(29,Tn,2,1,"td",8),v.BQk(),v.ynx(30,16),v.YNc(31,In,3,3,"th",7),v.YNc(32,yn,2,1,"td",8),v.BQk(),v.YNc(33,bn,1,0,"tr",17),v.YNc(34,En,1,6,"tr",18),v.qZA(),v.qZA(),v.qZA(),v.YNc(35,Zn,3,3,"app-alert",19),v.YNc(36,Cn,3,3,"app-alert",19)),2&e&&(v.Q6J("hidden",0===t.dataSource.filteredData.length||0===t.taskResults.length),v.xp6(1),v.Q6J("tableId",t.tableId)("dataLength",t.dataSource.filteredData.length)("pageSizeOptions",t.pageSizeOptions),v.xp6(1),v.Q6J("dataSource",t.dataSource),v.xp6(31),v.Q6J("matHeaderRowDef",t.displayedColumns),v.xp6(1),v.Q6J("matRowDefColumns",t.displayedColumns),v.xp6(1),v.Q6J("ngIf",0===t.dataSource.filteredData.length&&0!==t.taskResults.length),v.xp6(1),v.Q6J("ngIf",0===t.taskResults.length))},directives:[Rt.l,lt.BZ,Ot.YE,lt.w1,lt.fO,lt.Dz,lt.as,lt.nj,o.O5,lt.ge,ue.oG,lt.ev,Ot.nU,o.sg,lt.XQ,lt.Gk,Nt.w],pipes:[_.X$,o.uU],styles:[".greenTableItem[_ngcontent-%COMP%]{background-color:#c4ffcb}.yellowTableItem[_ngcontent-%COMP%]{background-color:#fffde7}.redTableItem[_ngcontent-%COMP%]{background-color:#ffcdd2}"]}),e}();function kn(e,t){if(1&e){var i=v.EpF();v.TgZ(0,"button",7),v.NdJ("click",function(){return v.CHM(i),v.oxw().removeTaskResult()}),v._uU(1),v.ALo(2,"translate"),v.qZA()}if(2&e){var a=v.oxw();v.Q6J("disabled",0===a.selection.selected.length),v.xp6(1),v.hij(" ",v.lcZ(2,2,"FACILITY_DETAIL.TASK_RESULTS.REMOVE"),"\n")}}function Ln(e,t){1&e&&v._UZ(0,"mat-spinner",8)}function xn(e,t){if(1&e&&v._UZ(0,"perun-web-apps-task-results-list",9),2&e){var i=v.oxw();v.Q6J("tableId",i.tableId)("displayedColumns",i.displayedColumns)("filterValue",i.filterValue)("selection",i.selection)("taskResults",i.taskResults)}}var On,Rn=function(){var e=function(){function e(t,i,a,n,l){s(this,e),this.route=t,this.taskManager=i,this.authResolver=a,this.dialog=n,this.entityStorageService=l,this.loading=!1,this.filterValue="",this.selection=new xe.Ov(!0,[]),this.tableId=Le.e5,this.displayedColumns=["select","id","destination","type","service","status","time","returnCode","standardMessage","errorMessage"],this.removeAuth=!1}return r(e,[{key:"ngOnInit",value:function(){var e=this;this.loading=!0,this.facility=this.entityStorageService.getEntity(),this.removeAuth=this.authResolver.isAuthorized("deleteTask_Task_policy",[this.facility]),this.removeAuth||(this.displayedColumns=["id","destination","type","service","status","time","returnCode","standardMessage","errorMessage"]),this.route.params.subscribe(function(t){e.taskId=t.taskId,e.taskManager.getTaskById(e.taskId).subscribe(function(t){e.task=t,e.refreshTable()})})}},{key:"refreshTable",value:function(){var e=this;this.loading=!0,this.taskManager.getTaskResultsForGUIByTask(this.taskId).subscribe(function(t){e.selection.clear(),e.taskResults=t,e.loading=!1})}},{key:"removeTaskResult",value:function(){var e=this,t=(0,p.kZ)();t.width="600px",t.data={theme:"facility-theme",taskResults:this.selection.selected},this.dialog.open(zi,t).afterClosed().subscribe(function(t){t&&e.refreshTable()})}},{key:"applyFilter",value:function(e){this.filterValue=e}}]),e}();return e.\u0275fac=function(t){return new(t||e)(v.Y36(c.gz),v.Y36(f.Ob),v.Y36(g.x4),v.Y36(A.uw),v.Y36(g.fb))},e.\u0275cmp=v.Xpm({type:e,selectors:[["app-facility-task-results"]],decls:10,vars:9,consts:[[1,"page-subtitle"],[1,"text-muted"],[3,"refresh"],["class","mr-2","color","warn","mat-flat-button","",3,"disabled","click",4,"ngIf"],[3,"placeholder","filter"],["class","ml-auto mr-auto",4,"ngIf"],[3,"tableId","displayedColumns","filterValue","selection","taskResults",4,"ngIf"],["color","warn","mat-flat-button","",1,"mr-2",3,"disabled","click"],[1,"ml-auto","mr-auto"],[3,"tableId","displayedColumns","filterValue","selection","taskResults"]],template:function(e,t){1&e&&(v.TgZ(0,"h1",0),v._uU(1),v.ALo(2,"translate"),v.TgZ(3,"span",1),v._uU(4),v.qZA(),v.qZA(),v.TgZ(5,"perun-web-apps-refresh-button",2),v.NdJ("refresh",function(){return t.refreshTable()}),v.qZA(),v.YNc(6,kn,3,4,"button",3),v.TgZ(7,"perun-web-apps-immediate-filter",4),v.NdJ("filter",function(e){return t.applyFilter(e)}),v.qZA(),v.YNc(8,Ln,1,0,"mat-spinner",5),v.YNc(9,xn,1,5,"perun-web-apps-task-results-list",6)),2&e&&(v.xp6(1),v.AsE("",v.lcZ(2,7,"FACILITY_DETAIL.TASK_RESULTS.TITLE")," - ",t.task.service.name," "),v.xp6(3),v.hij(" \xa0#",t.task.id," "),v.xp6(2),v.Q6J("ngIf",t.removeAuth),v.xp6(1),v.Q6J("placeholder","FACILITY_DETAIL.TASK_RESULTS.FILTER"),v.xp6(1),v.Q6J("ngIf",t.loading),v.xp6(1),v.Q6J("ngIf",!t.loading))},directives:[Be.t,o.O5,Ge.L,C.lW,y.$g,_n],pipes:[_.X$],styles:[""]}),e}(),Dn=l(53134),Nn=[{path:"",component:u.P},{path:":facilityId",component:N,children:[{path:"",component:M,data:{animation:"FacilityOverviewPage"}},{path:"attributes",component:te,data:{animation:"FacilityAttributesPage"}},{path:"resources",component:U.f,data:{animation:"FacilityResourcesPage"}},{path:"allowed-users",component:Xa,data:{animation:"FacilityAllowedUsersPage"}},{path:"allowed-groups",component:q.o,data:{animation:"FacilityAllowedGroupsPage"}},{path:"services-status",component:Ja,data:{animation:"FacilityServiceStatusPage"}},{path:"services-status/:taskId",component:Rn,data:{animation:"FacilityTaskResultsPage"}},{path:"service-config",component:Ce,data:{animation:"FacilityServiceConfigPage"}},{path:"services-destinations",component:tt,data:{animation:"FacilityServicesDestinationsPage"}},{path:"hosts",component:Kt,data:{animation:"FacilityHostsPage"}},{path:"hosts/:hostId",component:Ti,data:{animation:"FacilityHostsDetailPage"}},{path:"settings",component:V,children:[{path:"",component:B,data:{animation:"FacilitySettingsOverviewPage"}},{path:"owners",component:vt,data:{animation:"FacilitySettingOwnersPage"}},{path:"managers",component:ke,data:{animation:"FacilitySettingsManagersPage"}},{path:"security-teams",component:Yi,data:{animation:"FacilitySecurityTeamsPage"}},{path:"blacklist",component:fi,data:{animation:"FacilitySettingsBlackListPage"}}]}]},{path:":facilityId/resources/:resourceId",component:J.b,children:[{path:"",component:Q.H,data:{animation:"ResourceOverviewPage"}},{path:"attributes",component:ne.X,data:{animation:"ResourceAttributesPage"}},{path:"groups",component:se.K,data:{animation:"ResourceGroupsComponent"}},{path:"services",component:Mi.D,data:{animation:"ResourceAssignedServicesComponent"}},{path:"members",component:en.y,data:{animation:"ResourceAssignedMembersComponent"}},{path:"tags",component:Dn.v,data:{animation:"ResourceTagsComponent"}},{path:"settings",component:ie.t,children:[{path:"",component:ae.h,data:{animation:"ResourceSettingsOverviewPage"}},{path:"managers",component:Fi.O,data:{animation:"ResourceSettingsManagersPage"}}]}]}],wn=function(){var e=function e(){s(this,e)};return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=v.oAB({type:e}),e.\u0275inj=v.cJS({imports:[[c.Bz.forChild(Nn)],c.Bz]}),e}(),Yn=l(28780),Fn=l(22727),Mn=l(65515),Un=((On=function e(){s(this,e)}).\u0275fac=function(e){return new(e||On)},On.\u0275mod=v.oAB({type:On}),On.\u0275inj=v.cJS({providers:[ce.dp],imports:[[o.ez,wn,Yn.m,Fn.r,pi.ez,ce.d4,Mn.UsersModule]]}),On)}}])}();