<ng-template #spinner>
  <perun-web-apps-loading-dialog></perun-web-apps-loading-dialog>
</ng-template>
<div class="{{theme}} position-relative">
  <div *perunWebAppsLoader="loading; indicator: spinner">
    <h1 mat-dialog-title>{{'DIALOGS.ASSIGN_GROUP_TO_RESOURCE.TITLE' | translate}}</h1>
    @if (unAssignedGroups) {
      <div class="dialog-container" mat-dialog-content>
        <mat-stepper #stepper [linear]="true">
          <mat-step [completed]="selection.selected.length !== 0 && canAddGroups()">
            <ng-template
              matStepLabel
              >{{'DIALOGS.ASSIGN_GROUP_TO_RESOURCE.GROUPS' | translate}}</ng-template
            >
            <perun-web-apps-debounce-filter
              (filter)="applyFilter($event)"
              placeholder="{{'DIALOGS.ASSIGN_GROUP_TO_RESOURCE.FILTER_DESCRIPTION' | translate}}">
            </perun-web-apps-debounce-filter>
            <perun-web-apps-groups-list
              [loading]="loading"
              [disableMembers]="false"
              [groups]="unAssignedGroups"
              [selection]="selection"
              [disableRouting]="true"
              [displayColumns]="['select', 'id', 'name', 'description']"
              [filter]="filterValue">
            </perun-web-apps-groups-list>
          </mat-step>
          <mat-step>
            <ng-template
              matStepLabel
              >{{'DIALOGS.ASSIGN_GROUP_TO_RESOURCE.OPTIONS' | translate}}</ng-template
            >
            <mat-slide-toggle
              (toggleChange)="changeSubgroupsMessage()"
              class="mt-3 slide-text"
              [(ngModel)]="autoAssignSubgroups"
              labelPosition="before">
              {{'DIALOGS.ASSIGN_GROUP_TO_RESOURCE.AUTO_SUBGROUPS' | translate}}
            </mat-slide-toggle>
            <div class="text-muted new-line mt-2">
              <i [innerHTML]="autoAssignHint"></i>
            </div>
            <mat-slide-toggle
              (toggleChange)="changeInactiveMessage()"
              class="mt-3 slide-text"
              [(ngModel)]="asActive"
              labelPosition="before">
              {{'DIALOGS.ASSIGN_GROUP_TO_RESOURCE.AS_ACTIVE' | translate}}
            </mat-slide-toggle>
            <div class="text-muted new-line mt-2">
              {{asActiveHint}}
            </div>
            <mat-slide-toggle
              (toggleChange)="changeAsyncMessage()"
              class="mt-3 slide-text"
              [(ngModel)]="async"
              labelPosition="before">
              {{'DIALOGS.ASSIGN_GROUP_TO_RESOURCE.ASYNC_OPT' | translate}}
            </mat-slide-toggle>
            <div class="text-muted new-line mt-2">
              {{asyncHint}}
            </div>
          </mat-step>
        </mat-stepper>
      </div>
    }
    @if (stepper) {
      <div mat-dialog-actions class="justify-content-end">
        <div>
          <button (click)="onCancel()" mat-stroked-button class="me-2">
            {{'DIALOGS.ASSIGN_GROUP_TO_RESOURCE.CANCEL_BUTTON' | translate}}
          </button>
          @if (stepper !== undefined && stepper.selectedIndex !== 0) {
            <button (click)="stepperPrevious()" class="ms-auto" mat-stroked-button>
              {{'DIALOGS.ASSIGN_GROUP_TO_RESOURCE.BACK' | translate}}
            </button>
          }
          @if (stepper !== undefined && stepper.selectedIndex !== stepper._steps.length - 1) {
            <button
              (click)="stepperNext()"
              [class.ms-2]="stepper !== undefined && stepper.selectedIndex !== 0"
              [class.ms-auto]="!(stepper !== undefined && stepper.selectedIndex !== 0)"
              [disabled]="loading || selection.selected.length === 0 || !canAddGroups()"
              color="accent"
              mat-flat-button
              type="button"
              data-cy="next-button">
              {{'DIALOGS.ASSIGN_GROUP_TO_RESOURCE.NEXT' | translate}}
            </button>
          }
          @if (stepper !== undefined && stepper.selectedIndex === stepper._steps.length -1) {
            <button
              (click)="onAdd()"
              class="ms-2"
              color="accent"
              mat-flat-button
              type="button"
              data-cy="assign-button">
              {{'DIALOGS.ASSIGN_GROUP_TO_RESOURCE.ADD_BUTTON' | translate}}
            </button>
          }
        </div>
      </div>
    }
  </div>
</div>
