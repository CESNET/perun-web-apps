<h1 class="page-title">{{'USER_DETAIL.ASSIGNMENTS.TITLE' | translate}}</h1>
<ng-template #spinner1>
  <perun-web-apps-loading-table></perun-web-apps-loading-table>
</ng-template>
<div *perunWebAppsLoader="initLoading; indicator: spinner1">
  <div class="d-flex">
    @if (!(initLoading || facilities.length === 0)) {
      <perun-web-apps-facility-search-select
        class="w-50"
        [facilities]="facilities"
        (facilitySelected)="loadFacility($event)">
      </perun-web-apps-facility-search-select>
    }
  </div>
  @if (!(initLoading || facilities.length === 0)) {
    <mat-tab-group mat-stretch-tabs="false">
      <mat-tab>
        <ng-template matTabLabel>
          {{'USER_DETAIL.ASSIGNMENTS.OVERVIEW' | translate}}
        </ng-template>
        <ng-template matTabContent>
          <p class="mt-4 subtitle">{{'USER_DETAIL.ASSIGNMENTS.RESOURCES' | translate}}</p>
          <div class="position-relative table-min-height">
            <perun-web-apps-resources-list
              *perunWebAppsLoader="loading; indicator: spinner1"
              [loading]="loading"
              [resources]="resources"
              [displayColumns]="['id', 'name', 'vo', 'description']">
            </perun-web-apps-resources-list>
          </div>
        </ng-template>
      </mat-tab>
      <mat-tab>
        <ng-template matTabLabel>
          {{'USER_DETAIL.ASSIGNMENTS.USER_FACILITY_ATT' | translate}}
        </ng-template>
        <ng-template matTabContent>
          @if (loading) {
            <mat-spinner class="ms-auto me-auto"></mat-spinner>
          }
          @if (!loading) {
            <app-two-entity-attribute-page
              [firstEntity]="'user'"
              [firstEntityId]="userId"
              [secondEntity]="'facility'"
              [specificSecondEntity]="selectedFacility"></app-two-entity-attribute-page>
          }
        </ng-template>
      </mat-tab>
      <mat-tab>
        <ng-template matTabLabel>
          {{'USER_DETAIL.ASSIGNMENTS.MEMBER_RESOURCE_ATT' | translate}}
        </ng-template>
        <ng-template matTabContent>
          @if (loading) {
            <mat-spinner class="ms-auto me-auto"></mat-spinner>
          }
          @if (!loading) {
            <app-two-entity-attribute-page
              [firstEntity]="'user'"
              [firstEntityId]="userId"
              [secondEntity]="'resource'"
              [facilityId]="selectedFacility.id"></app-two-entity-attribute-page>
          }
        </ng-template>
      </mat-tab>
    </mat-tab-group>
  }

  @if (!initLoading && facilities.length === 0) {
    <perun-web-apps-alert
      alert_type="warn"
      >{{'USER_DETAIL.ASSIGNMENTS.NO_FACILITIES' | translate}}</perun-web-apps-alert
    >
  }
</div>
